%!PS-Adobe-2.0
%%Creator: dvipsk 5.58f Copyright 1986, 1994 Radical Eye Software
%%Title: off.dvi
%%Pages: 390 0
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentPaperSizes: A4
%%EndComments
%%BeginProcSet: PStoPS 1 15
userdict begin
[/showpage/erasepage/copypage]{dup where{pop dup load
 type/operatortype eq{1 array cvx dup 0 3 index cvx put
 bind def}{pop}ifelse}{pop}ifelse}forall
[/letter/legal/executivepage/a4/a4small/b5/com10envelope
 /monarchenvelope/c5envelope/dlenvelope/lettersmall/note
 /folio/quarto/a5]{dup where{dup wcheck{exch{}put}
 {pop{}def}ifelse}{pop}ifelse}forall
/setpagedevice {pop}bind 1 index where{dup wcheck{3 1 roll put}
 {pop def}ifelse}{def}ifelse
/PStoPSmatrix matrix currentmatrix def
/PStoPSxform matrix def/PStoPSclip{clippath}def
/defaultmatrix{PStoPSmatrix exch PStoPSxform exch concatmatrix}bind def
/initmatrix{matrix defaultmatrix setmatrix}bind def
/initclip[{matrix currentmatrix PStoPSmatrix setmatrix
 [{currentpoint}stopped{$error/newerror false put{newpath}}
 {/newpath cvx 3 1 roll/moveto cvx 4 array astore cvx}ifelse]
 {[/newpath cvx{/moveto cvx}{/lineto cvx}
 {/curveto cvx}{/closepath cvx}pathforall]cvx exch pop}
 stopped{$error/errorname get/invalidaccess eq{cleartomark
 $error/newerror false put cvx exec}{stop}ifelse}if}bind aload pop
 /initclip dup load dup type dup/operatortype eq{pop exch pop}
 {dup/arraytype eq exch/packedarraytype eq or
  {dup xcheck{exch pop aload pop}{pop cvx}ifelse}
  {pop cvx}ifelse}ifelse
 {newpath PStoPSclip clip newpath exec setmatrix} bind aload pop]cvx def
/initgraphics{initmatrix newpath initclip 1 setlinewidth
 0 setlinecap 0 setlinejoin []0 setdash 0 setgray
 10 setmiterlimit}bind def
end
%%EndProcSet
%DVIPSCommandLine: dvips off.dvi -o off.ps
%DVIPSParameters: dpi=600, comments removed
%DVIPSSource:  TeX output 1998.09.08:1654
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginProcSet: special.pro
TeXDict begin /SDict 200 dict N SDict begin /@SpecialDefaults{/hs 612 N
/vs 792 N /ho 0 N /vo 0 N /hsc 1 N /vsc 1 N /ang 0 N /CLIP 0 N /rwiSeen
false N /rhiSeen false N /letter{}N /note{}N /a4{}N /legal{}N}B
/@scaleunit 100 N /@hscale{@scaleunit div /hsc X}B /@vscale{@scaleunit
div /vsc X}B /@hsize{/hs X /CLIP 1 N}B /@vsize{/vs X /CLIP 1 N}B /@clip{
/CLIP 2 N}B /@hoffset{/ho X}B /@voffset{/vo X}B /@angle{/ang X}B /@rwi{
10 div /rwi X /rwiSeen true N}B /@rhi{10 div /rhi X /rhiSeen true N}B
/@llx{/llx X}B /@lly{/lly X}B /@urx{/urx X}B /@ury{/ury X}B /magscale
true def end /@MacSetUp{userdict /md known{userdict /md get type
/dicttype eq{userdict begin md length 10 add md maxlength ge{/md md dup
length 20 add dict copy def}if end md begin /letter{}N /note{}N /legal{}
N /od{txpose 1 0 mtx defaultmatrix dtransform S atan/pa X newpath
clippath mark{transform{itransform moveto}}{transform{itransform lineto}
}{6 -2 roll transform 6 -2 roll transform 6 -2 roll transform{
itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll curveto}}{{
closepath}}pathforall newpath counttomark array astore /gc xdf pop ct 39
0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}if}N
/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1 -1
scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3 get
ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip yflip
not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub neg 0
TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{noflips{TR
pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop 90 rotate 1
-1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg
TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr 1 get neg
sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr 2 get ppr
0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4 -1 roll add
2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S TR}if}N /cp
{pop pop showpage pm restore}N end}if}if}N /normalscale{Resolution 72
div VResolution 72 div neg scale magscale{DVImag dup scale}if 0 setgray}
N /psfts{S 65781.76 div N}N /startTexFig{/psf$SavedState save N userdict
maxlength dict begin /magscale true def normalscale currentpoint TR
/psf$ury psfts /psf$urx psfts /psf$lly psfts /psf$llx psfts /psf$y psfts
/psf$x psfts currentpoint /psf$cy X /psf$cx X /psf$sx psf$x psf$urx
psf$llx sub div N /psf$sy psf$y psf$ury psf$lly sub div N psf$sx psf$sy
scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub TR
/showpage{}N /erasepage{}N /copypage{}N /p 3 def @MacSetUp}N /doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N /endTexFig{end psf$SavedState restore}N /@beginspecial{SDict
begin /SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count /ocount X /dcount countdictstack N}N /@setspecial
{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if /showpage{}N /erasepage{}N /copypage{}N newpath
}N /@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{
end}repeat grestore SpecialSave restore end}N /@defspecial{SDict begin}
N /@fedspecial{end}B /li{lineto}B /rl{rlineto}B /rc{rcurveto}B /np{
/SaveX currentpoint /SaveY X N 1 setlinecap newpath}N /st{stroke SaveX
SaveY moveto}N /fil{fill SaveX SaveY moveto}N /ellipse{/endangle X
/startangle X /yrad X /xrad X /savematrix matrix currentmatrix N TR xrad
yrad scale 0 0 1 startangle endangle arc savematrix setmatrix}N end
%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600 (off.dvi)
@start /Fa 1 66 df<0000000780000000000F80000000000F80000000001F80000000
001F80000000003F80000000007F80000000007F8000000000EF8000000000E7C0000000
01C7C000000003C7C00000000387C00000000707C00000000707C00000000E07C0000000
1E07C00000001C07C00000003807E00000003803E00000007003E0000000F003E0000000
E003E0000001C003E0000001C003E00000038003E0000007FFFFE0000007FFFFF000000E
0001F000000E0001F000001C0001F00000380001F00000380001F00000700001F00000F0
0001F00000E00001F00001E00001F00003C00001F80007C00001F8000FC00001F800FFF8
001FFF80FFF8001FFF80292A7CA932>65 D E /Fb 1 44 df<00000078000000000000FC
000000000001FE000000000001FE000000000001FE000000000001FE000000000001FE00
0000000001FE000000000001FE000000000001FE000000000001FE000000000001FE0000
00000001FE000000000001FE000000000001FE000000000001FE000000000001FE000000
000001FE000000000001FE000000000001FE000000000001FE000000000001FE0000003F
FFFFFFFFFFE07FFFFFFFFFFFF0FFFFFFFFFFFFF8FFFFFFFFFFFFF8FFFFFFFFFFFFF8FFFF
FFFFFFFFF87FFFFFFFFFFFF03FFFFFFFFFFFE0000001FE000000000001FE000000000001
FE000000000001FE000000000001FE000000000001FE000000000001FE000000000001FE
000000000001FE000000000001FE000000000001FE000000000001FE000000000001FE00
0000000001FE000000000001FE000000000001FE000000000001FE000000000001FE0000
00000001FE000000000001FE000000000000FC0000000000007800000035347CBE3E>43
D E /Fc 1 68 df<000000000003FFF8000003800000000000FFFFFF80000FC000000000
0FFFFFFFF0001FC0000000007FFFFFFFFC003F8000000001FFFFFFFFFF00FF800000000F
FFFFFFFFFF81FF800000003FFFFFE003FFC3FF800000007FFFFC00007FFFFF80000001FF
FFE000001FFFFF80000007FFFF80000007FFFF0000000FFFFC00000003FFFF0000001FFF
F800000001FFFF0000007FFFE000000000FFFF000000FFFFC0000000007FFF000001FFFF
00000000003FFF000003FFFE00000000003FFE000007FFFC00000000001FFE00000FFFF8
00000000001FFE00001FFFF800000000000FFE00001FFFF000000000000FFE00003FFFE0
00000000000FFE00007FFFE0000000000007FC0000FFFFC0000000000007FC0000FFFFC0
000000000007FC0001FFFF80000000000007FC0001FFFF80000000000003FC0003FFFF00
000000000003FC0007FFFF00000000000003F80007FFFE00000000000003F80007FFFE00
000000000003F8000FFFFE00000000000003F8000FFFFC00000000000003F0001FFFFC00
00000000000000001FFFFC0000000000000000001FFFF80000000000000000003FFFF800
00000000000000003FFFF80000000000000000003FFFF80000000000000000007FFFF800
00000000000000007FFFF00000000000000000007FFFF00000000000000000007FFFF000
00000000000000007FFFF00000000000000000007FFFF0000000000000000000FFFFF000
0000000000000000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE000
0000000000000000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE000
0000000000000000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE000
00000000001F00007FFFE00000000000001F80007FFFE00000000000003F80007FFFE000
00000000003F00007FFFE00000000000003F00007FFFE00000000000003F00007FFFE000
00000000007F00003FFFE00000000000007E00003FFFE0000000000000FE00003FFFF000
0000000000FC00001FFFF0000000000001FC00001FFFF0000000000001F800000FFFF800
0000000003F800000FFFF8000000000007F0000007FFFC00000000000FE0000003FFFC00
000000001FE0000003FFFE00000000003FC0000001FFFF00000000007F80000000FFFF80
00000000FF000000007FFFC000000003FE000000003FFFF000000007FC000000001FFFF8
0000001FF8000000000FFFFF0000007FE00000000003FFFFC00003FFC00000000001FFFF
FE003FFF0000000000007FFFFFFFFFFE0000000000001FFFFFFFFFF800000000000007FF
FFFFFFE000000000000000FFFFFFFF00000000000000001FFFFFF8000000000000000000
7FFF0000000000005A5472D263>67 D E /Fd 1 68 df<0000000003FFF0000070000000
007FFFFF0001F000000007FFFFFFE003F00000003FFFFFFFF007F0000000FFFFFFFFFC0F
F0000003FFFFC00FFE3FF000000FFFFC0001FF7FF000001FFFE000003FFFE000007FFF00
00001FFFE00000FFFE0000000FFFE00001FFF800000007FFE00007FFF000000003FFE000
0FFFC000000001FFE0001FFF8000000001FFC0003FFF0000000000FFC0003FFE00000000
00FFC0007FFE00000000007FC000FFFC00000000007FC001FFF800000000007FC001FFF8
00000000003F8003FFF000000000003F8007FFF000000000003F8007FFE000000000003F
800FFFE000000000003F800FFFC000000000003F801FFFC000000000003F001FFFC00000
0000001F001FFF80000000000000003FFF80000000000000003FFF80000000000000003F
FF80000000000000007FFF00000000000000007FFF00000000000000007FFF0000000000
0000007FFF00000000000000007FFF0000000000000000FFFF0000000000000000FFFE00
00000000000000FFFE0000000000000000FFFE0000000000000000FFFE00000000000000
00FFFE0000000000000000FFFE0000000000000000FFFE0000000000000000FFFE000000
000000F000FFFE000000000000F8007FFE000000000000F8007FFE000000000001F8007F
FE000000000001F0007FFE000000000001F0003FFE000000000003F0003FFF0000000000
03E0003FFF000000000007E0001FFF000000000007C0001FFF80000000000FC0000FFF80
000000001F80000FFFC0000000003F000007FFC0000000007E000003FFE000000000FC00
0001FFF000000001F8000000FFFC00000007F00000007FFE0000001FE00000003FFF8000
007FC00000001FFFF00001FF8000000007FFFF001FFE0000000003FFFFFFFFFC00000000
00FFFFFFFFF000000000001FFFFFFF80000000000003FFFFFC000000000000001FFFC000
0000004C4675C453>67 D E /Fe 4 117 df<FFFFFE00FFFFFFC00FC007E007C001F807
C000FC07C0007C07C0007E07C0007E07C0007E07C0007E07C0007E07C0007C07C000FC07
C001F807C007F007FFFFC007FFFF8007C007F007C001F807C000FC07C0007E07C0003E07
C0003F07C0003F07C0003F07C0003F07C0003F07C0003E07C0007E07C000FC07C001FC0F
C003F0FFFFFFE0FFFFFF0020227EA127>98 D<FFFFFC0000FFFFFF80000FC00FE00007C0
01F00007C000F80007C0007C0007C0003E0007C0003E0007C0001F0007C0001F0007C000
0F8007C0000F8007C0000F8007C0000FC007C0000FC007C0000FC007C0000FC007C0000F
C007C0000FC007C0000FC007C0000FC007C0000FC007C0000F8007C0000F8007C0001F80
07C0001F0007C0001E0007C0003E0007C0007C0007C000F80007C001F0000FC007E000FF
FFFF8000FFFFFC000022227EA129>100 D<FFFF0000FFFF00000FE0000007C0000007C0
000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0
000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0003007C0
003007C0003007C0003007C0007007C0007007C0006007C000E007C001E007C003E00FC0
0FE0FFFFFFE0FFFFFFE01C227EA122>108 D<7FFFFFFF007FFFFFFF007C03E01F007003
E007006003E003006003E00300E003E00380E003E00380C003E00180C003E00180C003E0
0180C003E001800003E000000003E000000003E000000003E000000003E000000003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E00000
0003E000000003E000000003E000000003E000000003E000000003E000000007F0000001
FFFFC00001FFFFC00021227EA127>116 D E /Ff 17 122 df<0007C000001FF000007C
39C000F81FC001F01FC003E00FC007C00FC00FC00FC01F800F801F800F803F000F803F00
1F807F001F007E001F007E001F007E003F00FE003E00FC003E00FC003E00FC007E18FC00
7C38F8007C38F8007C38F800FC387801FC787C03F8707C03F8703C0F78E01E1E3DE00FF8
1FC003E00F001D1F799D24>97 D<0001F800000FFE00003E078000FC038001F003C003E0
07C007E00FC00FC00FC00F800F801F800F803F0000003F0000007F0000007E0000007E00
00007E000000FE000000FC000000FC000000FC000000FC000000FC000000FC0001807C00
03C07C0007807C000F003E001E001E007C000F83F00007FFC00000FE00001A1F799D21>
99 D<0000003E000007FE000007FE0000007E0000007E0000007C0000007C000000FC00
0000FC000000F8000000F8000001F8000001F8000001F0000001F0000003F00007C3F000
1FF3E0007C3BE000F81FE001F01FE003E00FC007C00FC00FC00FC01F800FC01F800F803F
000F803F001F807F001F807E001F007E001F007E003F00FE003F00FC003E00FC003E00FC
007E18FC007E38F8007C38F8007C38F800FC387801FC787C03F8707C03F8703C0F78E01E
1E3DE00FF81FC003E00F001F2F79AD24>I<0003F800000FFE00003E0F0000F8070001F0
038003E0038007C003800FC007801F8007001F800F003F001E003F003C007F03F8007FFF
E0007FFE00007E000000FE000000FC000000FC000000FC000000FC0000007C0000007C00
01807C0003C07C0007803E000F003E001E001F007C000F83F00003FFC00000FE00001A1F
799D21>I<0000F8000003FE00000F8738001F03F8007E03F8007C01F800F801F801F801
F803F001F803F001F007E001F007E003F00FE003F00FC003E00FC003E00FC007E01FC007
E01F8007C01F8007C01F800FC01F800FC01F800F801F801F800F801F800F803F800F807F
0007C0FF0003C3FF0001FFBF00007E3E0000003E0000007E0000007E0000007C0000007C
000000FC003800F800FC01F800FC01F000FC03E000F807C000F01F80007FFE00001FF000
001D2C7C9D21>103 D<001F000003FF000003FF0000003F0000003F0000003E0000003E
0000007E0000007E0000007C0000007C000000FC000000FC000000F8000000F8000001F8
000001F87E0001F3FF8001F787C003FE03E003FC03E003F803E003F803E007F003E007E0
03E007E003E007C003E00FC007E00FC007C00F8007C00F8007C01F800FC01F800F801F00
0F801F001F803F001F063F001F0E3E003F0E3E003E0E7E003E1E7E007E1C7C007C1C7C00
3C38FC003C38FC003C70F8001FE0700007801F2F7BAD24>I<000E00001F00003F80003F
80001F00000E0000000000000000000000000000000000000000000000000000000003E0
000FF0001E78001C7C00387C00787C00707C0070FC00F0F800E0F800E1F800C1F00001F0
0003F00003E00007E00007C00007C0000FC0000F83000F87001F87001F07001F0F003F0E
003E0E001E1C001E3C001E38000FF00003C000112E7AAC16>I<007C0FFC0FFC00FC00FC
00F800F801F801F801F001F003F003F003E003E007E007E007C007C00FC00FC00F800F80
1F801F801F001F003F003F003E003E007E007E007C007C00FC30FC70F870F870F8F0F8E0
F0E0F1E0F1C0FBC07F801E000E2F7AAD12>108 D<07801FC0001FE07FF0003DF1E0F800
38F3C0780078FF007C0070FE007C0070FE007C00F1FC007C00E1F8007C00E1F8007C00E1
F0007C00C3F000FC0003F000F80003E000F80003E000F80007E001F80007E001F00007C0
01F00007C003F0000FC003E0C00FC003E1C00F8007E1C00F8007C1C01F8007C3C01F800F
C3801F000F83801F000787003F000787003F00078E003E0003FC001C0000F000221F7A9D
28>110 D<0003F800000FFE00003E0F8000FC07C001F003C003E003E007E003E00FC001
F00F8001F01F8001F03F0001F03F0003F07F0003F07E0003F07E0003F07E0007F0FE0007
E0FC0007E0FC0007E0FC000FC0FC000FC0FC001F80FC001F807C003F007C003E007C007C
003E00F8001E01F0000F07C00007FF000001FC00001C1F799D24>I<003C01F00000FF07
FC0001E79E1E0001C7BC0F0003C7F80F800387F007800387E007C0078FC007C0070FC007
C0070F8007C0070F8007C0061F800FC0001F800FC0001F000FC0001F000FC0003F001FC0
003F001F80003E001F80003E001F80007E003F00007E003F00007C003E00007C007E0000
FC007C0000FC00F80000FE01F80000FE01F00001FF03E00001FF0F800001F3FE000001F0
F8000003F000000003F000000003E000000003E000000007E000000007E000000007C000
000007C00000000FC00000000FC0000000FFFC000000FFFC000000222B7F9D24>I<0780
3E001FE0FF803CF3C1C038F781E078FF07E070FE07E070FC07E0F1FC07E0E1F80380E1F8
0000E1F00000C3F0000003F0000003E0000003E0000007E0000007E0000007C0000007C0
00000FC000000FC000000F8000000F8000001F8000001F8000001F0000001F0000003F00
00003F0000003E0000001C0000001B1F7A9D1E>114 D<000FC0007FF000F03C01E01C03
C01E07801E07803E07803E0F803C0F80180FC0000FF8000FFF0007FFC003FFE001FFF000
7FF00007F00003F00001F07800F0FC00F0FC00F0FC01F0F801E0E001E0E003C0F0078078
1F001FFC0007F000171F7A9D1D>I<001C00003E00003E00007E00007E00007C00007C00
00FC0000FC0000F80000F80001F80001F800FFFFE0FFFFE003F00003F00003E00003E000
07E00007E00007C00007C0000FC0000FC0000F80000F80001F80001F80001F00001F0000
3F00C03F01C03E01C03E03C03E03803E07803C07003C0E003C1E001E3C000FF00007C000
132B7AA918>I<03C000000FF000381E78007C1C7C00FC387C00F8787C00F8707C00F870
FC01F8F0F801F0E0F801F0E1F801F0C1F003F001F003E003F003E003E003E003E007E007
E007C007C007C007C007C007C00FC30FC00F870F800F870F800F870F801F870F801F8F07
803F0E07807F0E07C07F1C03E1E7BC01FF83F8007E01E0201F7A9D26>I<03C000000700
0FF000700F801E7800F81FC01C7C01F81FC0387C01F01FC0787C01F00FC0707C01F007C0
70FC03F007C0F0F803E00780E0F803E00780E1F803E00380C1F007E0078001F007E00700
03F007C0070003E007C0070003E00FC00F0007E00FC00E0007C00F800E0007C00F800E00
07C00F801E000FC01F801C000F801F001C000F801F003C000F801F0038000F801F007800
07803F00700007C07F80F00003C07F81E00001E0E7C3C00000FFC1FF8000003F007E0000
2A1F7A9D2F>119 D<03C000000FF000381E78007C1C7C00FC387C00F8787C00F8707C00
F870FC01F8F0F801F0E0F801F0E1F801F0C1F003F001F003E003F003E003E003E003E007
E007E007C007C007C007C007C007C00FC00FC00F800F800F800F800F800F801F800F801F
0007803F0007807F0007C07F0003E1FE0001FFBE00007E3E0000007E0000007C0000007C
003E00F8003E00F8007E01F0007E01F0007C03E0007007C000380F80003C3E00001FF800
0007E000001E2C7A9D23>121 D E /Fg 1 68 df<00000000FFF000070000001FFFFE00
1F000000FFFFFF803E000007FFFFFFE07E00001FFFE007F9FE00007FFE0001FFFE0000FF
F000007FFE0003FFC000003FFE0007FF8000001FFC000FFF0000000FFC003FFC0000000F
FC007FF800000007FC007FF800000003FC00FFF000000003FC01FFE000000003F803FFC0
00000001F803FFC000000001F807FF8000000001F80FFF8000000001F80FFF0000000001
F81FFF0000000001F01FFF0000000001F01FFE0000000000003FFE0000000000003FFE00
00000000003FFE0000000000007FFC0000000000007FFC0000000000007FFC0000000000
007FFC0000000000007FFC000000000000FFFC000000000000FFF8000000000000FFF800
0000000000FFF8000000000000FFF8000000000000FFF8000000000000FFF80000000000
007FF80000000007807FF80000000007807FF80000000007807FF8000000000F807FF800
0000000F003FFC000000000F003FFC000000001F001FFC000000003E001FFE000000003C
000FFE000000007C000FFF00000000F80007FF80000001F00003FFC0000003E00001FFE0
00000FC00000FFF000001F8000007FFE0000FE0000001FFFC007FC00000007FFFFFFF000
000001FFFFFFC0000000003FFFFE000000000001FFE0000000403B77B945>67
D E /Fh 21 119 df<000FE0E0003FF9F000FFFDF001FFFFF003FFFFF007FC3FF00FF00F
F01FC007F01FC007F03F8003F03F0003F07F0001F07E0001F07E0001F07C0000E0FC0000
00FC000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F80000
00F8000000FC000000FC0000007C0000007E0000E07E0001F07F0001F03F0001F03F8003
F01FC003F01FC007E00FF00FE007FC1FC003FFFF8001FFFF0000FFFE00003FF800000FE0
001C2B7DA923>67 D<7FFFC00000FFFFF80000FFFFFC0000FFFFFF00007FFFFF00000F80
7F80000F801FC0000F800FC0000F8007E0000F8003E0000F8003E0000F8003E0000F8003
E0000F8003E0000F8007E0000F800FC0000F801FC0000F807F80000FFFFF00000FFFFF00
000FFFFC00000FFFFE00000FFFFF00000F807F00000F803F80000F801F80000F800F8000
0F800F80000F800F80000F800F80000F800F80000F800F80000F800F87000F800F8F800F
800F8F800F800FCF807FF00FDF80FFF807FF80FFF807FF00FFF803FF007FF001FE000000
00F800212A7FA823>82 D<7FF00FFEFFF00FFFFFF00FFFFFF00FFF7FF00FFE0F8001F00F
8001F007C003E007C003E007C003E007C003E003E007C003E007C003E007C003E007C003
F00FC001F00F8001F00F8001F00F8001F00F8000F81F0000F81F0000F81F0000F81F0000
7C3E00007C3E00007C3E00007C3E00003C3C00003E7C00003E7C00003E7C00001E780000
1E7800001E7800001E7800001FF800000FF000000FF000000FF0000007E0000007E00020
2A7FA823>86 D<03FF80000FFFE0001FFFF8003FFFFC003FFFFE003F80FF003F803F801F
001F8000001F8000000F800000FF80007FFF8003FFFF800FFFFF801FFFFF807FF00F807F
000F80FC000F80FC000F80F8000F80F8001F80FC001F80FE003F807F81FF807FFFFFFC3F
FFFFFE1FFFFFFE07FFC7FE01FE01FC1F1D7D9C23>97 D<FF800000FFC00000FFC00000FF
C00000FFC0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007
C1FC0007C7FF0007DFFFC007FFFFE007FFFFF007FE0FF807F803F807F001FC07E000FC07
E000FC07C0007E07C0007E07C0003E07C0003E07C0003E07C0003E07C0003E07C0007E07
E0007E07E000FC07F000FC07F001FC07F803F807FE0FF007FFFFF007FFFFE007DFFF8007
CFFF000383F8001F297FA823>I<003FF00000FFFC0003FFFF0007FFFF000FFFFF001FE0
7F003F807F007F003E007E0000007E000000FC000000FC000000F8000000F8000000F800
0000F8000000F8000000FC000000FC0000007E0007007F000F807F001F803FC01F801FF0
7F000FFFFF0007FFFE0003FFFC0000FFF000003FC000191D7B9C23>I<0000FF800000FF
C00000FFC00000FFC00000FFC0000007C0000007C0000007C0000007C0000007C0000007
C0000007C0007F87C001FFE7C003FFF7C00FFFFFC01FFFFFC01FE0FFC03F803FC07F001F
C07E000FC07E000FC0FC0007C0FC0007C0F80007C0F80007C0F80007C0F80007C0F80007
C0FC000FC0FC000FC07E000FC07E001FC07F003FC03F807FC03FE0FFC01FFFFFFE0FFFFF
FE03FFF7FE01FFC7FE007F03FE1F297EA823>I<003FC00000FFF80003FFFC0007FFFF00
0FFFFF801FF07F803F801FC03F000FC07E0007C07E0007E0FC0007E0FFFFFFE0FFFFFFE0
FFFFFFE0FFFFFFE0FFFFFFC0F8000000FC000000FC0000007E0001C07F0003E03F8007E0
3FE007E01FF81FC00FFFFFC007FFFF8001FFFE00007FFC00001FE0001B1D7D9C23>I<00
007F000001FFC00007FFE0000FFFE0001FFFE0003FCFE0003F0FE0003E07C0003E000000
3E0000003E0000003E00007FFFFF80FFFFFFC0FFFFFFC0FFFFFFC07FFFFF80003E000000
3E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E000000
3E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E00003F
FFFE007FFFFF007FFFFF007FFFFF003FFFFE001B297EA823>I<000001F0003F07FC00FF
DFFE03FFFFFE07FFFFFE0FFFFF7E1FE1FE7E1F807E183F003F003F003F003E001F003E00
1F003E001F003E001F003F003F003F003F001F807E001FE1FE000FFFFC001FFFF8001FFF
F0001EFFC0001E3F00001E0000001F0000001F4000000FFFFC000FFFFF801FFFFFC03FFF
FFF07E0007F87C0000F8F800007CF800007CF000003CF000003CF000003CF800007CFC00
00FC7F0003F87FE01FF83FFFFFF00FFFFFC007FFFF8001FFFE00003FF0001F2E7E9D23>
I<00380000FE0000FE0000FE0000FE0000FE000038000000000000000000000000000000
000000007FFC00FFFE00FFFE00FFFE007FFE00003E00003E00003E00003E00003E00003E
00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E
00003E007FFFFEFFFFFFFFFFFFFFFFFF7FFFFE182A7AA923>105
D<7F800000FFC00000FFC00000FFC000007FC0000003C0000003C0000003C0000003C000
0003C0000003C0000003C0000003C0FFFC03C1FFFC03C1FFFC03C1FFFC03C0FFFC03C03F
0003C07E0003C0FC0003C1F80003C3F00003C7E00003CFC00003DFE00003FFF00003FFF0
0003FCF80003F8FC0003F07E0003E03E0003C01F0003C01F8003C00FC003C007C003C003
E07FFE0FFFFFFF1FFFFFFF1FFFFFFF1FFF7FFE0FFF20297FA823>107
D<7FFE0000FFFF0000FFFF0000FFFF00007FFF0000001F0000001F0000001F0000001F00
00001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F00
00001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F00
00001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F00
007FFFFFC0FFFFFFE0FFFFFFE0FFFFFFE07FFFFFC01B297CA823>I<7E1F01F000FF7FC7
FC00FFFFEFFE00FFFFFFFE007FFFFFFF000FE1FE1F000FC1FC1F000FC0FC0F000F80F80F
000F80F80F000F00F00F000F00F00F000F00F00F000F00F00F000F00F00F000F00F00F00
0F00F00F000F00F00F000F00F00F000F00F00F000F00F00F000F00F00F000F00F00F000F
00F00F007FE3FE3FE0FFF3FF3FF0FFF3FF3FF0FFF3FF3FF07FE3FE3FE0241D819C23>I<
FF81FC00FFC7FF00FFDFFF80FFFFFFC0FFFFFFC007FE0FE007F807E007F003E007E003E0
07E003E007E003E007C003E007C003E007C003E007C003E007C003E007C003E007C003E0
07C003E007C003E007C003E007C003E007C003E007C003E0FFFE1FFFFFFE3FFFFFFE3FFF
FFFE3FFFFFFE1FFF201D7F9C23>I<003F000001FFE00003FFF00007FFF8000FFFFC001F
C0FE003F807F003E001F007E001F807C000F80FC000FC0F80007C0F80007C0F80007C0F8
0007C0F80007C0F80007C0FC000FC0FC000FC07C000F807E001F803F003F003F807F001F
E1FE000FFFFC0007FFF80003FFF00001FFE000003F00001A1D7C9C23>I<FF81FC00FFC7
FF00FFDFFFC0FFFFFFE0FFFFFFF007FE0FF807F803F807F001FC07E000FC07E000FC07C0
007E07C0007E07C0003E07C0003E07C0003E07C0003E07C0003E07C0007E07E0007E07E0
00FC07F000FC07F001FC07F803F807FE0FF007FFFFF007FFFFE007DFFF8007CFFF0007C3
F80007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0000007C0
000007C00000FFFE0000FFFE0000FFFE0000FFFE0000FFFE00001F2C7F9C23>I<7FF00F
E0FFF87FF8FFF8FFFCFFFBFFFC7FFFFFFC00FFF8FC00FFC07800FF800000FF000000FE00
0000FE000000FC000000FC000000FC000000F8000000F8000000F8000000F8000000F800
0000F8000000F8000000F8000000F8000000F800007FFFFC00FFFFFE00FFFFFE00FFFFFE
007FFFFC001E1D7E9C23>114 D<01FF9C0FFFFE1FFFFE7FFFFE7FFFFEFF00FEFC007EF8
003EF8003EFC001CFE00007FF0003FFF800FFFE007FFF8007FFC0001FE00007F70003FF8
001FFC001FFC003FFE003FFF80FFFFFFFEFFFFFCFFFFF8FFFFF070FF80181D7B9C23>I<
FF807FC0FFC07FE0FFC07FE0FFC07FE0FFC07FE007C003E007C003E007C003E007C003E0
07C003E007C003E007C003E007C003E007C003E007C003E007C003E007C003E007C003E0
07C003E007C003E007C003E007C007E007C00FE007E03FE007FFFFFF03FFFFFF03FFFFFF
00FFF3FF003FC1FF201D7F9C23>117 D<FFF03FFCFFF03FFCFFF03FFCFFF03FFCFFF03F
FC0F8007C0078007800780078007C00F8003C00F0003C00F0003E01F0001E01E0001E01E
0001F03E0000F03C0000F03C0000F87C000078780000787800007CF800003CF000003CF0
00003FF000001FE000001FE000001FE000000FC000000780001E1D7E9C23>I
E /Fi 94 127 df<3C7EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7E7E7E7E7E7E7E7E7E7E7E
7E7E7E3C000000000000003C7EFFFFFFFF7E3C082F71AE27>33 D<1000207C00F8FE01FC
FE01FCFE01FCFE01FCFE01FCFE01FCFE01FCFE01FCFE01FCFE01FCFC00FC7C00F87C00F8
7C00F87C00F87C00F87C00F87C00F87C00F87C00F8380070161778AE27>I<003C03C000
7E07E0007E07E0007E07E0007E07E0007E07E0007E07E0007E07E000FE0FE000FC0FC000
FC0FC07FFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF3FFFFFFE01F81F8001F81F8001
F81F8001F81F8001F81F8001F81F8001F81F8001F81F8001F81F8001F81F8001F81F8001
F81F803FFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFE03F03F0003F03F0007
F07F0007E07E0007E07E0007E07E0007E07E0007E07E0007E07E0007E07E0003C03C0020
2E7DAD27>I<000380000007C0000007C0000007C0000007C0000007C000001FF00000FF
FE0003FFFF8007FFFFC01FFFFFE01FE7DFF03F87C7F87E07C3F87C07C1F8FC07C0FCF807
C0FCF807C1FCF807C1FCF807C1FCFC07C0F8FE07C0707F07C0007F87C0003FFFC0001FFF
C0000FFFF80007FFFE0003FFFF8000FFFFC0000FFFE00007FFF00007CFF00007C3F80007
C1F83807C0FC7C07C0FCFE07C07CFE07C07CFE07C07CFE07C07CFC07C07CFE07C0F87E07
C1F87F07C3F03F87C7F03FF7FFE01FFFFFC00FFFFF8003FFFF0001FFFC00003FE0000007
C0000007C0000007C0000007C0000007C000000380001E3A7CB327>I<0F0000701F8000
F83FC001F87FE001F87FE003F87FE003F0FFF007F0F9F007E0F9F007E0F9F00FE0F9F00F
C0F9F00FC0F9F01FC0FFF01F807FE03F807FE03F007FE03F003FC07F001F807E000F00FE
000000FC000000FC000001FC000001F8000001F8000003F8000003F0000007F0000007E0
000007E000000FE000000FC000001FC000001F8000001F8000003F8000003F0000003F00
00007F00F0007E01F800FE03FC00FC07FE00FC07FE01FC07FE01F80FFF03F80F9F03F00F
9F03F00F9F07F00F9F07E00F9F07E00F9F0FE00FFF0FC007FE1FC007FE1F8007FE1F8003
FC0F8001F8070000F0203A7DB327>I<001F000000007FC0000000FFE0000001FFE00000
01FFF0000003F1F0000003E1F8000007E0F8000007C0F8000007C0F8000007C0F8000007
C0F8000007C0F8000007C1F8000007C1F0000007C3F1FF8007E3E1FFC003E7E3FFC003EF
C1FFC003FFC1FF8003FF81F80003FF01F00001FE01F00001FC03F00001F803E00003F807
E00007FC07C0000FFC07C0001FFE0FC0003FBE0F80003F3F1F80007E1F1F00007E1F9F00
00FC0FBF0000FC0FFE0000FC07FE0000FC07FC0200FC03FC0F80FC01F80F80FC01F80F80
FE03FC0F807E07FE0F807F1FFF9F803FFFFFFF003FFF9FFF001FFF0FFE000FFC03FC0003
F000F80022307EAE27>I<0F001FC03FC03FE03FE03FF01FF00FF001F001F001F001F003
F003E007E00FC00FC03F807F00FF00FE00F80070000C1773AD27>I<0001C00003E0000F
E0001FE0003FC0007F8000FE0001FC0001F80003F80007F00007E0000FC0000FC0001F80
001F80003F00003F00003F00007E00007E00007E00007E0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00007E00007E00007E00007E00
003F00003F00003F00001F80001F80000FC0000FC00007E00007F00003F80001F80001FC
0000FE00007F80003FC0001FE0000FE00003E00001C0133A73B327>I<700000F80000FE
0000FF00007F80003FC0000FE00007F00003F00003F80001FC0000FC00007E00007E0000
3F00003F00001F80001F80001F80000FC0000FC0000FC0000FC00007E00007E00007E000
07E00007E00007E00007E00007E00007E00007E00007E00007E0000FC0000FC0000FC000
0FC0001F80001F80001F80003F00003F00007E00007E0000FC0001FC0003F80003F00007
F0000FE0003FC0007F8000FF0000FE0000F80000700000133A7AB327>I<000F0000001F
8000001F8000001F8000001F8000001F8000001F8000781F81E0FE1F87F0FF1F8FF0FFDF
BFF07FFFFFE03FFFFFC00FFFFF0003FFFC0000FFF00000FFF00003FFFC000FFFFF003FFF
FFC07FFFFFE0FFDFBFF0FF1F8FF0FE1F87F0781F81E0001F8000001F8000001F8000001F
8000001F8000001F8000000F00001C207BA627>I<0003C0000007E0000007E0000007E0
000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0
000007E0007FFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFE0007E0000007E0
000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0
000007E0000007E0000003C00020227DA727>I<0F003FC03FE07FF07FF07FF87FF83FF8
3FF80FF801F801F003F007E01FE07FC0FF80FF00FE0070000D14738927>I<7FFFFFF8FF
FFFFFCFFFFFFFCFFFFFFFCFFFFFFFC7FFFFFF81E067C9927>I<1E007F807F80FFC0FFC0
FFC0FFC07F807F801E000A0A728927>I<000000380000007C000000FC000000FC000001
FC000001F8000003F8000003F0000007F0000007E000000FE000000FC000001FC000001F
8000003F8000003F0000003F0000007F0000007E000000FE000000FC000001FC000001F8
000003F8000003F0000007F0000007E000000FE000000FC000000FC000001FC000001F80
00003F8000003F0000007F0000007E000000FE000000FC000001FC000001F8000003F800
0003F0000003F0000007F0000007E000000FE000000FC000001FC000001F8000003F8000
003F0000007F0000007E000000FE000000FC000000FC000000F8000000780000001E3A7C
B327>I<0007E000003FFC00007FFE0000FFFF0001FFFF8003FC3FC007F00FE00FE007F0
0FC003F01F8001F81F8001F83F0000FC3F0000FC3E00007C7E00007E7E00007E7E00007E
7C00003EFC00003FFC00003FFC00003FFC00003FFC00003FFC00003FFC00003FFC00003F
FC00003FFC00003FFC00003FFC00003F7E00007E7E00007E7E00007E7E00007E3F0000FC
3F0000FC3F8001FC1F8001F81FC003F80FC003F00FE007F007F00FE003FC3FC001FFFF80
00FFFF00007FFE00003FFC000007E00020307DAE27>I<000E0000001F0000001F000000
3F0000007F0000007F000000FF000001FF000003FF00007FFF0000FFFF0000FFFF0000FF
BF00007E3F0000003F0000003F0000003F0000003F0000003F0000003F0000003F000000
3F0000003F0000003F0000003F0000003F0000003F0000003F0000003F0000003F000000
3F0000003F0000003F0000003F0000003F0000003F0000003F0000003F0000003F000000
3F0000003F0000003F00003FFFFF807FFFFF807FFFFFC07FFFFF807FFFFF801A2F79AE27
>I<003FE00001FFF80003FFFE000FFFFF801FFFFFC03FE07FE03F800FE07F0007F07E00
03F8FE0001F8FC0001F8FE0001FCFE0000FCFE0000FCFE0000FC7C0000FC000000FC0000
00FC000001FC000001F8000001F8000003F8000003F0000007F000000FE000001FC00000
3FC000007F800000FF000001FE000003FC000007F800000FF000001FE000003FC000007F
800000FE000001FC000007F800780FF000FC1FE000FC3FC000FC7FFFFFFCFFFFFFFCFFFF
FFFCFFFFFFFC7FFFFFF81E2F7CAE27>I<001FF80000FFFE0003FFFF800FFFFFC00FFFFF
E01FF01FF03FC007F83F8001F83F8001FC3F8000FC3F8000FC1F0000FC040000FC000000
FC000001FC000001F8000003F8000007F000000FF000003FE0001FFFC0003FFF80003FFF
80003FFFE0001FFFF000001FF8000003FC000001FC000000FE0000007E0000007F000000
3F0000003F3800003F7C00003FFE00003FFE00003FFE00007FFC00007EFE0000FE7F0001
FC7F8003FC3FF01FF81FFFFFF00FFFFFE003FFFF8000FFFE00001FF80020307DAE27>I<
00003F800000007FC00000007FC0000000FFC0000001FFC0000001FFC0000003F7C00000
07E7C0000007E7C000000FC7C000000F87C000001F87C000003F07C000003F07C000007E
07C00000FC07C00000FC07C00001F807C00001F007C00003F007C00007E007C00007E007
C0000FC007C0001F8007C0001F8007C0003F0007C0003E0007C0007E0007C000FC0007C0
00FFFFFFFF80FFFFFFFFC0FFFFFFFFC0FFFFFFFFC07FFFFFFF80000007C000000007C000
000007C000000007C000000007C000000007C000000007C000000007C0000001FFFF0000
03FFFF800003FFFF800003FFFF800001FFFF00222F7EAE27>I<1FFFFFE03FFFFFF03FFF
FFF03FFFFFF03FFFFFE03F0000003F0000003F0000003F0000003F0000003F0000003F00
00003F0000003F0000003F0000003F0000003F0000003F1FF0003FFFFC003FFFFF003FFF
FF803FFFFFC03FF03FE03FC00FF03F0007F03E0003F81C0001F8000001F8000001FC0000
00FC000000FC000000FC7C0000FCFE0000FCFE0000FCFE0001FCFE0001F8FC0003F8FE00
03F07F000FF07F801FE03FE07FC01FFFFF800FFFFF0007FFFE0001FFF800007FC0001E2F
7CAD27>I<0000FF000007FFC0001FFFF0003FFFF800FFFFF801FF81FC03FE01FC03F801
FC07F001FC0FE001FC0FC000F81FC000003F8000003F0000003F0000007F0000007E0000
007E0FF800FE3FFE00FCFFFF80FFFFFFC0FFFFFFE0FFF80FF0FFE007F8FF8001FCFF0000
FCFF0000FEFE00007EFE00007FFE00003FFE00003FFE00003F7E00003F7E00003F7E0000
3F7F00003F3F00007F3F00007E1F8000FE1FC001FC0FC001FC0FF007F807F81FF003FFFF
E001FFFFC000FFFF80003FFE00000FF80020307DAE27>I<78000000FFFFFFFEFFFFFFFF
FFFFFFFFFFFFFFFFFFFFFFFEFC0001FCFC0003F8FC0007F0780007E000000FE000001FC0
00001F8000003F8000007F0000007E000000FE000000FC000001FC000001F8000003F800
0003F0000007F0000007E0000007E000000FC000000FC000000FC000001F8000001F8000
001F8000003F8000003F0000003F0000003F0000003F0000003F0000007F0000007E0000
007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000003C0000
20307DAE27>I<000FF000007FFE0001FFFF8003FFFFC00FFFFFF00FF81FF01FE007F83F
8001FC3F0000FC7F0000FE7E00007E7E00007E7E00007E7E00007E7E00007E3F0000FC3F
8001FC1FC003F80FE007F007FC3FE001FFFF80007FFE00003FFC0000FFFF0003FFFFC00F
F00FF01FC003F83F8001FC3F0000FC7E00007E7E00007EFC00003FFC00003FFC00003FFC
00003FFC00003FFC00003F7E00007E7E00007E7F0000FE3F8001FC1FE007F81FF81FF80F
FFFFF007FFFFE001FFFF80007FFE00000FF00020307DAE27>I<000FF000007FFC0001FF
FF0003FFFF8007FFFFC00FF81FE01FE007F03FC003F83F8001F87F0001FC7E0000FCFE00
00FCFC00007EFC00007EFC00007EFC00007EFC00007FFC00007FFC00007FFE00007F7E00
007F7F0000FF3F0000FF3F8001FF1FE007FF0FF01FFF07FFFFFF03FFFFFF01FFFF3F007F
FC7F001FF07E0000007E0000007E000000FC000000FC000001FC000001F81F0003F83F80
07F03F800FE03F801FE03F803FC03FC0FF801FFFFF001FFFFE000FFFF80003FFE00000FF
800020307DAE27>I<1E007F807F80FFC0FFC0FFC0FFC07F807F801E0000000000000000
00000000000000000000000000000000001E007F807F80FFC0FFC0FFC0FFC07F807F801E
000A20729F27>I<0F003FC03FC07FE07FE07FE07FE03FC03FC00F000000000000000000
000000000000000000000000000000000F003F803FC07FC07FE07FE07FE03FE03FE00FE0
07E007C00FC00FC03F807F00FF00FE00F80070000B2A739F27>I<00000038000000FC00
0001FC000007FC00000FFC00003FF800007FE00000FFC00003FF000007FE00001FF80000
3FF000007FE00001FF800003FF00000FFC00001FF800007FF00000FFC00000FF800000FF
800000FFC000007FF000001FF800000FFC000003FF000001FF8000007FE000003FF00000
1FF8000007FE000003FF000000FFC000007FE000003FF800000FFC000007FC000001FC00
0000FC000000381E287CAA27>I<7FFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF3FFF
FFFE0000000000000000000000000000000000000000000000003FFFFFFEFFFFFFFFFFFF
FFFFFFFFFFFFFFFFFFFF7FFFFFFE20127D9F27>I<70000000FC000000FE000000FF8000
00FFC000007FF000001FF800000FFC000003FF000001FF8000007FE000003FF000001FF8
000007FE000003FF000000FFC000007FE000003FF800000FFC000007FC000007FC00000F
FC00003FF800007FE00000FFC00003FF000007FE00001FF800003FF000007FE00001FF80
0003FF00000FFC00001FF800007FF00000FFC00000FF800000FE000000FC000000700000
001E287CAA27>I<00FFF80003FFFF000FFFFFC03FFFFFE07FFFFFF07FC01FF8FF0003FC
FE0001FCFE0000FCFE0000FCFE0001FC7C0003FC00000FF800001FF000007FE00000FFC0
0001FF000003FC000007F8000007F000000FE000000FC000001FC000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000000F0000000000000000000000000000
00000000000000000000000000000000000F0000001F8000003FC000003FC000003FC000
003FC000001F8000000F00001E2E7CAD27>I<0001FE000007FF80001FFFC0007FFFE000
FFFFF001FF03F803FC01F807F000FC0FE01F7C0FC07FFE1F80FFFE1F01FFFE3F03FFFE3E
07F1FF7E07E0FF7C0FC07F7C0F803F7C0F803FFC1F803FF81F001FF81F001FF81F001FF8
1F001FF81F001FF81F001FF81F001FF81F001FFC1F803F7C0F803E7C0F803E7C0FC07E7E
07E0FC3E07F1FC3F03FFF81F01FFF01F80FFE00FC07FC00FE01F1E07F0003F03FC007F01
FF03FF00FFFFFE007FFFFC001FFFF00007FFC00001FF00202E7DAD27>I<0003F0000000
07F800000007F80000000FFC0000000FFC0000000FFC0000000FFC0000000F3C0000001F
3E0000001F3E0000001F3E0000001F3E0000001F3E0000003F3F0000003F3F0000003F3F
0000003E1F0000003E1F0000007E1F8000007E1F8000007E1F8000007E1F800000FC0FC0
0000FC0FC00000FC0FC00000FC0FC00000FC0FC00001F807E00001F807E00001F807E000
01FFFFE00001FFFFE00003FFFFF00003FFFFF00003FFFFF00003F003F00003F003F00007
E001F80007E001F80007E001F80007E001F8000FE001FC007FFC0FFF80FFFC0FFFC0FFFE
1FFFC0FFFC0FFFC07FFC0FFF80222F7EAE27>I<7FFFFF0000FFFFFFC000FFFFFFE000FF
FFFFF8007FFFFFF80007E003FC0007E000FE0007E0007E0007E0007F0007E0003F0007E0
003F0007E0003F0007E0003F0007E0003F0007E0003F0007E0007E0007E0007E0007E000
FC0007E003FC0007E00FF80007FFFFF00007FFFFC00007FFFFF00007FFFFF80007FFFFFC
0007E000FE0007E0007F0007E0003F8007E0001F8007E0001F8007E0000FC007E0000FC0
07E0000FC007E0000FC007E0000FC007E0000FC007E0001FC007E0001F8007E0003F8007
E0007F0007E001FF007FFFFFFE00FFFFFFFC00FFFFFFF800FFFFFFE0007FFFFF8000222E
7FAD27>I<0003F80E001FFE1F003FFFBF00FFFFFF01FFFFFF03FE0FFF07F803FF07F001
FF0FE000FF1FC000FF1F80007F1F80007F3F00003F3F00003F7F00003F7E00003F7E0000
1E7E000000FE000000FC000000FC000000FC000000FC000000FC000000FC000000FC0000
00FC000000FC000000FC000000FE0000007E0000007E0000007E00001E7F00003F3F0000
3F3F00003F1F80003F1F80007F1FC0007E0FE000FE07F001FC07F803FC03FE0FF801FFFF
F000FFFFE0003FFFC0001FFF000003F80020307DAE27>I<7FFFFC00007FFFFF0000FFFF
FFC0007FFFFFE0007FFFFFF00007E00FF80007E007F80007E001FC0007E000FE0007E000
FE0007E0007E0007E0007F0007E0003F0007E0003F8007E0001F8007E0001F8007E0001F
8007E0001FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC0
07E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0001F8007E0001F8007
E0001F8007E0003F8007E0003F0007E0003F0007E0007F0007E000FE0007E000FE0007E0
01FC0007E003F80007E00FF8007FFFFFF0007FFFFFE000FFFFFFC0007FFFFF00007FFFFC
0000222E7FAD27>I<7FFFFFFF80FFFFFFFFC0FFFFFFFFC0FFFFFFFFC07FFFFFFFC007E0
000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E000078007E000
000007E000000007E000000007E000000007E007800007E00FC00007E00FC00007E00FC0
0007FFFFC00007FFFFC00007FFFFC00007FFFFC00007FFFFC00007E00FC00007E00FC000
07E00FC00007E007800007E000000007E000000007E000000007E000000007E00003C007
E00007E007E00007E007E00007E007E00007E007E00007E007E00007E007E00007E07FFF
FFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE07FFFFFFFC0232E7FAD27>I<7FFFFFFF80FF
FFFFFFC0FFFFFFFFC0FFFFFFFFC07FFFFFFFC007E0000FC007E0000FC007E0000FC007E0
000FC007E0000FC007E0000FC007E000078007E000000007E000000007E000000007E000
000007E007800007E00FC00007E00FC00007E00FC00007FFFFC00007FFFFC00007FFFFC0
0007FFFFC00007FFFFC00007E00FC00007E00FC00007E00FC00007E007800007E0000000
07E000000007E000000007E000000007E000000007E000000007E000000007E000000007
E000000007E000000007E000000007E00000007FFF800000FFFFC00000FFFFC00000FFFF
C000007FFF800000222E7EAD27>I<0007F03800001FFC7C00007FFFFC0000FFFFFC0001
FFFFFC0003FC1FFC0007F00FFC000FE007FC000FC003FC001FC001FC001F8001FC003F80
01FC003F0000FC003F0000FC007E0000FC007E0000FC007E000078007E00000000FC0000
0000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC000000
00FC001FFF00FC003FFF80FC003FFF80FC003FFF807E001FFF007E0000FC007E0000FC00
7E0000FC003F0001FC003F0001FC003F8001FC001F8001FC001FC003FC000FC003FC000F
E007FC0007F00FFC0003FC1FFC0001FFFFFC0000FFFFFC00007FFEFC00001FFC78000007
F0000021307DAE27>I<7FFE07FFE0FFFF0FFFF0FFFF0FFFF0FFFF0FFFF07FFE07FFE007
E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0
007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E000
7E0007FFFFFE0007FFFFFE0007FFFFFE0007FFFFFE0007FFFFFE0007E0007E0007E0007E
0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E00
07E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E007F
FE07FFE0FFFF0FFFF0FFFF0FFFF0FFFF0FFFF07FFE07FFE0242E7FAD27>I<7FFFFFE0FF
FFFFF0FFFFFFF0FFFFFFF07FFFFFE0001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F80007FFFFFE0FFFFFFF0FFFFFFF0FFFFFFF07FFFFFE01C
2E7BAD27>I<001FFFF8003FFFFC003FFFFC003FFFFC001FFFF800001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F807C001F807C001F80FE001F80FE001F80FE003F00FE007F007F81FE007FFFFE003FFF
FC001FFFF80007FFE00000FF00001E2F7BAD27>I<7FFC07FF807FFC07FFC0FFFE0FFFC0
7FFC07FFC07FFC07FF8007C001F80007C003F80007C003F00007C007E00007C00FC00007
C01FC00007C01F800007C03F000007C07E000007C0FE000007C0FC000007C1F8000007C3
F0000007C7F0000007C7E0000007CFF0000007DFF8000007FFF8000007FFFC000007FEFC
000007FC7E000007FC3E000007F83F000007F01F000007E01F800007E00F800007C00FC0
0007C007C00007C007E00007C003E00007C003F00007C001F80007C001F80007C000FC00
07C0007C0007C0007E007FFC01FFC07FFC01FFE0FFFE03FFE07FFC01FFE07FFC01FFC023
2E7FAD27>I<7FFFC000007FFFE00000FFFFE000007FFFE000007FFFC0000003F0000000
03F000000003F000000003F000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000000003F000000003F000078003F0000F
C003F0000FC003F0000FC003F0000FC003F0000FC003F0000FC003F0000FC07FFFFFFFC0
7FFFFFFFC0FFFFFFFFC07FFFFFFFC07FFFFFFF80222E7FAD27>I<7FE0007FE0FFF000FF
F0FFF000FFF0FFF801FFF07FF801FFE00FF801FF000FB801DF000FBC03DF000FBC03DF00
0FBC03DF000FBE07DF000F9E079F000F9E079F000F9E079F000F9F0F9F000F9F0F9F000F
8F0F1F000F8F0F1F000F8F9F1F000F8F9F1F000F879E1F000F879E1F000F879E1F000F87
9E1F000F839C1F000F83FC1F000F83FC1F000F83FC1F000F81F81F000F81F81F000F80F0
1F000F80001F000F80001F000F80001F000F80001F000F80001F000F80001F000F80001F
000F80001F000F80001F000F80001F007FF000FFE0FFF801FFF0FFF801FFF0FFF801FFF0
7FF000FFE0242E7FAD27>I<7FF003FFE0FFF807FFF0FFF807FFF0FFFC07FFF07FFC03FF
E007FC003E0007DE003E0007DE003E0007DE003E0007CF003E0007CF003E0007CF003E00
07CF803E0007C7803E0007C7C03E0007C7C03E0007C3C03E0007C3E03E0007C3E03E0007
C1E03E0007C1F03E0007C1F03E0007C1F03E0007C0F83E0007C0F83E0007C0F83E0007C0
783E0007C07C3E0007C07C3E0007C03C3E0007C03E3E0007C03E3E0007C01E3E0007C01F
3E0007C00F3E0007C00F3E0007C00F3E0007C007BE0007C007BE0007C007BE0007C003FE
007FFC03FE00FFFE03FE00FFFE01FE00FFFE01FE007FFC00FC00242E7FAD27>I<00FFFC
0007FFFF801FFFFFE01FFFFFE03FFFFFF03FC00FF07F8007F87F0003F87E0001F87E0001
F87E0001F8FC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000
FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000
FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFE0001
FC7E0001F87E0001F87E0001F87F0003F87F8007F83FE01FF03FFFFFF01FFFFFE01FFFFF
E007FFFF8000FFFC001E307CAE27>I<7FFFFF0000FFFFFFE000FFFFFFF000FFFFFFF800
7FFFFFFC0007E003FE0007E000FF0007E0007F0007E0003F8007E0001F8007E0001FC007
E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0001FC007E0
001F8007E0003F8007E0007F0007E000FF0007E003FE0007FFFFFC0007FFFFF80007FFFF
F00007FFFFE00007FFFF000007E000000007E000000007E000000007E000000007E00000
0007E000000007E000000007E000000007E000000007E000000007E000000007E0000000
07E00000007FFE000000FFFF000000FFFF000000FFFF0000007FFE000000222E7FAD27>
I<00FFFC0007FFFF801FFFFFE01FFFFFE03FFFFFF03FE01FF07F8007F87F0003F87E0001
F87E0001F87E0001F8FE0001FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000
FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000
FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC07E0FCFC07E0
FCFE07F1FC7E07F1F87E03F9F87E03F9F87F01FFF87F81FFF83FE0FFF03FFFFFF01FFFFF
E01FFFFFE007FFFF8000FFFF8000001FC000001FC000000FE000000FE0000007F0000007
F0000003F8000003F8000001F01E397CAE27>I<7FFFF00000FFFFFE0000FFFFFF8000FF
FFFFC0007FFFFFE00007E01FF00007E007F00007E003F80007E001F80007E001FC0007E0
00FC0007E000FC0007E000FC0007E000FC0007E000FC0007E001FC0007E001F80007E003
F80007E007F00007E01FF00007FFFFE00007FFFFC00007FFFF800007FFFF800007FFFFC0
0007E01FC00007E00FE00007E007E00007E003F00007E003F00007E003F00007E003F000
07E003F00007E003F00007E003F00007E003F00007E003F0F007E003F1F807E003F1F807
E003F1F807E003F1F87FFE01FBF8FFFF01FFF0FFFF00FFF0FFFF00FFE07FFE007FC00000
001F00252F7FAD27>I<007FC0E001FFF1F007FFFFF00FFFFFF01FFFFFF03FE0FFF03F80
1FF07F000FF07E0007F0FE0007F0FC0007F0FC0003F0FC0003F0FC0003F0FC0001E0FE00
00007E0000007F0000003FC000003FF800001FFF80000FFFF80007FFFE0003FFFF8000FF
FFC0000FFFE00000FFF000000FF0000007F8000003F8000001F8000001FC000000FC7800
00FCFC0000FCFC0000FCFC0000FCFC0000FCFE0001F8FE0001F8FF0003F8FF8007F0FFF0
1FE0FFFFFFE0FFFFFFC0FFFFFF00F8FFFE00701FF8001E307CAE27>I<7FFFFFFF80FFFF
FFFFC0FFFFFFFFC0FFFFFFFFC0FFFFFFFFC0FC03F00FC0FC03F00FC0FC03F00FC0FC03F0
0FC0FC03F00FC0FC03F00FC07803F007800003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000000003F000000003F000000003F00000
0003F000000003F000000003F000000003F000000003F000000003F000000003F0000000
03F000000003F000000003F000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F0000000FFFFC00001FFFFE00001FFFFE00001FFFF
E00000FFFFC000222E7EAD27>I<7FFE01FFF8FFFF03FFFCFFFF03FFFCFFFF03FFFC7FFE
01FFF807E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E000
1F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F
8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F80
07E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007E0001F8007
E0001F8007F0003F8003F0003F0003F0003F0003F8007F0001F8007E0001FC00FE0000FE
01FC00007F87F800007FFFF800003FFFF000000FFFC0000007FF80000001FE0000262F80
AD27>I<7FFC03FFE07FFE07FFE0FFFE07FFF07FFE07FFE07FFC03FFE007E0007E0007E0
007E0007E0007E0007E0007E0003F000FC0003F000FC0003F000FC0003F000FC0003F801
FC0001F801F80001F801F80001F801F80001F801F80000FC03F00000FC03F00000FC03F0
0000FC03F000007E07E000007E07E000007E07E000007E07E000007E07E000003F0FC000
003F0FC000003F0FC000003F0FC000001F0F8000001F9F8000001F9F8000001F9F800000
0F9F0000000F9F0000000F9F0000000F9F0000000F9F00000007FE00000007FE00000007
FE00000007FE00000003FC00000003FC00000001F80000242F7FAD27>I<7FE0007FE0FF
F000FFF0FFF000FFF0FFF000FFF07FE0007FE01F00000F801F00000F801F00000F801F00
000F801F00000F801F00000F801F00000F800F80001F000F80001F000F80001F000F8000
1F000F80001F000F80001F000F80F01F000F81F81F0007C3FC3E0007C3FC3E0007C3FC3E
0007C3FC3E0007C39C3E0007C79E3E0007C79E3E0007C79E3E0003C79E3C0003C79E3C00
03C79E3C0003E79E7C0003EF9F7C0003EF9F7C0003EF0F7C0003EF0F7C0001EF0F780001
EF0F780001EF0F780001EF0F780001FE07F80001FE07F80001FE07F80000FE07F00000FE
07F00000FC03F000007801E000242F7FAD27>I<3FFC1FFE007FFE3FFE007FFE3FFF007F
FE3FFE003FFC1FFE0003F00FE00003F80FC00001F80FC00001FC1FC00000FC1F800000FE
3F8000007E3F0000007F7F0000003F7E0000003FFE0000001FFC0000001FFC0000000FF8
0000000FF800000007F000000007F000000003F000000007F000000007F80000000FF800
00000FFC0000001FFC0000001FFE0000003F7E0000003F7F0000007F3F0000007E3F8000
007E1F800000FC1FC00000FC0FC00001F80FE00001F807E00003F807E00003F003F00007
F003F00007E003F8007FFC0FFF80FFFC0FFFC0FFFE1FFFC0FFFC0FFFC07FFC0FFF80222E
7EAD27>I<7FFC03FFE07FFE07FFE0FFFE07FFF07FFE07FFE07FFC03FFE007F000FE0003
F000FC0003F801FC0001F801F80001F801F80001FC03F80000FC03F00000FE07F000007E
07E000007E07E000003F0FC000003F0FC000001F9F8000001F9F8000001F9F8000000F9F
0000000F9F00000007FE00000007FE00000003FC00000003FC00000001F800000001F800
000001F800000001F800000001F800000001F800000001F800000001F800000001F80000
0001F800000001F800000001F800000001F800000001F800000001F80000001FFF800000
3FFFC000003FFFC000003FFFC000001FFF8000242E7FAD27>I<3FFFFFFE7FFFFFFF7FFF
FFFF7FFFFFFF7FFFFFFF7E0000FE7E0001FC7E0001FC7E0003F87E0007F07E0007F03C00
0FE000001FC000001FC000003F8000007F0000007F000000FE000000FC000001FC000003
F8000003F0000007F000000FE000000FC000001FC000003F8000003F0000007F000000FE
000000FE000001FC000003F8001E03F8003F07F0003F0FE0003F0FE0003F1FC0003F3F80
003F3F80003F7F00003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFE202E7DAD27>
I<7FFFF0FFFFF8FFFFF8FFFFF8FFFFF0FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FFFFF0FFFFF8FFFFF8FFFFF87FFFF0153A71B327
>I<78000000F8000000FC000000FC000000FE0000007E0000007F0000003F0000003F80
00001F8000001FC000000FC000000FE0000007E0000007F0000003F0000003F0000003F8
000001F8000001FC000000FC000000FE0000007E0000007F0000003F0000003F8000001F
8000001FC000000FC000000FC000000FE0000007E0000007F0000003F0000003F8000001
F8000001FC000000FC000000FE0000007E0000007F0000003F0000003F0000003F800000
1F8000001FC000000FC000000FE0000007E0000007F0000003F0000003F8000001F80000
01FC000000FC000000FC0000007C000000381E3A7CB327>I<7FFFF0FFFFF8FFFFF8FFFF
F87FFFF80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F87FFFF8FFFFF8FFFFF8FFFFF87FFFF0153A7EB327>I<001C00007E0001FF8007
FFE01FFFF83FFFFCFFE7FFFFC3FFFF00FFFC003F78001E180B79AD27>I<7FFFFFF8FFFF
FFFCFFFFFFFCFFFFFFFCFFFFFFFC7FFFFFF81E067C7E27>I<00E001F007F00FF00FE01F
C03F003F007E007C00FC00F800F800F800F800FF00FF80FFC07FC07FC03FC03F800F000C
1773B227>I<03FFC000000FFFF000001FFFFC00003FFFFF00003FFFFF80003F80FF8000
3F801FC0001F000FC00004000FE000000007E000000007E000000FFFE000007FFFE00003
FFFFE0000FFFFFE0001FFFFFE0003FFC07E0007FC007E0007F0007E000FE0007E000FC00
07E000FC0007E000FC0007E000FC0007E000FE000FE0007F001FE0007FC0FFE0003FFFFF
FF801FFFFFFFC00FFFFFFFC003FFF1FFC000FF807F8022207C9F27>I<7FE0000000FFF0
000000FFF0000000FFF00000007FF000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000000003F000000003F0FF000003F3FFC0
0003FFFFF00003FFFFF80003FFFFFC0003FF81FE0003FE00FF0003FC003F8003F8001F80
03F8001FC003F0000FC003F0000FC003F0000FE003F00007E003F00007E003F00007E003
F00007E003F00007E003F00007E003F0000FE003F0000FC003F8000FC003F8001FC003FC
003F8003FC007F8003FE00FF0003FF83FE0003FFFFFC0003FFFFF80003FFFFF00003F3FF
C00001E0FE0000232E7FAD27>I<000FFF00007FFFC001FFFFE003FFFFF007FFFFF00FF8
07F01FE007F03FC003E03F8000807F0000007E0000007E000000FE000000FC000000FC00
0000FC000000FC000000FC000000FC000000FE0000007E0000007E0000007F0000F03F80
01F83FC001F81FE003F80FF80FF007FFFFF003FFFFE001FFFFC0007FFF00000FF8001D20
7B9F27>I<00003FF00000007FF80000007FF80000007FF80000003FF800000001F80000
0001F800000001F800000001F800000001F800000001F800000001F800000001F8000000
01F800000FE1F800007FFDF80001FFFFF80003FFFFF80007FFFFF8000FF83FF8001FE00F
F8003FC007F8003F8003F8007F0003F8007E0001F8007E0001F800FE0001F800FC0001F8
00FC0001F800FC0001F800FC0001F800FC0001F800FC0001F800FE0001F8007E0003F800
7E0003F8007F0003F8003F0007F8003F800FF8001FE01FF8000FF03FF80007FFFFFFC003
FFFFFFE001FFFDFFE0007FF9FFE0001FE0FFC0232E7EAD27>I<000FF800003FFE0000FF
FF8003FFFFC007FFFFE00FFC0FF01FE003F81FC001F83F8001FC7F0000FC7E0000FC7E00
007EFE00007EFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFCFC000000FE0000007E00
00007F0000003F00003C3F80007E1FC0007E1FF000FE0FFC07FC07FFFFFC01FFFFF800FF
FFF0003FFFC00007FE001F207D9F27>I<00001FF00000FFF80001FFFC0003FFFE0007FF
FE000FF0FE000FC0FE001FC07C001F8000001F8000001F8000001F8000001F8000001F80
007FFFFFF0FFFFFFF8FFFFFFF8FFFFFFF87FFFFFF0001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
003FFFFFC07FFFFFE07FFFFFE07FFFFFE03FFFFFC01F2E7EAD27>I<0000003F00001FC0
FF80007FF3FFC001FFFFFFE003FFFFFFE007FFFFEFE00FF07F87E01FC01FC3C01FC01FC0
001F800FC0003F0007E0003F0007E0003F0007E0003F0007E0003F0007E0003F0007E000
1F800FC0001FC01FC0001FC01FC0000FF07F80000FFFFF00000FFFFE00001FFFFC00001F
7FF000001F1FC000001F000000001F000000001F800000000FFFFF00000FFFFFE0000FFF
FFF8001FFFFFFE003FFFFFFF003F8001FF007E00003F807C00000F80FC00000FC0F80000
07C0F8000007C0F8000007C0F8000007C0FC00000FC07C00000F807F00003F803F80007F
003FF807FF001FFFFFFE0007FFFFF80003FFFFF00000FFFFC000000FFC000023337EA027
>I<7FE0000000FFF0000000FFF0000000FFF00000007FF000000003F000000003F00000
0003F000000003F000000003F000000003F000000003F000000003F000000003F0000000
03F07F000003F1FFC00003F7FFF00003FFFFF00003FFFFF80003FFC1F80003FF01FC0003
FE00FC0003FC00FC0003F800FC0003F800FC0003F000FC0003F000FC0003F000FC0003F0
00FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000
FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC007FFF83FFE0FFFFC7FF
F0FFFFC7FFF0FFFFC7FFF07FFF83FFE0242E7FAD27>I<000F0000001F8000003FC00000
3FC000003FC000003FC000001F8000000F00000000000000000000000000000000000000
00000000000000000000003FFF80007FFFC0007FFFC0007FFFC0003FFFC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC0007FFFFFF0FFFFFFF0FFFFFFF8FFFFFFF07FFFFFF01D2F7BAE27
>I<00003C00007E0000FF0000FF0000FF0000FF00007E00003C00000000000000000000
000000000000000000000001FFFE03FFFF03FFFF03FFFF01FFFF00003F00003F00003F00
003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00
003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00
003F00003F00003F00003F00003F00003F00003F00007E38007E7C00FEFE01FCFE03FCFF
FFF8FFFFF07FFFE03FFF8007FE0018407CAE27>I<7FE00000007FF0000000FFF0000000
7FF00000007FF000000001F000000001F000000001F000000001F000000001F000000001
F000000001F000000001F000000001F000000001F03FFFC001F07FFFE001F07FFFE001F0
7FFFE001F03FFFC001F003F80001F007F00001F00FE00001F01FC00001F03F800001F0FF
000001F1FE000001F3FC000001F7F8000001FFFC000001FFFE000001FFFF000001FF3F00
0001FE1F800001FC0FC00001F80FE00001F007E00001F003F00001F001F80001F001FC00
01F000FE0001F0007E007FFFC1FFF07FFFC3FFF8FFFFE3FFF87FFFC3FFF87FFFC3FFF025
2E80AD27>I<7FFF8000FFFFC000FFFFC000FFFFC0007FFFC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC0007FFFFFF8FFFFFFFCFFFF
FFFCFFFFFFFC7FFFFFF81E2E7CAD27>I<7F07C01F0000FF9FF07FC000FFFFF9FFE000FF
FFFFFFF0007FFFFFFFF0000FFC7FF1F8000FF03FC0F8000FE03F80F8000FC03F00F8000F
C03F00F8000FC03F00F8000F803E00F8000F803E00F8000F803E00F8000F803E00F8000F
803E00F8000F803E00F8000F803E00F8000F803E00F8000F803E00F8000F803E00F8000F
803E00F8000F803E00F8000F803E00F8000F803E00F8000F803E00F8000F803E00F8007F
F0FFC3FF00FFF8FFE3FF80FFF9FFE7FF80FFF8FFE3FF807FF0FFC3FF002920819F27>I<
7FE07F0000FFF1FFC000FFF7FFF000FFFFFFF0007FFFFFF80003FFC1F80003FF01FC0003
FE00FC0003FC00FC0003F800FC0003F800FC0003F000FC0003F000FC0003F000FC0003F0
00FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000
FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC007FFF83FFE0FFFFC7FF
F0FFFFC7FFF0FFFFC7FFF07FFF83FFE024207F9F27>I<001FE000007FF80001FFFE0003
FFFF0007FFFF800FF03FC01FC00FE03F8007F03F0003F07F0003F87E0001F87E0001F8FC
0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFE0001FC7E0001F87E
0001F87F0003F83F8007F03F8007F01FE01FE00FF03FC007FFFF8003FFFF0001FFFE0000
7FF800001FE0001E207C9F27>I<7FE0FF0000FFF3FFC000FFFFFFF000FFFFFFF8007FFF
FFFC0003FF81FE0003FE00FF0003FC003F8003F8001F8003F8001FC003F0000FC003F000
0FC003F0000FE003F00007E003F00007E003F00007E003F00007E003F00007E003F00007
E003F0000FE003F0000FC003F8000FC003F8001FC003FC003F8003FC007F8003FE00FF00
03FF83FE0003FFFFFC0003FFFFF80003FFFFF00003F3FFC00003F0FE000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F00000007FFF800000FFFFC00000FFFFC00000FFFFC0
00007FFF80000023317F9F27>I<000FF03C00003FFE7E0000FFFF7E0003FFFFFE0007FF
FFFE000FFC1FFE001FE007FE001FC003FE003F8001FE007F0000FE007E0000FE007E0000
FE00FE00007E00FC00007E00FC00007E00FC00007E00FC00007E00FC00007E00FC00007E
00FE00007E007E0000FE007E0000FE007F0001FE003F8001FE003FC003FE001FE007FE00
0FF81FFE0007FFFFFE0003FFFFFE0001FFFF7E00007FFC7E00000FF07E000000007E0000
00007E000000007E000000007E000000007E000000007E000000007E000000007E000000
007E000000007E000000007E000000007E0000001FFFF800001FFFF800003FFFFC00001F
FFF800001FFFF826317E9F27>I<7FFC03FC00FFFE0FFF00FFFE3FFF80FFFE7FFFC07FFE
FFFFC0007FFE1FC0007FF81FC0007FF00F80007FE00200007FC00000007F800000007F80
0000007F000000007F000000007E000000007E000000007E000000007E000000007E0000
00007E000000007E000000007E000000007E000000007E000000007E000000007E000000
007E0000007FFFFF8000FFFFFFC000FFFFFFC000FFFFFFC0007FFFFF800022207E9F27>
I<00FFF38007FFFFC01FFFFFC03FFFFFC07FFFFFC07F803FC0FC000FC0F8000FC0F8000F
C0F8000780FC0000007F8000007FFC00003FFFF0001FFFFC0007FFFF0001FFFF80000FFF
C000003FE0000007E0780003F0FC0001F0FC0001F0FE0001F0FE0003F0FF0007E0FFE01F
E0FFFFFFC0FFFFFF80FFFFFF00FBFFFC00707FF0001C207B9F27>I<003C0000007E0000
007E0000007E0000007E0000007E0000007E0000007E0000007E00007FFFFFF0FFFFFFF8
FFFFFFF8FFFFFFF87FFFFFF0007E0000007E0000007E0000007E0000007E0000007E0000
007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0018
007E007E007E007E007E007E007E007E007E00FE003F00FC003F83FC003FFFF8001FFFF0
000FFFE00003FFC00000FF001F297EA827>I<7FE01FF800FFF03FFC00FFF03FFC00FFF0
3FFC007FF01FFC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000
FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC
0003F000FC0003F000FC0003F000FC0003F000FC0003F000FC0003F001FC0003F001FC00
03F003FC0003FC0FFC0001FFFFFFE001FFFFFFF000FFFFFFF0003FFEFFF0000FF87FE024
207F9F27>I<7FFC0FFF80FFFE1FFFC0FFFE1FFFC0FFFE1FFFC07FFC0FFF8007C000F800
07E001F80003E001F00003E001F00003F003F00001F003E00001F003E00001F807E00000
F807C00000F807C00000F807C000007C0F8000007C0F8000007C0F8000003E1F0000003E
1F0000003E1F0000003F3F0000001F3E0000001F3E0000001FFE0000000FFC0000000FFC
0000000FFC00000007F800000007F800000003F0000022207E9F27>I<7FFE07FFE0FFFE
07FFF0FFFF0FFFF0FFFE07FFF07FFE07FFE00F80001F000F80001F000F80001F000FC000
3F0007C0003E0007C0003E0007C0003E0007C0003E0007C0F03E0007C1F83E0003E3FC7C
0003E3FC7C0003E3FC7C0003E3FC7C0003E79E7C0003E79E7C0001E79E780001E79E7800
01E79E780001F79EF80001F79EF80001FF0FF80000FF0FF00000FF0FF00000FF0FF00000
FE07F000007C03E00024207F9F27>I<3FFC1FFF007FFE3FFF007FFE3FFF807FFE3FFF00
3FFC1FFF0001F807E00000FC0FC00000FC1F8000007E1F0000003F3F0000001F7E000000
1FFC0000000FF800000007F800000003F000000003E000000003F000000007F80000000F
F80000001FFC0000001F3E0000003E3F0000007E1F0000007C0F800000F80FC00001F807
E00003F003E0007FFE1FFF807FFE1FFF80FFFF3FFFC07FFE1FFF807FFE1FFF8022207E9F
27>I<7FFC0FFF80FFFE1FFFC0FFFE1FFFC0FFFE1FFFC07FFC0FFF8007E000F80003E001
F80003E001F00003F001F00001F003F00001F803E00000F803E00000F803E00000FC07C0
00007C07C000007C07C000007E0F8000003E0F8000003E0F8000001F0F0000001F1F0000
001F1F0000000F1F0000000F9E0000000FBE00000007BE00000007FC00000003FC000000
03FC00000003F800000001F800000001F800000001F000000001F000000003F000000003
E000000003E000000007E000000007C000000807C000003E0FC000007F0F8000007F1F80
00007E7F0000007FFE0000003FFC0000003FF80000001FF000000007C000000022317E9F
27>I<1FFFFFFE3FFFFFFF3FFFFFFF3FFFFFFF3FFFFFFF3F0001FE3F0003FC3F0007F83F
000FF01E001FE000003FC000007F800000FF000001FE000003FC000007F800001FE00000
3FC000007F800000FF000001FE000003FC001E07F8003F0FF0003F1FE0003F3FC0003F7F
80003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFE20207E9F27>I<000007F80000
3FFC0000FFFC0003FFFC0003FFF80007FE00000FF000000FE000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000001FC000007F80003FFF8000FFFF0000FFFE
0000FFFE0000FFFF00003FFF8000007F8000001FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FE000000FF0000007FE000003FFF80003FFFC0000
FFFC00003FFC000007F81E3A7CB327>I<78FCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC
FCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC
FCFC78063A70B327>I<7F800000FFF00000FFFC0000FFFF00007FFF000001FF8000003F
C000001FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
E0000007F8000007FFF00003FFFC0001FFFC0001FFFC0003FFFC0007FFF00007F800000F
E000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000F
C000000FC000000FC000000FC000000FC000000FC000000FC000000FC000001FC000003F
C00001FF80007FFF0000FFFF0000FFFC0000FFF000007F8000001E3A7CB327>I<01F003
8003FC07C00FFC0FC01FFE1FC03FFF7F807FBFFF00FE1FFE00FC0FFC00F80FF0007003E0
001A0A7AAD27>I E /Fj 55 123 df<00000007F8003E000000001FFF00FF800000007E
0783E3C0000000F803C7C1E0000001F00FC787E0000003E00FCF87E0000003E00FCF87E0
000007C00F9F07C0000007C0071F0380000007C0001F000000000F80001F000000000F80
003E000000000F80003E000000000F80003E000000001F80003E000000001F00007E0000
00001F00007C000000001F00007C000000001F00007C000000003F00007C000000003E00
007C0000001FFFFFFFFFF800001FFFFFFFFFF800001FFFFFFFFFF80000007E0000F80000
00007C0000F8000000007C0001F8000000007C0001F0000000007C0001F000000000FC00
01F000000000F80001F000000000F80003F000000000F80003E000000000F80003E00000
0001F80003E000000001F00003E000000001F00007E000000001F00007C000000001F000
07C000000001F00007C000000003F00007C000000003E0000FC000000003E0000F800000
0003E0000F8000000003E0000F8000000007E0000F8000000007C0001F8000000007C000
1F0000000007C0001F000000000FC0001F000000000FC0001F000000000F80003F000000
000F80003E000000000F80003E000000001F80003E000000001F00007E000000001F0000
7C000000001F00007C000000003E00007C000000003E0000F8000000383E1C00F8000000
7E3C3F00F00000007E3C3F01F0000000FE787F03E0000000FC787E03C0000000F8F03C07
8000000078E03C1F000000003FC01FFC000000000F0003F0000000003B4582B42F>11
D<00000003FF800000001FFFF00000003F00F8000000F8003C000001F0003E000003E000
7E000003E000FE000007C000FE000007C000FC000007C0003800000F80000000000F8000
0000000F80000000001F80000000001F00000000001F00000000001F00000000001F0000
0000001F00000000003F00000000003E000000001FFFFFFFE0001FFFFFFFE0001FFFFFFF
C000007E0007C000007C0007C000007C000FC000007C000F8000007C000F800000FC000F
800000F8001F800000F8001F000000F8001F000000F8001F000001F8003F000001F0003E
000001F0003E000001F0003E000001F0007E000003F0007C000003E0007C000003E0007C
180003E000FC1C0003E000F83C0007E000F8380007C000F8380007C000F8780007C000F8
700007C000F070000FC000F0F0000F8000F8E0000F800079E0000F80003FC0001F80000F
00001F80000000001F00000000001F00000000001F00000000003E00000000003E000000
00383E000000007E3C000000007E7C00000000FE7800000000FC7800000000F8F0000000
0079E0000000003FC0000000000F00000000002F4582B42B>I<00000003FE0000000000
1FFFC7C00000007E03EFC0000000F800FF80000001F003FF80000003E003FF80000003E0
03FF80000007C003FF00000007C001DF00000007C0001F0000000F80003F0000000F8000
3E0000000F80003E0000000F80003E0000001F80007E0000001F00007C0000001F00007C
0000001F00007C0000001F0000FC0000003F0000F80000003E0000F800001FFFFFFFF800
001FFFFFFFF800001FFFFFFFF00000007E0001F00000007C0001F00000007C0003F00000
007C0003E00000007C0003E0000000FC0003E0000000F80007E0000000F80007C0000000
F80007C0000000F80007C0000001F8000FC0000001F0000F80000001F0000F80000001F0
000F80000001F0001F80000003F0001F00000003E0001F00000003E0001F06000003E000
3F07000003E0003E0F000007E0003E0E000007E0003E0E000007C0003E1E000007C0003E
1C000007C0003C1C00000FC0003C3C00000F80003E3800000F80001E7800000F80000FF0
00000F800003C000001F8000000000001F0000000000001F0000000000001F0000000000
003E0000000000003E0000000000383E00000000007E3C00000000007E7C0000000000FE
780000000000FC780000000000F8F0000000000078E000000000003FC000000000000F00
0000000000324582B42D>I<00000060000001E0000003C00000070000000E0000001C00
00003C00000078000000F0000001E0000003C0000007C00000078000000F0000001F0000
001E0000003C0000007C00000078000000F8000000F0000001F0000001E0000003E00000
03C0000007C0000007C00000078000000F8000000F8000000F0000001F0000001F000000
1E0000003E0000003E0000003E0000003C0000007C0000007C0000007C00000078000000
78000000F8000000F8000000F8000000F0000000F0000000F0000000F0000000F0000000
F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000
F000000070000000780000007800000038000000380000003C0000001C0000001C000000
0E0000000E0000000700000003800000018000001B4A75B71F>40
D<00003000000038000000380000001C0000000E0000000E0000000F0000000700000007
800000078000000380000003C0000003C0000003C0000003C0000001C0000001E0000001
E0000001E0000001E0000001E0000001E0000001E0000001E0000003E0000003E0000003
E0000003E0000003C0000003C0000003C0000007C0000007C0000007C00000078000000F
8000000F8000000F8000000F0000001F0000001F0000001F0000001E0000003E0000003E
0000003C0000007C0000007C000000F8000000F8000000F0000001F0000001E0000003E0
000003C0000007C00000078000000F8000000F0000001E0000003E0000003C0000007800
0000F0000001E0000001E0000003C00000078000000F0000001E0000003C000000700000
00E0000000C00000001B4A7EB71F>I<000060000000F0000001E0000001E0000001E000
0001C0000001C0000E01C0301F0380F01F8383F01FC387E007E31F8003F33E0000FFF800
003FE000001F8000001F8000007FC00001FFF00007CCFC001F8C7E007E1C3F80FC1C1F80
F01C0F80C0380700003800000038000000780000007800000078000000F0000000600000
1C2071B727>I<03800FE01FE01FE01FE01FE01FE00760006000E000C000C001C0018003
80070006000E001C0038007000E000C0000B177A8718>44 D<FFFF80FFFF80FFFF80FFFF
807FFF00110579911B>I<1C7FFFFFFFFFFE380808778718>I<000000001C00000000003C
00000000003C00000000007C0000000000FC0000000000FC0000000001FC0000000001FE
0000000003FE0000000003FE00000000077E000000000F7E000000000E7E000000001C7E
000000001C7E00000000387E00000000387E00000000707E00000000F07E00000000E07E
00000001C07E00000001C07E00000003807F00000003803F00000007003F00000007003F
0000000E003F0000001E003F0000001C003F00000038003F00000038003F00000070003F
00000070003F000000E0003F000001FFFFFF000001FFFFFF000003FFFFFF00000380003F
00000700001F80000700001F80000E00001F80001E00001F80001C00001F80003C00001F
80003800001F80007000001F8000F000001F8000E000001F8001E000001F8003E000001F
800FF000003FC0FFFE0007FFFEFFFE0007FFFEFFFE0007FFFE2F367BB539>65
D<0007FFFFFFC000000FFFFFFFF000000FFFFFFFFC0000003F8000FE0000003F80007F00
00003F80003F8000003F00001F8000003F00001F8000007F00001FC000007F00001FC000
007E00001FC000007E00001FC00000FE00001FC00000FE00001F800000FC00003F800000
FC00003F800001FC00007F000001FC00007E000001F80000FC000001F80001FC000003F8
0003F0000003F80007E0000003F0001FC0000003FFFFFF00000007FFFFFE00000007F000
7F80000007E0000FC0000007E00007E000000FE00003F000000FE00003F800000FC00001
F800000FC00001F800001FC00001FC00001FC00001FC00001F800001FC00001F800001FC
00003F800001FC00003F800001F800003F000003F800003F000003F800007F000007F000
007F000007F000007E00000FE000007E00001FC00000FE00003F800000FE00007F000000
FC0001FE000001FC0007FC00007FFFFFFFF00000FFFFFFFFC00000FFFFFFFE0000003233
7BB236>I<0000001FF000C0000000FFFC01C0000003FFFF03C000000FF00F878000003F
8003CF800000FE0001EF800001FC0000FF800003F00000FF00000FE000007F00001FC000
007F00003F8000003F00003F0000003E00007E0000003E0000FE0000003E0001FC000000
3E0003F80000003C0003F80000003C0007F00000003C0007F00000003C000FE000000038
000FE000000038001FC000000038001FC000000000003FC000000000003F800000000000
3F8000000000003F8000000000007F8000000000007F0000000000007F0000000000007F
0000000000007F000000000000FE000000000000FE000000000000FE00000003C000FE00
000003C000FE0000000380007E0000000380007E0000000780007E0000000700007E0000
000F00007E0000000E00007F0000001E00003F0000003C00003F0000007800001F800000
7000001F800000F000000FC00001E0000007E00007C0000003F0000F00000001F8003E00
000000FF00FC000000007FFFF0000000001FFFC00000000003FE00000000323775B437>
I<0007FFFFFFC000000FFFFFFFF000000FFFFFFFFC0000003F8001FE0000003F80007F00
00003F80001F8000003F00000FC000003F000007E000007F000007E000007F000003F000
007E000003F000007E000001F00000FE000001F80000FE000001F80000FC000001F80000
FC000001F80001FC000001F80001FC000001F80001F8000001F80001F8000001F80003F8
000001F80003F8000003F80003F0000003F80003F0000003F80007F0000003F80007F000
0003F00007E0000007F00007E0000007F0000FE0000007F0000FE0000007E0000FC00000
0FE0000FC000000FC0001FC000001FC0001FC000001F80001F8000001F80001F8000003F
00003F8000003F00003F8000007E00003F000000FC00003F000000FC00007F000001F800
007F000003F000007E000007E000007E00000FC00000FE00001F800000FE00007E000000
FC0001FC000001FC000FF800007FFFFFFFE00000FFFFFFFF000000FFFFFFF80000003533
7BB23A>I<0007FFFFFFFFF0000FFFFFFFFFF0000FFFFFFFFFE000003F80001FE000003F
800007E000003F800003E000003F000003E000003F000001E000007F000001E000007F00
0001C000007E000001C000007E000001C00000FE000001C00000FE000001C00000FC000E
01C00000FC000E01C00001FC001E03C00001FC001C03800001F8001C00000001F8003C00
000003F8003C00000003F8007800000003F001F800000003FFFFF800000007FFFFF80000
0007FFFFF000000007E001F000000007E000F00000000FE000F00000000FE000E0000000
0FC000E00000000FC000E00700001FC001E00F00001FC001C00E00001F8001C01E00001F
8000001C00003F8000001C00003F8000003C00003F0000003800003F0000007800007F00
0000F000007F000000F000007E000001F000007E000003E00000FE000007E00000FE0000
0FC00000FC00001FC00001FC0001FF80007FFFFFFFFF8000FFFFFFFFFF8000FFFFFFFFFF
000034337CB234>I<0007FFFFFFFFE0000FFFFFFFFFE0000FFFFFFFFFC000003F80003F
C000003F80000FC000003F800007C000003F000007C000003F000003C000007F000003C0
00007F0000038000007E0000038000007E000003800000FE000003800000FE0000038000
00FC000003800000FC001C03800001FC003C07800001FC003807000001F8003800000001
F8003800000003F8007800000003F8007000000003F000F000000003F003F000000007FF
FFF000000007FFFFF000000007FFFFE000000007E003E00000000FE003E00000000FE001
C00000000FC001C00000000FC001C00000001FC003C00000001FC003800000001F800380
0000001F8003800000003F8000000000003F8000000000003F0000000000003F00000000
00007F0000000000007F0000000000007E0000000000007E000000000000FE0000000000
00FE000000000000FC000000000001FC00000000007FFFFC00000000FFFFFC00000000FF
FFFC0000000033337CB232>I<0007FFFF01FFFFC0000FFFFF03FFFFC0000FFFFF03FFFF
C000003FC0000FF00000003F80000FE00000003F80000FE00000003F00000FC00000003F
00000FC00000007F00001FC00000007F00001F800000007E00001F800000007E00001F80
000000FE00003F80000000FE00003F00000000FC00003F00000000FC00003F00000001FC
00007F00000001FC00007E00000001F800007E00000001F800007E00000003F80000FE00
000003F80000FC00000003F00000FC00000003FFFFFFFC00000007FFFFFFFC00000007FF
FFFFF800000007E00001F800000007E00001F80000000FE00003F80000000FE00003F000
00000FC00003F00000000FC00003F00000001FC00007F00000001FC00007E00000001F80
0007E00000001F800007E00000003F80000FE00000003F80000FC00000003F00000FC000
00003F00000FC00000007F00001FC00000007F00001F800000007E00001F800000007E00
001F80000000FE00003F80000000FE00003F00000000FC00003F00000001FC00007F0000
007FFFF01FFFFC0000FFFFF03FFFFC0000FFFFF03FFFFC00003A337BB239>72
D<000FFFFF80000FFFFF80000FFFFF0000003FC00000003F800000003F800000003F0000
00003F000000007F000000007F000000007E000000007E00000000FE00000000FE000000
00FC00000000FC00000001FC00000001FC00000001F800000001F800000003F800000003
F800000003F000000003F000000007F000000007F000000007E000000007E00000000FE0
0000000FE00000000FC00000000FC00000001FC00000001FC00000001F800000001F8000
00003F800000003F800000003F000000003F000000007F000000007F000000007E000000
007E00000000FE00000000FE00000000FC00000001FC000000FFFFF80000FFFFF80000FF
FFF0000021337BB21E>I<0007FFFF000FFFF0000FFFFF000FFFF0000FFFFF000FFFE000
003FC00003FE0000003F800003F80000003F800003E00000003F000007C00000003F0000
0F000000007F00001E000000007F00007C000000007E0000F8000000007E0001E0000000
00FE0003C000000000FE00078000000000FC001F0000000000FC003E0000000001FC0078
0000000001FC00F00000000001F801E00000000001F807C00000000003F80F8000000000
03F81FC00000000003F03FC00000000003F07FC00000000007F1FFE00000000007F3E7E0
0000000007E787F00000000007EF07F0000000000FFE03F0000000000FFC03F800000000
0FF801F8000000000FE001F8000000001FC001FC000000001FC000FC000000001F8000FE
000000001F8000FE000000003F80007E000000003F80007F000000003F00003F00000000
3F00003F800000007F00003F800000007F00001F800000007E00001FC00000007E00000F
C0000000FE00000FC0000000FE00000FE0000000FC00000FE0000001FC00000FF000007F
FFF000FFFF8000FFFFF001FFFF8000FFFFF001FFFF00003C337BB23B>75
D<0007FFFFC000000FFFFFC000000FFFFFC00000003FC0000000003F80000000003F8000
0000003F00000000003F00000000007F00000000007F00000000007E00000000007E0000
000000FE0000000000FE0000000000FC0000000000FC0000000001FC0000000001FC0000
000001F80000000001F80000000003F80000000003F80000000003F00000000003F00000
000007F00000000007F00000000007E00000000007E0000000000FE0000000000FE00000
00000FC0000000000FC00000E0001FC00001E0001FC00001C0001F800001C0001F800003
C0003F80000380003F80000780003F00000780003F00000F00007F00000F00007F00001F
00007E00003E00007E00003E0000FE00007C0000FE0001FC0000FC0003FC0001FC001FF8
007FFFFFFFF800FFFFFFFFF800FFFFFFFFF0002B337CB230>I<0007FFC00000007FFC00
0FFFC0000000FFFC000FFFE0000000FFFC00003FE0000001FF0000003FE0000001FE0000
003FE0000003FE0000003BE00000077C0000003BE00000077C0000007BE000000EFC0000
007BE000000EF800000073E000001CF800000073E0000038F8000000F1F0000039F80000
00F1F0000071F0000000E1F0000071F0000000E1F00000E1F0000001E1F00001C3F00000
01E1F00001C3E0000001C1F0000383E0000001C1F0000703E0000003C1F0000707E00000
03C1F0000E07C000000380F8000E07C000000380F8001C07C000000780F800380FC00000
0780F800380F8000000700F800700F8000000700F800700F8000000F00F800E01F800000
0F00F801C01F0000000E00F801C01F0000000E00F803801F0000001E007C03803F000000
1E007C07003E0000001C007C0E003E0000001C007C0E003E0000003C007C1C007E000000
3C007C1C007C00000038007C38007C00000038007C70007C00000078007C7000FC000000
78003EE000F800000070003EE000F800000070003FC000F8000000F0003F8001F8000000
F0003F8001F0000001F0003F0001F0000007F8003F0003F000007FFF803E00FFFFC000FF
FF803C01FFFFC000FFFF801C01FFFFC00046337BB245>I<0007FF80003FFFC0000FFFC0
007FFFC0000FFFC0007FFFC000001FC00003F80000003FE00001F00000003FE00001E000
00003FE00001C00000003BF00001C00000007BF00003C00000007BF000038000000071F8
00038000000071F8000380000000F1F8000780000000F0FC000700000000E0FC00070000
0000E0FC000700000001E07E000F00000001E07E000E00000001C07E000E00000001C03F
000E00000003C03F001E00000003C03F801C00000003801F801C00000003801F801C0000
0007801FC03C00000007800FC03800000007000FC03800000007000FE0380000000F0007
E0780000000F0007E0700000000E0007F0700000000E0003F0700000001E0003F0F00000
001E0003F8E00000001C0001F8E00000001C0001F8E00000003C0001FDE00000003C0000
FDC0000000380000FDC0000000380000FFC00000007800007FC00000007800007F800000
007000003F800000007000003F80000000F000003F80000000F000001F00000001F00000
1F00000007F800001F0000007FFF80000F000000FFFF80000E000000FFFF80000E000000
3A337BB239>I<0000001FE000000001FFFC00000007E03F0000001F800FC000003E0003
E00000F80001F00001F00001F00003E00000F80007C00000FC000F8000007C001F000000
7E003E0000007E007E0000003E00FC0000003F01F80000003F01F80000003F03F0000000
3F07F00000003F07E00000003F0FE00000003F0FC00000003F1FC00000003F1FC0000000
7F1F800000007F3F800000007F3F800000007F3F800000007F7F00000000FE7F00000000
FE7F00000000FE7F00000000FE7F00000001FCFE00000001FCFE00000003F8FE00000003
F8FE00000003F0FE00000007F0FE00000007E0FE0000000FE07E0000000FC07E0000001F
807E0000001F807E0000003F003F0000007E003F000000FC003F000000F8001F800001F0
000F800003E0000FC00007C00007C0001F800003E0003E000001F800FC0000007E07F000
00003FFF8000000007FC000000303775B43B>I<0007FFFFFFC000000FFFFFFFF800000F
FFFFFFFC0000003F8001FE0000003F80003F0000003F80001F8000003F00001FC000003F
00000FC000007F00000FC000007F00000FE000007E00000FE000007E00000FE00000FE00
000FE00000FE00001FC00000FC00001FC00000FC00001FC00001FC00001F800001FC0000
3F800001F800003F000001F800007E000003F80000FE000003F80000FC000003F00003F8
000003F00007E0000007F0003FC0000007FFFFFF00000007FFFFF800000007E000000000
000FE000000000000FE000000000000FC000000000000FC000000000001FC00000000000
1FC000000000001F8000000000001F8000000000003F8000000000003F8000000000003F
0000000000003F0000000000007F0000000000007F0000000000007E0000000000007E00
0000000000FE000000000000FE000000000000FC000000000001FC00000000007FFFF000
000000FFFFF000000000FFFFF00000000033337CB234>I<0007FFFFFE0000000FFFFFFF
C000000FFFFFFFF00000003F8007F80000003F8001FC0000003F80007E0000003F00007F
0000003F00003F0000007F00003F0000007F00003F8000007E00003F8000007E00003F80
0000FE00003F800000FE00007F000000FC00007F000000FC00007F000001FC0000FE0000
01FC0000FC000001F80001FC000001F80001F8000003F80003F0000003F8000FC0000003
F0001F80000003F000FE00000007FFFFF000000007FFFFC000000007E003E000000007E0
01F80000000FE000FC0000000FE0007C0000000FC0007E0000000FC0007E0000001FC000
7E0000001FC0007E0000001F80007E0000001F80007E0000003F8000FE0000003F8000FE
0000003F0000FE0000003F0000FE0000007F0001FE0000007F0001FC0000007E0001FC00
00007E0001FC01C000FE0001FC03C000FE0001FC038000FC0001FC038001FC0001FC0780
7FFFF000FC0700FFFFF000FE0E00FFFFF0007E1C00000000001FF8000000000007E00032
357BB238>82 D<000001FC018000000FFF038000003FFFC78000007E07EF800001F801FF
000003F000FF000003E0007F000007C0007F00000F80003E00001F80003E00001F00003E
00003F00003E00003E00003C00003E00003C00003E00003C00007E00003C00007E000038
00007E00003800007E00000000007F00000000007F00000000003F80000000003FE00000
00003FFE000000001FFFC00000000FFFF800000007FFFC00000001FFFE000000007FFF00
0000000FFF8000000000FF80000000003F80000000001FC0000000000FC0000000000FC0
000000000FC0000000000FC0000E00000FC0000E00000FC0001E00000F80001C00000F80
001C00000F80001C00001F80003C00001F00003C00001F00003E00003E00003E00007C00
007E00007C00007F0000F800007F8001F000007FC007E00000F3F80FC00000F0FFFF0000
00E03FFC000000C00FF000000029377AB42B>I<03FFFFFFFFFFC007FFFFFFFFFFC007FF
FFFFFFFF8007F800FC003F800FC001FC001F800F8001FC000F800F0001F8000F801E0001
F80007001E0003F80007001C0003F80007003C0003F0000F003C0003F0000F00380007F0
000E00780007F0000E00700007E0000E00700007E0000E0070000FE0001E00F0000FE000
1C0000000FC000000000000FC000000000001FC000000000001FC000000000001F800000
0000001F8000000000003F8000000000003F8000000000003F0000000000003F00000000
00007F0000000000007F0000000000007E0000000000007E000000000000FE0000000000
00FE000000000000FC000000000000FC000000000001FC000000000001FC000000000001
F8000000000001F8000000000003F8000000000003F8000000000003F0000000000003F0
000000000007F0000000000007F0000000000007E000000000000FF0000000001FFFFFF0
0000003FFFFFF00000003FFFFFF0000000323374B237>I<3FFFF801FFFE7FFFF803FFFE
7FFFF803FFFE01FE00001FC001FC00000F8001FC00000F0001F800000E0001F800000E00
01F800001E0003F800001E0003F000001C0003F000001C0003F000003C0007F000003C00
07E00000380007E00000380007E0000078000FE0000078000FC0000070000FC000007000
0FC00000F0001FC00000F0001F800000E0001F800000E0001F800001E0003F800001E000
3F000001C0003F000001C0003F000003C0007F000003C0007E00000380007E0000038000
7E0000078000FE0000078000FC0000070000FC0000070000FC00000F0000FC00000E0000
F800001E0000F800001C0000F800003C0000F80000380000F80000780000FC0000F00000
FC0000E000007C0001E000007E0003C000003E000F8000001F001E0000000FC0FC000000
07FFF800000001FFE0000000007F000000002F3570B239>I<FFFFC0003FFF80FFFFC000
3FFF80FFFFC0003FFF8007F8000007F80007F0000003E00007F0000003C00003F0000007
800003F0000007000003F000000F000003F000000E000003F000001C000003F000001C00
0003F0000038000003F0000078000003F0000070000003F00000E0000003F80000E00000
01F80001C0000001F80003C0000001F8000380000001F8000700000001F8000700000001
F8000E00000001F8001E00000001F8001C00000001F8003800000001FC003800000001FC
007000000000FC00F000000000FC00E000000000FC01C000000000FC01C000000000FC03
8000000000FC038000000000FC070000000000FC0E0000000000FC0E0000000000FE1C00
000000007E1C00000000007E3800000000007E7800000000007E7000000000007EE00000
0000007EE000000000007FC000000000007FC000000000007F8000000000007F00000000
00007F0000000000003E0000000000003E0000000000003C000000000000380000000000
313570B239>I<FFFFC03FFFF003FFF8FFFFC03FFFF007FFF8FFFF803FFFF007FFF80FF0
0001FC00007F8007E00001F800003E0007E00001F800003C0007E00001F800003C0007E0
0001F80000380007E00001F80000700007E00003F80000700007E00003F80000E00007E0
0007F80000E00007E00007F80001C00007E0000FF80003C00007E0000FF80003800007E0
001DF80007000007E0001DF80007000007E00038FC000E000007E00038FC000E000007E0
0070FC001C000007E000F0FC001C000003F000E0FC0038000003F001E0FC0038000003F0
01C0FC0070000003F00380FC00F0000003F00380FC00E0000003F00700FC01E0000003F0
0700FC01C0000003F00E00FC0380000003F00E00FC0380000003F01C00FC0700000003F0
1C00FC0700000003F03800FC0E00000003F07800FC0E00000003F07000FC1C00000003F0
E000FC1C00000003F0E000FC3800000003F1C000FC7800000003F1C000FC7000000003F3
8000FCE000000003F38000FCE000000003F700007FC000000003F700007FC000000003FE
00007F8000000003FE00007F8000000001FC00007F0000000001FC00007F0000000001F8
00007E0000000001F000007E0000000001F000007C0000000001E000007C0000000001E0
0000780000000001C000007000000000453570B24D>I<0003F000000FF800003E1C6000
7C0FF000F807F001F007F003E007F007E003E00FC003E00FC003E01F8007E01F8007C03F
0007C03F0007C03F000FC07F000F807E000F807E000F807E001F80FE001F00FC001F00FC
001F06FC003F07FC003E0FFC003E0EFC007E0E7C007E1E7C00FE1C7C01FC1C3C03FC3C3E
07BE381F0E1E7807FC0FF001F003C0202278A027>97 D<007E00000FFE00001FFE00001F
FC000000FC000000FC000000FC000000F8000000F8000001F8000001F8000001F0000001
F0000003F0000003F0000003E0000003E0000007E0000007E0000007C3E00007CFF8000F
DC3E000FF81F000FF00F000FE00F801FC00F801F800F801F800FC01F000FC03F000FC03F
000FC03E000FC03E000FC07E001FC07E001F807C001F807C001F807C003F80FC003F00F8
003F00F8003F00F8007E00F8007E00F800FC00F800FC007801F8007801F0007803E0003C
07C0003C0F80001E1F00000FFC000003F000001A3578B323>I<0000FC000007FF00001F
0780003E03C000FC01C001F803C003F007C007E00FC007C00FC00FC00FC01F8007001F80
00003F0000003F0000003F0000007F0000007E0000007E0000007E000000FE000000FC00
0000FC000000FC000000FC0000007C0000C07C0001E07C0001E07C0003C03E000F803E00
1F001F007C000F81F00003FFC00000FE00001B2278A023>I<0000000FC0000003FFC000
0003FFC0000003FF800000001F800000001F800000001F800000001F000000001F000000
003F000000003F000000003E000000003E000000007E000000007E000000007C00000000
7C00000000FC00000000FC000003F0F800000FF8F800003E1DF800007C0FF80000F807F0
0001F007F00003E007F00007E003F0000FC003E0000FC003E0001F8007E0001F8007E000
3F0007C0003F0007C0003F000FC0007F000FC0007E000F80007E000F80007E001F8000FE
001F8000FC001F0000FC001F0600FC003F0700FC003F0F00FC003E0E00FC007E0E007C00
7E1E007C00FE1C007C01FC1C003C03FC3C003E07BE38001F0E1E780007FC0FF00001F003
C000223578B327>I<0003F800000FFE00003E0F0000F8078001F0038003E0038007C003
800FC003801F8003801F8007803F0007003F000F007E003E007E03F8007FFFE000FFFE00
00FC000000FC000000FC000000FC000000F8000000F8000000F8000000F8000000F80001
80F80003C0F80003C07C0007807C001F003C003E001E00F8000F03E00007FF800001FC00
001A2277A023>I<0000001F000000007FC0000000F0E0000001F0F0000003E3F0000003
E3F0000007C3F0000007C3E0000007C1C000000FC00000000F800000000F800000000F80
0000000F800000001F800000001F000000001F000000001F000000001F000000003F0000
00003E0000001FFFFE00001FFFFE00001FFFFE0000007E000000007C000000007C000000
007C000000007C00000000FC00000000F800000000F800000000F800000000F800000000
F800000001F800000001F000000001F000000001F000000001F000000003F000000003E0
00000003E000000003E000000003E000000007E000000007C000000007C000000007C000
00000FC00000000FC00000000F800000000F800000000F800000001F800000001F000000
001F000000001F000000003F000000003E000000383E0000007E3C0000007E3C000000FE
78000000FC78000000F8F000000078E00000003FC00000000F00000000244582B418>I<
00003F000000FF800003E1E60007C0FF000F807F001F007F003E007F007E003F00FC003E
00FC003E01F8007E01F8007E03F0007C03F0007C03F000FC07F000FC07E000F807E000F8
07E001F807E001F80FC001F00FC001F00FC003F007C003F007C003E007C007E007C00FE0
07C01FE003E03FC001E07FC001F0FFC0007FCFC0001F0F8000000F8000001F8000001F80
00001F0000001F0000003F0000003E0038003E007E007E007E00FC00FE00F800FC01F000
7803E0007C0F80001FFF000007F8000020317CA023>I<000FC0000003FFC0000003FFC0
000003FF800000001F800000001F800000001F800000001F000000001F000000003F0000
00003F000000003E000000003E000000007E000000007E000000007C000000007C000000
00FC00000000FC00000000F83F800000F8FFE00001FBE0F00001FF80F80001FF00780001
FE007C0003FC007C0003F8007C0003F0007C0003F0007C0007E000FC0007E000F80007C0
00F80007C000F8000FC001F8000FC001F0000F8001F0000F8001F0001F8003F0001F8003
E0001F0007E0001F0007C0C03F0007C1E03F000FC1C03E000F81C03E000F81C07E000F83
C07E000F03807C000F07807C000F0700FC000F0E00FC000F1E00F80007F800700001F000
23357BB327>I<0001800007E00007E0000FE00007C00003800000000000000000000000
0000000000000000000000000000000000000000000001F00003FC000F1E000E1E001C1E
003C1E00381E00783E00703E00703E00707E00F07C0060FC0000F80000F80001F80001F0
0001F00003F00003E00003E00007E0C007C1E00FC1C00F81C00F81C00F83C00F03800F07
800F07000F0E000F1E0007F80001F00013337AB118>I<000000380000007C000000FC00
0000FC000000FC0000007000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000003E000000FF800001E3C0000383E000
0701E0000F01E0000E03E0001C03E0003C03E0003803E0003807E0007807E0003007C000
0007C000000FC000000FC000000F8000000F8000001F8000001F8000001F0000001F0000
003F0000003F0000003E0000003E0000007E0000007E0000007C0000007C000000FC0000
00FC000000F8000000F8000001F8000001F8000001F0000001F0000003F0000003E00038
03E0007E07C0007E07C000FE0F8000FC1F0000F83E0000787C00003FF000000F8000001E
4283B118>I<000FC00001FFC00003FFC00003FF8000001F8000001F8000001F8000001F
0000001F0000003F0000003F0000003E0000003E0000007E0000007E0000007C0000007C
000000FC000000FC000000F8007800F801FE01F8078F01F80E0F01F01C3F01F0383F03F0
703F03F0E03E03E1C01C03E3800007E7000007EE000007DC000007F800000FF800000FFF
00000F9FC0000F83F0001F81F0001F80F8001F00F8001F00F80C3F00F81E3F00F81C3E00
F81C3E00F81C7E00F83C7E00F8387C00F8387C00F878FC007870FC0078E0F8003FC07000
0F8020357BB323>I<003F07FF0FFF0FFE007E007E007E007C007C00FC00FC00F800F801
F801F801F001F003F003F003E003E007E007E007C007C00FC00FC00F800F801F801F801F
001F003F003F003E003E007E007E007C007C18FC1CFC3CF838F838F878F870F070F0F0F8
E079E03FC00F00103579B314>I<03C003F8007F00000FF00FFE01FFC0001E783C1F07C1
E0001C7CF00F8F01F0003C3DE0079E00F000383FC007FC00F800387F8007F800F800707F
0007F000F800707F0007E000F800707E0007E000F800F0FC000FC001F800E0FC000FC001
F00060F8000F8001F00000F8000F8001F00001F8001F8003F00001F8001F8003E00001F0
001F0003E00001F0001F0003E00003F0003F0007E00003F0003F0007C00003E0003E000F
C00003E0003E000F818007E0007E000F83C007E0007E001F838007C0007C001F038007C0
007C001F03800FC000FC001F07800FC000FC003E07000F8000F8003E0F000F8000F8001E
0E001F8001F8001E1C001F8001F8001E3C001F0001F0000FF0000E0000E00003E0003A22
7AA03F>I<03C007F0000FF01FFC001E787C1E001C7CF01F003C3DE00F00383FC00F8038
7F800F80787F000F80707E000F80707E000F80F0FC001F80E0FC001F0060F8001F0000F8
001F0001F8003F0001F8003E0001F0003E0001F0003E0003F0007E0003F0007C0003E000
FC0003E000F81807E000F83C07E001F83807C001F03807C001F0380FC001F0780FC001E0
700F8001E0F00F8001E0E01F8001E1C01F8001E3C01F0000FF000E00003E0026227AA02B
>I<0000FC000007FF00001F07C0003E03E000FC01F001F801F003F000F807E000F807C0
00F80FC000F81F8000FC1F8000FC3F0000FC3F0000FC3F0001FC7F0001F87E0001F87E00
01F87E0003F8FE0003F0FC0003F0FC0003F0FC0007E0FC0007E07C000FC07C000F807C00
1F807C003F003E007E003E00FC001F01F0000F83E00003FF800000FC00001E2278A027>
I<001E007C00007F81FF0000F3C387C000E3EF03E001E1FE01E001C1FC01F001C3F801F0
03C3F001F00383F001F80383E001F80787E001F80707E001F80307C001F80007C001F800
0FC003F8000FC003F0000F8003F0000F8003F0001F8007F0001F8007E0001F0007E0001F
0007E0003F000FC0003F000FC0003E001F80003E001F80007E003F00007F003E00007F00
7C00007F00F80000FF81F00000FDC3E00000F8FF800000F87E000001F800000001F80000
0001F000000001F000000003F000000003F000000003E000000003E000000007E0000000
07E000000007C0000000FFFF000000FFFF000000FFFF00000025307FA027>I<0003F018
000FF838003E1C78007C0EF800F807F001F007F003E007F007E003F00FC003E00FC003E0
1F8003E01F8007E03F0007C03F0007C03F0007C07F000FC07E000F807E000F807E000F80
FE001F80FC001F00FC001F00FC001F00FC003F00FC003E00FC007E007C007E007C00FE00
7C01FC003C03FC003E07FC001F0EFC0007FCF80001F0F8000000F8000001F8000001F000
0001F0000001F0000003F0000003E0000003E0000007E0000007E0000007C00001FFFF00
01FFFF0001FFFE001D3078A023>I<03C00FC00FF03FF01E78F0781C7DE03C3C3FC0FC38
3F80FC387F00FC787F00F8707E0070707E0000F0FC0000E0FC000060F8000000F8000001
F8000001F8000001F0000001F0000003F0000003F0000003E0000003E0000007E0000007
E0000007C0000007C000000FC000000FC000000F8000000F8000001F8000001F8000001F
0000000E0000001E227AA020>I<0003F0001FFC003C1E00780F00F00701E00701E00F03
E01F03C01F03C01F03E00403E00003F00003FF8003FFE001FFF000FFF8007FFC0007FC00
00FE00007E00003E38003EFC003CFC003CFC003CFC007CF00078E000F0F001F07803E03C
0F801FFE0003F80018227AA01F>I<000300000F80000F80000F80001F80001F80001F00
001F00003F00003F00003E00003E00007E00007E00007C007FFFF87FFFF8FFFFF800F800
00F80001F80001F80001F00001F00003F00003F00003E00003E00007E00007E00007C000
07C0000FC0000FC0000F80000F80601F80F01F80E01F00E01F01E01F01C01F03C01E0380
1E07001E0F000F1E0007F80001E00015307AAE19>I<01F000000003FC0007000F1E000F
000E1E001F001C1E001F003C1E001F00381E003F00783E003E00703E003E00703E003E00
707E007E00F07C007C0060FC007C0000F8007C0000F800FC0001F800F80001F000F80001
F000F80001F001F80003F001F00003E001F00003E001F06003E003F07003E003E0F007C0
03E0E007C003E0E003C007E1E003C007E1C003E00FC1C003E01FC3C001E03FE38001F071
E780007FE0FF00001F803C0024227AA029>I<00F0003803FC00FC0F1E00FC0E1E00FC1C
1E00FC3C1E00FC381E007C783E007C703E003C703E003C707E003CF07C003860FC003800
F8003800F8007801F8007001F0007001F0007001F000F003F000E003E000E003E000E003
E001C003E001C003C003C003C0038003C0078003C0070003E00E0003E00E0001F01C0000
F87800007FE000001F80001E227AA023>I<01F00000003803FC000E00FC0F1E001E00FC
0E1E003E00FC1C1E003E00FC3C1E003E00FC381E007E007C783E007C007C703E007C003C
703E007C003C707E00FC003CF07C00F8003860FC00F8003800F800F8003800F801F80078
01F801F0007001F001F0007001F001F0007001F003F000F003F003F000E003E003E000E0
03E003E000E003E003E001E003E003E001C003C003C001C003C007C0038003C007C00380
03E00FE0078003E00FE0070003E01FE00E0001F03DF01E0000F878F83C00003FF03FF000
000FC00FC0002E227AA033>I<001F007C00007FC1FF0001E1E7878003C0F703C00380FE
0FC00700FE0FC00F00FC0FC00E00FC0F801E00F807001C00F800001C01F800003C01F000
001801F000000001F000000003F000000003E000000003E000000003E000000007E00000
0007E000000007C000000007C00600000FC00F00000FC00E00000F800E00380F801E007C
1F801C00FC1F803C00FC1F803800FC3F807000F07FC0E00070F3C3C0003FE1FF80000F80
7E000022227CA023>I<00F0000003FC00070F1E000F0E1E001F1C1E001F3C1E001F381E
003F783E003E703E003E703E003E707E007EF07C007C60FC007C00F8007C00F800FC01F8
00F801F000F801F000F801F001F803F001F003E001F003E001F003E003F003E003E007C0
03E007C003E003C007E003C007C003E00FC003E01FC001E03FC001F07F80007FEF80001F
8F8000001F8000001F0000001F0000003F003E003E007E007E007E007C007E00F8007C00
F0007001F0007003E000380780003C1F00000FFC000007F0000020317AA025>I<000780
1C001FE03C003FF038007FF07800FFF8F001F07CE001E01FE003C003C00380078003800F
0000001E0000001C0000003C00000078000000F0000001E0000007C000000F8000001E00
00003C00000078000000F0007000E000F001E000E003C000E0078001E00FC003C01FF807
C01F3E0F803C1FFF00781FFF00700FFE00F007F800E001E0001E227CA01F>I
E /Fk 2 106 df<0001800003C00007C00007C0000780000F80000F80001F00001F0000
1E00003E00003E00007C00007C0000780000F80000F80001F00001F00001E00003E00003
E00007C00007C0000780000F80000F80001F00001F00001E00003E00003E00007C00007C
0000780000F80000F80000F80000F800007800007C00007C00003E00003E00001E00001F
00001F00000F80000F800007800007C00007C00003E00003E00001E00001F00001F00000
F80000F800007800007C00007C00003E00003E00001E00001F00001F00000F80000F8000
07800007C00007C00003C0000180124A79B71E>104 D<600000F00000F80000F8000078
00007C00007C00003E00003E00001E00001F00001F00000F80000F800007800007C00007
C00003E00003E00001E00001F00001F00000F80000F800007800007C00007C00003E0000
3E00001E00001F00001F00000F80000F800007800007C00007C00007C00007C000078000
0F80000F80001F00001F00001E00003E00003E00007C00007C0000780000F80000F80001
F00001F00001E00003E00003E00007C00007C0000780000F80000F80001F00001F00001E
00003E00003E00007C00007C0000780000F80000F80000F00000600000124A7CB71E>I
E /Fl 62 125 df<0000FF807E000007FFE1FF80001F807FC3C0003E007F87E0007C00FF
07E000F800FE07E001F000FE07E003F000FC018003E0007C000003E0007C000003E0007C
000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C
000003E0007C0000FFFFFFFFFC00FFFFFFFFFC0003E0007C000003E0007C000003E0007C
000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C
000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C
000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C000003E0007C
000003E0007C000003E0007C000003E0007C000007F000FE00007FFF0FFFF0007FFF0FFF
F0002B2F7FAE29>11 D<0000FF00000007FFE000001F80F000003E003800007C007C0000
F800FC0001F000FC0003F000FC0003E000780003E000300003E000000003E000000003E0
00000003E000000003E000000003E000000003E000000003E0007C00FFFFFFFC00FFFFFF
FC0003E000FC0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C
0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C00
03E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003E0007C0003
E0007C0003E0007C0003E0007C0007F000FE007FFF0FFFE07FFF0FFFE0232F7FAE27>I<
3C00F07E01F8FF03FCFF03FCFF83FEFF83FE7F81FE3D80F601800601800601800603800E
03000C03000C07001C0600180E00381C00703800E07001C060018017157EAD23>34
D<00030007000E001C0038007000F001E001C003C0078007800F000F001E001E001E003C
003C003C003C0078007800780078007800F800F800F000F000F000F000F000F000F000F0
00F000F000F000F800F800780078007800780078003C003C003C003C001E001E001E000F
000F000780078003C001C001E000F000700038001C000E0007000310437AB11B>40
D<C000E000700038001C000E000F000780038003C001E001E000F000F000780078007800
3C003C003C003C001E001E001E001E001E001F001F000F000F000F000F000F000F000F00
0F000F000F000F001F001F001E001E001E001E001E003C003C003C003C00780078007800
F000F001E001E003C0038007800F000E001C0038007000E000C00010437CB11B>I<0000
038000000000038000000000038000000000038000000000038000000000038000000000
038000000000038000000000038000000000038000000000038000000000038000000000
038000000000038000000000038000000000038000000000038000000000038000000000
03800000000003800000000003800000000003800000FFFFFFFFFFFCFFFFFFFFFFFCFFFF
FFFFFFFC0000038000000000038000000000038000000000038000000000038000000000
038000000000038000000000038000000000038000000000038000000000038000000000
038000000000038000000000038000000000038000000000038000000000038000000000
038000000000038000000000038000000000038000000000038000002E2F7CA737>43
D<3C007E00FF00FF00FF80FF807F803D80018001800180038003000300070006000E001C
0038007000600009157A8714>I<FFFFC0FFFFC0FFFFC0FFFFC012047F9018>I<3C7EFFFF
FFFF7E3C08087A8714>I<000C00003C00007C0003FC00FFFC00FC7C00007C00007C0000
7C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C0000
7C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C0000
7C00007C00007C00007C00007C00007C00007C00007C00007C0000FE007FFFFE7FFFFE17
2C7AAB23>49 D<007F800001FFF0000780FC000E003F001C001F8038000FC070000FC060
0007E0F00007E0FC0007F0FE0007F0FE0003F0FE0003F0FE0003F07C0007F0000007F000
0007F0000007E000000FE000000FC000001FC000001F8000003F0000007E0000007C0000
00F8000001F0000003E0000007C000000F8000001E0000003C00000078000000F0003000
E0003001C0003003800060070000600E0000E01FFFFFE03FFFFFE07FFFFFC0FFFFFFC0FF
FFFFC01C2C7DAB23>I<003FC00001FFF00007C0FC000E007E001C003F001C001F803F00
1FC03F001FC03F800FC03F000FC03F000FC00C001FC000001FC000001F8000001F800000
3F0000003E0000007C000000F8000003F00000FFC00000FFF0000000FC0000003F000000
1F8000001FC000000FC000000FE000000FE0000007F0000007F0380007F07C0007F0FE00
07F0FE0007F0FE0007F0FE000FE0F8000FE060000FC070001FC038001F801E003F000780
FC0001FFF000007FC0001C2D7DAB23>I<0C0001800FC01F800FFFFF000FFFFE000FFFFC
000FFFF0000FFFC0000C7E00000C0000000C0000000C0000000C0000000C0000000C0000
000C0000000C0000000C1FC0000C7FF8000DE07C000F801F000F001F800E000F800C0007
C0000007E0000007E0000003E0000003F0000003F0000003F0000003F0780003F0FC0003
F0FC0003F0FC0003F0FC0003F0F80007E0E00007E0600007C070000FC038000F801C001F
000E003E000780F80001FFE000007F80001C2D7DAB23>53 D<300000003C0000003FFFFF
F83FFFFFF83FFFFFF07FFFFFF07FFFFFE0700001C06000018060000380C0000700C0000E
00C0000C0000001C000000380000003000000070000000E0000001C0000001C000000380
00000380000007000000070000000F0000000E0000001E0000001E0000003E0000003E00
00003E0000003C0000007C0000007C0000007C0000007C000000FC000000FC000000FC00
0000FC000000FC000000FC000000FC000000FC000000FC0000007800001D2E7CAC23>55
D<003F800000FFF00003E0780007C03E000F801F001F000F003E000F803E0007807E0007
C07C0007C0FC0007E0FC0003E0FC0003E0FC0003E0FC0003F0FC0003F0FC0003F0FC0003
F0FC0003F07C0007F07E0007F07E0007F03E000FF01F000FF00F001FF007803BF003E0F3
F000FFC3F0003F03E0000003E0000007E0000007E0000007C0000007C000000FC01E000F
803F000F003F001F003F003E003F003C003E0078001C00F0000E03E00007FF800001FE00
001C2D7DAB23>57 D<000001800000000003C00000000003C00000000003C00000000007
E00000000007E0000000000FF0000000000FF0000000000FF0000000001BF80000000019
F80000000019F80000000030FC0000000030FC0000000070FE00000000607E0000000060
7E00000000C03F00000000C03F00000000C03F00000001801F80000001801F8000000380
1FC0000003000FC0000003000FC00000060007E00000060007E00000060007E000000C00
03F000000C0003F000001FFFFFF800001FFFFFF80000180001F80000300000FC00003000
00FC0000300000FC00006000007E00006000007E0000E000007F0000C000003F0000C000
003F0001C000001F8003C000001F8007C000001FC00FF000003FE0FFFC0003FFFFFFFC00
03FFFF302F7EAE35>65 D<FFFFFFFC0000FFFFFFFF800003F8000FC00001F80003F00001
F80001F80001F80000FC0001F80000FE0001F800007E0001F800007F0001F800007F0001
F800007F0001F800007F0001F800007F0001F800007F0001F800007E0001F80000FE0001
F80000FC0001F80001F80001F80003F00001F8000FE00001F8007F800001FFFFFF000001
FFFFFFE00001F80003F00001F80001FC0001F80000FE0001F800007F0001F800003F0001
F800003F8001F800001F8001F800001FC001F800001FC001F800001FC001F800001FC001
F800001FC001F800001FC001F800001F8001F800003F8001F800003F0001F800007F0001
F80000FE0001F80003FC0003F8000FF000FFFFFFFFC000FFFFFFFE00002A2D7DAC32>I<
00001FF000C00000FFFE01C00003F00F83C0000F8001E3C0003F000077C0007C00003FC0
01F800001FC003F000000FC007E0000007C007E0000007C00FC0000003C01FC0000003C0
1F80000001C03F80000001C03F00000001C07F00000000C07F00000000C07F00000000C0
FE0000000000FE0000000000FE0000000000FE0000000000FE0000000000FE0000000000
FE0000000000FE0000000000FE0000000000FE0000000000FE00000000007F0000000000
7F00000000C07F00000000C03F00000000C03F80000000C01F80000001C01FC000000180
0FC00000018007E00000038007E00000070003F00000060001F800000E00007C00001C00
003F00007800000F8001E0000003F00FC0000000FFFE000000001FF000002A2F7CAD33>
I<FFFFFFF80000FFFFFFFF000003F8001FE00001F80003F00001F80000F80001F800007E
0001F800003F0001F800001F8001F800000F8001F800000FC001F8000007E001F8000007
E001F8000003F001F8000003F001F8000003F801F8000001F801F8000001F801F8000001
F801F8000001FC01F8000001FC01F8000001FC01F8000001FC01F8000001FC01F8000001
FC01F8000001FC01F8000001FC01F8000001FC01F8000001FC01F8000001F801F8000001
F801F8000001F801F8000003F001F8000003F001F8000003E001F8000007E001F8000007
C001F800000FC001F800001F8001F800003F0001F800007E0001F80000FC0001F80003F0
0003F8001FE000FFFFFFFF8000FFFFFFF800002E2D7DAC36>I<FFFFFFFFFE00FFFFFFFF
FE0003F80001FE0001F800003E0001F800001F0001F800000F0001F80000070001F80000
070001F80000030001F80000030001F80000030001F80000038001F80000018001F80018
018001F80018018001F80018000001F80018000001F80018000001F80038000001F80078
000001F800F8000001FFFFF8000001FFFFF8000001F800F8000001F80078000001F80038
000001F80018000001F80018000001F80018006001F80018006001F80018006001F80000
00C001F8000000C001F8000000C001F8000000C001F8000001C001F80000018001F80000
038001F80000038001F80000078001F800000F8001F800003F8003F80001FF00FFFFFFFF
FF00FFFFFFFFFF002B2D7EAC30>I<FFFFFFFFFCFFFFFFFFFC03F80003FC01F800007C01
F800003E01F800001E01F800000E01F800000E01F800000601F800000601F800000601F8
00000701F800000301F800180301F800180301F800180001F800180001F800180001F800
380001F800780001F800F80001FFFFF80001FFFFF80001F800F80001F800780001F80038
0001F800180001F800180001F800180001F800180001F800180001F800000001F8000000
01F800000001F800000001F800000001F800000001F800000001F800000001F800000001
F800000001F800000003FC000000FFFFF80000FFFFF80000282D7EAC2E>I<00001FF000
C00000FFFE01C00003F00F83C0000F8001E3C0003F000077C0007C00003FC001F800001F
C003F000000FC007E0000007C007E0000007C00FC0000003C01FC0000003C01F80000001
C03F80000001C03F00000001C07F00000000C07F00000000C07F00000000C0FE00000000
00FE0000000000FE0000000000FE0000000000FE0000000000FE0000000000FE00000000
00FE0000000000FE0000000000FE00001FFFFEFE00001FFFFE7F0000001FE07F0000000F
C07F0000000FC03F0000000FC03F8000000FC01F8000000FC01FC000000FC00FC000000F
C007E000000FC007E000000FC003F000000FC001F800001FC0007C00001FC0003F00003F
C0000F8000F3C00003F007C1C00000FFFF00C000001FF800002F2F7CAD37>I<FFFFF0FF
FFF003FC0001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001
F80001F80001F80001F80001F80003FC00FFFFF0FFFFF0142D7EAC19>73
D<FFFFF80000FFFFF8000003FC00000001F800000001F800000001F800000001F8000000
01F800000001F800000001F800000001F800000001F800000001F800000001F800000001
F800000001F800000001F800000001F800000001F800000001F800000001F800000001F8
00000001F800000001F800000001F800000001F800000001F800000001F800000001F800
000C01F800000C01F800000C01F800000C01F800001801F800001801F800001801F80000
1801F800003801F800003801F800007801F80000F801F80001F801F80007F003F8001FF0
FFFFFFFFF0FFFFFFFFF0262D7EAC2C>76 D<FFF800000007FFC0FFFC0000000FFFC003FC
0000000FF00001FC0000000FE00001BE0000001BE00001BE0000001BE000019F00000033
E000019F00000033E000019F00000033E000018F80000063E000018F80000063E0000187
C00000C3E0000187C00000C3E0000183E0000183E0000183E0000183E0000183E0000183
E0000181F0000303E0000181F0000303E0000180F8000603E0000180F8000603E0000180
F8000603E00001807C000C03E00001807C000C03E00001803E001803E00001803E001803
E00001803E001803E00001801F003003E00001801F003003E00001800F806003E0000180
0F806003E000018007C0C003E000018007C0C003E000018007C0C003E000018003E18003
E000018003E18003E000018001F30003E000018001F30003E000018001F30003E0000180
00FE0003E000018000FE0003E0000180007C0003E00003C0007C0003E0000FF0007C0007
F000FFFF003801FFFFC0FFFF003801FFFFC03A2D7DAC41>I<FFF80003FFFCFFFC0003FF
FC01FC00003FC001FE00000F0001FF0000060001BF8000060001BF80000600019FC00006
00018FE00006000187E00006000187F00006000183F80006000181F80006000181FC0006
000180FE00060001807E00060001807F00060001803F80060001801FC0060001800FC006
0001800FE00600018007F00600018003F00600018003F80600018001FC0600018000FC06
00018000FE06000180007F06000180003F86000180001F86000180001FC6000180000FE6
0001800007E60001800007F60001800003FE0001800001FE0001800001FE0001800000FE
00018000007E00018000003E00018000003E0003C000001E000FF000000E00FFFF00000E
00FFFF000006002E2D7DAC35>I<00003FF000000001FFFE00000007E01F8000001F8007
E000003E0001F00000FC0000FC0001F800007E0003F000003F0007E000001F8007C00000
0F800FC000000FC01F80000007E01F80000007E03F00000003F03F00000003F07F000000
03F87F00000003F87E00000001F87E00000001F8FE00000001FCFE00000001FCFE000000
01FCFE00000001FCFE00000001FCFE00000001FCFE00000001FCFE00000001FCFE000000
01FCFE00000001FC7F00000003F87F00000003F87F00000003F83F00000003F03F800000
07F01F80000007E01F80000007E00FC000000FC00FE000001FC007E000001F8003F00000
3F0001F800007E0000FC0000FC00007E0001F800001F8007E0000007E01F80000001FFFE
000000003FF000002E2F7CAD37>I<FFFFFFFC0000FFFFFFFF800003F8000FE00001F800
03F00001F80000F80001F80000FC0001F800007E0001F800007F0001F800003F0001F800
003F8001F800003F8001F800003F8001F800003F8001F800003F8001F800003F8001F800
003F0001F800007F0001F800007E0001F80000FC0001F80000F80001F80003F00001F800
0FE00001FFFFFF800001FFFFFC000001F80000000001F80000000001F80000000001F800
00000001F80000000001F80000000001F80000000001F80000000001F80000000001F800
00000001F80000000001F80000000001F80000000001F80000000001F80000000001F800
00000001F80000000001F80000000003FC00000000FFFFF0000000FFFFF0000000292D7E
AC30>I<FFFFFFC00000FFFFFFFC000003F8007F000001F8000FC00001F80007E00001F8
0003F00001F80001F80001F80001FC0001F80000FC0001F80000FE0001F80000FE0001F8
0000FE0001F80000FE0001F80000FE0001F80000FC0001F80001FC0001F80001F80001F8
0003F00001F80007E00001F8000FC00001F8007F000001FFFFFC000001FFFFF0000001F8
00FC000001F8003E000001F8001F800001F8000F800001F8000FC00001F80007E00001F8
0007E00001F80007E00001F80007E00001F80007E00001F80007F00001F80007F00001F8
0007F00001F80007F00001F80007F00001F80007F00301F80007F80301F80003F80301F8
0003F80703FC0001FC0EFFFFF000FE1CFFFFF0003FF80000000007E0302E7DAC34>82
D<003F803001FFF07007C07C700F000EF01E0007F03C0003F0780001F0780000F0700000
F0F0000070F0000070F0000070F0000030F8000030F8000030FC0000007E0000007F0000
003FE000003FFE00001FFFE0000FFFFC0007FFFF0001FFFF80003FFFE00003FFE000003F
F0000007F8000001F8000000F8000000FC0000007CC000007CC000003CC000003CC00000
3CE000003CE000003CE0000078F0000078F8000070FC0000F0FE0001E0F78003C0E3F00F
00E07FFE00C00FF0001E2F7CAD27>I<7FFFFFFFFFF87FFFFFFFFFF87F000FC003F87C00
0FC000F870000FC0003870000FC0003860000FC0001860000FC00018E0000FC0001CE000
0FC0001CC0000FC0000CC0000FC0000CC0000FC0000CC0000FC0000CC0000FC0000C0000
0FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC0000000001FE00000001FFFFFE000001FFFFFE0002E2D
7EAC33>I<FFFFF003FFFCFFFFF003FFFC03FC00003FC001F800000F0001F80000060001
F80000060001F80000060001F80000060001F80000060001F80000060001F80000060001
F80000060001F80000060001F80000060001F80000060001F80000060001F80000060001
F80000060001F80000060001F80000060001F80000060001F80000060001F80000060001
F80000060001F80000060001F80000060001F80000060001F80000060001F80000060001
F80000060001F80000060001F80000060001F80000060001F800000E0000F800000C0000
FC00000C0000FC00001C00007C00001800007E00003800003F00007000001F0000600000
0F8001E0000007E00380000001F80F000000007FFC000000000FF000002E2E7DAC35>I<
FFFF801FFFF001FFF8FFFF801FFFF001FFF807FC0001FF00003FC003F00000FE00001F00
03F000007E00000E0003F000007E00000E0001F800007F00000C0001F800007F00000C00
01FC00007F00001C0000FC0000DF8000180000FC0000DF8000180000FE0000DF80003800
007E00018FC0003000007E00018FC0003000007F00018FC0007000003F000307E0006000
003F000307E0006000003F800307E000E000001F800603F000C000001F800603F000C000
001FC00603F001C000000FC00C01F8018000000FC00C01F8018000000FE00C01F8038000
0007E01800FC0300000007E01800FC0300000007F01800FC0700000003F030007E060000
0003F030007E0600000003F830007E0E00000001F860003F0C00000001F860003F0C0000
0001FC60003F1C00000000FCC0001F9800000000FCC0001F9800000000FEC0001FB80000
00007F80000FF0000000007F80000FF0000000003F80000FE0000000003F000007E00000
00003F000007E0000000001F000007C0000000001E000003C0000000001E000003C00000
00000E00000380000000000C000001800000452E7FAC48>87 D<FFE0FFE0FFE0E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000FFE0FFE0FFE00B4379B114>91 D<03000C07001C0E00381C0070
3800E03000C07001C0600180600180E00380C00300C00300C00300DE0378FF03FCFF83FE
FF83FE7F81FE7F81FE3F00FC1E0078171577AD23>I<FFE0FFE0FFE000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E0FFE0FFE0FFE00B437FB114>I<00FF000007FFC0000F01F0001C00F8003F
007C003F003E003F003E003F003F001E001F0000001F0000001F0000001F0000001F0000
07FF00007FFF0001FE1F0007F01F001FC01F003F801F007F001F007E001F00FE001F06FC
001F06FC001F06FC001F06FC003F06FE003F067E007F067F00EF8C1F83C7FC0FFF03F801
FC01E01F207D9E23>97 D<07C0000000FFC0000000FFC00000000FC000000007C0000000
07C000000007C000000007C000000007C000000007C000000007C000000007C000000007
C000000007C000000007C000000007C000000007C0FE000007C7FF800007CF03E00007DC
01F00007F8007C0007F0007E0007E0003E0007C0001F0007C0001F8007C0001F8007C000
0F8007C0000FC007C0000FC007C0000FC007C0000FC007C0000FC007C0000FC007C0000F
C007C0000FC007C0000FC007C0001F8007C0001F8007C0001F0007C0003F0007E0003E00
07F0007C0007B000F80007BC01F000070E07E0000607FF80000001FC0000222F7EAD27>
I<001FE000007FFC0001F01E0003E0070007C01F800F801F801F001F803F001F803E000F
007E0000007E0000007C000000FC000000FC000000FC000000FC000000FC000000FC0000
00FC000000FC000000FC0000007E0000007E0000007E0000C03F0000C01F0001C01F8001
800FC0038007E0070001F03E00007FF800001FC0001A207E9E1F>I<000000F80000001F
F80000001FF800000001F800000000F800000000F800000000F800000000F800000000F8
00000000F800000000F800000000F800000000F800000000F800000000F800000000F800
000FE0F800007FF8F80001F81EF80003E007F80007C003F8000F8001F8001F0001F8003F
0000F8003E0000F8007E0000F8007E0000F800FC0000F800FC0000F800FC0000F800FC00
00F800FC0000F800FC0000F800FC0000F800FC0000F800FC0000F8007C0000F8007E0000
F8007E0000F8003E0001F8001F0001F8001F8003F8000F8007F80003E00EFC0001F03CFF
C0007FF0FFC0001FC0F800222F7EAD27>I<001F800000FFF00003E0780007C03E000F80
1E001F001F001F000F803E000F807E0007807E0007C07C0007C0FC0007C0FC0007C0FC00
07C0FFFFFFC0FFFFFFC0FC000000FC000000FC000000FC000000FC0000007E0000007E00
00003E0000C03F0000C01F0001C00F8003800FC0030003E00F0001F03C00007FF800001F
C0001A207E9E1F>I<0003F0000FFC003E1E007C3F00F83F01F03F01F03F03E00C03E000
03E00003E00003E00003E00003E00003E00003E00003E00003E000FFFFE0FFFFE003E000
03E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E000
03E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00007F000
7FFF807FFF80182F7FAE16>I<003F00F800FFC3FE03E1FF1E07807C1E0F807C0C1F003E
001F003E003E001F003E001F003E001F003E001F003E001F003E001F003E001F001F003E
001F003E000F807C00078078000FE1F0000CFFC0001C3F00001C0000001C0000001C0000
001E0000001F0000000FFFF8000FFFFF0007FFFFC00FFFFFF01E0007F83C0000F8780000
7CF800007CF000003CF000003CF000003CF000003CF800007C7C0000F83E0001F01F0003
E007E01F8001FFFE00003FF0001F2D7E9D23>I<07C0000000FFC0000000FFC00000000F
C000000007C000000007C000000007C000000007C000000007C000000007C000000007C0
00000007C000000007C000000007C000000007C000000007C000000007C0FE000007C3FF
800007C703E00007DE01F00007F801F00007F000F80007F000F80007E000F80007E000F8
0007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F800
07C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007
C000F80007C000F80007C000F80007C000F8000FE001FC00FFFE1FFFC0FFFE1FFFC0222E
7EAD27>I<07800FC01FE01FE01FE01FE00FC00780000000000000000000000000000000
0007C0FFC0FFC00FC007C007C007C007C007C007C007C007C007C007C007C007C007C007
C007C007C007C007C007C007C007C007C007C00FE0FFFCFFFC0E2E7EAD14>I<000F0000
1F80003FC0003FC0003FC0003FC0001F80000F0000000000000000000000000000000000
00000000000000000007C000FFC000FFC0000FC00007C00007C00007C00007C00007C000
07C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C000
07C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C000
07C00007C03007C07807C0FC0F80FC0F80FC0F00F81F00783E003FF80007E000123C83AD
16>I<07C0000000FFC0000000FFC00000000FC000000007C000000007C000000007C000
000007C000000007C000000007C000000007C000000007C000000007C000000007C00000
0007C000000007C000000007C000000007C01FFE0007C01FFE0007C00FF00007C007C000
07C007800007C00E000007C01C000007C038000007C070000007C0E0000007C3C0000007
C7C0000007CFE0000007DFF0000007F9F0000007F0F8000007E0FC000007C07E000007C0
3E000007C01F000007C01F800007C00FC00007C007C00007C003E00007C003F00007C001
F8000FE003FC00FFFE07FF80FFFE07FF80212E7EAD25>I<07C0FFC0FFC00FC007C007C0
07C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C0
07C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C0
07C00FE0FFFEFFFE0F2E7EAD14>I<07C07F0007F000FFC3FFC03FFC00FFC783F0783F00
0FCE01F8E01F8007DC00F9C00F8007F800FF800FC007F0007F0007C007E0007E0007C007
E0007E0007C007C0007C0007C007C0007C0007C007C0007C0007C007C0007C0007C007C0
007C0007C007C0007C0007C007C0007C0007C007C0007C0007C007C0007C0007C007C000
7C0007C007C0007C0007C007C0007C0007C007C0007C0007C007C0007C0007C007C0007C
0007C007C0007C0007C007C0007C0007C007C0007C0007C00FE000FE000FE0FFFE0FFFE0
FFFEFFFE0FFFE0FFFE371E7E9D3C>I<07C0FE0000FFC3FF8000FFC703E0000FDE01F000
07F801F00007F000F80007F000F80007E000F80007E000F80007C000F80007C000F80007
C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C0
00F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000
F80007C000F8000FE001FC00FFFE1FFFC0FFFE1FFFC0221E7E9D27>I<001FE000007FF8
0001F03E0003C00F00078007800F0003C01F0003E03E0001F03E0001F07C0000F87C0000
F87C0000F8FC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000FCFC0000
FCFC0000FC7C0000F87C0000F83E0001F03E0001F01F0003E01F0003E00F8007C007C00F
8001F03E00007FF800001FE0001E207E9E23>I<07C0FE0000FFC7FF8000FFCF03E0000F
DC01F00007F800FC0007F0007E0007E0003E0007C0003F0007C0001F8007C0001F8007C0
001F8007C0000FC007C0000FC007C0000FC007C0000FC007C0000FC007C0000FC007C000
0FC007C0000FC007C0001FC007C0001F8007C0001F8007C0003F0007C0003F0007E0007E
0007F0007C0007F000F80007FC01F00007CE07E00007C7FF800007C1FC000007C0000000
07C000000007C000000007C000000007C000000007C000000007C000000007C000000007
C00000000FE0000000FFFE000000FFFE000000222B7E9D27>I<0781F8FF87FEFF8E3F0F
9C3F07B83F07B03F07F01E07E00007E00007E00007E00007C00007C00007C00007C00007
C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C0000F
E000FFFF00FFFF00181E7E9D1C>114 D<01FE1807FFB81E01F83C00F8780078F00038F0
0038F00018F00018F80018FC0018FF00007FF0003FFF001FFFC00FFFF001FFF8001FFC00
01FCC0007EC0003EC0003EE0001EE0001EF0001EF0001EF8003CF8003CFC0078FF01F0E3
FFC0C0FF0017207E9E1C>I<00600000600000600000600000E00000E00000E00001E000
03E00003E00007E0001FE000FFFFF0FFFFF003E00003E00003E00003E00003E00003E000
03E00003E00003E00003E00003E00003E00003E00003E00003E00003E01803E01803E018
03E01803E01803E01803E01803E03801F03001F07000F860003FE0000F80152A7FA81B>
I<07C000F800FFC01FF800FFC01FF8000FC001F80007C000F80007C000F80007C000F800
07C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007
C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C000F80007C0
00F80007C001F80007C001F80007C001F80007C003F80003E007F80003E00EFC0001F81C
FFC0007FF8FFC0001FE0F800221F7E9D27>I<FFFC01FFC0FFFC01FFC00FE0007E0007E0
007C0007E000380003E000300003E000700001F000600001F000600000F800C00000F800
C00000F800C000007C018000007C018000003E030000003E030000003F070000001F0600
00001F060000000F8C0000000F8C0000000FDC00000007D800000007D800000003F00000
0003F000000003F000000001E000000001E000000000C00000221E7F9C25>I<FFFC3FFE
07FFFFFC3FFE07FF0FE003F001F80FC003E000F007C001E000E007C001F000E003E003F0
00C003E003F000C003E007F801C001F00678018001F00678018001F80E7C038000F80C3C
030000F80C3C0300007C181E0600007C181E0600007C181F0600003E300F0C00003E300F
0C00003E300F8C00001F60079800001F60079800001F6007D800000FC003F000000FC003
F000000FC003F00000078001E00000078001E00000078001E00000030000C000301E7F9C
33>I<FFFC07FF80FFFC07FF800FF003FC0003F001F00001F001C00001F803800000F803
0000007C060000003E0E0000001F1C0000001FB80000000FB000000007E000000003E000
000001F000000003F800000007F8000000067C0000000C3E0000001C1F000000381F8000
00700F800000E007C00000E003E00003C003F00007C001F8001FE003FC00FFF007FFC0FF
F007FFC0221D7F9C25>I<FFFC01FFC0FFFC01FFC00FE0007E0007E0007C0007E0003800
03E000300003F000700001F000600001F000600000F800C00000F800C00000FC01C00000
7C018000007E038000003E030000003E030000001F060000001F060000001F8E0000000F
8C0000000F8C00000007D800000007D800000003F000000003F000000003F000000001E0
00000001E000000000C000000000C0000000018000000001800000000380000000030000
007803000000FC06000000FC06000000FC0C000000FC1C00000078380000007070000000
3FE00000000F80000000222B7F9C25>I<3FFFFF803FFFFF803F003F803C003F0038007E
003000FC007001FC006001F8006003F0006007E000600FE000000FC000001F8000003F00
00007F0000007E000000FC018001F8018003F8018003F0018007E003800FC003801FC003
001F8003003F0007007E000F00FE003F00FFFFFF00FFFFFF00191D7E9C1F>I<FFFFFFFF
FFFFFFFFFCFFFFFFFFFFFFFFFFFC4602809247>124 D E /Fm 10
58 df<00FF0003FFC00781E00F00F01E00783C003C3C003C78001E78001E78001E78001E
F8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001F
F8001F78001E78001E7C003E3C003C3C003C1E00780F00F00781E003FFC000FF0018227D
A01E>48 D<00E00001E00007E000FFE000F9E00001E00001E00001E00001E00001E00001
E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001
E00001E00001E00001E00001E00001E00001E00001E00003F000FFFFC0FFFFC012217AA0
1E>I<01FC0007FF801C0FC03003E06001F06000F8F800F8FC00FCFC00FCFC007C78007C
3000FC0000FC0000F80000F80001F00003E00003C0000780000F00001E00003800007000
00E00001C00C03800C0600180C00181800183FFFF87FFFF8FFFFF0FFFFF016217CA01E>
I<00FF0003FFC00F03E01C00F01C00F83E00FC3E007C3E007C1E00FC0C00FC0000F80000
F80001F00003E0000FC001FF0001FF000003E00000F000007800007C00003E00003F3000
3F78003FFC003FFC003FFC003EF8007E60007C3800F81E03F00FFFC001FF0018227DA01E
>I<0000E00001E00001E00003E00007E00007E0000DE0001DE00039E00031E00061E000
E1E000C1E00181E00381E00701E00601E00C01E01C01E01801E03001E07001E0E001E0FF
FFFFFFFFFF0001E00001E00001E00001E00001E00001E00003F0003FFF003FFF18227DA1
1E>I<1000301E01F01FFFE01FFFC01FFF801FFE001BF000180000180000180000180000
18000018FE001BFF801F03C01C01E01800F01800F800007800007800007C00007C30007C
78007CF8007CF8007CF80078F000F86000F07001E03801E01E078007FF0001F80016227C
A01E>I<000FC0007FF001F03803C01807803C0F007C1E007C1C00383C00003C00007C00
00780000787FC0F9FFE0FB80F0FE0038FE003CFC001EFC001EF8001FF8001FF8001FF800
1F78001F78001F78001F3C001E3C001E1C003C1E00380F00700781E001FFC0007F001822
7DA01E>I<3000003C00003FFFFF3FFFFF7FFFFE7FFFFC60001C600038600070C000E0C0
00C00001C0000380000700000600000E00001C00001C0000380000380000780000780000
780000F00000F00000F00000F00001F00001F00001F00001F00001F00001F00001F00000
E00018237CA11E>I<007F0003FFC00781E00E00701C003818001C38001C38001C38001C
3C001C3F00381FC0781FE0F00FF9E007FF8001FF8001FFC007FFF00F0FF81C03FC3801FE
70007E70001FE0000FE00007E00007E00007E0000670000E78000C3C00381F00F007FFC0
00FF0018227DA01E>I<00FE0003FFC00781E00E00701C00783C003878003C78003CF800
1EF8001EF8001EF8001FF8001FF8001FF8001F78003F78003F3C007F1C007F0F01DF07FF
9F03FE1E00001E00001E00003E00003C1C00383E00783E00703C00E01801C01C07800FFE
0003F80018227DA01E>I E /Fn 61 123 df<0000000FFF0003FF00000001FFFFC03FFF
C000000FFFFFF1FFFFE000007FFFFFFFFFFFF00001FFF803FFFE1FF80003FF8003FFF81F
FC000FFF0007FFF03FFC001FFE000FFFE03FFC003FFC000FFFE03FFC003FF8000FFFC03F
FC007FF0000FFFC03FFC007FF0000FFFC01FF800FFF0000FFF801FF800FFE00007FF8007
E000FFE00003FF80018000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
00FFFFFFFFFFFFFFF000FFFFFFFFFFFFFFF000FFFFFFFFFFFFFFF000FFFFFFFFFFFFFFF0
00FFFFFFFFFFFFFFF00000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000
0000FFE00003FF80000000FFE00003FF80000000FFE00003FF8000007FFFFFC1FFFFFF80
007FFFFFC1FFFFFF80007FFFFFC1FFFFFF80007FFFFFC1FFFFFF80007FFFFFC1FFFFFF80
0046467EC541>11 D<0000000FFF0000000001FFFFC00000000FFFFFF00000007FFFFFF8
000001FFF803FC000003FFC000FE00000FFF0003FE00001FFE0007FF00003FFC000FFF00
003FF8000FFF00007FF0000FFF00007FF0001FFF8000FFF0000FFF0000FFE0000FFF0000
FFE0000FFF0000FFE0000FFF0000FFE00007FE0000FFE00001F80000FFE00000000000FF
E00000000000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE0
0000000000FFE001FFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFF
FFFF80FFFFFFFFFFFF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003
FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF
8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF80
00FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000
FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FF
E00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE0
0003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF8000FFE00003FF807FFFFFC1
FFFFFF7FFFFFC1FFFFFF7FFFFFC1FFFFFF7FFFFFC1FFFFFF7FFFFFC1FFFFFF38467EC53E
>I<07C01FF03FF87FFCFFFCFFFEFFFEFFFFFFFFFFFFFFFF7FFF3FFF1FFF07CF000F000F
001F001E001E003E003E003C007C00F800F801F003F003E007C01F801F001E000C001022
788E1F>44 D<FFFFFFF8FFFFFFF8FFFFFFF8FFFFFFF8FFFFFFF8FFFFFFF8FFFFFFF8FFFF
FFF8FFFFFFF81D097F9A25>I<07C01FF03FF87FFCFFFEFFFEFFFEFFFEFFFEFFFEFFFE7F
FC3FF81FF007C00F0F788E1F>I<0000000001C00000000003E00000000007E000000000
07E0000000000FE0000000000FC0000000001FC0000000001F80000000001F8000000000
3F80000000003F00000000007F00000000007E00000000007E0000000000FE0000000000
FC0000000001FC0000000001F80000000001F80000000003F80000000003F00000000003
F00000000007F00000000007E0000000000FE0000000000FC0000000000FC0000000001F
C0000000001F80000000003F80000000003F00000000003F00000000007F00000000007E
0000000000FE0000000000FC0000000000FC0000000001FC0000000001F80000000003F8
0000000003F00000000003F00000000007F00000000007E0000000000FE0000000000FC0
000000000FC0000000001FC0000000001F80000000003F80000000003F00000000003F00
000000007F00000000007E00000000007E0000000000FE0000000000FC0000000001FC00
00000001F80000000001F80000000003F80000000003F00000000007F00000000007E000
00000007E0000000000FE0000000000FC0000000001FC0000000001F80000000001F8000
0000003F80000000003F00000000007F00000000007E00000000007E0000000000FE0000
000000FC0000000001FC0000000001F80000000001F80000000003F80000000003F00000
000003F00000000007F00000000007E0000000000FE0000000000FC0000000000FC00000
00001FC0000000001F80000000003F80000000003F00000000003F00000000007F000000
00007E0000000000FE0000000000FC0000000000FC0000000000F8000000000078000000
00002B647ACA38>I<00003FF800000001FFFF0000000FFFFFE000003FFFFFF800007FF0
1FFC0000FFC007FE0001FF0001FF0003FE0000FF8007FE0000FFC007FC00007FC00FFC00
007FE00FF800003FE01FF800003FF01FF800003FF03FF800003FF83FF800003FF83FF000
001FF87FF000001FFC7FF000001FFC7FF000001FFC7FF000001FFC7FF000001FFC7FF000
001FFCFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000
001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000
001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000001FFEFFF000
001FFEFFF000001FFEFFF000001FFEFFF000001FFE7FF000001FFC7FF000001FFC7FF000
001FFC7FF000001FFC7FF000001FFC3FF800003FF83FF800003FF83FF800003FF81FF800
003FF01FF800003FF00FF800003FE00FFC00007FE007FC00007FC007FE0000FFC003FF00
01FF8001FF8003FF0000FFC007FE00007FF01FFC00003FFFFFF800000FFFFFE0000003FF
FF800000003FF800002F427CC038>I<000003C000000007C00000001FC00000007FC000
0003FFC000003FFFC000FFFFFFC000FFFFFFC000FFFFFFC000FFFFFFC000FFC3FFC00000
03FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003
FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FF
C0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0
000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC000
0003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC00000
03FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003
FFC0000003FFC0000003FFC0000003FFC0000003FFC0000003FFC000FFFFFFFFFCFFFFFF
FFFCFFFFFFFFFCFFFFFFFFFCFFFFFFFFFC264177C038>I<0000FFE00000000FFFFE0000
003FFFFF800000FFFFFFE00003FFFFFFF80007FC03FFFE000FE0007FFF001F80003FFF80
3F00000FFFC07F000007FFC07FC00007FFE07FF00003FFE0FFF00001FFF0FFF80001FFF0
FFF80001FFF8FFF80000FFF8FFF80000FFF8FFF80000FFF8FFF80000FFF87FF00000FFF8
3FE00000FFF81FC00000FFF800000000FFF800000000FFF000000001FFF000000001FFF0
00000001FFE000000003FFE000000003FFC000000007FF800000000FFF000000000FFF00
0000001FFC000000003FF8000000003FF0000000007FE000000000FFC000000001FF0000
000003FE0000000007FC000000000FF0000000001FE0000000003F80000000007F000078
0000FE0000780001FC0000780003F80000F80007E00000F0000FC00000F0001F800000F0
003F000000F0007C000001F000F8000003F001FFFFFFFFF003FFFFFFFFE007FFFFFFFFE0
0FFFFFFFFFE01FFFFFFFFFE03FFFFFFFFFE07FFFFFFFFFE0FFFFFFFFFFE0FFFFFFFFFFC0
FFFFFFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC02D417BC038>I<0000FFF000000007FFFF00
00001FFFFFC000007FFFFFF00000FF007FF80003F8003FFE0007E0001FFF0007E0000FFF
000FF80007FF800FFE0007FF801FFE0007FFC01FFF0007FFC01FFF0007FFC01FFF0007FF
C01FFF0007FFC01FFF0007FFC01FFF0007FFC00FFE0007FFC007FC0007FF8003F8000FFF
800000000FFF000000001FFF000000001FFE000000003FFC000000007FF800000000FFF0
00000001FFE00000000FFF80000007FFFE00000007FFF800000007FFFF00000007FFFFC0
00000000FFF0000000003FFC000000000FFE000000000FFF8000000007FF8000000003FF
C000000003FFE000000003FFE000000001FFF000000001FFF000000001FFF800000001FF
F800000001FFF80FC00001FFF83FF00001FFF87FF80001FFF87FF80001FFF8FFFC0001FF
F8FFFC0001FFF8FFFC0001FFF0FFFC0001FFF0FFFC0003FFF0FFFC0003FFE07FF80003FF
E07FF00007FFC07FE00007FFC03F80000FFF801FF0001FFF000FFE00FFFE0007FFFFFFF8
0001FFFFFFF000007FFFFFC000001FFFFE00000001FFE000002D427BC038>I<00000000
3F0000000000003F0000000000007F000000000000FF000000000001FF000000000003FF
000000000003FF000000000007FF00000000000FFF00000000001FFF00000000003FFF00
000000003FFF00000000007FFF0000000000FFFF0000000001F7FF0000000003E7FF0000
000007E7FF0000000007C7FF000000000F87FF000000001F07FF000000003E07FF000000
007E07FF000000007C07FF00000000F807FF00000001F007FF00000003E007FF00000007
E007FF00000007C007FF0000000F8007FF0000001F0007FF0000003E0007FF0000007C00
07FF0000007C0007FF000000F80007FF000001F00007FF000003E00007FF000007C00007
FF00000FC00007FF00000F800007FF00001F000007FF00003E000007FF00007C000007FF
0000FC000007FF0000FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF
80FFFFFFFFFFFF800000000FFF00000000000FFF00000000000FFF00000000000FFF0000
0000000FFF00000000000FFF00000000000FFF00000000000FFF00000000000FFF000000
00000FFF00000000000FFF00000000000FFF000000007FFFFFFF8000007FFFFFFF800000
7FFFFFFF8000007FFFFFFF8000007FFFFFFF8031417DC038>I<07000000030007E00000
3F0007FF0007FF0007FFFFFFFF0007FFFFFFFE0007FFFFFFFC0007FFFFFFF80007FFFFFF
F00007FFFFFFE00007FFFFFF800007FFFFFE000007FFFFFC000007FFFFE0000007FFFF00
000007C00000000007C00000000007C00000000007C00000000007C00000000007C00000
000007C00000000007C00000000007C00000000007C00000000007C03FF0000007C1FFFF
000007C7FFFFC00007DFFFFFF00007FFE03FFC0007FF000FFE0007FC0007FF0007F00003
FF8007E00003FFC007C00001FFC003800001FFE000000001FFE000000000FFF000000000
FFF000000000FFF000000000FFF800000000FFF800000000FFF800000000FFF80F800000
FFF83FE00000FFF87FF00000FFF8FFF00000FFF8FFF80000FFF8FFF80000FFF8FFF80000
FFF8FFF80000FFF0FFF00000FFF0FFF00001FFF07FE00001FFE07FC00001FFE07E000003
FFC03E000003FFC03F000007FF801FC0000FFF000FF0001FFE0007FE00FFFC0003FFFFFF
F00000FFFFFFE000003FFFFF8000000FFFFC00000001FFC000002D427BC038>I<000001
FF800000001FFFF00000007FFFFC000001FFFFFF000007FF807F80000FFC001F80003FF0
001FC0007FE0007FC000FFC000FFE001FF8001FFE003FF8001FFE003FF0001FFE007FE00
01FFE00FFE0001FFE00FFE0001FFE01FFC0000FFC01FFC00007F801FFC00001E003FFC00
0000003FFC000000003FF8000000007FF8000000007FF8000000007FF807FC00007FF81F
FF8000FFF87FFFE000FFF8FFFFF800FFF9F01FFC00FFFBC007FE00FFFF8003FF00FFFF80
03FF80FFFF0001FFC0FFFE0001FFC0FFFE0000FFE0FFFE0000FFE0FFFC0000FFF0FFFC00
00FFF0FFFC0000FFF0FFFC0000FFF8FFF80000FFF8FFF80000FFF8FFF80000FFF8FFF800
00FFF87FF80000FFF87FF80000FFF87FF80000FFF87FF80000FFF87FF80000FFF83FF800
00FFF83FF80000FFF83FF80000FFF03FFC0000FFF01FFC0000FFF01FFC0000FFF00FFC00
01FFE00FFC0001FFE007FE0001FFC007FF0003FF8003FF8003FF0001FFC007FE0000FFE0
1FFC00007FFFFFF800001FFFFFF0000007FFFFC0000001FFFF000000003FF000002D427B
C038>I<1E00000000001F00000000001FFC000000001FFFFFFFFFFE1FFFFFFFFFFE1FFF
FFFFFFFE1FFFFFFFFFFE3FFFFFFFFFFE3FFFFFFFFFFC3FFFFFFFFFF83FFFFFFFFFF03FFF
FFFFFFE03FFFFFFFFFC03FFFFFFFFFC07FFFFFFFFF807E0000003F007C0000007E007C00
0000FC0078000000F80078000001F80078000003F000F8000007E000F000000FC000F000
000F8000F000001F80000000003F00000000007E0000000000FC0000000000FC00000000
01F80000000003F80000000003F00000000007F0000000000FE0000000000FE000000000
1FE0000000001FC0000000003FC0000000003FC0000000007FC0000000007F8000000000
FF8000000000FF8000000001FF8000000001FF8000000001FF8000000003FF8000000003
FF0000000003FF0000000003FF0000000007FF0000000007FF0000000007FF0000000007
FF0000000007FF000000000FFF000000000FFF000000000FFF000000000FFF000000000F
FF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF0000000007
FE0000000003FC0000000001F80000002F447AC238>I<00007FF000000003FFFF000000
0FFFFFC000003FFFFFF000007F801FFC0001FC0003FE0003F80001FF0003F00000FF0007
E000007F8007E000003F800FC000003FC00FC000003FC01FC000001FC01FC000001FC01F
E000001FC01FE000001FC01FF000001FC01FF800001FC01FFE00003FC01FFF00003F801F
FFC0007F801FFFF0007F000FFFFC00FF000FFFFE01FE0007FFFF83FC0007FFFFE7F80003
FFFFFFE00001FFFFFFC00000FFFFFF0000007FFFFFC000003FFFFFE000000FFFFFF80000
0FFFFFFC00003FFFFFFE0000FFFFFFFF0001FF3FFFFF8007FC0FFFFFC00FF803FFFFE01F
F000FFFFE01FE0007FFFF03FE0001FFFF07FC00007FFF07F800003FFF87F800000FFF8FF
8000007FF8FF0000003FF8FF0000001FF8FF0000000FF8FF0000000FF8FF00000007F8FF
00000007F8FF00000007F8FF80000007F07F80000007F07F8000000FF07FC000000FE03F
E000001FE03FF000003FC01FF800007F800FFE0001FF0007FFC00FFE0003FFFFFFFC0000
FFFFFFF000003FFFFFC000000FFFFF00000000FFF000002D427BC038>I<00007FF00000
0007FFFE0000001FFFFF8000007FFFFFE00000FFE03FF00001FF800FF80003FF0007FC00
07FE0007FE000FFC0003FF001FFC0001FF003FFC0001FF803FFC0001FF807FF80001FFC0
7FF80000FFC07FF80000FFE07FF80000FFE0FFF80000FFE0FFF80000FFF0FFF80000FFF0
FFF80000FFF0FFF80000FFF0FFF80000FFF0FFF80000FFF0FFF80000FFF8FFF80000FFF8
FFF80000FFF8FFF80000FFF8FFF80001FFF87FF80001FFF87FF80001FFF87FF80001FFF8
3FF80003FFF83FF80003FFF81FFC0003FFF81FFC0007FFF80FFE000FFFF807FE000FFFF8
03FF001EFFF801FFC07CFFF800FFFFF8FFF8003FFFF0FFF8000FFFC0FFF00001FF00FFF0
00000000FFF000000000FFF000000000FFE000000001FFE000000001FFE003C00001FFE0
0FF00001FFC01FF80001FFC03FFC0003FF803FFC0003FF803FFC0003FF003FFC0007FE00
3FFC000FFE003FFC000FFC003FF8001FF8001FF0003FF0001FC000FFE0000FF003FFC000
07FFFFFF800003FFFFFE000001FFFFF80000007FFFE000000007FE0000002D427BC038>
I<000000001F8000000000000000001F8000000000000000003FC000000000000000003F
C000000000000000007FE000000000000000007FE000000000000000007FE00000000000
000000FFF00000000000000000FFF00000000000000001FFF80000000000000001FFF800
00000000000001FFF80000000000000003FFFC0000000000000003FFFC00000000000000
07FFFE0000000000000007FFFE0000000000000007FFFE000000000000000FFFFF000000
000000000F9FFF000000000000001F9FFF800000000000001F1FFF800000000000001F0F
FF800000000000003F0FFFC00000000000003E07FFC00000000000007E07FFE000000000
00007C07FFE00000000000007C03FFE0000000000000FC03FFF0000000000000F801FFF0
000000000001F801FFF8000000000001F001FFF8000000000001F000FFF8000000000003
F000FFFC000000000003E0007FFC000000000007E0007FFE000000000007C0007FFE0000
00000007C0003FFE00000000000FC0003FFF00000000000F80001FFF00000000001F8000
1FFF80000000001F00000FFF80000000001F00000FFF80000000003F00000FFFC0000000
003E000007FFC0000000007E000007FFE0000000007FFFFFFFFFE0000000007FFFFFFFFF
E000000000FFFFFFFFFFF000000000FFFFFFFFFFF000000001FFFFFFFFFFF800000001F0
000000FFF800000001F0000000FFF800000003F0000000FFFC00000003E00000007FFC00
000007E00000007FFE00000007C00000003FFE00000007C00000003FFE0000000F800000
003FFF0000000F800000001FFF0000001F800000001FFF8000001F000000000FFF800000
3F000000000FFFC000003E000000000FFFC000007E0000000007FFC000FFFFFF00000FFF
FFFFF0FFFFFF00000FFFFFFFF0FFFFFF00000FFFFFFFF0FFFFFF00000FFFFFFFF0FFFFFF
00000FFFFFFFF04C457CC455>65 D<FFFFFFFFFFFF000000FFFFFFFFFFFFF00000FFFFFF
FFFFFFFE0000FFFFFFFFFFFFFF8000FFFFFFFFFFFFFFE000003FFC000007FFF000003FFC
000001FFF800003FFC0000007FFC00003FFC0000003FFE00003FFC0000001FFF00003FFC
0000001FFF00003FFC0000000FFF80003FFC0000000FFF80003FFC0000000FFF80003FFC
00000007FFC0003FFC00000007FFC0003FFC00000007FFC0003FFC00000007FFC0003FFC
00000007FFC0003FFC00000007FFC0003FFC00000007FFC0003FFC0000000FFF80003FFC
0000000FFF80003FFC0000001FFF00003FFC0000001FFF00003FFC0000003FFE00003FFC
0000007FFC00003FFC000000FFF800003FFC000001FFF000003FFC000007FFE000003FFC
0000FFFF8000003FFFFFFFFFFC0000003FFFFFFFFFF00000003FFFFFFFFFFF0000003FFF
FFFFFFFFE000003FFC000001FFF800003FFC0000007FFC00003FFC0000001FFE00003FFC
0000000FFF00003FFC00000007FF80003FFC00000007FFC0003FFC00000003FFE0003FFC
00000003FFE0003FFC00000001FFF0003FFC00000001FFF0003FFC00000001FFF0003FFC
00000001FFF8003FFC00000001FFF8003FFC00000001FFF8003FFC00000001FFF8003FFC
00000001FFF8003FFC00000001FFF8003FFC00000001FFF8003FFC00000001FFF0003FFC
00000001FFF0003FFC00000003FFF0003FFC00000003FFE0003FFC00000007FFE0003FFC
0000000FFFC0003FFC0000001FFFC0003FFC0000003FFF80003FFC000000FFFF00003FFC
000007FFFE00FFFFFFFFFFFFFFF800FFFFFFFFFFFFFFF000FFFFFFFFFFFFFFC000FFFFFF
FFFFFFFE0000FFFFFFFFFFFFE0000045447CC350>I<00000000FFF00000700000001FFF
FF0000F0000001FFFFFFE001F0000007FFFFFFF803F000003FFFFFFFFE07F00000FFFFE0
01FF0FF00001FFFE00003F9FF00007FFF000000FFFF0000FFFC0000007FFF0001FFF0000
0003FFF0003FFE00000001FFF0007FFC00000000FFF000FFF8000000007FF001FFF00000
00003FF003FFE0000000001FF007FFE0000000001FF007FFC0000000000FF00FFF800000
00000FF00FFF800000000007F01FFF000000000007F01FFF000000000003F03FFF000000
000003F03FFE000000000003F03FFE000000000003F07FFE000000000001F07FFE000000
000001F07FFE000000000001F07FFC00000000000000FFFC00000000000000FFFC000000
00000000FFFC00000000000000FFFC00000000000000FFFC00000000000000FFFC000000
00000000FFFC00000000000000FFFC00000000000000FFFC00000000000000FFFC000000
00000000FFFC00000000000000FFFC00000000000000FFFC00000000000000FFFC000000
000000007FFC000000000000007FFE000000000000007FFE000000000000F07FFE000000
000000F03FFE000000000000F03FFE000000000000F03FFF000000000000F01FFF000000
000001F01FFF000000000001E00FFF800000000001E00FFF800000000003E007FFC00000
000003C007FFE00000000007C003FFE00000000007C001FFF0000000000F8000FFF80000
00001F00007FFC000000003F00003FFE000000007E00001FFF80000000FC00000FFFC000
0001F8000007FFF0000007F0000001FFFE00001FE0000000FFFFF001FF800000003FFFFF
FFFF0000000007FFFFFFFC0000000001FFFFFFF000000000001FFFFF80000000000000FF
F800000044467AC451>I<FFFFFFFFFFFF00000000FFFFFFFFFFFFF0000000FFFFFFFFFF
FFFE000000FFFFFFFFFFFFFF800000FFFFFFFFFFFFFFE00000003FFE00001FFFF8000000
3FFE000001FFFC0000003FFE0000003FFF0000003FFE0000000FFF8000003FFE00000007
FFC000003FFE00000003FFE000003FFE00000001FFF000003FFE00000000FFF000003FFE
000000007FF800003FFE000000003FFC00003FFE000000003FFC00003FFE000000001FFE
00003FFE000000001FFE00003FFE000000000FFF00003FFE000000000FFF00003FFE0000
00000FFF80003FFE000000000FFF80003FFE0000000007FF80003FFE0000000007FFC000
3FFE0000000007FFC0003FFE0000000007FFC0003FFE0000000007FFC0003FFE00000000
07FFC0003FFE0000000007FFE0003FFE0000000007FFE0003FFE0000000007FFE0003FFE
0000000007FFE0003FFE0000000007FFE0003FFE0000000007FFE0003FFE0000000007FF
E0003FFE0000000007FFE0003FFE0000000007FFE0003FFE0000000007FFE0003FFE0000
000007FFE0003FFE0000000007FFE0003FFE0000000007FFE0003FFE0000000007FFC000
3FFE0000000007FFC0003FFE0000000007FFC0003FFE0000000007FFC0003FFE00000000
07FFC0003FFE0000000007FF80003FFE000000000FFF80003FFE000000000FFF80003FFE
000000000FFF00003FFE000000001FFF00003FFE000000001FFE00003FFE000000003FFE
00003FFE000000003FFC00003FFE000000007FF800003FFE00000000FFF800003FFE0000
0000FFF000003FFE00000001FFE000003FFE00000007FFC000003FFE0000000FFF800000
3FFE0000003FFF0000003FFE000001FFFE0000003FFE00000FFFF80000FFFFFFFFFFFFFF
F00000FFFFFFFFFFFFFFC00000FFFFFFFFFFFFFE000000FFFFFFFFFFFFF0000000FFFFFF
FFFFFF000000004B447CC356>I<FFFFFFFFFFFFFFF800FFFFFFFFFFFFFFF800FFFFFFFF
FFFFFFF800FFFFFFFFFFFFFFF800FFFFFFFFFFFFFFFC00001FFF000001FFFC00001FFF00
00003FFC00001FFF0000000FFC00001FFF00000003FC00001FFF00000001FC00001FFF00
000000FC00001FFF00000000FC00001FFF000000007E00001FFF000000003E00001FFF00
0000003E00001FFF000000003E00001FFF000000001E00001FFF000000001E00001FFF00
0078001E00001FFF000078001E00001FFF000078000F00001FFF000078000F00001FFF00
0078000F00001FFF000078000F00001FFF0000F8000000001FFF0000F8000000001FFF00
00F8000000001FFF0001F8000000001FFF0003F8000000001FFF001FF8000000001FFFFF
FFF8000000001FFFFFFFF8000000001FFFFFFFF8000000001FFFFFFFF8000000001FFFFF
FFF8000000001FFF001FF8000000001FFF0003F8000000001FFF0001F8000000001FFF00
00F8000000001FFF0000F8000000001FFF0000F80001E0001FFF0000780001E0001FFF00
00780001E0001FFF0000780003C0001FFF0000780003C0001FFF0000780003C0001FFF00
00780003C0001FFF0000000003C0001FFF0000000007C0001FFF0000000007C0001FFF00
0000000780001FFF000000000780001FFF000000000F80001FFF000000000F80001FFF00
0000001F80001FFF000000001F80001FFF000000003F80001FFF000000007F00001FFF00
000000FF00001FFF00000001FF00001FFF00000007FF00001FFF0000001FFF00001FFF00
0001FFFF00FFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFE00FFFFFFFF
FFFFFFFE00FFFFFFFFFFFFFFFE0043447DC34A>I<FFFFFFFFFFFFFF80FFFFFFFFFFFFFF
80FFFFFFFFFFFFFF80FFFFFFFFFFFFFF80FFFFFFFFFFFFFFC0003FFE00001FFFC0003FFE
000001FFC0003FFE0000007FC0003FFE0000003FC0003FFE0000001FC0003FFE0000000F
C0003FFE00000007C0003FFE00000007E0003FFE00000003E0003FFE00000003E0003FFE
00000003E0003FFE00000001E0003FFE00000001E0003FFE00000001E0003FFE0001E001
E0003FFE0001E000F0003FFE0001E000F0003FFE0001E000F0003FFE0001E000F0003FFE
0001E00000003FFE0003E00000003FFE0003E00000003FFE0003E00000003FFE0007E000
00003FFE000FE00000003FFE007FE00000003FFFFFFFE00000003FFFFFFFE00000003FFF
FFFFE00000003FFFFFFFE00000003FFFFFFFE00000003FFE007FE00000003FFE000FE000
00003FFE0007E00000003FFE0003E00000003FFE0003E00000003FFE0003E00000003FFE
0001E00000003FFE0001E00000003FFE0001E00000003FFE0001E00000003FFE0001E000
00003FFE0001E00000003FFE0000000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE00000000
00003FFE0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000FFFFFFFFF0000000FFFFFFFFF00000
00FFFFFFFFF0000000FFFFFFFFF0000000FFFFFFFFF00000003C447CC346>I<00000000
FFF0000070000000001FFFFF0000F000000001FFFFFFE001F000000007FFFFFFF803F000
00003FFFFFFFFE07F0000000FFFFE001FF0FF0000001FFFE00003F9FF0000007FFF00000
0FFFF000000FFFC0000007FFF000001FFF00000003FFF000003FFE00000001FFF000007F
FC00000000FFF00000FFF8000000007FF00001FFF0000000003FF00003FFE0000000001F
F00007FFE0000000001FF00007FFC0000000000FF0000FFF80000000000FF0000FFF8000
00000007F0001FFF000000000007F0001FFF000000000003F0003FFF000000000003F000
3FFE000000000003F0003FFE000000000003F0007FFE000000000001F0007FFE00000000
0001F0007FFE000000000001F0007FFC0000000000000000FFFC0000000000000000FFFC
0000000000000000FFFC0000000000000000FFFC0000000000000000FFFC000000000000
0000FFFC0000000000000000FFFC0000000000000000FFFC0000000000000000FFFC0000
000000000000FFFC0000000000000000FFFC0000000000000000FFFC0000000000000000
FFFC0000000000000000FFFC0000007FFFFFFFF07FFC0000007FFFFFFFF07FFE0000007F
FFFFFFF07FFE0000007FFFFFFFF07FFE0000007FFFFFFFF03FFE0000000001FFF0003FFE
0000000001FFF0003FFF0000000001FFF0001FFF0000000001FFF0001FFF0000000001FF
F0000FFF8000000001FFF0000FFF8000000001FFF00007FFC000000001FFF00007FFE000
000001FFF00003FFE000000001FFF00001FFF000000001FFF00000FFF800000001FFF000
007FFC00000001FFF000003FFE00000003FFF000001FFF80000003FFF000000FFFC00000
07FFF0000007FFF000000FFFF0000001FFFE00003FFFF0000000FFFFF001FF9FF0000000
3FFFFFFFFF0FF000000007FFFFFFFC03F000000001FFFFFFF000F0000000001FFFFFC000
300000000000FFFC000000004C467AC458>I<FFFFFFFF8003FFFFFFFEFFFFFFFF8003FF
FFFFFEFFFFFFFF8003FFFFFFFEFFFFFFFF8003FFFFFFFEFFFFFFFF8003FFFFFFFE003FFE
00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF8
00003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE0000
0000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF80000
3FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000
FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE
00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF8
00003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFFFFFF
FFFFFFF800003FFFFFFFFFFFFFF800003FFFFFFFFFFFFFF800003FFFFFFFFFFFFFF80000
3FFFFFFFFFFFFFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000
FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE
00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF8
00003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE0000
0000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF80000
3FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000
FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE
00000000FFF800003FFE00000000FFF800003FFE00000000FFF800003FFE00000000FFF8
00FFFFFFFF8003FFFFFFFEFFFFFFFF8003FFFFFFFEFFFFFFFF8003FFFFFFFEFFFFFFFF80
03FFFFFFFEFFFFFFFF8003FFFFFFFE4F447CC358>I<FFFFFFFFE0FFFFFFFFE0FFFFFFFF
E0FFFFFFFFE0FFFFFFFFE0001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000
001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF000000
1FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001F
FF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF
0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF00
00001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000
001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF000000
1FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000001F
FF0000001FFF0000001FFF0000FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFF
FFE023447DC32A>I<FFFFFFFF800003FFFFF8FFFFFFFF800003FFFFF8FFFFFFFF800003
FFFFF8FFFFFFFF800003FFFFF8FFFFFFFF800003FFFFF8003FFE0000000007E000003FFE
000000000FC000003FFE000000001F8000003FFE000000007E0000003FFE00000000FC00
00003FFE00000001F80000003FFE00000003F00000003FFE00000007E00000003FFE0000
001F800000003FFE0000003F000000003FFE0000007E000000003FFE000000FC00000000
3FFE000001F8000000003FFE000007F0000000003FFE00000FC0000000003FFE00001F80
000000003FFE00003F00000000003FFE00007E00000000003FFE0001FC00000000003FFE
0003F000000000003FFE0007E000000000003FFE000FC000000000003FFE001FE0000000
00003FFE007FF000000000003FFE00FFF800000000003FFE01FFF800000000003FFE03FF
FC00000000003FFE07FFFE00000000003FFE0FFFFF00000000003FFE3F3FFF0000000000
3FFE7E1FFF80000000003FFEFC1FFFC0000000003FFFF80FFFE0000000003FFFF007FFE0
000000003FFFE003FFF0000000003FFF8003FFF8000000003FFF0001FFFC000000003FFE
0000FFFC000000003FFE00007FFE000000003FFE00007FFF000000003FFE00003FFF8000
00003FFE00001FFF800000003FFE00000FFFC00000003FFE00000FFFE00000003FFE0000
07FFF00000003FFE000003FFF00000003FFE000001FFF80000003FFE000001FFFC000000
3FFE000000FFFE0000003FFE0000007FFE0000003FFE0000003FFF0000003FFE0000003F
FF8000003FFE0000001FFFC000003FFE0000000FFFC000003FFE00000007FFE000003FFE
00000007FFF000003FFE00000003FFF800003FFE00000001FFF800FFFFFFFF8000FFFFFF
FCFFFFFFFF8000FFFFFFFCFFFFFFFF8000FFFFFFFCFFFFFFFF8000FFFFFFFCFFFFFFFF80
00FFFFFFFC4E447CC358>75 D<FFFFFFFFF0000000FFFFFFFFF0000000FFFFFFFFF00000
00FFFFFFFFF0000000FFFFFFFFF0000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE00000000
00003FFE0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE00000000
00003FFE0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE00000000
00003FFE0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE
0000000000003FFE0000000000003FFE0000000000003FFE0000000000003FFE00000000
00003FFE0000000000003FFE0000000780003FFE0000000780003FFE0000000780003FFE
0000000780003FFE0000000F80003FFE0000000F00003FFE0000000F00003FFE0000000F
00003FFE0000000F00003FFE0000001F00003FFE0000001F00003FFE0000001F00003FFE
0000003F00003FFE0000003F00003FFE0000007E00003FFE0000007E00003FFE000000FE
00003FFE000001FE00003FFE000003FE00003FFE000007FE00003FFE00001FFE00003FFE
00007FFE00003FFE0003FFFE00FFFFFFFFFFFFFC00FFFFFFFFFFFFFC00FFFFFFFFFFFFFC
00FFFFFFFFFFFFFC00FFFFFFFFFFFFFC0039447CC343>I<FFFFFE0000000000007FFFFF
80FFFFFF000000000000FFFFFF80FFFFFF000000000000FFFFFF80FFFFFF800000000001
FFFFFF80FFFFFF800000000001FFFFFF80003FFF800000000001FFFE0000003DFFC00000
000003DFFE0000003DFFC00000000003DFFE0000003CFFE000000000079FFE0000003CFF
E000000000079FFE0000003C7FF0000000000F1FFE0000003C7FF0000000000F1FFE0000
003C3FF8000000001E1FFE0000003C3FF8000000001E1FFE0000003C1FFC000000003C1F
FE0000003C1FFC000000003C1FFE0000003C1FFC000000003C1FFE0000003C0FFE000000
00781FFE0000003C0FFE00000000781FFE0000003C07FF00000000F01FFE0000003C07FF
00000000F01FFE0000003C03FF80000001E01FFE0000003C03FF80000001E01FFE000000
3C01FFC0000003C01FFE0000003C01FFC0000003C01FFE0000003C01FFC0000003C01FFE
0000003C00FFE0000007801FFE0000003C00FFE0000007801FFE0000003C007FF000000F
001FFE0000003C007FF000000F001FFE0000003C003FF800001E001FFE0000003C003FF8
00001E001FFE0000003C001FFC00003C001FFE0000003C001FFC00003C001FFE0000003C
001FFC00003C001FFE0000003C000FFE000078001FFE0000003C000FFE000078001FFE00
00003C0007FF0000F0001FFE0000003C0007FF0000F0001FFE0000003C0003FF8001E000
1FFE0000003C0003FF8001E0001FFE0000003C0001FFC003C0001FFE0000003C0001FFC0
03C0001FFE0000003C0000FFE00780001FFE0000003C0000FFE00780001FFE0000003C00
00FFE00780001FFE0000003C00007FF00F00001FFE0000003C00007FF00F00001FFE0000
003C00003FF81E00001FFE0000003C00003FF81E00001FFE0000003C00001FFC3C00001F
FE0000003C00001FFC3C00001FFE0000003C00000FFE7800001FFE0000003C00000FFE78
00001FFE0000003C00000FFE7800001FFE0000003C000007FFF000001FFE0000003C0000
07FFF000001FFE0000003C000003FFE000001FFE0000003C000003FFE000001FFE000000
3C000001FFC000001FFE0000003C000001FFC000001FFE0000003C000000FF8000001FFE
0000003C000000FF8000001FFE0000FFFFFF0000FF80007FFFFFFF80FFFFFF00007F0000
7FFFFFFF80FFFFFF00007F00007FFFFFFF80FFFFFF00003E00007FFFFFFF80FFFFFF0000
1C00007FFFFFFF8061447CC36A>I<FFFFFF00000001FFFFFEFFFFFF80000001FFFFFEFF
FFFFC0000001FFFFFEFFFFFFC0000001FFFFFEFFFFFFE0000001FFFFFE003FFFF0000000
007800003FFFF8000000007800003DFFFC000000007800003DFFFE000000007800003CFF
FE000000007800003C7FFF000000007800003C3FFF800000007800003C1FFFC000000078
00003C0FFFE00000007800003C07FFF00000007800003C07FFF80000007800003C03FFF8
0000007800003C01FFFC0000007800003C00FFFE0000007800003C007FFF000000780000
3C003FFF8000007800003C003FFFC000007800003C001FFFC000007800003C000FFFE000
007800003C0007FFF000007800003C0003FFF800007800003C0001FFFC00007800003C00
00FFFE00007800003C0000FFFF00007800003C00007FFF00007800003C00003FFF800078
00003C00001FFFC0007800003C00000FFFE0007800003C000007FFF0007800003C000007
FFF8007800003C000003FFF8007800003C000001FFFC007800003C000000FFFE00780000
3C0000007FFF007800003C0000003FFF807800003C0000001FFFC07800003C0000001FFF
E07800003C0000000FFFE07800003C00000007FFF07800003C00000003FFF87800003C00
000001FFFC7800003C00000000FFFE7800003C00000000FFFF7800003C000000007FFF78
00003C000000003FFFF800003C000000001FFFF800003C000000000FFFF800003C000000
0007FFF800003C0000000003FFF800003C0000000003FFF800003C0000000001FFF80000
3C0000000000FFF800003C00000000007FF800003C00000000003FF800003C0000000000
1FF800003C00000000001FF800003C00000000000FF800003C000000000007F800FFFFFF
0000000003F800FFFFFF0000000001F800FFFFFF0000000000F800FFFFFF000000000078
00FFFFFF000000000078004F447CC358>I<00000007FFC0000000000000FFFFFE000000
000007FFFFFFC0000000001FFFFFFFF0000000007FFE00FFFC00000001FFF0001FFF0000
0007FF800003FFC000000FFF000001FFE000001FFC0000007FF000003FF80000003FF800
007FF00000001FFC0000FFF00000001FFE0001FFE00000000FFF0003FFC000000007FF80
03FFC000000007FF8007FF8000000003FFC007FF8000000003FFC00FFF0000000001FFE0
0FFF0000000001FFE01FFF0000000001FFF01FFE0000000000FFF03FFE0000000000FFF8
3FFE0000000000FFF83FFE0000000000FFF87FFE0000000000FFFC7FFC00000000007FFC
7FFC00000000007FFC7FFC00000000007FFC7FFC00000000007FFCFFFC00000000007FFE
FFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFE
FFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFE
FFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFE
7FFC00000000007FFC7FFE0000000000FFFC7FFE0000000000FFFC7FFE0000000000FFFC
3FFE0000000000FFF83FFE0000000000FFF83FFF0000000001FFF81FFF0000000001FFF0
1FFF0000000001FFF01FFF8000000003FFF00FFF8000000003FFE00FFF8000000003FFE0
07FFC000000007FFC003FFC000000007FF8003FFE00000000FFF8001FFF00000001FFF00
00FFF80000003FFE00007FFC0000007FFC00003FFE000000FFF800001FFF000001FFF000
000FFFC00007FFE0000007FFF0001FFFC0000001FFFE00FFFF00000000FFFFFFFFFE0000
00003FFFFFFFF80000000007FFFFFFC00000000000FFFFFE00000000000007FFC0000000
47467AC454>I<FFFFFFFFFFFF000000FFFFFFFFFFFFF00000FFFFFFFFFFFFFE0000FFFF
FFFFFFFFFF8000FFFFFFFFFFFFFFE000001FFF00000FFFF000001FFF000001FFF800001F
FF0000007FFC00001FFF0000003FFE00001FFF0000001FFF00001FFF0000000FFF80001F
FF0000000FFF80001FFF0000000FFFC0001FFF00000007FFC0001FFF00000007FFC0001F
FF00000007FFE0001FFF00000007FFE0001FFF00000007FFE0001FFF00000007FFE0001F
FF00000007FFE0001FFF00000007FFE0001FFF00000007FFE0001FFF00000007FFE0001F
FF00000007FFE0001FFF00000007FFC0001FFF00000007FFC0001FFF0000000FFF80001F
FF0000000FFF80001FFF0000000FFF00001FFF0000001FFF00001FFF0000003FFE00001F
FF0000007FFC00001FFF000001FFF800001FFF00000FFFF000001FFFFFFFFFFFC000001F
FFFFFFFFFF0000001FFFFFFFFFFC0000001FFFFFFFFFC00000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000001F
FF000000000000001FFF000000000000001FFF000000000000001FFF000000000000FFFF
FFFFE000000000FFFFFFFFE000000000FFFFFFFFE000000000FFFFFFFFE000000000FFFF
FFFFE00000000043447DC34D>I<00000007FFC0000000000000FFFFFE000000000007FF
FFFFC0000000001FFFFFFFF0000000007FFE00FFFC00000001FFF0001FFF00000007FFC0
0007FFC000000FFF000001FFE000001FFE000000FFF000003FFC0000007FF800007FF800
00003FFC0000FFF00000001FFE0001FFE00000000FFF0003FFC000000007FF8003FFC000
000007FF8007FF8000000003FFC007FF8000000003FFC00FFF8000000003FFE00FFF0000
000001FFE01FFF0000000001FFF01FFF0000000001FFF03FFE0000000000FFF83FFE0000
000000FFF83FFE0000000000FFF87FFE0000000000FFFC7FFE0000000000FFFC7FFC0000
0000007FFC7FFC00000000007FFC7FFC00000000007FFCFFFC00000000007FFEFFFC0000
0000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC0000
0000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC0000
0000007FFEFFFC00000000007FFEFFFC00000000007FFEFFFC00000000007FFE7FFC0000
0000007FFC7FFC00000000007FFC7FFC00000000007FFC7FFE0000000000FFFC3FFE0000
000000FFF83FFE0000000000FFF83FFE0000000000FFF81FFE0000000000FFF01FFF0000
000001FFF01FFF0000000001FFF00FFF0000000001FFE00FFF8000FE0003FFE007FF8003
FF8003FFC003FFC007FFC007FF8003FFC00FFFE007FF8001FFE01F83F00FFF0000FFF01E
00F81FFE00007FF83E007C3FFC00003FFC3C003E7FF800001FFE3C001EFFF000000FFF3C
001FFFE0000007FFFE001FFFC0000001FFFE001FFF00000000FFFF80FFFE000000003FFF
FFFFF80000000007FFFFFFE00002000000FFFFFFF0000700000007FFC7F0000700000000
0007F80007000000000003FC000F000000000003FE001F000000000003FF80FF00000000
0003FFFFFF000000000001FFFFFE000000000001FFFFFE000000000001FFFFFE00000000
0000FFFFFE000000000000FFFFFC000000000000FFFFFC0000000000007FFFF800000000
00007FFFF00000000000003FFFF00000000000001FFFE00000000000000FFFC000000000
000007FF0000000000000001FC0048587AC454>I<FFFFFFFFFFF800000000FFFFFFFFFF
FFC0000000FFFFFFFFFFFFF8000000FFFFFFFFFFFFFE000000FFFFFFFFFFFFFF80000000
1FFF00003FFFE00000001FFF000003FFF00000001FFF000000FFF80000001FFF0000007F
FC0000001FFF0000003FFE0000001FFF0000001FFF0000001FFF0000001FFF0000001FFF
0000001FFF8000001FFF0000000FFF8000001FFF0000000FFF8000001FFF0000000FFFC0
00001FFF0000000FFFC000001FFF0000000FFFC000001FFF0000000FFFC000001FFF0000
000FFFC000001FFF0000000FFFC000001FFF0000000FFFC000001FFF0000000FFF800000
1FFF0000000FFF8000001FFF0000001FFF0000001FFF0000001FFF0000001FFF0000003F
FE0000001FFF0000003FFC0000001FFF0000007FFC0000001FFF000001FFF00000001FFF
000007FFE00000001FFF00003FFF800000001FFFFFFFFFFF000000001FFFFFFFFFF80000
00001FFFFFFFFFE0000000001FFFFFFFFFF8000000001FFF0000FFFC000000001FFF0000
3FFF000000001FFF00000FFF800000001FFF000007FFC00000001FFF000003FFE0000000
1FFF000003FFE00000001FFF000001FFF00000001FFF000001FFF00000001FFF000000FF
F80000001FFF000000FFF80000001FFF000000FFF80000001FFF000000FFF80000001FFF
000000FFF80000001FFF000000FFF80000001FFF000000FFF80000001FFF000000FFFC00
00001FFF000000FFFC0000001FFF000000FFFC0000001FFF000000FFFC0000001FFF0000
00FFFC0000001FFF000000FFFC0000001FFF000000FFFC000F001FFF000000FFFE000F00
1FFF000000FFFE000F001FFF0000007FFE000F001FFF0000007FFF001F001FFF0000003F
FF001EFFFFFFFFE0001FFF803EFFFFFFFFE0000FFFE0FCFFFFFFFFE00007FFFFF8FFFFFF
FFE00001FFFFF0FFFFFFFFE000007FFFE00000000000000007FF8050457DC354>I<0000
FFE0001C000007FFFE003C00003FFFFF807C0000FFFFFFE0FC0001FFFFFFF9FC0003FF80
1FFFFC0007FC0001FFFC000FF800007FFC001FF000003FFC003FE000000FFC003FC00000
07FC007FC0000003FC007F80000003FC007F80000001FC007F80000000FC00FF80000000
FC00FF800000007C00FF800000007C00FFC00000007C00FFC00000007C00FFE00000003C
00FFF00000003C00FFF80000003C00FFFC00000000007FFE00000000007FFFE000000000
7FFFFE000000003FFFFFF00000003FFFFFFF0000001FFFFFFFE000001FFFFFFFFC00000F
FFFFFFFE000007FFFFFFFF800003FFFFFFFFC00001FFFFFFFFE000007FFFFFFFF000001F
FFFFFFF8000007FFFFFFFC000000FFFFFFFC0000000FFFFFFE00000000FFFFFE00000000
07FFFF00000000007FFF00000000003FFF00000000000FFF800000000007FF8000000000
03FF80F000000003FF80F000000001FF80F000000001FF80F000000000FF80F000000000
FF80F800000000FF80F800000000FF80F800000000FF00FC00000000FF00FC00000000FF
00FE00000001FF00FF00000001FE00FF80000003FE00FFC0000003FC00FFE0000007FC00
FFF800000FF800FFFF00003FF000FFFFF800FFE000FE7FFFFFFFC000FC1FFFFFFF0000F8
07FFFFFC0000F000FFFFF00000E00007FF80000031467AC43E>I<3FFFFFFFFFFFFFFFE0
3FFFFFFFFFFFFFFFE03FFFFFFFFFFFFFFFE03FFFFFFFFFFFFFFFE03FFFFFFFFFFFFFFFE0
3FFE000FFF8003FFE07FE0000FFF80003FF07FC0000FFF80001FF07F00000FFF800007F0
7F00000FFF800007F07E00000FFF800003F07C00000FFF800001F07C00000FFF800001F0
7C00000FFF800001F07800000FFF800000F07800000FFF800000F07800000FFF800000F0
7800000FFF800000F0F800000FFF800000F8F000000FFF80000078F000000FFF80000078
F000000FFF80000078F000000FFF80000078F000000FFF800000780000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000000
0000000FFF800000000007FFFFFFFFFF00000007FFFFFFFFFF00000007FFFFFFFFFF0000
0007FFFFFFFFFF00000007FFFFFFFFFF000045437CC24E>I<FFFFFFFF80000FFFFFF8FF
FFFFFF80000FFFFFF8FFFFFFFF80000FFFFFF8FFFFFFFF80000FFFFFF8FFFFFFFF80000F
FFFFF8003FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE
0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E0
00003FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000
000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E00000
3FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE00000000
03E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE
0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E0
00003FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000
000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E00000
3FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE00000000
03E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE
0000000003E000003FFE0000000003E000003FFE0000000003E000003FFE0000000003E0
00003FFE0000000003E000003FFE0000000003E000001FFE0000000007E000001FFE0000
000007C000001FFF0000000007C000001FFF000000000FC000000FFF000000000F800000
0FFF800000001F80000007FF800000001F00000003FFC00000003F00000003FFC0000000
7E00000001FFE0000000FC00000000FFF0000003FC000000007FFC000007F8000000003F
FF00003FF0000000000FFFF003FFE00000000007FFFFFFFF800000000001FFFFFFFF0000
000000007FFFFFFC0000000000000FFFFFE0000000000000007FFE000000004D457CC356
>I<0001FFE0000000001FFFFE000000007FFFFF80000001FFFFFFE0000003FE007FF800
0007FC001FFC000007FE000FFE00000FFF0007FF00000FFF0007FF00000FFF0003FF8000
0FFF0003FF80000FFF0003FF80000FFF0001FFC00007FE0001FFC00003FC0001FFC00000
F00001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC0000000
03FFFFC0000000FFFFFFC0000007FFFFFFC000003FFFF1FFC00000FFFC01FFC00003FFE0
01FFC0000FFF8001FFC0001FFE0001FFC0003FFC0001FFC0003FF80001FFC0007FF80001
FFC0007FF00001FFC000FFF00001FFC000FFE00001FFC000FFE00001FFC000FFE00001FF
C000FFE00003FFC000FFE00003FFC000FFF00007FFC0007FF8000FFFC0007FF8001FFFF0
003FFE003EFFFFC01FFF80FC7FFFC007FFFFF87FFFC003FFFFE01FFFC0007FFF8007FFC0
000FFC00000000322F7DAD36>97 D<007FC000000000FFFFC000000000FFFFC000000000
FFFFC000000000FFFFC000000000FFFFC00000000003FFC00000000001FFC00000000001
FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FF
C00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC0
0000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC000
00000001FFC00FF8000001FFC0FFFF800001FFC3FFFFE00001FFCFFFFFF80001FFDFC03F
FC0001FFFF000FFE0001FFFC0003FF0001FFF80001FF8001FFF00001FFC001FFE00000FF
E001FFC00000FFE001FFC000007FF001FFC000007FF001FFC000007FF801FFC000003FF8
01FFC000003FF801FFC000003FF801FFC000003FFC01FFC000003FFC01FFC000003FFC01
FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FF
C000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FF801FFC0
00003FF801FFC000007FF801FFC000007FF001FFC000007FF001FFC000007FF001FFC000
00FFE001FFE00000FFC001FFF00001FFC001FFF80003FF8001FF7C0007FF0001FE3E000F
FE0001FC1FC07FFC0001F80FFFFFF00001F003FFFFC00001E000FFFF00000000001FF000
0036467DC43E>I<00003FFC00000001FFFFC000000FFFFFF000003FFFFFFC00007FF003
FE0000FFC001FF0003FF8003FF0007FF0007FF8007FE0007FF800FFE0007FF801FFC0007
FF801FFC0007FF803FF80007FF803FF80003FF007FF80001FE007FF8000078007FF00000
00007FF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF00000
0000FFF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF00000
0000FFF0000000007FF8000000007FF8000000007FF8000000003FF8000000003FFC0000
03C03FFC000003C01FFE000007C00FFE000007800FFF00000F8007FF80001F0003FFC000
3E0001FFF0007C00007FFC03F800003FFFFFF000000FFFFFC0000003FFFF000000003FF8
00002A2F7CAD32>I<0000000003FE0000000007FFFE0000000007FFFE0000000007FFFE
0000000007FFFE0000000007FFFE00000000001FFE00000000000FFE00000000000FFE00
000000000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE0000
0000000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE000000
00000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE0000003F
E00FFE000003FFFC0FFE00000FFFFF8FFE00003FFFFFCFFE0000FFF807FFFE0001FFC001
FFFE0003FF80007FFE0007FF00003FFE000FFE00001FFE000FFC00000FFE001FFC00000F
FE003FF800000FFE003FF800000FFE003FF800000FFE007FF800000FFE007FF000000FFE
007FF000000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00
FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FF
F000000FFE00FFF000000FFE00FFF000000FFE007FF000000FFE007FF000000FFE007FF0
00000FFE007FF800000FFE003FF800000FFE003FF800000FFE001FFC00001FFE001FFC00
001FFE000FFE00003FFE0007FE00007FFE0003FF0000FFFF0001FFC003FFFFFC00FFF01F
EFFFFC007FFFFF8FFFFC001FFFFE0FFFFC0007FFF80FFFFC00007FC00FF80036467CC43E
>I<00003FF800000003FFFF8000000FFFFFE000003FFFFFF000007FF83FF80000FFC007
FC0001FF8003FE0003FF0001FF0007FE0000FF800FFC0000FF801FFC00007FC01FF80000
7FC03FF800003FE03FF800003FE07FF800003FE07FF000003FE07FF000003FF07FF00000
1FF0FFF000001FF0FFF000001FF0FFFFFFFFFFF0FFFFFFFFFFF0FFFFFFFFFFF0FFFFFFFF
FFF0FFF000000000FFF000000000FFF000000000FFF000000000FFF0000000007FF00000
00007FF0000000007FF8000000007FF8000000003FF8000000003FF8000000F01FFC0000
00F01FFC000001F00FFE000001E007FF000003E003FF800007C001FFC0000F8000FFF000
3F00007FFE01FE00001FFFFFFC000007FFFFF0000001FFFFC00000001FFE00002C2F7DAD
33>I<000000FF8000000FFFE000007FFFF00001FFFFF80003FF8FFC000FFE0FFE001FFC
1FFE001FF81FFE003FF81FFE007FF01FFE007FF01FFE007FF00FFC00FFE00FFC00FFE003
F000FFE000C000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE00000
00FFE0000000FFE0000000FFE0000000FFE0000000FFE00000FFFFFFF800FFFFFFF800FF
FFFFF800FFFFFFF800FFFFFFF80000FFE0000000FFE0000000FFE0000000FFE0000000FF
E0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0
000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE000
0000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE00000
00FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000
FFE000007FFFFFE0007FFFFFE0007FFFFFE0007FFFFFE0007FFFFFE00027467DC522>I<
0000FFE0007E00000FFFFE03FF80003FFFFF8FFF8000FFFFFFFFFFC001FFC07FFF3FC003
FF001FF83FC007FE000FFC3FC00FFC0007FE1F801FFC0007FF0F001FF80003FF00001FF8
0003FF00003FF80003FF80003FF80003FF80003FF80003FF80003FF80003FF80003FF800
03FF80003FF80003FF80003FF80003FF80003FF80003FF80001FF80003FF00001FF80003
FF00001FFC0007FF00000FFC0007FE000007FE000FFC000003FF001FF8000001FFC07FF0
000003FFFFFFE0000003FFFFFF800000078FFFFE0000000780FFE00000000F8000000000
000F8000000000000F8000000000000F8000000000000FC000000000000FE00000000000
0FF000000000000FFFFFFFC000000FFFFFFFFC000007FFFFFFFF800007FFFFFFFFE00003
FFFFFFFFF00001FFFFFFFFFC0000FFFFFFFFFC0003FFFFFFFFFE000FFFFFFFFFFF001FF0
00007FFF003FC0000007FF007F80000001FF807F80000000FF80FF00000000FF80FF0000
00007F80FF000000007F80FF000000007F80FF000000007F80FF80000000FF807F800000
00FF007FC0000001FF003FE0000003FE001FF0000007FC000FFE00003FF80007FFC001FF
F00001FFFFFFFFC000007FFFFFFF0000000FFFFFF8000000007FFF00000032427DAC38>
I<007FC000000000FFFFC000000000FFFFC000000000FFFFC000000000FFFFC000000000
FFFFC00000000003FFC00000000001FFC00000000001FFC00000000001FFC00000000001
FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FF
C00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC0
0000000001FFC00000000001FFC00000000001FFC00000000001FFC007FE000001FFC03F
FF800001FFC0FFFFE00001FFC1FFFFF80001FFC7F03FFC0001FFCF801FFC0001FFDF000F
FE0001FFDE000FFE0001FFFC000FFE0001FFF80007FF0001FFF00007FF0001FFF00007FF
0001FFE00007FF0001FFE00007FF0001FFE00007FF0001FFC00007FF0001FFC00007FF00
01FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001
FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FF
C00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC0
0007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC000
07FF0001FFC00007FF0001FFC00007FF00FFFFFF83FFFFFEFFFFFF83FFFFFEFFFFFF83FF
FFFEFFFFFF83FFFFFEFFFFFF83FFFFFE37457CC43E>I<007C0001FF0003FF8007FFC007
FFC00FFFE00FFFE00FFFE00FFFE00FFFE007FFC007FFC003FF8001FF00007C0000000000
0000000000000000000000000000000000000000000000000000007FC07FFFC07FFFC07F
FFC07FFFC07FFFC003FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001
FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001
FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001FFC001
FFC0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF18467CC520>I<007FC000000000FFFFC00000
0000FFFFC000000000FFFFC000000000FFFFC000000000FFFFC00000000003FFC0000000
0001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC000000000
01FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001
FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FF
C00000000001FFC00000000001FFC00000000001FFC0007FFFE001FFC0007FFFE001FFC0
007FFFE001FFC0007FFFE001FFC0007FFFE001FFC0000FE00001FFC0001FC00001FFC000
3F000001FFC0007E000001FFC000FC000001FFC003F8000001FFC007E0000001FFC00FC0
000001FFC01F80000001FFC07F00000001FFC0FE00000001FFC1FC00000001FFC3FE0000
0001FFC7FE00000001FFDFFF00000001FFFFFF80000001FFFFFFC0000001FFFFFFC00000
01FFF9FFE0000001FFE1FFF0000001FFC0FFF8000001FF807FF8000001FF803FFC000001
FF803FFE000001FF801FFF000001FF800FFF000001FF8007FF800001FF8007FFC00001FF
8003FFE00001FF8001FFE00001FF8000FFF00001FF8000FFF80001FF80007FFC0001FF80
003FFC00FFFFFF03FFFFF8FFFFFF03FFFFF8FFFFFF03FFFFF8FFFFFF03FFFFF8FFFFFF03
FFFFF835457DC43B>107 D<007FC000FFFFC000FFFFC000FFFFC000FFFFC000FFFFC000
03FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC00001FFC000
01FFC00001FFC00001FFC00001FFC000FFFFFF80FFFFFF80FFFFFF80FFFFFF80FFFFFF80
19457CC420>I<007F8007FE00000FFC0000FFFF803FFFC0007FFF8000FFFF80FFFFF001
FFFFE000FFFF81FFFFF803FFFFF000FFFF87F01FFC0FE03FF800FFFF8FC00FFE1F801FFC
0003FF9F000FFF3E001FFE0001FF9E0007FF3C000FFE0001FFBC0007FF78000FFE0001FF
F80003FFF00007FF0001FFF80003FFF00007FF0001FFF00003FFE00007FF0001FFE00003
FFC00007FF0001FFE00003FFC00007FF0001FFE00003FFC00007FF0001FFC00003FF8000
07FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF00
01FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC0
0003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF
800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007
FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001
FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC000
03FF800007FF0001FFC00003FF800007FF0001FFC00003FF800007FF0001FFC00003FF80
0007FF0001FFC00003FF800007FF00FFFFFF81FFFFFF03FFFFFEFFFFFF81FFFFFF03FFFF
FEFFFFFF81FFFFFF03FFFFFEFFFFFF81FFFFFF03FFFFFEFFFFFF81FFFFFF03FFFFFE572D
7CAC5E>I<007F8007FE0000FFFF803FFF8000FFFF80FFFFE000FFFF81FFFFF800FFFF87
F03FFC00FFFF8F801FFC0003FF9F000FFE0001FF9E000FFE0001FFBC000FFE0001FFF800
07FF0001FFF00007FF0001FFF00007FF0001FFE00007FF0001FFE00007FF0001FFE00007
FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF
0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF00
01FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001
FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FF
C00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF00FFFFFF
83FFFFFEFFFFFF83FFFFFEFFFFFF83FFFFFEFFFFFF83FFFFFEFFFFFF83FFFFFE372D7CAC
3E>I<00001FFC0000000001FFFFC000000007FFFFF00000001FFFFFFC0000007FF80FFF
000000FFC001FF800001FF8000FFC00003FE00003FE00007FE00003FF0000FFC00001FF8
000FF800000FF8001FF800000FFC001FF800000FFC003FF800000FFE003FF0000007FE00
7FF0000007FF007FF0000007FF007FF0000007FF007FF0000007FF00FFF0000007FF80FF
F0000007FF80FFF0000007FF80FFF0000007FF80FFF0000007FF80FFF0000007FF80FFF0
000007FF80FFF0000007FF80FFF0000007FF80FFF0000007FF807FF0000007FF007FF000
0007FF007FF0000007FF007FF0000007FF003FF800000FFE003FF800000FFE001FF80000
0FFC001FFC00001FFC000FFC00001FF80007FE00003FF00007FE00003FF00003FF8000FF
E00001FFC001FFC000007FF80FFF0000003FFFFFFE0000000FFFFFF800000001FFFFC000
0000001FFC000000312F7DAD38>I<007FC00FF80000FFFFC0FFFF8000FFFFC3FFFFE000
FFFFCFFFFFF800FFFFDFC03FFC00FFFFFF001FFE0003FFFC0007FF0001FFF80003FF8001
FFF00003FFC001FFE00001FFE001FFC00001FFE001FFC00000FFF001FFC00000FFF001FF
C000007FF801FFC000007FF801FFC000007FF801FFC000007FF801FFC000003FFC01FFC0
00003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000
003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC000003FFC01FFC00000
3FFC01FFC000007FF801FFC000007FF801FFC000007FF801FFC000007FF001FFC00000FF
F001FFC00000FFF001FFC00001FFE001FFE00001FFC001FFF00003FFC001FFF80007FF80
01FFFC000FFF0001FFFE001FFE0001FFDFC07FFC0001FFCFFFFFF00001FFC3FFFFC00001
FFC0FFFF000001FFC01FF0000001FFC00000000001FFC00000000001FFC00000000001FF
C00000000001FFC00000000001FFC00000000001FFC00000000001FFC00000000001FFC0
0000000001FFC00000000001FFC00000000001FFC00000000001FFC000000000FFFFFF80
000000FFFFFF80000000FFFFFF80000000FFFFFF80000000FFFFFF8000000036407DAC3E
>I<00003FE0001E000003FFFC003E00000FFFFF007E00003FFFFF807E0000FFF80FE0FE
0001FFE003F1FE0003FFC001F1FE0007FF8000FBFE000FFF00007FFE000FFE00003FFE00
1FFE00001FFE003FFC00001FFE003FFC00000FFE003FF800000FFE007FF800000FFE007F
F800000FFE007FF800000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF0
00000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE00FFF000
000FFE00FFF000000FFE00FFF000000FFE00FFF000000FFE007FF800000FFE007FF80000
0FFE007FF800000FFE007FF800000FFE003FFC00000FFE003FFC00000FFE001FFE00001F
FE001FFE00003FFE000FFF00007FFE0007FF0000FFFE0003FF8001FFFE0001FFE003EFFE
0000FFF01FCFFE00007FFFFF8FFE00001FFFFE0FFE000003FFF80FFE0000007FC00FFE00
000000000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE0000
0000000FFE00000000000FFE00000000000FFE00000000000FFE00000000000FFE000000
00000FFE00000000000FFE00000000000FFE0000000007FFFFFC00000007FFFFFC000000
07FFFFFC00000007FFFFFC00000007FFFFFC36407CAC3B>I<007F807F00FFFF81FFE0FF
FF83FFF0FFFF8FFFF8FFFF8F8FFCFFFF9F1FFE03FFBE1FFE01FFBC1FFE01FFF81FFE01FF
F81FFE01FFF01FFE01FFF00FFC01FFE007F801FFE001E001FFE0000001FFE0000001FFE0
000001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC000
0001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC00000
01FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001FFC0000001
FFC0000001FFC00000FFFFFFE000FFFFFFE000FFFFFFE000FFFFFFE000FFFFFFE000272D
7DAC2E>I<001FFC038000FFFF878003FFFFFF800FFFFFFF801FF003FF803FC000FF803F
80003F807F00001F807E00001F80FE00000F80FE00000F80FE00000780FF00000780FF00
000780FF80000780FFE0000000FFFE0000007FFFF000007FFFFF00003FFFFFC0003FFFFF
F0001FFFFFFC000FFFFFFE0003FFFFFF0001FFFFFF80007FFFFF80000FFFFFC000003FFF
C0000003FFE0000000FFE0F000003FE0F000003FE0F800001FE0F800000FE0F800000FE0
FC00000FE0FC00000FE0FE00000FC0FF00001FC0FF00001FC0FF80003F80FFE0007F00FF
F803FE00FFFFFFFC00FCFFFFF800F03FFFE000E007FE0000232F7CAD2C>I<0001E00000
0001E000000001E000000001E000000001E000000003E000000003E000000003E0000000
03E000000007E000000007E00000000FE00000000FE00000001FE00000001FE00000003F
E00000007FE0000000FFE0000003FFE000000FFFFFFF80FFFFFFFF80FFFFFFFF80FFFFFF
FF80FFFFFFFF8000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE000
0000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE00000
00FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000
FFE0000000FFE001E000FFE001E000FFE001E000FFE001E000FFE001E000FFE001E000FF
E001E000FFE001E000FFE001E000FFE003E000FFF003C0007FF003C0007FF007C0003FF8
0F80001FFC1F00000FFFFF000007FFFC000001FFF80000003FE00023407EBE2C>I<007F
C00001FF00FFFFC003FFFF00FFFFC003FFFF00FFFFC003FFFF00FFFFC003FFFF00FFFFC0
03FFFF0003FFC0000FFF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC000
07FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007
FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF
0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF00
01FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001FFC00007FF0001
FFC00007FF0001FFC00007FF0001FFC0000FFF0001FFC0000FFF0001FFC0001FFF0001FF
C0001FFF0001FFC0003FFF0000FFC0003FFF0000FFE0007FFF80007FE001F7FFFE007FF8
07E7FFFE003FFFFFC7FFFE000FFFFF07FFFE0003FFFE07FFFE00007FF007FC00372E7CAC
3E>I<FFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003
FFFC01FFE000003E0000FFE000003C0000FFF000003C00007FF000007800007FF8000078
00007FF80000F800003FF80000F000003FFC0001F000001FFC0001E000001FFE0003E000
000FFE0003C000000FFF0007C0000007FF000780000007FF800F80000003FF800F000000
03FFC00F00000003FFC01F00000001FFE01E00000001FFE03E00000000FFE03C00000000
FFF07C000000007FF078000000007FF8F8000000003FF8F0000000003FFDF0000000001F
FDE0000000001FFFE0000000000FFFC0000000000FFFC0000000000FFFC00000000007FF
800000000007FF800000000003FF000000000003FF000000000001FE000000000001FE00
0000000000FC000000000000FC00000000000078000000362C7EAB3B>I<FFFFFE1FFFFF
801FFFF0FFFFFE1FFFFF801FFFF0FFFFFE1FFFFF801FFFF0FFFFFE1FFFFF801FFFF0FFFF
FE1FFFFF801FFFF001FFC0003FE000007C0001FFC0003FF00000780001FFE0003FF00000
F80000FFE0001FF80000F00000FFF0001FF80001F000007FF0000FFC0001E000007FF000
0FFC0001E000007FF8001FFC0003E000003FF8001FFE0003C000003FFC003FFE0007C000
001FFC003FFF00078000001FFC003FFF00078000001FFE0079FF000F8000000FFE0079FF
800F0000000FFF00F9FF801F00000007FF00F0FFC01E00000007FF80F0FFC01E00000003
FF81E07FC03C00000003FF81E07FE03C00000003FFC3E07FE07C00000001FFC3C03FF078
00000001FFE7C03FF07800000000FFE7801FF0F000000000FFE7801FF8F000000000FFFF
801FF9F0000000007FFF000FFDE0000000007FFF000FFFE0000000003FFE0007FFC00000
00003FFE0007FFC0000000003FFE0007FFC0000000001FFC0003FF80000000001FFC0003
FF80000000000FF80001FF00000000000FF80001FF00000000000FF00000FF0000000000
07F00000FE000000000007F00000FE000000000003E000007C000000000003C000003C00
00004C2C7EAB51>I<FFFFFE003FFFF0FFFFFE003FFFF0FFFFFE003FFFF0FFFFFE003FFF
F0FFFFFE003FFFF000FFF00003E000007FF80007C000003FF8000F8000001FFC001F0000
001FFE003F0000000FFF007E00000007FF807C00000003FFC0F800000001FFC1F0000000
01FFE3E000000000FFF7C0000000007FFF80000000003FFF80000000001FFF0000000000
1FFE00000000000FFF000000000007FF800000000003FFC00000000003FFC00000000007
FFE0000000000FFFF0000000000FFFF8000000001F3FFC000000003E1FFC000000007C1F
FE00000000F80FFF00000001F007FF80000003F003FFC0000007E001FFC0000007C001FF
E000000F8000FFF000001F00007FF800003E00003FFC00007E00001FFC00FFFFE000FFFF
FCFFFFE000FFFFFCFFFFE000FFFFFCFFFFE000FFFFFCFFFFE000FFFFFC362C7EAB3B>I<
FFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003FFFCFFFFFF0003FFFC01
FFE000003E0000FFE000003C0000FFF000003C00007FF000007800007FF800007800007F
F80000F800003FF80000F000003FFC0001F000001FFC0001E000001FFE0003E000000FFE
0003C000000FFF0007C0000007FF000780000007FF800F80000003FF800F00000003FFC0
0F00000003FFC01F00000001FFE01E00000001FFE03E00000000FFE03C00000000FFF07C
000000007FF078000000007FF8F8000000003FF8F0000000003FFDF0000000001FFDE000
0000001FFFE0000000000FFFC0000000000FFFC0000000000FFFC00000000007FF800000
000007FF800000000003FF000000000003FF000000000001FE000000000001FE00000000
0000FC000000000000FC0000000000007800000000000078000000000000F80000000000
00F0000000000001F0000000000001E00000001F0003E00000003F8003C00000007FC007
C0000000FFE00780000000FFE00F80000000FFE00F00000000FFE01F00000000FFE03E00
000000FFC07C000000007FC1F8000000007F07F0000000003FFFE0000000001FFFC00000
000007FF000000000001FC000000000036407EAB3B>I<1FFFFFFFFF801FFFFFFFFF801F
FFFFFFFF801FFFFFFFFF801FFC001FFF001FE0003FFE001FC0003FFE001F80007FFC001F
0000FFF8003F0001FFF0003E0001FFF0003E0003FFE0003E0007FFC0003C000FFF80003C
000FFF80003C001FFF00003C003FFE00003C007FFC000000007FFC00000000FFF8000000
01FFF000000003FFE000000003FFE000000007FFC00000000FFF800780001FFF00078000
1FFF000780003FFE000780007FFC000F8000FFF8000F0000FFF8000F0001FFF0000F0003
FFE0001F0007FFC0001F0007FFC0001F000FFF80003F001FFF00007F003FFE0000FF003F
FE0003FF007FFC001FFE00FFFFFFFFFE00FFFFFFFFFE00FFFFFFFFFE00FFFFFFFFFE0029
2C7DAB32>I E /Fo 1 23 df<00000E000000000000003F8000000E0000007F8000003F
8000007F8000007F8000007F8000007F800000FF800000FF800000FF800000FF000000FF
000000FF000000FF000000FF000001FF000001FF000001FF000001FE000001FE000001FE
000001FE000001FE000003FE000003FE000003FE000003FC000003FC000003FC000003FC
000003FC000007FC000007FC000007FC000007F8000007F8000007F8000007F8000007F8
00000FF800000FF800000FF800000FF000000FF000000FF000000FF000000FF000001FF0
00001FF000001FF000001FE000001FE000001FE000001FE000001FE000003FE000003FE0
00003FE000003FC000003FC000003FC000003FC000003FC000007FC000007FC000007FC0
00007F801C007F8000007F801C007F8000007F801C00FF800000FF801C00FF800000FF00
3C00FF800000FF003800FF800001FF003801FF800001FF007801FF800003FF007001FF80
0007FF007001FFC0000FFE00F003FFC0001EFE00E003FFE0003EFF01E003FFE0007C7F01
C003FFF001F07F03C007FFFC07E03F878007FDFFFF801FFF0007F87FFF0007FE0007F80F
F80001F8000FF80000000000000FF80000000000000FF00000000000000FF00000000000
001FF00000000000001FF00000000000001FE00000000000001FE00000000000003FE000
00000000003FE00000000000003FC00000000000003FC00000000000007FC00000000000
007FC00000000000007F800000000000007F80000000000000FF80000000000000FF8000
0000000000FF00000000000000FF00000000000000FF00000000000000FE000000000000
00FE0000000000000078000000000000003E4D7CB346>22 D E /Fp
11 66 df<003F800001FFF00003E0F80007803C000F001E001E000F003E000F803E000F
803C0007807C0007C07C0007C07C0007C07C0007C0FC0007E0FC0007E0FC0007E0FC0007
E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007
E0FC0007E07C0007C07C0007C07C0007C03E000F803E000F803E000F801F001F000F001E
0007803C0003E0F80001FFF000003F80001B277EA521>48 D<00380000780001F8001FF8
00FEF800E0F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F8
0000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F8
0000F80000F80000F80000F80000F80000F80000F80001FC00FFFFF8FFFFF815267BA521
>I<00FF000003FFE0000E03F0001800F80030007C0060007E0078003F00FC003F00FE00
1F80FE001F80FE001F80FE001F807C001F8000001F8000001F0000003F0000003E000000
7E0000007C000000F8000001F0000003E0000003C00000078000000E0000001C00000038
00000070018000E001800180018003000300060003000C0003001FFFFF003FFFFF007FFF
FE00FFFFFE00FFFFFE0019267DA521>I<00FF000003FFE0000F01F8001C007C0030007E
003C003E007E003F007E003F007E003F007E003F003C003F0000003E0000007E0000007C
000000F8000001F0000007E00001FF800001FF00000001E0000000F00000007C0000003E
0000003F0000001F0000001F8000001F8038001F807C001F80FE001F80FE001F80FE001F
00FC003F0078003E0070007C003800F8001F01F00007FFC00000FF000019277DA521>I<
0000380000003800000078000000F8000001F8000001F8000003F8000007F8000006F800
000CF800001CF8000018F8000030F8000070F8000060F80000C0F80001C0F8000180F800
0300F8000700F8000E00F8000C00F8001C00F8003800F8003000F8006000F800E000F800
FFFFFFE0FFFFFFE00000F8000000F8000000F8000000F8000000F8000000F8000000F800
0001FC00003FFFE0003FFFE01B277EA621>I<18000C001F007C001FFFF8001FFFF0001F
FFE0001FFF800019FC000018000000180000001800000018000000180000001800000018
000000187F000019FFE0001F81F0001E0078001C003C0018003E0000003E0000001F0000
001F0000001F8000001F8030001F807C001F80FC001F80FC001F80FC001F80FC001F00F0
001F0060003E0070003E0030007C001C00F8000F03E00003FFC00000FE000019277DA521
>I<000FE000003FF80000F81C0001E0060003C01F0007803F000F003F001F003F001E00
3F003E001E003E0000007C0000007C0000007C0400007C3FC000FCFFF000FDC07800FF00
3C00FF003E00FE001E00FE001F00FE001F00FC001F80FC001F80FC001F80FC001F807C00
1F807C001F807C001F807C001F803C001F003E001F001E001E001E003E000F003C000780
780003C1F00001FFC000007F000019277DA521>I<300000003C0000003FFFFFE03FFFFF
E03FFFFFC07FFFFF807FFFFF807000070060000E0060000C00C0001C00C0003800C00070
000000E0000000C0000001C000000380000003800000070000000F0000000E0000001E00
00001E0000001E0000003E0000003C0000003C0000007C0000007C0000007C0000007C00
0000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0000007800
001B287DA621>I<007F000003FFE0000781F8000E007C001C001E0038001E0038000F00
78000F0078000F0078000F007C000F007E001E003F801E003FE03C001FF078000FFCF000
07FFC00003FF800000FFE00001FFF000079FFC000F07FE001E03FE003C00FF0078003F00
78001F80F0000F80F0000F80F0000780F0000780F0000780F00007007800070078000E00
3C001C001E0038000F80F00003FFE000007F000019277DA521>I<007F000001FFC00007
C1E0000F0070001E0078003E003C003C003E007C001E007C001E00FC001F00FC001F00FC
001F00FC001F00FC001F80FC001F80FC001F80FC001F807C003F807C003F803C003F803E
007F801E007F800F01DF8007FF9F8001FE1F8000101F0000001F0000001F0000003E003C
003E007E003C007E003C007E0078007E00F0007C00E0003003C0001C0780000FFF000003
F8000019277DA521>I<00000E00000000000E00000000001F00000000001F0000000000
1F00000000003F80000000003F80000000003F80000000006FC0000000006FC000000000
EFE000000000C7E000000000C7E00000000183F00000000183F00000000183F000000003
01F80000000301F80000000601FC0000000600FC0000000600FC0000000C007E0000000C
007E0000001C007F00000018003F00000018003F00000030003F8000003FFFFF8000003F
FFFF80000060000FC0000060000FC00000E0000FE00000C00007E00000C00007E0000180
0003F00001800003F00003800003F80003800001F80007800001F8001FC00003FC00FFF8
003FFFE0FFF8003FFFE02B2A7EA931>65 D E /Fq 4 106 df<000FE000007FFC0000FF
FE0003FFFF8007FFFFC00FFFFFE01FFFFFF03FFFFFF83FFFFFF87FFFFFFC7FFFFFFC7FFF
FFFCFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFE7FFF
FFFC7FFFFFFC7FFFFFFC3FFFFFF83FFFFFF81FFFFFF00FFFFFE007FFFFC003FFFF8000FF
FE00007FFC00000FE0001F207BA42A>15 D<7FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFF
FFFFFC7FFFFFFFFFFFF80000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
7FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFFFFFFFC7FFFFFFFFFFFF80000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000007FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFF
FFFFFC7FFFFFFFFFFFF836287BA841>17 D<0000C00001E00003E00003E00003C00007C0
0007C0000780000F80000F80001F00001F00001E00003E00003E00007C00007C00007800
00F80000F80001F00001F00001E00003E00003E00003C00007C00007C0000F80000F8000
0F00001F00001F00003E00003E00003C00007C00007C0000780000F80000F80000F80000
F800007800007C00007C00003C00003E00003E00001F00001F00000F00000F80000F8000
07C00007C00003C00003E00003E00001E00001F00001F00000F80000F800007800007C00
007C00003E00003E00001E00001F00001F00000F80000F800007800007C00007C00003C0
0003E00003E00001E00000C0135278BD20>104 D<600000F00000F80000F80000780000
7C00007C00003C00003E00003E00001F00001F00000F00000F80000F800007C00007C000
03C00003E00003E00001F00001F00000F00000F80000F800007800007C00007C00003E00
003E00001E00001F00001F00000F80000F800007800007C00007C00003C00003E00003E0
0003E00003E00003C00007C00007C0000780000F80000F80001F00001F00001E00003E00
003E00007C00007C0000780000F80000F80000F00001F00001F00003E00003E00003C000
07C00007C0000F80000F80000F00001F00001F00003E00003E00003C00007C00007C0000
780000F80000F80000F0000060000013527CBD20>I E /Fr 60 123
df<00000001FFFC0001FFE0000000003FFFFF801FFFF800000001FFFFFFE07FFFFE0000
000FFFFFFFF9FFFFFF0000003FFFC00FFFFFC0FF8000007FFC0003FFFE01FFC00001FFE0
0007FFFC03FFC00003FFC0000FFFF807FFE00007FF00000FFFF007FFE0000FFE00001FFF
E007FFE0001FFC00001FFFE007FFE0001FFC00001FFFC007FFE0003FF800001FFFC007FF
E0003FF800001FFFC003FFC0007FF800001FFF8003FFC0007FF000000FFF8001FF80007F
F0000007FF80007E00007FF0000003FF80000000007FF0000003FF80000000007FF00000
03FF80000000007FF0000003FF80000000007FF0000003FF80000000007FF0000003FF80
000000007FF0000003FF80000000007FF0000003FF80000000007FF0000003FF80000000
007FF0000003FF80000000007FF0000003FF80000000007FF0000003FF80000000007FF0
000003FF80000000007FF0000003FF80000000FFFFFFFFFFFFFFFFFF0000FFFFFFFFFFFF
FFFFFF0000FFFFFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFF
0000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC000000000
7FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF800
0003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FF
C0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC00000
00007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007F
F8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF80000
03FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0
000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000
007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8
000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003
FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC000
0000007FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC000000000
7FF8000003FFC0000000007FF8000003FFC0000000007FF8000003FFC0000000007FF800
0003FFC00000007FFFFFF803FFFFFFF000007FFFFFF803FFFFFFF000007FFFFFF803FFFF
FFF000007FFFFFF803FFFFFFF000007FFFFFF803FFFFFFF0000053547DD34E>11
D<00000000FFFC0000000000001FFFFF800000000001FFFFFFE00000000007FFFFFFF000
0000001FFFC00FF8000000007FFE0003FC00000000FFF00000FE00000001FFE00003FF00
000003FF800007FF00000007FF00000FFF8000000FFE00001FFF8000000FFE00001FFF80
00001FFC00001FFF8000001FFC00003FFFC000003FFC00001FFF8000003FF800001FFF80
00003FF800001FFF8000003FF800001FFF8000003FF800000FFF0000003FF8000007FE00
00003FF8000001F80000003FF8000000000000003FF8000000000000003FF80000000000
00003FF8000000000000003FF8000000000000003FF8000000000000003FF80000000000
00003FF8000000000000003FF8000000000000003FF80003FFFFC000FFFFFFFFFFFFFFC0
00FFFFFFFFFFFFFFC000FFFFFFFFFFFFFFC000FFFFFFFFFFFFFFC000FFFFFFFFFFFFFFC0
00003FFC000007FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0
00003FFC000003FFC000003FFC000003FFC000003FFC000003FFC0003FFFFFFC03FFFFFF
C03FFFFFFC03FFFFFFC03FFFFFFC03FFFFFFC03FFFFFFC03FFFFFFC03FFFFFFC03FFFFFF
C042547DD34B>I<07F0001FF8003FFC007FFE007FFF00FFFF00FFFF80FFFF80FFFF80FF
FFC0FFFFC0FFFFC07FFFC07FFFC03FFFC01FFFC007F3C00003C00003C00007C000078000
0780000780000F80000F00000F00001F00001E00003E00003C00007C0000F80000F80001
F00003E00007C0000F80001F00001E00000C00001228769025>44
D<FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0
FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0240B7F9F2D>I<07F0000FF8001FFC00
3FFE007FFF00FFFF80FFFF80FFFF80FFFF80FFFF80FFFF80FFFF807FFF003FFE001FFC00
0FF80007F0001111769025>I<000000000001E0000000000003E0000000000007F00000
00000007F000000000000FF000000000000FF000000000001FE000000000001FE0000000
00001FC000000000003FC000000000003FC000000000007F8000000000007F8000000000
007F000000000000FF000000000000FF000000000001FE000000000001FE000000000001
FC000000000003FC000000000003FC000000000007F8000000000007F8000000000007F0
00000000000FF000000000000FF000000000001FE000000000001FE000000000001FC000
000000003FC000000000003FC000000000007F8000000000007F8000000000007F000000
000000FF000000000000FF000000000001FE000000000001FE000000000001FC00000000
0003FC000000000003FC000000000007F8000000000007F8000000000007F00000000000
0FF000000000000FF000000000001FE000000000001FE000000000001FC000000000003F
C000000000003FC000000000007F8000000000007F8000000000007F000000000000FF00
0000000000FF000000000001FE000000000001FE000000000001FC000000000003FC0000
00000003FC000000000003F8000000000007F8000000000007F800000000000FF0000000
00000FF000000000000FE000000000001FE000000000001FE000000000003FC000000000
003FC000000000003F8000000000007F8000000000007F800000000000FF000000000000
FF000000000000FE000000000001FE000000000001FE000000000003FC000000000003FC
000000000003F8000000000007F8000000000007F800000000000FF000000000000FF000
000000000FE000000000001FE000000000001FE000000000003FC000000000003FC00000
0000003F8000000000007F8000000000007F800000000000FF000000000000FF00000000
0000FE000000000001FE000000000001FE000000000003FC000000000003FC0000000000
03F8000000000007F8000000000007F800000000000FF000000000000FF000000000000F
E000000000001FE000000000001FE000000000003FC000000000003FC000000000003F80
00000000007F8000000000007F800000000000FF000000000000FF000000000000FE0000
00000000FE0000000000007C0000000000007C000000000000347879D943>I<000003FF
C0000000003FFFFC00000000FFFFFF00000003FFFFFFC000000FFF81FFF000001FFC003F
F800003FF8001FFC00007FF0000FFE0000FFE00007FF0001FFC00003FF8003FF800001FF
C003FF800001FFC007FF800001FFE00FFF000000FFF00FFF000000FFF00FFF000000FFF0
1FFF000000FFF81FFF000000FFF83FFF000000FFFC3FFE0000007FFC3FFE0000007FFC3F
FE0000007FFC7FFE0000007FFE7FFE0000007FFE7FFE0000007FFE7FFE0000007FFE7FFE
0000007FFE7FFE0000007FFEFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE00
00007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000
007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE000000
7FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007F
FFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFFFFFE0000007FFF7FFE0000007FFE
7FFE0000007FFE7FFE0000007FFE7FFE0000007FFE7FFE0000007FFE7FFE0000007FFE3F
FE0000007FFC3FFE0000007FFC3FFF000000FFFC3FFF000000FFFC1FFF000000FFF81FFF
000000FFF81FFF000000FFF80FFF000000FFF00FFF000000FFF007FF800001FFE007FF80
0001FFE003FFC00003FFC001FFC00003FF8001FFE00007FF8000FFF0000FFF00007FF800
1FFE00001FFC003FF800000FFF81FFF0000007FFFFFFE0000001FFFFFF800000003FFFFC
0000000003FFC00000384F7BCD43>I<000000780000000000FC0000000003FC00000000
07FC000000001FFC00000000FFFC0000000FFFFC000007FFFFFC0000FFFFFFFC0000FFFF
FFFC0000FFFF7FFC0000FFF07FFC0000F8007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC000000007FFC000000007FFC00000000
7FFC000000007FFC000000007FFC000000007FFC00007FFFFFFFFFFE7FFFFFFFFFFE7FFF
FFFFFFFE7FFFFFFFFFFE7FFFFFFFFFFE2F4E76CD43>I<00003FFE0000000003FFFFE000
00000FFFFFFC0000003FFFFFFF000000FFFFFFFFC00001FFC07FFFE00003FE000FFFF800
07F80003FFFC000FE00001FFFE001FC00000FFFF003F8000007FFF003FF000007FFF807F
F800003FFFC07FFC00003FFFC0FFFE00001FFFE0FFFF00001FFFE0FFFF00001FFFE0FFFF
00000FFFF0FFFF00000FFFF0FFFF00000FFFF0FFFF00000FFFF0FFFF00000FFFF07FFE00
000FFFF07FFE00000FFFF03FFC00000FFFF00FF000000FFFF003C000000FFFF000000000
0FFFE0000000001FFFE0000000001FFFE0000000001FFFC0000000003FFFC0000000003F
FF80000000003FFF80000000007FFF00000000007FFE0000000000FFFC0000000001FFF8
0000000001FFF00000000003FFE00000000003FFC00000000007FF80000000000FFF0000
0000001FFE00000000001FFC00000000003FF800000000007FE00000000000FFC0000000
0001FF800000000003FE000000000007FC000000000007F800000000000FF00001F00000
1FE00001F000003F800001F000007F000001F00000FE000003E00001FC000003E00003F8
000003E00007F0000003E0000FE0000003E0001F80000007E0003F00000007E0003E0000
000FE0007FFFFFFFFFE000FFFFFFFFFFC001FFFFFFFFFFC003FFFFFFFFFFC007FFFFFFFF
FFC00FFFFFFFFFFFC01FFFFFFFFFFFC03FFFFFFFFFFFC07FFFFFFFFFFFC0FFFFFFFFFFFF
C0FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80344E79CD43>I<
00000FFFC000000000FFFFFC00000007FFFFFF8000001FFFFFFFE000003FF807FFF00000
FF8001FFFC0001FE00007FFE0003F800003FFF0003F000003FFF8007FC00001FFF800FFF
00001FFFC00FFF80001FFFC01FFFC0001FFFE01FFFC0001FFFE01FFFC0001FFFE01FFFC0
001FFFE01FFFE0001FFFE01FFFC0001FFFE01FFFC0001FFFE01FFFC0001FFFE00FFFC000
1FFFC007FF80001FFFC003FF00003FFFC001FC00003FFF80000000003FFF80000000007F
FF00000000007FFE00000000007FFE0000000000FFFC0000000001FFF80000000003FFF0
0000000007FFC0000000000FFF8000000000FFFE00000000FFFFF800000000FFFFE00000
0000FFFFFC00000000FFFFFF800000000007FFE00000000001FFF800000000007FFE0000
0000003FFF00000000001FFF80000000000FFFC0000000000FFFE00000000007FFF00000
000007FFF00000000007FFF80000000007FFF80000000003FFFC0000000003FFFC000000
0003FFFE0000000003FFFE03E0000003FFFE0FF8000003FFFE1FFC000003FFFE3FFE0000
03FFFE7FFF000003FFFEFFFF800003FFFEFFFF800003FFFEFFFF800003FFFEFFFF800003
FFFCFFFF800003FFFCFFFF800007FFFCFFFF800007FFF8FFFF000007FFF87FFF000007FF
F07FFE00000FFFF03FFC00000FFFE03FF000001FFFC01FE000003FFF800FF800007FFF00
07FF0000FFFE0003FFF007FFFC0000FFFFFFFFF000007FFFFFFFE000001FFFFFFF800000
03FFFFFC000000001FFF800000374F7ACD43>I<00000000007C00000000000000FE0000
0000000000FE00000000000001FE00000000000003FE00000000000007FE000000000000
0FFE0000000000000FFE0000000000001FFE0000000000003FFE0000000000007FFE0000
000000007FFE000000000000FFFE000000000001FFFE000000000003FFFE000000000003
FFFE000000000007FFFE00000000000FFFFE00000000001FBFFE00000000003F3FFE0000
0000003E3FFE00000000007C3FFE0000000000FC3FFE0000000001F83FFE0000000001F0
3FFE0000000003E03FFE0000000007E03FFE000000000FC03FFE000000000F803FFE0000
00001F003FFE000000003F003FFE000000007E003FFE000000007C003FFE00000000F800
3FFE00000001F8003FFE00000003F0003FFE00000007E0003FFE00000007C0003FFE0000
000F80003FFE0000001F80003FFE0000003F00003FFE0000003E00003FFE0000007C0000
3FFE000000FC00003FFE000001F800003FFE000001F000003FFE000003E000003FFE0000
07E000003FFE00000FC000003FFE00001F8000003FFE00001F0000003FFE00003E000000
3FFE00007E0000003FFE0000FC0000003FFE0000FFFFFFFFFFFFFFC0FFFFFFFFFFFFFFC0
FFFFFFFFFFFFFFC0FFFFFFFFFFFFFFC0FFFFFFFFFFFFFFC0000000007FFE000000000000
7FFE0000000000007FFE0000000000007FFE0000000000007FFE0000000000007FFE0000
000000007FFE0000000000007FFE0000000000007FFE0000000000007FFE000000000000
7FFE0000000000007FFE0000000000007FFE0000000000007FFE0000000000007FFE0000
00000FFFFFFFFFC000000FFFFFFFFFC000000FFFFFFFFFC000000FFFFFFFFFC000000FFF
FFFFFFC03A4F7CCE43>I<03800000000E0007E00000007E0007FE000003FE0007FFF000
7FFE0007FFFFFFFFFC0007FFFFFFFFF80007FFFFFFFFF00007FFFFFFFFE00007FFFFFFFF
C00007FFFFFFFF800007FFFFFFFF000007FFFFFFFE000007FFFFFFFC000007FFFFFFF000
0007FFFFFFC0000007FFFFFF00000007FFFFF800000007E1FF0000000007E00000000000
07E0000000000007E0000000000007E0000000000007E0000000000007E0000000000007
E0000000000007E0000000000007E0000000000007E0000000000007E0000000000007E0
0FFF00000007E07FFFF0000007E3FFFFFE000007E7FFFFFF800007FFF807FFC00007FFC0
01FFE00007FE0000FFF80007FC00007FFC0007F800003FFC0007F000003FFE0007E00000
1FFF0003C000001FFF80000000001FFF80000000001FFFC0000000000FFFC0000000000F
FFE0000000000FFFE0000000000FFFE0000000000FFFE0000000000FFFF0000000000FFF
F0000000000FFFF00FE000000FFFF01FF000000FFFF03FF800000FFFF07FFC00000FFFF0
FFFE00000FFFF0FFFE00000FFFF0FFFE00000FFFF0FFFE00000FFFF0FFFE00000FFFE0FF
FE00000FFFE0FFFE00000FFFE0FFFC00000FFFE07FF800001FFFC07FF000001FFFC07FE0
00001FFF803E0000003FFF803F0000003FFF001F8000007FFE001FC000007FFC000FE000
00FFF80007F80001FFF00003FE0007FFE00001FFC03FFFC00000FFFFFFFF8000003FFFFF
FE0000001FFFFFF800000003FFFFC0000000007FF8000000344F79CD43>I<0000000FFF
0000000000FFFFE000000007FFFFF00000001FFFFFFC0000007FFE03FE000001FFF0007F
000003FFC0003F800007FF00001F80000FFE00007FC0001FFC0000FFC0003FF80001FFE0
007FF00003FFE000FFF00007FFE001FFE00007FFE001FFE00007FFE003FFC00007FFE007
FFC00007FFE007FFC00007FFE00FFFC00003FFC00FFF800001FF801FFF800000FF001FFF
8000007E001FFF80000000003FFF80000000003FFF80000000003FFF00000000007FFF00
000000007FFF00000000007FFF00080000007FFF01FFF800007FFF07FFFF0000FFFF0FFF
FFC000FFFF1FFFFFF000FFFF3F007FF800FFFF3C003FFC00FFFF78001FFE00FFFFF0000F
FF00FFFFF00007FF80FFFFE00007FFC0FFFFE00007FFC0FFFFC00007FFE0FFFFC00003FF
F0FFFF800003FFF0FFFF800003FFF8FFFF800003FFF8FFFF800003FFF8FFFF800003FFF8
FFFF000003FFFCFFFF000003FFFCFFFF000003FFFC7FFF000003FFFC7FFF000003FFFC7F
FF000003FFFC7FFF000003FFFC7FFF000003FFFC7FFF000003FFFC3FFF000003FFFC3FFF
000003FFFC3FFF000003FFFC3FFF000003FFFC1FFF000003FFF81FFF800003FFF81FFF80
0003FFF80FFF800003FFF80FFF800003FFF007FF800007FFF007FF800007FFE003FFC000
07FFC001FFC00007FFC001FFE0000FFF8000FFF0000FFF00007FF8001FFE00003FFC007F
FC00001FFF01FFF800000FFFFFFFF0000003FFFFFFC0000000FFFFFF000000003FFFFC00
00000007FFC00000364F7ACD43>I<1F000000000000001F800000000000001FC0000000
0000001FFF8000000000001FFFFFFFFFFFFF801FFFFFFFFFFFFF801FFFFFFFFFFFFF801F
FFFFFFFFFFFF803FFFFFFFFFFFFF803FFFFFFFFFFFFF003FFFFFFFFFFFFE003FFFFFFFFF
FFFC003FFFFFFFFFFFF8003FFFFFFFFFFFF8003FFFFFFFFFFFF0003FFFFFFFFFFFE0003F
FFFFFFFFFFC0007FFFFFFFFFFF80007F800000007F00007E00000000FF00007E00000001
FE00007C00000003FC00007C00000003F800007C00000007F000007C0000000FF000007C
0000001FE00000F80000003FC00000F80000007F800000F80000007F000000F8000000FE
00000000000001FE00000000000003FC00000000000003F800000000000007F000000000
00000FF00000000000001FE00000000000001FE00000000000003FC00000000000003FC0
0000000000007F80000000000000FF80000000000000FF80000000000001FF0000000000
0001FF00000000000003FF00000000000003FE00000000000007FE00000000000007FE00
00000000000FFE0000000000000FFE0000000000000FFC0000000000001FFC0000000000
001FFC0000000000003FFC0000000000003FFC0000000000003FFC0000000000003FFC00
00000000007FFC0000000000007FF80000000000007FF80000000000007FF80000000000
00FFF8000000000000FFF8000000000000FFF8000000000000FFF8000000000000FFF800
0000000001FFF8000000000001FFF8000000000001FFF8000000000001FFF80000000000
01FFF8000000000001FFF8000000000001FFF8000000000001FFF8000000000001FFF800
0000000001FFF8000000000001FFF8000000000001FFF8000000000000FFF00000000000
00FFF00000000000003FC00000000000001F8000000000395279D043>I<000007FFC000
0000007FFFFC00000003FFFFFF8000000FFFFFFFE000001FFC01FFF800003FE0003FFC00
007F80000FFE0000FF000007FF0001FE000003FF0003FC000001FF8007FC000001FFC007
F8000000FFC00FF8000000FFC00FF8000000FFE00FF80000007FE00FF80000007FE01FF8
0000007FE01FFC0000007FE01FFC0000007FE01FFE0000007FE01FFF0000007FE01FFF80
0000FFE01FFFE00000FFC01FFFF80000FFC01FFFFE0001FF800FFFFF0001FF800FFFFFC0
03FF000FFFFFF007FE0007FFFFF807FC0007FFFFFE1FF80003FFFFFFBFF00001FFFFFFFF
E00001FFFFFFFF800000FFFFFFFE0000007FFFFFFF0000003FFFFFFF8000000FFFFFFFE0
000007FFFFFFF0000001FFFFFFFC000007FFFFFFFE00001FFFFFFFFF00003FFFFFFFFF80
00FFE7FFFFFF8001FF81FFFFFFC003FF007FFFFFE007FE001FFFFFF00FFC000FFFFFF01F
F80003FFFFF01FF80000FFFFF83FF000007FFFF83FF000001FFFF87FE0000007FFFC7FE0
000001FFFC7FE0000000FFFCFFC00000007FFCFFC00000003FFCFFC00000003FFCFFC000
00001FFCFFC00000001FFCFFC00000000FFCFFC00000000FFCFFC00000000FF8FFC00000
000FF8FFE00000000FF87FE00000000FF07FF00000001FF07FF00000001FF03FF8000000
3FE01FF80000003FC01FFC0000007FC00FFE000000FF8007FF800003FF0003FFE0000FFE
0001FFFC00FFFC00007FFFFFFFF000003FFFFFFFE000000FFFFFFF80000001FFFFFC0000
00000FFFC00000364F7ACD43>I<00000FFF8000000000FFFFF800000003FFFFFE000000
0FFFFFFF8000001FFF03FFC000007FF800FFE00000FFF0003FF00001FFE0001FF80003FF
C0001FFC0007FFC0000FFE000FFF80000FFF000FFF800007FF001FFF800007FF803FFF80
0007FF803FFF000007FFC07FFF000007FFC07FFF000003FFE07FFF000003FFE07FFF0000
03FFF0FFFF000003FFF0FFFF000003FFF0FFFF000003FFF0FFFF000003FFF8FFFF000003
FFF8FFFF000003FFF8FFFF000003FFF8FFFF000003FFF8FFFF000003FFF8FFFF000003FF
FCFFFF000003FFFCFFFF000003FFFCFFFF000003FFFC7FFF000007FFFC7FFF000007FFFC
7FFF000007FFFC3FFF000007FFFC3FFF000007FFFC3FFF00000FFFFC1FFF80000FFFFC0F
FF80001FFFFC0FFF80001FFFFC07FF80003FFFFC03FFC0003FFFFC01FFE0007BFFFC00FF
F000F3FFFC007FF803F3FFFC001FFFFFE3FFFC000FFFFFC3FFFC0003FFFF83FFF800007F
FE03FFF80000004003FFF80000000003FFF80000000003FFF80000000003FFF000000000
07FFF00000000007FFF00000000007FFF001F8000007FFE003FC000007FFE007FE000007
FFC00FFF000007FFC01FFF80000FFF801FFF80000FFF801FFF80000FFF001FFF80001FFF
001FFF80001FFE001FFF80003FFC001FFF00003FFC000FFE00007FF8000FFC0000FFF000
0FF80001FFE00007F00003FFC00003FC000FFF800003FF807FFE000001FFFFFFFC000000
7FFFFFF00000003FFFFFC00000000FFFFE0000000000FFF0000000364F7ACD43>I<07F0
000FF8001FFC003FFE007FFF00FFFF80FFFF80FFFF80FFFF80FFFF80FFFF80FFFF807FFF
003FFE001FFC000FF80007F0000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000007F0
000FF8001FFC003FFE007FFF00FFFF80FFFF80FFFF80FFFF80FFFF80FFFF80FFFF807FFF
003FFE001FFC000FF80007F000113576B425>I<00000000001F00000000000000000000
003F80000000000000000000007FC0000000000000000000007FC0000000000000000000
00FFE000000000000000000000FFE000000000000000000000FFE0000000000000000000
01FFF000000000000000000001FFF000000000000000000003FFF8000000000000000000
03FFF800000000000000000003FFF800000000000000000007FFFC000000000000000000
07FFFC00000000000000000007FFFC0000000000000000000FFFFE000000000000000000
0FFFFE0000000000000000001FFFFF0000000000000000001FFFFF000000000000000000
1FFFFF0000000000000000003FFFFF8000000000000000003F7FFF800000000000000000
7F7FFFC000000000000000007E7FFFC000000000000000007E3FFFC00000000000000000
FE3FFFE00000000000000000FC1FFFE00000000000000001FC1FFFF00000000000000001
F81FFFF00000000000000001F80FFFF00000000000000003F80FFFF80000000000000003
F007FFF80000000000000007F007FFFC0000000000000007E007FFFC0000000000000007
E003FFFC000000000000000FE003FFFE000000000000000FC001FFFE000000000000001F
C001FFFF000000000000001F8001FFFF000000000000001F8000FFFF000000000000003F
8000FFFF800000000000003F00007FFF800000000000007F00007FFFC00000000000007E
00007FFFC00000000000007E00003FFFC0000000000000FE00003FFFE0000000000000FC
00001FFFE0000000000001FC00001FFFF0000000000001F800001FFFF0000000000001F8
00000FFFF0000000000003F800000FFFF8000000000003F0000007FFF8000000000007F0
000007FFFC000000000007E0000007FFFC000000000007E0000003FFFC00000000000FFF
FFFFFFFFFE00000000000FFFFFFFFFFFFE00000000001FFFFFFFFFFFFF00000000001FFF
FFFFFFFFFF00000000001FFFFFFFFFFFFF00000000003F80000000FFFF80000000003F00
0000007FFF80000000007F000000007FFFC0000000007F000000007FFFC0000000007E00
0000003FFFC000000000FE000000003FFFE000000000FC000000001FFFE000000001FC00
0000001FFFF000000001FC000000001FFFF000000001F8000000000FFFF000000003F800
0000000FFFF800000003F00000000007FFF800000007F00000000007FFFC00000007F000
00000007FFFC00000007E00000000003FFFC0000000FE00000000003FFFE0000000FC000
00000003FFFE0000001FC00000000001FFFF000000FFFC0000000001FFFF0000FFFFFFF8
00000FFFFFFFFFE0FFFFFFF800000FFFFFFFFFE0FFFFFFF800000FFFFFFFFFE0FFFFFFF8
00000FFFFFFFFFE0FFFFFFF800000FFFFFFFFFE05B547BD366>65
D<FFFFFFFFFFFFFFC0000000FFFFFFFFFFFFFFFE000000FFFFFFFFFFFFFFFFC00000FFFF
FFFFFFFFFFFFF00000FFFFFFFFFFFFFFFFFC00000007FFF0000003FFFF00000007FFF000
00007FFF80000007FFF00000003FFFC0000007FFF00000000FFFE0000007FFF000000007
FFF0000007FFF000000007FFF8000007FFF000000003FFF8000007FFF000000003FFFC00
0007FFF000000001FFFC000007FFF000000001FFFE000007FFF000000000FFFE000007FF
F000000000FFFE000007FFF000000000FFFF000007FFF000000000FFFF000007FFF00000
0000FFFF000007FFF000000000FFFF000007FFF000000000FFFF000007FFF000000000FF
FF000007FFF000000000FFFF000007FFF000000000FFFF000007FFF000000001FFFE0000
07FFF000000001FFFE000007FFF000000001FFFC000007FFF000000003FFFC000007FFF0
00000003FFF8000007FFF000000007FFF8000007FFF000000007FFF0000007FFF0000000
0FFFE0000007FFF00000001FFFC0000007FFF00000007FFF00000007FFF0000001FFFE00
000007FFF0000007FFF800000007FFFFFFFFFFFFE000000007FFFFFFFFFFFF0000000007
FFFFFFFFFFFF8000000007FFFFFFFFFFFFF000000007FFF0000003FFFE00000007FFF000
00003FFF80000007FFF00000000FFFE0000007FFF000000007FFF0000007FFF000000001
FFF8000007FFF000000001FFFC000007FFF000000000FFFE000007FFF0000000007FFF00
0007FFF0000000007FFF800007FFF0000000003FFFC00007FFF0000000003FFFC00007FF
F0000000001FFFE00007FFF0000000001FFFE00007FFF0000000001FFFE00007FFF00000
00001FFFF00007FFF0000000001FFFF00007FFF0000000001FFFF00007FFF0000000000F
FFF00007FFF0000000000FFFF00007FFF0000000000FFFF00007FFF0000000001FFFF000
07FFF0000000001FFFF00007FFF0000000001FFFF00007FFF0000000001FFFE00007FFF0
000000001FFFE00007FFF0000000003FFFE00007FFF0000000003FFFC00007FFF0000000
003FFFC00007FFF0000000007FFF800007FFF000000000FFFF800007FFF000000000FFFF
000007FFF000000001FFFE000007FFF000000007FFFE000007FFF00000000FFFFC000007
FFF00000003FFFF0000007FFF0000001FFFFE000FFFFFFFFFFFFFFFFFF8000FFFFFFFFFF
FFFFFFFF0000FFFFFFFFFFFFFFFFF80000FFFFFFFFFFFFFFFFC00000FFFFFFFFFFFFFFF8
00000054527CD160>I<0000000001FFFC000001C0000000007FFFFFC00003C000000007
FFFFFFF80007C00000003FFFFFFFFE001FC0000000FFFFFFFFFF803FC0000003FFFFE003
FFC07FC000000FFFFC00003FF0FFC000003FFFE000000FF9FFC000007FFF80000003FFFF
C00001FFFE00000000FFFFC00003FFF8000000007FFFC00007FFF0000000003FFFC0000F
FFE0000000001FFFC0001FFFC0000000000FFFC0003FFF800000000007FFC0007FFF0000
00000003FFC000FFFE000000000001FFC000FFFE000000000001FFC001FFFC0000000000
00FFC003FFF8000000000000FFC003FFF80000000000007FC007FFF00000000000007FC0
0FFFF00000000000003FC00FFFF00000000000003FC01FFFE00000000000001FC01FFFE0
0000000000001FC01FFFE00000000000001FC03FFFC00000000000001FC03FFFC0000000
0000000FC03FFFC00000000000000FC07FFFC00000000000000FC07FFFC0000000000000
0FC07FFFC000000000000000007FFF8000000000000000007FFF800000000000000000FF
FF800000000000000000FFFF800000000000000000FFFF800000000000000000FFFF8000
00000000000000FFFF800000000000000000FFFF800000000000000000FFFF8000000000
00000000FFFF800000000000000000FFFF800000000000000000FFFF8000000000000000
00FFFF800000000000000000FFFF800000000000000000FFFF800000000000000000FFFF
8000000000000000007FFF8000000000000000007FFF8000000000000000007FFFC00000
0000000000007FFFC000000000000000007FFFC000000000000007C03FFFC00000000000
0007C03FFFC000000000000007C03FFFC000000000000007C01FFFE000000000000007C0
1FFFE000000000000007C01FFFE00000000000000FC00FFFF00000000000000F800FFFF0
0000000000000F8007FFF00000000000001F8003FFF80000000000001F8003FFF8000000
0000001F0001FFFC0000000000003F0000FFFE0000000000007E0000FFFE000000000000
7E00007FFF000000000000FC00003FFF800000000001F800001FFFC00000000003F80000
0FFFE00000000007F0000007FFF0000000000FE0000003FFFC000000001FC0000001FFFE
000000007F800000007FFF80000000FF000000003FFFE0000007FE000000000FFFFE0000
1FF80000000003FFFFE001FFF00000000000FFFFFFFFFFC000000000003FFFFFFFFF0000
0000000007FFFFFFFC000000000000007FFFFFE00000000000000001FFFC000000005254
79D261>I<FFFFFFFFFFFFFF8000000000FFFFFFFFFFFFFFFC00000000FFFFFFFFFFFFFF
FF80000000FFFFFFFFFFFFFFFFF0000000FFFFFFFFFFFFFFFFFC0000000007FFF000000F
FFFF0000000007FFF0000000FFFFC000000007FFF00000001FFFE000000007FFF0000000
07FFF800000007FFF000000001FFFC00000007FFF000000000FFFE00000007FFF0000000
007FFF00000007FFF0000000003FFF80000007FFF0000000001FFFC0000007FFF0000000
000FFFC0000007FFF00000000007FFE0000007FFF00000000003FFF0000007FFF0000000
0003FFF8000007FFF00000000001FFF8000007FFF00000000001FFFC000007FFF0000000
0000FFFC000007FFF00000000000FFFE000007FFF00000000000FFFE000007FFF0000000
00007FFF000007FFF000000000007FFF000007FFF000000000007FFF000007FFF0000000
00007FFF800007FFF000000000003FFF800007FFF000000000003FFF800007FFF0000000
00003FFFC00007FFF000000000003FFFC00007FFF000000000003FFFC00007FFF0000000
00003FFFC00007FFF000000000003FFFC00007FFF000000000003FFFE00007FFF0000000
00003FFFE00007FFF000000000003FFFE00007FFF000000000001FFFE00007FFF0000000
00001FFFE00007FFF000000000001FFFE00007FFF000000000001FFFE00007FFF0000000
00001FFFE00007FFF000000000001FFFE00007FFF000000000001FFFE00007FFF0000000
00001FFFE00007FFF000000000001FFFE00007FFF000000000003FFFE00007FFF0000000
00003FFFE00007FFF000000000003FFFE00007FFF000000000003FFFC00007FFF0000000
00003FFFC00007FFF000000000003FFFC00007FFF000000000003FFFC00007FFF0000000
00003FFFC00007FFF000000000003FFF800007FFF000000000003FFF800007FFF0000000
00007FFF800007FFF000000000007FFF000007FFF000000000007FFF000007FFF0000000
00007FFF000007FFF00000000000FFFE000007FFF00000000000FFFE000007FFF0000000
0000FFFC000007FFF00000000001FFFC000007FFF00000000001FFF8000007FFF0000000
0003FFF0000007FFF00000000007FFF0000007FFF00000000007FFE0000007FFF0000000
000FFFC0000007FFF0000000001FFF80000007FFF0000000003FFF00000007FFF0000000
00FFFE00000007FFF000000001FFFC00000007FFF000000007FFF800000007FFF0000000
1FFFF000000007FFF0000000FFFFC000000007FFF000000FFFFF000000FFFFFFFFFFFFFF
FFFE000000FFFFFFFFFFFFFFFFF0000000FFFFFFFFFFFFFFFFC0000000FFFFFFFFFFFFFF
FC00000000FFFFFFFFFFFFFF80000000005B527CD167>I<FFFFFFFFFFFFFFFFFF80FFFF
FFFFFFFFFFFFFF80FFFFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFF
FF800007FFF8000001FFFFC00007FFF80000001FFFC00007FFF800000007FFC00007FFF8
00000001FFC00007FFF800000000FFC00007FFF8000000007FC00007FFF8000000003FC0
0007FFF8000000001FC00007FFF8000000001FC00007FFF8000000000FE00007FFF80000
00000FE00007FFF80000000007E00007FFF80000000007E00007FFF80000000007E00007
FFF80000000003E00007FFF80000000003E00007FFF80000000003E00007FFF80000F800
03E00007FFF80000F80003F00007FFF80000F80001F00007FFF80000F80001F00007FFF8
0000F80001F00007FFF80000F80001F00007FFF80000F80000000007FFF80001F8000000
0007FFF80001F80000000007FFF80001F80000000007FFF80003F80000000007FFF80007
F80000000007FFF8000FF80000000007FFF8007FF80000000007FFFFFFFFF80000000007
FFFFFFFFF80000000007FFFFFFFFF80000000007FFFFFFFFF80000000007FFFFFFFFF800
00000007FFF8007FF80000000007FFF8000FF80000000007FFF80007F80000000007FFF8
0003F80000000007FFF80001F80000000007FFF80001F80000000007FFF80001F8000000
0007FFF80000F80000000007FFF80000F800003E0007FFF80000F800003E0007FFF80000
F800003E0007FFF80000F800007C0007FFF80000F800007C0007FFF80000F800007C0007
FFF800000000007C0007FFF800000000007C0007FFF80000000000FC0007FFF800000000
00FC0007FFF80000000000F80007FFF80000000000F80007FFF80000000001F80007FFF8
0000000001F80007FFF80000000001F80007FFF80000000003F80007FFF80000000003F0
0007FFF80000000007F00007FFF8000000000FF00007FFF8000000000FF00007FFF80000
00001FF00007FFF8000000003FF00007FFF8000000007FE00007FFF800000001FFE00007
FFF800000007FFE00007FFF80000001FFFE00007FFF8000003FFFFE0FFFFFFFFFFFFFFFF
FFE0FFFFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFF
FFFFFFFFFFC04F517CD058>I<FFFFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFFFE00FFFFFF
FFFFFFFFFFFE00FFFFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFFFE000007FFF8000007FFFF
000007FFF80000007FFF000007FFF80000001FFF000007FFF800000007FF000007FFF800
000003FF000007FFF800000001FF000007FFF800000000FF000007FFF8000000007F0000
07FFF8000000003F000007FFF8000000003F800007FFF8000000003F800007FFF8000000
001F800007FFF8000000001F800007FFF8000000001F800007FFF8000000000F800007FF
F8000000000F800007FFF8000000000F800007FFF8000000000F800007FFF8000000000F
C00007FFF80000F80007C00007FFF80000F80007C00007FFF80000F80007C00007FFF800
00F80007C00007FFF80000F80000000007FFF80000F80000000007FFF80000F800000000
07FFF80001F80000000007FFF80001F80000000007FFF80001F80000000007FFF80003F8
0000000007FFF80007F80000000007FFF8000FF80000000007FFF8007FF80000000007FF
FFFFFFF80000000007FFFFFFFFF80000000007FFFFFFFFF80000000007FFFFFFFFF80000
000007FFFFFFFFF80000000007FFF8007FF80000000007FFF8000FF80000000007FFF800
07F80000000007FFF80003F80000000007FFF80001F80000000007FFF80001F800000000
07FFF80001F80000000007FFF80000F80000000007FFF80000F80000000007FFF80000F8
0000000007FFF80000F80000000007FFF80000F80000000007FFF80000F80000000007FF
F80000F80000000007FFF80000000000000007FFF80000000000000007FFF80000000000
000007FFF80000000000000007FFF80000000000000007FFF80000000000000007FFF800
00000000000007FFF80000000000000007FFF80000000000000007FFF800000000000000
07FFF80000000000000007FFF80000000000000007FFF80000000000000007FFF8000000
0000000007FFF80000000000000007FFF80000000000000007FFF80000000000000007FF
F80000000000000007FFF8000000000000FFFFFFFFFFF800000000FFFFFFFFFFF8000000
00FFFFFFFFFFF800000000FFFFFFFFFFF800000000FFFFFFFFFFF8000000004A517CD055
>I<FFFFFFFFFFC003FFFFFFFFFFFFFFFFFFFFC003FFFFFFFFFFFFFFFFFFFFC003FFFFFF
FFFFFFFFFFFFFFC003FFFFFFFFFFFFFFFFFFFFC003FFFFFFFFFF0007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFFFFFFFFFFFFFFFE0000007FFFFFFFFFFFFFFFF
E0000007FFFFFFFFFFFFFFFFE0000007FFFFFFFFFFFFFFFFE0000007FFFFFFFFFFFFFFFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE0000007FFF8000000001FFF
E0000007FFF8000000001FFFE0000007FFF8000000001FFFE000FFFFFFFFFFC003FFFFFF
FFFFFFFFFFFFFFC003FFFFFFFFFFFFFFFFFFFFC003FFFFFFFFFFFFFFFFFFFFC003FFFFFF
FFFFFFFFFFFFFFC003FFFFFFFFFF60527CD169>72 D<FFFFFFFFFFC0FFFFFFFFFFC0FFFF
FFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC00007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007FFF800000007
FFF800000007FFF800000007FFF80000FFFFFFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC0FFFF
FFFFFFC0FFFFFFFFFFC02A527CD132>I<FFFFFFFFFFC00000FFFFFFF8FFFFFFFFFFC000
00FFFFFFF8FFFFFFFFFFC00000FFFFFFF8FFFFFFFFFFC00000FFFFFFF8FFFFFFFFFFC000
00FFFFFFF80007FFF80000000003FFF8000007FFF800000000007F80000007FFF8000000
0000FF00000007FFF80000000001FE00000007FFF80000000003F800000007FFF8000000
000FF000000007FFF8000000001FE000000007FFF8000000003FC000000007FFF8000000
007F8000000007FFF800000000FF0000000007FFF800000001FC0000000007FFF8000000
07F80000000007FFF80000000FF00000000007FFF80000001FE00000000007FFF8000000
3FC00000000007FFF80000007F800000000007FFF8000000FE000000000007FFF8000003
FC000000000007FFF8000007F8000000000007FFF800000FF0000000000007FFF800001F
E0000000000007FFF800003FC0000000000007FFF800007F80000000000007FFF80001FE
00000000000007FFF80003FC00000000000007FFF80007F800000000000007FFF8000FF0
00000000000007FFF8001FF800000000000007FFF8003FF800000000000007FFF8007FFC
00000000000007FFF801FFFE00000000000007FFF803FFFF00000000000007FFF807FFFF
00000000000007FFF80FFFFF80000000000007FFF81FFFFFC0000000000007FFF83FFFFF
E0000000000007FFF8FF7FFFE0000000000007FFF9FE3FFFF0000000000007FFFBFC3FFF
F8000000000007FFFFF81FFFFC000000000007FFFFF00FFFFC000000000007FFFFC007FF
FE000000000007FFFF8007FFFF000000000007FFFF0003FFFF000000000007FFFE0001FF
FF800000000007FFFC0000FFFFC00000000007FFF80000FFFFE00000000007FFF800007F
FFE00000000007FFF800003FFFF00000000007FFF800001FFFF80000000007FFF800001F
FFFC0000000007FFF800000FFFFC0000000007FFF8000007FFFE0000000007FFF8000003
FFFF0000000007FFF8000003FFFF8000000007FFF8000001FFFF8000000007FFF8000000
FFFFC000000007FFF8000000FFFFE000000007FFF80000007FFFF000000007FFF8000000
3FFFF000000007FFF80000001FFFF800000007FFF80000001FFFFC00000007FFF8000000
0FFFFE00000007FFF800000007FFFE00000007FFF800000003FFFF00000007FFF8000000
03FFFF80000007FFF800000001FFFF80000007FFF800000000FFFFC0000007FFF8000000
007FFFE0000007FFF8000000007FFFF0000007FFF8000000003FFFF0000007FFF8000000
00FFFFFC00FFFFFFFFFFC0003FFFFFFFFEFFFFFFFFFFC0003FFFFFFFFEFFFFFFFFFFC000
3FFFFFFFFEFFFFFFFFFFC0003FFFFFFFFEFFFFFFFFFFC0003FFFFFFFFE5F527CD169>75
D<FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF80000
00FFFFFFFFFFF80000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF800000000000007FFF800000000
000007FFF800000000000007FFF800000000000007FFF8000000007C0007FFF800000000
7C0007FFF8000000007C0007FFF8000000007C0007FFF800000000FC0007FFF800000000
F80007FFF800000000F80007FFF800000000F80007FFF800000000F80007FFF800000000
F80007FFF800000001F80007FFF800000001F80007FFF800000001F80007FFF800000003
F80007FFF800000003F80007FFF800000007F80007FFF800000007F00007FFF80000000F
F00007FFF80000000FF00007FFF80000001FF00007FFF80000003FF00007FFF80000007F
F00007FFF8000000FFF00007FFF8000003FFF00007FFF8000007FFF00007FFF800003FFF
F00007FFF80001FFFFF0FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFFFF
E0FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFFFFE046527CD151>I<FFFFFFFC000000000000
003FFFFFFEFFFFFFFE000000000000007FFFFFFEFFFFFFFE000000000000007FFFFFFEFF
FFFFFF00000000000000FFFFFFFEFFFFFFFF00000000000000FFFFFFFE0007FFFF000000
00000000FFFFC0000007FFFF80000000000001EFFFC0000007FFFF80000000000001EFFF
C0000007EFFFC0000000000003CFFFC0000007EFFFC0000000000003CFFFC0000007E7FF
E00000000000078FFFC0000007E7FFE00000000000078FFFC0000007E3FFF00000000000
0F0FFFC0000007E3FFF000000000000F0FFFC0000007E1FFF800000000001E0FFFC00000
07E1FFF800000000001E0FFFC0000007E1FFF800000000001E0FFFC0000007E0FFFC0000
0000003C0FFFC0000007E0FFFC00000000003C0FFFC0000007E07FFE0000000000780FFF
C0000007E07FFE0000000000780FFFC0000007E03FFF0000000000F00FFFC0000007E03F
FF0000000000F00FFFC0000007E01FFF8000000001E00FFFC0000007E01FFF8000000001
E00FFFC0000007E00FFFC000000003C00FFFC0000007E00FFFC000000003C00FFFC00000
07E00FFFC000000003C00FFFC0000007E007FFE000000007800FFFC0000007E007FFE000
000007800FFFC0000007E003FFF00000000F000FFFC0000007E003FFF00000000F000FFF
C0000007E001FFF80000001E000FFFC0000007E001FFF80000001E000FFFC0000007E000
FFFC0000003C000FFFC0000007E000FFFC0000003C000FFFC0000007E000FFFC0000003C
000FFFC0000007E0007FFE00000078000FFFC0000007E0007FFE00000078000FFFC00000
07E0003FFF000000F0000FFFC0000007E0003FFF000000F0000FFFC0000007E0001FFF80
0001E0000FFFC0000007E0001FFF800001E0000FFFC0000007E0000FFFC00003C0000FFF
C0000007E0000FFFC00003C0000FFFC0000007E00007FFE0000780000FFFC0000007E000
07FFE0000780000FFFC0000007E00007FFE0000780000FFFC0000007E00003FFF0000F00
000FFFC0000007E00003FFF0000F00000FFFC0000007E00001FFF8001E00000FFFC00000
07E00001FFF8001E00000FFFC0000007E00000FFFC003C00000FFFC0000007E00000FFFC
003C00000FFFC0000007E000007FFE007800000FFFC0000007E000007FFE007800000FFF
C0000007E000007FFE007800000FFFC0000007E000003FFF00F000000FFFC0000007E000
003FFF00F000000FFFC0000007E000001FFF81E000000FFFC0000007E000001FFF81E000
000FFFC0000007E000000FFFC3C000000FFFC0000007E000000FFFC3C000000FFFC00000
07E0000007FFE78000000FFFC0000007E0000007FFE78000000FFFC0000007E0000003FF
FF0000000FFFC0000007E0000003FFFF0000000FFFC0000007E0000003FFFF0000000FFF
C0000007E0000001FFFE0000000FFFC0000007E0000001FFFE0000000FFFC0000007E000
0000FFFC0000000FFFC0000007E0000000FFFC0000000FFFC0000007E00000007FF80000
000FFFC0000007E00000007FF80000000FFFC0000007E00000003FF00000000FFFC00000
07E00000003FF00000000FFFC000003FFC0000001FE00000000FFFC000FFFFFFFF00001F
E00001FFFFFFFFFEFFFFFFFF00001FE00001FFFFFFFFFEFFFFFFFF00000FC00001FFFFFF
FFFEFFFFFFFF00000FC00001FFFFFFFFFEFFFFFFFF000007800001FFFFFFFFFE77527CD1
80>I<FFFFFFFC00000000FFFFFFFFFFFFFFFE00000000FFFFFFFFFFFFFFFF00000000FF
FFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF80000000FFFFFFFF0007FFFFC000000000
3FFC000007FFFFE00000000007E0000007FFFFF00000000007E0000007FFFFF800000000
07E0000007FFFFF80000000007E0000007FFFFFC0000000007E0000007EFFFFE00000000
07E0000007E7FFFF0000000007E0000007E3FFFF8000000007E0000007E3FFFF80000000
07E0000007E1FFFFC000000007E0000007E0FFFFE000000007E0000007E07FFFF0000000
07E0000007E03FFFF800000007E0000007E01FFFFC00000007E0000007E01FFFFC000000
07E0000007E00FFFFE00000007E0000007E007FFFF00000007E0000007E003FFFF800000
07E0000007E001FFFFC0000007E0000007E001FFFFC0000007E0000007E000FFFFE00000
07E0000007E0007FFFF0000007E0000007E0003FFFF8000007E0000007E0001FFFFC0000
07E0000007E0000FFFFE000007E0000007E0000FFFFE000007E0000007E00007FFFF0000
07E0000007E00003FFFF800007E0000007E00001FFFFC00007E0000007E00000FFFFE000
07E0000007E00000FFFFF00007E0000007E000007FFFF00007E0000007E000003FFFF800
07E0000007E000001FFFFC0007E0000007E000000FFFFE0007E0000007E0000007FFFF00
07E0000007E0000007FFFF0007E0000007E0000003FFFF8007E0000007E0000001FFFFC0
07E0000007E0000000FFFFE007E0000007E00000007FFFF007E0000007E00000003FFFF8
07E0000007E00000003FFFF807E0000007E00000001FFFFC07E0000007E00000000FFFFE
07E0000007E000000007FFFF07E0000007E000000003FFFF87E0000007E000000003FFFF
87E0000007E000000001FFFFC7E0000007E000000000FFFFE7E0000007E0000000007FFF
F7E0000007E0000000003FFFFFE0000007E0000000001FFFFFE0000007E0000000001FFF
FFE0000007E0000000000FFFFFE0000007E00000000007FFFFE0000007E00000000003FF
FFE0000007E00000000001FFFFE0000007E00000000001FFFFE0000007E00000000000FF
FFE0000007E000000000007FFFE0000007E000000000003FFFE0000007E000000000001F
FFE0000007E000000000000FFFE0000007E000000000000FFFE0000007E0000000000007
FFE0000007E0000000000003FFE0000007E0000000000001FFE0000007E0000000000000
FFE0000007E0000000000000FFE000003FFC0000000000007FE000FFFFFFFF0000000000
3FE000FFFFFFFF00000000001FE000FFFFFFFF00000000000FE000FFFFFFFF0000000000
07E000FFFFFFFF000000000003C00060527CD169>I<000000000FFFC000000000000000
03FFFFFF000000000000001FFFFFFFE0000000000000FFFFFFFFFC000000000003FFFC00
FFFF00000000000FFFC0000FFFC0000000003FFF000003FFF0000000007FFC000000FFF8
00000001FFF80000007FFE00000003FFE00000001FFF00000007FFC00000000FFF800000
0FFF8000000007FFC000001FFF0000000003FFE000003FFF0000000003FFF000007FFE00
00000001FFF80000FFFC0000000000FFFC0000FFFC0000000000FFFC0001FFF800000000
007FFE0003FFF800000000007FFF0003FFF000000000003FFF0007FFF000000000003FFF
8007FFE000000000001FFF800FFFE000000000001FFFC00FFFE000000000001FFFC01FFF
E000000000001FFFE01FFFC000000000000FFFE01FFFC000000000000FFFE03FFFC00000
0000000FFFF03FFFC000000000000FFFF03FFFC000000000000FFFF07FFF800000000000
07FFF87FFF80000000000007FFF87FFF80000000000007FFF87FFF80000000000007FFF8
7FFF80000000000007FFF8FFFF80000000000007FFFCFFFF80000000000007FFFCFFFF80
000000000007FFFCFFFF80000000000007FFFCFFFF80000000000007FFFCFFFF80000000
000007FFFCFFFF80000000000007FFFCFFFF80000000000007FFFCFFFF80000000000007
FFFCFFFF80000000000007FFFCFFFF80000000000007FFFCFFFF80000000000007FFFCFF
FF80000000000007FFFCFFFF80000000000007FFFCFFFF80000000000007FFFC7FFF8000
0000000007FFF87FFFC000000000000FFFF87FFFC000000000000FFFF87FFFC000000000
000FFFF87FFFC000000000000FFFF83FFFC000000000000FFFF03FFFC000000000000FFF
F03FFFE000000000001FFFF01FFFE000000000001FFFE01FFFE000000000001FFFE01FFF
E000000000001FFFE00FFFF000000000003FFFC00FFFF000000000003FFFC007FFF80000
0000007FFF8007FFF800000000007FFF8003FFF800000000007FFF0001FFFC0000000000
FFFE0001FFFE0000000001FFFE0000FFFE0000000001FFFC00007FFF0000000003FFF800
003FFF8000000007FFF000001FFFC00000000FFFE000000FFFE00000001FFFC0000007FF
F00000003FFF80000003FFF80000007FFF00000001FFFC000000FFFE00000000FFFF0000
03FFFC000000003FFFE0001FFFF0000000000FFFFC00FFFFC00000000003FFFFFFFFFF00
0000000000FFFFFFFFFC0000000000001FFFFFFFE000000000000003FFFFFF0000000000
0000001FFFE000000000565479D265>I<FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFF800
00FFFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFE000FFFFFFFFFFFFFFFFF0000007FFF000
001FFFFC000007FFF0000001FFFF000007FFF00000007FFF800007FFF00000003FFFC000
07FFF00000000FFFE00007FFF00000000FFFF00007FFF000000007FFF00007FFF0000000
03FFF80007FFF000000003FFFC0007FFF000000003FFFC0007FFF000000001FFFE0007FF
F000000001FFFE0007FFF000000001FFFE0007FFF000000001FFFE0007FFF000000001FF
FF0007FFF000000001FFFF0007FFF000000001FFFF0007FFF000000001FFFF0007FFF000
000001FFFF0007FFF000000001FFFF0007FFF000000001FFFF0007FFF000000001FFFF00
07FFF000000001FFFE0007FFF000000001FFFE0007FFF000000001FFFE0007FFF0000000
01FFFC0007FFF000000003FFFC0007FFF000000003FFFC0007FFF000000003FFF80007FF
F000000007FFF00007FFF00000000FFFE00007FFF00000001FFFE00007FFF00000003FFF
C00007FFF00000007FFF000007FFF0000001FFFE000007FFF000001FFFFC000007FFFFFF
FFFFFFF0000007FFFFFFFFFFFFC0000007FFFFFFFFFFFE00000007FFFFFFFFFFE0000000
07FFF80000000000000007FFF80000000000000007FFF80000000000000007FFF8000000
0000000007FFF80000000000000007FFF80000000000000007FFF80000000000000007FF
F80000000000000007FFF80000000000000007FFF80000000000000007FFF80000000000
000007FFF80000000000000007FFF80000000000000007FFF80000000000000007FFF800
00000000000007FFF80000000000000007FFF80000000000000007FFF800000000000000
07FFF80000000000000007FFF80000000000000007FFF80000000000000007FFF8000000
0000000007FFF80000000000000007FFF80000000000000007FFF80000000000000007FF
F80000000000000007FFF80000000000000007FFF80000000000000007FFF80000000000
000007FFF80000000000000007FFF80000000000000007FFF8000000000000FFFFFFFFFF
C000000000FFFFFFFFFFC000000000FFFFFFFFFFC000000000FFFFFFFFFFC000000000FF
FFFFFFFFC00000000050527CD15C>I<000000000FFFC00000000000000003FFFFFF0000
00000000001FFFFFFFE0000000000000FFFFFFFFFC000000000003FFFC00FFFF00000000
000FFFC0000FFFC0000000003FFF000003FFF0000000007FFC000000FFF800000001FFF0
0000003FFE00000003FFE00000001FFF00000007FFC00000000FFF8000000FFF80000000
07FFC000001FFF0000000003FFE000003FFE0000000001FFF000007FFC0000000000FFF8
0000FFFC0000000000FFFC0000FFF800000000007FFC0001FFF800000000007FFE0003FF
F000000000003FFF0003FFF000000000003FFF0007FFE000000000001FFF8007FFE00000
0000001FFF800FFFE000000000001FFFC00FFFC000000000000FFFC01FFFC00000000000
0FFFE01FFFC000000000000FFFE01FFF80000000000007FFE03FFF80000000000007FFF0
3FFF80000000000007FFF03FFF80000000000007FFF07FFF80000000000007FFF87FFF80
000000000007FFF87FFF00000000000003FFF87FFF00000000000003FFF87FFF00000000
000003FFF8FFFF00000000000003FFFCFFFF00000000000003FFFCFFFF00000000000003
FFFCFFFF00000000000003FFFCFFFF00000000000003FFFCFFFF00000000000003FFFCFF
FF00000000000003FFFCFFFF00000000000003FFFCFFFF00000000000003FFFCFFFF0000
0000000003FFFCFFFF00000000000003FFFCFFFF00000000000003FFFCFFFF0000000000
0003FFFCFFFF00000000000003FFFCFFFF00000000000003FFFC7FFF00000000000003FF
F87FFF00000000000003FFF87FFF80000000000007FFF87FFF80000000000007FFF87FFF
80000000000007FFF83FFF80000000000007FFF03FFF80000000000007FFF03FFF800000
00000007FFF01FFFC000000000000FFFE01FFFC000000000000FFFE01FFFC00000000000
0FFFE00FFFC000000000000FFFC00FFFE000000000001FFFC007FFE000000000001FFF80
07FFF000000000003FFF8003FFF00001FE00003FFF0001FFF80007FF80007FFE0001FFF8
000FFFE0007FFE0000FFFC003FFFF000FFFC00007FFC007F03F800FFF800003FFE007C00
FC01FFF000001FFF00F8007E03FFE000000FFF80F8003F07FFC0000007FFC0F0001F8FFF
80000003FFE0F0001F9FFF00000001FFF0F0000FFFFE00000000FFFCF8000FFFFC000000
003FFFF80007FFF0000000000FFFFC000FFFC00000000003FFFF00FFFF000000000000FF
FFFFFFFC0000000000001FFFFFFFFC00000C00000003FFFFFFFC00001E000000001FFFE3
FE00001E00000000000001FF00001E00000000000001FF80003E00000000000001FFC000
7E00000000000001FFE000FE00000000000001FFF807FE00000000000000FFFFFFFE0000
0000000000FFFFFFFC00000000000000FFFFFFFC000000000000007FFFFFFC0000000000
00007FFFFFFC000000000000007FFFFFF8000000000000007FFFFFF8000000000000003F
FFFFF8000000000000003FFFFFF0000000000000001FFFFFE0000000000000001FFFFFE0
000000000000000FFFFFC00000000000000007FFFF800000000000000003FFFF00000000
0000000001FFFE0000000000000000007FF80000000000000000001FE000576A79D265>
I<FFFFFFFFFFFFF00000000000FFFFFFFFFFFFFF8000000000FFFFFFFFFFFFFFF8000000
00FFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFFC00000000007FFF00000FFFFF00000
000007FFF000000FFFF80000000007FFF0000001FFFE0000000007FFF0000000FFFF0000
000007FFF00000007FFF8000000007FFF00000003FFFC000000007FFF00000001FFFC000
000007FFF00000000FFFE000000007FFF00000000FFFF000000007FFF00000000FFFF000
000007FFF000000007FFF800000007FFF000000007FFF800000007FFF000000007FFF800
000007FFF000000007FFFC00000007FFF000000007FFFC00000007FFF000000007FFFC00
000007FFF000000007FFFC00000007FFF000000007FFFC00000007FFF000000007FFFC00
000007FFF000000007FFFC00000007FFF000000007FFFC00000007FFF000000007FFF800
000007FFF000000007FFF800000007FFF00000000FFFF800000007FFF00000000FFFF000
000007FFF00000000FFFE000000007FFF00000000FFFE000000007FFF00000001FFFC000
000007FFF00000003FFF8000000007FFF00000007FFF0000000007FFF0000000FFFE0000
000007FFF0000003FFFC0000000007FFF000000FFFF00000000007FFF00000FFFFC00000
000007FFFFFFFFFFFF000000000007FFFFFFFFFFF8000000000007FFFFFFFFFFE0000000
000007FFFFFFFFFFF8000000000007FFF00003FFFE000000000007FFF000007FFF800000
000007FFF000003FFFC00000000007FFF000001FFFE00000000007FFF000000FFFF00000
000007FFF0000007FFF80000000007FFF0000003FFFC0000000007FFF0000003FFFE0000
000007FFF0000001FFFE0000000007FFF0000001FFFE0000000007FFF0000001FFFF0000
000007FFF0000000FFFF0000000007FFF0000000FFFF0000000007FFF0000000FFFF0000
000007FFF0000000FFFF0000000007FFF0000000FFFF0000000007FFF0000000FFFF0000
000007FFF0000000FFFF0000000007FFF0000000FFFF8000000007FFF0000000FFFF8000
000007FFF0000000FFFF8000000007FFF0000000FFFF8000000007FFF0000000FFFF8000
000007FFF0000000FFFF8000000007FFF0000000FFFF8000000007FFF0000000FFFF8000
1C0007FFF0000000FFFFC0003E0007FFF0000000FFFFC0003E0007FFF0000000FFFFC000
3E0007FFF00000007FFFC0003E0007FFF00000007FFFE0007E0007FFF00000003FFFE000
7C0007FFF00000003FFFF000FC0007FFF00000001FFFF001FCFFFFFFFFFF80000FFFF803
F8FFFFFFFFFF800003FFFE07F0FFFFFFFFFF800001FFFFFFE0FFFFFFFFFF8000007FFFFF
C0FFFFFFFFFF8000000FFFFF000000000000000000007FFC005F537CD164>I<00000FFF
800007000000FFFFF8000F000007FFFFFF001F00001FFFFFFFC03F00003FFFFFFFF07F00
00FFFC00FFF8FF0001FFE0000FFDFF0003FF800001FFFF0007FE0000007FFF000FFC0000
003FFF000FF80000000FFF001FF800000007FF001FF000000003FF003FF000000003FF00
3FE000000001FF007FE000000000FF007FE000000000FF007FE0000000007F00FFE00000
00007F00FFE0000000003F00FFE0000000003F00FFF0000000003F00FFF0000000003F00
FFF8000000001F00FFF8000000001F00FFFC000000001F00FFFE000000001F00FFFF0000
00000000FFFFC000000000007FFFF000000000007FFFFF00000000007FFFFFF800000000
3FFFFFFF800000003FFFFFFFFC0000001FFFFFFFFFC000001FFFFFFFFFF000000FFFFFFF
FFFC000007FFFFFFFFFF000003FFFFFFFFFFC00001FFFFFFFFFFE00000FFFFFFFFFFF000
007FFFFFFFFFF800003FFFFFFFFFFC00000FFFFFFFFFFE000003FFFFFFFFFE000000FFFF
FFFFFF0000001FFFFFFFFF80000000FFFFFFFF800000000FFFFFFFC0000000007FFFFFC0
0000000007FFFFE00000000000FFFFE000000000003FFFE000000000000FFFF000000000
0007FFF0000000000003FFF0000000000003FFF0780000000001FFF0F80000000000FFF0
F80000000000FFF0F80000000000FFF0F800000000007FF0F800000000007FF0FC000000
00007FF0FC00000000007FF0FC00000000007FE0FE00000000007FE0FE00000000007FE0
FF0000000000FFC0FF0000000000FFC0FF8000000000FFC0FFC000000001FF80FFE00000
0001FF00FFF000000003FF00FFFC00000007FE00FFFF0000000FFC00FFFFC000001FF800
FFFFF800007FF000FF1FFFC003FFE000FE0FFFFFFFFFC000FC03FFFFFFFF0000F8007FFF
FFFC0000F0000FFFFFF00000E000007FFF0000003C5479D24B>I<3FFFFFFFFFFFFFFFFF
FF803FFFFFFFFFFFFFFFFFFF803FFFFFFFFFFFFFFFFFFF803FFFFFFFFFFFFFFFFFFF803F
FFFFFFFFFFFFFFFFFF803FFFC0003FFFC0007FFF803FFE00003FFFC00007FF807FF80000
3FFFC00001FFC07FE000003FFFC00000FFC07FC000003FFFC000007FC07F8000003FFFC0
00003FC07F0000003FFFC000001FC07F0000003FFFC000001FC07E0000003FFFC000000F
C07E0000003FFFC000000FC07E0000003FFFC000000FC07C0000003FFFC0000007C07C00
00003FFFC0000007C07C0000003FFFC0000007C07C0000003FFFC0000007C07C0000003F
FFC0000007C0FC0000003FFFC0000007E0F80000003FFFC0000003E0F80000003FFFC000
0003E0F80000003FFFC0000003E0F80000003FFFC0000003E0F80000003FFFC0000003E0
F80000003FFFC0000003E0000000003FFFC000000000000000003FFFC000000000000000
003FFFC000000000000000003FFFC000000000000000003FFFC000000000000000003FFF
C000000000000000003FFFC000000000000000003FFFC000000000000000003FFFC00000
0000000000003FFFC000000000000000003FFFC000000000000000003FFFC00000000000
0000003FFFC000000000000000003FFFC000000000000000003FFFC00000000000000000
3FFFC000000000000000003FFFC000000000000000003FFFC000000000000000003FFFC0
00000000000000003FFFC000000000000000003FFFC000000000000000003FFFC0000000
00000000003FFFC000000000000000003FFFC000000000000000003FFFC0000000000000
00003FFFC000000000000000003FFFC000000000000000003FFFC000000000000000003F
FFC000000000000000003FFFC000000000000000003FFFC000000000000000003FFFC000
000000000000003FFFC000000000000000003FFFC000000000000000003FFFC000000000
000000003FFFC000000000000000003FFFC000000000000000003FFFC000000000000000
003FFFC000000000000000003FFFC000000000000000003FFFC000000000000000003FFF
C000000000000000003FFFC000000000000000003FFFC000000000000000003FFFC00000
0000000000003FFFC000000000000000003FFFC000000000000000003FFFC00000000000
00FFFFFFFFFFFFF000000000FFFFFFFFFFFFF000000000FFFFFFFFFFFFF000000000FFFF
FFFFFFFFF000000000FFFFFFFFFFFFF0000053517BD05E>I<00007FFF000000000007FF
FFF0000000003FFFFFFE00000000FFFFFFFF80000001FFE00FFFC0000003FE0001FFF000
0007FF0000FFF8000007FF80003FFC00000FFF80003FFE00000FFFC0001FFE00000FFFC0
001FFF00000FFFC0000FFF80000FFFC0000FFF80000FFFC0000FFF800007FF800007FFC0
0007FF800007FFC00003FF000007FFC00001FE000007FFC0000000000007FFC000000000
0007FFC0000000000007FFC0000000000007FFC0000000000007FFC0000000000007FFC0
000000007FFFFFC00000000FFFFFFFC0000000FFFFFFFFC0000007FFFF87FFC000003FFF
F007FFC000007FFF8007FFC00001FFFC0007FFC00003FFF00007FFC00007FFE00007FFC0
000FFFC00007FFC0001FFF800007FFC0003FFF000007FFC0007FFF000007FFC0007FFE00
0007FFC0007FFE000007FFC000FFFC000007FFC000FFFC000007FFC000FFFC000007FFC0
00FFFC000007FFC000FFFC00000FFFC000FFFC00000FFFC000FFFE00001FFFC0007FFE00
001DFFC0007FFE00003DFFC0003FFF000079FFE0001FFF8000F1FFF8000FFFC003E1FFFF
E007FFF81FC0FFFFF003FFFFFF807FFFF000FFFFFF001FFFF0001FFFFC0007FFE00001FF
E0000000003C387CB641>97 D<003FF0000000000000FFFFF0000000000000FFFFF00000
00000000FFFFF0000000000000FFFFF0000000000000FFFFF000000000000003FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF001FFE000000000FFF00FFF
FE00000000FFF03FFFFFC0000000FFF0FFFFFFF0000000FFF3FF01FFF8000000FFF7F800
3FFE000000FFFFE0000FFF000000FFFF800007FF800000FFFF000003FFC00000FFFE0000
01FFE00000FFFC000001FFF00000FFF8000000FFF80000FFF8000000FFF80000FFF80000
007FFC0000FFF80000007FFC0000FFF80000007FFE0000FFF80000007FFE0000FFF80000
007FFF0000FFF80000003FFF0000FFF80000003FFF0000FFF80000003FFF0000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF0000FFF80000003FFF0000FFF80000003FFF0000FFF80000003FFF0000FFF80000
007FFE0000FFF80000007FFE0000FFF80000007FFE0000FFF80000007FFC0000FFF80000
00FFFC0000FFF8000000FFF80000FFFC000001FFF00000FFFC000001FFF00000FFFE0000
03FFE00000FFFF000007FFC00000FFFF80000FFF800000FFCFC0001FFF000000FF87F000
7FFC000000FF03FE03FFF8000000FE00FFFFFFE0000000FC007FFFFF80000000F8001FFF
FC00000000000003FFC000000041547BD24B>I<000001FFF8000000001FFFFF80000000
FFFFFFF0000003FFFFFFFC00000FFFC00FFE00001FFE0001FF00007FFC0003FF8000FFF0
0007FF8001FFF00007FFC003FFE0000FFFC003FFC0000FFFC007FFC0000FFFC00FFF8000
0FFFC00FFF80000FFFC01FFF800007FF801FFF000007FF803FFF000003FF003FFF000001
FE007FFF00000000007FFE00000000007FFE00000000007FFE0000000000FFFE00000000
00FFFE0000000000FFFE0000000000FFFE0000000000FFFE0000000000FFFE0000000000
FFFE0000000000FFFE0000000000FFFE0000000000FFFE0000000000FFFE0000000000FF
FE0000000000FFFE00000000007FFE00000000007FFF00000000007FFF00000000003FFF
00000000003FFF00000000003FFF00000003E01FFF80000003E01FFF80000007E00FFFC0
000007C007FFC0000007C007FFE000000FC003FFE000001F8001FFF000003F0000FFF800
007E00007FFE0000FC00003FFF0003F800000FFFE01FF0000003FFFFFFE0000000FFFFFF
800000003FFFFE0000000001FFE0000033387CB63C>I<000000000001FF800000000000
07FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF800000000000
07FFFF800000000000001FFF8000000000000007FF8000000000000007FF800000000000
0007FF8000000000000007FF8000000000000007FF8000000000000007FF800000000000
0007FF8000000000000007FF8000000000000007FF8000000000000007FF800000000000
0007FF8000000000000007FF8000000000000007FF8000000000000007FF800000000000
0007FF8000000000000007FF8000000000000007FF8000000000000007FF800000000000
0007FF8000000000000007FF8000000000000007FF8000000000000007FF8000000001FF
E007FF800000001FFFFC07FF80000000FFFFFF07FF80000003FFFFFFC7FF8000000FFFE0
3FE7FF8000001FFF0007F7FF8000007FFC0001FFFF800000FFF80000FFFF800001FFF000
003FFF800003FFE000001FFF800007FFC000001FFF800007FFC000000FFF80000FFF8000
000FFF80001FFF8000000FFF80001FFF0000000FFF80003FFF0000000FFF80003FFF0000
000FFF80003FFF0000000FFF80007FFE0000000FFF80007FFE0000000FFF80007FFE0000
000FFF80007FFE0000000FFF8000FFFE0000000FFF8000FFFE0000000FFF8000FFFE0000
000FFF8000FFFE0000000FFF8000FFFE0000000FFF8000FFFE0000000FFF8000FFFE0000
000FFF8000FFFE0000000FFF8000FFFE0000000FFF8000FFFE0000000FFF8000FFFE0000
000FFF8000FFFE0000000FFF80007FFE0000000FFF80007FFE0000000FFF80007FFE0000
000FFF80003FFF0000000FFF80003FFF0000000FFF80003FFF0000000FFF80001FFF0000
000FFF80001FFF0000000FFF80000FFF8000000FFF80000FFF8000001FFF800007FFC000
003FFF800003FFC000003FFF800001FFE000007FFF800000FFF00001FFFF8000007FF800
03FFFFE000003FFE000FEFFFFF80000FFFC07FCFFFFF800007FFFFFF8FFFFF800001FFFF
FE0FFFFF8000003FFFF80FFFFF80000003FFC00FFE000041547CD24B>I<000003FFC000
0000003FFFFC00000001FFFFFF00000007FFFFFFC000000FFF81FFE000003FFC007FF800
007FF8003FFC0000FFF0001FFE0001FFE0000FFE0003FFC00007FF0007FFC00007FF800F
FF800003FF800FFF800003FFC01FFF800001FFC01FFF000001FFC03FFF000001FFE03FFF
000001FFE07FFF000000FFE07FFE000000FFE07FFE000000FFF07FFE000000FFF0FFFE00
0000FFF0FFFE000000FFF0FFFE000000FFF0FFFE000000FFF0FFFFFFFFFFFFF0FFFFFFFF
FFFFF0FFFFFFFFFFFFF0FFFFFFFFFFFFE0FFFE0000000000FFFE0000000000FFFE000000
0000FFFE0000000000FFFE0000000000FFFE00000000007FFE00000000007FFE00000000
007FFF00000000003FFF00000000003FFF00000000003FFF00000000E01FFF00000001F0
1FFF80000003F00FFF80000003F007FFC0000007E007FFC0000007E003FFE000000FC001
FFF000001FC000FFF800003F80007FFC0000FF00001FFE0003FE00000FFFC03FF8000003
FFFFFFF0000000FFFFFFC00000001FFFFE0000000001FFF0000034387CB63D>I<000000
3FFC00000003FFFF0000000FFFFFC000003FFFFFE00000FFF81FF00001FFC03FF80003FF
807FF80007FF00FFFC000FFE00FFFC001FFC00FFFC001FFC00FFFC003FF800FFFC003FF8
00FFFC003FF8007FF8007FF0007FF8007FF0003FF0007FF0000FC0007FF0000000007FF0
000000007FF0000000007FF0000000007FF0000000007FF0000000007FF0000000007FF0
000000007FF0000000007FF0000000007FF0000000007FF0000000007FF0000000007FF0
000000FFFFFFFFE000FFFFFFFFE000FFFFFFFFE000FFFFFFFFE000FFFFFFFFE000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8000000007FF8
0000007FFFFFFE00007FFFFFFE00007FFFFFFE00007FFFFFFE00007FFFFFFE00002E547C
D329>I<00003FFF0000FF000003FFFFF007FFC0000FFFFFFC1FFFE0003FFFFFFF7FFFE0
007FFC0FFFFF9FF000FFE001FFF83FF001FFC000FFE03FF003FF80007FF01FF007FF0000
3FF81FE00FFF00003FFC0FC00FFF00003FFC07801FFE00001FFE00001FFE00001FFE0000
3FFE00001FFF00003FFE00001FFF00003FFE00001FFF00003FFE00001FFF00003FFE0000
1FFF00003FFE00001FFF00003FFE00001FFF00003FFE00001FFF00003FFE00001FFF0000
1FFE00001FFE00001FFE00001FFE00000FFF00003FFC00000FFF00003FFC000007FF0000
3FF8000003FF80007FF0000001FFC000FFE0000000FFE001FFC0000000FFFC0FFF800000
01FFFFFFFF00000003EFFFFFFC00000003C3FFFFF000000007C03FFF0000000007C00000
0000000007C00000000000000FC00000000000000FC00000000000000FC0000000000000
0FE00000000000000FE00000000000000FF80000000000000FFE0000000000000FFFFFFF
FF00000007FFFFFFFFF8000007FFFFFFFFFF000007FFFFFFFFFFC00003FFFFFFFFFFE000
01FFFFFFFFFFF00000FFFFFFFFFFF800007FFFFFFFFFFC00007FFFFFFFFFFE0001FFFFFF
FFFFFF0007FFFFFFFFFFFF000FFE000003FFFF801FF80000003FFF803FF000000007FF80
7FE000000003FFC07FE000000001FFC0FFC000000001FFC0FFC000000000FFC0FFC00000
0000FFC0FFC000000000FFC0FFC000000000FFC0FFC000000000FFC0FFE000000001FFC0
7FE000000001FF807FF000000003FF803FF000000003FF001FF800000007FE000FFE0000
001FFC0007FF8000007FF80003FFE00001FFF00001FFFE001FFFE000007FFFFFFFFF8000
000FFFFFFFFC00000001FFFFFFE0000000000FFFFC0000003C4F7CB543>I<003FF00000
00000000FFFFF0000000000000FFFFF0000000000000FFFFF0000000000000FFFFF00000
00000000FFFFF000000000000003FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF000000000000000FFF000000000000000FFF000000000000000FFF00000
0000000000FFF0001FFC00000000FFF000FFFFC0000000FFF003FFFFF0000000FFF00FFF
FFF8000000FFF01FE07FFC000000FFF03F001FFE000000FFF07C001FFF000000FFF0F000
0FFF000000FFF1E0000FFF800000FFF3C0000FFF800000FFF7800007FF800000FFF78000
07FFC00000FFFF000007FFC00000FFFE000007FFC00000FFFE000007FFC00000FFFC0000
07FFC00000FFFC000007FFC00000FFFC000007FFC00000FFFC000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC000FFFFFFF807FFFFFFC0FFFFFFF807FFFFFFC0FFFFFFF807
FFFFFFC0FFFFFFF807FFFFFFC0FFFFFFF807FFFFFFC042537BD24B>I<007F000000FF80
0003FFE00007FFF00007FFF0000FFFF8000FFFF8000FFFF8000FFFF8000FFFF8000FFFF8
000FFFF80007FFF00007FFF00003FFE00000FF8000007F00000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000003FF000FFFFF000FFFFF000FFFFF000FFFFF000FFFFF00001FFF00000FFF0
0000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF0
0000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF0
0000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF0
0000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF0
0000FFF00000FFF00000FFF00000FFF00000FFF000FFFFFFE0FFFFFFE0FFFFFFE0FFFFFF
E0FFFFFFE01B547BD325>I<0000007F00000000FF80000003FFE0000007FFF0000007FF
F000000FFFF800000FFFF800000FFFF800000FFFF800000FFFF800000FFFF800000FFFF8
000007FFF0000007FFF0000003FFE0000000FF800000007F000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000001FF80000FFFFF80000FFFFF80000FF
FFF80000FFFFF80000FFFFF8000001FFF80000007FF80000007FF80000007FF80000007F
F80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF8
0000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF800
00007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000
007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF8000000
7FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007F
F80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80000007FF8
0000007FF80000007FF80000007FF80000007FF80000007FF80000007FF80780007FF81F
E0007FF83FF0007FF87FF8007FF8FFFC00FFF8FFFC00FFF0FFFC00FFF0FFFC00FFE0FFFC
01FFE0FFFC01FFC0FFFC03FF807FF807FF007FF00FFE003FF01FFC000FFFFFF00007FFFF
E00001FFFF8000001FFC0000256C87D329>I<003FF00000000000FFFFF00000000000FF
FFF00000000000FFFFF00000000000FFFFF00000000000FFFFF0000000000003FFF00000
00000000FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000
FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF00000
00000000FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000
FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF00000
00000000FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000
FFF0000000000000FFF00001FFFFF800FFF00001FFFFF800FFF00001FFFFF800FFF00001
FFFFF800FFF00001FFFFF800FFF000003FFE0000FFF000001FF00000FFF000003FC00000
FFF000007F800000FFF00000FF000000FFF00003FE000000FFF00007F8000000FFF0000F
F0000000FFF0001FE0000000FFF0007FC0000000FFF000FF00000000FFF001FE00000000
FFF003FC00000000FFF00FF800000000FFF01FE000000000FFF03FF000000000FFF07FF8
00000000FFF1FFF800000000FFF3FFFC00000000FFF7FFFE00000000FFFFFFFF00000000
FFFFFFFF80000000FFFF9FFF80000000FFFF0FFFC0000000FFFE0FFFE0000000FFF807FF
F0000000FFF003FFF0000000FFF001FFF8000000FFF000FFFC000000FFF000FFFE000000
FFF0007FFF000000FFF0003FFF000000FFF0001FFF800000FFF0001FFFC00000FFF0000F
FFE00000FFF00007FFF00000FFF00003FFF00000FFF00001FFF80000FFF00001FFFC0000
FFF00000FFFE0000FFF000007FFE0000FFF000003FFF0000FFF000007FFFC0FFFFFFF003
FFFFFFFFFFFFF003FFFFFFFFFFFFF003FFFFFFFFFFFFF003FFFFFFFFFFFFF003FFFFFF40
537CD247>I<003FF000FFFFF000FFFFF000FFFFF000FFFFF000FFFFF00001FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FF
F00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF00000FFF000FFFFFFF0FFFF
FFF0FFFFFFF0FFFFFFF0FFFFFFF01C537BD225>I<003FF0001FFC000000FFE00000FFFF
F000FFFFC00007FFFE0000FFFFF003FFFFF0001FFFFF8000FFFFF00FFFFFF8007FFFFFC0
00FFFFF01FE07FFC00FF03FFE000FFFFF03F001FFE01F800FFF00003FFF07C001FFF03E0
00FFF80000FFF0F0000FFF0780007FF80000FFF1E0000FFF8F00007FFC0000FFF3C0000F
FF9E00007FFC0000FFF7800007FFBC00003FFC0000FFF7800007FFFC00003FFE0000FFFF
000007FFF800003FFE0000FFFE000007FFF000003FFE0000FFFE000007FFF000003FFE00
00FFFC000007FFE000003FFE0000FFFC000007FFE000003FFE0000FFFC000007FFE00000
3FFE0000FFFC000007FFE000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FF
C000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF800
0007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000
FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003F
FE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC0
00003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF80000
07FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FF
F8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE
0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000
003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007
FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8000007FFC000003FFE0000FFF8
000007FFC000003FFE00FFFFFFF807FFFFFFC03FFFFFFEFFFFFFF807FFFFFFC03FFFFFFE
FFFFFFF807FFFFFFC03FFFFFFEFFFFFFF807FFFFFFC03FFFFFFEFFFFFFF807FFFFFFC03F
FFFFFE67367BB570>I<003FF0001FFC000000FFFFF000FFFFC00000FFFFF003FFFFF000
00FFFFF00FFFFFF80000FFFFF01FE07FFC0000FFFFF03F001FFE000003FFF07C001FFF00
0000FFF0F0000FFF000000FFF1E0000FFF800000FFF3C0000FFF800000FFF7800007FF80
0000FFF7800007FFC00000FFFF000007FFC00000FFFE000007FFC00000FFFE000007FFC0
0000FFFC000007FFC00000FFFC000007FFC00000FFFC000007FFC00000FFFC000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC0
0000FFF8000007FFC00000FFF8000007FFC000FFFFFFF807FFFFFFC0FFFFFFF807FFFFFF
C0FFFFFFF807FFFFFFC0FFFFFFF807FFFFFFC0FFFFFFF807FFFFFFC042367BB54B>I<00
0001FFE000000000001FFFFE0000000000FFFFFFC000000003FFFFFFF00000000FFF807F
FC0000001FFC000FFE0000007FF80007FF800000FFF00003FFC00001FFE00001FFE00003
FFC00000FFF00003FF8000007FF00007FF8000007FF8000FFF0000003FFC000FFF000000
3FFC001FFF0000003FFE001FFF0000003FFE003FFE0000001FFF003FFE0000001FFF003F
FE0000001FFF007FFE0000001FFF807FFE0000001FFF807FFE0000001FFF807FFE000000
1FFF80FFFE0000001FFFC0FFFE0000001FFFC0FFFE0000001FFFC0FFFE0000001FFFC0FF
FE0000001FFFC0FFFE0000001FFFC0FFFE0000001FFFC0FFFE0000001FFFC0FFFE000000
1FFFC0FFFE0000001FFFC0FFFE0000001FFFC0FFFE0000001FFFC07FFE0000001FFF807F
FE0000001FFF807FFE0000001FFF803FFE0000001FFF003FFF0000003FFF003FFF000000
3FFF001FFF0000003FFE001FFF0000003FFE000FFF0000003FFC000FFF8000007FFC0007
FF8000007FF80003FFC00000FFF00001FFE00001FFE00000FFF00003FFC000007FF80007
FF8000003FFE001FFF0000000FFF807FFC00000007FFFFFFF800000000FFFFFFC0000000
003FFFFF000000000001FFE00000003A387CB643>I<003FF001FFE0000000FFFFF00FFF
FE000000FFFFF03FFFFFC00000FFFFF0FFFFFFF00000FFFFF3FF01FFF80000FFFFF7F800
7FFE000003FFFFE0001FFF000000FFFF80000FFF800000FFFF000007FFC00000FFFE0000
07FFE00000FFFC000003FFF00000FFF8000001FFF80000FFF8000001FFF80000FFF80000
00FFFC0000FFF8000000FFFC0000FFF8000000FFFE0000FFF80000007FFE0000FFF80000
007FFF0000FFF80000007FFF0000FFF80000007FFF0000FFF80000007FFF0000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000003FFF8000FFF80000
003FFF0000FFF80000007FFF0000FFF80000007FFF0000FFF80000007FFF0000FFF80000
007FFE0000FFF8000000FFFE0000FFF8000000FFFE0000FFF8000000FFFC0000FFF80000
01FFFC0000FFF8000001FFF80000FFFC000003FFF00000FFFC000003FFF00000FFFE0000
07FFE00000FFFF00000FFFC00000FFFF80001FFF800000FFFFC0003FFF000000FFFFF000
FFFC000000FFFBFE07FFF8000000FFF8FFFFFFE0000000FFF87FFFFF80000000FFF81FFF
FC00000000FFF803FFC000000000FFF800000000000000FFF800000000000000FFF80000
0000000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000
0000000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000
0000000000FFF800000000000000FFF800000000000000FFF800000000000000FFF80000
0000000000FFF800000000000000FFF8000000000000FFFFFFF80000000000FFFFFFF800
00000000FFFFFFF80000000000FFFFFFF80000000000FFFFFFF80000000000414D7BB54B
>I<007FE003FE00FFFFE00FFF80FFFFE03FFFE0FFFFE07FFFF0FFFFE0FE1FF8FFFFE1F8
3FFC03FFE3E03FFE00FFE3C07FFE00FFE7807FFE00FFEF807FFE00FFEF007FFE00FFEE00
7FFE00FFFE003FFC00FFFC003FFC00FFFC001FF800FFFC000FF000FFF800000000FFF800
000000FFF800000000FFF800000000FFF800000000FFF000000000FFF000000000FFF000
000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000
000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000
000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000
000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000000000FFF000
000000FFF0000000FFFFFFFC0000FFFFFFFC0000FFFFFFFC0000FFFFFFFC0000FFFFFFFC
00002F367CB537>114 D<0003FFF00F00003FFFFE1F0000FFFFFFFF0003FFFFFFFF0007
FF003FFF000FF80007FF001FE00001FF003FC00000FF003F8000007F007F8000007F007F
0000003F007F0000003F00FF0000001F00FF0000001F00FF8000001F00FF8000001F00FF
C000001F00FFF000000000FFFC00000000FFFFC00000007FFFFF0000007FFFFFF800003F
FFFFFF00003FFFFFFFC0001FFFFFFFF0000FFFFFFFF80007FFFFFFFC0003FFFFFFFE0000
FFFFFFFF00003FFFFFFF80000FFFFFFFC00000FFFFFFC0000007FFFFE00000003FFFE000
000007FFF000000001FFF0780000007FF0F80000003FF0F80000001FF0FC0000001FF0FC
0000000FF0FC0000000FF0FE0000000FF0FE0000000FE0FF0000000FE0FF8000001FE0FF
8000001FC0FFC000001FC0FFE000003F80FFF800007F00FFFE0001FE00FFFFC00FFC00FF
7FFFFFF800FC1FFFFFE000F807FFFF8000F000FFF800002C387CB635>I<00003E000000
00003E00000000003E00000000003E00000000003E00000000003E00000000007E000000
00007E00000000007E00000000007E0000000000FE0000000000FE0000000001FE000000
0001FE0000000001FE0000000003FE0000000007FE0000000007FE000000000FFE000000
001FFE000000003FFE00000000FFFE00000001FFFE0000000FFFFFFFFF00FFFFFFFFFF00
FFFFFFFFFF00FFFFFFFFFF00FFFFFFFFFF00003FFE000000003FFE000000003FFE000000
003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000
003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000
003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000
003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000003FFE000000
003FFE0007C0003FFE0007C0003FFE0007C0003FFE0007C0003FFE0007C0003FFE0007C0
003FFE0007C0003FFE0007C0003FFE0007C0003FFE0007C0003FFE0007C0001FFE000F80
001FFF000F80001FFF000F80000FFF001F00000FFF801F000007FFC03E000003FFF0FC00
0001FFFFF80000007FFFF00000001FFFE000000003FF80002A4D7ECB34>I<003FF80000
01FFC000FFFFF80007FFFFC000FFFFF80007FFFFC000FFFFF80007FFFFC000FFFFF80007
FFFFC000FFFFF80007FFFFC00003FFF800001FFFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF80000
07FFC00000FFF8000007FFC00000FFF8000007FFC00000FFF800000FFFC00000FFF80000
0FFFC00000FFF800000FFFC00000FFF800001FFFC00000FFF800001FFFC000007FF80000
3FFFC000007FF800003BFFC000007FF800007BFFC000003FFC0000F3FFC000003FFC0001
E3FFF000001FFE0007C3FFFFC0000FFFC03F83FFFFC00007FFFFFF03FFFFC00001FFFFFE
03FFFFC000007FFFF803FFFFC0000007FFE003FF000042377BB54B>I<FFFFFFF00007FF
FFFFFFFFF00007FFFFFFFFFFF00007FFFFFFFFFFF00007FFFFFFFFFFF00007FFFF01FFF8
0000007FE000FFFC0000003F0000FFFC0000003F00007FFC0000003E00007FFE0000007E
00003FFE0000007C00003FFF000000FC00001FFF000000F800001FFF800001F800000FFF
800001F000000FFFC00001F000000FFFC00003F0000007FFC00003E0000007FFE00007E0
000003FFE00007C0000003FFF0000FC0000001FFF0000F80000001FFF8001F80000000FF
F8001F00000000FFFC001F00000000FFFC003F000000007FFE003E000000007FFE007E00
0000003FFE007C000000003FFF00FC000000001FFF00F8000000001FFF81F8000000000F
FF81F0000000000FFFC3F0000000000FFFC3F00000000007FFE3E00000000007FFE7E000
00000003FFE7C00000000003FFFFC00000000001FFFF800000000001FFFF800000000000
FFFF000000000000FFFF0000000000007FFE0000000000007FFE0000000000007FFE0000
000000003FFC0000000000003FFC0000000000001FF80000000000001FF8000000000000
0FF00000000000000FF000000000000007E000000000000003C000000040367DB447>I<
FFFFFFE07FFFFFC003FFFFC0FFFFFFE07FFFFFC003FFFFC0FFFFFFE07FFFFFC003FFFFC0
FFFFFFE07FFFFFC003FFFFC0FFFFFFE07FFFFFC003FFFFC001FFF00000FFF000001FF800
01FFF800007FF0000007E00000FFF800007FF8000007C00000FFF800007FF8000007C000
00FFFC00003FF800000FC000007FFC00003FFC00000F8000007FFC00003FFC00000F8000
007FFE00003FFC00001F8000003FFE00007FFE00001F0000003FFF00007FFE00003F0000
001FFF00007FFF00003E0000001FFF0000FFFF00003E0000001FFF8000FFFF00007E0000
000FFF8001FFFF80007C0000000FFFC001F3FF8000FC00000007FFC001F3FFC000F80000
0007FFC003F3FFC000F800000007FFE003E1FFC001F800000003FFE007E1FFE001F00000
0003FFF007C0FFE001F000000001FFF007C0FFF003E000000001FFF00FC0FFF003E00000
0001FFF80F807FF007E000000000FFF80F807FF807C000000000FFF81F003FF807C00000
0000FFFC1F003FF80FC0000000007FFC3F003FFC0F80000000007FFE3E001FFC1F800000
00003FFE3E001FFE1F00000000003FFE7E001FFE1F00000000003FFF7C000FFE3F000000
00001FFFFC000FFF3E00000000001FFFF80007FF7E00000000000FFFF80007FFFC000000
00000FFFF80007FFFC00000000000FFFF00003FFFC000000000007FFF00003FFF8000000
000007FFE00001FFF8000000000003FFE00001FFF0000000000003FFE00001FFF0000000
000003FFC00000FFF0000000000001FFC00000FFE0000000000001FF8000007FE0000000
000001FF8000007FE0000000000000FF8000007FC0000000000000FF0000003FC0000000
0000007F0000003F800000000000007F0000003F800000000000003E0000001F00000000
5A367DB461>I<7FFFFFF0007FFFFE007FFFFFF0007FFFFE007FFFFFF0007FFFFE007FFF
FFF0007FFFFE007FFFFFF0007FFFFE00007FFE00000FFF0000003FFF000007F80000001F
FF800007F00000000FFFC0000FE000000007FFC0001FC000000007FFE0003F8000000003
FFF0003F0000000001FFF8007E0000000000FFFC00FC00000000007FFE01FC0000000000
7FFE03F800000000003FFF07F000000000001FFF8FE000000000000FFFCFC00000000000
07FFFF80000000000003FFFF00000000000003FFFF00000000000001FFFE000000000000
00FFFC000000000000007FFE000000000000003FFF000000000000003FFF000000000000
001FFF800000000000001FFFC00000000000003FFFE00000000000007FFFF00000000000
00FFFFF0000000000001FDFFF8000000000001F8FFFC000000000003F07FFE0000000000
07E03FFF00000000000FE01FFF00000000001FC01FFF80000000003F800FFFC000000000
7F0007FFE000000000FE0003FFF000000000FC0001FFF800000001F80001FFF800000003
F00000FFFC00000007F000007FFE0000000FE000003FFF0000001FC000001FFF800000FF
F000001FFF8000FFFFFE0001FFFFFFC0FFFFFE0001FFFFFFC0FFFFFE0001FFFFFFC0FFFF
FE0001FFFFFFC0FFFFFE0001FFFFFFC042357EB447>I<FFFFFFF00007FFFFFFFFFFF000
07FFFFFFFFFFF00007FFFFFFFFFFF00007FFFFFFFFFFF00007FFFF00FFF80000007FE000
FFFC0000003F0000FFFC0000003F00007FFE0000003E00007FFE0000007E00003FFE0000
007C00003FFF000000FC00001FFF000000F800001FFF800001F800000FFF800001F00000
0FFFC00003F0000007FFC00003E0000007FFE00003E0000007FFE00007E0000003FFF000
07C0000003FFF0000FC0000001FFF8000F80000001FFF8001F80000000FFF8001F000000
00FFFC003F000000007FFC003E000000007FFE007E000000003FFE007C000000003FFF00
FC000000003FFF00FC000000001FFF80F8000000001FFF81F8000000000FFFC1F0000000
000FFFC3F00000000007FFC3E00000000007FFE7E00000000003FFE7C00000000003FFFF
C00000000001FFFF800000000001FFFF800000000000FFFF000000000000FFFF00000000
0000FFFF0000000000007FFE0000000000007FFE0000000000003FFC0000000000003FFC
0000000000001FF80000000000001FF80000000000000FF00000000000000FF000000000
000007E000000000000007E000000000000007E000000000000007C00000000000000FC0
0000000000000F800000000000001F800000000000001F000000000000003F000000001F
C0003E000000003FE0007E000000007FF0007C00000000FFF800FC00000000FFF800F800
000000FFF801F800000000FFF801F000000000FFF803F000000000FFF807E0000000007F
F00FC0000000007FE01F80000000003FC07F00000000003F81FE00000000001FFFFC0000
0000000FFFF0000000000003FFE0000000000000FF000000000000404D7DB447>I<1FFF
FFFFFFFF001FFFFFFFFFFF801FFFFFFFFFFF801FFFFFFFFFFF801FFF80007FFF001FFC00
00FFFF001FF00001FFFE001FE00001FFFC001FC00003FFF8001F800007FFF8001F80000F
FFF0003F00000FFFE0003F00001FFFE0003F00003FFFC0003F00003FFF80003E00007FFF
00003E0000FFFF00003E0001FFFE00003E0001FFFC00003E0003FFF800003E0007FFF800
0000000FFFF0000000000FFFE0000000001FFFC0000000003FFFC0000000007FFF800000
00007FFF0000000000FFFF0000000001FFFE0000000001FFFC0000000003FFF8000F8000
07FFF8000F80000FFFF0000F80000FFFE0000F80001FFFC0000F80003FFFC0001F80007F
FF80001F00007FFF00001F0000FFFE00001F0001FFFE00003F0003FFFC00003F0003FFF8
00003F0007FFF800007F000FFFF000007F000FFFE00000FF001FFFC00001FF003FFFC000
07FF007FFF80000FFE007FFF0000FFFE00FFFFFFFFFFFE00FFFFFFFFFFFE00FFFFFFFFFF
FE007FFFFFFFFFFE0031357CB43C>I E /Fs 20 121 df<0000000001F0000000000000
0007F8000000000000000FF8000000000000003FF8000000000000007FF8000000000000
01FFF80000000000000FFFF80000000000003FFFF8000000000001FFFFF800000000003F
FFFFF8000000000FFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFF
FFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFE7FFFF8000000FFFFC0
7FFFF8000000FFF0007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF8000000000000
7FFFF80000000000007FFFF80000000000007FFFF80000000000007FFFF80000007FFFFF
FFFFFFFFFFF07FFFFFFFFFFFFFFFF07FFFFFFFFFFFFFFFF07FFFFFFFFFFFFFFFF07FFFFF
FFFFFFFFFFF07FFFFFFFFFFFFFFFF07FFFFFFFFFFFFFFFF07FFFFFFFFFFFFFFFF0447171
F061>49 D<0000000FFFE000000000000001FFFFFF8000000000000FFFFFFFF000000000
007FFFFFFFFE0000000001FFFFFFFFFF8000000003FFFFFFFFFFE00000000FFFFFFFFFFF
F80000003FFFFFFFFFFFFC0000007FFFC01FFFFFFF000000FFFC0001FFFFFF800001FFE0
00007FFFFFC00003FF8000001FFFFFE00007FF0000000FFFFFF0000FFE00000007FFFFF8
001FFC00000003FFFFFC001FFF00000001FFFFFE003FFFC0000000FFFFFF003FFFF00000
007FFFFF007FFFF80000007FFFFF807FFFFC0000003FFFFF807FFFFE0000003FFFFFC0FF
FFFE0000001FFFFFC0FFFFFE0000001FFFFFE0FFFFFF0000000FFFFFE0FFFFFF0000000F
FFFFE0FFFFFF0000000FFFFFE0FFFFFF00000007FFFFF0FFFFFF00000007FFFFF0FFFFFF
00000007FFFFF0FFFFFF00000007FFFFF0FFFFFF00000007FFFFF07FFFFE00000007FFFF
F07FFFFE00000007FFFFF07FFFFE00000007FFFFF03FFFFC00000007FFFFF01FFFF80000
0007FFFFF00FFFF000000007FFFFF003FFC000000007FFFFF000FF0000000007FFFFF000
000000000007FFFFE00000000000000FFFFFE00000000000000FFFFFE00000000000000F
FFFFE00000000000001FFFFFC00000000000001FFFFFC00000000000001FFFFF80000000
0000003FFFFF800000000000003FFFFF000000000000007FFFFF000000000000007FFFFE
000000000000007FFFFC00000000000000FFFFF800000000000001FFFFF8000000000000
01FFFFF000000000000003FFFFE000000000000003FFFFC000000000000007FFFF800000
000000000FFFFF000000000000000FFFFE000000000000001FFFFC000000000000003FFF
F0000000000000007FFFE0000000000000007FFFC000000000000000FFFF800000000000
0001FFFE0000000000000003FFFC0000000000000007FFF8000000000000000FFFE00000
00000000001FFFC0000000000000001FFF80000000000000003FFF00000000000000007F
FC0000000000000000FFF80000000000000001FFF00000000000000003FFE00000000000
000007FF8000000FF00000000FFF0000000FF00000001FFE0000000FF00000003FFC0000
000FF00000007FF80000001FE0000000FFE00000001FE0000001FFC00000001FE0000003
FF800000001FE0000007FF000000001FE000000FFE000000003FE000001FFC000000003F
E000003FF0000000003FC000003FE0000000003FC000007FC0000000007FC00000FF8000
0000007FC00001FF0000000000FFC00003FC0000000007FFC00007FFFFFFFFFFFFFFC000
0FFFFFFFFFFFFFFFC0001FFFFFFFFFFFFFFF80003FFFFFFFFFFFFFFF80007FFFFFFFFFFF
FFFF8000FFFFFFFFFFFFFFFF8001FFFFFFFFFFFFFFFF8003FFFFFFFFFFFFFFFF8007FFFF
FFFFFFFFFFFF800FFFFFFFFFFFFFFFFF801FFFFFFFFFFFFFFFFF003FFFFFFFFFFFFFFFFF
007FFFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFFFF00FFFFFFFFFF
FFFFFFFF00FFFFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFFFE00FF
FFFFFFFFFFFFFFFE00FFFFFFFFFFFFFFFFFE004C7176F061>I<00000001FFFE00000000
0000003FFFFFF8000000000001FFFFFFFF00000000000FFFFFFFFFE0000000003FFFFFFF
FFF8000000007FFFFFFFFFFE00000001FFFFFFFFFFFF80000003FFFF003FFFFFC000000F
FFF00007FFFFF000001FFF800001FFFFF800003FFE000000FFFFFC00007FF80000007FFF
FE00007FE00000003FFFFE0000FFF00000003FFFFF0001FFFC0000001FFFFF8001FFFF00
00001FFFFF8003FFFF8000000FFFFFC003FFFFC000000FFFFFC003FFFFE000000FFFFFC0
07FFFFE000000FFFFFE007FFFFF000000FFFFFE007FFFFF000000FFFFFE007FFFFF00000
0FFFFFE007FFFFF000000FFFFFE007FFFFF000000FFFFFE007FFFFF000000FFFFFE007FF
FFF000000FFFFFE007FFFFF000000FFFFFE007FFFFF000000FFFFFE003FFFFE000000FFF
FFE003FFFFE000000FFFFFC001FFFFC000001FFFFFC000FFFF8000001FFFFFC0007FFF00
00001FFFFF80003FFE0000001FFFFF80000FF80000003FFFFF800000000000003FFFFF00
0000000000003FFFFE000000000000007FFFFE000000000000007FFFFC00000000000000
FFFFF800000000000001FFFFF000000000000001FFFFE000000000000003FFFFC0000000
00000007FFFF800000000000000FFFFF000000000000001FFFFC000000000000003FFFF8
00000000000001FFFFE00000000000007FFFFF8000000000007FFFFFFE000000000000FF
FFFFF8000000000000FFFFFFC0000000000000FFFFFFF8000000000000FFFFFFFF800000
0000007FFFFFFFF0000000000000003FFFFC0000000000000007FFFF0000000000000001
FFFFC000000000000000FFFFE0000000000000007FFFF8000000000000003FFFFC000000
000000001FFFFE000000000000001FFFFF000000000000000FFFFF800000000000000FFF
FFC000000000000007FFFFE000000000000007FFFFF000000000000007FFFFF000000000
000003FFFFF800000000000003FFFFFC00000000000003FFFFFC00000000000003FFFFFC
00000000000001FFFFFE00000000000001FFFFFE00000000000001FFFFFE000000000000
01FFFFFF00FF8000000001FFFFFF03FFE000000001FFFFFF07FFF000000001FFFFFF1FFF
FC00000001FFFFFF3FFFFE00000001FFFFFF3FFFFE00000001FFFFFF7FFFFF00000001FF
FFFF7FFFFF00000001FFFFFFFFFFFF80000001FFFFFFFFFFFF80000001FFFFFFFFFFFF80
000001FFFFFFFFFFFF80000001FFFFFEFFFFFF80000001FFFFFEFFFFFF80000001FFFFFE
FFFFFF80000003FFFFFEFFFFFF80000003FFFFFCFFFFFF80000003FFFFFCFFFFFF000000
03FFFFFC7FFFFF00000003FFFFF87FFFFE00000007FFFFF87FFFFC00000007FFFFF03FFF
F80000000FFFFFE03FFFF00000000FFFFFE01FFFC00000001FFFFFC00FFF000000001FFF
FF800FFF000000003FFFFF0007FF800000007FFFFE0003FFF0000000FFFFFC0001FFFC00
0001FFFFF800007FFFC00007FFFFF000003FFFFE003FFFFFC000000FFFFFFFFFFFFF8000
0007FFFFFFFFFFFE00000001FFFFFFFFFFF8000000003FFFFFFFFFE0000000000FFFFFFF
FF000000000000FFFFFFF000000000000007FFFE00000000507378F061>I<0000000000
00000FF00000000000000000001FF80000000000000000003FF80000000000000000003F
F80000000000000000007FF8000000000000000000FFF8000000000000000001FFF80000
00000000000001FFF8000000000000000003FFF8000000000000000007FFF80000000000
0000000FFFF800000000000000001FFFF800000000000000001FFFF80000000000000000
3FFFF800000000000000007FFFF80000000000000000FFFFF80000000000000000FFFFF8
0000000000000001FFFFF80000000000000003FFFFF80000000000000007FFFFF8000000
0000000007FFFFF8000000000000000FFFFFF8000000000000001FFFFFF8000000000000
003FFFFFF8000000000000007FFFFFF8000000000000007FBFFFF800000000000000FF3F
FFF800000000000001FF3FFFF800000000000003FE3FFFF800000000000003FC3FFFF800
000000000007F83FFFF80000000000000FF83FFFF80000000000001FF03FFFF800000000
00003FE03FFFF80000000000003FC03FFFF80000000000007FC03FFFF8000000000000FF
803FFFF8000000000001FF003FFFF8000000000001FE003FFFF8000000000003FC003FFF
F8000000000007FC003FFFF800000000000FF8003FFFF800000000001FF0003FFFF80000
0000001FE0003FFFF800000000003FE0003FFFF800000000007FC0003FFFF80000000000
FF80003FFFF80000000000FF00003FFFF80000000001FE00003FFFF80000000003FE0000
3FFFF80000000007FC00003FFFF80000000007F800003FFFF8000000000FF000003FFFF8
000000001FF000003FFFF8000000003FE000003FFFF8000000007FC000003FFFF8000000
007F8000003FFFF800000000FF0000003FFFF800000001FF0000003FFFF800000003FE00
00003FFFF800000003FC0000003FFFF800000007F80000003FFFF80000000FF80000003F
FFF80000001FF00000003FFFF80000003FE00000003FFFF80000003FC00000003FFFF800
00007FC00000003FFFF8000000FF800000003FFFF8000001FF000000003FFFF8000001FE
000000003FFFF8000003FC000000003FFFF8000007FC000000003FFFF800000FF8000000
003FFFF800001FF0000000003FFFF800001FE0000000003FFFF800003FE0000000003FFF
F800007FC0000000003FFFF80000FF80000000003FFFF80000FFFFFFFFFFFFFFFFFFFFFC
FFFFFFFFFFFFFFFFFFFFFCFFFFFFFFFFFFFFFFFFFFFCFFFFFFFFFFFFFFFFFFFFFCFFFFFF
FFFFFFFFFFFFFFFCFFFFFFFFFFFFFFFFFFFFFCFFFFFFFFFFFFFFFFFFFFFCFFFFFFFFFFFF
FFFFFFFFFC000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF8
0000000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF8000000
0000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF8000000000000
0000FFFFF80000000000000000FFFFF80000000000000000FFFFF80000000000000000FF
FFF80000000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF800
00000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF800000000
00000000FFFFF8000000000007FFFFFFFFFFFFFC00000007FFFFFFFFFFFFFC00000007FF
FFFFFFFFFFFC00000007FFFFFFFFFFFFFC00000007FFFFFFFFFFFFFC00000007FFFFFFFF
FFFFFC00000007FFFFFFFFFFFFFC00000007FFFFFFFFFFFFFC56727BF161>I<00700000
00000000700000FE000000000001F80000FF80000000000FF80000FFF8000000007FF800
00FFFF80000007FFF80000FFFFFE0001FFFFF80000FFFFFFFFFFFFFFF00000FFFFFFFFFF
FFFFE00000FFFFFFFFFFFFFFC00000FFFFFFFFFFFFFFC00000FFFFFFFFFFFFFF800000FF
FFFFFFFFFFFF000000FFFFFFFFFFFFFE000000FFFFFFFFFFFFFC000000FFFFFFFFFFFFF8
000000FFFFFFFFFFFFE0000000FFFFFFFFFFFFC0000000FFFFFFFFFFFF80000000FFFFFF
FFFFFE00000000FFFFFFFFFFF800000000FFFFFFFFFFF000000000FFFFFFFFFFC0000000
00FFFFFFFFFF0000000000FFFFFFFFF80000000000FFFFFFFFC00000000000FF07FFF800
0000000000FF000000000000000000FF000000000000000000FF000000000000000000FF
000000000000000000FF000000000000000000FF000000000000000000FF000000000000
000000FF000000000000000000FF000000000000000000FF000000000000000000FF0000
00000000000000FF000000000000000000FF000000000000000000FF0000000000000000
00FF000000000000000000FF000000000000000000FF0001FFFC0000000000FF001FFFFF
E000000000FF00FFFFFFFC00000000FF03FFFFFFFF00000000FF0FFFFFFFFFC0000000FF
1FFFFFFFFFF0000000FF7FFF003FFFF8000000FFFFF0000FFFFE000000FFFF800003FFFF
000000FFFE000001FFFF800000FFF8000000FFFFC00000FFF00000007FFFE00000FFE000
00003FFFF00000FFC00000003FFFF80000FF800000001FFFFC0000FF000000001FFFFE00
007E000000001FFFFE00007C000000000FFFFF000000000000000FFFFF00000000000000
0FFFFF800000000000000FFFFF800000000000000FFFFFC00000000000000FFFFFC00000
0000000007FFFFC000000000000007FFFFE000000000000007FFFFE000000000000007FF
FFE000000000000007FFFFE000000000000007FFFFE000000000000007FFFFF000000000
000007FFFFF000000000000007FFFFF000FE0000000007FFFFF003FF8000000007FFFFF0
0FFFC000000007FFFFF01FFFF000000007FFFFF03FFFF800000007FFFFF07FFFF8000000
07FFFFF07FFFFC00000007FFFFF0FFFFFC00000007FFFFF0FFFFFC00000007FFFFF0FFFF
FC00000007FFFFF0FFFFFC00000007FFFFF0FFFFFC00000007FFFFE0FFFFFC00000007FF
FFE0FFFFFC00000007FFFFE0FFFFFC00000007FFFFE0FFFFFC0000000FFFFFC0FFFFF800
00000FFFFFC07FFFF80000000FFFFFC07FFFF00000000FFFFF807FFFE00000000FFFFF80
7FFFC00000001FFFFF803FFF000000001FFFFF003FE0000000001FFFFE001FF000000000
3FFFFE001FF8000000003FFFFC000FFC000000007FFFF8000FFE000000007FFFF80007FE
00000000FFFFF00003FF80000001FFFFE00001FFC0000003FFFFC00001FFE0000007FFFF
8000007FF800001FFFFE0000003FFF00007FFFFC0000001FFFF007FFFFF80000000FFFFF
FFFFFFE000000003FFFFFFFFFF8000000001FFFFFFFFFE00000000007FFFFFFFF8000000
00001FFFFFFFC0000000000003FFFFFE000000000000003FFF80000000004C7376F061>
I<00000000001FFF8000000000000003FFFFF80000000000003FFFFFFE000000000001FF
FFFFFF800000000007FFFFFFFFC0000000001FFFFFFFFFF0000000007FFFFFFFFFF80000
0000FFFFFC01FFFC00000003FFFFC0001FFE00000007FFFE000007FF0000001FFFF80000
03FF0000003FFFF0000001FF8000007FFFC000000FFF800000FFFF8000003FFFC00001FF
FF0000007FFFC00003FFFE000000FFFFC00007FFFC000001FFFFE0000FFFF8000001FFFF
E0001FFFF8000003FFFFE0001FFFF0000003FFFFE0003FFFF0000003FFFFE0007FFFE000
0003FFFFE0007FFFE0000003FFFFE000FFFFC0000003FFFFE001FFFFC0000003FFFFE001
FFFF80000003FFFFE003FFFF80000001FFFFC003FFFF80000001FFFFC007FFFF00000000
FFFF8007FFFF000000007FFF0007FFFF000000003FFE000FFFFF000000000FF8000FFFFF
000000000000001FFFFE000000000000001FFFFE000000000000001FFFFE000000000000
001FFFFE000000000000003FFFFE000000000000003FFFFE000000000000003FFFFE0000
00000000003FFFFE000000000000007FFFFC0007FFE00000007FFFFC001FFFFE0000007F
FFFC007FFFFFC000007FFFFC01FFFFFFF800007FFFFC03FFFFFFFC00007FFFFC0FFFFFFF
FF0000FFFFFC1FF803FFFF8000FFFFFC3FC0007FFFE000FFFFFC3F80001FFFF000FFFFFC
7E00000FFFF800FFFFFCFC000007FFFC00FFFFFDFC000003FFFE00FFFFFDF8000001FFFF
00FFFFFFF0000001FFFF80FFFFFFE0000000FFFFC0FFFFFFE0000000FFFFE0FFFFFFC000
0000FFFFE0FFFFFFC00000007FFFF0FFFFFF800000007FFFF0FFFFFF800000007FFFF8FF
FFFF800000007FFFF8FFFFFF000000007FFFFCFFFFFF000000003FFFFCFFFFFF00000000
3FFFFCFFFFFE000000003FFFFEFFFFFE000000003FFFFEFFFFFE000000003FFFFEFFFFFE
000000003FFFFEFFFFFE000000003FFFFFFFFFFE000000003FFFFF7FFFFC000000003FFF
FF7FFFFC000000003FFFFF7FFFFC000000003FFFFF7FFFFC000000003FFFFF7FFFFC0000
00003FFFFF7FFFFC000000003FFFFF7FFFFC000000003FFFFF7FFFFC000000003FFFFF3F
FFFC000000003FFFFF3FFFFC000000003FFFFF3FFFFC000000003FFFFF3FFFFC00000000
3FFFFF3FFFFE000000003FFFFF1FFFFE000000003FFFFF1FFFFE000000003FFFFF1FFFFE
000000003FFFFE0FFFFE000000003FFFFE0FFFFE000000003FFFFE0FFFFE000000003FFF
FE07FFFE000000003FFFFE07FFFE000000003FFFFC07FFFF000000007FFFFC03FFFF0000
00007FFFF803FFFF000000007FFFF801FFFF000000007FFFF801FFFF800000007FFFF000
FFFF80000000FFFFE0007FFFC0000000FFFFE0007FFFC0000000FFFFC0003FFFE0000001
FFFF80001FFFE0000003FFFF00001FFFF0000003FFFF00000FFFF8000007FFFE000007FF
FC00000FFFFC000003FFFF00001FFFF0000000FFFF80007FFFE00000007FFFF007FFFFC0
0000003FFFFFFFFFFF000000000FFFFFFFFFFE0000000003FFFFFFFFF80000000001FFFF
FFFFE000000000003FFFFFFF80000000000007FFFFFC000000000000007FFF8000000050
7378F061>I<0000000000000003F800000000000000000000000000000007FC00000000
00000000000000000000000FFE0000000000000000000000000000000FFE000000000000
0000000000000000001FFF0000000000000000000000000000001FFF0000000000000000
000000000000001FFF0000000000000000000000000000003FFF80000000000000000000
00000000003FFF8000000000000000000000000000007FFFC00000000000000000000000
0000007FFFC000000000000000000000000000007FFFC000000000000000000000000000
00FFFFE00000000000000000000000000000FFFFE00000000000000000000000000001FF
FFF00000000000000000000000000001FFFFF00000000000000000000000000001FFFFF0
0000000000000000000000000003FFFFF80000000000000000000000000003FFFFF80000
000000000000000000000007FFFFFC0000000000000000000000000007FFFFFC00000000
00000000000000000007FFFFFC000000000000000000000000000FFFFFFE000000000000
000000000000000FFFFFFE000000000000000000000000001FFFFFFF0000000000000000
00000000001FFFFFFF000000000000000000000000001FFFFFFF00000000000000000000
0000003FFFFFFF800000000000000000000000003FFFFFFF800000000000000000000000
007FFFFFFFC00000000000000000000000007FFFFFFFC00000000000000000000000007F
BFFFFFC0000000000000000000000000FF9FFFFFE0000000000000000000000000FF1FFF
FFE0000000000000000000000001FF0FFFFFF0000000000000000000000001FF0FFFFFF0
000000000000000000000001FE0FFFFFF0000000000000000000000003FE07FFFFF80000
00000000000000000003FC07FFFFF8000000000000000000000007FC03FFFFFC00000000
0000000000000007FC03FFFFFC000000000000000000000007F803FFFFFC000000000000
00000000000FF801FFFFFE00000000000000000000000FF001FFFFFE0000000000000000
0000001FF000FFFFFF00000000000000000000001FF000FFFFFF00000000000000000000
001FE000FFFFFF00000000000000000000003FE0007FFFFF80000000000000000000003F
C0007FFFFF80000000000000000000007FC0003FFFFFC0000000000000000000007FC000
3FFFFFC0000000000000000000007F80003FFFFFC000000000000000000000FF80001FFF
FFE000000000000000000000FF00001FFFFFE000000000000000000001FF00000FFFFFF0
00000000000000000001FF00000FFFFFF000000000000000000001FE00000FFFFFF00000
0000000000000003FE000007FFFFF800000000000000000003FC000007FFFFF800000000
000000000007FC000003FFFFFC00000000000000000007FC000003FFFFFC000000000000
00000007F8000003FFFFFC0000000000000000000FF8000001FFFFFE0000000000000000
000FF0000001FFFFFE0000000000000000001FF0000000FFFFFF0000000000000000001F
F0000000FFFFFF0000000000000000001FE0000000FFFFFF0000000000000000003FE000
00007FFFFF8000000000000000003FC00000007FFFFF8000000000000000007FC0000000
3FFFFFC000000000000000007FC00000003FFFFFC000000000000000007F800000003FFF
FFC00000000000000000FF800000001FFFFFE00000000000000000FF000000001FFFFFE0
0000000000000001FF000000000FFFFFF00000000000000001FF000000000FFFFFF00000
000000000001FE000000000FFFFFF00000000000000003FE0000000007FFFFF800000000
00000003FC0000000007FFFFF80000000000000007FFFFFFFFFFFFFFFFFC000000000000
0007FFFFFFFFFFFFFFFFFC0000000000000007FFFFFFFFFFFFFFFFFC000000000000000F
FFFFFFFFFFFFFFFFFE000000000000000FFFFFFFFFFFFFFFFFFE000000000000001FFFFF
FFFFFFFFFFFFFF000000000000001FFFFFFFFFFFFFFFFFFF000000000000001FFFFFFFFF
FFFFFFFFFF000000000000003FE000000000007FFFFF800000000000003FC00000000000
7FFFFF800000000000007FC000000000003FFFFFC00000000000007FC000000000003FFF
FFC00000000000007F8000000000003FFFFFC0000000000000FF8000000000001FFFFFE0
000000000000FF8000000000001FFFFFE0000000000001FF0000000000000FFFFFF00000
00000001FF0000000000000FFFFFF0000000000001FE0000000000000FFFFFF000000000
0003FE00000000000007FFFFF8000000000003FE00000000000007FFFFF8000000000007
FC00000000000003FFFFFC000000000007FC00000000000003FFFFFC000000000007F800
000000000003FFFFFC00000000000FF800000000000001FFFFFE00000000000FF8000000
00000001FFFFFE00000000000FF000000000000000FFFFFE00000000001FF00000000000
0000FFFFFF00000000001FE000000000000000FFFFFF00000000003FE000000000000000
7FFFFF80000000003FE0000000000000007FFFFF80000000003FC0000000000000003FFF
FF80000000007FC0000000000000003FFFFFC0000000007F80000000000000003FFFFFC0
00000007FFFC000000000000001FFFFFE00000FFFFFFFFFF800000001FFFFFFFFFFFFFE0
FFFFFFFFFF800000001FFFFFFFFFFFFFE0FFFFFFFFFF800000001FFFFFFFFFFFFFE0FFFF
FFFFFF800000001FFFFFFFFFFFFFE0FFFFFFFFFF800000001FFFFFFFFFFFFFE0FFFFFFFF
FF800000001FFFFFFFFFFFFFE0FFFFFFFFFF800000001FFFFFFFFFFFFFE0FFFFFFFFFF80
0000001FFFFFFFFFFFFFE0837979F892>65 D<FFFFFFFFFFFFFFFFFFFF0000000000FFFF
FFFFFFFFFFFFFFFFFE00000000FFFFFFFFFFFFFFFFFFFFFFC0000000FFFFFFFFFFFFFFFF
FFFFFFF8000000FFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFC000
00FFFFFFFFFFFFFFFFFFFFFFFFF00000FFFFFFFFFFFFFFFFFFFFFFFFF8000000003FFFFE
000000000FFFFFFE000000003FFFFE0000000001FFFFFF000000003FFFFE00000000007F
FFFF800000003FFFFE00000000001FFFFFC00000003FFFFE00000000000FFFFFE0000000
3FFFFE000000000007FFFFF00000003FFFFE000000000003FFFFF80000003FFFFE000000
000001FFFFFC0000003FFFFE000000000001FFFFFC0000003FFFFE000000000000FFFFFE
0000003FFFFE000000000000FFFFFE0000003FFFFE0000000000007FFFFF0000003FFFFE
0000000000007FFFFF0000003FFFFE0000000000007FFFFF8000003FFFFE000000000000
3FFFFF8000003FFFFE0000000000003FFFFF8000003FFFFE0000000000003FFFFF800000
3FFFFE0000000000003FFFFFC000003FFFFE0000000000003FFFFFC000003FFFFE000000
0000001FFFFFC000003FFFFE0000000000001FFFFFC000003FFFFE0000000000001FFFFF
C000003FFFFE0000000000001FFFFFC000003FFFFE0000000000001FFFFFC000003FFFFE
0000000000003FFFFFC000003FFFFE0000000000003FFFFFC000003FFFFE000000000000
3FFFFF8000003FFFFE0000000000003FFFFF8000003FFFFE0000000000003FFFFF800000
3FFFFE0000000000003FFFFF8000003FFFFE0000000000007FFFFF0000003FFFFE000000
0000007FFFFF0000003FFFFE000000000000FFFFFE0000003FFFFE000000000000FFFFFE
0000003FFFFE000000000001FFFFFC0000003FFFFE000000000001FFFFF80000003FFFFE
000000000003FFFFF80000003FFFFE000000000007FFFFF00000003FFFFE00000000000F
FFFFE00000003FFFFE00000000001FFFFFC00000003FFFFE00000000003FFFFF80000000
3FFFFE00000000007FFFFE000000003FFFFE0000000001FFFFFC000000003FFFFE000000
0007FFFFF0000000003FFFFE000000003FFFFFC0000000003FFFFE00000007FFFFFF0000
0000003FFFFFFFFFFFFFFFFFF800000000003FFFFFFFFFFFFFFFFFC000000000003FFFFF
FFFFFFFFFFFF8000000000003FFFFFFFFFFFFFFFFFFC00000000003FFFFFFFFFFFFFFFFF
FF80000000003FFFFFFFFFFFFFFFFFFFF0000000003FFFFE0000000000FFFFFC00000000
3FFFFE00000000003FFFFF000000003FFFFE00000000000FFFFF800000003FFFFE000000
000003FFFFE00000003FFFFE000000000001FFFFF00000003FFFFE000000000000FFFFFC
0000003FFFFE0000000000007FFFFE0000003FFFFE0000000000003FFFFF0000003FFFFE
0000000000003FFFFF8000003FFFFE0000000000001FFFFF8000003FFFFE000000000000
0FFFFFC000003FFFFE0000000000000FFFFFE000003FFFFE0000000000000FFFFFE00000
3FFFFE00000000000007FFFFF000003FFFFE00000000000007FFFFF000003FFFFE000000
00000007FFFFF800003FFFFE00000000000003FFFFF800003FFFFE00000000000003FFFF
FC00003FFFFE00000000000003FFFFFC00003FFFFE00000000000003FFFFFC00003FFFFE
00000000000003FFFFFC00003FFFFE00000000000001FFFFFE00003FFFFE000000000000
01FFFFFE00003FFFFE00000000000001FFFFFE00003FFFFE00000000000001FFFFFE0000
3FFFFE00000000000001FFFFFE00003FFFFE00000000000001FFFFFE00003FFFFE000000
00000001FFFFFE00003FFFFE00000000000001FFFFFE00003FFFFE00000000000001FFFF
FE00003FFFFE00000000000003FFFFFE00003FFFFE00000000000003FFFFFC00003FFFFE
00000000000003FFFFFC00003FFFFE00000000000003FFFFFC00003FFFFE000000000000
03FFFFFC00003FFFFE00000000000007FFFFF800003FFFFE00000000000007FFFFF80000
3FFFFE0000000000000FFFFFF800003FFFFE0000000000000FFFFFF000003FFFFE000000
0000001FFFFFF000003FFFFE0000000000001FFFFFE000003FFFFE0000000000003FFFFF
C000003FFFFE0000000000007FFFFFC000003FFFFE000000000000FFFFFF8000003FFFFE
000000000001FFFFFF0000003FFFFE000000000003FFFFFE0000003FFFFE00000000000F
FFFFFE0000003FFFFE00000000001FFFFFF80000003FFFFE0000000000FFFFFFF0000000
3FFFFE0000000007FFFFFFE000FFFFFFFFFFFFFFFFFFFFFFFFFFC000FFFFFFFFFFFFFFFF
FFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFF000
00FFFFFFFFFFFFFFFFFFFFFFFFC00000FFFFFFFFFFFFFFFFFFFFFFFE000000FFFFFFFFFF
FFFFFFFFFFFFE0000000FFFFFFFFFFFFFFFFFFFFF800000000777679F58A>I<00000000
0000007FFFE000000000700000000000003FFFFFFF00000001F8000000000003FFFFFFFF
F0000003F800000000003FFFFFFFFFFC000007F80000000001FFFFFFFFFFFF80000FF800
00000007FFFFFFFFFFFFE0001FF8000000003FFFFFFFFFFFFFF0003FF800000000FFFFFF
FFFFFFFFFC007FF800000003FFFFFFFF0007FFFE00FFF80000000FFFFFFFC000003FFF81
FFF80000001FFFFFFC00000007FFC3FFF80000007FFFFFE000000001FFF7FFF8000000FF
FFFF80000000007FFFFFF8000003FFFFFE00000000001FFFFFF8000007FFFFF800000000
000FFFFFF800000FFFFFE0000000000007FFFFF800001FFFFFC0000000000001FFFFF800
007FFFFF80000000000000FFFFF80000FFFFFE000000000000007FFFF80001FFFFFC0000
00000000003FFFF80003FFFFF8000000000000003FFFF80003FFFFF0000000000000001F
FFF80007FFFFF0000000000000000FFFF8000FFFFFE00000000000000007FFF8001FFFFF
C00000000000000003FFF8003FFFFF800000000000000003FFF8003FFFFF800000000000
000001FFF8007FFFFF000000000000000001FFF800FFFFFE000000000000000000FFF800
FFFFFE000000000000000000FFF801FFFFFC0000000000000000007FF801FFFFFC000000
0000000000007FF803FFFFFC0000000000000000003FF803FFFFF8000000000000000000
3FF807FFFFF80000000000000000001FF807FFFFF00000000000000000001FF80FFFFFF0
0000000000000000001FF80FFFFFF00000000000000000000FF80FFFFFF0000000000000
0000000FF81FFFFFE00000000000000000000FF81FFFFFE00000000000000000000FF81F
FFFFE00000000000000000000FF83FFFFFE000000000000000000007F83FFFFFC0000000
00000000000007F83FFFFFC000000000000000000007F83FFFFFC0000000000000000000
03F07FFFFFC000000000000000000000007FFFFFC000000000000000000000007FFFFFC0
00000000000000000000007FFFFFC000000000000000000000007FFFFF80000000000000
00000000007FFFFF800000000000000000000000FFFFFF800000000000000000000000FF
FFFF800000000000000000000000FFFFFF800000000000000000000000FFFFFF80000000
0000000000000000FFFFFF800000000000000000000000FFFFFF80000000000000000000
0000FFFFFF800000000000000000000000FFFFFF800000000000000000000000FFFFFF80
0000000000000000000000FFFFFF800000000000000000000000FFFFFF80000000000000
0000000000FFFFFF800000000000000000000000FFFFFF800000000000000000000000FF
FFFF800000000000000000000000FFFFFF800000000000000000000000FFFFFF80000000
0000000000000000FFFFFF800000000000000000000000FFFFFF80000000000000000000
00007FFFFF8000000000000000000000007FFFFF8000000000000000000000007FFFFFC0
00000000000000000000007FFFFFC000000000000000000000007FFFFFC0000000000000
00000000007FFFFFC000000000000000000000003FFFFFC000000000000000000000003F
FFFFC000000000000000000000003FFFFFC000000000000000000003F03FFFFFE0000000
00000000000007F81FFFFFE000000000000000000007F81FFFFFE0000000000000000000
07F81FFFFFE000000000000000000007F80FFFFFF000000000000000000007F80FFFFFF0
00000000000000000007F80FFFFFF00000000000000000000FF807FFFFF0000000000000
0000000FF807FFFFF80000000000000000000FF003FFFFF80000000000000000000FF003
FFFFFC0000000000000000001FF001FFFFFC0000000000000000001FF001FFFFFC000000
0000000000001FE000FFFFFE0000000000000000003FE000FFFFFF000000000000000000
3FE0007FFFFF0000000000000000007FC0003FFFFF8000000000000000007FC0003FFFFF
800000000000000000FF80001FFFFFC00000000000000000FF80000FFFFFE00000000000
000001FF000007FFFFF00000000000000003FF000003FFFFF00000000000000007FE0000
03FFFFF80000000000000007FE000001FFFFFC000000000000000FFC000000FFFFFE0000
00000000001FF80000007FFFFF800000000000003FF00000001FFFFFC0000000000000FF
E00000000FFFFFE0000000000001FFC000000007FFFFF8000000000003FF8000000003FF
FFFE00000000000FFF0000000000FFFFFF80000000003FFE00000000007FFFFFF0000000
00FFFC00000000001FFFFFFE00000003FFF800000000000FFFFFFFC000001FFFE0000000
000003FFFFFFFF0003FFFFC0000000000000FFFFFFFFFFFFFFFF000000000000003FFFFF
FFFFFFFFFC0000000000000007FFFFFFFFFFFFF00000000000000001FFFFFFFFFFFFC000
000000000000003FFFFFFFFFFF00000000000000000003FFFFFFFFF80000000000000000
00003FFFFFFF8000000000000000000000007FFFF00000000000757A75F78C>I<FFFFFF
FFFFFFFFFFFFFF00000000000000FFFFFFFFFFFFFFFFFFFFFC000000000000FFFFFFFFFF
FFFFFFFFFFFFC00000000000FFFFFFFFFFFFFFFFFFFFFFF80000000000FFFFFFFFFFFFFF
FFFFFFFFFF0000000000FFFFFFFFFFFFFFFFFFFFFFFFC000000000FFFFFFFFFFFFFFFFFF
FFFFFFF800000000FFFFFFFFFFFFFFFFFFFFFFFFFC0000000000003FFFFF000000007FFF
FFFF0000000000003FFFFF0000000003FFFFFFC000000000003FFFFF00000000007FFFFF
E000000000003FFFFF00000000000FFFFFF800000000003FFFFF000000000003FFFFFC00
000000003FFFFF000000000000FFFFFE00000000003FFFFF0000000000003FFFFF000000
00003FFFFF0000000000001FFFFF80000000003FFFFF0000000000000FFFFFC000000000
3FFFFF00000000000007FFFFE0000000003FFFFF00000000000001FFFFF0000000003FFF
FF00000000000000FFFFF8000000003FFFFF00000000000000FFFFFC000000003FFFFF00
0000000000007FFFFC000000003FFFFF000000000000003FFFFE000000003FFFFF000000
000000001FFFFF000000003FFFFF000000000000001FFFFF000000003FFFFF0000000000
00000FFFFF800000003FFFFF000000000000000FFFFFC00000003FFFFF00000000000000
07FFFFC00000003FFFFF0000000000000007FFFFE00000003FFFFF0000000000000003FF
FFE00000003FFFFF0000000000000003FFFFF00000003FFFFF0000000000000001FFFFF0
0000003FFFFF0000000000000001FFFFF80000003FFFFF0000000000000001FFFFF80000
003FFFFF0000000000000001FFFFFC0000003FFFFF0000000000000000FFFFFC0000003F
FFFF0000000000000000FFFFFC0000003FFFFF0000000000000000FFFFFE0000003FFFFF
0000000000000000FFFFFE0000003FFFFF00000000000000007FFFFE0000003FFFFF0000
0000000000007FFFFE0000003FFFFF00000000000000007FFFFF0000003FFFFF00000000
000000007FFFFF0000003FFFFF00000000000000007FFFFF0000003FFFFF000000000000
00007FFFFF0000003FFFFF00000000000000007FFFFF8000003FFFFF0000000000000000
7FFFFF8000003FFFFF00000000000000007FFFFF8000003FFFFF00000000000000003FFF
FF8000003FFFFF00000000000000003FFFFF8000003FFFFF00000000000000003FFFFF80
00003FFFFF00000000000000003FFFFFC000003FFFFF00000000000000003FFFFFC00000
3FFFFF00000000000000003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFF
FF00000000000000003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF00
000000000000003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF000000
00000000003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF0000000000
0000003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF00000000000000
003FFFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF00000000000000003F
FFFFC000003FFFFF00000000000000003FFFFFC000003FFFFF00000000000000003FFFFF
C000003FFFFF00000000000000003FFFFFC000003FFFFF00000000000000003FFFFF8000
003FFFFF00000000000000003FFFFF8000003FFFFF00000000000000003FFFFF8000003F
FFFF00000000000000007FFFFF8000003FFFFF00000000000000007FFFFF8000003FFFFF
00000000000000007FFFFF8000003FFFFF00000000000000007FFFFF0000003FFFFF0000
0000000000007FFFFF0000003FFFFF00000000000000007FFFFF0000003FFFFF00000000
000000007FFFFF0000003FFFFF00000000000000007FFFFE0000003FFFFF000000000000
0000FFFFFE0000003FFFFF0000000000000000FFFFFE0000003FFFFF0000000000000000
FFFFFC0000003FFFFF0000000000000000FFFFFC0000003FFFFF0000000000000000FFFF
FC0000003FFFFF0000000000000001FFFFF80000003FFFFF0000000000000001FFFFF800
00003FFFFF0000000000000001FFFFF00000003FFFFF0000000000000003FFFFF0000000
3FFFFF0000000000000003FFFFE00000003FFFFF0000000000000007FFFFE00000003FFF
FF0000000000000007FFFFC00000003FFFFF000000000000000FFFFFC00000003FFFFF00
0000000000000FFFFF800000003FFFFF000000000000001FFFFF000000003FFFFF000000
000000003FFFFF000000003FFFFF000000000000003FFFFE000000003FFFFF0000000000
00007FFFFC000000003FFFFF00000000000000FFFFF8000000003FFFFF00000000000001
FFFFF8000000003FFFFF00000000000003FFFFF0000000003FFFFF00000000000007FFFF
E0000000003FFFFF0000000000000FFFFFC0000000003FFFFF0000000000003FFFFF8000
0000003FFFFF000000000000FFFFFF00000000003FFFFF000000000001FFFFFC00000000
003FFFFF00000000000FFFFFF800000000003FFFFF00000000003FFFFFF000000000003F
FFFF0000000003FFFFFFC000000000003FFFFF000000007FFFFFFF80000000FFFFFFFFFF
FFFFFFFFFFFFFFFE00000000FFFFFFFFFFFFFFFFFFFFFFFFF800000000FFFFFFFFFFFFFF
FFFFFFFFFFE000000000FFFFFFFFFFFFFFFFFFFFFFFF8000000000FFFFFFFFFFFFFFFFFF
FFFFFC0000000000FFFFFFFFFFFFFFFFFFFFFFE00000000000FFFFFFFFFFFFFFFFFFFFFE
000000000000FFFFFFFFFFFFFFFFFFFF0000000000000082767AF594>I<0000003FFFF8
0000000000000007FFFFFFE00000000000007FFFFFFFFC000000000001FFFFFFFFFF8000
00000007FFFFFFFFFFE0000000001FFFFFFFFFFFF0000000003FFFF0007FFFFC00000000
7FFE00000FFFFE00000000FFFF000003FFFF80000001FFFF800001FFFFC0000001FFFFC0
0000FFFFE0000001FFFFC000007FFFF0000003FFFFE000003FFFF8000003FFFFE000001F
FFF8000003FFFFE000001FFFFC000003FFFFE000000FFFFE000003FFFFE000000FFFFE00
0003FFFFE000000FFFFF000003FFFFE0000007FFFF000003FFFFE0000007FFFF000001FF
FFC0000007FFFF000001FFFFC0000003FFFF800000FFFF80000003FFFF8000007FFF0000
0003FFFF8000003FFE00000003FFFF8000000FF800000003FFFF80000003E000000003FF
FF800000000000000003FFFF800000000000000003FFFF800000000000000003FFFF8000
00000000000003FFFF800000000000000003FFFF800000000000000003FFFF8000000000
00000003FFFF8000000000000007FFFFFF8000000000001FFFFFFFFF800000000003FFFF
FFFFFF80000000007FFFFFFFFFFF8000000003FFFFFFFFFFFF800000001FFFFFFE03FFFF
80000000FFFFFF8003FFFF80000003FFFFF80003FFFF8000000FFFFFC00003FFFF800000
1FFFFF000003FFFF8000007FFFFC000003FFFF800000FFFFF0000003FFFF800001FFFFC0
000003FFFF800003FFFF80000003FFFF800007FFFF00000003FFFF80000FFFFE00000003
FFFF80001FFFFE00000003FFFF80003FFFFC00000003FFFF80003FFFF800000003FFFF80
007FFFF800000003FFFF80007FFFF000000003FFFF80007FFFF000000003FFFF8000FFFF
F000000003FFFF8000FFFFE000000003FFFF8000FFFFE000000003FFFF8000FFFFE00000
0003FFFF8000FFFFE000000007FFFF8000FFFFE000000007FFFF8000FFFFE000000007FF
FF8000FFFFF00000000FFFFF8000FFFFF00000000FFFFF80007FFFF00000001FFFFF8000
7FFFF80000003FFFFF80007FFFF80000007EFFFF80003FFFFC0000007EFFFFC0003FFFFE
000001FCFFFFE0001FFFFF000003F8FFFFFC000FFFFF80000FF0FFFFFFFC07FFFFE0003F
E07FFFFFFE01FFFFFC03FFC07FFFFFFE00FFFFFFFFFF803FFFFFFE003FFFFFFFFE001FFF
FFFE000FFFFFFFFC0007FFFFFE0003FFFFFFF00001FFFFFE00003FFFFF8000003FFFFC00
0001FFF800000000000057507ACE5E>97 D<00000000000000000FFFE000000000000000
07FFFFFFE00000000000000007FFFFFFE00000000000000007FFFFFFE000000000000000
07FFFFFFE00000000000000007FFFFFFE00000000000000007FFFFFFE000000000000000
07FFFFFFE00000000000000007FFFFFFE0000000000000000003FFFFE000000000000000
0000FFFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE00000000000000000007FFFE000000000000000
00007FFFE00000000000000000007FFFE000000000003FFF80007FFFE00000000007FFFF
F8007FFFE0000000003FFFFFFF007FFFE000000001FFFFFFFFC07FFFE000000007FFFFFF
FFF07FFFE00000001FFFFFFFFFFC7FFFE00000007FFFFE007FFE7FFFE0000000FFFFF000
0FFF7FFFE0000003FFFF800001FFFFFFE0000007FFFE0000007FFFFFE000000FFFFC0000
003FFFFFE000001FFFF80000001FFFFFE000003FFFF00000000FFFFFE000007FFFE00000
0007FFFFE00000FFFFC000000003FFFFE00001FFFFC000000001FFFFE00003FFFF800000
0000FFFFE00003FFFF0000000000FFFFE00007FFFF0000000000FFFFE00007FFFF000000
0000FFFFE0000FFFFE0000000000FFFFE0000FFFFE0000000000FFFFE0001FFFFE000000
0000FFFFE0001FFFFC0000000000FFFFE0003FFFFC0000000000FFFFE0003FFFFC000000
0000FFFFE0003FFFFC0000000000FFFFE0007FFFFC0000000000FFFFE0007FFFF8000000
0000FFFFE0007FFFF80000000000FFFFE0007FFFF80000000000FFFFE0007FFFF8000000
0000FFFFE000FFFFF80000000000FFFFE000FFFFF80000000000FFFFE000FFFFF8000000
0000FFFFE000FFFFF80000000000FFFFE000FFFFF80000000000FFFFE000FFFFF8000000
0000FFFFE000FFFFF80000000000FFFFE000FFFFF80000000000FFFFE000FFFFF8000000
0000FFFFE000FFFFF80000000000FFFFE000FFFFF80000000000FFFFE000FFFFF8000000
0000FFFFE000FFFFF80000000000FFFFE000FFFFF80000000000FFFFE000FFFFF8000000
0000FFFFE0007FFFF80000000000FFFFE0007FFFF80000000000FFFFE0007FFFF8000000
0000FFFFE0007FFFF80000000000FFFFE0007FFFFC0000000000FFFFE0003FFFFC000000
0000FFFFE0003FFFFC0000000000FFFFE0003FFFFC0000000000FFFFE0001FFFFC000000
0000FFFFE0001FFFFC0000000000FFFFE0001FFFFE0000000000FFFFE0000FFFFE000000
0000FFFFE0000FFFFE0000000000FFFFE00007FFFF0000000000FFFFE00007FFFF000000
0001FFFFE00003FFFF8000000003FFFFE00001FFFF8000000007FFFFE00000FFFFC00000
0007FFFFE00000FFFFC00000000FFFFFE000007FFFE00000001FFFFFE000003FFFF00000
003FFFFFE000001FFFF8000000FFFFFFF000000FFFFC000001FFFFFFFC000003FFFF0000
07FFFFFFFFFE0001FFFFC0003FFEFFFFFFFE00007FFFFC01FFF8FFFFFFFE00003FFFFFFF
FFF0FFFFFFFE00000FFFFFFFFFC0FFFFFFFE000003FFFFFFFF00FFFFFFFE0000007FFFFF
FC00FFFFFFFE0000000FFFFFE000FFFFFFFE000000007FFE0000FFFE00005F797AF76C>
100 D<000000007FFF800000000000000FFFFFFC0000000000007FFFFFFF800000000001
FFFFFFFFE00000000007FFFFFFFFF8000000001FFFFFFFFFFE000000007FFFF807FFFF00
000001FFFFC000FFFF80000003FFFF00003FFFE0000007FFFC00000FFFF000000FFFF800
0007FFF800001FFFF0000003FFF800003FFFE0000001FFFC00007FFFC0000000FFFE0000
FFFF80000000FFFE0001FFFF800000007FFF0001FFFF000000007FFF8003FFFF00000000
3FFF8007FFFE000000003FFF8007FFFE000000003FFFC00FFFFE000000001FFFC00FFFFE
000000001FFFE01FFFFC000000001FFFE01FFFFC000000001FFFE01FFFFC000000000FFF
F03FFFFC000000000FFFF03FFFFC000000000FFFF03FFFF8000000000FFFF07FFFF80000
00000FFFF07FFFF8000000000FFFF07FFFF8000000000FFFF87FFFF80000000007FFF87F
FFF80000000007FFF8FFFFF80000000007FFF8FFFFF80000000007FFF8FFFFF800000000
07FFF8FFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFF8FFFFFF
FFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFF0FFFFF800000000000000FFFFF8000000000000
00FFFFF800000000000000FFFFF800000000000000FFFFF800000000000000FFFFF80000
00000000007FFFF8000000000000007FFFF8000000000000007FFFF8000000000000007F
FFFC000000000000003FFFFC000000000000003FFFFC000000000000003FFFFC00000000
0000003FFFFC000000000000001FFFFC000000000000001FFFFE000000000000000FFFFE
000000000003F00FFFFE000000000007F807FFFF000000000007F807FFFF00000000000F
F803FFFF80000000000FF001FFFF80000000001FF001FFFFC0000000001FE000FFFFE000
0000003FE0007FFFF0000000007FC0003FFFF800000000FFC0001FFFFC00000001FF8000
0FFFFE00000003FF000007FFFF8000000FFE000003FFFFE000003FFC000001FFFFF80000
FFF8000000FFFFFFC00FFFF00000003FFFFFFFFFFFE00000000FFFFFFFFFFF8000000003
FFFFFFFFFE0000000000FFFFFFFFF800000000001FFFFFFFE0000000000003FFFFFF0000
00000000000FFFE00000004D507BCE58>I<0001FFFC000000000000000000FFFFFFFC00
0000000000000000FFFFFFFC000000000000000000FFFFFFFC000000000000000000FFFF
FFFC000000000000000000FFFFFFFC000000000000000000FFFFFFFC0000000000000000
00FFFFFFFC000000000000000000FFFFFFFC000000000000000000007FFFFC0000000000
00000000001FFFFC000000000000000000000FFFFC000000000000000000000FFFFC0000
00000000000000000FFFFC000000000000000000000FFFFC000000000000000000000FFF
FC000000000000000000000FFFFC000000000000000000000FFFFC000000000000000000
000FFFFC000000000000000000000FFFFC000000000000000000000FFFFC000000000000
000000000FFFFC000000000000000000000FFFFC000000000000000000000FFFFC000000
000000000000000FFFFC000000000000000000000FFFFC000000000000000000000FFFFC
000000000000000000000FFFFC000000000000000000000FFFFC00000000000000000000
0FFFFC000000000000000000000FFFFC000000000000000000000FFFFC00000000000000
0000000FFFFC000000000000000000000FFFFC000000000000000000000FFFFC00000000
0000000000000FFFFC000000000000000000000FFFFC000000000000000000000FFFFC00
0000000000000000000FFFFC000000000000000000000FFFFC000000000000000000000F
FFFC000000000000000000000FFFFC000000000000000000000FFFFC00000FFFE0000000
00000FFFFC0000FFFFFE00000000000FFFFC0003FFFFFF80000000000FFFFC000FFFFFFF
E0000000000FFFFC003FFFFFFFF8000000000FFFFC007FFFFFFFFC000000000FFFFC01FF
F01FFFFE000000000FFFFC03FF0007FFFF000000000FFFFC07FC0003FFFF800000000FFF
FC0FF00001FFFFC00000000FFFFC1FC00000FFFFC00000000FFFFC3F800000FFFFE00000
000FFFFC7F000000FFFFE00000000FFFFC7E0000007FFFF00000000FFFFCFC0000007FFF
F00000000FFFFDF80000007FFFF00000000FFFFDF00000007FFFF00000000FFFFFF00000
003FFFF80000000FFFFFE00000003FFFF80000000FFFFFE00000003FFFF80000000FFFFF
C00000003FFFF80000000FFFFFC00000003FFFF80000000FFFFF800000003FFFF8000000
0FFFFF800000003FFFF80000000FFFFF000000003FFFF80000000FFFFF000000003FFFF8
0000000FFFFF000000003FFFF80000000FFFFF000000003FFFF80000000FFFFE00000000
3FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE00
0000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000F
FFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF800
00000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003F
FFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE0000
00003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFF
FE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000
000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFF
F80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000
003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE
000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF8000000
0FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF8
0000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE00000000
3FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE00
0000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000FFFF
FFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF
80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFF
FFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80617879F76C>
104 D<0001FC0000000007FF000000001FFFC00000003FFFE00000007FFFF0000000FFFF
F8000000FFFFF8000001FFFFFC000001FFFFFC000003FFFFFE000003FFFFFE000003FFFF
FE000003FFFFFE000003FFFFFE000003FFFFFE000003FFFFFE000001FFFFFC000001FFFF
FC000000FFFFF8000000FFFFF80000007FFFF00000003FFFE00000001FFFC000000007FF
0000000001FC000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000001FFFC00007FFFFFFC00007FFFFFFC00007FFFFFFC00007FFFFF
FC00007FFFFFFC00007FFFFFFC00007FFFFFFC00007FFFFFFC0000007FFFFC0000001FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFF
FC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000000FFFFC0000FFFFFF
FFFF80FFFFFFFFFF80FFFFFFFFFF80FFFFFFFFFF80FFFFFFFFFF80FFFFFFFFFF80FFFFFF
FFFF80FFFFFFFFFF80297979F835>I<0001FFF800000FFFE000000000FFFFFFF80000FF
FFFE00000000FFFFFFF80003FFFFFF80000000FFFFFFF8000FFFFFFFE0000000FFFFFFF8
003FFFFFFFF8000000FFFFFFF8007FFFFFFFFC000000FFFFFFF801FFF01FFFFE000000FF
FFFFF803FF0007FFFF000000FFFFFFF807FC0003FFFF800000007FFFF80FF00001FFFFC0
0000001FFFF81FC00000FFFFC00000000FFFF83F800000FFFFE00000000FFFF87F000000
FFFFE00000000FFFF87E0000007FFFF00000000FFFF8FC0000007FFFF00000000FFFF9F8
0000007FFFF00000000FFFF9F00000007FFFF00000000FFFFBF00000003FFFF80000000F
FFFBE00000003FFFF80000000FFFFFE00000003FFFF80000000FFFFFC00000003FFFF800
00000FFFFFC00000003FFFF80000000FFFFF800000003FFFF80000000FFFFF800000003F
FFF80000000FFFFF000000003FFFF80000000FFFFF000000003FFFF80000000FFFFF0000
00003FFFF80000000FFFFF000000003FFFF80000000FFFFE000000003FFFF80000000FFF
FE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000
000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFF
F80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000
003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE
000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF8000000
0FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF8
0000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE00000000
3FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE00
0000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000F
FFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF800
00000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003F
FFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE0000
00003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000000FFF
FE000000003FFFF80000000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000
000FFFFE000000003FFFF80000000FFFFE000000003FFFF80000FFFFFFFFFFE003FFFFFF
FFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003
FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80FFFFFFFF
FFE003FFFFFFFFFF80FFFFFFFFFFE003FFFFFFFFFF80614E79CD6C>110
D<0001FFFC00007FFE00000000FFFFFFFC000FFFFFF0000000FFFFFFFC007FFFFFFE0000
00FFFFFFFC01FFFFFFFFC00000FFFFFFFC07FFFFFFFFF00000FFFFFFFC1FFFFFFFFFF800
00FFFFFFFC7FFFFFFFFFFE0000FFFFFFFCFFFF007FFFFF0000FFFFFFFFFFF0000FFFFFC0
00007FFFFFFF800003FFFFE000001FFFFFFE000001FFFFF000000FFFFFFC000000FFFFF8
00000FFFFFF00000007FFFFC00000FFFFFE00000003FFFFE00000FFFFFC00000001FFFFF
00000FFFFF800000000FFFFF00000FFFFF000000000FFFFF80000FFFFE0000000007FFFF
C0000FFFFE0000000003FFFFC0000FFFFE0000000003FFFFE0000FFFFE0000000003FFFF
E0000FFFFE0000000001FFFFF0000FFFFE0000000001FFFFF0000FFFFE0000000000FFFF
F8000FFFFE0000000000FFFFF8000FFFFE0000000000FFFFF8000FFFFE0000000000FFFF
F8000FFFFE00000000007FFFFC000FFFFE00000000007FFFFC000FFFFE00000000007FFF
FC000FFFFE00000000007FFFFC000FFFFE00000000007FFFFC000FFFFE00000000003FFF
FE000FFFFE00000000003FFFFE000FFFFE00000000003FFFFE000FFFFE00000000003FFF
FE000FFFFE00000000003FFFFE000FFFFE00000000003FFFFE000FFFFE00000000003FFF
FE000FFFFE00000000003FFFFE000FFFFE00000000003FFFFE000FFFFE00000000003FFF
FE000FFFFE00000000003FFFFE000FFFFE00000000003FFFFE000FFFFE00000000003FFF
FE000FFFFE00000000003FFFFE000FFFFE00000000003FFFFE000FFFFE00000000007FFF
FC000FFFFE00000000007FFFFC000FFFFE00000000007FFFFC000FFFFE00000000007FFF
FC000FFFFE00000000007FFFFC000FFFFE0000000000FFFFF8000FFFFE0000000000FFFF
F8000FFFFE0000000000FFFFF8000FFFFE0000000000FFFFF0000FFFFE0000000001FFFF
F0000FFFFE0000000001FFFFE0000FFFFE0000000003FFFFE0000FFFFE0000000003FFFF
C0000FFFFE0000000007FFFFC0000FFFFE0000000007FFFF80000FFFFF000000000FFFFF
80000FFFFF800000000FFFFF00000FFFFFC00000001FFFFE00000FFFFFC00000003FFFFC
00000FFFFFE00000007FFFF800000FFFFFF0000000FFFFF000000FFFFFFC000001FFFFE0
00000FFFFFFE000003FFFFC000000FFFFFFF80000FFFFF8000000FFFFFFFE0003FFFFE00
00000FFFFE7FFC01FFFFFC0000000FFFFE3FFFFFFFFFF00000000FFFFE0FFFFFFFFFC000
00000FFFFE03FFFFFFFF000000000FFFFE00FFFFFFF8000000000FFFFE003FFFFFC00000
00000FFFFE0003FFF000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000000FFFFE0000000000000000000FFFFE00000000000000
00000FFFFE0000000000000000FFFFFFFFFFE0000000000000FFFFFFFFFFE00000000000
00FFFFFFFFFFE0000000000000FFFFFFFFFFE0000000000000FFFFFFFFFFE00000000000
00FFFFFFFFFFE0000000000000FFFFFFFFFFE0000000000000FFFFFFFFFFE00000000000
005F6F7ACD6C>112 D<0001FFF80007FE0000FFFFFFF8003FFFC000FFFFFFF800FFFFF0
00FFFFFFF803FFFFF800FFFFFFF807FFFFFE00FFFFFFF80FFFFFFF00FFFFFFF81FFC3FFF
80FFFFFFF83FE07FFFC0FFFFFFF87F80FFFFC0007FFFF87F00FFFFC0001FFFF8FE01FFFF
E0000FFFF9FC01FFFFE0000FFFF9F801FFFFE0000FFFFBF801FFFFE0000FFFFBF001FFFF
E0000FFFFBE001FFFFE0000FFFFFE001FFFFE0000FFFFFC001FFFFE0000FFFFFC000FFFF
C0000FFFFF8000FFFFC0000FFFFF80007FFF80000FFFFF80001FFE00000FFFFF00000FFC
00000FFFFF000001E000000FFFFF0000000000000FFFFF0000000000000FFFFE00000000
00000FFFFE0000000000000FFFFE0000000000000FFFFE0000000000000FFFFE00000000
00000FFFFE0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000000FFFFC00000000
00000FFFFC0000000000000FFFFC0000000000000FFFFC0000000000FFFFFFFFFFF80000
00FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF80000
00FFFFFFFFFFF8000000FFFFFFFFFFF8000000FFFFFFFFFFF8000000434E7ACD4F>114
D<000000FF00000000000000FF00000000000000FF00000000000000FF00000000000000
FF00000000000000FF00000000000000FF00000000000001FF00000000000001FF000000
00000001FF00000000000001FF00000000000001FF00000000000003FF00000000000003
FF00000000000003FF00000000000003FF00000000000007FF00000000000007FF000000
0000000FFF0000000000000FFF0000000000001FFF0000000000001FFF0000000000003F
FF0000000000003FFF0000000000007FFF000000000000FFFF000000000000FFFF000000
000001FFFF000000000003FFFF000000000007FFFF00000000001FFFFF00000000003FFF
FF0000000000FFFFFFFFFFFF000FFFFFFFFFFFFF00FFFFFFFFFFFFFF00FFFFFFFFFFFFFF
00FFFFFFFFFFFFFF00FFFFFFFFFFFFFF00FFFFFFFFFFFFFF00FFFFFFFFFFFFFF000007FF
FF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000
000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FF
FF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000
000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FF
FF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000
000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FF
FF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000
000007FFFF000000000007FFFF000000000007FFFF000000000007FFFF000000000007FF
FF000000000007FFFF000000000007FFFF000000000007FFFF00001FE00007FFFF00001F
E00007FFFF00001FE00007FFFF00001FE00007FFFF00001FE00007FFFF00001FE00007FF
FF00001FE00007FFFF00001FE00007FFFF00001FE00007FFFF00001FE00007FFFF00001F
E00007FFFF00001FE00007FFFF00001FE00007FFFF00001FE00007FFFF00003FE00007FF
FF80003FC00003FFFF80003FC00003FFFF80007FC00003FFFFC0007F800001FFFFC000FF
800001FFFFE000FF800000FFFFE001FF0000007FFFF003FE0000007FFFFE0FFE0000003F
FFFFFFFC0000000FFFFFFFF800000007FFFFFFF000000001FFFFFFC0000000007FFFFF80
000000001FFFFE000000000001FFF000003B6E7CEC4B>116 D<7FFFFFFFFF00003FFFFF
FFF07FFFFFFFFF00003FFFFFFFF07FFFFFFFFF00003FFFFFFFF07FFFFFFFFF00003FFFFF
FFF07FFFFFFFFF00003FFFFFFFF07FFFFFFFFF00003FFFFFFFF07FFFFFFFFF00003FFFFF
FFF07FFFFFFFFF00003FFFFFFFF00003FFFFC0000001FFFF00000001FFFFE00000007FF0
00000001FFFFF00000007FE000000000FFFFF0000000FFC0000000007FFFF8000001FF80
000000003FFFFC000003FF00000000001FFFFE000007FF00000000001FFFFF00000FFE00
000000000FFFFF00001FFC000000000007FFFF80001FF8000000000003FFFFC0003FF000
0000000001FFFFE0007FE0000000000001FFFFF000FFE0000000000000FFFFF801FFC000
00000000007FFFF803FF800000000000003FFFFC07FF000000000000001FFFFE07FE0000
00000000001FFFFF0FFC000000000000000FFFFF9FF80000000000000007FFFFBFF80000
000000000003FFFFFFF00000000000000001FFFFFFE00000000000000001FFFFFFC00000
000000000000FFFFFF8000000000000000007FFFFF0000000000000000003FFFFE000000
0000000000001FFFFE0000000000000000001FFFFF0000000000000000000FFFFF800000
00000000000007FFFF80000000000000000003FFFFC0000000000000000001FFFFE00000
00000000000001FFFFF0000000000000000003FFFFF8000000000000000007FFFFF80000
0000000000000FFFFFFC00000000000000000FFFFFFE00000000000000001FFFFFFF0000
0000000000003FFFFFFF80000000000000007FE7FFFF8000000000000000FFE3FFFFC000
000000000001FFC1FFFFE000000000000003FF80FFFFF000000000000003FF00FFFFF800
000000000007FE007FFFF80000000000000FFC003FFFFC0000000000001FFC001FFFFE00
00000000003FF8000FFFFF0000000000007FF0000FFFFF800000000000FFE00007FFFF80
0000000000FFC00003FFFFC00000000001FF800001FFFFE00000000003FF000000FFFFF0
0000000007FF000000FFFFF8000000000FFE0000007FFFF8000000001FFC0000003FFFFC
000000003FF80000001FFFFE000000003FF00000000FFFFF000000007FE00000000FFFFF
80000000FFC000000007FFFFC000000FFFF800000003FFFFC000FFFFFFFF800000FFFFFF
FFFEFFFFFFFF800000FFFFFFFFFEFFFFFFFF800000FFFFFFFFFEFFFFFFFF800000FFFFFF
FFFEFFFFFFFF800000FFFFFFFFFEFFFFFFFF800000FFFFFFFFFEFFFFFFFF800000FFFFFF
FFFEFFFFFFFF800000FFFFFFFFFE5F4D7DCC66>120 D E /Ft 5
117 df<FFFFFFF000FFFFFFFE0007F8003F8003F0000FC003F00007E003F00003F003F0
0003F803F00001F803F00001FC03F00001FC03F00001FC03F00001FC03F00001FC03F000
01F803F00001F803F00003F003F00007F003F0000FE003F0003F8003F001FF0003FFFFF8
0003FFFFFF0003F0001FC003F00007E003F00003F003F00001F803F00001FC03F00000FC
03F00000FE03F00000FE03F00000FE03F00000FE03F00000FE03F00000FE03F00000FC03
F00001FC03F00001FC03F00003F803F00007F003F0000FE007F8003FC0FFFFFFFF00FFFF
FFF800272B7CAA30>98 D<FFFFFFF00000FFFFFFFE000007F8007F000003F0000FC00003
F00003E00003F00001F00003F00000F80003F000007C0003F000007E0003F000003F0003
F000003F0003F000001F8003F000001F8003F000001FC003F000000FC003F000000FC003
F000000FC003F000000FE003F000000FE003F000000FE003F000000FE003F000000FE003
F000000FE003F000000FE003F000000FE003F000000FE003F000000FE003F000000FC003
F000000FC003F000000FC003F000001F8003F000001F8003F000001F0003F000003F0003
F000003E0003F000007C0003F00000FC0003F00001F80003F00003F00003F0000FC00007
F8007F8000FFFFFFFE0000FFFFFFF000002B2B7CAA34>100 D<FFFFE00000FFFFE00000
07F800000003F000000003F000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000006003F000006003F000006003F00000
6003F00000C003F00000C003F00000C003F00001C003F00001C003F00003C003F00003C0
03F00007C003F0001F8007F800FF80FFFFFFFF80FFFFFFFF80232B7CAA2B>108
D<FFF00000003FFCFFF80000007FFC07F80000007F8003F80000007F00037C000000DF00
037C000000DF00033E0000019F00033E0000019F00033E0000019F00031F0000031F0003
1F0000031F00030F8000061F00030F8000061F00030F8000061F000307C0000C1F000307
C0000C1F000303E000181F000303E000181F000301F000301F000301F000301F000301F0
00301F000300F800601F000300F800601F0003007C00C01F0003007C00C01F0003007C00
C01F0003003E01801F0003003E01801F0003001F03001F0003001F03001F0003001F0300
1F0003000F86001F0003000F86001F00030007CC001F00030007CC001F00030007CC001F
00030003F8001F00030003F8001F00078001F0001F00078001F0001F001FE001F0003F80
FFFC00E007FFFCFFFC00E007FFFC362B7CAA3E>I<7FFFFFFFFFC07FFFFFFFFFC07E003F
C00FC078001F8003C070001F8001C070001F8000C060001F8000C0E0001F8000E0E0001F
8000E0C0001F800060C0001F800060C0001F800060C0001F800060C0001F80006000001F
80000000001F80000000001F80000000001F80000000001F80000000001F80000000001F
80000000001F80000000001F80000000001F80000000001F80000000001F80000000001F
80000000001F80000000001F80000000001F80000000001F80000000001F80000000001F
80000000001F80000000001F80000000001F80000000001F80000000001F80000000001F
80000000001F80000000007FE00000001FFFFF8000001FFFFF80002B2B7DAA31>116
D E /Fu 7 120 df<0000000380000000000003C0000000000007C0000000000007C000
00000000078000000000000780000000000007800000000000078000000000000F800000
0000000F8000000000000F0000000000000F0000000000000F0000000000000F00000000
00001F0000000000001F0000000000001E0000000000001E0000000000001E0000000000
001E0000000000003E0000000000003E0000000000003C0000000000003C000000000000
3C0000007FFFFFFFFFFFFCFFFFFFFFFFFFFEFFFFFFFFFFFFFE7FFFFFFFFFFFFC00000078
0000000000007800000000000078000000000000F8000000000000F8000000000000F000
0000000000F0000000000000F0000000000000F0000000000001F0000000000001F00000
00000001E0000000000001E0000000000001E0000000000001E0000000000003E0000000
000003E0000000000003C0000000000003C0000000000003C0000000000003C000000000
0007C0000000000007C00000000000078000000000000380000000373678AF41>43
D<00000007FC00060000007FFF800E000001FFFFE01E000007FC01F03C00001FE000787C
00007F80001CFC0000FE00000FFC0003FC000007FC0007F8000007FC000FF0000003F800
1FE0000001F8003FC0000001F8007F80000000F800FF00000000F801FF00000000F801FE
00000000F003FC000000007007FC000000007007F800000000700FF800000000700FF800
000000701FF000000000601FF000000000601FE000000000603FE000000000003FE00000
0000003FE000000000007FC000000000007FC000000000007FC000000000007FC0000000
00007FC00000000000FFC00000000000FF800000000000FF800000000000FF8000000000
00FF800000000000FF800000000000FF800000000300FF8000000003007F800000000300
7F8000000003007F8000000007007F8000000006003FC00000000E003FC00000000E003F
C00000001C001FC00000001C001FE000000038000FE000000070000FF0000000700007F8
000000E00003F8000001C00001FC000003800000FE00000F0000007F80001E0000003FC0
00780000000FF803F000000003FFFFC000000000FFFF00000000001FF8000000373D77BA
3C>67 D<007F0000001FFF0000001FFE0000001FFE00000001FE00000000FE00000000FE
00000000FE00000000FC00000000FC00000000FC00000000FC00000000FC00000001FC00
000001F800000001F800000001F800000001F800000001F800000003F800000003F00000
0003F01FC00003F07FF80003F1E03E0003F7801F0007FE000F8007FC0007C007F80007E0
07F00003E007E00003F007E00003F00FE00003F80FC00001F80FC00001F80FC00001F80F
C00001F80FC00003F81FC00003F81F800003F81F800003F81F800003F81F800003F81F80
0007F83F800007F03F000007F03F000007E03F00000FE03F00000FC03F00001FC07F0000
1F807F00003F007F00007F007F80007E007D8000FC0079C001F000F0E007E000E0781F80
00C01FFE00000007F00000253B78B92E>98 D<00007F00000003FFE000000F81F000003E
00FC00007C007C0001F8003E0003F0003F0007F0001F0007E0001F000FC0001F801FC000
1F801F80001F803F80001F803F80001F807F00001F807F00001F807F00001F80FFFFFFFF
00FFFFFFFF00FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000
FC00000000FE00000000FE000000007E00000E007E00000E007E00001C003F000018001F
000038001F800070000FC001E00007E003800001F01F0000007FFC0000001FE000002127
7BA525>101 D<000FC03FC00003FFC0FFF00007FFC3C0F80007FFCF007C00003FDC007E
00001FB8007E00001FF0003E00001FE0003F00001FC0003F00001FC0007F00003F80007E
00003F80007E00003F00007E00003F00007E00003F00007E00003F0000FE00007F0000FE
00007E0000FC00007E0000FC00007E0000FC00007E0000FC00007E0001FC0000FE0001FC
0000FC0001F80000FC0001F80000FC0001F80000FC0001F80000FC0003F80001FC0003F8
0001F80003F00001F80003F00001F80003F00001F80003F00003F80007F000FFFFE1FFFF
C0FFFFE1FFFFC0FFFFC1FFFF802A257EA42E>110 D<00003FC0000001FFF8000007C07C
00001F001F00007C000F8000F80007C001F00007C003E00003E007E00003E007C00001F0
0F800001F01F800001F81F800001F83F000001F83F000001F87F000001F87F000001F87E
000003F8FE000003F8FE000003F8FE000003F8FE000003F8FE000003F0FE000007F0FC00
0007F0FC000007E0FC00000FE0FC00000FC0FE00000FC07E00001F807E00001F003E0000
3E003F00007C001F0000F8000F8001F00007C007E00001F81F800000FFFE0000001FF000
0025277BA52A>I<FFFF8FFFF01FFFFFFF8FFFF01FFFFFFF8FFFF01FFF0FF800FF0007F8
07F0007E0003E007F0007E0003C003F0007E00018003F0003E00038003F0003E00030003
F0003E00060001F8007F00060001F8007F000C0001F800DF000C0001F800DF00180001F8
019F00180001FC019F80300000FC031F80300000FC030F80600000FC060F80600000FC0E
0F80C00000FC0C0F80C000007E1C0FC18000007E180FC18000007E3807C30000007E3007
C30000007E6007C60000007F6007E60000003FC007EC0000003FC003EC0000003F8003F8
0000003F8003F80000003F0003F00000001F0003F00000001E0003E00000001E0001E000
00001C0001C00000001C0001800000382579A33C>119 D E /Fv
32 122 df[<000000000000000FFFFE00000000000000000000000FFFFFFFE000000000
000000000001FFFFFFFFFC0000000000000000001FFFFFFFFFFF000000000000000000FF
FFFFFFFFFFC00000000000000007FFFFFFFFFFFFE0000000000000001FFFFFFFFFFFFFF8
000000000000007FFFFFFC001FFFFC00000000000001FFFFFF800001FFFE000000000000
07FFFFF80000003FFF0000000000000FFFFFE00000000FFF8000000000003FFFFF800000
001FFFC000000000007FFFFE000000007FFFC00000000000FFFFFC00000000FFFFE00000
000001FFFFF000000001FFFFE00000000003FFFFE000000003FFFFF00000000007FFFFC0
00000007FFFFF0000000000FFFFF8000000007FFFFF8000000000FFFFF800000000FFFFF
F8000000001FFFFF000000000FFFFFF8000000003FFFFE000000000FFFFFF8000000003F
FFFE000000000FFFFFF8000000007FFFFC000000000FFFFFF8000000007FFFFC00000000
1FFFFFFC000000007FFFFC000000000FFFFFF800000000FFFFFC000000000FFFFFF80000
0000FFFFF8000000000FFFFFF800000000FFFFF8000000000FFFFFF800000000FFFFF800
0000000FFFFFF800000000FFFFF80000000007FFFFF000000000FFFFF80000000007FFFF
F000000000FFFFF80000000003FFFFE000000000FFFFF80000000001FFFFC000000000FF
FFF80000000000FFFF8000000000FFFFF800000000003FFE0000000000FFFFF800000000
000FF80000000000FFFFF8000000000000000000000000FFFFF800000000000000000000
0000FFFFF8000000000000000000000000FFFFF8000000000000000000000000FFFFF800
0000000000000000000000FFFFF8000000000000000000000000FFFFF800000000000000
0000000000FFFFF8000000000000000000000000FFFFF8000000000000000000000000FF
FFF8000000000000000000000000FFFFF8000000000000000000000000FFFFF800000000
0000000000000000FFFFF8000000000000000000000000FFFFF800000000000000000000
0000FFFFF8000000000000000000000000FFFFF80000003FFFFFFFFC0000FFFFFFFFFFFF
FFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFF
FC0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFF
FFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFF
FFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFC00000000FFFFFC0000000003FFFFFC0000
0000FFFFFC0000000001FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00
00000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFF
FC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FF
FFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC00000000
00FFFFFC00000000FFFFFC0000000000FFFFFC00000000FFFFFC0000000000FFFFFC0000
0000FFFFFC0000000000FFFFFC00003FFFFFFFFFFFF0003FFFFFFFFFFFF03FFFFFFFFFFF
F0003FFFFFFFFFFFF03FFFFFFFFFFFF0003FFFFFFFFFFFF03FFFFFFFFFFFF0003FFFFFFF
FFFFF03FFFFFFFFFFFF0003FFFFFFFFFFFF03FFFFFFFFFFFF0003FFFFFFFFFFFF03FFFFF
FFFFFFF0003FFFFFFFFFFFF03FFFFFFFFFFFF0003FFFFFFFFFFFF03FFFFFFFFFFFF0003F
FFFFFFFFFFF0>116 144 123 271 129 12 D[<FFFFFFFFFFFFFFFFFFFFFFFF00000000
0000FFFFFFFFFFFFFFFFFFFFFFFFFE0000000000FFFFFFFFFFFFFFFFFFFFFFFFFFE00000
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFC00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF8000
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80
0000000003FFFFFF00000000001FFFFFFFE00000000003FFFFFF000000000001FFFFFFF0
0000000003FFFFFF0000000000007FFFFFF80000000003FFFFFF0000000000001FFFFFFC
0000000003FFFFFF0000000000000FFFFFFF0000000003FFFFFF00000000000003FFFFFF
8000000003FFFFFF00000000000001FFFFFF8000000003FFFFFF00000000000000FFFFFF
C000000003FFFFFF00000000000000FFFFFFE000000003FFFFFF000000000000007FFFFF
F000000003FFFFFF000000000000003FFFFFF000000003FFFFFF000000000000003FFFFF
F800000003FFFFFF000000000000001FFFFFF800000003FFFFFF000000000000001FFFFF
FC00000003FFFFFF000000000000000FFFFFFC00000003FFFFFF000000000000000FFFFF
FE00000003FFFFFF000000000000000FFFFFFE00000003FFFFFF0000000000000007FFFF
FF00000003FFFFFF0000000000000007FFFFFF00000003FFFFFF0000000000000007FFFF
FF00000003FFFFFF0000000000000007FFFFFF00000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000003FFFFFF80000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000003FFFFFF80000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000003FFFFFF80000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000003FFFFFF80000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000003FFFFFF80000003FFFFFF0000000000000003FFFF
FF80000003FFFFFF0000000000000007FFFFFF00000003FFFFFF0000000000000007FFFF
FF00000003FFFFFF0000000000000007FFFFFF00000003FFFFFF0000000000000007FFFF
FF00000003FFFFFF000000000000000FFFFFFE00000003FFFFFF000000000000000FFFFF
FE00000003FFFFFF000000000000000FFFFFFC00000003FFFFFF000000000000001FFFFF
FC00000003FFFFFF000000000000001FFFFFF800000003FFFFFF000000000000003FFFFF
F800000003FFFFFF000000000000003FFFFFF000000003FFFFFF000000000000007FFFFF
E000000003FFFFFF00000000000000FFFFFFC000000003FFFFFF00000000000000FFFFFF
C000000003FFFFFF00000000000001FFFFFF8000000003FFFFFF00000000000003FFFFFF
0000000003FFFFFF00000000000007FFFFFE0000000003FFFFFF0000000000000FFFFFF8
0000000003FFFFFF0000000000003FFFFFF00000000003FFFFFF0000000000007FFFFFE0
0000000003FFFFFF000000000001FFFFFF800000000003FFFFFF00000000000FFFFFFE00
0000000003FFFFFF00000000007FFFFFF8000000000003FFFFFF000000001FFFFFFFE000
0000000003FFFFFFFFFFFFFFFFFFFFFF00000000000003FFFFFFFFFFFFFFFFFFFFF80000
0000000003FFFFFFFFFFFFFFFFFFFF8000000000000003FFFFFFFFFFFFFFFFFFFFF80000
0000000003FFFFFFFFFFFFFFFFFFFFFF80000000000003FFFFFFFFFFFFFFFFFFFFFFF800
0000000003FFFFFFFFFFFFFFFFFFFFFFFE000000000003FFFFFF000000000000FFFFFFC0
0000000003FFFFFF0000000000001FFFFFF00000000003FFFFFF00000000000007FFFFF8
0000000003FFFFFF00000000000003FFFFFE0000000003FFFFFF00000000000000FFFFFF
8000000003FFFFFF000000000000007FFFFFC000000003FFFFFF000000000000003FFFFF
E000000003FFFFFF000000000000001FFFFFF000000003FFFFFF000000000000000FFFFF
F800000003FFFFFF0000000000000007FFFFFC00000003FFFFFF0000000000000003FFFF
FE00000003FFFFFF0000000000000003FFFFFF00000003FFFFFF0000000000000001FFFF
FF80000003FFFFFF0000000000000001FFFFFFC0000003FFFFFF0000000000000000FFFF
FFC0000003FFFFFF0000000000000000FFFFFFE0000003FFFFFF00000000000000007FFF
FFE0000003FFFFFF00000000000000007FFFFFF0000003FFFFFF00000000000000007FFF
FFF0000003FFFFFF00000000000000007FFFFFF8000003FFFFFF00000000000000003FFF
FFF8000003FFFFFF00000000000000003FFFFFF8000003FFFFFF00000000000000003FFF
FFFC000003FFFFFF00000000000000003FFFFFFC000003FFFFFF00000000000000003FFF
FFFC000003FFFFFF00000000000000001FFFFFFC000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000001FFFFFFE000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000001FFFFFFE000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000001FFFFFFE000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000001FFFFFFE000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000001FFFFFFE000003FFFFFF00000000000000001FFF
FFFE000003FFFFFF00000000000000003FFFFFFC000003FFFFFF00000000000000003FFF
FFFC000003FFFFFF00000000000000003FFFFFFC000003FFFFFF00000000000000003FFF
FFFC000003FFFFFF00000000000000003FFFFFFC000003FFFFFF00000000000000007FFF
FFF8000003FFFFFF00000000000000007FFFFFF8000003FFFFFF00000000000000007FFF
FFF8000003FFFFFF0000000000000000FFFFFFF0000003FFFFFF0000000000000000FFFF
FFF0000003FFFFFF0000000000000001FFFFFFE0000003FFFFFF0000000000000003FFFF
FFE0000003FFFFFF0000000000000003FFFFFFC0000003FFFFFF0000000000000007FFFF
FF80000003FFFFFF000000000000000FFFFFFF80000003FFFFFF000000000000001FFFFF
FF00000003FFFFFF000000000000003FFFFFFE00000003FFFFFF000000000000007FFFFF
FC00000003FFFFFF00000000000000FFFFFFFC00000003FFFFFF00000000000001FFFFFF
F800000003FFFFFF00000000000007FFFFFFF000000003FFFFFF0000000000001FFFFFFF
C000000003FFFFFF000000000000FFFFFFFF8000000003FFFFFF00000000000FFFFFFFFF
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE00000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFC000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFF000
0000FFFFFFFFFFFFFFFFFFFFFFFFFFFF80000000FFFFFFFFFFFFFFFFFFFFFFFFFFF00000
0000FFFFFFFFFFFFFFFFFFFFFFFFFC0000000000>143 142 120
269 165 66 D[<000000000000000003FFFFC00000000001F00000000000000003FFFFFF
FE0000000003F8000000000000007FFFFFFFFFE000000007F800000000000007FFFFFFFF
FFFC0000000FF80000000000003FFFFFFFFFFFFF0000001FF8000000000001FFFFFFFFFF
FFFFE000003FF800000000000FFFFFFFFFFFFFFFF800007FF800000000003FFFFFFFFFFF
FFFFFE0000FFF80000000000FFFFFFFFFFFFFFFFFF0001FFF80000000003FFFFFFFFF800
0FFFFFC003FFF8000000000FFFFFFFFE0000007FFFF007FFF8000000003FFFFFFFC00000
000FFFF80FFFF800000000FFFFFFFE0000000003FFFC1FFFF800000001FFFFFFF0000000
00007FFF3FFFF800000007FFFFFFC000000000001FFFFFFFF80000000FFFFFFF00000000
00000FFFFFFFF80000003FFFFFFC00000000000003FFFFFFF80000007FFFFFF000000000
000001FFFFFFF8000000FFFFFFE000000000000000FFFFFFF8000001FFFFFF8000000000
0000003FFFFFF8000003FFFFFF00000000000000001FFFFFF8000007FFFFFE0000000000
0000000FFFFFF800000FFFFFFC000000000000000007FFFFF800001FFFFFF00000000000
00000003FFFFF800003FFFFFE0000000000000000001FFFFF800007FFFFFE00000000000
00000000FFFFF80000FFFFFFC0000000000000000000FFFFF80001FFFFFF800000000000
000000007FFFF80003FFFFFF000000000000000000003FFFF80003FFFFFE000000000000
000000001FFFF80007FFFFFE000000000000000000001FFFF8000FFFFFFC000000000000
000000000FFFF8000FFFFFF8000000000000000000000FFFF8001FFFFFF8000000000000
0000000007FFF8003FFFFFF00000000000000000000003FFF8003FFFFFF0000000000000
0000000003FFF8007FFFFFE00000000000000000000003FFF8007FFFFFE0000000000000
0000000001FFF800FFFFFFC00000000000000000000001FFF800FFFFFFC0000000000000
0000000000FFF801FFFFFFC00000000000000000000000FFF801FFFFFF80000000000000
0000000000FFF803FFFFFF8000000000000000000000007FF803FFFFFF80000000000000
00000000007FF807FFFFFF0000000000000000000000007FF807FFFFFF00000000000000
00000000003FF807FFFFFF0000000000000000000000003FF80FFFFFFF00000000000000
00000000003FF80FFFFFFE0000000000000000000000003FF80FFFFFFE00000000000000
00000000003FF81FFFFFFE0000000000000000000000001FF81FFFFFFE00000000000000
00000000001FF81FFFFFFE0000000000000000000000001FF83FFFFFFC00000000000000
00000000001FF83FFFFFFC0000000000000000000000000FF03FFFFFFC00000000000000
000000000000003FFFFFFC00000000000000000000000000007FFFFFFC00000000000000
000000000000007FFFFFFC00000000000000000000000000007FFFFFFC00000000000000
000000000000007FFFFFFC00000000000000000000000000007FFFFFF800000000000000
000000000000007FFFFFF800000000000000000000000000007FFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
00000000000000FFFFFFF80000000000000000000000000000FFFFFFF800000000000000
000000000000007FFFFFF800000000000000000000000000007FFFFFF800000000000000
000000000000007FFFFFF800000000000000000000000000007FFFFFFC00000000000000
000000000000007FFFFFFC00000000000000000000000000007FFFFFFC00000000000000
000000000000007FFFFFFC00000000000000000000000000003FFFFFFC00000000000000
000000000000003FFFFFFC00000000000000000000000000003FFFFFFC00000000000000
000000000000003FFFFFFC00000000000000000000000000001FFFFFFE00000000000000
000000000000001FFFFFFE00000000000000000000000007F01FFFFFFE00000000000000
00000000000FF80FFFFFFE0000000000000000000000000FF80FFFFFFE00000000000000
00000000000FF80FFFFFFF0000000000000000000000000FF807FFFFFF00000000000000
00000000000FF807FFFFFF0000000000000000000000000FF807FFFFFF00000000000000
00000000000FF803FFFFFF8000000000000000000000001FF803FFFFFF80000000000000
00000000001FF001FFFFFF8000000000000000000000001FF001FFFFFFC0000000000000
00000000001FF000FFFFFFC000000000000000000000001FF000FFFFFFC0000000000000
00000000003FF0007FFFFFE000000000000000000000003FE0007FFFFFE0000000000000
00000000003FE0003FFFFFF000000000000000000000007FE0003FFFFFF0000000000000
00000000007FC0001FFFFFF80000000000000000000000FFC0000FFFFFF8000000000000
0000000000FFC0000FFFFFFC0000000000000000000001FF800007FFFFFE000000000000
0000000001FF800003FFFFFE0000000000000000000003FF000003FFFFFF000000000000
0000000007FF000001FFFFFF8000000000000000000007FE000000FFFFFFC00000000000
000000000FFC0000007FFFFFE00000000000000000001FFC0000003FFFFFF00000000000
000000003FF80000001FFFFFF80000000000000000007FF00000000FFFFFFC0000000000
00000000FFF000000007FFFFFE000000000000000001FFE000000003FFFFFF0000000000
00000003FFC000000001FFFFFF800000000000000007FF8000000000FFFFFFE000000000
0000000FFF00000000007FFFFFF0000000000000003FFE00000000003FFFFFFC00000000
0000007FFC00000000000FFFFFFF00000000000001FFF8000000000007FFFFFFC0000000
000007FFF0000000000001FFFFFFF000000000001FFFE0000000000000FFFFFFFE000000
00007FFF800000000000003FFFFFFFE000000003FFFF000000000000000FFFFFFFFE0000
003FFFFC0000000000000003FFFFFFFFF80007FFFFF80000000000000000FFFFFFFFFFFF
FFFFFFE000000000000000003FFFFFFFFFFFFFFFFF8000000000000000000FFFFFFFFFFF
FFFFFE00000000000000000001FFFFFFFFFFFFFFF8000000000000000000003FFFFFFFFF
FFFFC00000000000000000000007FFFFFFFFFFFF0000000000000000000000007FFFFFFF
FFF000000000000000000000000003FFFFFFFF000000000000000000000000000003FFFF
C0000000000000>141 146 115 271 168 I[<FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF800
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF800
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00
00000003FFFFFFC0000000003FFFFFFFFC0000000003FFFFFFC000000000007FFFFFFC00
00000003FFFFFFC000000000000FFFFFFC0000000003FFFFFFC0000000000001FFFFFE00
00000003FFFFFFC00000000000007FFFFE0000000003FFFFFFC00000000000001FFFFE00
00000003FFFFFFC00000000000000FFFFE0000000003FFFFFFC000000000000007FFFE00
00000003FFFFFFC000000000000001FFFE0000000003FFFFFFC000000000000000FFFE00
00000003FFFFFFC000000000000000FFFE0000000003FFFFFFC0000000000000007FFF00
00000003FFFFFFC0000000000000003FFF0000000003FFFFFFC0000000000000001FFF00
00000003FFFFFFC0000000000000001FFF0000000003FFFFFFC0000000000000000FFF00
00000003FFFFFFC0000000000000000FFF0000000003FFFFFFC00000000000000007FF00
00000003FFFFFFC00000000000000007FF0000000003FFFFFFC00000000000000003FF00
00000003FFFFFFC00000000000000003FF8000000003FFFFFFC00000000000000003FF80
00000003FFFFFFC00000000000000001FF8000000003FFFFFFC00000000000000001FF80
00000003FFFFFFC00000000000000001FF8000000003FFFFFFC00000000000000000FF80
00000003FFFFFFC00000000000000000FF8000000003FFFFFFC00000000000000000FF80
00000003FFFFFFC00000000000000000FFC000000003FFFFFFC00000000000000000FFC0
00000003FFFFFFC00000001FF00000007FC000000003FFFFFFC00000001FF00000007FC0
00000003FFFFFFC00000001FF00000007FC000000003FFFFFFC00000001FF00000007FC0
00000003FFFFFFC00000001FF00000007FC000000003FFFFFFC00000001FF00000007FC0
00000003FFFFFFC00000001FF00000003FE000000003FFFFFFC00000001FF00000003FE0
00000003FFFFFFC00000001FF00000003FE000000003FFFFFFC00000001FF00000003FE0
00000003FFFFFFC00000003FF0000000000000000003FFFFFFC00000003FF00000000000
00000003FFFFFFC00000003FF0000000000000000003FFFFFFC00000003FF00000000000
00000003FFFFFFC00000007FF0000000000000000003FFFFFFC00000007FF00000000000
00000003FFFFFFC0000000FFF0000000000000000003FFFFFFC0000000FFF00000000000
00000003FFFFFFC0000001FFF0000000000000000003FFFFFFC0000003FFF00000000000
00000003FFFFFFC0000007FFF0000000000000000003FFFFFFC000001FFFF00000000000
00000003FFFFFFC000007FFFF0000000000000000003FFFFFFC00007FFFFF00000000000
00000003FFFFFFFFFFFFFFFFF0000000000000000003FFFFFFFFFFFFFFFFF00000000000
00000003FFFFFFFFFFFFFFFFF0000000000000000003FFFFFFFFFFFFFFFFF00000000000
00000003FFFFFFFFFFFFFFFFF0000000000000000003FFFFFFFFFFFFFFFFF00000000000
00000003FFFFFFFFFFFFFFFFF0000000000000000003FFFFFFFFFFFFFFFFF00000000000
00000003FFFFFFFFFFFFFFFFF0000000000000000003FFFFFFC00007FFFFF00000000000
00000003FFFFFFC000007FFFF0000000000000000003FFFFFFC000001FFFF00000000000
00000003FFFFFFC0000007FFF0000000000000000003FFFFFFC0000003FFF00000000000
00000003FFFFFFC0000001FFF0000000000000000003FFFFFFC0000000FFF00000000000
00000003FFFFFFC0000000FFF0000000000000000003FFFFFFC00000007FF00000000000
00000003FFFFFFC00000007FF0000000000000000003FFFFFFC00000003FF00000000000
00000003FFFFFFC00000003FF0000000000000000003FFFFFFC00000003FF00000000000
00000003FFFFFFC00000003FF0000000007FC0000003FFFFFFC00000001FF0000000007F
C0000003FFFFFFC00000001FF0000000007FC0000003FFFFFFC00000001FF000000000FF
80000003FFFFFFC00000001FF000000000FF80000003FFFFFFC00000001FF000000000FF
80000003FFFFFFC00000001FF000000000FF80000003FFFFFFC00000001FF000000000FF
80000003FFFFFFC00000001FF000000000FF80000003FFFFFFC00000001FF000000001FF
00000003FFFFFFC00000001FF000000001FF00000003FFFFFFC0000000000000000001FF
00000003FFFFFFC0000000000000000001FF00000003FFFFFFC0000000000000000001FF
00000003FFFFFFC0000000000000000003FF00000003FFFFFFC0000000000000000003FF
00000003FFFFFFC0000000000000000003FE00000003FFFFFFC0000000000000000003FE
00000003FFFFFFC0000000000000000007FE00000003FFFFFFC0000000000000000007FE
00000003FFFFFFC0000000000000000007FE00000003FFFFFFC000000000000000000FFE
00000003FFFFFFC000000000000000000FFC00000003FFFFFFC000000000000000000FFC
00000003FFFFFFC000000000000000001FFC00000003FFFFFFC000000000000000001FFC
00000003FFFFFFC000000000000000003FFC00000003FFFFFFC000000000000000003FFC
00000003FFFFFFC000000000000000007FF800000003FFFFFFC000000000000000007FF8
00000003FFFFFFC00000000000000000FFF800000003FFFFFFC00000000000000000FFF8
00000003FFFFFFC00000000000000001FFF800000003FFFFFFC00000000000000003FFF8
00000003FFFFFFC00000000000000007FFF000000003FFFFFFC00000000000000007FFF0
00000003FFFFFFC0000000000000000FFFF000000003FFFFFFC0000000000000001FFFF0
00000003FFFFFFC0000000000000007FFFF000000003FFFFFFC000000000000000FFFFF0
00000003FFFFFFC000000000000001FFFFE000000003FFFFFFC000000000000007FFFFE0
00000003FFFFFFC00000000000001FFFFFE000000003FFFFFFC00000000000007FFFFFE0
00000003FFFFFFC0000000000003FFFFFFE000000003FFFFFFC000000000003FFFFFFFE0
00000003FFFFFFC0000000001FFFFFFFFFE000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80
00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80
00>138 141 120 268 153 69 D[<FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80FFFFFFFFFF
FFFFFFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF80FFFFFFFFFFFFFFFFFF
FFFFFFFFFFFF80FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFFFFFFFFF
FFFFC0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC0FF
FFFFFFFFFFFFFFFFFFFFFFFFFFFFC0000003FFFFFFC000000001FFFFFFFFC0000003FFFF
FFC00000000007FFFFFFC0000003FFFFFFC000000000007FFFFFC0000003FFFFFFC00000
0000001FFFFFE0000003FFFFFFC0000000000007FFFFE0000003FFFFFFC0000000000001
FFFFE0000003FFFFFFC00000000000007FFFE0000003FFFFFFC00000000000003FFFE000
0003FFFFFFC00000000000001FFFE0000003FFFFFFC00000000000000FFFE0000003FFFF
FFC000000000000007FFE0000003FFFFFFC000000000000003FFF0000003FFFFFFC00000
0000000003FFF0000003FFFFFFC000000000000001FFF0000003FFFFFFC0000000000000
00FFF0000003FFFFFFC000000000000000FFF0000003FFFFFFC0000000000000007FF000
0003FFFFFFC0000000000000007FF0000003FFFFFFC0000000000000007FF0000003FFFF
FFC0000000000000003FF0000003FFFFFFC0000000000000003FF8000003FFFFFFC00000
00000000001FF8000003FFFFFFC0000000000000001FF8000003FFFFFFC0000000000000
001FF8000003FFFFFFC0000000000000001FF8000003FFFFFFC0000000000000000FF800
0003FFFFFFC0000000000000000FF8000003FFFFFFC0000000000000000FF8000003FFFF
FFC0000000000000000FFC000003FFFFFFC00000000000000007FC000003FFFFFFC00000
000000000007FC000003FFFFFFC00000000000000007FC000003FFFFFFC0000000000000
0007FC000003FFFFFFC00000007FC0000007FC000003FFFFFFC00000007FC0000007FC00
0003FFFFFFC00000007FC0000007FC000003FFFFFFC00000007FC0000003FE000003FFFF
FFC00000007FC0000003FE000003FFFFFFC00000007FC0000003FE000003FFFFFFC00000
007FC0000003FE000003FFFFFFC00000007FC000000000000003FFFFFFC00000007FC000
000000000003FFFFFFC00000007FC000000000000003FFFFFFC0000000FFC00000000000
0003FFFFFFC0000000FFC000000000000003FFFFFFC0000000FFC000000000000003FFFF
FFC0000000FFC000000000000003FFFFFFC0000001FFC000000000000003FFFFFFC00000
01FFC000000000000003FFFFFFC0000003FFC000000000000003FFFFFFC0000003FFC000
000000000003FFFFFFC0000007FFC000000000000003FFFFFFC000000FFFC00000000000
0003FFFFFFC000001FFFC000000000000003FFFFFFC000007FFFC000000000000003FFFF
FFC00001FFFFC000000000000003FFFFFFC0001FFFFFC000000000000003FFFFFFFFFFFF
FFFFC000000000000003FFFFFFFFFFFFFFFFC000000000000003FFFFFFFFFFFFFFFFC000
000000000003FFFFFFFFFFFFFFFFC000000000000003FFFFFFFFFFFFFFFFC00000000000
0003FFFFFFFFFFFFFFFFC000000000000003FFFFFFFFFFFFFFFFC000000000000003FFFF
FFFFFFFFFFFFC000000000000003FFFFFFFFFFFFFFFFC000000000000003FFFFFFC0001F
FFFFC000000000000003FFFFFFC00001FFFFC000000000000003FFFFFFC000007FFFC000
000000000003FFFFFFC000001FFFC000000000000003FFFFFFC000000FFFC00000000000
0003FFFFFFC0000007FFC000000000000003FFFFFFC0000003FFC000000000000003FFFF
FFC0000003FFC000000000000003FFFFFFC0000001FFC000000000000003FFFFFFC00000
01FFC000000000000003FFFFFFC0000000FFC000000000000003FFFFFFC0000000FFC000
000000000003FFFFFFC0000000FFC000000000000003FFFFFFC0000000FFC00000000000
0003FFFFFFC00000007FC000000000000003FFFFFFC00000007FC000000000000003FFFF
FFC00000007FC000000000000003FFFFFFC00000007FC000000000000003FFFFFFC00000
007FC000000000000003FFFFFFC00000007FC000000000000003FFFFFFC00000007FC000
000000000003FFFFFFC00000007FC000000000000003FFFFFFC00000007FC00000000000
0003FFFFFFC00000007FC000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FF
FFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFF
FFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFF
F8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000
000000>127 141 120 268 146 I[<FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FF
FFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFF
FFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001
FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE00000
00000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFF
FFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE000000000
0001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0000000000001FFFFFFE0
000000000001FFFFFFE0000000FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFF
FFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFF
C0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFC0>74
142 122 269 87 73 D[<FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFF
F8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000
000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FF
FFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFFFFFFFFFFF8000000000000FFFFFFFFFF
FFFFFFFFF8000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000000000
0003FFFFFFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFF
FFC0000000000000000000000003FFFFFFC0000000000000000000000003FFFFFFC00000
00000000000000000003FFFFFFC0000000000000000000000003FFFFFFC0000000000000
000000000003FFFFFFC0000000000000000000000003FFFFFFC000000000000000FF8000
0003FFFFFFC000000000000000FF80000003FFFFFFC000000000000000FF80000003FFFF
FFC000000000000000FF80000003FFFFFFC000000000000001FF80000003FFFFFFC00000
0000000001FF00000003FFFFFFC000000000000001FF00000003FFFFFFC0000000000000
01FF00000003FFFFFFC000000000000001FF00000003FFFFFFC000000000000001FF0000
0003FFFFFFC000000000000001FF00000003FFFFFFC000000000000003FF00000003FFFF
FFC000000000000003FF00000003FFFFFFC000000000000003FF00000003FFFFFFC00000
0000000003FE00000003FFFFFFC000000000000003FE00000003FFFFFFC0000000000000
07FE00000003FFFFFFC000000000000007FE00000003FFFFFFC000000000000007FE0000
0003FFFFFFC000000000000007FE00000003FFFFFFC00000000000000FFE00000003FFFF
FFC00000000000000FFE00000003FFFFFFC00000000000000FFE00000003FFFFFFC00000
000000001FFC00000003FFFFFFC00000000000001FFC00000003FFFFFFC0000000000000
3FFC00000003FFFFFFC00000000000003FFC00000003FFFFFFC00000000000007FFC0000
0003FFFFFFC00000000000007FFC00000003FFFFFFC0000000000000FFFC00000003FFFF
FFC0000000000000FFFC00000003FFFFFFC0000000000001FFFC00000003FFFFFFC00000
00000003FFFC00000003FFFFFFC0000000000003FFF800000003FFFFFFC0000000000007
FFF800000003FFFFFFC000000000000FFFF800000003FFFFFFC000000000001FFFF80000
0003FFFFFFC000000000003FFFF800000003FFFFFFC000000000007FFFF800000003FFFF
FFC00000000001FFFFF800000003FFFFFFC00000000003FFFFF800000003FFFFFFC00000
000007FFFFF800000003FFFFFFC0000000001FFFFFF000000003FFFFFFC0000000007FFF
FFF000000003FFFFFFC000000003FFFFFFF000000003FFFFFFC00000001FFFFFFFF00000
0003FFFFFFC0000003FFFFFFFFF000FFFFFFFFFFFFFFFFFFFFFFFFFFFFF000FFFFFFFFFF
FFFFFFFFFFFFFFFFFFF000FFFFFFFFFFFFFFFFFFFFFFFFFFFFF000FFFFFFFFFFFFFFFFFF
FFFFFFFFFFF000FFFFFFFFFFFFFFFFFFFFFFFFFFFFE000FFFFFFFFFFFFFFFFFFFFFFFFFF
FFE000FFFFFFFFFFFFFFFFFFFFFFFFFFFFE000FFFFFFFFFFFFFFFFFFFFFFFFFFFFE000FF
FFFFFFFFFFFFFFFFFFFFFFFFFFE000>121 142 120 269 140 76
D[<FFFFFFFFFFFFC00000000000000000000000007FFFFFFFFFFFE0FFFFFFFFFFFFE000
0000000000000000000000FFFFFFFFFFFFE0FFFFFFFFFFFFF00000000000000000000000
01FFFFFFFFFFFFE0FFFFFFFFFFFFF8000000000000000000000003FFFFFFFFFFFFE0FFFF
FFFFFFFFF8000000000000000000000003FFFFFFFFFFFFE0FFFFFFFFFFFFF80000000000
00000000000003FFFFFFFFFFFFE0FFFFFFFFFFFFFC000000000000000000000007FFFFFF
FFFFFFE0FFFFFFFFFFFFFC000000000000000000000007FFFFFFFFFFFFE0FFFFFFFFFFFF
FE00000000000000000000000FFFFFFFFFFFFFE0000003FFFFFFFE000000000000000000
00000FFFFFFFF8000000000003FFFFFFFF00000000000000000000001FEFFFFFF8000000
000003FFFFFFFF00000000000000000000001FEFFFFFF8000000000003FF7FFFFF800000
00000000000000003FCFFFFFF8000000000003FF7FFFFF80000000000000000000003FCF
FFFFF8000000000003FF7FFFFF80000000000000000000003FCFFFFFF8000000000003FF
3FFFFFC0000000000000000000007F8FFFFFF8000000000003FF3FFFFFC0000000000000
000000007F8FFFFFF8000000000003FF1FFFFFE000000000000000000000FF0FFFFFF800
0000000003FF1FFFFFE000000000000000000000FF0FFFFFF8000000000003FF0FFFFFF0
00000000000000000001FE0FFFFFF8000000000003FF0FFFFFF000000000000000000001
FE0FFFFFF8000000000003FF0FFFFFF000000000000000000001FE0FFFFFF80000000000
03FF07FFFFF800000000000000000003FC0FFFFFF8000000000003FF07FFFFF800000000
000000000003FC0FFFFFF8000000000003FF03FFFFFC00000000000000000007F80FFFFF
F8000000000003FF03FFFFFC00000000000000000007F80FFFFFF8000000000003FF01FF
FFFE0000000000000000000FF00FFFFFF8000000000003FF01FFFFFE0000000000000000
000FF00FFFFFF8000000000003FF00FFFFFF0000000000000000001FE00FFFFFF8000000
000003FF00FFFFFF0000000000000000001FE00FFFFFF8000000000003FF00FFFFFF0000
000000000000001FE00FFFFFF8000000000003FF007FFFFF8000000000000000003FC00F
FFFFF8000000000003FF007FFFFF8000000000000000003FC00FFFFFF8000000000003FF
003FFFFFC000000000000000007F800FFFFFF8000000000003FF003FFFFFC00000000000
0000007F800FFFFFF8000000000003FF001FFFFFE00000000000000000FF000FFFFFF800
0000000003FF001FFFFFE00000000000000000FF000FFFFFF8000000000003FF000FFFFF
F00000000000000001FE000FFFFFF8000000000003FF000FFFFFF00000000000000001FE
000FFFFFF8000000000003FF000FFFFFF00000000000000001FE000FFFFFF80000000000
03FF0007FFFFF80000000000000003FC000FFFFFF8000000000003FF0007FFFFF8000000
0000000003FC000FFFFFF8000000000003FF0003FFFFFC0000000000000007F8000FFFFF
F8000000000003FF0003FFFFFC0000000000000007F8000FFFFFF8000000000003FF0001
FFFFFE000000000000000FF0000FFFFFF8000000000003FF0001FFFFFE00000000000000
0FF0000FFFFFF8000000000003FF0001FFFFFE000000000000000FF0000FFFFFF8000000
000003FF0000FFFFFF000000000000001FE0000FFFFFF8000000000003FF0000FFFFFF00
0000000000001FE0000FFFFFF8000000000003FF00007FFFFF800000000000003FC0000F
FFFFF8000000000003FF00007FFFFF800000000000003FC0000FFFFFF8000000000003FF
00003FFFFFC00000000000007F80000FFFFFF8000000000003FF00003FFFFFC000000000
00007F80000FFFFFF8000000000003FF00001FFFFFE0000000000000FF00000FFFFFF800
0000000003FF00001FFFFFE0000000000000FF00000FFFFFF8000000000003FF00001FFF
FFE0000000000000FF00000FFFFFF8000000000003FF00000FFFFFF0000000000001FE00
000FFFFFF8000000000003FF00000FFFFFF0000000000001FE00000FFFFFF80000000000
03FF000007FFFFF8000000000003FC00000FFFFFF8000000000003FF000007FFFFF80000
00000003FC00000FFFFFF8000000000003FF000003FFFFFC000000000007F800000FFFFF
F8000000000003FF000003FFFFFC000000000007F800000FFFFFF8000000000003FF0000
01FFFFFE00000000000FF000000FFFFFF8000000000003FF000001FFFFFE00000000000F
F000000FFFFFF8000000000003FF000001FFFFFE00000000000FF000000FFFFFF8000000
000003FF000000FFFFFF00000000001FE000000FFFFFF8000000000003FF000000FFFFFF
00000000001FE000000FFFFFF8000000000003FF0000007FFFFF80000000003FC000000F
FFFFF8000000000003FF0000007FFFFF80000000003FC000000FFFFFF8000000000003FF
0000003FFFFFC0000000007F8000000FFFFFF8000000000003FF0000003FFFFFC0000000
007F8000000FFFFFF8000000000003FF0000003FFFFFC0000000007F8000000FFFFFF800
0000000003FF0000001FFFFFE000000000FF0000000FFFFFF8000000000003FF0000001F
FFFFE000000000FF0000000FFFFFF8000000000003FF0000000FFFFFF000000001FE0000
000FFFFFF8000000000003FF0000000FFFFFF000000001FE0000000FFFFFF80000000000
03FF00000007FFFFF800000003FC0000000FFFFFF8000000000003FF00000007FFFFF800
000003FC0000000FFFFFF8000000000003FF00000003FFFFFC00000007F80000000FFFFF
F8000000000003FF00000003FFFFFC00000007F80000000FFFFFF8000000000003FF0000
0003FFFFFC00000007F80000000FFFFFF8000000000003FF00000001FFFFFE0000000FF0
0000000FFFFFF8000000000003FF00000001FFFFFE0000000FF00000000FFFFFF8000000
000003FF00000000FFFFFF0000001FE00000000FFFFFF8000000000003FF00000000FFFF
FF0000001FE00000000FFFFFF8000000000003FF000000007FFFFF8000003FC00000000F
FFFFF8000000000003FF000000007FFFFF8000003FC00000000FFFFFF8000000000003FF
000000003FFFFFC000007F800000000FFFFFF8000000000003FF000000003FFFFFC00000
7F800000000FFFFFF8000000000003FF000000003FFFFFC000007F800000000FFFFFF800
0000000003FF000000001FFFFFE00000FF000000000FFFFFF8000000000003FF00000000
1FFFFFE00000FF000000000FFFFFF8000000000003FF000000000FFFFFF00001FE000000
000FFFFFF8000000000003FF000000000FFFFFF00001FE000000000FFFFFF80000000000
03FF0000000007FFFFF80003FC000000000FFFFFF8000000000003FF0000000007FFFFF8
0003FC000000000FFFFFF8000000000003FF0000000007FFFFF80003FC000000000FFFFF
F8000000000003FF0000000003FFFFFC0007F8000000000FFFFFF8000000000003FF0000
000003FFFFFC0007F8000000000FFFFFF8000000000003FF0000000001FFFFFE000FF000
0000000FFFFFF8000000000003FF0000000001FFFFFE000FF0000000000FFFFFF8000000
000003FF0000000000FFFFFF001FE0000000000FFFFFF8000000000003FF0000000000FF
FFFF001FE0000000000FFFFFF8000000000003FF00000000007FFFFF803FC0000000000F
FFFFF8000000000003FF00000000007FFFFF803FC0000000000FFFFFF8000000000003FF
00000000007FFFFF803FC0000000000FFFFFF8000000000003FF00000000003FFFFFC07F
80000000000FFFFFF8000000000003FF00000000003FFFFFC07F80000000000FFFFFF800
0000000003FF00000000001FFFFFE0FF00000000000FFFFFF8000000000003FF00000000
001FFFFFE0FF00000000000FFFFFF8000000000003FF00000000000FFFFFF1FE00000000
000FFFFFF8000000000003FF00000000000FFFFFF1FE00000000000FFFFFF80000000000
03FF000000000007FFFFFBFC00000000000FFFFFF8000000000003FF000000000007FFFF
FBFC00000000000FFFFFF8000000000003FF000000000007FFFFFBFC00000000000FFFFF
F8000000000003FF000000000003FFFFFFF800000000000FFFFFF8000000000003FF0000
00000003FFFFFFF800000000000FFFFFF8000000000003FF000000000001FFFFFFF00000
0000000FFFFFF8000000000003FF000000000001FFFFFFF000000000000FFFFFF8000000
000003FF000000000000FFFFFFE000000000000FFFFFF8000000000003FF000000000000
FFFFFFE000000000000FFFFFF8000000000003FF000000000000FFFFFFE000000000000F
FFFFF8000000000003FF0000000000007FFFFFC000000000000FFFFFF8000000000003FF
0000000000007FFFFFC000000000000FFFFFF8000000000003FF0000000000003FFFFF80
00000000000FFFFFF8000000000003FF0000000000003FFFFF8000000000000FFFFFF800
0000000003FF0000000000001FFFFF0000000000000FFFFFF8000000000003FF00000000
00001FFFFF0000000000000FFFFFF8000000000003FF0000000000000FFFFE0000000000
000FFFFFF8000000000003FF0000000000000FFFFE0000000000000FFFFFF80000000000
03FF0000000000000FFFFE0000000000000FFFFFF8000000000007FF80000000000007FF
FC0000000000000FFFFFF80000000001FFFFFE000000000007FFFC0000000000000FFFFF
F8000000FFFFFFFFFFFFFC00000003FFF800000003FFFFFFFFFFFFFFFFE0FFFFFFFFFFFF
FC00000003FFF800000003FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFC00000001FFF0000000
03FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFC00000001FFF000000003FFFFFFFFFFFFFFFFE0
FFFFFFFFFFFFFC00000000FFE000000003FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFC000000
00FFE000000003FFFFFFFFFFFFFFFFE0FFFFFFFFFFFFFC00000000FFE000000003FFFFFF
FFFFFFFFFFE0FFFFFFFFFFFFFC000000007FC000000003FFFFFFFFFFFFFFFFE0FFFFFFFF
FFFFFC000000001F0000000003FFFFFFFFFFFFFFFFE0>203 142
120 269 220 I[<000000000FFFF8000000003E0000000001FFFFFFE00000003F000000
001FFFFFFFFE0000007F000000007FFFFFFFFFC00000FF00000003FFFFFFFFFFF00001FF
0000000FFFFFFFFFFFFC0003FF0000001FFFFFFFFFFFFF0007FF0000007FFFFFFFFFFFFF
C00FFF000000FFFFFE000FFFFFF01FFF000003FFFFC000007FFFF83FFF000007FFFF0000
0007FFFC7FFF00000FFFFC00000000FFFFFFFF00001FFFF0000000003FFFFFFF00003FFF
E0000000000FFFFFFF00007FFF800000000007FFFFFF0000FFFF800000000001FFFFFF00
00FFFF000000000000FFFFFF0001FFFE0000000000007FFFFF0003FFFC0000000000001F
FFFF0003FFFC0000000000000FFFFF0007FFF800000000000007FFFF0007FFF800000000
000007FFFF000FFFF000000000000003FFFF000FFFF000000000000001FFFF001FFFF000
000000000000FFFF001FFFF000000000000000FFFF003FFFE0000000000000007FFF003F
FFE0000000000000003FFF003FFFE0000000000000003FFF007FFFE0000000000000001F
FF007FFFE0000000000000001FFF007FFFE0000000000000001FFF007FFFE00000000000
00000FFF007FFFE0000000000000000FFF00FFFFE00000000000000007FF00FFFFF00000
000000000007FF00FFFFF00000000000000007FF00FFFFF00000000000000007FF00FFFF
F80000000000000003FF00FFFFF80000000000000003FF00FFFFFC0000000000000003FF
00FFFFFC0000000000000003FF00FFFFFE0000000000000001FF00FFFFFF000000000000
0001FF00FFFFFF0000000000000001FF00FFFFFF8000000000000001FF00FFFFFFC00000
0000000001FF00FFFFFFF000000000000000FE007FFFFFF80000000000000000007FFFFF
FE0000000000000000007FFFFFFF0000000000000000007FFFFFFFE00000000000000000
3FFFFFFFFE00000000000000003FFFFFFFFFE0000000000000003FFFFFFFFFFF00000000
0000001FFFFFFFFFFFF00000000000001FFFFFFFFFFFFF8000000000000FFFFFFFFFFFFF
F800000000000FFFFFFFFFFFFFFFC00000000007FFFFFFFFFFFFFFFC0000000007FFFFFF
FFFFFFFFFF8000000003FFFFFFFFFFFFFFFFE000000003FFFFFFFFFFFFFFFFF800000001
FFFFFFFFFFFFFFFFFE00000000FFFFFFFFFFFFFFFFFF800000007FFFFFFFFFFFFFFFFFE0
0000007FFFFFFFFFFFFFFFFFF00000003FFFFFFFFFFFFFFFFFF80000001FFFFFFFFFFFFF
FFFFFC0000000FFFFFFFFFFFFFFFFFFF00000007FFFFFFFFFFFFFFFFFF80000003FFFFFF
FFFFFFFFFFFFC0000000FFFFFFFFFFFFFFFFFFE00000007FFFFFFFFFFFFFFFFFE0000000
3FFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFFFF800000003FFFFFFFFFFFFFFFFFC
00000000FFFFFFFFFFFFFFFFFE000000003FFFFFFFFFFFFFFFFE000000000FFFFFFFFFFF
FFFFFF0000000001FFFFFFFFFFFFFFFF00000000001FFFFFFFFFFFFFFF800000000001FF
FFFFFFFFFFFF8000000000000FFFFFFFFFFFFFC00000000000007FFFFFFFFFFFC0000000
00000007FFFFFFFFFFE0000000000000003FFFFFFFFFE00000000000000003FFFFFFFFF0
00000000000000003FFFFFFFF000000000000000000FFFFFFFF0000000000000000003FF
FFFFF8000000000000000000FFFFFFF80000000000000000007FFFFFF800000000000000
00001FFFFFF80000000000000000000FFFFFF800000000000000000007FFFFFC00000000
000000000007FFFFFC00000000000000000003FFFFFC7F000000000000000001FFFFFCFF
800000000000000000FFFFFCFF800000000000000000FFFFFCFF8000000000000000007F
FFFCFF8000000000000000007FFFFCFF8000000000000000007FFFFCFF80000000000000
00003FFFFCFF8000000000000000003FFFFCFF8000000000000000003FFFFCFFC0000000
00000000001FFFFCFFC000000000000000001FFFFCFFC000000000000000001FFFFCFFC0
00000000000000001FFFF8FFE000000000000000001FFFF8FFE000000000000000001FFF
F8FFE000000000000000001FFFF8FFF000000000000000001FFFF8FFF000000000000000
001FFFF0FFF000000000000000001FFFF0FFF800000000000000003FFFF0FFFC00000000
000000003FFFE0FFFC00000000000000003FFFE0FFFE00000000000000003FFFE0FFFF00
000000000000007FFFC0FFFF00000000000000007FFFC0FFFF80000000000000007FFF80
FFFFC000000000000000FFFF80FFFFE000000000000000FFFF00FFFFF800000000000001
FFFF00FFFFFC00000000000003FFFE00FFFFFE00000000000003FFFC00FFFFFF80000000
000007FFFC00FFFFFFE000000000000FFFF800FFFFFFF800000000001FFFF000FFFFFFFE
00000000007FFFE000FFFFFFFFC000000000FFFFC000FFFFFFFFF800000003FFFF8000FF
FE7FFFFF8000001FFFFF0000FFFC1FFFFFFF0001FFFFFE0000FFF807FFFFFFFFFFFFFFFC
0000FFF003FFFFFFFFFFFFFFF00000FFE000FFFFFFFFFFFFFFE00000FFC0001FFFFFFFFF
FFFF800000FF800007FFFFFFFFFFFE000000FF000000FFFFFFFFFFF8000000FE0000001F
FFFFFFFFC0000000FC00000000FFFFFFFC000000007C0000000001FFFF8000000000>
102 146 115 271 129 83 D[<0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000FFFFFFF
FFFFFFFFFFFFFFFFFFFFFFFFFFF8000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000FFF
FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF800
0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
FC001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC001FFFFFFFFFFFFFFFFFFFFFFFFFFFFF
FFFFFC001FFFFFFFC000001FFFFFFE000001FFFFFFFC001FFFFFF80000001FFFFFFE0000
000FFFFFFC001FFFFFC00000001FFFFFFE00000001FFFFFC001FFFFF000000001FFFFFFE
000000007FFFFC001FFFFC000000001FFFFFFE000000001FFFFC001FFFF8000000001FFF
FFFE0000000007FFFC001FFFE0000000001FFFFFFE0000000003FFFC001FFFC000000000
1FFFFFFE0000000001FFFC001FFF80000000001FFFFFFE0000000000FFFC003FFF000000
00001FFFFFFE00000000007FFE003FFF00000000001FFFFFFE00000000007FFE003FFE00
000000001FFFFFFE00000000003FFE003FFC00000000001FFFFFFE00000000001FFE003F
FC00000000001FFFFFFE00000000001FFE003FFC00000000001FFFFFFE00000000001FFE
003FF800000000001FFFFFFE00000000000FFE003FF800000000001FFFFFFE0000000000
0FFE003FF000000000001FFFFFFE000000000007FE003FF000000000001FFFFFFE000000
000007FE003FF000000000001FFFFFFE000000000007FE003FF000000000001FFFFFFE00
0000000007FE003FE000000000001FFFFFFE000000000003FE007FE000000000001FFFFF
FE000000000003FF007FE000000000001FFFFFFE000000000003FF007FE000000000001F
FFFFFE000000000003FF007FE000000000001FFFFFFE000000000003FF007FC000000000
001FFFFFFE000000000001FF007FC000000000001FFFFFFE000000000001FF007FC00000
0000001FFFFFFE000000000001FF007FC000000000001FFFFFFE000000000001FF007FC0
00000000001FFFFFFE000000000001FF007FC000000000001FFFFFFE000000000001FF00
7FC000000000001FFFFFFE000000000001FF007FC000000000001FFFFFFE000000000001
FF00FF8000000000001FFFFFFE000000000000FF80FF8000000000001FFFFFFE00000000
0000FF80FF8000000000001FFFFFFE000000000000FF80FF8000000000001FFFFFFE0000
00000000FF80FF8000000000001FFFFFFE000000000000FF80FF8000000000001FFFFFFE
000000000000FF80000000000000001FFFFFFE0000000000000000000000000000001FFF
FFFE0000000000000000000000000000001FFFFFFE000000000000000000000000000000
1FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000000000000000
00001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000000000000000
000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000000000
0000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000
00000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000
000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000
0000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00
00000000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFF
FE0000000000000000000000000000001FFFFFFE0000000000000000000000000000001F
FFFFFE0000000000000000000000000000001FFFFFFE0000000000000000000000000000
001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000000000000000
0000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000000000
00000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000000000
000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000
0000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000
00000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000
000000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE
0000000000000000000000000000001FFFFFFE0000000000000000000000000000001FFF
FFFE0000000000000000000000000000001FFFFFFE000000000000000000000000000000
1FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000000000000000
00001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000000000000000
000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000000000
0000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000
00000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000
000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000
0000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00
00000000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFF
FE0000000000000000000000000000001FFFFFFE0000000000000000000000000000001F
FFFFFE0000000000000000000000000000001FFFFFFE0000000000000000000000000000
001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000000000000000
0000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000000000
00000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000000000
000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000
0000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE00000000
00000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE0000
000000000000000000000000001FFFFFFE0000000000000000000000000000001FFFFFFE
0000000000000000000000000000001FFFFFFE0000000000000000000000000000001FFF
FFFE0000000000000000000000000000001FFFFFFE000000000000000000000000000000
1FFFFFFE0000000000000000000000000000001FFFFFFE00000000000000000000000000
00001FFFFFFE0000000000000000000000000000001FFFFFFE0000000000000000000000
000000001FFFFFFE0000000000000000000000000000001FFFFFFE000000000000000000
0000000000001FFFFFFE00000000000000000000000FFFFFFFFFFFFFFFFFFFFFFC000000
000000000FFFFFFFFFFFFFFFFFFFFFFC000000000000000FFFFFFFFFFFFFFFFFFFFFFC00
0000000000000FFFFFFFFFFFFFFFFFFFFFFC000000000000000FFFFFFFFFFFFFFFFFFFFF
FC000000000000000FFFFFFFFFFFFFFFFFFFFFFC000000000000000FFFFFFFFFFFFFFFFF
FFFFFC000000000000000FFFFFFFFFFFFFFFFFFFFFFC000000000000000FFFFFFFFFFFFF
FFFFFFFFFC00000000>145 140 120 267 162 I<00000000FFFFFC0000000000000000
00007FFFFFFFF0000000000000000007FFFFFFFFFF00000000000000003FFFFFFFFFFFE0
00000000000000FFFFFFFFFFFFF800000000000001FFFFFFFFFFFFFE00000000000007FF
FFFFFFFFFFFF8000000000000FFFFFC0007FFFFFE000000000001FFFE000000FFFFFF000
000000003FFFF0000003FFFFF800000000007FFFF8000000FFFFFE00000000007FFFFC00
00007FFFFF0000000000FFFFFC0000003FFFFF8000000000FFFFFE0000001FFFFFC00000
0000FFFFFE0000000FFFFFC000000001FFFFFF00000007FFFFE000000001FFFFFF000000
03FFFFF000000001FFFFFF00000003FFFFF000000001FFFFFF00000001FFFFF800000001
FFFFFF00000001FFFFF800000001FFFFFF00000001FFFFFC00000001FFFFFF00000000FF
FFFC00000001FFFFFF00000000FFFFFE00000000FFFFFE00000000FFFFFE00000000FFFF
FE00000000FFFFFE000000007FFFFC000000007FFFFE000000007FFFFC000000007FFFFF
000000003FFFF8000000007FFFFF000000001FFFF0000000007FFFFF0000000007FFC000
0000007FFFFF0000000001FF00000000007FFFFF00000000000000000000007FFFFF0000
0000000000000000007FFFFF00000000000000000000007FFFFF00000000000000000000
007FFFFF00000000000000000000007FFFFF00000000000000000000007FFFFF00000000
000000000000007FFFFF00000000000000000000007FFFFF00000000000000000000007F
FFFF00000000000000000003FFFFFFFF00000000000000000FFFFFFFFFFF000000000000
0003FFFFFFFFFFFF000000000000007FFFFFFFFFFFFF00000000000007FFFFFFFFFFFFFF
0000000000003FFFFFFFFFFFFFFF000000000001FFFFFFFF807FFFFF00000000000FFFFF
FFE0007FFFFF00000000003FFFFFFC00007FFFFF0000000000FFFFFFE000007FFFFF0000
000003FFFFFF0000007FFFFF0000000007FFFFFC0000007FFFFF000000001FFFFFF00000
007FFFFF000000003FFFFFC00000007FFFFF000000007FFFFF800000007FFFFF00000000
FFFFFE000000007FFFFF00000001FFFFFC000000007FFFFF00000003FFFFF8000000007F
FFFF00000007FFFFF0000000007FFFFF0000000FFFFFE0000000007FFFFF0000001FFFFF
E0000000007FFFFF0000001FFFFFC0000000007FFFFF0000003FFFFF80000000007FFFFF
0000003FFFFF80000000007FFFFF0000007FFFFF00000000007FFFFF0000007FFFFF0000
0000007FFFFF0000007FFFFF00000000007FFFFF000000FFFFFF00000000007FFFFF0000
00FFFFFE00000000007FFFFF000000FFFFFE00000000007FFFFF000000FFFFFE00000000
007FFFFF000000FFFFFE0000000000FFFFFF000000FFFFFE0000000000FFFFFF000000FF
FFFE0000000000FFFFFF000000FFFFFE0000000000FFFFFF000000FFFFFE0000000001FF
FFFF000000FFFFFF0000000001FFFFFF0000007FFFFF0000000003FFFFFF0000007FFFFF
0000000007EFFFFF0000003FFFFF800000000FEFFFFF0000003FFFFFC00000000FCFFFFF
0000001FFFFFC00000003FCFFFFF0000001FFFFFE00000007F8FFFFF8000000FFFFFF000
0000FF0FFFFFE0000007FFFFFC000003FE0FFFFFFE000003FFFFFE00000FFC07FFFFFFFF
0001FFFFFF80003FF807FFFFFFFF8000FFFFFFF803FFF003FFFFFFFF80003FFFFFFFFFFF
E001FFFFFFFF80000FFFFFFFFFFF8000FFFFFFFF800003FFFFFFFFFF00007FFFFFFF8000
00FFFFFFFFFC00001FFFFFFF8000001FFFFFFFF0000007FFFFFF80000001FFFFFF800000
007FFFFF0000000007FFF80000000000000000695F79DD71>97 D[<0000001FF0000000
00000000000000007FFFFFF000000000000000000000FFFFFFFFF0000000000000000000
00FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000000000FFFFFFFFF0
00000000000000000000FFFFFFFFF000000000000000000000FFFFFFFFF0000000000000
00000000FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000000000FFFF
FFFFF000000000000000000000003FFFFFF0000000000000000000000007FFFFF0000000
000000000000000007FFFFF0000000000000000000000003FFFFF0000000000000000000
000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0
000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000000000
000000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003
FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000
000000000000000003FFFFF0000000000000000000000003FFFFF0000000000000000000
000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0
000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000000000
000000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003
FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000
000000000000000003FFFFF0000000000000000000000003FFFFF0000000000000000000
000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0
000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000000000
000000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003
FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF0000000
000000000000000003FFFFF0000000000000000000000003FFFFF000003FFFC000000000
000003FFFFF00007FFFFFE00000000000003FFFFF0003FFFFFFFE0000000000003FFFFF0
01FFFFFFFFF8000000000003FFFFF007FFFFFFFFFF000000000003FFFFF01FFFFFFFFFFF
C00000000003FFFFF07FFFFFFFFFFFF00000000003FFFFF0FFFFC00FFFFFF80000000003
FFFFF3FFFC0000FFFFFE0000000003FFFFF7FFE000003FFFFF0000000003FFFFFFFF8000
000FFFFF8000000003FFFFFFFE00000007FFFFE000000003FFFFFFF800000001FFFFF000
000003FFFFFFF000000000FFFFF800000003FFFFFFE0000000007FFFFC00000003FFFFFF
80000000003FFFFC00000003FFFFFF00000000003FFFFE00000003FFFFFE00000000001F
FFFF00000003FFFFFC00000000000FFFFF80000003FFFFFC00000000000FFFFF80000003
FFFFF8000000000007FFFFC0000003FFFFF8000000000007FFFFE0000003FFFFF8000000
000007FFFFE0000003FFFFF8000000000003FFFFF0000003FFFFF8000000000003FFFFF0
000003FFFFF8000000000003FFFFF8000003FFFFF8000000000001FFFFF8000003FFFFF8
000000000001FFFFF8000003FFFFF8000000000001FFFFFC000003FFFFF8000000000001
FFFFFC000003FFFFF8000000000001FFFFFE000003FFFFF8000000000001FFFFFE000003
FFFFF8000000000001FFFFFE000003FFFFF8000000000000FFFFFE000003FFFFF8000000
000000FFFFFF000003FFFFF8000000000000FFFFFF000003FFFFF8000000000000FFFFFF
000003FFFFF8000000000000FFFFFF000003FFFFF8000000000000FFFFFF000003FFFFF8
000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000
FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003
FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000
000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF
800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8
000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000
FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF000003
FFFFF8000000000000FFFFFF000003FFFFF8000000000000FFFFFF000003FFFFF8000000
000000FFFFFF000003FFFFF8000000000000FFFFFF000003FFFFF8000000000000FFFFFE
000003FFFFF8000000000001FFFFFE000003FFFFF8000000000001FFFFFE000003FFFFF8
000000000001FFFFFC000003FFFFF8000000000001FFFFFC000003FFFFF8000000000001
FFFFFC000003FFFFF8000000000001FFFFF8000003FFFFF8000000000003FFFFF8000003
FFFFF8000000000003FFFFF0000003FFFFF8000000000003FFFFF0000003FFFFF8000000
000007FFFFE0000003FFFFF8000000000007FFFFE0000003FFFFF8000000000007FFFFC0
000003FFFFF800000000000FFFFFC0000003FFFFFC00000000000FFFFF80000003FFFFFE
00000000001FFFFF00000003FFFFFF00000000003FFFFE00000003FFFFFF00000000003F
FFFE00000003FFFFFF80000000007FFFFC00000003FFFFFFC000000000FFFFF800000003
FFFFFFF000000001FFFFF000000003FFFFBFF800000003FFFFE000000003FFFF1FFC0000
000FFFFFC000000003FFFE0FFF0000001FFFFF0000000003FFFE07FFC000007FFFFE0000
000003FFFC03FFF00003FFFFFC0000000003FFF800FFFF003FFFFFF00000000003FFF000
7FFFFFFFFFFFC00000000003FFE0001FFFFFFFFFFF000000000003FFC0000FFFFFFFFFFC
000000000003FF800003FFFFFFFFF0000000000003FF0000007FFFFFFF80000000000003
FE0000000FFFFFF8000000000000000000000000FFFE000000000000>113
144 121 270 129 I<00000000007FFFF0000000000000001FFFFFFFE0000000000000FF
FFFFFFFE000000000007FFFFFFFFFF80000000001FFFFFFFFFFFF000000000FFFFFFFFFF
FFF800000001FFFFFFFFFFFFFE00000007FFFFFFFFFFFFFF0000001FFFFFF8000FFFFF80
00003FFFFF800000FFFFC000007FFFFE000001FFFFE00001FFFFF8000003FFFFE00003FF
FFF0000003FFFFF00007FFFFE0000007FFFFF0000FFFFFC0000007FFFFF0001FFFFF8000
000FFFFFF8003FFFFF0000000FFFFFF8003FFFFE0000000FFFFFF8007FFFFC0000000FFF
FFF800FFFFFC0000000FFFFFF800FFFFF80000000FFFFFF801FFFFF80000000FFFFFF803
FFFFF00000000FFFFFF803FFFFF000000007FFFFF007FFFFF000000007FFFFF007FFFFE0
00000003FFFFE00FFFFFE000000003FFFFE00FFFFFE000000001FFFFC01FFFFFE0000000
00FFFF801FFFFFC0000000003FFE001FFFFFC0000000000FF8003FFFFFC0000000000000
003FFFFFC0000000000000003FFFFFC0000000000000003FFFFFC0000000000000007FFF
FF80000000000000007FFFFF80000000000000007FFFFF80000000000000007FFFFF8000
0000000000007FFFFF8000000000000000FFFFFF8000000000000000FFFFFF8000000000
000000FFFFFF8000000000000000FFFFFF8000000000000000FFFFFF8000000000000000
FFFFFF8000000000000000FFFFFF8000000000000000FFFFFF8000000000000000FFFFFF
8000000000000000FFFFFF8000000000000000FFFFFF8000000000000000FFFFFF800000
0000000000FFFFFF8000000000000000FFFFFF8000000000000000FFFFFF800000000000
0000FFFFFF80000000000000007FFFFF80000000000000007FFFFF80000000000000007F
FFFFC0000000000000007FFFFFC0000000000000007FFFFFC0000000000000003FFFFFC0
000000000000003FFFFFC0000000000000003FFFFFC0000000000000001FFFFFE0000000
000000001FFFFFE0000000000000001FFFFFE0000000000000000FFFFFE0000000000000
000FFFFFF0000000000000FE07FFFFF0000000000001FF07FFFFF0000000000001FF03FF
FFF8000000000003FF03FFFFF8000000000003FE01FFFFFC000000000003FE01FFFFFC00
0000000007FE00FFFFFE00000000000FFC007FFFFF00000000000FFC007FFFFF80000000
001FF8003FFFFF80000000003FF0001FFFFFC0000000007FF0000FFFFFE000000000FFE0
0007FFFFF800000001FFC00003FFFFFC00000003FFC00001FFFFFF0000000FFF800000FF
FFFFC000003FFF0000003FFFFFF00001FFFC0000001FFFFFFF801FFFF800000007FFFFFF
FFFFFFF000000003FFFFFFFFFFFFC000000000FFFFFFFFFFFF80000000003FFFFFFFFFFE
000000000007FFFFFFFFF8000000000000FFFFFFFFC00000000000001FFFFFFE00000000
000000007FFFC0000000585F78DD67>I[<00000000000000000000003FE0000000000000
0000000000FFFFFFE000000000000000000001FFFFFFFFE000000000000000000001FFFF
FFFFE000000000000000000001FFFFFFFFE000000000000000000001FFFFFFFFE0000000
00000000000001FFFFFFFFE000000000000000000001FFFFFFFFE0000000000000000000
01FFFFFFFFE000000000000000000001FFFFFFFFE000000000000000000001FFFFFFFFE0
00000000000000000000007FFFFFE000000000000000000000000FFFFFE0000000000000
00000000000FFFFFE0000000000000000000000007FFFFE0000000000000000000000007
FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000
000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000000000
000007FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0
000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000
000000000007FFFFE0000000000000000000000007FFFFE0000000000000000000000007
FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000
000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000000000
000007FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0
000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000
000000000007FFFFE0000000000000000000000007FFFFE0000000000000000000000007
FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000
000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000000000
000007FFFFE0000000000000000000000007FFFFE0000000000000000000000007FFFFE0
000000000000000000000007FFFFE0000000000000000000000007FFFFE0000000000000
000000000007FFFFE0000000000000003FFF800007FFFFE00000000000000FFFFFFC0007
FFFFE0000000000000FFFFFFFF8007FFFFE0000000000007FFFFFFFFE007FFFFE0000000
00001FFFFFFFFFF807FFFFE000000000007FFFFFFFFFFE07FFFFE00000000001FFFFFFFF
FFFF87FFFFE00000000007FFFFFE007FFFC7FFFFE0000000001FFFFFE00007FFF7FFFFE0
000000003FFFFF000000FFFFFFFFE0000000007FFFFC0000003FFFFFFFE000000001FFFF
F80000000FFFFFFFE000000003FFFFE000000007FFFFFFE000000007FFFFC000000003FF
FFFFE00000000FFFFF8000000001FFFFFFE00000001FFFFF00000000007FFFFFE0000000
3FFFFE00000000007FFFFFE00000003FFFFE00000000003FFFFFE00000007FFFFC000000
00001FFFFFE0000000FFFFF800000000000FFFFFE0000001FFFFF800000000000FFFFFE0
000001FFFFF000000000000FFFFFE0000003FFFFF000000000000FFFFFE0000003FFFFF0
00000000000FFFFFE0000007FFFFE000000000000FFFFFE0000007FFFFE000000000000F
FFFFE000000FFFFFE000000000000FFFFFE000000FFFFFC000000000000FFFFFE000001F
FFFFC000000000000FFFFFE000001FFFFFC000000000000FFFFFE000001FFFFFC0000000
00000FFFFFE000003FFFFFC000000000000FFFFFE000003FFFFFC000000000000FFFFFE0
00003FFFFF8000000000000FFFFFE000007FFFFF8000000000000FFFFFE000007FFFFF80
00000000000FFFFFE000007FFFFF8000000000000FFFFFE000007FFFFF8000000000000F
FFFFE000007FFFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FF
FFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF80000000
00000FFFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE0
0000FFFFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF80
00000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF8000000000000F
FFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FF
FFFF8000000000000FFFFFE00000FFFFFF8000000000000FFFFFE00000FFFFFF80000000
00000FFFFFE000007FFFFF8000000000000FFFFFE000007FFFFF8000000000000FFFFFE0
00007FFFFF8000000000000FFFFFE000007FFFFF8000000000000FFFFFE000007FFFFF80
00000000000FFFFFE000003FFFFF8000000000000FFFFFE000003FFFFFC000000000000F
FFFFE000003FFFFFC000000000000FFFFFE000003FFFFFC000000000000FFFFFE000001F
FFFFC000000000000FFFFFE000001FFFFFC000000000000FFFFFE000000FFFFFC0000000
00000FFFFFE000000FFFFFC000000000000FFFFFE000000FFFFFE000000000000FFFFFE0
000007FFFFE000000000000FFFFFE0000007FFFFE000000000000FFFFFE0000003FFFFF0
00000000000FFFFFE0000003FFFFF000000000000FFFFFE0000001FFFFF000000000001F
FFFFE0000000FFFFF800000000003FFFFFE0000000FFFFF800000000007FFFFFE0000000
7FFFFC00000000007FFFFFE00000003FFFFE0000000000FFFFFFE00000001FFFFE000000
0001FFFFFFE00000000FFFFF0000000007FFFFFFE00000000FFFFF800000000FFFFFFFE0
00000007FFFFC00000001FFFFFFFF000000001FFFFF00000007FFFFFFFF000000000FFFF
F8000000FFFFFFFFFE000000007FFFFE000003FFEFFFFFFFFF8000003FFFFF80001FFFCF
FFFFFFFF8000000FFFFFF801FFFF0FFFFFFFFF80000003FFFFFFFFFFFE0FFFFFFFFF8000
0001FFFFFFFFFFF80FFFFFFFFF800000007FFFFFFFFFE00FFFFFFFFF800000000FFFFFFF
FF800FFFFFFFFF8000000001FFFFFFFC000FFFFFFFFF80000000003FFFFFE0000FFFFFFF
FF800000000000FFFE00000FFFFE000000>113 144 120 270 129
I<00000000007FFFC000000000000000000FFFFFFF0000000000000000FFFFFFFFE00000
0000000007FFFFFFFFFC0000000000001FFFFFFFFFFF0000000000007FFFFFFFFFFFC000
00000001FFFFFFFFFFFFF00000000007FFFFF803FFFFF8000000001FFFFF80003FFFFE00
0000003FFFFE00000FFFFF000000007FFFF8000003FFFF80000001FFFFF0000001FFFFC0
000003FFFFC00000007FFFE0000007FFFF800000003FFFF000000FFFFF000000003FFFF0
00001FFFFF000000001FFFF800003FFFFE000000000FFFFC00003FFFFC000000000FFFFE
00007FFFFC0000000007FFFE0000FFFFF80000000003FFFF0001FFFFF80000000003FFFF
0001FFFFF00000000003FFFF8003FFFFF00000000001FFFF8003FFFFE00000000001FFFF
8007FFFFE00000000001FFFFC007FFFFE00000000000FFFFC00FFFFFE00000000000FFFF
E00FFFFFC00000000000FFFFE01FFFFFC00000000000FFFFE01FFFFFC000000000007FFF
E01FFFFFC000000000007FFFF03FFFFFC000000000007FFFF03FFFFFC000000000007FFF
F03FFFFF8000000000007FFFF07FFFFF8000000000007FFFF07FFFFF8000000000007FFF
F07FFFFF8000000000007FFFF87FFFFF8000000000003FFFF87FFFFF8000000000003FFF
F8FFFFFF8000000000003FFFF8FFFFFF8000000000003FFFF8FFFFFF8000000000003FFF
F8FFFFFFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFFFFF
F8FFFFFFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFFFFFFFF
F0FFFFFF800000000000000000FFFFFF800000000000000000FFFFFF8000000000000000
00FFFFFF800000000000000000FFFFFF800000000000000000FFFFFF8000000000000000
00FFFFFF8000000000000000007FFFFF8000000000000000007FFFFF8000000000000000
007FFFFF8000000000000000007FFFFF8000000000000000007FFFFFC000000000000000
003FFFFFC000000000000000003FFFFFC000000000000000003FFFFFC000000000000000
001FFFFFC000000000000000001FFFFFC000000000000000001FFFFFE000000000000000
000FFFFFE000000000000000000FFFFFE0000000000000000007FFFFE000000000000007
F007FFFFF00000000000000FF803FFFFF00000000000000FF803FFFFF80000000000000F
F801FFFFF80000000000001FF801FFFFFC0000000000001FF000FFFFFC0000000000003F
F0007FFFFE0000000000007FE0003FFFFF0000000000007FE0003FFFFF000000000000FF
C0001FFFFF800000000001FF80000FFFFFC00000000003FF800007FFFFF00000000007FF
000003FFFFF8000000001FFE000001FFFFFC000000003FFC0000007FFFFF00000000FFF8
0000003FFFFFE0000003FFF00000001FFFFFFC00001FFFE000000007FFFFFFC003FFFFC0
00000003FFFFFFFFFFFFFF0000000000FFFFFFFFFFFFFE00000000003FFFFFFFFFFFF800
000000000FFFFFFFFFFFE0000000000001FFFFFFFFFF800000000000003FFFFFFFFC0000
000000000003FFFFFFC000000000000000000FFFF8000000005D5F7ADD6A>I[<00000000
00003FFF80000000000000000FFFFFF000000000000000FFFFFFFE00000000000007FFFF
FFFF0000000000001FFFFFFFFFC000000000007FFFFFFFFFE00000000001FFFFFFFFFFF0
0000000007FFFFF807FFF8000000001FFFFFC00FFFFC000000003FFFFE001FFFFE000000
007FFFFC003FFFFE00000000FFFFF0003FFFFF00000001FFFFE0007FFFFF00000003FFFF
C0007FFFFF00000007FFFFC000FFFFFF80000007FFFF8000FFFFFF8000000FFFFF0000FF
FFFF8000001FFFFF0000FFFFFF8000001FFFFE0000FFFFFF8000003FFFFE0000FFFFFF80
00003FFFFC0000FFFFFF8000007FFFFC0000FFFFFF8000007FFFFC00007FFFFF0000007F
FFFC00007FFFFF0000007FFFF800003FFFFE000000FFFFF800001FFFFC000000FFFFF800
001FFFFC000000FFFFF800000FFFF8000000FFFFF8000003FFE0000000FFFFF8000000FF
80000000FFFFF80000000000000000FFFFF80000000000000000FFFFF800000000000000
00FFFFF80000000000000000FFFFF80000000000000000FFFFF80000000000000000FFFF
F80000000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF80000
000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF80000000000
000000FFFFF80000000000000000FFFFF80000000000000000FFFFF80000000000000000
FFFFF80000000000000000FFFFF80000000000000000FFFFF80000000000000000FFFFF8
0000000000000000FFFFF80000000000000000FFFFF8000000000000FFFFFFFFFFFFFFF8
000000FFFFFFFFFFFFFFF8000000FFFFFFFFFFFFFFF8000000FFFFFFFFFFFFFFF8000000
FFFFFFFFFFFFFFF8000000FFFFFFFFFFFFFFF8000000FFFFFFFFFFFFFFF8000000FFFFFF
FFFFFFFFF8000000FFFFFFFFFFFFFFF80000000000FFFFFC0000000000000000FFFFFC00
00000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00000000
00000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00000000000000
00FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFF
FC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000
000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000
000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000
FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC
0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC000000
0000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC000000000000
0000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FF
FFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00
00000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00000000
00000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00000000000000
00FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFF
FC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000
000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000
000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000
FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC
0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC000000
0000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC000000000000
0000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FF
FFFC0000000000000000FFFFFC0000000000000000FFFFFC0000000000000000FFFFFC00
00000000003FFFFFFFFFFFFF000000003FFFFFFFFFFFFF000000003FFFFFFFFFFFFF0000
00003FFFFFFFFFFFFF000000003FFFFFFFFFFFFF000000003FFFFFFFFFFFFF000000003F
FFFFFFFFFFFF000000003FFFFFFFFFFFFF000000003FFFFFFFFFFFFF00000000>81
144 121 271 71 I<0000000000000000000000FFC000000000000FFFFC0000000FFFF0
0000000001FFFFFFE000007FFFF8000000001FFFFFFFFE0001FFFFFE000000007FFFFFFF
FF8007FFFFFF00000003FFFFFFFFFFF01FFFFFFF0000000FFFFFFFFFFFFC3FFFFFFF8000
001FFFFFFFFFFFFE7FFF3FFF8000007FFFFF003FFFFFFFF03FFFC00000FFFFF80007FFFF
FF807FFFC00001FFFFE00001FFFFFC007FFFC00007FFFF8000007FFFF8007FFFC00007FF
FF0000003FFFF8007FFFC0000FFFFE0000001FFFFC007FFFC0001FFFFC0000000FFFFE00
7FFFC0003FFFF800000007FFFF003FFF80007FFFF800000007FFFF803FFF80007FFFF800
000007FFFF801FFF0000FFFFF000000003FFFFC00FFE0000FFFFF000000003FFFFC003F8
0001FFFFF000000003FFFFE000000001FFFFF000000003FFFFE000000003FFFFE0000000
01FFFFF000000003FFFFE000000001FFFFF000000003FFFFE000000001FFFFF000000003
FFFFE000000001FFFFF000000007FFFFE000000001FFFFF800000007FFFFE000000001FF
FFF800000007FFFFE000000001FFFFF800000007FFFFE000000001FFFFF800000007FFFF
E000000001FFFFF800000007FFFFE000000001FFFFF800000007FFFFE000000001FFFFF8
00000007FFFFE000000001FFFFF800000007FFFFE000000001FFFFF800000007FFFFE000
000001FFFFF800000007FFFFE000000001FFFFF800000003FFFFE000000001FFFFF00000
0003FFFFE000000001FFFFF000000003FFFFE000000001FFFFF000000003FFFFE0000000
01FFFFF000000001FFFFF000000003FFFFE000000001FFFFF000000003FFFFE000000000
FFFFF000000003FFFFC000000000FFFFF000000003FFFFC0000000007FFFF800000007FF
FF80000000007FFFF800000007FFFF80000000003FFFF800000007FFFF00000000001FFF
FC0000000FFFFE00000000000FFFFE0000001FFFFC000000000007FFFF0000003FFFF800
0000000007FFFF8000007FFFF8000000000001FFFFE00001FFFFE0000000000000FFFFF8
0007FFFFC0000000000001FFFFFF003FFFFF80000000000003FFFFFFFFFFFFFE00000000
000007FFFFFFFFFFFFFC00000000000007F3FFFFFFFFFFF00000000000000FE07FFFFFFF
FF800000000000000FE01FFFFFFFFE000000000000001FC001FFFFFFE000000000000000
1FC0000FFFFC00000000000000003FC00000000000000000000000003FC0000000000000
0000000000003FC00000000000000000000000007FC00000000000000000000000007FC0
0000000000000000000000007FE00000000000000000000000007FE00000000000000000
000000007FE00000000000000000000000007FF00000000000000000000000007FF00000
000000000000000000007FF80000000000000000000000007FFC00000000000000000000
00007FFE0000000000000000000000007FFF8000000000000000000000007FFFF0000000
00000000000000007FFFFFFFFFFFFFF00000000000003FFFFFFFFFFFFFFFE00000000000
3FFFFFFFFFFFFFFFFE00000000003FFFFFFFFFFFFFFFFFC0000000001FFFFFFFFFFFFFFF
FFF8000000001FFFFFFFFFFFFFFFFFFE000000001FFFFFFFFFFFFFFFFFFF800000000FFF
FFFFFFFFFFFFFFFFE000000007FFFFFFFFFFFFFFFFFFF000000007FFFFFFFFFFFFFFFFFF
F800000003FFFFFFFFFFFFFFFFFFFE00000001FFFFFFFFFFFFFFFFFFFF00000000FFFFFF
FFFFFFFFFFFFFF000000007FFFFFFFFFFFFFFFFFFF800000007FFFFFFFFFFFFFFFFFFFC0
000003FFFFFFFFFFFFFFFFFFFFE000000FFFFFFFFFFFFFFFFFFFFFE000003FFFFFFFFFFF
FFFFFFFFFFF00000FFFFFFFFFFFFFFFFFFFFFFF00001FFFFE0000000003FFFFFFFF80003
FFFF000000000000FFFFFFF80007FFFC0000000000000FFFFFF8000FFFF8000000000000
01FFFFFC001FFFF0000000000000007FFFFC003FFFE0000000000000003FFFFC003FFFE0
000000000000001FFFFC007FFFC0000000000000000FFFFE007FFFC00000000000000007
FFFE007FFFC00000000000000007FFFE00FFFF800000000000000007FFFE00FFFF800000
000000000003FFFE00FFFF800000000000000003FFFE00FFFF800000000000000003FFFE
00FFFF800000000000000003FFFE00FFFF800000000000000003FFFE00FFFF8000000000
00000003FFFE00FFFFC00000000000000007FFFE007FFFC00000000000000007FFFC007F
FFC00000000000000007FFFC007FFFE0000000000000000FFFFC003FFFF0000000000000
001FFFF8001FFFF0000000000000001FFFF0001FFFF8000000000000003FFFF0000FFFFC
000000000000007FFFE00007FFFE00000000000000FFFFC00003FFFF80000000000003FF
FF800003FFFFC0000000000007FFFF800000FFFFF000000000001FFFFE0000007FFFFC00
000000007FFFFC0000003FFFFF8000000003FFFFF80000000FFFFFF80000003FFFFFE000
000007FFFFFFE0000FFFFFFFC000000001FFFFFFFFFFFFFFFFFF00000000003FFFFFFFFF
FFFFFFF800000000000FFFFFFFFFFFFFFFE0000000000001FFFFFFFFFFFFFF0000000000
00001FFFFFFFFFFFF00000000000000001FFFFFFFFFF00000000000000000001FFFFFF00
00000000006A887ADD74>I[<0000001FF000000000000000000000007FFFFFF000000000
000000000000FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000000000
FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000000000FFFFFFFFF000
000000000000000000FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000
000000FFFFFFFFF000000000000000000000FFFFFFFFF000000000000000000000003FFF
FFF0000000000000000000000007FFFFF0000000000000000000000007FFFFF000000000
0000000000000003FFFFF0000000000000000000000003FFFFF000000000000000000000
0003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000
0000000000000000000003FFFFF0000000000000000000000003FFFFF000000000000000
0000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FF
FFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000000000
0000000000000003FFFFF0000000000000000000000003FFFFF000000000000000000000
0003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000
0000000000000000000003FFFFF0000000000000000000000003FFFFF000000000000000
0000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FF
FFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000000000
0000000000000003FFFFF0000000000000000000000003FFFFF000000000000000000000
0003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000
0000000000000000000003FFFFF0000000000000000000000003FFFFF000000000000000
0000000003FFFFF0000000000000000000000003FFFFF0000000000000000000000003FF
FFF0000000000000000000000003FFFFF0000000000000000000000003FFFFF000000000
0000000000000003FFFFF0000003FFFC00000000000003FFFFF000003FFFFFE000000000
0003FFFFF00000FFFFFFF8000000000003FFFFF00007FFFFFFFE000000000003FFFFF000
1FFFFFFFFF800000000003FFFFF0003FFFFFFFFFE00000000003FFFFF000FFFFFFFFFFF0
0000000003FFFFF001FFFC03FFFFF80000000003FFFFF003FFC000FFFFFC0000000003FF
FFF007FE00007FFFFE0000000003FFFFF00FF800003FFFFE0000000003FFFFF01FE00000
3FFFFF0000000003FFFFF03FC000001FFFFF8000000003FFFFF07F8000001FFFFF800000
0003FFFFF0FE0000001FFFFFC000000003FFFFF1FC0000000FFFFFC000000003FFFFF1F8
0000000FFFFFC000000003FFFFF3F80000000FFFFFE000000003FFFFF7F00000000FFFFF
E000000003FFFFF7E000000007FFFFE000000003FFFFFFC000000007FFFFE000000003FF
FFFFC000000007FFFFE000000003FFFFFF8000000007FFFFF000000003FFFFFF80000000
07FFFFF000000003FFFFFF0000000007FFFFF000000003FFFFFF0000000007FFFFF00000
0003FFFFFE0000000007FFFFF000000003FFFFFE0000000007FFFFF000000003FFFFFE00
00000007FFFFF000000003FFFFFC0000000007FFFFF000000003FFFFFC0000000007FFFF
F000000003FFFFFC0000000007FFFFF000000003FFFFFC0000000007FFFFF000000003FF
FFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800000000
07FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF00000
0003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800
00000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFF
F000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FF
FFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800000000
07FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF00000
0003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800
00000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFF
F000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FF
FFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800000000
07FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF00000
0003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800
00000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFF
F000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FF
FFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800000000
07FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF00000
0003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800
00000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFF
F000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FF
FFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF800000000
07FFFFF00000FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0
FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFF
E001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFF
FFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0>114
143 119 270 129 I[<00003FC00000000000FFF00000000003FFFC0000000007FFFE00
0000000FFFFF000000001FFFFF800000003FFFFFC00000007FFFFFE00000007FFFFFE000
0000FFFFFFF0000000FFFFFFF0000001FFFFFFF8000001FFFFFFF8000001FFFFFFF80000
01FFFFFFF8000001FFFFFFF8000001FFFFFFF8000001FFFFFFF8000001FFFFFFF8000000
FFFFFFF0000000FFFFFFF00000007FFFFFE00000007FFFFFE00000003FFFFFC00000001F
FFFF800000000FFFFF0000000007FFFE0000000003FFFC0000000000FFF000000000003F
C00000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000001FF00000007FFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FF
FFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFF
FFFFF00000FFFFFFFFF00000003FFFFFF000000007FFFFF000000007FFFFF000000003FF
FFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000
000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF00000
0003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0000000
03FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003
FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FF
FFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000
000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF00000
0003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0000000
03FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003
FFFFF000000003FFFFF000000003FFFFF00000FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFF
FFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFFFFFF80FFFFFFFF
FFFF80FFFFFFFFFFFF80>49 144 119 271 65 I[<0000001FF000000000000000000000
7FFFFFF0000000000000000000FFFFFFFFF0000000000000000000FFFFFFFFF000000000
0000000000FFFFFFFFF0000000000000000000FFFFFFFFF0000000000000000000FFFFFF
FFF0000000000000000000FFFFFFFFF0000000000000000000FFFFFFFFF0000000000000
000000FFFFFFFFF0000000000000000000FFFFFFFFF0000000000000000000003FFFFFF0
0000000000000000000007FFFFF00000000000000000000007FFFFF00000000000000000
000003FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF00000
000000000000000003FFFFF00000000000000000000003FFFFF000000000000000000000
03FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF000000000
00000000000003FFFFF00000000000000000000003FFFFF00000000000000000000003FF
FFF00000000000000000000003FFFFF00000000000000000000003FFFFF0000000000000
0000000003FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF0
0000000000000000000003FFFFF00000000000000000000003FFFFF00000000000000000
000003FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF00000
000000000000000003FFFFF00000000000000000000003FFFFF000000000000000000000
03FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF000000000
00000000000003FFFFF00000000000000000000003FFFFF00000000000000000000003FF
FFF00000000000000000000003FFFFF00000000000000000000003FFFFF0000000000000
0000000003FFFFF00000000000000000000003FFFFF00000000000000000000003FFFFF0
0000000000000000000003FFFFF00000000000000000000003FFFFF00000000000000000
000003FFFFF00000000000000000000003FFFFF00000003FFFFFFFFFC00003FFFFF00000
003FFFFFFFFFC00003FFFFF00000003FFFFFFFFFC00003FFFFF00000003FFFFFFFFFC000
03FFFFF00000003FFFFFFFFFC00003FFFFF00000003FFFFFFFFFC00003FFFFF00000003F
FFFFFFFFC00003FFFFF00000003FFFFFFFFFC00003FFFFF00000003FFFFFFFFFC00003FF
FFF000000001FFFFFE00000003FFFFF0000000003FFFC000000003FFFFF0000000003FFF
0000000003FFFFF0000000007FFE0000000003FFFFF000000000FFFC0000000003FFFFF0
00000001FFF80000000003FFFFF000000003FFE00000000003FFFFF00000000FFFC00000
000003FFFFF00000001FFF800000000003FFFFF00000003FFF000000000003FFFFF00000
007FFC000000000003FFFFF0000001FFF8000000000003FFFFF0000003FFF00000000000
03FFFFF0000007FFE0000000000003FFFFF000000FFFC0000000000003FFFFF000001FFF
00000000000003FFFFF000007FFE00000000000003FFFFF00000FFFC00000000000003FF
FFF00001FFF800000000000003FFFFF00003FFF000000000000003FFFFF00007FFC00000
0000000003FFFFF0001FFF8000000000000003FFFFF0003FFF0000000000000003FFFFF0
007FFE0000000000000003FFFFF000FFF80000000000000003FFFFF003FFFC0000000000
000003FFFFF007FFFC0000000000000003FFFFF00FFFFE0000000000000003FFFFF01FFF
FF0000000000000003FFFFF03FFFFF8000000000000003FFFFF0FFFFFFC0000000000000
03FFFFF1FFFFFFC000000000000003FFFFF3FFFFFFE000000000000003FFFFF7FFFFFFF0
00000000000003FFFFFFFFFFFFF800000000000003FFFFFFFFFFFFF800000000000003FF
FFFFFFFFFFFC00000000000003FFFFFFFFFFFFFE00000000000003FFFFFFF1FFFFFF0000
0000000003FFFFFFE0FFFFFF00000000000003FFFFFFC0FFFFFF80000000000003FFFFFF
807FFFFFC0000000000003FFFFFF003FFFFFE0000000000003FFFFFC001FFFFFF0000000
000003FFFFF8001FFFFFF0000000000003FFFFF0000FFFFFF8000000000003FFFFE00007
FFFFFC000000000003FFFFE00003FFFFFE000000000003FFFFE00003FFFFFE0000000000
03FFFFE00001FFFFFF000000000003FFFFE00000FFFFFF800000000003FFFFE000007FFF
FFC00000000003FFFFE000003FFFFFC00000000003FFFFE000003FFFFFE00000000003FF
FFE000001FFFFFF00000000003FFFFE000000FFFFFF80000000003FFFFE0000007FFFFFC
0000000003FFFFE0000007FFFFFC0000000003FFFFE0000003FFFFFE0000000003FFFFE0
000001FFFFFF0000000003FFFFE0000000FFFFFF8000000003FFFFE0000000FFFFFF8000
000003FFFFE00000007FFFFFC000000003FFFFE00000003FFFFFE000000003FFFFE00000
001FFFFFF000000003FFFFE00000000FFFFFF000000003FFFFE00000000FFFFFF8000000
03FFFFE000000007FFFFFC00000003FFFFE000000003FFFFFE00000003FFFFE000000001
FFFFFF00000003FFFFE000000001FFFFFF00000003FFFFE000000000FFFFFF80000003FF
FFE000000000FFFFFFC0000003FFFFE000000001FFFFFFF000FFFFFFFFFFFF80007FFFFF
FFFFFFFFFFFFFFFFFF80007FFFFFFFFFFFFFFFFFFFFFFF80007FFFFFFFFFFFFFFFFFFFFF
FF80007FFFFFFFFFFFFFFFFFFFFFFF80007FFFFFFFFFFFFFFFFFFFFFFF80007FFFFFFFFF
FFFFFFFFFFFFFF80007FFFFFFFFFFFFFFFFFFFFFFF80007FFFFFFFFFFFFFFFFFFFFFFF80
007FFFFFFFFFFF>112 143 121 270 123 107 D[<0000001FF00000007FFFFFF00000FF
FFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFF
FFFFF00000FFFFFFFFF00000FFFFFFFFF00000FFFFFFFFF00000003FFFFFF000000007FF
FFF000000007FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000
000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF00000
0003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0000000
03FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003
FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FF
FFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000
000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF00000
0003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0000000
03FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003
FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FF
FFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000
000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF00000
0003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0000000
03FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003
FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FF
FFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFF
F000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF000000003FFFFF0
00000003FFFFF000000003FFFFF000000003FFFFF00000FFFFFFFFFFFFC0FFFFFFFFFFFF
C0FFFFFFFFFFFFC0FFFFFFFFFFFFC0FFFFFFFFFFFFC0FFFFFFFFFFFFC0FFFFFFFFFFFFC0
FFFFFFFFFFFFC0FFFFFFFFFFFFC0>50 143 119 270 65 I<0000003FE0000001FFFC00
0000000001FFFC0000000000007FFFFFE000001FFFFFE0000000001FFFFFE000000000FF
FFFFFFE00000FFFFFFFC00000000FFFFFFFC00000000FFFFFFFFE00003FFFFFFFF000000
03FFFFFFFF00000000FFFFFFFFE0000FFFFFFFFFC000000FFFFFFFFFC0000000FFFFFFFF
E0003FFFFFFFFFF000003FFFFFFFFFF0000000FFFFFFFFE000FFFFFFFFFFF80000FFFFFF
FFFFF8000000FFFFFFFFE001FFFC03FFFFFC0001FFFC03FFFFFC000000FFFFFFFFE003FF
C000FFFFFE0003FFC000FFFFFE000000FFFFFFFFE007FE00003FFFFF0007FE00003FFFFF
000000FFFFFFFFE00FF800001FFFFF000FF800001FFFFF000000003FFFFFE01FF000001F
FFFF801FF000001FFFFF8000000007FFFFE03FC000000FFFFFC03FC000000FFFFFC00000
0007FFFFE07F8000000FFFFFC07F8000000FFFFFC000000003FFFFE0FF0000000FFFFFE0
FF0000000FFFFFE000000003FFFFE1FE00000007FFFFE1FE00000007FFFFE000000003FF
FFE1FC00000007FFFFE1FC00000007FFFFE000000003FFFFE3F800000007FFFFF3F80000
0007FFFFF000000003FFFFE7F000000007FFFFF7F000000007FFFFF000000003FFFFE7E0
00000003FFFFF7E000000003FFFFF000000003FFFFEFC000000003FFFFFFC000000003FF
FFF000000003FFFFEFC000000003FFFFFFC000000003FFFFF000000003FFFFFF80000000
03FFFFFF8000000003FFFFF800000003FFFFFF8000000003FFFFFF8000000003FFFFF800
000003FFFFFF0000000003FFFFFF0000000003FFFFF800000003FFFFFF0000000003FFFF
FF0000000003FFFFF800000003FFFFFE0000000003FFFFFE0000000003FFFFF800000003
FFFFFE0000000003FFFFFE0000000003FFFFF800000003FFFFFE0000000003FFFFFE0000
000003FFFFF800000003FFFFFC0000000003FFFFFC0000000003FFFFF800000003FFFFFC
0000000003FFFFFC0000000003FFFFF800000003FFFFFC0000000003FFFFFC0000000003
FFFFF800000003FFFFFC0000000003FFFFFC0000000003FFFFF800000003FFFFF8000000
0003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF8
00000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FF
FFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF8000000
03FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF800
00000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFF
F80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF800000000
03FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000
000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFF
F800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003
FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF80000
0003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF8
0000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FF
FFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF8000000
0003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF800
00000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FF
FFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF800000000
03FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800
000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFF
F80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003
FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000
000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF8
0000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003
FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF8000000
0003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF8
00000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FF
FFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF8000000
03FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF800
00000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFF
F80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF800000000
03FFFFF800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000
000003FFFFF80000000003FFFFF800000003FFFFF80000000003FFFFF80000000003FFFF
F800000003FFFFF80000000003FFFFF80000000003FFFFF800000003FFFFF80000000003
FFFFF80000000003FFFFF80000FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE0
FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE0FFFFFFFFFFFFE000FFFFFFFFFF
FFE000FFFFFFFFFFFFE0FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE0FFFFFF
FFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE0FFFFFFFFFFFFE000FFFFFFFFFFFFE000
FFFFFFFFFFFFE0FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE0FFFFFFFFFFFF
E000FFFFFFFFFFFFE000FFFFFFFFFFFFE0FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFF
FFFFFFE0B35D77DCC2>I<0000003FE0000003FFFC0000000000007FFFFFE000003FFFFF
E000000000FFFFFFFFE00000FFFFFFF800000000FFFFFFFFE00007FFFFFFFE00000000FF
FFFFFFE0001FFFFFFFFF80000000FFFFFFFFE0003FFFFFFFFFE0000000FFFFFFFFE000FF
FFFFFFFFF0000000FFFFFFFFE001FFFC03FFFFF8000000FFFFFFFFE003FFC000FFFFFC00
0000FFFFFFFFE007FE00007FFFFE000000FFFFFFFFE00FF800003FFFFE000000003FFFFF
E01FE000003FFFFF0000000007FFFFE03FC000001FFFFF8000000007FFFFE07F8000001F
FFFF8000000003FFFFE0FE0000001FFFFFC000000003FFFFE1FC0000000FFFFFC0000000
03FFFFE1F80000000FFFFFC000000003FFFFE3F80000000FFFFFE000000003FFFFE7F000
00000FFFFFE000000003FFFFE7E000000007FFFFE000000003FFFFEFC000000007FFFFE0
00000003FFFFEFC000000007FFFFE000000003FFFFFF8000000007FFFFF000000003FFFF
FF8000000007FFFFF000000003FFFFFF0000000007FFFFF000000003FFFFFF0000000007
FFFFF000000003FFFFFE0000000007FFFFF000000003FFFFFE0000000007FFFFF0000000
03FFFFFE0000000007FFFFF000000003FFFFFC0000000007FFFFF000000003FFFFFC0000
000007FFFFF000000003FFFFFC0000000007FFFFF000000003FFFFFC0000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF00000FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFF
FFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FF
FFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE0
01FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFFFFC0FFFFFFFFFFFFE001FFFFFFFFFF
FFC0725D77DC81>I<00000000001FFFF000000000000000000007FFFFFFC00000000000
0000007FFFFFFFFC0000000000000003FFFFFFFFFF800000000000000FFFFFFFFFFFE000
00000000007FFFFFFFFFFFFC000000000001FFFFFFFFFFFFFF000000000003FFFFFC007F
FFFF80000000000FFFFFC00007FFFFE0000000001FFFFE000000FFFFF0000000007FFFF8
0000003FFFFC00000000FFFFF00000001FFFFE00000001FFFFC000000007FFFF00000003
FFFF8000000003FFFF80000007FFFF0000000001FFFFC000000FFFFE0000000000FFFFE0
00001FFFFC00000000007FFFF000003FFFFC00000000007FFFF800007FFFF80000000000
3FFFFC00007FFFF800000000003FFFFC0000FFFFF000000000001FFFFE0001FFFFF00000
0000001FFFFF0001FFFFE000000000000FFFFF0003FFFFE000000000000FFFFF8003FFFF
E000000000000FFFFF8007FFFFE000000000000FFFFFC007FFFFC0000000000007FFFFC0
0FFFFFC0000000000007FFFFE00FFFFFC0000000000007FFFFE01FFFFFC0000000000007
FFFFF01FFFFFC0000000000007FFFFF01FFFFFC0000000000007FFFFF03FFFFF80000000
000003FFFFF83FFFFF80000000000003FFFFF83FFFFF80000000000003FFFFF83FFFFF80
000000000003FFFFF87FFFFF80000000000003FFFFFC7FFFFF80000000000003FFFFFC7F
FFFF80000000000003FFFFFC7FFFFF80000000000003FFFFFC7FFFFF80000000000003FF
FFFCFFFFFF80000000000003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF8000000000
0003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF8000
0000000003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF80000000000003FFFFFEFFFF
FF80000000000003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF80000000000003FFFF
FEFFFFFF80000000000003FFFFFEFFFFFF80000000000003FFFFFEFFFFFF800000000000
03FFFFFEFFFFFF80000000000003FFFFFE7FFFFF80000000000003FFFFFC7FFFFF800000
00000003FFFFFC7FFFFF80000000000003FFFFFC7FFFFF80000000000003FFFFFC7FFFFF
80000000000003FFFFFC3FFFFFC0000000000007FFFFF83FFFFFC0000000000007FFFFF8
3FFFFFC0000000000007FFFFF81FFFFFC0000000000007FFFFF01FFFFFC0000000000007
FFFFF01FFFFFC0000000000007FFFFF00FFFFFC0000000000007FFFFE00FFFFFE0000000
00000FFFFFE007FFFFE000000000000FFFFFC007FFFFE000000000000FFFFFC003FFFFF0
00000000001FFFFF8003FFFFF000000000001FFFFF8001FFFFF000000000001FFFFF0001
FFFFF800000000003FFFFF0000FFFFF800000000003FFFFE00007FFFFC00000000007FFF
FC00007FFFFE0000000000FFFFFC00003FFFFE0000000000FFFFF800001FFFFF00000000
01FFFFF000000FFFFF8000000003FFFFE0000007FFFFC000000007FFFFC0000003FFFFF0
0000001FFFFF80000001FFFFF80000003FFFFF000000007FFFFE000000FFFFFC00000000
3FFFFFC00007FFFFF8000000001FFFFFFC007FFFFFF00000000007FFFFFFFFFFFFFFC000
00000001FFFFFFFFFFFFFF0000000000007FFFFFFFFFFFFC0000000000001FFFFFFFFFFF
F000000000000003FFFFFFFFFF80000000000000007FFFFFFFFC000000000000000007FF
FFFFC00000000000000000001FFFF00000000000675F7ADD74>I<0000001FF000001FFF
C00000000000007FFFFFF00003FFFFFF0000000000FFFFFFFFF0001FFFFFFFE000000000
FFFFFFFFF000FFFFFFFFFC00000000FFFFFFFFF003FFFFFFFFFF00000000FFFFFFFFF00F
FFFFFFFFFFC0000000FFFFFFFFF03FFFFFFFFFFFF0000000FFFFFFFFF0FFFFFFFFFFFFFC
000000FFFFFFFFF1FFFFC01FFFFFFE000000FFFFFFFFF7FFFC0001FFFFFF000000FFFFFF
FFFFFFE000007FFFFFC00000003FFFFFFFFF0000003FFFFFE000000007FFFFFFFE000000
0FFFFFF000000007FFFFFFF800000007FFFFF800000003FFFFFFE000000003FFFFFC0000
0003FFFFFFC000000001FFFFFE00000003FFFFFF8000000000FFFFFE00000003FFFFFF00
000000007FFFFF00000003FFFFFE00000000007FFFFF80000003FFFFFC00000000003FFF
FFC0000003FFFFF800000000003FFFFFC0000003FFFFF800000000001FFFFFE0000003FF
FFF800000000001FFFFFE0000003FFFFF800000000000FFFFFF0000003FFFFF800000000
000FFFFFF0000003FFFFF8000000000007FFFFF8000003FFFFF8000000000007FFFFF800
0003FFFFF8000000000007FFFFFC000003FFFFF8000000000003FFFFFC000003FFFFF800
0000000003FFFFFC000003FFFFF8000000000003FFFFFE000003FFFFF8000000000003FF
FFFE000003FFFFF8000000000001FFFFFE000003FFFFF8000000000001FFFFFE000003FF
FFF8000000000001FFFFFF000003FFFFF8000000000001FFFFFF000003FFFFF800000000
0001FFFFFF000003FFFFF8000000000001FFFFFF000003FFFFF8000000000000FFFFFF00
0003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF800
0000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FF
FFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FF
FFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF800000000
0000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF80
0003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF800
0000000000FFFFFF800003FFFFF8000000000000FFFFFF800003FFFFF8000000000000FF
FFFF000003FFFFF8000000000001FFFFFF000003FFFFF8000000000001FFFFFF000003FF
FFF8000000000001FFFFFF000003FFFFF8000000000001FFFFFF000003FFFFF800000000
0001FFFFFE000003FFFFF8000000000001FFFFFE000003FFFFF8000000000003FFFFFE00
0003FFFFF8000000000003FFFFFC000003FFFFF8000000000003FFFFFC000003FFFFF800
0000000003FFFFFC000003FFFFF8000000000007FFFFF8000003FFFFF8000000000007FF
FFF8000003FFFFF8000000000007FFFFF0000003FFFFF800000000000FFFFFF0000003FF
FFF800000000000FFFFFE0000003FFFFF800000000001FFFFFE0000003FFFFF800000000
001FFFFFC0000003FFFFF800000000003FFFFFC0000003FFFFFC00000000003FFFFF8000
0003FFFFFE00000000007FFFFF00000003FFFFFF0000000000FFFFFE00000003FFFFFF00
00000000FFFFFE00000003FFFFFF8000000001FFFFFC00000003FFFFFFC000000003FFFF
F800000003FFFFFFE000000007FFFFF000000003FFFFFFF80000000FFFFFE000000003FF
FFFFFC0000003FFFFFC000000003FFFFFFFF0000007FFFFF0000000003FFFFFFFFC00001
FFFFFE0000000003FFFFFBFFF00007FFFFFC0000000003FFFFF8FFFF007FFFFFF0000000
0003FFFFF87FFFFFFFFFFFC00000000003FFFFF81FFFFFFFFFFF000000000003FFFFF80F
FFFFFFFFFC000000000003FFFFF803FFFFFFFFF0000000000003FFFFF8007FFFFFFF8000
0000000003FFFFF8000FFFFFF800000000000003FFFFF80000FFFE0000000000000003FF
FFF8000000000000000000000003FFFFF8000000000000000000000003FFFFF800000000
0000000000000003FFFFF8000000000000000000000003FFFFF800000000000000000000
0003FFFFF8000000000000000000000003FFFFF8000000000000000000000003FFFFF800
0000000000000000000003FFFFF8000000000000000000000003FFFFF800000000000000
0000000003FFFFF8000000000000000000000003FFFFF8000000000000000000000003FF
FFF8000000000000000000000003FFFFF8000000000000000000000003FFFFF800000000
0000000000000003FFFFF8000000000000000000000003FFFFF800000000000000000000
0003FFFFF8000000000000000000000003FFFFF8000000000000000000000003FFFFF800
0000000000000000000003FFFFF8000000000000000000000003FFFFF800000000000000
0000000003FFFFF8000000000000000000000003FFFFF8000000000000000000000003FF
FFF8000000000000000000000003FFFFF8000000000000000000000003FFFFF800000000
0000000000000003FFFFF8000000000000000000000003FFFFF800000000000000000000
0003FFFFF800000000000000000000FFFFFFFFFFFFE00000000000000000FFFFFFFFFFFF
E00000000000000000FFFFFFFFFFFFE00000000000000000FFFFFFFFFFFFE00000000000
000000FFFFFFFFFFFFE00000000000000000FFFFFFFFFFFFE00000000000000000FFFFFF
FFFFFFE00000000000000000FFFFFFFFFFFFE00000000000000000FFFFFFFFFFFFE00000
000000000000718579DC81>I<0000007FC00001FF80000000FFFFFFC0001FFFF80000FF
FFFFFFC0007FFFFE0000FFFFFFFFC001FFFFFF8000FFFFFFFFC003FFFFFFE000FFFFFFFF
C007FFFFFFF000FFFFFFFFC00FFFFFFFF800FFFFFFFFC01FFF07FFFC00FFFFFFFFC03FF0
0FFFFE00FFFFFFFFC07FC01FFFFE00FFFFFFFFC0FF803FFFFF00003FFFFFC0FF003FFFFF
000007FFFFC1FE007FFFFF800007FFFFC3FC007FFFFF800003FFFFC3F8007FFFFF800003
FFFFC7F0007FFFFF800003FFFFC7E0007FFFFF800003FFFFCFE0007FFFFF800003FFFFCF
C0007FFFFF800003FFFFDFC0007FFFFF800003FFFFDF80003FFFFF000003FFFFDF80003F
FFFF000003FFFFFF00001FFFFE000003FFFFFF00001FFFFE000003FFFFFF00000FFFFC00
0003FFFFFE000007FFF8000003FFFFFE000003FFF0000003FFFFFE000000FFC0000003FF
FFFC0000000000000003FFFFFC0000000000000003FFFFFC0000000000000003FFFFFC00
00000000000003FFFFF80000000000000003FFFFF80000000000000003FFFFF800000000
00000003FFFFF80000000000000003FFFFF80000000000000003FFFFF800000000000000
03FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFF
F00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000
000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000
000003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003
FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF0
0000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF0000000
0000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF0000000000000
0003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003FF
FFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF000
00000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF000000000
00000003FFFFF00000000000000003FFFFF00000000000000003FFFFF000000000000000
03FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFF
F00000000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000
000000000003FFFFF00000000000000003FFFFF00000000000000003FFFFF00000000000
00FFFFFFFFFFFFFC00000000FFFFFFFFFFFFFC00000000FFFFFFFFFFFFFC00000000FFFF
FFFFFFFFFC00000000FFFFFFFFFFFFFC00000000FFFFFFFFFFFFFC00000000FFFFFFFFFF
FFFC00000000FFFFFFFFFFFFFC00000000FFFFFFFFFFFFFC00000000515D79DC5F>114
D<0000001FFFF80000F800000003FFFFFFC001FC0000003FFFFFFFFC07FC000000FFFFFF
FFFF1FFC000003FFFFFFFFFFFFFC00000FFFFFFFFFFFFFFC00003FFFF8001FFFFFFC0000
7FFF000000FFFFFC0000FFF80000003FFFFC0001FFE00000000FFFFC0003FFC000000003
FFFC0007FF8000000001FFFC000FFF0000000000FFFC000FFF00000000007FFC001FFE00
000000003FFC001FFE00000000001FFC003FFC00000000001FFC003FFC00000000001FFC
007FFC00000000000FFC007FFC00000000000FFC007FFC00000000000FFC007FFC000000
000007FC00FFFE000000000007FC00FFFE000000000007FC00FFFF000000000007FC00FF
FF000000000007FC00FFFF800000000007FC00FFFFE00000000003F800FFFFF000000000
000000FFFFFC00000000000000FFFFFF00000000000000FFFFFFF00000000000007FFFFF
FF8000000000007FFFFFFFFC00000000007FFFFFFFFFF0000000003FFFFFFFFFFF800000
003FFFFFFFFFFFF00000001FFFFFFFFFFFFE0000001FFFFFFFFFFFFF8000000FFFFFFFFF
FFFFE000000FFFFFFFFFFFFFF0000007FFFFFFFFFFFFFC000003FFFFFFFFFFFFFE000001
FFFFFFFFFFFFFF800000FFFFFFFFFFFFFFC000007FFFFFFFFFFFFFE000001FFFFFFFFFFF
FFF000000FFFFFFFFFFFFFF8000003FFFFFFFFFFFFF8000000FFFFFFFFFFFFFC0000003F
FFFFFFFFFFFE0000000FFFFFFFFFFFFE00000001FFFFFFFFFFFF000000001FFFFFFFFFFF
00000000007FFFFFFFFF800000000003FFFFFFFF8000000000000FFFFFFFC00000000000
00FFFFFFC00000000000003FFFFFC00000000000000FFFFFE07F000000000003FFFFE0FF
800000000001FFFFE0FF8000000000007FFFE0FF8000000000003FFFE0FFC00000000000
3FFFE0FFC000000000001FFFE0FFC000000000000FFFE0FFE000000000000FFFE0FFE000
000000000FFFE0FFE0000000000007FFE0FFF0000000000007FFE0FFF0000000000007FF
C0FFF8000000000007FFC0FFF8000000000007FFC0FFFC000000000007FFC0FFFC000000
000007FF80FFFE00000000000FFF80FFFF00000000000FFF80FFFF00000000000FFF00FF
FF80000000001FFF00FFFFC0000000001FFE00FFFFE0000000003FFE00FFFFF000000000
7FFC00FFFFFC00000000FFF800FFFFFE00000003FFF000FFFFFF80000007FFE000FFFFFF
F000003FFFC000FFFFFFFF0007FFFF8000FFF9FFFFFFFFFFFF0000FFF07FFFFFFFFFFC00
00FFE01FFFFFFFFFF00000FF8007FFFFFFFFC00000FF0001FFFFFFFF000000FE00003FFF
FFF80000007C000003FFFE000000004B5F78DD5C>I[<00000003FE0000000000000003FE
0000000000000003FE0000000000000003FE0000000000000003FE0000000000000003FE
0000000000000003FE0000000000000003FE0000000000000007FE0000000000000007FE
0000000000000007FE0000000000000007FE0000000000000007FE000000000000000FFE
000000000000000FFE000000000000000FFE000000000000000FFE000000000000001FFE
000000000000001FFE000000000000001FFE000000000000003FFE000000000000003FFE
000000000000007FFE000000000000007FFE00000000000000FFFE00000000000000FFFE
00000000000001FFFE00000000000001FFFE00000000000003FFFE00000000000007FFFE
00000000000007FFFE0000000000000FFFFE0000000000001FFFFE0000000000003FFFFE
0000000000007FFFFE000000000000FFFFFE000000000003FFFFFE000000000007FFFFFE
00000000001FFFFFFE00000000007FFFFFFFFFFFFFF007FFFFFFFFFFFFFFF0FFFFFFFFFF
FFFFFFF0FFFFFFFFFFFFFFFFF0FFFFFFFFFFFFFFFFF0FFFFFFFFFFFFFFFFF0FFFFFFFFFF
FFFFFFF0FFFFFFFFFFFFFFFFF0FFFFFFFFFFFFFFFFF00000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE000000000000FFFFFE
000000000000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE
000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE
000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE
000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE000001FF0000FFFFFE
000001FF0000FFFFFE000001FF0000FFFFFE000003FF00007FFFFE000003FE00007FFFFF
000003FE00007FFFFF000003FE00007FFFFF000007FE00003FFFFF000007FC00003FFFFF
800007FC00001FFFFF80000FF800001FFFFFC0001FF800000FFFFFE0003FF000000FFFFF
F0007FF0000007FFFFF800FFE0000003FFFFFF03FFC0000001FFFFFFFFFF80000000FFFF
FFFFFF000000003FFFFFFFFE000000001FFFFFFFFC0000000007FFFFFFF80000000000FF
FFFFE000000000001FFFFF80000000000000FFFC0000>72 132 124
258 90 I<0000000FF80000000000001FF00000007FFFFFF800000000FFFFFFF00000FF
FFFFFFF8000001FFFFFFFFF00000FFFFFFFFF8000001FFFFFFFFF00000FFFFFFFFF80000
01FFFFFFFFF00000FFFFFFFFF8000001FFFFFFFFF00000FFFFFFFFF8000001FFFFFFFFF0
0000FFFFFFFFF8000001FFFFFFFFF00000FFFFFFFFF8000001FFFFFFFFF00000FFFFFFFF
F8000001FFFFFFFFF00000FFFFFFFFF8000001FFFFFFFFF00000003FFFFFF8000000007F
FFFFF000000007FFFFF8000000000FFFFFF000000007FFFFF8000000000FFFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0
00000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFF
F80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007
FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF0000000
03FFFFF80000000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF80000
000007FFFFF000000003FFFFF80000000007FFFFF000000003FFFFF8000000000FFFFFF0
00000003FFFFF8000000000FFFFFF000000003FFFFF8000000000FFFFFF000000003FFFF
F8000000000FFFFFF000000003FFFFF8000000001FFFFFF000000003FFFFF8000000001F
FFFFF000000003FFFFF8000000003FFFFFF000000003FFFFF8000000003FFFFFF0000000
01FFFFF8000000003FFFFFF000000001FFFFF8000000007FFFFFF000000001FFFFF80000
0000FFFFFFF000000001FFFFF800000000FFFFFFF000000000FFFFF800000001FBFFFFF0
00000000FFFFFC00000003FBFFFFF0000000007FFFFC00000007F3FFFFF0000000007FFF
FC0000000FE3FFFFF8000000003FFFFE0000001FE3FFFFF8000000003FFFFE0000007FC3
FFFFFF000000001FFFFF800000FF83FFFFFFFFC000000FFFFFC00003FF03FFFFFFFFC000
0007FFFFFC003FFE03FFFFFFFFC0000003FFFFFFFFFFFC03FFFFFFFFC0000000FFFFFFFF
FFF803FFFFFFFFC00000007FFFFFFFFFE003FFFFFFFFC00000001FFFFFFFFF8003FFFFFF
FFC000000003FFFFFFFE0003FFFFFFFFC0000000007FFFFFF80003FFFFFFFFC000000000
01FFFFC00003FFFF000000725E77DC81>I<FFFFFFFFFFFE007FFFFFFFFFF800003FFFFF
FFF8FFFFFFFFFFFE007FFFFFFFFFF800003FFFFFFFF8FFFFFFFFFFFE007FFFFFFFFFF800
003FFFFFFFF8FFFFFFFFFFFE007FFFFFFFFFF800003FFFFFFFF8FFFFFFFFFFFE007FFFFF
FFFFF800003FFFFFFFF8FFFFFFFFFFFE007FFFFFFFFFF800003FFFFFFFF8FFFFFFFFFFFE
007FFFFFFFFFF800003FFFFFFFF8FFFFFFFFFFFE007FFFFFFFFFF800003FFFFFFFF8FFFF
FFFFFFFE007FFFFFFFFFF800003FFFFFFFF8000FFFFFF000000007FFFFC0000000003FFF
F800000FFFFFF000000007FFFFC00000000003FF80000007FFFFF800000003FFFFC00000
000001FF00000007FFFFF800000003FFFFE00000000003FF00000003FFFFF800000003FF
FFE00000000003FE00000003FFFFFC00000001FFFFF00000000007FE00000003FFFFFC00
000001FFFFF00000000007FE00000001FFFFFE00000000FFFFF00000000007FC00000001
FFFFFE00000000FFFFF8000000000FFC00000000FFFFFE00000000FFFFF8000000000FF8
00000000FFFFFF000000007FFFFC000000001FF800000000FFFFFF000000007FFFFC0000
00001FF8000000007FFFFF800000003FFFFC000000001FF0000000007FFFFF800000007F
FFFE000000003FF0000000003FFFFF800000007FFFFE000000003FE0000000003FFFFFC0
000000FFFFFF000000007FE0000000003FFFFFC0000000FFFFFF000000007FE000000000
1FFFFFC0000000FFFFFF000000007FC0000000001FFFFFE0000001FFFFFF80000000FFC0
000000000FFFFFE0000001FFFFFF80000000FF80000000000FFFFFF0000003FFFFFF8000
0001FF80000000000FFFFFF0000003FFFFFFC0000001FF800000000007FFFFF0000003FF
FFFFC0000001FF000000000007FFFFF8000007FFFFFFE0000003FF000000000003FFFFF8
000007FFFFFFE0000003FE000000000003FFFFFC00000FFDFFFFE0000007FE0000000000
03FFFFFC00000FFDFFFFF0000007FE000000000001FFFFFC00000FF8FFFFF0000007FC00
0000000001FFFFFE00001FF8FFFFF800000FFC000000000000FFFFFE00001FF8FFFFF800
000FF8000000000000FFFFFF00003FF07FFFF800001FF8000000000000FFFFFF00003FF0
7FFFFC00001FF80000000000007FFFFF00003FE03FFFFC00001FF00000000000007FFFFF
80007FE03FFFFE00003FF00000000000003FFFFF80007FE03FFFFE00003FE00000000000
003FFFFFC000FFC01FFFFE00007FE00000000000003FFFFFC000FFC01FFFFF00007FE000
00000000001FFFFFC000FF800FFFFF00007FC00000000000001FFFFFE001FF800FFFFF80
00FFC00000000000001FFFFFE001FF800FFFFF8000FFC00000000000000FFFFFF001FF00
07FFFF8001FF800000000000000FFFFFF003FF0007FFFFC001FF8000000000000007FFFF
F003FE0003FFFFC001FF0000000000000007FFFFF807FE0003FFFFE003FF000000000000
0007FFFFF807FE0003FFFFE003FF0000000000000003FFFFFC07FC0001FFFFE007FE0000
000000000003FFFFFC0FFC0001FFFFF007FE0000000000000001FFFFFC0FF80000FFFFF0
07FC0000000000000001FFFFFE1FF80000FFFFF80FFC0000000000000001FFFFFE1FF800
00FFFFF80FFC0000000000000000FFFFFF1FF000007FFFF81FF80000000000000000FFFF
FF3FF000007FFFFC1FF800000000000000007FFFFF3FE000003FFFFC1FF0000000000000
00007FFFFFFFE000003FFFFE3FF000000000000000007FFFFFFFE000003FFFFE3FF00000
0000000000003FFFFFFFC000001FFFFE7FE000000000000000003FFFFFFFC000001FFFFF
7FE000000000000000001FFFFFFF8000000FFFFF7FC000000000000000001FFFFFFF8000
000FFFFFFFC000000000000000001FFFFFFF8000000FFFFFFFC000000000000000000FFF
FFFF00000007FFFFFF8000000000000000000FFFFFFF00000007FFFFFF80000000000000
000007FFFFFE00000003FFFFFF00000000000000000007FFFFFE00000003FFFFFF000000
00000000000007FFFFFE00000003FFFFFF00000000000000000003FFFFFC00000001FFFF
FE00000000000000000003FFFFFC00000001FFFFFE00000000000000000001FFFFF80000
0000FFFFFC00000000000000000001FFFFF800000000FFFFFC00000000000000000001FF
FFF800000000FFFFFC00000000000000000000FFFFF0000000007FFFF800000000000000
000000FFFFF0000000007FFFF8000000000000000000007FFFE0000000003FFFF0000000
000000000000007FFFE0000000003FFFF0000000000000000000007FFFE0000000003FFF
F0000000000000000000003FFFC0000000001FFFE0000000000000000000003FFFC00000
00001FFFE0000000000000000000001FFF80000000000FFFC0000000000000000000001F
FF80000000000FFFC0000000000000000000001FFF80000000000FFFC000000000000000
0000000FFF000000000007FF80000000000000000000000FFF000000000007FF80000000
0000000000000007FE000000000003FF000000000000000000000003FC000000000001FE
0000000000009D5D7BDBA8>119 D<7FFFFFFFFFFF800001FFFFFFFFFE007FFFFFFFFFFF
800001FFFFFFFFFE007FFFFFFFFFFF800001FFFFFFFFFE007FFFFFFFFFFF800001FFFFFF
FFFE007FFFFFFFFFFF800001FFFFFFFFFE007FFFFFFFFFFF800001FFFFFFFFFE007FFFFF
FFFFFF800001FFFFFFFFFE007FFFFFFFFFFF800001FFFFFFFFFE007FFFFFFFFFFF800001
FFFFFFFFFE000000FFFFFF000000000FFFFFC0000000007FFFFF8000000001FFF0000000
00007FFFFFC000000001FFE000000000003FFFFFE000000003FFC000000000001FFFFFF0
00000007FF8000000000000FFFFFF00000000FFF00000000000007FFFFF80000000FFE00
000000000007FFFFFC0000001FFE00000000000003FFFFFE0000003FFC00000000000001
FFFFFF0000007FF800000000000000FFFFFF000000FFF0000000000000007FFFFF800001
FFE0000000000000007FFFFFC00003FFC0000000000000003FFFFFE00007FF8000000000
0000001FFFFFF00007FF80000000000000000FFFFFF8000FFF000000000000000007FFFF
F8001FFE000000000000000007FFFFFC003FFC000000000000000003FFFFFE007FF80000
00000000000001FFFFFF00FFF0000000000000000000FFFFFF81FFE00000000000000000
007FFFFF81FFC00000000000000000003FFFFFC3FFC00000000000000000003FFFFFE7FF
800000000000000000001FFFFFFFFF000000000000000000000FFFFFFFFE000000000000
0000000007FFFFFFFC0000000000000000000003FFFFFFF80000000000000000000003FF
FFFFF00000000000000000000001FFFFFFF00000000000000000000000FFFFFFE0000000
00000000000000007FFFFFC000000000000000000000003FFFFFC0000000000000000000
00003FFFFFE000000000000000000000001FFFFFF000000000000000000000000FFFFFF8
000000000000000000000007FFFFFC000000000000000000000003FFFFFC000000000000
000000000001FFFFFE000000000000000000000001FFFFFF000000000000000000000003
FFFFFF800000000000000000000007FFFFFFC0000000000000000000000FFFFFFFC00000
00000000000000001FFFFFFFE0000000000000000000001FFFFFFFF00000000000000000
00003FFFFFFFF8000000000000000000007FFFFFFFFC00000000000000000000FFF3FFFF
FE00000000000000000001FFE1FFFFFE00000000000000000003FFC1FFFFFF0000000000
0000000007FF80FFFFFF80000000000000000007FF007FFFFFC000000000000000000FFF
003FFFFFE000000000000000001FFE001FFFFFE000000000000000003FFC001FFFFFF000
000000000000007FF8000FFFFFF80000000000000000FFF00007FFFFFC00000000000000
01FFE00003FFFFFE0000000000000003FFC00001FFFFFE0000000000000003FFC00000FF
FFFF0000000000000007FF800000FFFFFF800000000000000FFF0000007FFFFFC0000000
0000001FFE0000003FFFFFE00000000000003FFC0000001FFFFFE00000000000007FF800
00000FFFFFF0000000000000FFF00000000FFFFFF8000000000000FFE000000007FFFFFC
000000000001FFE000000003FFFFFE000000000003FFC000000001FFFFFF000000000007
FF8000000000FFFFFF00000000000FFF0000000000FFFFFF80000000001FFE0000000000
7FFFFFC0000000003FFE00000000003FFFFFE00000000FFFFFE0000000001FFFFFF00000
FFFFFFFFFF0000001FFFFFFFFFFFE0FFFFFFFFFF0000001FFFFFFFFFFFE0FFFFFFFFFF00
00001FFFFFFFFFFFE0FFFFFFFFFF0000001FFFFFFFFFFFE0FFFFFFFFFF0000001FFFFFFF
FFFFE0FFFFFFFFFF0000001FFFFFFFFFFFE0FFFFFFFFFF0000001FFFFFFFFFFFE0FFFFFF
FFFF0000001FFFFFFFFFFFE0FFFFFFFFFF0000001FFFFFFFFFFFE0735C7CDB7B>I<7FFF
FFFFFFFFC0000001FFFFFFFF807FFFFFFFFFFFC0000001FFFFFFFF807FFFFFFFFFFFC000
0001FFFFFFFF807FFFFFFFFFFFC0000001FFFFFFFF807FFFFFFFFFFFC0000001FFFFFFFF
807FFFFFFFFFFFC0000001FFFFFFFF807FFFFFFFFFFFC0000001FFFFFFFF807FFFFFFFFF
FFC0000001FFFFFFFF807FFFFFFFFFFFC0000001FFFFFFFF800003FFFFFE000000000007
FFFF00000001FFFFFE000000000000FFF000000001FFFFFE0000000000007FE000000000
FFFFFF000000000000FFC000000000FFFFFF000000000000FFC0000000007FFFFF800000
000000FF80000000007FFFFF800000000001FF80000000007FFFFFC00000000001FF8000
0000003FFFFFC00000000003FF00000000003FFFFFE00000000003FF00000000001FFFFF
E00000000007FE00000000001FFFFFF00000000007FE00000000000FFFFFF0000000000F
FC00000000000FFFFFF0000000000FFC000000000007FFFFF8000000001FF80000000000
07FFFFF8000000001FF8000000000003FFFFFC000000001FF0000000000003FFFFFC0000
00003FF0000000000001FFFFFE000000003FE0000000000001FFFFFE000000007FE00000
00000001FFFFFF000000007FE0000000000000FFFFFF00000000FFC0000000000000FFFF
FF80000000FFC00000000000007FFFFF80000001FF800000000000007FFFFFC0000001FF
800000000000003FFFFFC0000003FF000000000000003FFFFFC0000003FF000000000000
001FFFFFE0000007FE000000000000001FFFFFE0000007FE000000000000000FFFFFF000
0007FC000000000000000FFFFFF000000FFC000000000000000FFFFFF800000FFC000000
0000000007FFFFF800001FF80000000000000007FFFFFC00001FF80000000000000003FF
FFFC00003FF00000000000000003FFFFFE00003FF00000000000000001FFFFFE00007FE0
0000000000000001FFFFFE00007FE00000000000000000FFFFFF0000FFC0000000000000
0000FFFFFF0000FFC000000000000000007FFFFF8000FF8000000000000000007FFFFF80
01FF8000000000000000003FFFFFC001FF0000000000000000003FFFFFC003FF00000000
00000000003FFFFFE003FF0000000000000000001FFFFFE007FE0000000000000000001F
FFFFF007FE0000000000000000000FFFFFF00FFC0000000000000000000FFFFFF00FFC00
000000000000000007FFFFF81FF800000000000000000007FFFFF81FF800000000000000
000003FFFFFC3FF000000000000000000003FFFFFC3FF000000000000000000001FFFFFE
3FE000000000000000000001FFFFFE7FE000000000000000000001FFFFFF7FE000000000
000000000000FFFFFFFFC000000000000000000000FFFFFFFFC000000000000000000000
7FFFFFFF80000000000000000000007FFFFFFF80000000000000000000003FFFFFFF0000
0000000000000000003FFFFFFF00000000000000000000001FFFFFFE0000000000000000
0000001FFFFFFE00000000000000000000000FFFFFFC00000000000000000000000FFFFF
FC00000000000000000000000FFFFFFC000000000000000000000007FFFFF80000000000
00000000000007FFFFF8000000000000000000000003FFFFF00000000000000000000000
03FFFFF0000000000000000000000001FFFFE0000000000000000000000001FFFFE00000
00000000000000000000FFFFC0000000000000000000000000FFFFC00000000000000000
000000007FFF800000000000000000000000007FFF800000000000000000000000003FFF
000000000000000000000000003FFF000000000000000000000000003FFF000000000000
000000000000001FFE000000000000000000000000001FFE000000000000000000000000
000FFC000000000000000000000000000FFC000000000000000000000000001FF8000000
000000000000000000001FF8000000000000000000000000003FF0000000000000000000
000000003FF0000000000000000000000000003FE0000000000000000000000000007FE0
000000000000000000000000007FE000000000000000000000000000FFC0000000000000
00000000000000FFC000000000000000000000000001FF800000000000000000FE000000
01FF800000000000000003FF80000003FF00000000000000000FFFE0000003FF00000000
000000001FFFF0000007FE00000000000000003FFFF8000007FE00000000000000007FFF
FC00000FFC00000000000000007FFFFC00000FFC00000000000000007FFFFC00000FF800
00000000000000FFFFFE00001FF80000000000000000FFFFFE00003FF000000000000000
00FFFFFE00003FF00000000000000000FFFFFE00007FE00000000000000000FFFFFE0000
FFE00000000000000000FFFFFE0000FFC00000000000000000FFFFFE0001FF8000000000
00000000FFFFFC0003FF0000000000000000007FFFFC0007FF0000000000000000007FFF
FC000FFE0000000000000000003FFFF8003FFC0000000000000000003FFFF0007FF80000
000000000000001FFFE001FFF00000000000000000001FFE8007FFE00000000000000000
000FFFC03FFFC000000000000000000007FFFFFFFF0000000000000000000003FFFFFFFE
0000000000000000000001FFFFFFF800000000000000000000007FFFFFF0000000000000
00000000001FFFFFC0000000000000000000000007FFFE00000000000000000000000000
7FE0000000000000000000000071857CDB7B>I E /Fw 1 23 df<0003800000000007E0
000700000FE0000F80000FE0001F80000FC0001F80000FC0001F80001FC0003F80001FC0
003F80001F80003F00001F80003F00003F80007F00003F80007F00003F00007E00003F00
007E00007F0000FE00007F0000FE00007E0000FC00007E0000FC0000FE0001FC0000FE00
01FC0000FC0001F80000FC0001F80001FC0003F80001FC0003F80001F80003F01801F800
03F01803F80007F01803F80007F03803F80007E03003F8000FE03007F8000FE07007F800
1FE06007F8003FE06007FC0077E0E00FFE00E3E1C00FFF03C1F3800FCFFF00FF000FC3FC
003E001FC0000000001FC0000000001F80000000001F80000000003F80000000003F8000
0000003F00000000003F00000000007F00000000007F00000000007E00000000007E0000
000000FE0000000000FE0000000000FC0000000000FC00000000007000000000002D377E
A432>22 D E /Fx 70 125 df<0000380000FC0001FC0003FC0007F8000FF0001FC0003F
80007F0000FE0001FC0003F80003F00007F00007E0000FE0000FC0001F80001F80003F80
003F00003F00007F00007E00007E00007E0000FE0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FE00007E00007E00007E00007F00
003F00003F00003F80001F80001F80000FC0000FE00007E00007F00003F00003F80001FC
0000FE00007F00003F80001FC0000FF00007F80003FC0001FC0000FC000038164272B92C
>40 D<700000FC0000FE0000FF00007F80003FC0000FE00007F00003F80001FC0000FE00
007F00003F00003F80001F80001FC0000FC00007E00007E00007F00003F00003F00003F8
0001F80001F80001F80001FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC
0000FC0000FC0000FC0000FC0001FC0001F80001F80001F80003F80003F00003F00007F0
0007E00007E0000FC0001FC0001F80003F80003F00007F0000FE0001FC0003F80007F000
0FE0003FC0007F8000FF0000FE0000FC0000700000164279B92C>I<000380000007C000
0007C0000007C0000007C0000007C0000007C0002007C008F807C03EFE07C0FEFF07C1FE
FFC7C7FEFFE7CFFE3FFFFFF80FFFFFE003FFFF8001FFFF00007FFC00007FFC0001FFFF00
03FFFF800FFFFFE03FFFFFF8FFE7CFFEFFC7C7FEFF07C1FEFE07C0FEF807C03E2007C008
0007C0000007C0000007C0000007C0000007C0000007C000000380001F247AAA2C>I<00
007800000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000
FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC
00000000FC00007FFFFFFFF0FFFFFFFFF8FFFFFFFFF8FFFFFFFFF8FFFFFFFFF87FFFFFFF
F00000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC0000
0000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC000000
00FC0000000078000025267DAB2C>I<7FFFFFFF00FFFFFFFF80FFFFFFFF80FFFFFFFF80
FFFFFFFF807FFFFFFF0021067B9B2C>45 D<1F003F807FC0FFE0FFE0FFE0FFE0FFE07FC0
3F801F000B0B708A2C>I<00000007000000000F800000001F800000001F800000003F80
0000003F000000007F000000007E00000000FE00000000FC00000001FC00000001F80000
0003F800000003F000000003F000000007F000000007E00000000FE00000000FC0000000
1FC00000001F800000003F800000003F000000007F000000007E00000000FE00000000FC
00000000FC00000001FC00000001F800000003F800000003F000000007F000000007E000
00000FE00000000FC00000001FC00000001F800000001F800000003F800000003F000000
007F000000007E00000000FE00000000FC00000001FC00000001F800000003F800000003
F000000007F000000007E000000007E00000000FE00000000FC00000001FC00000001F80
0000003F800000003F000000007F000000007E00000000FE00000000FC00000000FC0000
0000F800000000780000000021417BB92C>I<0003F80000000FFE0000003FFF8000007F
FFC00000FFFFE00001FE0FF00003F803F80007F001FC0007E000FC000FC0007E000FC000
7E001F80003F001F80003F003F00001F803F00001F803E00000F807E00000FC07E00000F
C07E00000FC07C000007C0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0
FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FE
00000FE07E00000FC07E00000FC07E00000FC07E00000FC03F00001F803F00001F803F00
001F801F80003F001F80003F000FC0007E000FE000FE0007E000FC0007F001FC0003F803
F80001FE0FF00000FFFFE000007FFFC000003FFF8000000FFE00000003F8000023357CB3
2C>I<00070000000F8000000F8000001F8000001F8000003F8000007F800000FF800001
FF800007FF80007FFF8000FFFF8000FFDF8000FF9F80007C1F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F800000
1F8000001F8000001F80007FFFFFE0FFFFFFF0FFFFFFF0FFFFFFF07FFFFFE01C3477B32C
>I<000FF80000007FFF800001FFFFE00007FFFFF0000FFFFFFC001FF80FFE003FE001FF
003F80007F007F00003F807E00001F80FE00001FC0FE00000FC0FF00000FE0FF000007E0
FF000007E0FF000007E07E000007E03C000007E000000007E000000007E00000000FE000
00000FC00000001FC00000001F800000003F800000003F000000007F00000000FE000000
01FC00000003FC00000007F80000000FF00000001FE00000003FC0000000FF80000001FE
00000003FC00000007F80000000FF00000003FE00000007F80000000FF00000001FE0000
0003FC0003C007F80007E01FE00007E03FC00007E07FFFFFFFE0FFFFFFFFE0FFFFFFFFE0
FFFFFFFFE07FFFFFFFC023347CB32C>I<000FFC0000007FFF800001FFFFE00007FFFFF8
000FFFFFFC001FF807FE001FC000FE003F80007F003FC0003F003FC0003F803FC0001F80
3FC0001F801F80001F800F00001F800000001F800000003F800000003F000000007F0000
0000FE00000001FE00000003FC0000001FF800001FFFF000003FFFE000003FFFE000003F
FFF800001FFFFC00000007FE00000000FF000000007F000000003F800000001FC0000000
0FC00000000FC00000000FE000000007E000000007E03C000007E07E000007E0FF000007
E0FF00000FE0FF00000FC0FF00000FC0FE00001FC07F00003F807F80007F003FC000FF00
1FF807FE000FFFFFFC0007FFFFF80003FFFFE000007FFF8000000FFC000023357CB32C>
I<00003FC0000001FFF8000007FFFC00001FFFFE00003FFFFF00007FE07F0000FF003F80
01FE007F8003F8007F8007F0007F8007E0007F800FE0003F001FC0001E001F800000003F
800000003F000000003F000000007F000000007E000000007E03FE00007E1FFF8000FC7F
FFE000FDFFFFF000FFFFFFF800FFFE07FC00FFF001FE00FFC0007F00FF80003F80FF0000
1F80FF00001FC0FE00000FC0FE00000FE0FE000007E0FE000007E0FE000007E07E000007
E07E000007E07E000007E07E000007E03F000007E03F00000FE03F80000FC01F80001FC0
1FC0001F800FC0003F800FE0007F0007F801FE0003FE07FC0001FFFFF80000FFFFF00000
7FFFE000001FFF80000007FC000023357CB32C>54 D<0007FC0000003FFF800000FFFFE0
0003FFFFF80007FFFFFC000FFC07FE001FF001FF001FC0007F003F80003F803F00001F80
7F00001FC07E00000FC07E00000FC07E00000FC07E00000FC07E00000FC03F00001F803F
00001F801F80003F001FC0007F000FF001FE0003FC07F80001FFFFF000007FFFC0000007
FC0000007FFFC00001FFFFF00003FC07F8000FF001FE001FC0007F001F80003F003F0000
1F807E00000FC07E00000FC0FC000007E0FC000007E0FC000007E0FC000007E0FC000007
E0FC000007E0FC000007E07E00000FC07E00000FC07F00001FC03F80003F801FC0007F00
1FF001FF000FFC07FE0007FFFFFC0003FFFFF80000FFFFE000003FFF80000007FC000023
357CB32C>56 D<1F003F807FC0FFE0FFE0FFE0FFE0FFE07FC03F801F0000000000000000
0000000000000000000000000000000000000000001F003F807FC0FFE0FFE0FFE0FFE0FF
E07FC03F801F000B2470A32C>58 D<00000007000000001F800000003F80000000FF8000
0003FF80000007FF0000001FFC0000003FF8000000FFE0000001FF80000007FF0000000F
FC0000003FF80000007FE0000001FFC0000003FF0000000FFE0000001FF80000007FF000
0000FFC0000000FF80000000FF80000000FFC00000007FF00000001FF80000000FFE0000
0003FF00000001FFC00000007FE00000003FF80000000FFC00000007FF00000001FF8000
0000FFE00000003FF80000001FFC00000007FF00000003FF80000000FF800000003F8000
00001F800000000700212A7BAD2C>60 D<7000000000FC00000000FE00000000FF800000
00FFE00000007FF00000001FFC0000000FFE00000003FF80000000FFC00000007FF00000
001FF80000000FFE00000003FF00000001FFC00000007FE00000003FF80000000FFC0000
0007FF00000001FF80000000FF80000000FF80000001FF80000007FF0000000FFC000000
3FF80000007FE0000001FFC0000003FF0000000FFE0000001FF80000007FF0000000FFC0
000003FF8000000FFE0000001FFC0000007FF0000000FFE0000000FF80000000FE000000
00FC000000007000000000212A7BAD2C>62 D<0000FE00000001FF00000001FF00000001
FF00000001FF00000003FF80000003FF80000003EF80000003EF80000007EF80000007EF
C0000007EFC0000007C7C0000007C7C000000FC7E000000FC7E000000FC7E000000FC3E0
00001F83F000001F83F000001F83F000001F83F000001F83F000003F01F800003F01F800
003F01F800003F01F800007E00FC00007E00FC00007E00FC00007E00FC00007E00FC0000
FC007E0000FFFFFE0000FFFFFE0000FFFFFE0001FFFFFF0001FFFFFF0001F8003F0001F8
003F0001F8003F0003F0001F8003F0001F8003F0001F8003F0001F8007F0001FC007E000
0FC07FFE00FFFC7FFF01FFFCFFFF01FFFE7FFF01FFFC7FFE00FFFC27347EB32C>65
D<7FFFFFE0007FFFFFF800FFFFFFFE007FFFFFFF007FFFFFFFC003F0003FC003F0000FE0
03F00007F003F00003F003F00003F003F00001F803F00001F803F00001F803F00001F803
F00001F803F00001F803F00003F003F00003F003F00007F003F0000FE003F0001FC003F0
00FF8003FFFFFF0003FFFFFE0003FFFFFC0003FFFFFF0003FFFFFFC003F0001FE003F000
07F003F00003F803F00001F803F00000FC03F00000FC03F00000FE03F000007E03F00000
7E03F000007E03F000007E03F000007E03F000007E03F00000FE03F00000FC03F00001FC
03F00003F803F0000FF803F0003FF07FFFFFFFE07FFFFFFFC0FFFFFFFF807FFFFFFE007F
FFFFF00027337FB22C>I<0000FF00700007FFE0F8000FFFF9F8003FFFFDF8007FFFFFF8
00FF81FFF801FE007FF803FC001FF807F0000FF807F00007F80FE00007F80FC00003F81F
800003F81F800001F83F000001F83F000001F87F000001F87E000000F07E000000007E00
000000FE00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC0000
0000FC00000000FC00000000FC00000000FC00000000FC00000000FE000000007E000000
007E000000007E000000007F000000F03F000001F83F000001F81F800001F81F800001F8
0FC00003F80FE00003F007F00007F007F00007E003FC001FE001FE003FC000FF81FF8000
7FFFFF00003FFFFE00000FFFFC000007FFF0000000FF800025357DB32C>I<7FFFFF0000
FFFFFFC000FFFFFFF000FFFFFFF8007FFFFFFC0007E003FE0007E000FF0007E0007F8007
E0003F8007E0001FC007E0000FE007E0000FE007E00007E007E00007F007E00003F007E0
0003F807E00001F807E00001F807E00001F807E00001F807E00000FC07E00000FC07E000
00FC07E00000FC07E00000FC07E00000FC07E00000FC07E00000FC07E00000FC07E00000
FC07E00000FC07E00000FC07E00001F807E00001F807E00001F807E00003F807E00003F0
07E00003F007E00007F007E00007E007E0000FE007E0001FC007E0003FC007E0007F8007
E000FF0007E003FE007FFFFFFC00FFFFFFF800FFFFFFF000FFFFFFC0007FFFFF00002633
7EB22C>I<7FFFFFFFF0FFFFFFFFF8FFFFFFFFF8FFFFFFFFF87FFFFFFFF803F00001F803
F00001F803F00001F803F00001F803F00001F803F00001F803F00001F803F00000F003F0
00000003F000000003F000000003F000000003F001E00003F003F00003F003F00003F003
F00003F003F00003FFFFF00003FFFFF00003FFFFF00003FFFFF00003FFFFF00003F003F0
0003F003F00003F003F00003F003F00003F001E00003F000000003F000000003F0000000
03F000000003F000000003F000003C03F000007E03F000007E03F000007E03F000007E03
F000007E03F000007E03F000007E03F000007E7FFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFF
FFFFFE7FFFFFFFFC27337EB22C>I<7FFFFFFFF8FFFFFFFFFCFFFFFFFFFCFFFFFFFFFC7F
FFFFFFFC03F00000FC03F00000FC03F00000FC03F00000FC03F00000FC03F00000FC03F0
0000FC03F000007803F000000003F000000003F000000003F000000003F000000003F000
F00003F001F80003F001F80003F001F80003F001F80003FFFFF80003FFFFF80003FFFFF8
0003FFFFF80003FFFFF80003F001F80003F001F80003F001F80003F001F80003F000F000
03F000000003F000000003F000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F00000007FFFE00000FFFF
E00000FFFFF00000FFFFE000007FFFE0000026337EB22C>I<0001FC0380000FFF87C000
1FFFEFC0007FFFFFC000FFFFFFC001FF07FFC003FC01FFC003F800FFC007F0007FC00FE0
003FC00FC0001FC01FC0001FC01F80001FC03F80000FC03F00000FC03F00000FC07E0000
0FC07E000007807E000000007E00000000FE00000000FC00000000FC00000000FC000000
00FC00000000FC00000000FC00000000FC00000000FC00000000FC0003FFF8FC0007FFFC
FC0007FFFCFE0007FFFC7E0003FFF87E00000FC07E00000FC07E00000FC03F00001FC03F
00001FC03F80001FC01F80001FC01FC0003FC00FC0003FC00FE0007FC007F0007FC003F8
00FFC003FC01FFC001FF07FFC000FFFFFFC0007FFFEFC0001FFFCFC0000FFF07800001FC
000026357DB32C>I<7FFE00FFFCFFFF01FFFEFFFF01FFFEFFFF01FFFE7FFE00FFFC07E0
000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E000
0FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000F
C007E0000FC007E0000FC007FFFFFFC007FFFFFFC007FFFFFFC007FFFFFFC007FFFFFFC0
07E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007
E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0
000FC007E0000FC007E0000FC007E0000FC007E0000FC07FFE00FFFCFFFF01FFFEFFFF01
FFFEFFFF01FFFE7FFE00FFFC27337EB22C>I<7FFFFFF8FFFFFFFCFFFFFFFCFFFFFFFC7F
FFFFF8000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC00000
0FC000000FC000000FC000000FC000000FC000000FC0007FFFFFF8FFFFFFFCFFFFFFFCFF
FFFFFC7FFFFFF81E3379B22C>I<7FFC007FF8FFFE00FFFCFFFE00FFFCFFFE00FFFC7FFC
007FF807C0001F8007C0003F8007C0007F0007C0007E0007C000FC0007C001F80007C003
F80007C007F00007C007E00007C00FC00007C01F800007C03F800007C07F000007C07E00
0007C0FC000007C1F8000007C3F8000007C7FC000007C7FC000007CFFE000007DFBE0000
07FFBF000007FF1F000007FE1F800007FC0FC00007F80FC00007F807E00007F003E00007
E003F00007C001F00007C001F80007C000FC0007C000FC0007C0007E0007C0003E0007C0
003F0007C0001F0007C0001F8007C0000FC007C0000FC007C00007E07FFC001FFCFFFE00
3FFEFFFE003FFEFFFE003FFE7FFC001FFC27337EB22C>75 D<7FFFE00000FFFFF00000FF
FFF00000FFFFF000007FFFE0000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000000003F000000003F000000003F00000
0003F000000003F000000003F000000003F000000003F000000003F000000003F0000000
03F000000003F000000003F000000003F000000003F000000003F000000003F00000F003
F00001F803F00001F803F00001F803F00001F803F00001F803F00001F803F00001F803F0
0001F87FFFFFFFF8FFFFFFFFF8FFFFFFFFF8FFFFFFFFF87FFFFFFFF025337DB22C>I<7F
E0000FFCFFF0001FFEFFF0001FFEFFF8003FFE7FF8003FFC0FF8003FE00FBC007BE00FBC
007BE00FBC007BE00FBC007BE00F9E00F3E00F9E00F3E00F9E00F3E00F9F01F3E00F9F01
F3E00F8F01E3E00F8F01E3E00F8F83E3E00F8F83E3E00F8783C3E00F87C7C3E00F87C7C3
E00F83C783E00F83C783E00F83EF83E00F83EF83E00F81EF03E00F81EF03E00F81FF03E0
0F80FE03E00F80FE03E00F80FE03E00F807C03E00F803803E00F800003E00F800003E00F
800003E00F800003E00F800003E00F800003E00F800003E00F800003E00F800003E00F80
0003E00F800003E00F800003E07FF0001FFCFFF8003FFEFFF8003FFEFFF8003FFE7FF000
1FFC27337EB22C>I<7FF0007FFCFFF800FFFEFFF800FFFEFFFC00FFFE7FFC007FFC07FE
0007C007DE0007C007DE0007C007DF0007C007CF0007C007CF0007C007CF8007C007C780
07C007C7C007C007C7C007C007C3C007C007C3E007C007C3E007C007C1E007C007C1F007
C007C1F007C007C0F007C007C0F807C007C0F807C007C07C07C007C07C07C007C07C07C0
07C03E07C007C03E07C007C01E07C007C01F07C007C01F07C007C00F07C007C00F87C007
C00F87C007C00787C007C007C7C007C007C7C007C003C7C007C003E7C007C001E7C007C0
01E7C007C001F7C007C000F7C007C000F7C007C000FFC07FFC007FC0FFFE007FC0FFFE00
3FC0FFFE003FC07FFC001F8027337EB22C>I<007FFF000003FFFFE0000FFFFFF8001FFF
FFFC003FFFFFFE003FE003FE003F8000FE007F00007F007F00007F007E00003F007E0000
3F007E00003F00FE00003F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F
80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80
FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC
00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FE00
003F80FE00003F807E00003F007E00003F007E00003F007F00007F007F00007F003F8000
FE003FF007FE003FFFFFFE001FFFFFFC000FFFFFF80003FFFFE000007FFF000021357BB3
2C>I<7FFFFFC000FFFFFFF800FFFFFFFC00FFFFFFFF007FFFFFFF8003F000FFC003F000
3FC003F0000FE003F00007F003F00007F003F00003F003F00003F803F00001F803F00001
F803F00001F803F00001F803F00001F803F00001F803F00003F803F00003F003F00007F0
03F00007F003F0000FE003F0003FC003F000FFC003FFFFFF8003FFFFFF0003FFFFFC0003
FFFFF80003FFFFC00003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F00000007FFF800000FFFFC00000FFFFC00000FFFFC000
007FFF80000025337EB22C>I<007FFF000003FFFFE0000FFFFFF8001FFFFFFC003FFFFF
FE003FF007FE003F8000FE007F00007F007F00007F007E00003F007E00003F007E00003F
00FE00003F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80
FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC
00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00001F80FC00
001F80FC00001F80FC00001F80FC00001F80FC00001F80FC01F01F80FC03F81F80FE03F8
3F807E01FC3F007E01FC3F007E00FE3F007F00FE7F007F007F7F003F807FFE003FF03FFE
003FFFFFFE001FFFFFFC000FFFFFF80003FFFFE000007FFFE000000007F000000007F000
000003F800000003F800000001FC00000001FC00000000FE00000000FE000000007F0000
00007F000000003E0021407BB32C>I<7FFFFC000000FFFFFF800000FFFFFFE00000FFFF
FFF800007FFFFFFC000007E007FE000007E001FE000007E0007F000007E0003F800007E0
001F800007E0001F800007E0000FC00007E0000FC00007E0000FC00007E0000FC00007E0
000FC00007E0000FC00007E0001F800007E0001F800007E0003F800007E0007F000007E0
01FE000007E007FE000007FFFFFC000007FFFFF8000007FFFFE0000007FFFFF0000007FF
FFF8000007E007FC000007E001FE000007E000FE000007E0007F000007E0003F000007E0
003F000007E0003F000007E0003F000007E0003F000007E0003F000007E0003F000007E0
003F000007E0003F0F0007E0003F1F8007E0003F1F8007E0003F1F8007E0003F1F8007E0
003F1F807FFE001FBF80FFFF001FFF00FFFF000FFF00FFFF000FFE007FFE0007FC000000
0001F00029347EB22C>I<001FF8070000FFFF0F8001FFFFCF8007FFFFFF800FFFFFFF80
1FF01FFF803FC003FF803F8001FF807F0000FF807E00007F80FE00003F80FC00003F80FC
00001F80FC00001F80FC00001F80FC00001F80FE00000F007E000000007F000000007F80
0000003FE00000001FFC0000001FFFC000000FFFFC000003FFFFC00001FFFFF000007FFF
F8000007FFFC0000007FFE00000007FF00000000FF800000003F800000001FC00000001F
C00000000FE00000000FE078000007E0FC000007E0FC000007E0FC000007E0FC000007E0
FC000007E0FE00000FC0FE00000FC0FF00001F80FF80003F80FFE0007F00FFFE01FF00FF
FFFFFE00FFFFFFFC00F9FFFFF000F83FFFC0007007FF000023357CB32C>I<7FFFFFFFFC
FFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFC007E007EFC007E007EFC007E007EFC
007E007EFC007E007EFC007E007EFC007E007E78007E003C00007E000000007E00000000
7E000000007E000000007E000000007E000000007E000000007E000000007E000000007E
000000007E000000007E000000007E000000007E000000007E000000007E000000007E00
0000007E000000007E000000007E000000007E000000007E000000007E000000007E0000
00007E000000007E000000007E000000007E000000007E000000007E000000007E000000
007E000000007E0000003FFFFC00003FFFFC00007FFFFE00003FFFFC00003FFFFC002733
7EB22C>I<7FFF803FFFC0FFFFC07FFFE0FFFFC07FFFE0FFFFC07FFFE07FFF803FFFC003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F80003F80001F80003F00001F80003F00001
FC0007F00000FC0007E00000FE000FE000007F001FC000003F803F8000003FE0FF800000
1FFFFF0000000FFFFE00000003FFF800000001FFF0000000003F8000002B3480B22C>I<
7FFC007FFCFFFE00FFFEFFFE00FFFEFFFE00FFFE7FFC007FFC0FC00007E00FE0000FE007
E0000FC007E0000FC007E0000FC007F0001FC003F0001F8003F0001F8003F0001F8003F8
003F8001F8003F0001F8003F0001F8003F0001FC007F0000FC007E0000FC007E0000FC00
7E0000FC007E00007E00FC00007E00FC00007E00FC00007E00FC00003F01F800003F01F8
00003F01F800003F01F800001F83F000001F83F000001F83F000001F83F000000F83E000
000FC7E000000FC7E000000FC7E0000007C7C0000007C7C0000007EFC0000007EFC00000
03EF80000003EF80000003FF80000003FF80000001FF00000001FF00000001FF00000001
FF00000000FE000027347EB22C>I<7FF00007FF00FFF8000FFF80FFF8000FFF80FFF800
0FFF807FF00007FF001F0000007C001F0000007C001F0000007C001F0000007C000F8000
00F8000F800000F8000F800000F8000F800000F8000F800000F8000F800000F8000F8000
00F80007C00001F00007C00001F00007C00001F00007C00001F00007C03E01F00007C07F
01F00007C07F01F00007C07F01F00003E0FF83E00003E0FF83E00003E0F783E00003E0F7
83E00003E1F7C3E00003E1F7C3E00003E1F7C3E00001E1E3C3C00001E1E3C3C00001F1E3
C7C00001F3E3E7C00001F3E3E7C00001F3E3E7C00001F3C1E7C00001F3C1E7C00000F3C1
E7800000F3C1E7800000F7C1F7800000F780F7800000F780F7800000F780F7800000FF80
FF8000007F80FF0000007F007F0000007F007F0000007F007F0000007F007F0000003E00
3E000029347FB22C>I<3FFF03FFE07FFF07FFF07FFF87FFF07FFF07FFF03FFF03FFE001
F800FE0001FC00FE0000FC01FC0000FE01FC00007E01F800007F03F800003F03F000003F
87F000001F87E000001FCFE000000FCFC000000FFFC0000007FF80000007FF80000003FF
00000003FF00000001FE00000001FE00000000FC00000000FC00000001FE00000001FE00
000003FF00000003FF00000007FF80000007FFC000000FCFC000000FCFE000001FC7E000
001F87F000003F83F000003F03F800007F01F800007E01FC0000FE00FC0000FC00FE0001
FC007E0001F8007F0003F8003F0003F0003F8003F0001F807FFE00FFFC7FFF01FFFCFFFF
01FFFE7FFF01FFFC7FFE00FFFC27337EB22C>I<7FFC007FFCFFFE00FFFEFFFE00FFFEFF
FE00FFFE7FFC007FFC07F0000FC007F0001FC003F0001F8003F8003F8001F8003F8001FC
007F0000FC007F0000FE007E00007E00FE00007F00FC00003F01FC00003F81F800001F81
F800001F83F000000FC3F000000FC7F0000007E7E0000007E7E0000003E7C0000003EFC0
000001FF80000001FF80000001FF00000000FF00000000FE000000007E000000007E0000
00007E000000007E000000007E000000007E000000007E000000007E000000007E000000
007E000000007E000000007E000000007E000000007E000000007E000000007E00000007
FFE000000FFFF000000FFFF000000FFFF0000007FFE00027337EB22C>I<3FFFFFFFC07F
FFFFFFE07FFFFFFFE07FFFFFFFE07FFFFFFFE07E00001FC07E00003F807E00003F807E00
007F007E00007E007E0000FE007E0001FC003C0001F800000003F800000007F000000007
F00000000FE00000001FC00000001FC00000003F800000007F000000007F00000000FE00
000001FC00000001FC00000003F800000007F000000007F00000000FE00000001FC00000
001FC00000003F800000007F000000007F00000000FE00000001FC00000001FC00000003
F80003C003F00007E007F00007E00FE00007E00FC00007E01FC00007E03F800007E03F80
0007E07F000007E0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE07FFFFFFFC023337C
B22C>I<7FFFFCFFFFFEFFFFFEFFFFFEFFFFFCFC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00
00FC0000FFFFFCFFFFFEFFFFFEFFFFFE7FFFFC17416FB92C>I<7FFFFCFFFFFEFFFFFEFF
FFFE7FFFFE00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00
007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00
007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00
007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00
007E00007E00007E00007E00007E00007E00007E00007E00007E7FFFFEFFFFFEFFFFFEFF
FFFE7FFFFC17417DB92C>93 D<01FFF0000007FFFE00001FFFFF80001FFFFFE0003FFFFF
F0003FC01FF8003FC007F8003FC001FC001F8000FC00060000FE000000007E000000007E
000000007E000000FFFE00001FFFFE0000FFFFFE0003FFFFFE000FFFFFFE001FFF807E00
3FF8007E007FC0007E007F00007E00FE00007E00FC00007E00FC00007E00FC00007E00FC
00007E00FE00007E007F0000FE007F8003FE003FE01FFE001FFFFFFFFC0FFFFFFFFE07FF
FFBFFE01FFFE1FFE003FF007FC27247CA32C>97 D<7FF0000000FFF8000000FFF8000000
FFF80000007FF800000001F800000001F800000001F800000001F800000001F800000001
F800000001F800000001F800000001F800000001F800000001F81FE00001F8FFF80001FB
FFFE0001FFFFFF0001FFFFFF8001FFF07FC001FF801FE001FF0007F001FE0003F801FC00
03F801FC0001FC01F80000FC01F80000FC01F80000FE01F800007E01F800007E01F80000
7E01F800007E01F800007E01F800007E01F800007E01F800007E01F80000FE01FC0000FC
01FC0000FC01FC0001F801FE0003F801FF0007F001FF000FF001FF801FE001FFE07FC001
FFFFFF8001FFFFFF0001FBFFFE0001F8FFF80000F03FC00027337FB22C>I<0003FFE000
001FFFF800007FFFFE0001FFFFFE0003FFFFFF0007FE00FF000FF000FF001FE000FF001F
C0007E003F800018003F000000007F000000007E000000007E00000000FC00000000FC00
000000FC00000000FC00000000FC00000000FC00000000FC00000000FC000000007E0000
00007E000000007F000000003F00000F003F80001F801FC0001F801FE0003F800FF0007F
0007FE03FF0003FFFFFE0001FFFFFC00007FFFF800001FFFE0000003FF000021247AA32C
>I<00000FFE0000001FFF0000001FFF0000001FFF0000000FFF000000003F000000003F
000000003F000000003F000000003F000000003F000000003F000000003F000000003F00
0000003F000007F83F00003FFE3F0000FFFFBF0001FFFFFF0003FFFFFF0007FC0FFF000F
F003FF001FE001FF001FC000FF003F80007F003F00007F007E00003F007E00003F00FE00
003F00FC00003F00FC00003F00FC00003F00FC00003F00FC00003F00FC00003F00FC0000
3F00FC00003F00FE00003F007E00007F007E00007F007F0000FF003F8000FF003F8001FF
001FC003FF000FF007FF0007FC1FFF0003FFFFFFFC01FFFFBFFE00FFFF3FFE003FFC3FFE
000FF01FFC27337DB22C>I<0003FE0000001FFFC000007FFFF00001FFFFF80003FFFFFC
0007FE03FE000FF800FF001FE0003F801FC0003F803F80001FC03F00000FC07F00000FC0
7E00000FE07E000007E0FC000007E0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FF
FFFFFFC0FC00000000FE000000007E000000007E000000007F000000003F000003C03F80
0007E01FC00007E00FF0000FE007F8003FC007FF00FFC001FFFFFF8000FFFFFF00003FFF
FC00000FFFF0000001FF800023247CA32C>I<00000FF80000003FFE000000FFFF000001
FFFF800003FFFF800007FC7F800007F07F80000FE03F00000FC03F00000FC00000000FC0
0000000FC00000000FC00000000FC00000000FC000007FFFFFFE00FFFFFFFF00FFFFFFFF
00FFFFFFFF007FFFFFFE00000FC00000000FC00000000FC00000000FC00000000FC00000
000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC0000000
0FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000F
C00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC000003FFFFF
F0007FFFFFF8007FFFFFF8007FFFFFF8003FFFFFF00021337DB22C>I<00000003F80007
F80FFC001FFE3FFE007FFFFFFF01FFFFFFFF03FFFFFE7F03FC0FF87F07F003F83E0FE001
FC1C0FC000FC001FC000FE001F80007E001F80007E001F80007E001F80007E001F80007E
001F80007E001FC000FE000FC000FC000FE001FC0007F003F80003FC0FF00007FFFFF000
07FFFFE0000FFFFF80000F9FFE00000F87F800000F800000000F800000000F800000000F
C000000007E000000007FFFFF00003FFFFFE0007FFFFFF800FFFFFFFE01FFFFFFFF03FC0
001FF87F000003FC7E000000FC7C0000007CFC0000007EF80000003EF80000003EF80000
003EF80000003EFC0000007E7E000000FC7F800003FC3FE0000FF81FFC007FF00FFFFFFF
E003FFFFFF8001FFFFFF00003FFFF8000007FFC00028387EA42C>I<7FF000000000FFF8
00000000FFF800000000FFF8000000007FF80000000001F80000000001F80000000001F8
0000000001F80000000001F80000000001F80000000001F80000000001F80000000001F8
0000000001F80000000001F81FE0000001F87FFC000001F9FFFE000001FBFFFF000001FF
FFFF000001FFF03F800001FFC01F800001FF801FC00001FF000FC00001FE000FC00001FC
000FC00001FC000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8
000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8
000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8
000FC00001F8000FC00001F8000FC0007FFFE0FFFF00FFFFF1FFFF80FFFFF1FFFF80FFFF
F1FFFF807FFFE0FFFF0029337FB22C>I<00070000001FC000001FC000003FE000003FE0
00003FE000001FC000001FC0000007000000000000000000000000000000000000000000
0000000000000000007FFFC0007FFFE000FFFFE0007FFFE0007FFFE0000007E0000007E0
000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0
000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0
000007E0000007E0000007E0000007E0000007E0000007E0007FFFFFFCFFFFFFFEFFFFFF
FEFFFFFFFE7FFFFFFC1F3479B32C>I<00000E0000003F8000003F8000007FC000007FC0
00007FC000003F8000003F8000000E000000000000000000000000000000000000000000
000000000000000001FFFF8003FFFFC003FFFFC003FFFFC001FFFFC000000FC000000FC0
00000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0
00000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0
00000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0
00000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0
00001FC03C001F807E003F80FF003F00FF007F00FF01FE00FFFFFC007FFFF8007FFFF000
1FFFE00007FF00001A467CB32C>I<7FE0000000FFF0000000FFF0000000FFF00000007F
F000000001F000000001F000000001F000000001F000000001F000000001F000000001F0
00000001F000000001F000000001F000000001F01FFFF001F03FFFF801F03FFFF801F03F
FFF801F01FFFF001F000FE0001F001FC0001F003F80001F007F00001F00FE00001F01FC0
0001F03F800001F07F000001F0FE000001F1FC000001F3FC000001F7FE000001FFFF0000
01FFFF000001FF9F800001FF0FC00001FE0FE00001FC07E00001F803F00001F001F80001
F001FC0001F000FC0001F0007E0001F0003F0001F0003F8001F0001F807FFFC0FFFCFFFF
E1FFFEFFFFE1FFFEFFFFE1FFFE7FFFC0FFFC27337EB22C>I<7FFFE00000FFFFF00000FF
FFF00000FFFFF000007FFFF000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000003F000000003F000000003F000000003F00000
0003F000000003F000000003F000000003F000000003F000000003F000000003F0000000
03F000000003F000000003F000000003F000000003F000000003F000000003F000000003
F000007FFFFFFF80FFFFFFFFC0FFFFFFFFC0FFFFFFFFC07FFFFFFF8022337BB22C>I<7F
83F007E0007FCFFC1FF800FFDFFE3FFC007FFFFEFFFC007FFFFFFFFE0007FE1FFC3E0007
FC1FF83F0007F80FF01F0007F00FE01F0007E00FC01F0007E00FC01F0007E00FC01F0007
C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007
C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007
C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007C00F801F0007
C00F801F007FFC3FF87FF07FFC7FF8FFF0FFFE7FFCFFF87FFC7FF8FFF07FFC3FF87FF02D
2481A32C>I<7FF01FE00000FFF87FFC0000FFF9FFFE0000FFFBFFFF00007FFFFFFF0000
01FFF03F800001FFC01F800001FF801FC00001FF000FC00001FE000FC00001FC000FC000
01FC000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC000
01F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC000
01F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC000
01F8000FC00001F8000FC0007FFFE0FFFF00FFFFF1FFFF80FFFFF1FFFF80FFFFF1FFFF80
7FFFE0FFFF0029247FA32C>I<0007FC0000001FFF0000007FFFC00001FFFFF00003FFFF
F80007FC07FC000FF001FE001FE000FF001F80003F003F80003F803F00001F807E00000F
C07E00000FC07E00000FC0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0
FC000007E0FC000007E0FE00000FE07E00000FC07E00000FC07F00001FC03F00001F803F
80003F801FC0007F001FE000FF000FF001FE0007FC07FC0003FFFFF80001FFFFF000007F
FFC000001FFF00000007FC000023247CA32C>I<7FF01FE000FFF8FFF800FFFBFFFE00FF
FFFFFF007FFFFFFF8001FFF07FC001FF801FE001FF0007F001FE0003F801FC0003F801FC
0001FC01F80000FC01F80000FC01F80000FE01F800007E01F800007E01F800007E01F800
007E01F800007E01F800007E01F800007E01F800007E01F80000FE01FC0000FC01FC0000
FC01FC0001F801FE0003F801FF0007F001FF000FF001FF801FE001FFE07FC001FFFFFF80
01FFFFFF0001FBFFFE0001F8FFF80001F83FC00001F800000001F800000001F800000001
F800000001F800000001F800000001F800000001F800000001F800000001F800000001F8
00000001F800000001F80000007FFFE00000FFFFF00000FFFFF00000FFFFF000007FFFE0
000027367FA32C>I<0003FC078000001FFF0FC000007FFFCFC00001FFFFEFC00003FFFF
FFC00007FE07FFC0000FF001FFC0001FE000FFC0001FC0007FC0003F80003FC0003F0000
3FC0007F00001FC0007E00001FC0007E00000FC000FC00000FC000FC00000FC000FC0000
0FC000FC00000FC000FC00000FC000FC00000FC000FC00000FC000FC00000FC000FE0000
0FC0007E00001FC0007E00001FC0003F00003FC0003F80003FC0001FC0007FC0001FE000
FFC0000FF003FFC00007FC0FFFC00003FFFFFFC00001FFFFEFC000007FFF8FC000003FFF
0FC0000007F80FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC000000000
0FC0000000000FC0000000000FC000000003FFFF00000007FFFF80000007FFFF80000007
FFFF80000003FFFF0029367DA32C>I<7FFE003FC0FFFF01FFF0FFFF07FFF8FFFF1FFFFC
7FFF3FFFFC003F7FE1FC003FFF01FC003FFC00F8003FF80070003FF00000003FE0000000
3FE00000003FC00000003F800000003F800000003F800000003F000000003F000000003F
000000003F000000003F000000003F000000003F000000003F000000003F000000003F00
0000003F000000003F000000003F000000003F000000003F0000007FFFFFE000FFFFFFF0
00FFFFFFF000FFFFFFF0007FFFFFE00026247EA32C>I<007FF87003FFFFF80FFFFFF81F
FFFFF83FFFFFF87FC00FF87E0003F8FC0001F8F80001F8F80001F8F80001F8FC0000F07F
0000007FF000003FFFC0001FFFFE000FFFFF8003FFFFE0007FFFF80001FFFC000007FC00
0000FE7800007FFC00003FFC00001FFE00001FFE00001FFF00003FFF80003EFFC000FEFF
F007FCFFFFFFFCFFFFFFF8FFFFFFE0F8FFFF80701FFC0020247AA32C>I<001E00000000
3F000000003F000000003F000000003F000000003F000000003F000000003F000000003F
000000003F0000007FFFFFFF00FFFFFFFF80FFFFFFFF80FFFFFFFF807FFFFFFF00003F00
0000003F000000003F000000003F000000003F000000003F000000003F000000003F0000
00003F000000003F000000003F000000003F000000003F000000003F000000003F000000
003F000000003F000000003F0003C0003F0007E0003F0007E0003F0007E0003F0007E000
3F0007E0003F800FE0001F801FC0001FE07FC0000FFFFF80000FFFFF000003FFFE000001
FFF80000003FE000232E7EAD2C>I<7FF003FF8000FFF807FFC000FFF807FFC000FFF807
FFC0007FF803FFC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F800
0FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F800
0FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F800
0FC00001F8000FC00001F8000FC00001F8000FC00001F8000FC00001F8001FC00001F800
1FC00001F8003FC00001FC007FC00000FE03FFC00000FFFFFFFF00007FFFFFFF80003FFF
FFFF80001FFFCFFF800003FE07FF0029247FA32C>I<7FFF01FFFCFFFF01FFFEFFFF83FF
FEFFFF01FFFE7FFF01FFFC03E0000F8003E0000F8003F0001F8001F0001F0001F0001F00
01F8003F0000F8003E0000F8003E0000FC007E00007C007C00007C007C00007E00FC0000
3E00F800003E00F800003F01F800001F01F000001F01F000001F83F000000F83E000000F
83E000000FC7E0000007C7C0000007C7C0000007EFC0000003EF80000003EF80000003FF
80000001FF00000001FF00000000FE000000007C000027247EA32C>I<7FFF007FFF007F
FF80FFFF00FFFF80FFFF807FFF80FFFF007FFF007FFF0007C00001F00007C00001F00007
C00001F00007C00001F00007C00001F00007C00001F00003E00003E00003E00003E00003
E00003E00003E03E03E00003E07F03E00003E07F03E00001F07F07C00001F0FF87C00001
F0FF87C00001F0F787C00001F0F787C00001F1F7C7C00000F1F7C7800000F9E3CF800000
F9E3CF800000FBE3EF800000FBE3EF800000FBE3EF8000007BC1EF0000007FC1FF000000
7FC1FF0000007F80FF0000007F80FF0000003F80FE0000001F007C000029247FA32C>I<
3FFF03FFF07FFF87FFF87FFF87FFF87FFF87FFF83FFF03FFF000FC007E0000FC00FC0000
7E01F800003F01F000001F83F000001F87E000000FCFC0000007EF80000003FF80000001
FF00000001FE00000000FC000000007C00000000FE00000001FE00000001FF00000003EF
80000007CFC000000FC7C000000F83E000001F01F000003F01F800007E00F800007C007C
0000F8007E0001F8003F007FFF01FFFC7FFF83FFFCFFFF83FFFE7FFF83FFFC7FFF01FFFC
27247EA32C>I<7FFF01FFFCFFFF81FFFEFFFF83FFFEFFFF81FFFE7FFF01FFFC03E0000F
8001F0000F8001F0001F8001F8001F0000F8001F0000F8003F0000FC003E00007C003E00
007E007E00003E007C00003E007C00003F00FC00001F00F800001F00F800000F81F80000
0F81F000000F81F0000007C1F0000007C3E0000007C3E0000003E3E0000003E7C0000001
E7C0000001F7C0000001F780000000FF80000000FF80000000FF000000007F000000007F
000000003E000000003E000000007E000000007C000000007C00000000FC00000000F800
000000F800000C01F800003F01F000007F83F000007F87E000007E0FE000007E1FC00000
7FFF8000003FFF0000001FFE0000000FFC00000007E000000027367EA32C>I<3FFFFFFF
E07FFFFFFFF07FFFFFFFF07FFFFFFFF07FFFFFFFF07E00001FE07E00003FC07E00007F80
7E0000FF007E0001FE003C0003FC00000007F80000000FF00000001FE00000003FC00000
007F80000000FF00000001FC00000003F80000000FF00000001FE00000003FC00000007F
80000000FF00000001FE0001E003FC0003F007F80003F00FF00003F01FE00003F03FC000
03F07F800003F0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF0FFFFFFFFF07FFFFFFFE024247DA3
2C>I<78FCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC
FCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC7806416DB9
2C>124 D E /Fy 63 125 df<00000000FF0003F000000003FFE00FFC0000000FC0F01F
1E0000003F00783E0F0000007E01F87C3F0000007C03F8FC7F000000FC03F8F87F000001
F803F9F87F000001F803F1F87E000001F801E1F83C000003F00003F000000003F00003F0
00000003F00003F000000007F00003F000000007E00007F000000007E00007E000000007
E00007E000000007E00007E00000000FE00007E00000000FC0000FE00000000FC0000FC0
0000000FC0000FC00000000FC0000FC000000FFFFFFFFFFFC0000FFFFFFFFFFFC0000FFF
FFFFFFFFC000001F80001F800000001F80001F800000001F80001F800000003F80003F80
0000003F00003F000000003F00003F000000003F00003F000000003F00003F000000007F
00007F000000007E00007E000000007E00007E000000007E00007E000000007E00007E00
000000FE0000FE00000000FC0000FC00000000FC0000FC00000000FC0000FC00000000FC
0000FC00000001FC0000FC00000001F80001FC00000001F80001F800000001F80001F800
000001F80001F800000003F80001F800000003F00003F800000003F00003F000000003F0
0003F000000003F00003F000000007F00003F000000007E00007E000000007E00007E000
000007E00007E000000007E00007E00000000FC0000FC00000000FC0000FC00000000FC0
000FC00000000FC0000FC00000001F80001F800000001F80001F800000001F80001F8000
001C1F03801F0000007E1F0FC03F0000007E3E0FC03E000000FE3E1FC07C000000FE3C1F
C07C000000FE7C1FC0F8000000F8780F01E000000078F00F07C00000003FE003FF000000
000F8000FC00000000404C82BA33>11 D<000000003FFC0000000001FFFF8000000007E0
07C00000001F8001E00000003F0001F00000007E0003F0000000FC0007F0000000FC0007
F0000001F80007F0000001F80007E0000003F0000380000003F0000000000003F0000000
000003F0000000000007F0000000000007E0000000000007E0000000000007E000000000
0007E000000000000FE000000000000FC000000000000FC000000000000FC0000000000F
FFFFFFFF00000FFFFFFFFF00000FFFFFFFFE0000001F80007E0000001F80007E0000001F
8000FE0000003F8000FC0000003F0000FC0000003F0000FC0000003F0001FC0000003F00
01F80000007F0001F80000007E0001F80000007E0003F80000007E0003F00000007E0003
F0000000FE0003F0000000FC0007F0000000FC0007E0000000FC0007E0000000FC0007E0
000001FC000FE0000001FC000FC0000001F8000FC1C00001F8000FC1C00001F8001FC1C0
0001F8001F83C00003F8001F83800003F0001F83800003F0001F83800003F0001F870000
07F0001F87000007E0001F0F000007E0000F8E000007E000079E000007E00003FC00000F
E00000F000000FC000000000000FC000000000000FC000000000000F8000000000001F80
00000000001F80000000001C1F00000000007E1F00000000007E3F0000000000FE3E0000
000000FE3C0000000000FE7C0000000000F878000000000078F000000000003FE0000000
00000F800000000000344C82BA2F>I<007E00007E00007E00007E0000FE0000FF80000F
E00007E00007E00007E00007E0000FE0001FC0007F80FFFE00FFE0001310787F26>24
D<0000000C0000001C00000038000000F0000001E0000003C00000078000000F0000001E
0000003C0000007C000000F8000000F0000001E0000003E0000007C00000078000000F80
00001F0000001F0000003E0000003E0000007C0000007C000000F8000000F8000001F000
0001F0000003F0000003E0000007E0000007C0000007C000000FC000000F8000000F8000
001F8000001F8000001F0000001F0000003F0000003F0000003E0000003E0000007E0000
007E0000007C0000007C0000007C0000007C000000FC000000F8000000F8000000F80000
00F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F80000
00F800000078000000780000007800000078000000780000003C0000003C0000003C0000
001C0000001E0000001E0000000E00000007000000070000000380000001C0000001C000
0000C000001E5274BD22>40 D<00000C0000000E00000007000000038000000380000001
C0000001E0000001E0000000E0000000F0000000F0000000780000007800000078000000
780000007C0000003C0000003C0000003C0000003C0000003C0000003C0000003C000000
3C0000003C0000003C0000003C0000007C0000007C0000007C0000007C0000007C000000
7C0000007C000000FC000000FC000000F8000000F8000001F8000001F8000001F0000001
F0000003F0000003F0000003E0000003E0000007E0000007E0000007C000000FC000000F
8000000F8000001F8000001F0000001F0000003E0000003E0000007C0000007C000000F8
000000F8000001F0000001F0000003E0000003C0000007C000000F8000000F0000001F00
00003E0000003C00000078000000F0000001E0000003E0000003C00000070000000E0000
001C00000078000000F0000000C00000001E527FBD22>I<0000000180000000000003C0
000000000003C0000000000007C0000000000007C0000000000007800000000000078000
000000000F8000000000000F8000000000000F0000000000000F0000000000001F000000
0000001F0000000000001E0000000000001E0000000000003E0000000000003E00000000
00003C0000000000003C0000000000007C0000000000007C000000000000780000000000
00780000007FFFFFFFFFFFE0FFFFFFFFFFFFE0FFFFFFFFFFFFE07FFFFFFFFFFFE0000001
F0000000000001F0000000000001E0000000000001E0000000000003E0000000000003E0
000000000003C0000000000003C0000000000007C0000000000007C00000000000078000
00000000078000000000000F8000000000000F8000000000000F0000000000000F000000
0000001F0000000000001F0000000000001E0000000000001E0000000000003E00000000
00003E0000000000001C00000000333275AD40>43 D<7FFFF87FFFF8FFFFF8FFFFF8FFFF
F0150579941E>45 D<0E003F807F80FF80FF80FF80FF007E003C000909778819>I<0000
03F80000001FFE0000007C1F000000F807800001E007C00003C003E000078003E0000F80
01E0001F0001F0001F0001F0003E0001F0007E0001F0007C0003F000FC0003F000FC0003
F001F80003F001F80003F003F80007F003F00007F003F00007F007F00007F007F00007E0
07E0000FE00FE0000FE00FE0000FE00FE0000FE01FC0001FC01FC0001FC01FC0001FC01F
C0001FC03F80003F803F80003F803F80003F803F80003F807F00007F007F00007F007F00
007F007F00007E007E0000FE007E0000FE007E0000FC00FE0001FC00FE0001F800FE0001
F800FC0003F000FC0003F000FC0003E0007C0007E0007C0007C0007C000F80007C000F80
007C001F00003E003E00003E007C00001F00F800000F83E0000007FF80000000FE000000
243A77B72A>48 D<000000180000003800000078000000F0000001F0000003F0000007F0
00000FE000001FE000007FE00003FFE0003FEFC0003F8FC0001C1FC000001FC000001F80
00001F8000003F8000003F8000003F0000003F0000007F0000007F0000007E0000007E00
0000FE000000FE000000FC000000FC000001FC000001FC000001F8000001F8000003F800
0003F8000003F0000003F0000007F0000007F0000007E0000007E000000FE000000FE000
000FC000000FC000001FC000001FC000001F8000001F8000003F8000003F8000003F0000
007F8000FFFFFF80FFFFFF80FFFFFF801D3877B72A>I<000003F80000000FFE0000003C
0F800000F007C00001E003E00003C003F000078001F000070001F8000E0001F8001E0001
F8001C6000FC00387000FC00383001FC00703001FC00703001FC00F03001FC00E03001FC
00E07003FC01E06003F801C06003F801C0E003F801C0C007F801C1C007F00181800FF001
83800FE001C7001FC001FE003F800078003F000000007E00000000FC00000001F8000000
03F000000007C00000001F800000003E00000000FC00000001F000000007C00000000F80
0000001E000000007C00000000F80000C001F00001C001E00001C003C00001C007800003
C00F000003800E000007801E00000F803C00001F003FF8003F007FFFC07E00783FFFFC00
700FFFFC00F007FFF800E001FFF000E000FFC000E0001F0000263A79B72A>I<00030000
1800038000F80007F007F00007FFFFE00007FFFFC00007FFFF00000FFFFE00000FFFF800
000EFFE000000E0C0000001E000000001C000000001C000000001C000000003C00000000
380000000038000000003800000000780000000070000000007000000000707F000000F3
FFC00000EF83E00000FC01F00000F800F80001F000F80001E000FC0001C0007C00000000
7C000000007E000000007E000000007E00000000FE00000000FE00000000FE00000000FE
00000001FE000C0001FC003F0001FC007F0001FC007F0003FC00FF0003F800FE0003F800
FE0007F000F80007F000E00007E000E0000FE000E0001FC000E0001F8000F0003F000070
007E00007800FC00007C01F800003E07F000001FFFC000000FFF00000001F8000000253A
77B72A>53 D<0000007F00000003FFC000000FFFE000003F81E000007E00F00000F80070
0003F003F00007E007F0000FC007F0001F8007F0001F0007E0003F0007C0007E00000000
FE00000000FC00000001F800000001F800000003F800000007F000000007F00000000FE0
7E00000FE3FF80000FE783E0001FCE01F0001FDC00F8001FF800F8003FF0007C003FE000
7C003FC0007E003FC0007E007F80007E007F80007E007F00007E007F0000FE00FF0000FE
00FE0000FE00FE0000FE00FE0001FE00FE0001FC00FC0001FC00FC0001FC00FC0003FC00
FC0003F800FC0003F800FC0003F800F80007F000F80007E000F8000FE000F8000FC000F8
001F8000FC003F00007C003F00007C007C00003E01F800001F03F000000FFFE0000007FF
80000001FC000000243A76B72A>I<000001FC0000000FFF0000003FFF8000007E07C000
01F803E00003F003E00007E001F0000FC001F0001F8001F0003F8001F8003F0001F8007F
0001F8007E0001F800FE0001F800FE0001F801FC0001F801FC0001F801FC0003F803FC00
03F803F80003F803F80003F803F80007F007F80007F007F00007F007F0000FF007F0000F
F007F0000FE003F0001FE003F0001FE003F0003FE003F0007FC001F0007FC001F000FFC0
00F801FFC0007803BF80003C0F3F80001FFC3F000007F07F000000007F000000007E0000
0000FE00000000FC00000001FC00000001F800000003F000000003F0003E0007E0007F00
0FC0007F000F80007F001F0000FE003F0000FC007E00007000F800007803F000007C0FE0
00003FFF8000001FFE00000003F8000000253A78B72A>57 D<003C007E00FF01FF01FF01
FF01FE01FC00700000000000000000000000000000000000000000000000000000000000
000000000000000E003F807F80FF80FF80FF80FF007E003C00102477A319>I<00000000
01C0000000000003C0000000000003C0000000000007C000000000000FC000000000000F
C000000000001FC000000000001FE000000000003FE000000000003FE000000000007FE0
0000000000FFE00000000000EFE00000000001EFE00000000001CFE000000000038FE000
000000038FE000000000070FE000000000070FE0000000000E0FE0000000001E0FE00000
00001C0FE000000000380FE000000000380FE000000000700FF000000000700FF0000000
00E007F000000000E007F000000001C007F000000003C007F0000000038007F000000007
0007F0000000070007F00000000E0007F00000000E0007F00000001C0007F00000001C00
07F0000000380007F00000007FFFFFF00000007FFFFFF0000000FFFFFFF0000000E00007
F8000001C00003F8000001C00003F8000003800003F8000007800003F8000007000003F8
00000F000003F800000E000003F800001C000003F800001C000003F8000038000003F800
0078000003F8000070000003F80000F0000003F80003F8000003F80007FC000007FC00FF
FF8001FFFFF0FFFF8001FFFFF0FFFF8001FFFFF0343C7BBB3E>65
D<0007FFFFFFFC000007FFFFFFFF800007FFFFFFFFC000000FF0001FF000000FE00007F8
00000FE00003F800001FE00003FC00001FE00001FC00001FC00001FE00001FC00001FE00
003FC00000FE00003FC00000FE00003F800001FE00003F800001FE00007F800001FE0000
7F800001FC00007F000003FC00007F000003F80000FF000007F80000FF000007F00000FE
00000FE00000FE00001FC00001FE00003F800001FE00007F000001FC0001FE000001FC00
07F8000003FFFFFFE0000003FFFFFFC0000003F80007F0000003F80001FC000007F80000
FE000007F800007F000007F000003F800007F000003F80000FF000003FC0000FF000001F
C0000FE000001FC0000FE000001FC0001FE000001FC0001FE000003FC0001FC000003FC0
001FC000003FC0003FC000003FC0003FC000007F80003F8000007F80003F8000007F0000
7F800000FF00007F800001FE00007F000003FC00007F000003F80000FF00000FF80000FF
00001FE00000FE00003FC00001FE0001FF8000FFFFFFFFFE0000FFFFFFFFF80000FFFFFF
FFC0000037397BB83A>I<00000003FE000E0000003FFF801E000000FFFFE03C000003FE
01F03C00000FF000787C00003FC0003CFC00007F00001FF80000FE00000FF80003FC0000
0FF80007F8000007F8000FF0000007F0001FE0000003F0003FC0000003F0003F80000003
F0007F00000003E000FF00000003E001FE00000003E001FC00000003E003FC00000003C0
07F800000003C007F800000003C00FF000000003C00FF000000003801FE000000003801F
E000000000001FE000000000003FC000000000003FC000000000003FC000000000007FC0
00000000007F8000000000007F8000000000007F800000000000FF800000000000FF0000
00000000FF000000000000FF000000000000FF000000000000FF000000003800FF000000
003800FF000000007800FE000000007000FF000000007000FF00000000F0007F00000000
E0007F00000001E0007F00000001C0007F00000003C0003F8000000780003F8000000700
001F8000000E00001FC000001E00000FC000003C00000FE0000078000007F00001F00000
03F80003C0000001FE000F800000007F807E000000003FFFFC000000000FFFE000000000
00FF00000000373D74BA3B>I<0003FFFFFFFE00000003FFFFFFFFC0000003FFFFFFFFF0
00000007F8000FF800000007F00003FC00000007F00000FE0000000FF000007F0000000F
F000003F8000000FE000001F8000000FE000001FC000001FE000000FC000001FE000000F
E000001FC000000FE000001FC0000007E000003FC0000007E000003FC0000007F000003F
80000007F000003F80000007F000007F80000007F000007F80000007F000007F00000007
F000007F00000007F00000FF00000007F00000FF0000000FF00000FE0000000FF00000FE
0000000FF00001FE0000000FF00001FE0000000FE00001FC0000001FE00001FC0000001F
E00003FC0000001FE00003FC0000001FC00003F80000003FC00003F80000003FC00007F8
0000003F800007F80000007F800007F00000007F000007F00000007F00000FF0000000FE
00000FF0000000FE00000FE0000001FC00000FE0000001F800001FE0000003F800001FE0
000007F000001FC0000007E000001FC000000FC000003FC000001F8000003FC000003F80
00003F8000007F0000003F800000FC0000007F800003F80000007F800007F00000007F00
001FC0000000FF0001FF8000007FFFFFFFFE000000FFFFFFFFF0000000FFFFFFFF800000
003C397CB83F>I<0007FFFFFFFFFF0007FFFFFFFFFF0007FFFFFFFFFF00000FF00003FF
00000FE000007F00000FE000003E00001FE000003E00001FE000001E00001FC000001E00
001FC000001E00003FC000001E00003FC000001E00003F8000001E00003F8000001C0000
7F8000001C00007F8000001C00007F0003801C00007F0003801C0000FF0007801C0000FF
000780000000FE000700000000FE000F00000001FE000F00000001FE001F00000001FC00
3E00000001FC007E00000003FFFFFE00000003FFFFFE00000003FFFFFC00000003F800FC
00000007F8007C00000007F8003C00000007F0003800000007F000380000000FF0007800
00000FF0007800E0000FE0007000E0000FE0007001E0001FE0007001C0001FE0000001C0
001FC0000003C0001FC000000380003FC000000780003FC000000700003F8000000F0000
3F8000000F00007F8000001E00007F8000003E00007F0000003C00007F0000007C0000FF
000000FC0000FF000001F80000FE000007F80001FE00007FF000FFFFFFFFFFF000FFFFFF
FFFFF000FFFFFFFFFFE00038397BB838>I<0007FFFFFFFFFE0007FFFFFFFFFE0007FFFF
FFFFFE00000FF00007FE00000FE00000FE00000FE000007C00001FE000003C00001FE000
003C00001FC000003C00001FC000003C00003FC000003C00003FC000003C00003F800000
3C00003F8000003800007F8000003800007F8000003800007F0000003800007F00038038
0000FF000780380000FF000780000000FE000700000000FE000700000001FE000F000000
01FE000F00000001FC001E00000001FC003E00000003FC00FE00000003FFFFFE00000003
FFFFFC00000003FFFFFC00000007F800FC00000007F8007C00000007F0007800000007F0
00780000000FF000780000000FF000780000000FE000700000000FE000700000001FE000
F00000001FE000F00000001FC000000000001FC000000000003FC000000000003FC00000
0000003F8000000000003F8000000000007F8000000000007F8000000000007F00000000
00007F000000000000FF000000000000FF000000000000FE000000000001FF0000000000
FFFFFF00000000FFFFFF00000000FFFFFF0000000037397BB836>I<00000003FE000E00
00003FFF801E000000FFFFE03C000003FE01F03C00000FF000787C00003FC0003CFC0000
7F00001FF80000FE00000FF80003FC00000FF80007F8000007F8000FF0000007F0001FE0
000003F0003FC0000003F0003F80000003F0007F00000003E000FF00000003E001FE0000
0003E001FC00000003E003FC00000003C007F800000003C007F800000003C00FF0000000
03C00FF000000003801FE000000003801FE000000000001FE000000000003FC000000000
003FC000000000003FC000000000007FC000000000007F8000000000007F800000000000
7F800000000000FF800000000000FF000000000000FF000007FFFFE0FF000007FFFFE0FF
000007FFFFE0FF00000007FC00FF00000003F800FF00000007F800FF00000007F000FF00
000007F000FF00000007F0007F0000000FF0007F0000000FE0007F0000000FE0007F0000
000FE0003F8000001FE0003F8000001FE0001F8000001FC0001FC000003FC0000FE00000
3FC0000FE000007FC00007F00000FF800003F80003EF800001FE0007C78000007FC03F07
8000003FFFFC030000000FFFF00000000000FF80000000373D74BA40>I<0003FFFFF80F
FFFFE00003FFFFF80FFFFFE00003FFFFF80FFFFFE0000007F800001FE000000007F00000
1FC000000007F000001FC00000000FF000003FC00000000FF000003F800000000FE00000
3F800000000FE000003F800000001FE000007F800000001FE000007F000000001FC00000
7F000000001FC000007F000000003FC00000FF000000003FC00000FE000000003F800000
FE000000003F800000FE000000007F800001FE000000007F800001FC000000007F000001
FC000000007F000001FC00000000FF000003FC00000000FF000003F800000000FE000003
F800000000FE000003F800000001FFFFFFFFF800000001FFFFFFFFF000000001FFFFFFFF
F000000001FC000007F000000003FC00000FF000000003FC00000FE000000003F800000F
E000000003F800000FE000000007F800001FE000000007F800001FC000000007F000001F
C000000007F000001FC00000000FF000003FC00000000FF000003F800000000FE000003F
800000000FE000003F800000001FE000007F800000001FE000007F000000001FC000007F
000000001FC000007F000000003FC00000FF000000003FC00000FE000000003F800000FE
000000003F800000FE000000007F800001FE000000007F800001FC000000007F000001FC
00000000FF000003FC0000007FFFFE01FFFFF80000FFFFFE03FFFFF80000FFFFFE03FFFF
F8000043397CB83E>I<0003FFFFF80003FFFFF80003FFFFF8000007F800000007F00000
0007F00000000FF00000000FF00000000FE00000000FE00000001FE00000001FE0000000
1FC00000001FC00000003FC00000003FC00000003F800000003F800000007F800000007F
800000007F000000007F00000000FF00000000FF00000000FE00000000FE00000001FE00
000001FE00000001FC00000001FC00000003FC00000003FC00000003F800000003F80000
0007F800000007F800000007F000000007F00000000FF00000000FF00000000FE0000000
0FE00000001FE00000001FE00000001FC00000001FC00000003FC00000003FC00000003F
800000003F800000007F800000007F800000007F00000000FF800000FFFFFF0000FFFFFF
0000FFFFFE000025397CB820>I<0003FFFFF8007FFFE00003FFFFF8007FFFE00003FFFF
F8007FFFC0000007F800000FFC00000007F000000FE000000007F000000FC00000000FF0
00001F000000000FF000003E000000000FE000007C000000000FE00000F0000000001FE0
0001E0000000001FE00003C0000000001FC0000F80000000001FC0001F00000000003FC0
003C00000000003FC0007800000000003F8000F000000000003F8001E000000000007F80
07C000000000007F800F0000000000007F001E0000000000007F003C000000000000FF00
78000000000000FF01FC000000000000FE03FC000000000000FE07FC000000000001FE0F
FE000000000001FE1FFE000000000001FC7CFE000000000001FCF8FF000000000003FDE0
7F000000000003FFC07F800000000003FF807F800000000003FF003F800000000007FE00
3FC00000000007F8003FC00000000007F0001FC00000000007F0001FE0000000000FF000
1FE0000000000FF0000FE0000000000FE0000FF0000000000FE00007F0000000001FE000
07F8000000001FE00007F8000000001FC00003F8000000001FC00003FC000000003FC000
03FC000000003FC00001FC000000003F800001FE000000003F800001FE000000007F8000
00FF000000007F800000FF000000007F000000FF00000000FF000001FF8000007FFFFE00
1FFFFC0000FFFFFE003FFFFC0000FFFFFE003FFFFC000043397CB840>75
D<0007FFFFFC000007FFFFFC000007FFFFF80000000FF8000000000FF0000000000FE000
0000001FE0000000001FE0000000001FC0000000001FC0000000003FC0000000003FC000
0000003F80000000003F80000000007F80000000007F80000000007F00000000007F0000
000000FF0000000000FF0000000000FE0000000000FE0000000001FE0000000001FE0000
000001FC0000000001FC0000000003FC0000000003FC0000000003F80000000003F80000
000007F80000000007F80000000007F00000000007F0000000000FF0000000000FF00000
0C000FE000001C000FE000001C001FE000003C001FE0000038001FC0000078001FC00000
78003FC0000070003FC00000F0003F800000E0003F800001E0007F800003E0007F800003
C0007F000007C0007F00000FC000FF00001F8000FF00003F8000FE0000FF8001FE0007FF
00FFFFFFFFFF00FFFFFFFFFF00FFFFFFFFFE002E397BB834>I<0007FFF800000007FFF0
0007FFF80000000FFFF00007FFF80000001FFFE000000FF80000001FF00000000FF80000
003FE00000000FF80000003FE00000001FF80000007FE00000001FF8000000EFC0000000
1DF8000000EFC00000001CFC000001CFC00000003CFC000001DFC00000003CFC0000039F
8000000038FC0000071F8000000038FC0000071F8000000078FC00000E3F8000000078FC
00000E3F0000000070FC00001C3F0000000070FC00001C3F00000000F0FC0000387F0000
0000F0FC0000707E00000000E0FC0000707E00000000E07E0000E07E00000001E07E0000
E0FE00000001E07E0001C0FC00000001C07E000380FC00000001C07E000380FC00000003
C07E000701FC00000003C07E000701F800000003807E000E01F800000003807E000E01F8
00000007807E001C03F800000007807E003803F000000007007E003803F000000007003F
007003F00000000F003F007007F00000000F003F00E007E00000000E003F01C007E00000
000E003F01C007E00000001E003F03800FE00000001E003F03800FC00000001C003F0700
0FC00000001C003F07000FC00000003C003F0E001FC00000003C003F1C001F8000000038
003F1C001F8000000038001FB8001F8000000078001FB8003F8000000078001FF0003F00
00000070001FE0003F0000000070001FE0003F00000000F0001FC0007F00000000F0001F
C0007E00000001F0001F80007E00000007F8001F8000FE000000FFFFC01F007FFFFC0000
FFFFC01E007FFFFC0000FFFFC00E007FFFFC00004C397AB84A>I<0003FFF80000FFFFE0
0003FFF80000FFFFE00003FFFC0000FFFFE0000007FC000007F800000007FE000003F000
000007FE000003E00000000FFE000003C00000000FFF000003C00000000E7F0000038000
00000E7F000003800000001E7F800007800000001E3F800007000000001C3F8000070000
00001C3FC00007000000003C1FC0000F000000003C1FE0000E00000000380FE0000E0000
0000380FE0000E00000000780FF0001E000000007807F0001C000000007007F0001C0000
00007007F8001C00000000F003F8003C00000000F003FC003800000000E003FC00380000
0000E001FC003800000001E001FE007800000001E000FE007000000001C000FE00700000
0001C000FF007000000003C0007F00F000000003C0007F00E00000000380007F80E00000
000380003F80E00000000780003FC1E00000000780001FC1C00000000700001FC1C00000
000700001FE1C00000000F00000FE3C00000000F00000FE3800000000E00000FF3800000
000E000007F3800000001E000007FF800000001E000007FF000000001C000003FF000000
001C000003FF000000003C000001FF000000003C000001FE0000000038000001FE000000
0038000000FE0000000078000000FE0000000078000000FC00000000F80000007C000000
03FC0000007C0000007FFFE000003C000000FFFFE0000038000000FFFFE0000038000000
43397CB83E>I<00000003FE00000000003FFFC000000000FC07F000000003E001F80000
000F80007C0000003F00003E0000007E00001F000000F800001F800001F000000FC00007
E000000FC0000FC0000007E0001FC0000007E0001F80000007F0003F00000003F0007E00
000003F000FE00000003F801FC00000003F801FC00000003F803F800000003F803F80000
0003F807F000000003F807F000000003F80FF000000003F80FE000000003F81FE0000000
07F81FC000000007F83FC000000007F83FC000000007F83FC000000007F87F800000000F
F07F800000000FF07F800000000FF07F800000000FF0FF000000001FE0FF000000001FE0
FF000000001FE0FF000000003FC0FF000000003FC0FF000000003F80FF000000007F80FF
000000007F00FF00000000FF00FF00000000FE00FF00000001FE00FF00000001FC007F00
000003F8007F00000007F0007F00000007F0007F0000000FE0003F0000001FC0003F8000
003F80001F8000003F00001FC000007E00000FC00000FC000007E00003F0000003F00007
E0000001F8000F80000000FC003F000000003F01FC000000001FFFE00000000001FF0000
0000353D74BA40>I<0007FFFFFFF8000007FFFFFFFF000007FFFFFFFF8000000FF0003F
E000000FE0000FF000000FE00003F800001FE00003F800001FE00001FC00001FC00001FC
00001FC00001FC00003FC00001FE00003FC00001FE00003F800001FE00003F800001FE00
007F800001FE00007F800003FC00007F000003FC00007F000003FC0000FF000003F80000
FF000007F80000FE000007F00000FE00000FE00001FE00000FE00001FE00001FC00001FC
00003F800001FC0000FE000003FC0001FC000003FC000FF0000003FFFFFFC0000003FFFF
FE00000007F8000000000007F8000000000007F0000000000007F000000000000FF00000
0000000FF000000000000FE000000000000FE000000000001FE000000000001FE0000000
00001FC000000000001FC000000000003FC000000000003FC000000000003F8000000000
003F8000000000007F8000000000007F8000000000007F0000000000007F000000000000
FF000000000000FF000000000000FE000000000001FE0000000000FFFFFC00000000FFFF
FC00000000FFFFFC0000000037397BB838>I<00000003FE00000000003FFFC000000000
FC07F000000003E001F80000000FC0007C0000003F00003E0000007E00001F000000FC00
001F800001F000000FC00007F000000FC0000FE0000007E0001FC0000007E0001F800000
07F0003F00000007F0007F00000003F000FE00000003F801FC00000003F801FC00000003
F803F800000003F803F800000003F807F000000003F807F000000003F80FF000000003F8
0FE000000007F81FE000000007F81FE000000007F83FC000000007F83FC000000007F83F
C000000007F87F800000000FF07F800000000FF07F800000000FF07F800000000FF0FF00
0000001FE0FF000000001FE0FF000000001FE0FF000000003FC0FF000000003FC0FF0000
00003F80FF000000007F80FE000000007F00FE00000000FF00FE00000000FE00FE000000
01FE00FE00000001FC007F00000003F8007F00000003F0007F000F8007F0007F003FE00F
E0003F0070601FC0003F80E0301F80001F81C0303F00001F8180187E00000FC38018FC00
0007E30019F0000003E3001FE0000001FB001F80000000FF803F000000003F81FC001800
001FFFF80018000001FF380038000000003C0030000000003C0070000000003C00F00000
00003C00E0000000003E03E0000000003F07E0000000003FFFC0000000003FFF80000000
003FFF80000000003FFF00000000003FFE00000000001FFC00000000000FF80000000000
07E00000354B74BA40>I<0000003FC00E000001FFF01C000007FFFC1C00001FC07E3C00
003F001F7C00007C000FF80000F80007F80001F00003F80003E00003F80007C00001F000
07C00001F0000F800001F0000F800001F0001F800001E0001F000001E0001F000001E000
1F000001E0003F000001C0003F000001C0003F000001C0003F80000000003F8000000000
3FC0000000001FE0000000001FFC000000001FFF800000000FFFF00000000FFFFE000000
07FFFF80000003FFFFE0000000FFFFF00000003FFFF800000007FFF8000000007FFC0000
00000FFC0000000003FC0000000001FC0000000001FC0000000000FC0000000000FC0000
0000007C000E0000007C000E0000007C000E0000007C001E000000FC001E000000F8001E
000000F8001E000000F8003E000001F0003E000001F0003E000003E0003E000003E0007F
000007C0007F00000F80007F80001F00007FC0003E0000F9F000FC0000F8FC03F80000F0
7FFFE00000E01FFF800000C003FC0000002F3D7ABA2F>83 D<07FFFFFFFFFFE007FFFFFF
FFFFE00FFFFFFFFFFFE00FF800FF001FE00FC000FE0007C01F8000FE0007C01F0001FE00
03C01E0001FE0003C01C0001FC0003C03C0001FC0003803C0003FC000380380003FC0003
80780003F8000380700003F8000780700007F8000780F00007F8000700E00007F0000700
E00007F0000700E0000FF000070000000FF000000000000FE000000000000FE000000000
001FE000000000001FE000000000001FC000000000001FC000000000003FC00000000000
3FC000000000003F8000000000003F8000000000007F8000000000007F8000000000007F
0000000000007F000000000000FF000000000000FF000000000000FE000000000000FE00
0000000001FE000000000001FE000000000001FC000000000001FC000000000003FC0000
00000003FC000000000003F8000000000003F8000000000007F8000000000007F8000000
000007F0000000000007F000000000000FF000000000000FF000000000000FE000000000
003FF0000000007FFFFFF8000000FFFFFFF8000000FFFFFFF8000000333971B83B>I<3F
FFFF800FFFFE3FFFFF800FFFFE3FFFFF800FFFFE007F8000007F80007F0000003F00007F
0000003E0000FF0000003C0000FF0000003C0000FE000000380000FE000000380001FE00
0000780001FE000000700001FC000000700001FC000000700003FC000000F00003FC0000
00E00003F8000000E00003F8000000E00007F8000001E00007F8000001C00007F0000001
C00007F0000001C0000FF0000003C0000FF000000380000FE000000380000FE000000380
001FE000000780001FE000000700001FC000000700001FC000000700003FC000000F0000
3FC000000E00003F8000000E00003F8000000E00007F8000001E00007F8000001C00007F
0000001C00007F0000001C00007F0000003C0000FF000000380000FE000000380000FE00
0000780000FE000000700000FE000000700000FE000000F00000FE000001E00000FE0000
01C00000FE000003C000007E0000078000007E00000F0000007E00000E0000003F00003E
0000001F80007C0000001F8000F00000000FC003E000000007F01FC000000001FFFF0000
0000007FFC00000000001FE000000000373B70B83E>I<FFFFF80003FFFEFFFFF80003FF
FEFFFFF80003FFFC03FE0000007FC003FC0000003F0001FC0000003E0001FC0000003C00
01FC000000380001FC000000700001FC000000700001FC000000E00001FC000001E00001
FC000001C00001FE000003800001FE000003800000FE000007000000FE00000F000000FE
00000E000000FE00001C000000FE00001C000000FE000038000000FE000038000000FE00
0070000000FE0000E0000000FE0000E0000000FF0001C00000007F0001C00000007F0003
800000007F0007800000007F0007000000007F000E000000007F000E000000007F001C00
0000007F003C000000007F0038000000007F0070000000007F8070000000003F80E00000
00003F81E0000000003F81C0000000003F8380000000003F8380000000003F8700000000
003F8700000000003F8E00000000003F9E00000000003F9C00000000003FF80000000000
3FF800000000001FF000000000001FF000000000001FE000000000001FC000000000001F
C000000000001F8000000000001F8000000000001F0000000000001E0000000000001E00
00000000373B6FB83E>I<FFFFF80FFFFF001FFFF0FFFFF80FFFFF003FFFF0FFFFF00FFF
FF003FFFE007FE00007FE00003FE0003F800003F800001FC0003F800003F800000F00003
F800003F800000F00003F800003F800001E00003F800003F800001C00003F800003F8000
03C00003F800003F800003800003F800003F800007800003F800007F800007000003F800
007F80000E000003F80000FF80000E000003F80001FF80001C000003F80001FF80001C00
0003F80003BF800038000003FC0003BF800038000001FC00073F800070000001FC00073F
800070000001FC000E3F8000E0000001FC000E3FC000E0000001FC001C1FC001C0000001
FC001C1FC003C0000001FC00381FC00380000001FC00381FC00700000001FC00701FC007
00000001FC00F01FC00E00000001FC00E01FC00E00000001FC01C01FC01C00000001FC01
C01FC01C00000001FC03801FC03800000001FC03801FC03800000001FC07001FC0700000
0001FC07001FC07000000001FC0E001FC0E000000001FC0E001FC1E000000001FC1C001F
C1C000000001FC1C001FC38000000001FC38001FC38000000001FC78001FC70000000001
FC70001FC70000000001FCE0001FCE0000000001FEE0001FCE0000000000FFC0001FDC00
00000000FFC0001FDC0000000000FF80001FF80000000000FF80001FF80000000000FF00
001FF00000000000FF00000FF00000000000FE00000FE00000000000FE00000FC0000000
0000FC00000FC00000000000FC00000F800000000000F800000F800000000000F000000F
000000000000F000000F000000000000E000000E00000000004C3B6FB853>I<0001FFFF
F007FFFF0001FFFFF007FFFF0001FFFFF007FFFF000007FF0000FFE0000003FC00007F00
000003FC00007C00000001FC00007800000001FE0000F000000001FE0001E000000000FE
0001C000000000FF00038000000000FF000700000000007F000F00000000007F801E0000
0000007F803C00000000003F807800000000003FC07000000000003FC0E000000000001F
C1C000000000001FE3C000000000001FE78000000000000FEF0000000000000FFE000000
00000007FC00000000000007F800000000000007F800000000000003F800000000000003
FC00000000000003FC00000000000007FC00000000000007FE0000000000000FFE000000
0000001CFE0000000000003CFF00000000000078FF000000000000F07F000000000001E0
7F800000000001C03F800000000003803FC00000000007003FC0000000000E001FC00000
00001E001FE0000000003C001FE00000000078000FE00000000070000FF000000000E000
0FF000000001C00007F000000003800007F800000007800007F80000000F000003F80000
001E000003FC0000003E000003FC000000FE000003FE000007FF000007FE0000FFFFE000
7FFFFC00FFFFE000FFFFFC00FFFFE000FFFFF80040397CB83E>I<0000F800000007FE00
00001F871C00003E03FE00007C03FE0000F801FE0001F801FE0003F000FC0007E000FC00
0FE000FC000FC001FC001FC001F8001FC001F8003F8001F8003F8003F8007F8003F0007F
0003F0007F0003F0007F0007F000FF0007E000FE0007E000FE0007E000FE000FE000FE00
0FC000FC000FC1C0FC000FC1C0FC001FC1C0FC001F83C0FC001F8380FC003F8380FC003F
87807C007F87007C00FF07003E01FF0F003E038F8E001F0F079E0007FE03FC0001F000F0
00222677A42A>97 D<003F00001FFF00001FFF00001FFF0000007F0000007E0000007E00
00007E000000FE000000FC000000FC000000FC000001FC000001F8000001F8000001F800
0003F8000003F0000003F0000003F0000007F0000007E0F80007E7FE0007EF0F800FFC07
C00FF807C00FF003E00FE003E01FC003F01FC003F01F8003F01F8003F03F8003F03F0003
F03F0003F03F0007F07F0007F07E0007F07E0007F07E000FF0FE000FF0FC000FE0FC000F
E0FC001FE0FC001FC0F8001FC0F8003F80F8003F80F8003F00F8007F00F8007E00F800FC
007801F8007C01F0003C03E0003E07C0001E1F80000FFE000001F000001C3B77B926>I<
00007F000003FFC0000FC1E0001F0070007E007800FC003801F801F803F003F807F003F8
07E003F80FE003F81FC003F01FC000003F8000003F8000007F8000007F0000007F000000
7F000000FF000000FE000000FE000000FE000000FE000000FC000000FC000000FC000000
FC000030FC000038FC0000787C0000F07E0001E03E0003C03E000F801F003E000F81F800
03FFE00000FF00001D2677A426>I<00000001F8000000FFF8000000FFF8000000FFF800
000003F800000003F000000003F000000007F000000007F000000007E000000007E00000
000FE00000000FE00000000FC00000000FC00000001FC00000001FC00000001F80000000
1F800000003F800000003F800000F83F000007FE3F00001F877F00003E03FF00007C03FE
0000F801FE0001F801FE0003F000FE0007E000FC000FE000FC000FC001FC001FC001FC00
1FC001F8003F8001F8003F8003F8007F8003F8007F0003F0007F0003F0007F0007F000FF
0007F000FE0007E000FE0007E000FE000FE000FE000FE000FC000FC1C0FC000FC1C0FC00
1FC1C0FC001FC3C0FC001F8380FC003F8380FC003F87807C007F87007C00FF07003E01FF
0F003E038F8E001F0F079E0007FE03FC0001F000F000253B77B92A>I<00007F000003FF
C0000FC1E0003F00F0007E007800FC007801F8007803F0007807E000780FE000780FC000
F81FC000F03F8001F03F8007E03F801F807F81FF007FFFF8007FFF00007F000000FF0000
00FE000000FE000000FE000000FE000000FE000000FC000000FC000000FC0000307C0000
387C0000787E0000F03E0001E03E0003C01F000F800F003E000781F80003FFE00000FF00
001D2677A426>I<00000007C00000001FF00000003E380000007C3C000000F8FC000000
F9FC000001F9FC000001F1FC000003F1F8000003F0F0000003F000000007F000000007E0
00000007E000000007E000000007E00000000FE00000000FC00000000FC00000000FC000
00000FC00000001FC00000001F8000000FFFFFC0001FFFFFC0001FFFFF8000003F800000
003F000000003F000000003F000000003F000000007F000000007E000000007E00000000
7E000000007E00000000FE00000000FC00000000FC00000000FC00000000FC00000001FC
00000001F800000001F800000001F800000001F800000003F800000003F000000003F000
000003F000000003F000000007F000000007E000000007E000000007E000000007E00000
000FE00000000FC00000000FC00000000FC00000001FC00000001F800000001F80000000
1F800000001F000000003F0000001C3F0000007E3E0000007E3E000000FE3C000000FE7C
000000FE78000000F8F000000078F00000003FC00000000F80000000264C82BA19>I<00
0007C00000003FF0000000FC38E00001F01FF00003E01FF00007C00FF0000F800FF0001F
8007F0003F0007E0007F0007E0007E000FE000FE000FE000FC000FC001FC000FC001FC00
1FC003FC001FC003F8001F8003F8001F8003F8003F8007F8003F8007F0003F0007F0003F
0007F0007F0007F0007F0007E0007E0007E0007E0007E000FE0007E000FE0007E000FC00
03E001FC0003E003FC0003E007FC0001F00FF80000F01FF80000787BF800003FF3F80000
0FC3F000000003F000000007F000000007F000000007E000000007E00000000FE0000000
0FC0001C000FC0007E001FC0007E001F8000FE003F0000FE007E0000FE00FC00007801F8
00007C07E000001FFF80000003FE00000024367CA426>I<0003F0000001FFF0000001FF
F0000001FFF000000007F000000007E000000007E000000007E00000000FE00000000FC0
0000000FC00000000FC00000001FC00000001F800000001F800000001F800000003F8000
00003F000000003F000000003F000000007F000000007E07F000007E1FFC00007E783E00
00FFE01F0000FFC01F8000FF800F8000FF000F8001FE000F8001FE000FC001FC000FC001
F8001F8003F8001F8003F0001F8003F0001F8003F0003F8007F0003F0007E0003F0007E0
003F0007E0007F000FE0007E000FC0007E000FC000FE000FC000FC001FC000FC001F8001
FC1C1F8001F81C1F8001F83C3F8003F8383F0003F0383F0003F0383F0003F0707F0003E0
707E0003E0F07E0003E0E07E0003E1C0FE0001E380FC0000FF003800003C00263B7BB92A
>I<0001C00007E00007F0000FF0000FE00007E000038000000000000000000000000000
000000000000000000000000000000000000000000F00003FC00071E000E1F001C1F001C
1F00381F00383F00703F00703F00707F00F07E00E07E00E0FE0000FC0000FC0001FC0001
F80003F80003F80003F00007F00007E00007E0000FE0E00FC0E00FC1E01FC1C01F81C01F
81C01F83801F03801F07001F07001F0E000F1C0007F80001E000143879B619>I<000000
0E0000003F0000007F0000007F0000007F0000007E0000001C0000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000001F
8000007FC00000F1F00001C0F0000380F8000780F8000701F8000F01F8000E01F8001E01
F8001C03F8003C03F8003803F0003803F0000007F0000007F0000007E0000007E000000F
E000000FE000000FC000000FC000001FC000001FC000001F8000001F8000003F8000003F
8000003F0000003F0000007F0000007F0000007E0000007E000000FE000000FE000000FC
000000FC000001FC000001FC000001F8000001F8000003F8000003F0001C03F0007E07E0
007E07E000FE0FC000FE0F8000FE1F0000F83E0000787C00003FF000000FC00000204883
B619>I<0003F0000001FFF0000001FFF0000001FFF000000007F000000007E000000007
E000000007E00000000FE00000000FC00000000FC00000000FC00000001FC00000001F80
0000001F800000001F800000003F800000003F000000003F000000003F000000007F0000
00007E000F80007E003FE0007E00F0E000FE01C1F000FC0387F000FC0707F000FC0E07F0
01FC1C07E001F83807E001F830038001F870000003F8E0000003F1C0000003F380000003
FF00000007FC00000007FE00000007FFC0000007E7F800000FE1FC00000FC07E00000FC0
7F00000FC03F00001FC03F80001F801F81C01F801F81C01F801F83C03F803F83803F003F
03803F003F03803F003F07807F003F07007E003E07007E001E0E007E001E1E00FE000F3C
00FC0007F800380001E000243B7BB926>I<000FC007FFC007FFC007FFC0001FC0001F80
001F80003F80003F80003F00003F00007F00007F00007E00007E0000FE0000FE0000FC00
00FC0001FC0001FC0001F80001F80003F80003F80003F00003F00007F00007F00007E000
07E0000FE0000FE0000FC0000FC0001FC0001FC0001F80001F80003F80003F80003F0000
3F00007F00007F00007E0E007E0E00FE0E00FE1E00FC1C00FC1C00FC3C00FC3800F83800
F878007870007CE0001FE0000F8000123B79B915>I<01E000FE0007F00007F803FF801F
FC000E3C0F07C0783E001E3E3C03E1E01F001C1F7803F3C01F80383FF001F7800F80383F
E001F7000F80783FC001FE000F80703FC001FE000FC0703F8001FC000FC0703F0003F800
1F80F07F0003F8001F80E07E0003F0001F80E07E0003F0001F80007E0007F0003F8000FE
0007F0003F0000FC0007E0003F0000FC0007E0003F0000FC000FE0007F0001FC000FE000
7E0001F8000FC0007E0001F8000FC000FE0001F8001FC000FC0003F8001FC000FC0003F0
001F8001FC1C03F0001F8001F81C03F0003F8001F83C07F0003F8003F83807E0003F0003
F03807E0003F0003F03807E0007F0003F0700FE0007F0003E0700FC0007E0003E0F00FC0
007E0003E0E00FC000FE0003E1C01FC000FE0001E3C01F8000FC0000FF00070000380000
3C003E2679A444>I<01E000FE000007F803FF80000E3C0F07C0001E3E3C03E0001C1F78
03F000383FF001F000383FE001F000783FC001F000703FC001F800703F8001F800703F00
03F000F07F0003F000E07E0003F000E07E0003F000007E0007F00000FE0007E00000FC00
07E00000FC0007E00000FC000FE00001FC000FC00001F8000FC00001F8001FC00001F800
1F800003F8001F800003F0003F838003F0003F038003F0003F078007F0007F070007E000
7E070007E0007E070007E0007E0E000FE0007C0E000FC0007C1E000FC0007C1C000FC000
7C38001FC0003C78001F80001FE000070000078000292679A42F>I<00007F000003FFC0
000FC1F0001F00F8007E007C00FC007C01F8007E03F0003E07F0003F07E0003F0FE0003F
1FC0003F1FC0003F3F80003F3F80007F7F80007F7F00007F7F00007F7F0000FFFF0000FF
FE0000FEFE0000FEFE0001FEFE0001FCFC0001FCFC0003F8FC0003F8FC0007F0FC0007E0
FC000FE07C000FC07E001F803E003F003E007E001F00F8000F83F00003FFC00000FE0000
202677A42A>I<00078007C000001FE03FF000003CF0787C000038F8E03E0000787FC03E
0000707F801F000070FF001F0000F0FE001F8000E0FE001F8000E0FC001F8001E1FC001F
8001C1FC001F8001C1F8001F8001C1F8001F800003F8003F800003F8003F800003F0003F
800003F0003F800007F0007F800007F0007F800007E0007F000007E0007F00000FE000FF
00000FE000FE00000FC000FE00000FC001FC00001FC001FC00001FC001F800001F8003F8
00001F8003F000003F8007E000003FC00FC000003FC00F8000003FE01F0000007FE03E00
00007F70FC0000007E3FF00000007E0F80000000FE0000000000FE0000000000FC000000
0000FC0000000001FC0000000001FC0000000001F80000000001F80000000003F8000000
0003F80000000003F00000000007F000000000FFFFC0000000FFFFC0000000FFFFC00000
00293580A42A>I<0000F8030007FE07001F871F003E03BF007C03FE00F801FE01F801FE
03F000FE07E000FC0FE000FC0FC000FC1FC001FC1FC001F83F8001F83F8001F87F8003F8
7F0003F07F0003F07F0003F0FF0007F0FE0007E0FE0007E0FE0007E0FE000FE0FC000FC0
FC000FC0FC000FC0FC001FC0FC001F80FC003F80FC003F807C007F807C00FF003E01FF00
3E03BF001F0F7F0007FE7E0001F07E0000007E000000FE000000FC000000FC000000FC00
0001FC000001F8000001F8000001F8000003F8000003F0000007F00001FFFFC001FFFFC0
01FFFFC0203577A426>I<03C003F0000FF01FFC001E783C0F001C7C700F003C3EE03F80
383FC03F80387F803F80787F803F00707F003F00707F001C00F07E000000E0FE000000E0
FC000000E0FC00000000FC00000001FC00000001F800000001F800000001F800000003F8
00000003F000000003F000000003F000000007F000000007E000000007E000000007E000
00000FE00000000FC00000000FC00000000FC00000001FC00000001F800000001F800000
001F800000003F800000003F000000000E00000000212679A423>I<0000FE000007FF80
000F83C0003E00E0007C00F00078007000F800F001F803F001F003F001F003F001F003E0
03F001C003F8000003FC000003FFC00001FFF80001FFFE0000FFFF00007FFF80003FFF80
000FFFC00000FFC000003FC000001FC000000FC03E000FC07E000FC0FE000F80FE000F80
FE000F80FC001F00E0001F00F0003E0070007C003800F8001E03E0000FFFC00001FE0000
1C267AA422>I<0003800007C0000FC0000FC0000FC0000FC0001FC0001F80001F80001F
80003F80003F00003F00003F00007F00007E007FFFFF7FFFFFFFFFFF00FC0000FC0000FC
0001FC0001F80001F80001F80003F80003F00003F00003F00007F00007E00007E00007E0
000FE0000FC0000FC0000FC0001FC0001F801C1F801C1F803C3F80383F00783F00703F00
F03F00E03F01C03E03C01F07800F0F0007FC0001F000183579B31C>I<00F800000003FE
0001C0078F0003E00E0F8007E01E0F8007E01C0F8007E0380F800FE0381F800FE0781F80
0FC0701F800FC0703F801FC0F03F001FC0E03F001F80E07F001F80007E003F80007E003F
8000FE003F0000FC003F0000FC007F0001FC007F0001F8007E0001F8007E0001F800FE00
03F800FE0003F000FC0E03F000FC0E03F001FC1E03F001FC1C03F001F81C03E001F81C03
E001F83C03F003F83803F007F83801F007F07001F01EF8F000F83C78E0003FF03FC0000F
C00F00272679A42D>I<00F0000E0003FC003F00071E007F800E1F007F801C1F007F803C
1F007F80381F003F80383F001F80703F000F80703F000F80707F000F80F07E000F00E07E
000700E0FE00070000FC000F0000FC000E0001FC000E0001F8000E0001F8001E0003F800
1C0003F0001C0003F0001C0003F0003C0007F000380007E000380007E000700007E00070
0007E000700007E000E00007E000E00007E001C00007E003C00003E003800003F0070000
01F00E000000F83C0000007FF80000000FC00000212679A426>I<00F0000000070003FC
0003801F80071E0007C03FC00E1F000FC03FC01C1F000FC03FC03C1F000FC03FC0381F00
1FC01FC0383F001F800FC0703F001F8007C0703F001F8007C0707F003F8007C0F07E003F
800780E07E003F000380E0FE003F00038000FC007F00078000FC007F00070001FC007E00
070001F8007E00070001F800FE000F0003F800FE000E0003F000FC000E0003F000FC000E
0003F000FC001E0007F001FC001C0007E001F8001C0007E001F8003C0007E001F8003800
07E001F800380007E001F800780007E001F800700007E003F800F00007E003F800E00003
E007F801E00003F00FFC03C00001F01E7C07800000FC3C3E0F0000003FF81FFE0000000F
E003F00000322679A437>I<0007E007C0001FF81FF800787C383C00F03E703C01E01EE0
FE03C01FE0FE03801FC0FE07001FC0FC0F001F80FC0E001F80700E003F80001E003F0000
1C003F00001C003F000000007F000000007F000000007E000000007E00000000FE000000
00FE00000000FC00000000FC00000001FC00000001FC00000001F800700001F800700003
F800F00003F800E01C03F000E07E03F001E07E07F001C0FE07F00380FE0FF00780FE0EF0
0F00781CF81E0078387C3C003FF03FF00007C00FC00027267CA427>I<00F000000003FC
0001C0071E0003E00E1F0007E01C1F0007E03C1F0007E0381F000FE0383F000FC0703F00
0FC0703F000FC0707F001FC0F07E001F80E07E001F80E0FE001F8000FC003F8000FC003F
0001FC003F0001F8003F0001F8007F0003F8007E0003F0007E0003F0007E0003F000FE00
07F000FC0007E000FC0007E000FC0007E001FC0007E001F80007E001F80007E001F80007
E003F80007E003F00007E007F00003E00FF00003F01FF00001F87FE000007FF7E000001F
C7E00000000FE00000000FC00000000FC00000001FC0003F001F80007F003F80007F003F
00007F007E00007F007C00007E00FC00007001F800007003E000003807C000003C1F8000
000FFE00000003F0000000233679A428>I<FFFFFFFFFFFFFFFFFFF8FFFFFFFFFFFFFFFF
FFF84D02779655>124 D E /Fz 84 125 df<00000FF800FC0000007FFF07FF000001F8
07DF83C00007E001FF0FC0001F8007FE1FE0003F000FFC1FE0007E000FFC1FE0007E000F
F81FE000FC000FF81FE000FC000FF0078001F80007F0000001F80003F0000001F80003F0
000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F000
0001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F00000
FFFFFFFFFFF800FFFFFFFFFFF800FFFFFFFFFFF80001F80003F0000001F80003F0000001
F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F8
0003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F800
03F0000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003
F0000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F0
000001F80003F0000001F80003F0000001F80003F0000001F80003F0000001F80003F000
0001F80003F0000003FC0007F800007FFFE0FFFFF0007FFFE0FFFFF0007FFFE0FFFFF000
333B7FBA30>11 D<00000FF8000000007FFE00000001F80780000007E001C000001F8000
E000003F0007E000007E000FF000007E000FF00000FC000FF00000FC000FF00001F8000F
F00001F80007E00001F80001800001F80000000001F80000000001F80000000001F80000
000001F80000000001F80000000001F80000000001F80000000001F80000000001F80003
F000FFFFFFFFF000FFFFFFFFF000FFFFFFFFF00001F8000FF00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003
F00001F80003F00001F80003F00003FC0007F8007FFFE0FFFFC07FFFE0FFFFC07FFFE0FF
FFC02A3B7FBA2E>I<00000FFC000000007FFF70000001F803F0000007E007F000001F80
0FF000003F000FF000007E000FF000007E000FF00000FC000FF00000FC0007F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F000FFFFFFFFF000FFFFFFFFF000FFFFFFFFF00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00001F80003F00001F80003F00001F80003F00001F800
03F00001F80003F00001F80003F00003FC0007F8007FFFE0FFFFC07FFFE0FFFFC07FFFE0
FFFFC02A3B7FBA2E>I<00000FF0001FF0000000007FFE00FFFC00000001F80F83F00F00
000007E001CFC0038000001F8000FF0001C000003F0007FE000FC000007E000FFC001FE0
00007E000FFC001FE00000FC000FF8001FE00000FC000FF8001FE00001F8000FF0001FE0
0001F80007F0000FC00001F80003F00003000001F80003F00000000001F80003F0000000
0001F80003F00000000001F80003F00000000001F80003F00000000001F80003F0000000
0001F80003F00000000001F80003F00000000001F80003F00000000001F80003F00007E0
00FFFFFFFFFFFFFFE000FFFFFFFFFFFFFFE000FFFFFFFFFFFFFFE00001F80003F0001FE0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0001F80003F00007E00001F80003F00007E00001F80003F00007E00001F80003F00007E0
0003FC0007F8000FF0007FFFE0FFFFC1FFFF807FFFE0FFFFC1FFFF807FFFE0FFFFC1FFFF
80413B7FBA45>I<003C007E007E00FE01FE03FC03F007E00FC01F801E003C007800F000
C0000F0F6FB92A>19 D<1C007F00FF80FF80FF80FF80FF80FF80FF80FF807F007F007F00
7F007F007F007F007F007F007F007F003E003E003E003E003E003E003E003E003E003E00
3E001C001C001C001C001C001C001C001C001C001C001C00000000000000000000000000
000000001C007F00FF80FF80FF80FF80FF807F001C00093C79BB17>33
D<1C001C007F007F00FF80FF80FF80FF80FFC0FFC0FFC0FFC0FFC0FFC07FC07FC01CC01C
C000C000C000C000C000C000C000C000C001C001C0018001800180018003800380030003
0007000700060006000E000E001C001C003800380070007000600060001A197DB92A>I<
1C007F00FF80FF80FFC0FFC0FFC07FC01CC000C000C000C000C001C00180018003800300
070006000E001C003800700060000A1979B917>39 D<0000600000E00001C00003800007
00000E00001E00003C0000780000780000F00001E00001E00003C00003C00007C0000780
000F80000F00000F00001F00001E00001E00003E00003E00003E00007C00007C00007C00
007C00007C00007C0000F80000F80000F80000F80000F80000F80000F80000F80000F800
00F80000F80000F80000F80000F80000F80000F80000F80000F800007C00007C00007C00
007C00007C00007C00003E00003E00003E00001E00001E00001F00000F00000F00000F80
0007800007C00003C00003C00001E00001E00000F000007800007800003C00001E00000E
000007000003800001C00000E0000060135278BD20>I<C00000E000007000003800001C
00000E00000F000007800003C00003C00001E00000F00000F000007800007800007C0000
3C00003E00001E00001E00001F00000F00000F00000F80000F80000F800007C00007C000
07C00007C00007C00007C00003E00003E00003E00003E00003E00003E00003E00003E000
03E00003E00003E00003E00003E00003E00003E00003E00003E00003E00007C00007C000
07C00007C00007C00007C0000F80000F80000F80000F00000F00001F00001E00001E0000
3E00003C00007C0000780000780000F00000F00001E00003C00003C0000780000F00000E
00001C0000380000700000E00000C0000013527CBD20>I<000000300000000000007800
000000000078000000000000780000000000007800000000000078000000000000780000
000000007800000000000078000000000000780000000000007800000000000078000000
000000780000000000007800000000000078000000000000780000000000007800000000
000078000000000000780000000000007800000000000078000000000000780000000000
007800000000000078000000000000780000007FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFF
FFFFFFFC7FFFFFFFFFFFF800000078000000000000780000000000007800000000000078
000000000000780000000000007800000000000078000000000000780000000000007800
000000000078000000000000780000000000007800000000000078000000000000780000
000000007800000000000078000000000000780000000000007800000000000078000000
000000780000000000007800000000000078000000000000780000000000007800000000
00003000000036367BAF41>43 D<1C007F00FF80FF80FFC0FFC0FFC07FC01CC000C000C0
00C000C001C00180018003800300070006000E001C003800700060000A19798817>I<FF
FFFCFFFFFCFFFFFCFFFFFCFFFFFC16057F941C>I<1C007F00FF80FF80FF80FF80FF807F
001C000909798817>I<0000000C0000001E0000003E0000003E0000003C0000007C0000
007C00000078000000F8000000F8000000F0000001F0000001F0000001E0000003E00000
03E0000003C0000007C0000007C00000078000000F8000000F8000000F0000001F000000
1F0000001E0000003E0000003E0000003C0000007C0000007C00000078000000F8000000
F8000000F0000001F0000001F0000001E0000003E0000003E0000007C0000007C0000007
8000000F8000000F8000000F0000001F0000001F0000001E0000003E0000003E0000003C
0000007C0000007C00000078000000F8000000F8000000F0000001F0000001F0000001E0
000003E0000003E0000003C0000007C0000007C00000078000000F8000000F8000000F00
00001F0000001F0000001E0000003E0000003E0000003C0000007C0000007C0000007800
0000F8000000F8000000F0000000600000001F537BBD2A>I<0003F80000001FFF000000
7E0FC00000F803E00001E000F00003C000780007C0007C000F80003E000F80003E001F00
001F001F00001F003F00001F803F00001F803F00001F807E00000FC07E00000FC07E0000
0FC07E00000FC07E00000FC07E00000FC0FE00000FE0FE00000FE0FE00000FE0FE00000F
E0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0
FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE
00000FE07E00000FC07E00000FC07E00000FC07E00000FC07F00001FC03F00001F803F00
001F803F00001F801F00001F001F80003F000F80003E000F80003E0007C0007C0003E000
F80001F001F00000F803E000007E0FC000001FFF00000003F80000233A7DB72A>I<0001
C0000003C0000007C000001FC00000FFC000FFFFC000FFFFC000FF1FC000001FC000001F
C000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001F
C000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001F
C000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001F
C000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001F
C000001FC000001FC000001FC000001FC000001FC000001FC000003FE0007FFFFFF07FFF
FFF07FFFFFF01C3879B72A>I<000FF00000007FFE000001FFFF800003E03FE0000F000F
F0000E0007F8001C0003FC00380001FE00300001FE00700000FF00600000FF00FC0000FF
00FF00007F80FF80007F80FF80007F80FF80007F80FF80007F80FF80007F807F00007F80
1C00007F800000007F80000000FF00000000FF00000000FF00000001FE00000001FC0000
0003FC00000003F800000007F000000007E00000000FE00000001FC00000003F80000000
3F000000007C00000000F800000001F000000003E000000007C00000000F800000000F00
0000001E000180003C000180007800018000F000038001E000030003C000030007800003
000E000007000FFFFFFF001FFFFFFF003FFFFFFF007FFFFFFE00FFFFFFFE00FFFFFFFE00
FFFFFFFE0021387CB72A>I<0007F80000003FFF0000007FFFC00001F80FF00003C007F8
00078003FC000E0001FC000F0001FE001FE000FE001FF000FF001FF000FF001FF000FF00
1FF000FF001FF000FF000FE000FF0007C000FF00000000FE00000001FE00000001FE0000
0001FC00000003F800000003F800000007F000000007E00000000F800000007E0000001F
FC0000001FFF800000000FE000000007F000000001FC00000001FE00000000FF00000000
7F800000007F800000007FC00000007FC00000003FC00000003FE00000003FE01E00003F
E07F80003FE0FFC0003FE0FFC0003FE0FFC0003FE0FFC0003FE0FFC0003FC0FF80007FC0
7F80007F807E00007F80700000FF00380001FE001E0001FE000F8003F80007F00FF00001
FFFFC000007FFF0000000FF80000233A7DB72A>I<000000380000000038000000007800
000000F800000000F800000001F800000003F800000007F800000007F80000000FF80000
001FF80000001BF800000033F800000073F800000063F8000000C3F8000001C3F8000001
83F800000303F800000703F800000603F800000C03F800001C03F800001803F800003003
F800007003F800006003F80000C003F80001C003F800038003F800030003F800070003F8
000E0003F8000C0003F800180003F800380003F800300003F800600003F800E00003F800
FFFFFFFFF8FFFFFFFFF8FFFFFFFFF8000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F8000000
07FC000003FFFFF80003FFFFF80003FFFFF825397EB82A>I<0600000C000780003C0007
F003F80007FFFFF80007FFFFF00007FFFFE00007FFFF800007FFFF000007FFFC0000067F
E00000060000000006000000000600000000060000000006000000000600000000060000
000006000000000600000000060000000006000000000607F80000063FFE000006780F80
0007E007E000078003F000070001F800060001F800060000FC00000000FE00000000FE00
000000FF000000007F000000007F000000007F800000007F800000007F800000007F803E
00007F807F00007F80FF80007F80FF80007F80FF80007F80FF80007F80FF00007F00FE00
00FF00E00000FF00600000FE00700000FE00300001FC00380001F8001C0003F8001E0007
F0000F800FE00007E03F800001FFFF0000007FFC0000001FE00000213A7CB72A>I<0000
3FC0000001FFF0000007FFFC00000FE03E00003F800700007E001F0000FC003F8001F800
7F8003F0007F8003F0007F8007E0007F800FE0003F000FC0001E001FC00000001FC00000
003F800000003F800000003F800000007F800000007F000000007F01FC00007F07FF8000
FF1E07E000FF3801F000FF7000F800FF6000FC00FFE0007E00FFC0003F00FFC0003F00FF
80003F80FF80003FC0FF80001FC0FF80001FC0FF00001FE0FF00001FE0FF00001FE0FF00
001FE0FF00001FE07F00001FE07F00001FE07F00001FE07F00001FE07F00001FE03F8000
1FE03F80001FC03F80001FC01F80001FC01F80003F801FC0003F800FC0003F0007E0007F
0007E000FE0003F000FC0001F801F80000FE07F000003FFFC000001FFF00000003FC0000
233A7DB72A>I<300000000038000000003E000000003FFFFFFFE03FFFFFFFE03FFFFFFF
E03FFFFFFFC07FFFFFFFC07FFFFFFF807FFFFFFF0070000006006000000E006000001C00
6000001800E000003800C000007000C00000E000C00000C000000001C000000003800000
00030000000007000000000E000000000C000000001C0000000038000000003800000000
70000000007000000000F000000001E000000001E000000003E000000003E000000003C0
00000007C000000007C00000000FC00000000FC00000000FC00000001F800000001F8000
00001F800000003F800000003F800000003F800000003F800000003F800000007F800000
007F800000007F800000007F800000007F800000007F800000007F800000007F80000000
7F800000003F000000001E000000233B7BB82A>I<0003F80000001FFF0000007FFFC000
00FC07F00001E001F80003C000FC000780007C000700003E000F00001E000E00001F001E
00000F001E00000F001E00000F001F00000F001F00000F001F80000F001F80001F001FE0
001E000FF0003E000FFC003C000FFE00780007FF80F00007FFC1E00003FFF3C00001FFFF
000000FFFE0000003FFF0000001FFFC000001FFFE000007FFFF80000F0FFFC0003E07FFE
0007801FFF000F000FFF801F0003FF803E0001FFC03C00007FC07C00003FC07800000FE0
F8000007E0F0000007E0F0000003E0F0000003E0F0000001E0F0000001E0F0000001E0F8
000001C078000001C078000003C07C000003803E000007001F00000F000F80001E0007E0
007C0003F803F00000FFFFE000003FFF80000007FC0000233A7DB72A>I<0003F8000000
1FFF0000007FFFC00000FC07E00003F803F00007F001F8000FE000FC000FC0007E001FC0
007E003F80003F003F80003F007F80003F807F00003F807F00003F80FF00001FC0FF0000
1FC0FF00001FC0FF00001FC0FF00001FC0FF00001FC0FF00001FE0FF00001FE0FF00001F
E0FF00001FE0FF00001FE07F00003FE07F00003FE07F80003FE03F80003FE01F80007FE0
1F80007FE00FC000FFE007E000DFE003E001DFE001F0039FE000FC0F1FE0003FFC1FC000
07F01FC00000001FC00000003FC00000003F800000003F800000003F800000003F000000
007F000F00007E001F80007E003FC000FC003FC000FC003FC001F8003FC003F0003F8007
E0001F000FC0001C001F80000F807F000007FFFC000001FFF00000003FC00000233A7DB7
2A>I<1C007F00FF80FF80FF80FF80FF807F001C00000000000000000000000000000000
0000000000000000000000000000000000000000001C007F00FF80FF80FF80FF80FF807F
001C00092479A317>I<1C007F00FF80FF80FF80FF80FF807F001C000000000000000000
000000000000000000000000000000000000000000000000000000001C007F00FF00FF80
FF80FF80FF807F801D8001800180018001800380030003000700060006000E001C001800
380070006000093479A317>I<003FE00001FFFE0007C03F800E000FC03C0007F0300003
F0700003F87C0001F8FE0001FCFF0001FCFF0001FCFF0001FCFF0001FC7E0001FC3C0003
F8000003F8000007F0000007F000000FE000001F8000003F0000007E0000007C000000F8
000001F0000001E0000003C0000003800000038000000700000007000000070000000600
000006000000060000000600000006000000060000000600000006000000060000000600
000000000000000000000000000000000000000000000000000000000000000000000E00
00003F8000007FC000007FC000007FC000007FC000007FC000003F8000000E00001E3B7C
BA27>63 D<0000003800000000000038000000000000380000000000007C000000000000
7C0000000000007C000000000000FE000000000000FE000000000000FE000000000001FF
000000000001FF000000000001FF0000000000037F8000000000037F8000000000077FC0
00000000063FC000000000063FC0000000000E3FE0000000000C1FE0000000000C1FE000
0000001C1FF000000000180FF000000000180FF000000000380FF8000000003007F80000
00003007F8000000007007FC000000006003FC000000006003FC00000000C003FE000000
00C001FE00000000C001FE000000018001FF000000018000FF000000018000FF00000003
0000FF8000000300007F8000000300007F8000000600007FC0000007FFFFFFC0000007FF
FFFFC000000FFFFFFFE000000C00001FE000000C00001FE000001800000FF00000180000
0FF000001800000FF0000030000007F8000030000007F8000030000007F8000060000003
FC000060000003FC0000E0000003FC0000E0000001FE0001E0000001FE0003F0000001FF
000FFC000007FF80FFFF8000FFFFFEFFFF8000FFFFFEFFFF8000FFFFFE373C7DBB3E>65
D<FFFFFFFFE00000FFFFFFFFFC0000FFFFFFFFFF000001FF80007FC00000FF00001FE000
00FF00000FF00000FF000007F80000FF000003FC0000FF000003FC0000FF000001FE0000
FF000001FE0000FF000001FF0000FF000001FF0000FF000001FF0000FF000001FF0000FF
000001FF0000FF000001FF0000FF000001FF0000FF000001FE0000FF000003FE0000FF00
0003FC0000FF000007F80000FF00000FF00000FF00001FE00000FF00003FC00000FF0000
FF800000FFFFFFFC000000FFFFFFFC000000FF00007F800000FF00001FE00000FF000007
F00000FF000003F80000FF000001FC0000FF000001FE0000FF000000FF0000FF000000FF
0000FF000000FF8000FF0000007F8000FF0000007FC000FF0000007FC000FF0000007FC0
00FF0000007FC000FF0000007FC000FF0000007FC000FF0000007FC000FF0000007F8000
FF000000FF8000FF000000FF8000FF000001FF0000FF000001FE0000FF000003FE0000FF
000007FC0000FF00001FF80001FF80007FF000FFFFFFFFFFC000FFFFFFFFFF0000FFFFFF
FFF8000032397DB83B>I<000001FF80018000000FFFE0038000007FFFF803800001FF80
7E07800003FC000F0F80000FF000039F80001FE00001DF80003F800000FF80007F000000
7F8000FE0000003F8001FE0000003F8003FC0000001F8007F80000000F8007F80000000F
800FF000000007800FF000000007801FE000000007801FE000000003803FE00000000380
3FC000000003807FC000000001807FC000000001807FC000000001807F800000000180FF
800000000000FF800000000000FF800000000000FF800000000000FF800000000000FF80
0000000000FF800000000000FF800000000000FF800000000000FF800000000000FF8000
00000000FF800000000000FF8000000000007F8000000000007FC000000001807FC00000
0001807FC000000001803FC000000001803FE000000001801FE000000003801FE0000000
03000FF000000003000FF0000000070007F8000000070007F8000000060003FC0000000E
0001FE0000001C0000FE0000001800007F0000003800003F8000007000001FE00000E000
000FF00003C0000003FC000F80000001FF803F000000007FFFFC000000000FFFF0000000
0001FF800000313D7BBA3C>I<FFFFFFFFC00000FFFFFFFFF80000FFFFFFFFFE000001FF
8001FF800000FF00003FE00000FF00000FF00000FF000003F80000FF000001FC0000FF00
0000FE0000FF0000007F0000FF0000007F0000FF0000003F8000FF0000003FC000FF0000
001FC000FF0000001FE000FF0000000FE000FF0000000FF000FF0000000FF000FF000000
0FF000FF00000007F800FF00000007F800FF00000007F800FF00000007F800FF00000007
FC00FF00000007FC00FF00000007FC00FF00000007FC00FF00000007FC00FF00000007FC
00FF00000007FC00FF00000007FC00FF00000007FC00FF00000007FC00FF00000007FC00
FF00000007FC00FF00000007F800FF00000007F800FF00000007F800FF00000007F800FF
0000000FF000FF0000000FF000FF0000000FE000FF0000000FE000FF0000001FE000FF00
00001FC000FF0000003F8000FF0000003F8000FF0000007F0000FF000000FE0000FF0000
01FC0000FF000003F80000FF00000FF00000FF00003FE00001FF8000FF8000FFFFFFFFFF
0000FFFFFFFFF80000FFFFFFFFC0000036397DB83F>I<FFFFFFFFFFFC00FFFFFFFFFFFC
00FFFFFFFFFFFC0001FF80000FFC0000FF000001FC0000FF0000007E0000FF0000003E00
00FF0000001E0000FF0000000E0000FF0000000E0000FF0000000E0000FF000000060000
FF000000060000FF000000060000FF000000070000FF000000030000FF0000C0030000FF
0000C0030000FF0000C0030000FF0000C0000000FF0000C0000000FF0000C0000000FF00
01C0000000FF0001C0000000FF0003C0000000FF000FC0000000FFFFFFC0000000FFFFFF
C0000000FFFFFFC0000000FF000FC0000000FF0003C0000000FF0001C0000000FF0001C0
000000FF0000C0000000FF0000C0000000FF0000C0006000FF0000C0006000FF0000C000
6000FF0000C000E000FF00000000C000FF00000000C000FF00000000C000FF00000000C0
00FF00000001C000FF00000001C000FF00000001C000FF000000038000FF000000038000
FF000000078000FF000000078000FF0000000F8000FF0000003F8000FF0000007F8001FF
800007FF00FFFFFFFFFFFF00FFFFFFFFFFFF00FFFFFFFFFFFF0033397DB839>I<FFFFFF
FFFFF8FFFFFFFFFFF8FFFFFFFFFFF801FF80001FF800FF000001F800FF000000FC00FF00
00007C00FF0000003C00FF0000001C00FF0000001C00FF0000000C00FF0000000C00FF00
00000C00FF0000000C00FF0000000E00FF0000000600FF0000000600FF0001800600FF00
01800600FF0001800000FF0001800000FF0001800000FF0001800000FF0003800000FF00
03800000FF0007800000FF001F800000FFFFFF800000FFFFFF800000FFFFFF800000FF00
1F800000FF0007800000FF0003800000FF0003800000FF0001800000FF0001800000FF00
01800000FF0001800000FF0001800000FF0001800000FF0000000000FF0000000000FF00
00000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00
00000000FF0000000000FF0000000000FF0000000000FF0000000001FFC0000000FFFFFF
C00000FFFFFFC00000FFFFFFC000002F397DB836>I<000000FF8000C000000FFFF001C0
00003FFFFC01C00000FF803F03C00003FC000787C0000FF00003CFC0001FE00000EFC000
3FC000007FC0007F8000003FC000FF0000001FC001FE0000001FC003FC0000000FC007F8
00000007C007F800000007C00FF000000003C00FF000000003C01FE000000003C01FE000
000001C03FE000000001C03FC000000001C07FC000000000C07FC000000000C07FC00000
0000C07FC000000000C0FF800000000000FF800000000000FF800000000000FF80000000
0000FF800000000000FF800000000000FF800000000000FF800000000000FF8000000000
00FF800000000000FF800000000000FF800000FFFFFFFF800000FFFFFF7FC00000FFFFFF
7FC00000007FE07FC00000003FC07FC00000003FC03FC00000003FC03FE00000003FC01F
E00000003FC01FE00000003FC00FF00000003FC00FF00000003FC007F80000003FC007F8
0000003FC003FC0000003FC001FE0000003FC000FF0000007FC0007F8000007FC0003FC0
0000FFC0001FE00000EFC0000FF80003C7C00003FE000783C00000FFC03F01C000003FFF
FC00C000000FFFF00000000000FF800000383D7CBA41>I<FFFFFF01FFFFFEFFFFFF01FF
FFFEFFFFFF01FFFFFE01FF800003FF0000FF000001FE0000FF000001FE0000FF000001FE
0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE00
00FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000
FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF
000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FFFFFFFFFE0000FFFF
FFFFFE0000FFFFFFFFFE0000FF000001FE0000FF000001FE0000FF000001FE0000FF0000
01FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001
FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE
0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE00
00FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0000FF000001FE0001
FF800003FF00FFFFFF01FFFFFEFFFFFF01FFFFFEFFFFFF01FFFFFE37397DB83E>I<FFFF
FFC0FFFFFFC0FFFFFFC000FFC000007F8000007F8000007F8000007F8000007F8000007F
8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F
8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F
8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F
8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F8000007F
8000007F8000007F8000007F8000007F8000007F8000007F8000007F800000FFC000FFFF
FFC0FFFFFFC0FFFFFFC01A397EB81E>I<003FFFFFE0003FFFFFE0003FFFFFE000001FFC
00000007F800000007F800000007F800000007F800000007F800000007F800000007F800
000007F800000007F800000007F800000007F800000007F800000007F800000007F80000
0007F800000007F800000007F800000007F800000007F800000007F800000007F8000000
07F800000007F800000007F800000007F800000007F800000007F800000007F800000007
F800000007F800000007F800000007F800000007F800000007F800000007F800000007F8
00000007F800000007F800000007F8003F0007F8007F8007F800FFC007F800FFC007F800
FFC007F800FFC007F800FFC00FF000FF800FF0007F000FE00070001FE00038001FC0001C
003F80000E007F00000781FC000001FFF00000007F800000233B7DB82B>I<FFFFFF0001
FFFF00FFFFFF0001FFFF00FFFFFF0001FFFF0001FF8000007FF00000FF0000003F800000
FF0000003E000000FF0000003C000000FF00000038000000FF00000070000000FF000000
E0000000FF000001C0000000FF00000380000000FF00000700000000FF00000E00000000
FF00001C00000000FF00003800000000FF00007000000000FF0000E000000000FF0001C0
00000000FF00078000000000FF000E0000000000FF001C0000000000FF003E0000000000
FF007E0000000000FF00FF0000000000FF01FF0000000000FF03FF8000000000FF077FC0
00000000FF0E7FC000000000FF1C3FE000000000FF381FF000000000FF701FF000000000
FFE00FF800000000FFC007FC00000000FF8007FC00000000FF0003FE00000000FF0001FF
00000000FF0001FF00000000FF0000FF80000000FF00007FC0000000FF00007FC0000000
FF00003FE0000000FF00001FF0000000FF00001FF0000000FF00000FF8000000FF00000F
F8000000FF000007FC000000FF000003FE000000FF000003FE000000FF000001FF000000
FF000000FF800000FF000000FFC00000FF000000FFE00001FF800001FFF000FFFFFF001F
FFFF80FFFFFF001FFFFF80FFFFFF001FFFFF8039397DB841>I<FFFFFFE00000FFFFFFE0
0000FFFFFFE0000001FFC000000000FF0000000000FF0000000000FF0000000000FF0000
000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000
000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000
000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000
000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000
000000FF0000000000FF0000000000FF0000000000FF0000001800FF0000001800FF0000
001800FF0000001800FF0000001800FF0000003800FF0000003000FF0000003000FF0000
003000FF0000007000FF0000007000FF0000007000FF000000F000FF000000F000FF0000
01F000FF000003F000FF00000FF000FF00001FE001FF8000FFE0FFFFFFFFFFE0FFFFFFFF
FFE0FFFFFFFFFFE02D397DB834>I<FFFF0000000007FFF8FFFF800000000FFFF8FFFF80
0000000FFFF801FF800000000FFC0000DFC00000001BF80000DFC00000001BF80000CFE0
00000033F80000CFE000000033F80000CFE000000033F80000C7F000000063F80000C7F0
00000063F80000C7F000000063F80000C3F8000000C3F80000C3F8000000C3F80000C1FC
00000183F80000C1FC00000183F80000C1FC00000183F80000C0FE00000303F80000C0FE
00000303F80000C07F00000603F80000C07F00000603F80000C07F00000603F80000C03F
80000C03F80000C03F80000C03F80000C03F80000C03F80000C01FC0001803F80000C01F
C0001803F80000C00FE0003003F80000C00FE0003003F80000C00FE0003003F80000C007
F0006003F80000C007F0006003F80000C003F800C003F80000C003F800C003F80000C003
F800C003F80000C001FC018003F80000C001FC018003F80000C001FC018003F80000C000
FE030003F80000C000FE030003F80000C0007F060003F80000C0007F060003F80000C000
7F060003F80000C0003F8C0003F80000C0003F8C0003F80000C0001FD80003F80000C000
1FD80003F80000C0001FD80003F80000C0000FF00003F80000C0000FF00003F80000C000
0FF00003F80001E00007E00003F80003F00007E00003F8000FFC0003C00007FC00FFFFC0
03C003FFFFF8FFFFC003C003FFFFF8FFFFC0018003FFFFF845397DB84C>I<FFFF000007
FFFEFFFF800007FFFEFFFFC00007FFFE00FFC000007FE000FFE000001F8000DFF000000F
0000DFF00000060000CFF80000060000C7FC0000060000C7FC0000060000C3FE00000600
00C1FF0000060000C1FF0000060000C0FF8000060000C07FC000060000C07FC000060000
C03FE000060000C01FF000060000C01FF800060000C00FF800060000C007FC00060000C0
07FE00060000C003FE00060000C001FF00060000C001FF80060000C000FF80060000C000
7FC0060000C0007FE0060000C0003FE0060000C0001FF0060000C0000FF8060000C0000F
F8060000C00007FC060000C00003FE060000C00003FE060000C00001FF060000C00000FF
860000C00000FF860000C000007FC60000C000003FE60000C000003FE60000C000001FF6
0000C000000FFE0000C000000FFE0000C0000007FE0000C0000003FE0000C0000003FE00
00C0000001FE0000C0000000FE0000C0000000FE0000C00000007E0001E00000003E0003
F00000003E000FFC0000001E00FFFFC000000E00FFFFC000000E00FFFFC0000006003739
7DB83E>I<000003FF00000000001FFFE000000000FE01FC00000001F8007E00000007E0
001F8000000FC0000FC000003F800007F000007F000003F80000FE000001FC0001FC0000
00FE0001F80000007E0003F80000007F0007F00000003F8007F00000003F800FE0000000
1FC00FE00000001FC01FE00000001FE01FC00000000FE03FC00000000FF03FC00000000F
F03FC00000000FF07FC00000000FF87F8000000007F87F8000000007F87F8000000007F8
FF8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF
8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF80
00000007FCFF8000000007FC7F8000000007F87FC00000000FF87FC00000000FF87FC000
00000FF83FC00000000FF03FC00000000FF01FE00000001FE01FE00000001FE01FE00000
001FE00FF00000003FC007F00000003F8007F80000007F8003F80000007F0001FC000000
FE0001FC000000FE0000FE000001FC00007F000003F800003F800007F000001FC0000FE0
000007E0001F80000003F8007F00000000FE01FC000000001FFFE00000000003FF000000
363D7BBA41>I<FFFFFFFFC000FFFFFFFFF800FFFFFFFFFE0001FF8001FF8000FF00003F
C000FF00000FE000FF000007F000FF000003F800FF000003FC00FF000003FE00FF000001
FE00FF000001FE00FF000001FF00FF000001FF00FF000001FF00FF000001FF00FF000001
FF00FF000001FF00FF000001FF00FF000001FE00FF000001FE00FF000003FC00FF000003
FC00FF000007F800FF000007F000FF00000FE000FF00003FC000FF0001FF0000FFFFFFFC
0000FFFFFFF00000FF0000000000FF0000000000FF0000000000FF0000000000FF000000
0000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF000000
0000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF000000
0000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF000000
0001FF80000000FFFFFF000000FFFFFF000000FFFFFF00000030397DB839>I<000003FF
00000000001FFFE000000000FE01FC00000001F8007E00000007E0001F8000000FC0000F
C000003F800007F000007F000003F80000FE000001FC0001FC000000FE0001FC000000FE
0003F80000007F0007F80000007F8007F00000003F800FF00000003FC00FE00000001FC0
1FE00000001FE01FE00000001FE03FC00000000FF03FC00000000FF03FC00000000FF07F
C00000000FF87FC00000000FF87F8000000007F87F8000000007F8FF8000000007FCFF80
00000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF8000
000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF8000000007FCFF800000
0007FC7F8000000007F87F8000000007F87FC00000000FF87FC00000000FF83FC0000000
0FF03FC00000000FF01FE00000001FE01FE00000001FE01FE00000001FE00FF00000003F
C007F0007C003F8007F001FF003F8003F80383807F0001FC0701C0FE0001FC0E00C0FE00
00FE0C00E1FC00007F0C0063F800003F8C0077F000001FCC003FE0000007EE003F800000
03FF007F00000000FF81FC000C00001FFFFC000C000003FF1C000C000000001E001C0000
00001F001C000000001F003C000000001F807C000000001FC0F8000000000FFFF8000000
000FFFF8000000000FFFF8000000000FFFF00000000007FFF00000000007FFE000000000
03FFC00000000001FF8000000000007E00364B7BBA41>I<FFFFFFFE00000000FFFFFFFF
E0000000FFFFFFFFF800000001FF8007FE00000000FF0000FF80000000FF00003FC00000
00FF00001FE0000000FF00000FF0000000FF000007F8000000FF000007F8000000FF0000
03FC000000FF000003FC000000FF000003FE000000FF000003FE000000FF000003FE0000
00FF000003FE000000FF000003FE000000FF000003FE000000FF000003FC000000FF0000
03FC000000FF000007F8000000FF000007F8000000FF00000FF0000000FF00001FE00000
00FF00003F80000000FF0000FF00000000FF0007FC00000000FFFFFFE000000000FFFFFF
C000000000FF000FF000000000FF0003F800000000FF0000FE00000000FF0000FF000000
00FF00007F80000000FF00003FC0000000FF00003FC0000000FF00001FC0000000FF0000
1FE0000000FF00001FE0000000FF00001FE0000000FF00001FE0000000FF00001FE00000
00FF00001FF0000000FF00001FF0000000FF00001FF0000000FF00001FF0000000FF0000
1FF0000000FF00001FF0000000FF00001FF0018000FF00001FF0018000FF00001FF80180
00FF00000FF8018000FF00000FF8038001FF800007F80300FFFFFF0003FC0700FFFFFF00
01FC0600FFFFFF0000FE0E0000000000003FFC00000000000007F000393B7DB83D>I<00
0FF800C0003FFE01C000FFFF81C003F807E3C007E000F7C00FC0007FC01F80003FC03F00
001FC03E00000FC07E000007C07E000007C07C000003C0FC000003C0FC000001C0FC0000
01C0FC000001C0FE000000C0FE000000C0FE000000C0FF000000C0FF800000007FC00000
007FE00000007FF80000003FFF8000001FFFF800001FFFFF80000FFFFFE00007FFFFF800
03FFFFFE0000FFFFFF00003FFFFF800007FFFFC000007FFFC0000007FFE00000007FE000
00003FF00000001FF00000000FF000000007F800000007F8C0000003F8C0000003F8C000
0001F8C0000001F8C0000001F8E0000001F8E0000001F8E0000001F0F0000001F0F00000
03F0F8000003E0FC000007E0FE000007C0FF00000FC0FF80001F80FBF0003F00F0FE00FE
00E03FFFF800E00FFFE000C001FF0000253D7CBA2E>I<3FFFFFFFFFFFE03FFFFFFFFFFF
E03FFFFFFFFFFFE03FC003FF001FE03E0001FE0003E07C0001FE0001F0780001FE0000F0
700001FE000070700001FE000070700001FE000070600001FE000030600001FE00003060
0001FE000030600001FE000030E00001FE000038C00001FE000018C00001FE000018C000
01FE000018C00001FE000018000001FE000000000001FE000000000001FE000000000001
FE000000000001FE000000000001FE000000000001FE000000000001FE000000000001FE
000000000001FE000000000001FE000000000001FE000000000001FE000000000001FE00
0000000001FE000000000001FE000000000001FE000000000001FE000000000001FE0000
00000001FE000000000001FE000000000001FE000000000001FE000000000001FE000000
000001FE000000000001FE000000000001FE000000000001FE000000000001FE00000000
0001FE000000000001FE000000000001FE000000000001FE000000000001FE0000000000
07FF800000001FFFFFFFE000001FFFFFFFE000001FFFFFFFE00035397DB83C>I<FFFFFF
0007FFFEFFFFFF0007FFFEFFFFFF0007FFFE01FF8000007FE000FF0000001F8000FF0000
000F0000FF000000060000FF000000060000FF000000060000FF000000060000FF000000
060000FF000000060000FF000000060000FF000000060000FF000000060000FF00000006
0000FF000000060000FF000000060000FF000000060000FF000000060000FF0000000600
00FF000000060000FF000000060000FF000000060000FF000000060000FF000000060000
FF000000060000FF000000060000FF000000060000FF000000060000FF000000060000FF
000000060000FF000000060000FF000000060000FF000000060000FF000000060000FF00
0000060000FF000000060000FF000000060000FF000000060000FF000000060000FF0000
00060000FF0000000E00007F0000000C00007F8000000C00007F8000001C00003F800000
1C00003F8000001800001FC000003800001FC000007000000FE00000F0000007F00000E0
000003F80001C0000001FC000780000000FE000F000000007F807E000000001FFFF80000
000007FFE000000000007F800000373B7DB83E>I<FFFFFC00007FFF80FFFFFC00007FFF
80FFFFFC00007FFF8003FF8000000FFC0001FF00000007E00001FF00000003C00000FF00
000001800000FF800000038000007F800000030000007F800000030000007FC000000300
00003FC00000060000003FC00000060000003FE000000E0000001FE000000C0000001FF0
00000C0000000FF00000180000000FF00000180000000FF800001800000007F800003000
000007F800003000000007FC00007000000003FC00006000000003FC00006000000001FE
0000C000000001FE0000C000000001FF0000C000000000FF00018000000000FF00018000
000000FF800380000000007F800300000000007F800300000000003FC00600000000003F
C00600000000003FE00600000000001FE00C00000000001FE00C00000000001FF01C0000
0000000FF01800000000000FF018000000000007F830000000000007F830000000000007
FC30000000000003FC60000000000003FC60000000000003FEE0000000000001FEC00000
00000001FEC0000000000000FF80000000000000FF80000000000000FF80000000000000
7F000000000000007F000000000000007F000000000000003E000000000000003E000000
000000001C000000000000001C000000000000001C00000000393B7EB83E>I<FFFFFC07
FFFFF001FFFFFFFFFC07FFFFF001FFFFFFFFFC07FFFFF001FFFF07FF80001FFE00001FF8
03FE00000FF8000007E001FE000007F8000003C001FE000007F80000038001FF000007F8
0000038000FF000003FC0000030000FF000003FC0000030000FF800003FC00000700007F
800001FE00000600007F800001FE00000600007FC00001FE00000600003FC00003FF0000
0C00003FC00003FF00000C00003FE00003FF00000C00001FE00007FF80001800001FE000
067F80001800001FE000067F80001800000FF0000E7FC0003000000FF0000C3FC0003000
000FF0000C3FC00030000007F8001C3FE00060000007F800181FE00060000007F800181F
E00060000003FC00181FF000C0000003FC00300FF000C0000003FC00300FF000C0000001
FE00300FF80180000001FE006007F80180000001FE006007F80180000000FF006007F803
00000000FF00C003FC0300000000FF00C003FC0300000000FF80C003FC07000000007F81
8001FE06000000007F818001FE06000000007FC18001FE0E000000003FC30000FF0C0000
00003FC30000FF0C000000003FE30000FF1C000000001FE600007F98000000001FE60000
7F98000000001FF600007F98000000000FFC00003FF0000000000FFC00003FF000000000
0FFC00003FF00000000007FC00003FE00000000007F800001FE00000000007F800001FE0
0000000003F800001FC00000000003F000000FC00000000003F000000FC00000000001F0
00000F800000000001E0000007800000000001E0000007800000000000E0000007000000
000000C0000003000000503B7EB855>I<7FFFFF003FFFFC007FFFFF003FFFFC007FFFFF
003FFFFC0000FFF80007FF8000007FE00003FC0000003FE00001F00000001FF00001E000
00001FF00001C00000000FF800018000000007FC00038000000007FC00070000000003FE
00060000000003FE000E0000000001FF001C0000000000FF80180000000000FF80380000
0000007FC03000000000003FE06000000000003FE0E000000000001FF0C000000000000F
F18000000000000FFB80000000000007FF00000000000007FE00000000000003FE000000
00000001FF00000000000001FF00000000000000FF800000000000007FC0000000000000
7FC0000000000000FFE0000000000000DFE00000000000019FF00000000000038FF80000
000000030FF800000000000607FC00000000000E03FE00000000000C03FE000000000018
01FF00000000003800FF00000000003000FF800000000060007FC000000000E0007FC000
000000C0003FE00000000180001FF00000000380001FF00000000300000FF80000000600
0007FC0000000E000007FC0000000C000003FE0000001C000001FE0000003C000001FF00
0000FE000001FF800007FF800007FFE000FFFFE0003FFFFF80FFFFE0003FFFFF80FFFFE0
003FFFFF8039397EB83E>I<FFFFFE00003FFFE0FFFFFE00003FFFE0FFFFFE00003FFFE0
03FFE0000007FE0000FFC0000003F000007FC0000001E000007FC0000001C000003FE000
00018000001FF00000038000001FF00000030000000FF80000060000000FF80000060000
0007FC00000C00000003FE00001C00000003FE00001800000001FF00003800000001FF00
003000000000FF800060000000007FC000E0000000007FC000C0000000003FE001C00000
00003FE00180000000001FF00380000000000FF80300000000000FF806000000000007FC
0E000000000007FC0C000000000003FE1C000000000001FF18000000000001FF30000000
000000FFB0000000000000FFE00000000000007FE00000000000003FC00000000000003F
C00000000000003FC00000000000003FC00000000000003FC00000000000003FC0000000
0000003FC00000000000003FC00000000000003FC00000000000003FC00000000000003F
C00000000000003FC00000000000003FC00000000000003FC00000000000003FC0000000
0000003FC00000000000003FC00000000000003FC00000000000003FC00000000000003F
C00000000000007FE000000000003FFFFFC0000000003FFFFFC0000000003FFFFFC00000
3B397FB83E>I<FFF8FFF8FFF8FFF8F000F000F000F000F000F000F000F000F000F000F0
00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F0
00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F0
00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F0
00F000F000F000F000F000F000F000F000F000F000FFF8FFF8FFF8FFF80D5378BD17>91
D<0180018003800380070007000E000E001C001C00180018003800380030003000700070
006000600060006000E000E000C000C000C000C000C000C000C000C000CE00CE00FF80FF
80FFC0FFC0FFC0FFC0FFC0FFC07FC07FC07FC07FC03F803F800E000E001A1974B92A>I<
FFF8FFF8FFF8FFF800780078007800780078007800780078007800780078007800780078
007800780078007800780078007800780078007800780078007800780078007800780078
007800780078007800780078007800780078007800780078007800780078007800780078
007800780078007800780078007800780078007800780078007800780078007800780078
0078007800780078007800780078FFF8FFF8FFF8FFF80D537FBD17>I<001FE0000000FF
FC000003E03F000007000F80000F8007E0001FC003F0001FE003F0001FE001F8001FE001
F8001FE000FC000FC000FC00078000FC00000000FC00000000FC00000000FC00000000FC
0000007FFC000007FFFC00003FE0FC0000FE00FC0003F800FC000FF000FC001FC000FC00
3FC000FC007F8000FC007F0000FC007F0000FC0CFE0000FC0CFE0000FC0CFE0000FC0CFE
0001FC0CFE0001FC0CFF0003FC0C7F00077C0C7F80063E183FC01E3E180FE0781FF003FF
F00FE0007F8007C026277DA52A>97 D<03F0000000FFF0000000FFF0000000FFF0000000
0FF000000003F000000003F000000003F000000003F000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F01FE00003F07FF80003F1E03E0003F3801F8003F700
0FC003FE0007E003FC0003F003F80001F803F00001F803F00000FC03F00000FC03F00000
FE03F00000FE03F000007E03F000007F03F000007F03F000007F03F000007F03F000007F
03F000007F03F000007F03F000007F03F000007F03F000007F03F000007E03F00000FE03
F00000FE03F00000FC03F00001FC03F80001F803F80003F003FC0003F003EE0007E003C6
000FC003C7801F000381E07E000300FFF80000001FC000283B7EB92E>I<0003FC00001F
FF80007E03E001F8007003F000F807E001FC0FC003FC0FC003FC1F8003FC3F8003FC3F00
01F87F0000F07F0000007F0000007E000000FE000000FE000000FE000000FE000000FE00
0000FE000000FE000000FE000000FE000000FE0000007E0000007F0000007F0000003F00
00063F8000061F80000E1FC0000C0FC0001C07E0003803F0007001F800E0007C07C0001F
FF000007F8001F277DA525>I<0000000FC0000003FFC0000003FFC0000003FFC0000000
3FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000F
C00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC0
0000000FC00000000FC00003F80FC0001FFF0FC0007E078FC000F801EFC003F0007FC007
E0003FC00FC0001FC00FC0001FC01F80000FC03F80000FC03F00000FC07F00000FC07F00
000FC07E00000FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC0FE0000
0FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC07E00000FC07F00000FC07F00000F
C03F00000FC03F00000FC01F80001FC01F80001FC00FC0003FC007E0007FC003F000EFF0
01F801CFFF007C078FFF001FFE0FFF0007F80FC0283B7DB92E>I<0007F800001FFF0000
7C0FC001F803E003F001F007E001F80FC000F81F80007C1F80007C3F00007E3F00003E7F
00003E7F00003F7E00003FFE00003FFE00003FFE00003FFFFFFFFFFFFFFFFFFE000000FE
000000FE000000FE000000FE0000007E0000007E0000007F0000007F0000003F0000033F
8000031F8000070FC0000607C0000E07E0001C01F0003800F80070007E03E0001FFF8000
03FC0020277EA525>I<00007E000003FF80000FC1E0001F87E0003F0FF0007E0FF0007E
0FF000FC0FF000FC0FF001F803C001F8000001F8000001F8000001F8000001F8000001F8
000001F8000001F8000001F8000001F8000001F8000001F8000001F80000FFFFFC00FFFF
FC00FFFFFC0001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8
000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8
000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8
000001F8000001F8000001F8000003FC00007FFFF8007FFFF8007FFFF8001C3B7FBA19>
I<00000003F0000FF00FF8003FFC3C3C00F81F707C01F00FE07C03E007C07C07C003E010
0FC003F0000FC003F0001F8001F8001F8001F8001F8001F8001F8001F8001F8001F8001F
8001F8001F8001F8001F8001F8000FC003F0000FC003F00007C003E00003E007C00003F0
0F800003F81F0000073FFC0000060FF000000E000000000E000000000E000000000E0000
00000F000000000F000000000FC000000007FFFFC00007FFFFF80003FFFFFE0001FFFFFF
8003FFFFFFC00F80007FE01F00000FF03E000003F07C000001F07C000001F8F8000000F8
F8000000F8F8000000F8F8000000F8F8000000F8FC000001F87C000001F03E000003E03F
000007E00F80000F8007E0003F0001FC01FC00007FFFF0000007FF000026387EA52A>I<
03F000000000FFF000000000FFF000000000FFF0000000000FF00000000003F000000000
03F00000000003F00000000003F00000000003F00000000003F00000000003F000000000
03F00000000003F00000000003F00000000003F00000000003F00000000003F000000000
03F00000000003F00000000003F00000000003F00FF0000003F03FFC000003F0F03F0000
03F1C01F800003F3800FC00003F7000FC00003FE000FC00003FC0007E00003FC0007E000
03F80007E00003F80007E00003F80007E00003F00007E00003F00007E00003F00007E000
03F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E000
03F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E000
03F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E000
07F8000FF000FFFFC1FFFF80FFFFC1FFFF80FFFFC1FFFF80293A7EB92E>I<0380000FE0
001FF0001FF0001FF0001FF0001FF0000FE0000380000000000000000000000000000000
0000000000000000000000000000000003F000FFF000FFF000FFF00007F00003F00003F0
0003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F0
0003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F0
0003F00003F00007F800FFFFC0FFFFC0FFFFC012387EB717>I<0001C00007F0000FF800
0FF8000FF8000FF8000FF80007F00001C000000000000000000000000000000000000000
00000000000000000000000001F800FFF800FFF800FFF80007F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F83C01F87E
01F8FF01F0FF03F0FF03F0FF03E0FE07C07C07C03C0F000FFE0003F800154984B719>I<
03F0000000FFF0000000FFF0000000FFF00000000FF000000003F000000003F000000003
F000000003F000000003F000000003F000000003F000000003F000000003F000000003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F001FFFC03F001FFFC03F001FFFC03F0007FC003F0007F0003F0007C0003F00070
0003F000E00003F001C00003F003800003F007000003F01E000003F038000003F0780000
03F0FC000003F1FC000003F3FE000003F73F000003FE3F800003F81F800003F00FC00003
F00FE00003F007E00003F003F00003F001F80003F001FC0003F000FC0003F0007E0003F0
007F0003F0003F0003F0003F8003F0001FC007F8003FF0FFFFC0FFFFFFFFC0FFFFFFFFC0
FFFF283A7EB92C>I<03F000FFF000FFF000FFF0000FF00003F00003F00003F00003F000
03F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F000
03F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F000
03F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F00003F000
03F00003F00003F00003F00003F00003F00003F00003F00003F00007F800FFFFC0FFFFC0
FFFFC0123A7EB917>I<03F00FF0001FE000FFF03FFC007FF800FFF0F03F01E07E00FFF1
C01F83803F000FF3800FC7001F8003F7000FCE001F8003FE000FDC001F8003FC0007F800
0FC003FC0007F8000FC003F80007F0000FC003F80007F0000FC003F80007F0000FC003F0
0007E0000FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F00007E000
0FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F0
0007E0000FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F00007E000
0FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F00007E0000FC003F0
0007E0000FC003F00007E0000FC003F00007E0000FC007F8000FF0001FE0FFFFC1FFFF83
FFFFFFFFC1FFFF83FFFFFFFFC1FFFF83FFFF40257EA445>I<03F00FF00000FFF03FFC00
00FFF0F03F0000FFF1C01F80000FF3800FC00003F7000FC00003FE000FC00003FC0007E0
0003FC0007E00003F80007E00003F80007E00003F80007E00003F00007E00003F00007E0
0003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E0
0003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E0
0003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E0
0003F00007E00007F8000FF000FFFFC1FFFF80FFFFC1FFFF80FFFFC1FFFF8029257EA42E
>I<0003FE0000000FFF8000003E03E00000F800F80001F0007C0003E0003E0007C0001F
000F80000F801F80000FC01F000007C03F000007E03F000007E07E000003F07E000003F0
7E000003F07E000003F0FE000003F8FE000003F8FE000003F8FE000003F8FE000003F8FE
000003F8FE000003F8FE000003F8FE000003F87E000003F07E000003F07F000007F03F00
0007E03F000007E01F80000FC00F80000F800FC0001F8007E0003F0003F0007E0000F800
F800007E03F000001FFFC0000003FE000025277EA52A>I<03F01FE000FFF07FF800FFF1
E07E00FFF3801F8007F7000FC003FE0007E003FC0003F003F80003F803F00001F803F000
01FC03F00000FC03F00000FE03F00000FE03F00000FE03F000007F03F000007F03F00000
7F03F000007F03F000007F03F000007F03F000007F03F000007F03F000007F03F000007F
03F00000FE03F00000FE03F00000FE03F00001FC03F00001FC03F80003F803F80003F003
FC0007F003FE000FE003F6000FC003F7803F0003F1E07E0003F0FFF80003F01FC00003F0
00000003F000000003F000000003F000000003F000000003F000000003F000000003F000
000003F000000003F000000003F000000007F8000000FFFFC00000FFFFC00000FFFFC000
0028357EA42E>I<0003F800C0001FFE01C0007E0781C000FC01C3C003F000E3C007F000
77C00FE00037C00FC0003FC01FC0001FC03F80001FC03F80000FC07F00000FC07F00000F
C07F00000FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC0FE00000FC0
FE00000FC0FE00000FC0FE00000FC0FE00000FC07F00000FC07F00000FC07F00000FC03F
00000FC03F80001FC01F80001FC01FC0003FC00FC0003FC007E0007FC003F000EFC001F8
01CFC0007E078FC0001FFE0FC00007F80FC00000000FC00000000FC00000000FC0000000
0FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000FC00000000F
C00000001FE0000003FFFF000003FFFF000003FFFF28357DA42C>I<07E01F00FFE07FC0
FFE1E3E0FFE387F00FE707F003E607F003EE07F003EC03E003FC008003F8000003F80000
03F8000003F8000003F0000003F0000003F0000003F0000003F0000003F0000003F00000
03F0000003F0000003F0000003F0000003F0000003F0000003F0000003F0000003F00000
03F0000003F0000003F0000003F0000007F80000FFFFF000FFFFF000FFFFF0001C257EA4
21>I<00FF030003FFE7000F80FF001E003F003C001F0078000F0070000700F0000700F0
000700F0000300F8000300F8000300FC000300FF0000007FE000007FFF00003FFFE0001F
FFF8000FFFFC0003FFFE0000FFFF000007FF8000007F8000001F80C0000FC0C00007C0C0
0007C0E00003C0E00003C0E00003C0F00003C0F0000380F8000780FC000780FC000F00FF
001E00F3C07C00E1FFF000C03F80001A277DA521>I<0018000000180000001800000018
00000018000000380000003800000038000000780000007800000078000000F8000001F8
000003F8000007F800001FFFFF00FFFFFF00FFFFFF0001F8000001F8000001F8000001F8
000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8
000001F8000001F8000001F8000001F8000001F8000001F800C001F800C001F800C001F8
00C001F800C001F800C001F800C001F800C001F800C000FC01C000FC0180007C0380007E
0300003F0700000FFE000001F8001A347FB220>I<03F00007E000FFF001FFE000FFF001
FFE000FFF001FFE0000FF0001FE00003F00007E00003F00007E00003F00007E00003F000
07E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F000
07E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F000
07E00003F00007E00003F00007E00003F00007E00003F00007E00003F00007E00003F000
07E00003F0000FE00003F0000FE00003F0000FE00003F0001FE00001F0001FE00001F800
3FE00000F80077F80000FC00E7FF80003F03C7FF80001FFF87FF800003FC07E00029267E
A42E>I<FFFF803FFEFFFF803FFEFFFF803FFE0FF8000FF007F00007E003F00003C003F8
00038001F800030001F800030000FC00060000FC00060000FE000E00007E000C00007E00
0C00003F001800003F001800003F803800001F803000001F803000000FC06000000FC060
00000FE060000007E0C0000007E0C0000003F180000003F180000003F180000001FB0000
0001FB00000001FF00000000FE00000000FE000000007C000000007C000000007C000000
00380000000038000027257EA32C>I<FFFF1FFFE03FFEFFFF1FFFE03FFEFFFF1FFFE03F
FE0FF800FF000FF807F0007E0003E007F0007E0003C003F0003E00018003F0003E000180
01F8003F00030001F8003F00030001F8003F00030000FC003F80060000FC006F80060000
FC006F800600007E00EFC00C00007E00C7C00C00007E00C7C00C00003F01C7E01800003F
0183E01800003F8183F03800001F8383F03000001F8301F03000001FC301F87000000FC6
00F86000000FC600F860000007E600FCC0000007EC007CC0000007EC007CC0000003FC00
7F80000003F8003F80000003F8003F80000001F8003F00000001F0001F00000001F0001F
00000000F0001E00000000E0000E0000000060000C000037257EA33C>I<FFFF807FFF00
FFFF807FFF00FFFF807FFF0003FE003FF00001FE001F800000FE001F0000007E001C0000
003F00180000001F80300000001FC0700000000FC0E000000007E0C000000007F1800000
0003FB8000000001FF0000000000FE0000000000FE00000000007F00000000003F000000
00007F80000000007FC000000000CFC000000001C7E00000000383F00000000703F80000
000601F80000000C00FC0000001C007E00000038007F00000078003F000000F0001F8000
01F8001FC0000FF8003FF000FFFE00FFFF80FFFE00FFFF80FFFE00FFFF8029247FA32C>
I<FFFF803FFEFFFF803FFEFFFF803FFE0FF8000FF007F00007C003F000038001F8000380
01F800030001FC00030000FC00060000FC000600007E000C00007E000C00007F000C0000
3F001800003F001800001F803000001F803000001FC07000000FC06000000FC060000007
E0C0000007E0C0000007F1C0000003F180000003F180000001FB00000001FB00000001FF
00000000FE00000000FE000000007C000000007C000000007C0000000038000000003800
00000030000000003000000000700000000060000000006000000000C000000000C00000
7C01C00000FE01800000FE03800000FE03000000FE06000000FC0E000000701C00000038
380000001FF00000000FC000000027357EA32C>I<3FFFFFFC3FFFFFFC3F8003FC3E0003
F83C0007F038000FE030000FE070001FC070003F8060007F8060007F006000FE006001FC
006001FC000003F8000007F0000007F000000FE000001FC000003F8000003F8000007F00
0600FE000600FE000601FC000603F8000607F8000E07F0000E0FE0000C1FC0001C1FC000
1C3F80003C7F00007CFF0003FCFFFFFFFCFFFFFFFC1F247EA325>I<FFFFFFFFFF80FFFF
FFFFFF80290280962A>I<FFFFFFFFFFFFFFFFFFFFC0FFFFFFFFFFFFFFFFFFFFC0520280
9653>I E /FA 60 123 df<000003FF8007FE0000007FFFF07FFF800003FFFFFDFFFFE0
000FFF00FFFE0FF0003FF800FFF81FF0007FE001FFF03FF800FFC003FFF03FF801FFC003
FFE03FF801FF8003FFE03FF803FF8003FFC03FF803FF0003FFC01FF003FF0001FFC01FF0
03FF0001FFC007C003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000
FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC00000
FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE000FFFFFFFFFFFFE00003FF0000
FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC00000
03FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000
FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC00000
03FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000
FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC00000
03FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000FFC0000003FF0000
FFC0000003FF0000FFC00000FFFFFC3FFFFF8000FFFFFC3FFFFF8000FFFFFC3FFFFF8000
FFFFFC3FFFFF80003D3A7EB938>11 D<000003FFC00000007FFFF0000003FFFFFC00000F
FF00FE00003FF8003F00007FE000FF8000FFC001FF8001FFC001FF8001FF8001FF8003FF
8003FFC003FF0001FF8003FF0001FF8003FF0001FF8003FF0000FF0003FF00007E0003FF
0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF003FFFC0FFFF
FFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC003FF0000FFC003FF0000FFC003FF
0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF
0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF
0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF
0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF
0000FFC003FF0000FFC003FF0000FFC0FFFFFC3FFFFFFFFFFC3FFFFFFFFFFC3FFFFFFFFF
FC3FFFFF303A7EB935>I<0F803FE07FF07FF0FFF8FFF8FFFCFFFCFFFC7FFC7FFC3FFC0F
9C001C003C0038003800380078007000F001E001E003C007800F001F001C0018000E1D79
8C1B>44 D<FFFFFF80FFFFFF80FFFFFF80FFFFFF80FFFFFF80FFFFFF80FFFFFF80FFFFFF
8019087F9620>I<000000007000000000F800000000F800000001F800000001F0000000
01F000000003F000000003E000000007E000000007C000000007C00000000FC00000000F
800000001F800000001F000000003F000000003E000000003E000000007E000000007C00
000000FC00000000F800000000F800000001F800000001F000000003F000000003E00000
0003E000000007E000000007C00000000FC00000000F800000001F800000001F00000000
1F000000003F000000003E000000007E000000007C000000007C00000000FC00000000F8
00000001F800000001F000000001F000000003F000000003E000000007E000000007C000
000007C00000000FC00000000F800000001F800000001F000000003F000000003E000000
003E000000007E000000007C00000000FC00000000F800000000F800000001F800000001
F000000003F000000003E000000003E000000007E000000007C00000000FC00000000F80
0000001F800000001F000000001F000000003F000000003E000000007E000000007C0000
00007C00000000FC00000000F800000000F800000000700000000025537BBD30>47
D<00001E000000003E00000000FE00000007FE0000003FFE0000FFFFFE0000FFFFFE0000
FFFFFE0000FFCFFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE000000
0FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000F
FE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE
0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE00
00000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000
000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE000000
0FFE00007FFFFFFF807FFFFFFF807FFFFFFF807FFFFFFF80213779B630>49
D<000FFC0000007FFFC00001FFFFF00007FFFFFC000FF03FFF001F800FFF803F0003FFC0
7F0003FFC07FC001FFE0FFE000FFF0FFF000FFF0FFF000FFF0FFF0007FF8FFF0007FF8FF
F0007FF8FFF0007FF87FE0007FF83FC0007FF80F00007FF80000007FF8000000FFF00000
00FFF0000000FFE0000001FFE0000001FFC0000003FF80000003FF00000007FE00000007
FC0000000FF80000001FF00000003FE00000007F800000007F00000000FE00000001F800
000003F000780007E00078000FC00078001F800078003E0000F8007C0000F000F80000F0
01F00001F003FFFFFFF003FFFFFFF007FFFFFFF00FFFFFFFF01FFFFFFFF03FFFFFFFF07F
FFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE0FFFFFFFFE025377BB630>I<0003FF0000
001FFFF000007FFFFC0001FC07FF0003F003FF8007E001FFC007C000FFE00FF000FFE00F
FC00FFF01FFC00FFF01FFE00FFF01FFE00FFF01FFE00FFF01FFE00FFF01FFE00FFF00FFC
00FFE00FFC00FFE003F001FFE0000001FFC0000003FF80000003FF00000007FE0000000F
FC0000003FF000000FFFC000000FFF0000000FFFF000000007FE00000001FF80000000FF
C0000000FFE00000007FF00000007FF80000007FFC0000003FFC0000003FFC0000003FFE
1FC0003FFE3FE0003FFE7FF0003FFEFFF8003FFEFFF8003FFEFFF8003FFEFFF8003FFEFF
F8003FFCFFF8003FFCFFF0007FF87FF0007FF87FC000FFF03F8000FFE01FC001FFC00FFC
07FF8007FFFFFF0001FFFFFC00007FFFF0000007FF000027387CB630>I<00000007C000
0000000FC0000000000FC0000000001FC0000000003FC0000000007FC000000000FFC000
000000FFC000000001FFC000000003FFC000000007FFC00000000FFFC00000000FFFC000
00001EFFC00000003CFFC00000007CFFC0000000F8FFC0000000F0FFC0000001E0FFC000
0003C0FFC0000007C0FFC000000F80FFC000000F00FFC000001E00FFC000003C00FFC000
007C00FFC00000F800FFC00000F000FFC00001E000FFC00003C000FFC00007C000FFC000
0F8000FFC0000F0000FFC0001E0000FFC0003C0000FFC0007C0000FFC000F80000FFC000
FFFFFFFFFF80FFFFFFFFFF80FFFFFFFFFF80FFFFFFFFFF80000001FFC000000001FFC000
000001FFC000000001FFC000000001FFC000000001FFC000000001FFC000000001FFC000
000001FFC000000001FFC0000003FFFFFF800003FFFFFF800003FFFFFF800003FFFFFF80
29377DB630>I<1C000000C01F800007C01FF8007FC01FFFFFFF801FFFFFFF801FFFFFFF
001FFFFFFE001FFFFFFC001FFFFFF0001FFFFFE0001FFFFF80001FFFFE00001FFFF00000
1F000000001F000000001F000000001F000000001F000000001F000000001F000000001F
000000001F07FE00001F3FFFE0001FFFFFF8001FFC07FC001FE003FF001F8001FF801F00
00FFC00E0000FFC0000000FFE00000007FE00000007FF00000007FF00000007FF8000000
7FF80600007FF83F80007FF87FE0007FF8FFE0007FF8FFF0007FF8FFF0007FF8FFF0007F
F8FFF0007FF8FFE0007FF0FFE0007FF07FC000FFF07F0000FFE07C0000FFC03E0001FFC0
1F0003FF801FC007FF000FF01FFE0007FFFFF80001FFFFE000007FFF8000000FF8000025
387BB630>I<00000FF8000000FFFE000003FFFF80000FF80FC0003FE003E0007FC001F0
00FF000FF001FF001FF803FE003FF807FC003FF80FFC003FF80FF8003FF81FF8003FF81F
F8003FF83FF8001FF03FF8000FE03FF00000007FF00000007FF00000007FF00800007FF0
7FF000FFF1FFFC00FFF3FFFF00FFF780FF80FFFF007FC0FFFE003FE0FFFC003FF0FFFC00
1FF8FFF8001FF8FFF8001FFCFFF8001FFCFFF8001FFCFFF0001FFEFFF0001FFEFFF0001F
FEFFF0001FFEFFF0001FFE7FF0001FFE7FF0001FFE7FF0001FFE7FF0001FFE7FF0001FFE
3FF0001FFE3FF0001FFC3FF0001FFC1FF8001FFC1FF8001FF80FF8003FF807FC003FF007
FC007FE003FE007FC001FF81FF8000FFFFFF00003FFFFC00000FFFF0000001FF80002738
7CB630>I<3C00000000003E00000000003FE0000000003FFFFFFFFF803FFFFFFFFF803F
FFFFFFFF803FFFFFFFFF803FFFFFFFFF007FFFFFFFFE007FFFFFFFFC007FFFFFFFF8007F
FFFFFFF0007FFFFFFFF0007FFFFFFFE0007C00000FC0007800001F80007800003F0000F8
00007E0000F000007C0000F00000FC0000F00001F80000F00003F00000000007E0000000
0007C0000000000FC0000000001F80000000003F80000000003F00000000007F00000000
007E0000000000FE0000000001FE0000000001FE0000000003FC0000000003FC00000000
03FC0000000007FC0000000007FC000000000FFC000000000FF8000000000FF800000000
1FF8000000001FF8000000001FF8000000001FF8000000001FF8000000003FF800000000
3FF8000000003FF8000000003FF8000000003FF8000000003FF8000000003FF800000000
3FF8000000003FF8000000001FF0000000000FE00000000007C0000000293A7BB830>I<
0001FF8000000FFFF000003FFFFC0000FE01FF0001F8007F8003F0003FC007E0001FE007
E0000FE00FC0000FE00FC00007F01FC00007F01FC00007F01FE00007F01FE00007F01FF0
0007F01FF80007F01FFE000FE01FFF800FE01FFFE01FC00FFFF03FC00FFFFC3F800FFFFF
7F0007FFFFFC0003FFFFF80001FFFFF80000FFFFFE00007FFFFF00003FFFFFC0007FFFFF
E001FFFFFFF007F8FFFFF00FF07FFFF81FE01FFFFC3FC007FFFC3F8001FFFC7F8000FFFE
7F00003FFEFF00000FFEFE000007FEFE000003FEFE000001FEFE000001FEFE000000FEFE
000000FEFE000000FCFF000000FC7F000001FC7F800001F83FC00003F03FE00007F01FF0
000FE00FFE007FC003FFFFFF0000FFFFFC00003FFFF0000003FF800027387CB630>I<0F
803FE07FF07FF0FFF8FFF8FFF8FFF8FFF87FF07FF03FE00F800000000000000000000000
00000000000000000000000F803FE07FF07FF0FFF8FFF8FFF8FFF8FFF87FF07FF03FE00F
800D2579A41B>58 D<001FFE000001FFFFE00007FFFFF8000FE00FFE003F0003FF007F00
03FF807F8001FF80FFC001FFC0FFE001FFC0FFE001FFC0FFE001FFC0FFE001FFC0FFE001
FFC07FC001FFC03F8003FF801F0003FF80000007FF0000000FFC0000001FF80000003FE0
0000007FC00000007F00000000FE00000000FC00000001F800000001F800000001F00000
0003E000000003E000000003C000000003C000000003C000000003C000000003C0000000
03C000000003C000000003C000000003C000000000000000000000000000000000000000
0000000000000000000000000000000000000007C00000001FF00000003FF80000003FF8
0000007FFC0000007FFC0000007FFC0000007FFC0000007FFC0000003FF80000003FF800
00001FF000000007C00000223A7BB92D>63 D<00000003E00000000000000007F0000000
0000000007F0000000000000000FF8000000000000000FF8000000000000000FF8000000
000000001FFC000000000000001FFC000000000000003FFE000000000000003FFE000000
000000003FFE000000000000007FFF000000000000007FFF00000000000000FFFF800000
00000000FFFF80000000000000FFFF80000000000001FFFFC0000000000001F3FFC00000
00000003F3FFE0000000000003E1FFE0000000000003E1FFE0000000000007E1FFF00000
00000007C0FFF000000000000FC0FFF800000000000F807FF800000000000F807FF80000
0000001F807FFC00000000001F003FFC00000000003F003FFE00000000003E001FFE0000
0000003E001FFE00000000007E001FFF00000000007C000FFF0000000000FC000FFF8000
000000F80007FF8000000000F80007FF8000000001F80007FFC000000001F00003FFC000
000003FFFFFFFFE000000003FFFFFFFFE000000003FFFFFFFFE000000007FFFFFFFFF000
000007C00000FFF00000000FC00000FFF80000000F8000007FF80000000F8000007FF800
00001F8000007FFC0000001F0000003FFC0000003F0000003FFE0000003E0000001FFE00
00003E0000001FFE0000007E0000001FFF0000007C0000000FFF000000FE0000000FFF80
00FFFFF80007FFFFFF80FFFFF80007FFFFFF80FFFFF80007FFFFFF80FFFFF80007FFFFFF
80413A7DB948>65 D<FFFFFFFFFFC00000FFFFFFFFFFFC0000FFFFFFFFFFFF0000FFFFFF
FFFFFFC000007FF00003FFE000007FF00000FFF000007FF000007FF800007FF000003FFC
00007FF000001FFC00007FF000001FFE00007FF000001FFE00007FF000000FFF00007FF0
00000FFF00007FF000000FFF00007FF000000FFF00007FF000000FFF00007FF000000FFF
00007FF000000FFF00007FF000001FFE00007FF000001FFE00007FF000001FFC00007FF0
00003FFC00007FF000007FF800007FF00000FFF000007FF00001FFC000007FF0000FFF80
00007FFFFFFFFC0000007FFFFFFFFC0000007FFFFFFFFF8000007FF00000FFF000007FF0
00003FF800007FF000001FFC00007FF000000FFE00007FF0000007FF00007FF0000007FF
80007FF0000003FFC0007FF0000003FFC0007FF0000003FFC0007FF0000003FFE0007FF0
000003FFE0007FF0000003FFE0007FF0000003FFE0007FF0000003FFE0007FF0000003FF
E0007FF0000003FFE0007FF0000003FFC0007FF0000003FFC0007FF0000007FFC0007FF0
00000FFF80007FF000000FFF00007FF000001FFF00007FF000007FFE00007FF00001FFFC
00FFFFFFFFFFFFF000FFFFFFFFFFFFC000FFFFFFFFFFFF0000FFFFFFFFFFF000003B397D
B844>I<0000003FFC0001C0000003FFFFC003C000001FFFFFF007C00000FFFFFFFC0FC0
0003FFFC00FF3FC00007FFC0001FFFC0001FFE00000FFFC0003FFC000003FFC0007FF000
0001FFC000FFE0000000FFC001FFC0000000FFC003FFC00000007FC007FF800000003FC0
0FFF000000003FC00FFF000000001FC01FFE000000001FC01FFE000000000FC03FFE0000
00000FC03FFC000000000FC03FFC0000000007C07FFC0000000007C07FFC0000000007C0
7FF8000000000000FFF8000000000000FFF8000000000000FFF8000000000000FFF80000
00000000FFF8000000000000FFF8000000000000FFF8000000000000FFF8000000000000
FFF8000000000000FFF8000000000000FFF8000000000000FFF8000000000000FFF80000
000000007FF80000000000007FFC0000000000007FFC0000000003C03FFC0000000003C0
3FFC0000000003C03FFE0000000003C01FFE0000000007C01FFE0000000007C00FFF0000
000007800FFF000000000F8007FF800000000F0003FFC00000001F0001FFC00000003E00
00FFE00000007E00007FF8000000FC00003FFC000001F800001FFF000003F0000007FFC0
000FE0000003FFFC00FF80000000FFFFFFFE000000001FFFFFF80000000003FFFFE00000
0000003FFE0000003A3B7BB945>I<FFFFFFFFFF800000FFFFFFFFFFF80000FFFFFFFFFF
FF0000FFFFFFFFFFFFC000007FF80007FFF000007FF800007FF800007FF800001FFE0000
7FF800000FFF00007FF8000003FF80007FF8000001FFC0007FF8000001FFC0007FF80000
00FFE0007FF80000007FF0007FF80000007FF0007FF80000003FF8007FF80000003FF800
7FF80000003FFC007FF80000001FFC007FF80000001FFC007FF80000001FFE007FF80000
001FFE007FF80000001FFE007FF80000001FFE007FF80000001FFF007FF80000001FFF00
7FF80000001FFF007FF80000001FFF007FF80000001FFF007FF80000001FFF007FF80000
001FFF007FF80000001FFF007FF80000001FFF007FF80000001FFF007FF80000001FFF00
7FF80000001FFF007FF80000001FFE007FF80000001FFE007FF80000001FFE007FF80000
001FFE007FF80000001FFC007FF80000003FFC007FF80000003FFC007FF80000003FF800
7FF80000007FF8007FF80000007FF0007FF8000000FFE0007FF8000000FFE0007FF80000
01FFC0007FF8000003FF80007FF8000007FF00007FF800001FFE00007FF800007FFC0000
7FF80007FFF000FFFFFFFFFFFFC000FFFFFFFFFFFF0000FFFFFFFFFFFC0000FFFFFFFFFF
80000040397DB849>I<FFFFFFFFFFFFF0FFFFFFFFFFFFF0FFFFFFFFFFFFF0FFFFFFFFFF
FFF0007FF80000FFF0007FF800001FF8007FF8000007F8007FF8000003F8007FF8000001
F8007FF8000001F8007FF8000000F8007FF8000000F8007FF800000078007FF800000078
007FF800000078007FF8003C007C007FF8003C003C007FF8003C003C007FF8003C003C00
7FF8003C003C007FF8003C0000007FF8007C0000007FF8007C0000007FF800FC0000007F
F803FC0000007FFFFFFC0000007FFFFFFC0000007FFFFFFC0000007FFFFFFC0000007FF8
03FC0000007FF800FC0000007FF8007C0000007FF8007C0000007FF8003C0000007FF800
3C000F007FF8003C000F007FF8003C000F007FF8003C001E007FF8003C001E007FF80000
001E007FF80000001E007FF80000003E007FF80000003E007FF80000003C007FF8000000
7C007FF80000007C007FF8000000FC007FF8000000FC007FF8000001F8007FF8000003F8
007FF800000FF8007FF800003FF8007FF80001FFF8FFFFFFFFFFFFF8FFFFFFFFFFFFF0FF
FFFFFFFFFFF0FFFFFFFFFFFFF038397DB83F>I<FFFFFFFFFFFFC0FFFFFFFFFFFFC0FFFF
FFFFFFFFC0FFFFFFFFFFFFC0007FF80003FFC0007FF800007FE0007FF800001FE0007FF8
00000FE0007FF8000007E0007FF8000007E0007FF8000003E0007FF8000003E0007FF800
0001E0007FF8000001E0007FF8000001E0007FF8000001F0007FF8007800F0007FF80078
00F0007FF8007800F0007FF8007800F0007FF800780000007FF800780000007FF800F800
00007FF800F80000007FF801F80000007FF807F80000007FFFFFF80000007FFFFFF80000
007FFFFFF80000007FFFFFF80000007FF807F80000007FF801F80000007FF800F8000000
7FF800F80000007FF800780000007FF800780000007FF800780000007FF800780000007F
F800780000007FF800780000007FF800000000007FF800000000007FF800000000007FF8
00000000007FF800000000007FF800000000007FF800000000007FF800000000007FF800
000000007FF800000000007FF800000000007FF800000000007FF800000000FFFFFFFF00
0000FFFFFFFF000000FFFFFFFF000000FFFFFFFF00000034397DB83C>I<0000003FFC00
01C000000003FFFFC003C00000001FFFFFF007C0000000FFFFFFFC0FC0000003FFFC00FF
3FC0000007FFC0001FFFC000001FFE00000FFFC000003FFC000003FFC000007FF0000001
FFC00000FFE0000000FFC00001FFC0000000FFC00003FFC00000007FC00007FF80000000
3FC0000FFF000000003FC0000FFF000000001FC0001FFE000000001FC0001FFE00000000
0FC0003FFE000000000FC0003FFC000000000FC0003FFC0000000007C0007FFC00000000
07C0007FFC0000000007C0007FF800000000000000FFF800000000000000FFF800000000
000000FFF800000000000000FFF800000000000000FFF800000000000000FFF800000000
000000FFF800000000000000FFF800000000000000FFF800000000000000FFF800000000
000000FFF800000000000000FFF800003FFFFFFF80FFF800003FFFFFFF807FF800003FFF
FFFF807FFC00003FFFFFFF807FFC00000003FFC0003FFC00000003FFC0003FFC00000003
FFC0003FFE00000003FFC0001FFE00000003FFC0001FFE00000003FFC0000FFF00000003
FFC0000FFF00000003FFC00007FF80000003FFC00003FFC0000003FFC00001FFE0000003
FFC00000FFE0000003FFC000007FF8000007FFC000003FFC000007FFC000001FFF00000F
FFC0000007FFC0001FFFC0000003FFFC00FF3FC0000000FFFFFFFE0FC00000001FFFFFF8
03C000000003FFFFE000C0000000003FFE00000000413B7BB94B>I<FFFFFFFC03FFFFFF
F0FFFFFFFC03FFFFFFF0FFFFFFFC03FFFFFFF0FFFFFFFC03FFFFFFF0007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FFFFFFFFFFFE000007FFFFFFFFFFFE000007FFFFFFFFFFFE000007FFFFFFFFFFFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00007FF8000001FFE000007FF8000001FFE000007FF8000001FFE000007FF8000001FFE0
00FFFFFFFC03FFFFFFF0FFFFFFFC03FFFFFFF0FFFFFFFC03FFFFFFF0FFFFFFFC03FFFFFF
F044397DB84B>I<FFFFFFFCFFFFFFFCFFFFFFFCFFFFFFFC007FF800007FF800007FF800
007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800
007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800
007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800
007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800
007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800007FF800
007FF800FFFFFFFCFFFFFFFCFFFFFFFCFFFFFFFC1E397DB824>I<FFFFFFFC0003FFFFC0
FFFFFFFC0003FFFFC0FFFFFFFC0003FFFFC0FFFFFFFC0003FFFFC0007FF80000001FE000
007FF80000001F8000007FF80000003F0000007FF8000000FE0000007FF8000001F80000
007FF8000003F00000007FF8000007E00000007FF800000FC00000007FF800003F800000
007FF800007E000000007FF80000FC000000007FF80001F8000000007FF80003F0000000
007FF8000FE0000000007FF8001F80000000007FF8003F00000000007FF8007E00000000
007FF800FC00000000007FF803F800000000007FF807FC00000000007FF80FFE00000000
007FF81FFF00000000007FF83FFF80000000007FF87FFF80000000007FF9FFFFC0000000
007FFBF7FFE0000000007FFFE3FFF0000000007FFFC1FFF0000000007FFF80FFF8000000
007FFE00FFFC000000007FFC007FFE000000007FF8003FFE000000007FF8001FFF000000
007FF8000FFF800000007FF8000FFFC00000007FF80007FFC00000007FF80003FFE00000
007FF80001FFF00000007FF80001FFF80000007FF80000FFF80000007FF800007FFC0000
007FF800003FFE0000007FF800003FFF0000007FF800001FFF0000007FF800000FFF8000
007FF8000007FFC000007FF8000007FFE000007FF8000003FFE000007FF8000003FFF000
FFFFFFFC007FFFFFE0FFFFFFFC007FFFFFE0FFFFFFFC007FFFFFE0FFFFFFFC007FFFFFE0
43397DB84B>75 D<FFFFFFFF000000FFFFFFFF000000FFFFFFFF000000FFFFFFFF000000
007FF800000000007FF800000000007FF800000000007FF800000000007FF80000000000
7FF800000000007FF800000000007FF800000000007FF800000000007FF800000000007F
F800000000007FF800000000007FF800000000007FF800000000007FF800000000007FF8
00000000007FF800000000007FF800000000007FF800000000007FF800000000007FF800
000000007FF800000000007FF800000000007FF800000000007FF800000000007FF80000
0000007FF800000000007FF800000000007FF800000000007FF800000000007FF8000007
80007FF800000780007FF800000780007FF800000780007FF800000780007FF800000F80
007FF800000F00007FF800000F00007FF800000F00007FF800001F00007FF800001F0000
7FF800003F00007FF800003F00007FF800007F00007FF80000FF00007FF80001FF00007F
F80003FF00007FF8000FFE00007FF8007FFE00FFFFFFFFFFFE00FFFFFFFFFFFE00FFFFFF
FFFFFE00FFFFFFFFFFFE0031397DB839>I<FFFFF80000000003FFFFF0FFFFFC00000000
07FFFFF0FFFFFC0000000007FFFFF0FFFFFE000000000FFFFFF0007FFE000000000FFFE0
00007FFE000000000FFFE000007BFF000000001EFFE000007BFF000000001EFFE0000079
FF800000003CFFE0000079FF800000003CFFE0000078FFC000000078FFE0000078FFC000
000078FFE00000787FE0000000F0FFE00000787FE0000000F0FFE00000787FE0000000F0
FFE00000783FF0000001E0FFE00000783FF0000001E0FFE00000781FF8000003C0FFE000
00781FF8000003C0FFE00000780FFC00000780FFE00000780FFC00000780FFE000007807
FE00000F00FFE000007807FE00000F00FFE000007803FF00001E00FFE000007803FF0000
1E00FFE000007803FF00001E00FFE000007801FF80003C00FFE000007801FF80003C00FF
E000007800FFC0007800FFE000007800FFC0007800FFE0000078007FE000F000FFE00000
78007FE000F000FFE0000078003FF001E000FFE0000078003FF001E000FFE0000078003F
F001E000FFE0000078001FF803C000FFE0000078001FF803C000FFE0000078000FFC0780
00FFE0000078000FFC078000FFE00000780007FE0F0000FFE00000780007FE0F0000FFE0
0000780003FF1E0000FFE00000780003FF1E0000FFE00000780003FF1E0000FFE0000078
0001FFBC0000FFE00000780001FFBC0000FFE00000780000FFF80000FFE00000780000FF
F80000FFE000007800007FF00000FFE000007800007FF00000FFE000007800003FE00000
FFE000007800003FE00000FFE00000FC00003FE00000FFE000FFFFFC001FC001FFFFFFF0
FFFFFC001FC001FFFFFFF0FFFFFC000F8001FFFFFFF0FFFFFC00070001FFFFFFF054397D
B85B>I<FFFFFC000003FFFFF0FFFFFC000003FFFFF0FFFFFE000003FFFFF0FFFFFF0000
03FFFFF0007FFF80000003F000007FFFC0000001E000007FFFE0000001E000007BFFF000
0001E0000079FFF0000001E0000079FFF8000001E0000078FFFC000001E00000787FFE00
0001E00000783FFF000001E00000781FFF800001E00000780FFFC00001E00000780FFFC0
0001E000007807FFE00001E000007803FFF00001E000007801FFF80001E000007800FFFC
0001E0000078007FFE0001E0000078003FFE0001E0000078003FFF0001E0000078001FFF
8001E0000078000FFFC001E00000780007FFE001E00000780003FFF001E00000780001FF
F801E00000780000FFF801E00000780000FFFC01E000007800007FFE01E000007800003F
FF01E000007800001FFF81E000007800000FFFC1E0000078000007FFE1E0000078000003
FFE1E0000078000003FFF1E0000078000001FFF9E0000078000000FFFDE0000078000000
7FFFE00000780000003FFFE00000780000001FFFE00000780000001FFFE0000078000000
0FFFE000007800000007FFE000007800000003FFE000007800000001FFE0000078000000
00FFE0000078000000007FE0000078000000007FE0000078000000003FE0000078000000
001FE00000FC000000000FE000FFFFFC00000007E000FFFFFC00000003E000FFFFFC0000
0001E000FFFFFC00000001E00044397DB84B>I<000000FFF800000000000FFFFF800000
00007FFFFFF000000001FFC01FFC00000007FF0007FF0000001FFC0001FFC000003FF000
007FE000007FE000003FF00000FFC000001FF80001FF8000000FFC0003FF8000000FFE00
07FF00000007FF0007FF00000007FF000FFE00000003FF800FFE00000003FF801FFC0000
0001FFC01FFC00000001FFC03FFC00000001FFE03FFC00000001FFE03FFC00000001FFE0
7FF800000000FFF07FF800000000FFF07FF800000000FFF07FF800000000FFF0FFF80000
0000FFF8FFF800000000FFF8FFF800000000FFF8FFF800000000FFF8FFF800000000FFF8
FFF800000000FFF8FFF800000000FFF8FFF800000000FFF8FFF800000000FFF8FFF80000
0000FFF8FFF800000000FFF8FFF800000000FFF87FF800000000FFF07FFC00000001FFF0
7FFC00000001FFF07FFC00000001FFF03FFC00000001FFE03FFC00000001FFE03FFE0000
0003FFE01FFE00000003FFC01FFE00000003FFC00FFF00000007FF8007FF00000007FF00
07FF8000000FFF0003FFC000001FFE0001FFC000001FFC0000FFE000003FF800007FF000
007FF000003FFC0001FFE000001FFF0007FFC0000007FFC01FFF00000001FFFFFFFC0000
00007FFFFFF0000000000FFFFF800000000000FFF80000003D3B7BB948>I<FFFFFFFFFF
0000FFFFFFFFFFF000FFFFFFFFFFFE00FFFFFFFFFFFF80007FF8000FFFC0007FF80001FF
E0007FF80000FFF0007FF800007FF8007FF800003FFC007FF800003FFC007FF800001FFE
007FF800001FFE007FF800001FFF007FF800001FFF007FF800001FFF007FF800001FFF00
7FF800001FFF007FF800001FFF007FF800001FFF007FF800001FFF007FF800001FFE007F
F800001FFE007FF800003FFC007FF800003FFC007FF800007FF8007FF80000FFF0007FF8
0001FFE0007FF8000FFFC0007FFFFFFFFF00007FFFFFFFFC00007FFFFFFFE000007FF800
000000007FF800000000007FF800000000007FF800000000007FF800000000007FF80000
0000007FF800000000007FF800000000007FF800000000007FF800000000007FF8000000
00007FF800000000007FF800000000007FF800000000007FF800000000007FF800000000
007FF800000000007FF800000000007FF800000000007FF800000000007FF80000000000
7FF800000000FFFFFFFC000000FFFFFFFC000000FFFFFFFC000000FFFFFFFC0000003839
7DB841>I<FFFFFFFFFC00000000FFFFFFFFFFE0000000FFFFFFFFFFFC000000FFFFFFFF
FFFF000000007FF8000FFFC00000007FF80001FFE00000007FF80000FFF00000007FF800
007FF80000007FF800003FFC0000007FF800003FFC0000007FF800001FFE0000007FF800
001FFE0000007FF800001FFF0000007FF800001FFF0000007FF800001FFF0000007FF800
001FFF0000007FF800001FFF0000007FF800001FFF0000007FF800001FFF0000007FF800
001FFE0000007FF800001FFE0000007FF800003FFC0000007FF800003FF80000007FF800
007FF00000007FF80000FFE00000007FF80003FFC00000007FF8001FFF000000007FFFFF
FFFC000000007FFFFFFFE0000000007FFFFFFFF0000000007FF8003FFC000000007FF800
0FFF000000007FF80007FF800000007FF80003FFC00000007FF80001FFC00000007FF800
01FFE00000007FF80001FFE00000007FF80000FFF00000007FF80000FFF00000007FF800
00FFF00000007FF80000FFF00000007FF80000FFF00000007FF80000FFF80000007FF800
00FFF80000007FF80000FFF80000007FF80000FFF80000007FF80000FFF80000007FF800
00FFF80060007FF80000FFF800F0007FF80000FFFC00F0007FF800007FFC00F0007FF800
007FFC01F0007FF800003FFE01E0FFFFFFFC001FFE03E0FFFFFFFC000FFF87C0FFFFFFFC
0007FFFF80FFFFFFFC0001FFFF000000000000001FFC00443A7DB848>82
D<0007FF000E00003FFFE01E0000FFFFF83E0003FFFFFE7E0007FC01FFFE000FF0001FFE
001FE0000FFE003FC00003FE003F800001FE007F800000FE007F000000FE007F0000007E
00FF0000007E00FF0000003E00FF0000003E00FF8000003E00FF8000001E00FFC000001E
00FFE000001E00FFF000000000FFFC000000007FFFE00000007FFFFE0000007FFFFFF000
003FFFFFFE00003FFFFFFF80001FFFFFFFC0000FFFFFFFF00007FFFFFFF80003FFFFFFFC
0000FFFFFFFE00003FFFFFFE00000FFFFFFF000001FFFFFF0000000FFFFF800000007FFF
800000000FFFC000000003FFC000000001FFC000000000FFC0F00000007FC0F00000007F
C0F00000007FC0F00000003FC0F00000003FC0F80000003FC0F80000003F80FC0000003F
80FC0000007F80FE0000007F00FF0000007F00FF800000FE00FFE00001FC00FFF80003FC
00FFFF801FF800FCFFFFFFE000F83FFFFFC000F007FFFE0000E0007FF000002A3B7BB935
>I<3FFFFFFFFFFFFF803FFFFFFFFFFFFF803FFFFFFFFFFFFF803FFFFFFFFFFFFF803FF8
00FFF003FF807FC000FFF0007FC07F8000FFF0001FC07E0000FFF0000FC07E0000FFF000
0FC07C0000FFF00007C07C0000FFF00007C0780000FFF00003C0780000FFF00003C07800
00FFF00003C0780000FFF00003C0F80000FFF00003E0F00000FFF00001E0F00000FFF000
01E0F00000FFF00001E0F00000FFF00001E0000000FFF0000000000000FFF00000000000
00FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF000
0000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF00000000000
00FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF000
0000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF00000000000
00FFF0000000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF000
0000000000FFF0000000000000FFF0000000000000FFF0000000000000FFF00000000000
00FFF0000000000000FFF0000000000000FFF0000000000FFFFFFFFF0000000FFFFFFFFF
0000000FFFFFFFFF0000000FFFFFFFFF00003B387DB742>I<FFFFFFFC001FFFFFC0FFFF
FFFC001FFFFFC0FFFFFFFC001FFFFFC0FFFFFFFC001FFFFFC0007FF80000001FC000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000000F8000007FF80000000F8000007FF80000000F8000007F
F80000000F8000007FF80000001F8000003FF80000001F0000003FFC0000001F0000003F
FC0000003F0000001FFC0000003E0000000FFE0000007E0000000FFE0000007C00000007
FF000000FC00000003FF800001F800000001FFC00007F000000000FFF0001FE000000000
7FFE00FFC0000000001FFFFFFF000000000007FFFFFE000000000000FFFFF00000000000
000FFF80000000423A7DB849>I<FFFFFFF00003FFFFE0FFFFFFF00003FFFFE0FFFFFFF0
0003FFFFE0FFFFFFF00003FFFFE000FFF000000007F00000FFF800000007E000007FF800
000007C000007FFC0000000FC000007FFC0000000FC000003FFC0000000F8000003FFE00
00001F8000001FFE0000001F0000001FFF0000003F0000000FFF0000003E0000000FFF80
00007E00000007FF8000007C00000007FF8000007C00000007FFC00000FC00000003FFC0
0000F800000003FFE00001F800000001FFE00001F000000001FFF00003F000000000FFF0
0003E000000000FFF80003E000000000FFF80007E0000000007FF80007C0000000007FFC
000FC0000000003FFC000F80000000003FFE001F80000000001FFE001F00000000001FFF
001F00000000001FFF003F00000000000FFF003E00000000000FFF807E000000000007FF
807C000000000007FFC0FC000000000003FFC0F8000000000003FFE0F8000000000003FF
E1F8000000000001FFE1F0000000000001FFF3F0000000000000FFF3E0000000000000FF
FFE00000000000007FFFC00000000000007FFFC00000000000007FFFC00000000000003F
FF800000000000003FFF800000000000001FFF000000000000001FFF000000000000000F
FE000000000000000FFE000000000000000FFE0000000000000007FC0000000000000007
FC0000000000000003F80000000000000003F80000000000000001F000000000433A7EB8
48>I<003FFE00000003FFFFE000000FFFFFF800001FF00FFE00003FF003FF00003FF801
FF80003FF800FFC0003FF800FFC0003FF8007FE0003FF8007FE0001FF0007FE0000FE000
7FE0000380007FE0000000007FE0000000007FE00000003FFFE000000FFFFFE000007FFF
FFE00001FFF87FE00007FF807FE0000FFE007FE0003FF8007FE0003FF0007FE0007FE000
7FE000FFE0007FE000FFC0007FE000FFC0007FE000FFC0007FE000FFC0007FE000FFC000
FFE000FFE001FFE0007FE001FFE0003FF007FFF8001FFC1FBFFFC00FFFFE1FFFC003FFF8
0FFFC0003FE003FFC02A257DA42E>97 D<00FF00000000FFFF00000000FFFF00000000FF
FF00000000FFFF0000000007FF0000000003FF0000000003FF0000000003FF0000000003
FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003
FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003
FF01FF800003FF0FFFF00003FF3FFFFC0003FFFE03FF0003FFF000FF8003FFE0007FC003
FF80003FE003FF00003FF003FF00001FF803FF00001FF803FF00001FFC03FF00000FFC03
FF00000FFC03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03
FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFC03
FF00000FFC03FF00000FFC03FF00001FF803FF00001FF803FF00001FF003FF80003FF003
FFC0007FE003FFE0007FC003FDF001FF8003F8FC07FE0003F03FFFF80003E00FFFE00003
C003FF00002F3A7EB935>I<0001FFC000000FFFFC00007FFFFF0000FF80FF8003FE00FF
C007FC01FFC00FF801FFC01FF801FFC01FF001FFC03FF001FFC03FF000FF807FE0007F00
7FE0001C007FE0000000FFE0000000FFE0000000FFE0000000FFE0000000FFE0000000FF
E0000000FFE0000000FFE0000000FFE00000007FE00000007FE00000007FF00000003FF0
0000003FF00001E01FF80001E01FF80003E00FFC0007C007FE00078003FF001F8000FFC0
7E00007FFFFC00000FFFF0000001FF800023257DA42A>I<000000007F800000007FFF80
0000007FFF800000007FFF800000007FFF8000000003FF8000000001FF8000000001FF80
00000001FF8000000001FF8000000001FF8000000001FF8000000001FF8000000001FF80
00000001FF8000000001FF8000000001FF8000000001FF8000000001FF8000000001FF80
00000001FF800001FF81FF80000FFFF1FF80003FFFFDFF8000FFC07FFF8003FF001FFF80
07FC0007FF800FFC0003FF801FF80001FF801FF00001FF803FF00001FF803FF00001FF80
7FE00001FF807FE00001FF807FE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80
FFE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80
FFE00001FF807FE00001FF807FE00001FF807FF00001FF803FF00001FF803FF00001FF80
1FF80003FF800FF80007FF8007FC000FFF8003FE001FFFC001FF80FDFFFE007FFFF9FFFE
001FFFE1FFFE0003FF01FFFE2F3A7DB935>I<0003FF8000001FFFF000007FFFFC0001FF
83FE0003FE007F8007FC003F800FF8003FC01FF8001FE01FF0001FE03FF0000FF03FF000
0FF07FE0000FF07FE0000FF87FE00007F8FFE00007F8FFE00007F8FFFFFFFFF8FFFFFFFF
F8FFFFFFFFF8FFE0000000FFE0000000FFE0000000FFE00000007FE00000007FE0000000
7FE00000003FF00000003FF00000781FF00000780FF80000F80FFC0000F007FC0003F001
FF000FE000FFC07FC0007FFFFF00000FFFFC000001FFE00025257DA42C>I<00001FF000
0001FFFC000007FFFF00001FF87F80003FE0FF8000FFC1FFC000FFC1FFC001FF81FFC001
FF81FFC003FF01FFC003FF00FF8003FF00FF8003FF003E0003FF00000003FF00000003FF
00000003FF00000003FF00000003FF00000003FF00000003FF000000FFFFFF0000FFFFFF
0000FFFFFF0000FFFFFF000003FF00000003FF00000003FF00000003FF00000003FF0000
0003FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF000000
03FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003
FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF
00000003FF00000003FF000000FFFFFE0000FFFFFE0000FFFFFE0000FFFFFE0000223A7D
B91D>I<000000001F000007FE00FFC0007FFFE3FFC001FFFFFFEFE007FE07FF8FE00FF8
01FF1FE01FF000FF8FE03FF000FFCFE03FE0007FC7C03FE0007FC0007FE0007FE0007FE0
007FE0007FE0007FE0007FE0007FE0007FE0007FE0007FE0007FE0003FE0007FC0003FE0
007FC0003FF000FFC0001FF000FF80000FF801FF000007FE07FE00000FFFFFF800000F7F
FFE000001E07FE0000001E00000000001E00000000003E00000000003F00000000003F80
000000001FC0000000001FFFFFF800001FFFFFFF80001FFFFFFFE0000FFFFFFFF80007FF
FFFFFC0003FFFFFFFE0007FFFFFFFE001FFFFFFFFF003FC0000FFF007F000000FF80FF00
00007F80FE0000007F80FE0000003F80FE0000003F80FE0000003F80FF0000007F807F00
00007F007F800000FF003FC00001FE001FF00007FC0007FE003FF00001FFFFFFC000007F
FFFF00000007FFF000002B377DA530>I<00FF00000000FFFF00000000FFFF00000000FF
FF00000000FFFF0000000007FF0000000003FF0000000003FF0000000003FF0000000003
FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003
FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003
FF007FC00003FF03FFF80003FF0FFFFE0003FF1F03FF0003FF3C01FF8003FF7801FF8003
FFF000FF8003FFE000FFC003FFC000FFC003FFC000FFC003FF8000FFC003FF8000FFC003
FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003
FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003
FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003
FF0000FFC003FF0000FFC003FF0000FFC0FFFFFC3FFFFFFFFFFC3FFFFFFFFFFC3FFFFFFF
FFFC3FFFFF303A7DB935>I<01F00007FC000FFE000FFE001FFF001FFF001FFF001FFF00
1FFF000FFE000FFE0007FC0001F000000000000000000000000000000000000000000000
00000000000000FF007FFF007FFF007FFF007FFF0007FF0003FF0003FF0003FF0003FF00
03FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF00
03FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF00FFFFF8
FFFFF8FFFFF8FFFFF8153B7DBA1B>I<00FF00000000FFFF00000000FFFF00000000FFFF
00000000FFFF0000000007FF0000000003FF0000000003FF0000000003FF0000000003FF
0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF
0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF
000FFFE003FF000FFFE003FF000FFFE003FF000FFFE003FF0003FC0003FF0003F00003FF
000FE00003FF001F800003FF003F000003FF007E000003FF00FC000003FF03F8000003FF
07E0000003FF0FC0000003FF1FC0000003FF7FE0000003FFFFF0000003FFFFF8000003FF
FFFC000003FFFFFC000003FFCFFE000003FF0FFF000003FE07FF800003FE03FF800003FE
01FFC00003FE00FFE00003FE00FFF00003FE007FF00003FE003FF80003FE001FFC0003FE
001FFE0003FE000FFE0003FE000FFF00FFFFF83FFFF8FFFFF83FFFF8FFFFF83FFFF8FFFF
F83FFFF82D3A7EB932>107 D<00FF00FFFF00FFFF00FFFF00FFFF0007FF0003FF0003FF
0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF
0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF
0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF
0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF0003FF00FFFFFCFFFF
FCFFFFFCFFFFFC163A7DB91B>I<00FE007FE0000FFC0000FFFE01FFFC003FFF8000FFFE
07FFFF00FFFFE000FFFE1F81FF83F03FF000FFFE3C00FF87801FF00007FE7800FFCF001F
F80003FEF000FFDE001FF80003FFE0007FFC000FFC0003FFC0007FF8000FFC0003FFC000
7FF8000FFC0003FF80007FF0000FFC0003FF80007FF0000FFC0003FF00007FE0000FFC00
03FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0
000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF
00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000F
FC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF0000
7FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC0003FF00007FE0000FFC00
03FF00007FE0000FFC0003FF00007FE0000FFC00FFFFFC1FFFFF83FFFFF0FFFFFC1FFFFF
83FFFFF0FFFFFC1FFFFF83FFFFF0FFFFFC1FFFFF83FFFFF04C257DA451>I<00FE007FC0
00FFFE03FFF800FFFE0FFFFE00FFFE1F03FF00FFFE3C01FF8007FE7801FF8003FEF000FF
8003FFE000FFC003FFC000FFC003FFC000FFC003FF8000FFC003FF8000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC0FFFFFC3FFFFFFFFFFC3FFFFFFFFFFC3FFFFFFFFFFC3FFF
FF30257DA435>I<0001FFC00000000FFFF80000007FFFFF000000FF80FF800003FE003F
E00007FC001FF0000FF8000FF8001FF00007FC001FF00007FC003FF00007FE003FE00003
FE007FE00003FF007FE00003FF007FE00003FF00FFE00003FF80FFE00003FF80FFE00003
FF80FFE00003FF80FFE00003FF80FFE00003FF80FFE00003FF80FFE00003FF80FFE00003
FF807FE00003FF007FE00003FF007FE00003FF003FE00003FE003FF00007FE001FF00007
FC001FF00007FC000FF8000FF80007FC001FF00003FE003FE00001FF80FFC000007FFFFF
0000001FFFFC00000001FFC0000029257DA430>I<00FF01FF8000FFFF0FFFF000FFFF3F
FFFC00FFFFFE07FF00FFFFF001FF8003FFE000FFC003FF80007FE003FF00007FF003FF00
003FF803FF00003FF803FF00001FFC03FF00001FFC03FF00001FFC03FF00000FFE03FF00
000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00000FFE03FF00
000FFE03FF00000FFE03FF00000FFE03FF00000FFC03FF00001FFC03FF00001FFC03FF00
001FF803FF00003FF803FF00003FF003FF80007FF003FFC0007FE003FFE000FFC003FFF0
03FF8003FFFC07FE0003FF3FFFF80003FF0FFFE00003FF03FF000003FF0000000003FF00
00000003FF0000000003FF0000000003FF0000000003FF0000000003FF0000000003FF00
00000003FF0000000003FF0000000003FF0000000003FF00000000FFFFFC000000FFFFFC
000000FFFFFC000000FFFFFC0000002F357EA435>I<0001FF000780000FFFE00F80003F
FFF81F8000FFC07C3F8003FF803E3F8007FE000F7F800FFC0007FF801FFC0007FF801FF8
0003FF803FF80003FF803FF00001FF807FF00001FF807FF00001FF807FE00001FF80FFE0
0001FF80FFE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80FFE00001FF80FFE0
0001FF80FFE00001FF80FFE00001FF80FFE00001FF807FF00001FF807FF00001FF807FF0
0001FF803FF80001FF803FF80003FF801FFC0003FF800FFC0007FF8007FE000FFF8003FF
003FFF8001FFC0FDFF80007FFFF1FF80001FFFC1FF800001FF01FF8000000001FF800000
0001FF8000000001FF8000000001FF8000000001FF8000000001FF8000000001FF800000
0001FF8000000001FF8000000001FF8000000001FF8000000001FF800000007FFFFE0000
007FFFFE0000007FFFFE0000007FFFFE2F357DA432>I<00FE03F000FFFE0FFE00FFFE3F
FF00FFFE7C7F80FFFEF8FFC007FEF0FFC003FFE0FFC003FFC0FFC003FFC0FFC003FF807F
8003FF803F0003FF800C0003FF80000003FF00000003FF00000003FF00000003FF000000
03FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003
FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF00000003FF
00000003FF000000FFFFFE0000FFFFFE0000FFFFFE0000FFFFFE000022257EA427>I<00
3FF03803FFFEF80FFFFFF81FC00FF83F0003F87E0001F87C0000F8FC0000F8FC000078FE
000078FF000078FF800000FFFC0000FFFFE0007FFFFC007FFFFF803FFFFFC01FFFFFF00F
FFFFF803FFFFF800FFFFFC001FFFFC00007FFE000007FEF00001FEF00000FEF80000FEF8
00007EFC00007EFC00007CFE0000FCFF0000F8FF8001F8FFF007F0FFFFFFC0F8FFFF00E0
1FF8001F257DA426>I<000F0000000F0000000F0000000F0000000F0000001F0000001F
0000001F0000001F0000003F0000003F0000007F000000FF000000FF000001FF000007FF
00001FFFFFE0FFFFFFE0FFFFFFE0FFFFFFE003FF000003FF000003FF000003FF000003FF
000003FF000003FF000003FF000003FF000003FF000003FF000003FF000003FF000003FF
000003FF000003FF000003FF000003FF000003FF007803FF007803FF007803FF007803FF
007803FF007803FF007803FF007803FF00F801FF80F001FF81F000FFC3E0003FFFC0001F
FF800003FE001D357EB425>I<00FF00003FC0FFFF003FFFC0FFFF003FFFC0FFFF003FFF
C0FFFF003FFFC007FF0001FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FF
C003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0000FFC003FF0001FF
C003FF0001FFC003FF0003FFC003FF0003FFC001FF0007FFC001FF800FFFE000FFC03EFF
FF007FFFFCFFFF001FFFF0FFFF0003FF80FFFF30257DA435>I<FFFFF001FFF8FFFFF001
FFF8FFFFF001FFF8FFFFF001FFF803FF00003F0003FF00001E0003FF80003E0001FF8000
3C0001FFC0007C0000FFC000780000FFE000F800007FE000F000007FF001F000003FF001
E000003FF801E000001FF803C000001FF803C000001FFC07C000000FFC078000000FFE0F
80000007FE0F00000007FF1F00000003FF1E00000003FFBE00000001FFBC00000001FFFC
00000000FFF800000000FFF800000000FFF8000000007FF0000000007FF0000000003FE0
000000003FE0000000001FC0000000001FC0000000000F80000000000F8000002D257EA4
32>I<FFFFF1FFFF803FFFFFFFF1FFFF803FFFFFFFF1FFFF803FFFFFFFF1FFFF803FFF07
FE000FF80003E003FF0007F80003C003FF0007FC0003C003FF8007FC0007C001FF8003FE
00078001FF8007FE00078000FFC007FE000F0000FFC007FF000F0000FFE00FFF001F0000
7FE00FFF801E00007FE01FFF801E00003FF01E7F803C00003FF01E7FC03C00003FF83E7F
C07C00001FF83C3FE07800001FF87C3FE0F800000FFC781FF0F000000FFC781FF0F00000
0FFEF00FF1F0000007FEF00FF9E0000007FFF00FFBE0000003FFE007FFC0000003FFE007
FFC0000003FFC003FFC0000001FFC003FF80000001FFC003FF80000000FF8001FF000000
00FF8001FF00000000FF0000FF000000007F0000FE000000007F0000FE000000003E0000
7C000000003C00003C000040257EA445>I<FFFFF01FFFF0FFFFF01FFFF0FFFFF01FFFF0
FFFFF01FFFF003FF8003F80001FFC003E00000FFC007E000007FE007C000003FF00F8000
003FF81F0000001FFC3E0000000FFC7C00000007FEFC00000003FFF800000003FFF00000
0001FFE000000000FFC0000000007FE0000000003FF0000000003FF8000000007FFC0000
00007FFC00000000FFFE00000001F3FF00000003E3FF80000007C1FFC000000FC0FFC000
001F807FE000001F003FF000003E003FF800007C001FFC0000F8000FFC0001F80007FE00
FFFF003FFFF8FFFF003FFFF8FFFF003FFFF8FFFF003FFFF82D257EA432>I<FFFFF001FF
F8FFFFF001FFF8FFFFF001FFF8FFFFF001FFF803FF00003F0003FF00001E0003FF80003E
0001FF80003C0001FFC0007C0000FFC000780000FFE000F800007FE000F000007FF001F0
00003FF001E000003FF801E000001FF803C000001FF803C000001FFC07C000000FFC0780
00000FFE0F80000007FE0F00000007FF1F00000003FF1E00000003FFBE00000001FFBC00
000001FFFC00000000FFF800000000FFF800000000FFF8000000007FF0000000007FF000
0000003FE0000000003FE0000000001FC0000000001FC0000000000F80000000000F8000
0000000F00000000000F00000000001F00000000001E0000003F003E0000007F803C0000
00FFC07C000000FFC078000000FFC0F8000000FFC1F0000000FFC3E00000007F87C00000
007D1F800000003FFF000000001FFC0000000007F0000000002D357EA432>I<3FFFFFFF
C03FFFFFFFC03FFFFFFFC03FF003FF803F8007FF803F000FFF003E000FFE003C001FFC00
7C003FFC007C003FF80078007FF0007800FFF0007800FFE0007801FFC0007803FFC00000
07FF80000007FF0000000FFE0000001FFE0000001FFC0000003FF80000007FF803C000FF
F003C000FFE003C001FFC003C003FFC003C003FF8007C007FF0007C00FFF0007C00FFE00
0F801FFC000F803FFC001F807FF8003F807FF001FF80FFFFFFFF80FFFFFFFF80FFFFFFFF
8022257DA42A>I E /FB 2 104 df<0000000FE0000000FFE0000003FC0000000FE00000
003FC00000007F80000000FF00000000FE00000001FC00000001FC00000003F800000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000003F8
00000003F800000003F800000003F800000003F800000003F800000003F800000003F800
000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F8000000
03F800000007F000000007F00000000FE00000001FE00000003FC00000007F80000000FE
00000007F8000000FFE0000000FFE000000007F800000000FE000000007F800000003FC0
0000001FE00000000FE000000007F000000007F000000003F800000003F800000003F800
000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F8000000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000001FC
00000001FC00000000FE00000000FF000000007F800000003FC00000000FE000000003FC
00000000FFE00000000FE0236479CA32>102 D<FE00000000FFE000000007F800000000
FE000000007F800000003FC00000001FE00000000FE000000007F000000007F000000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000003F8
00000003F800000003F800000003F800000003F800000003F800000003F800000003F800
000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F8000000
03F800000003F800000001FC00000001FC00000000FE00000000FF000000007F80000000
3FC00000000FE000000003FC00000000FFE0000000FFE0000003FC0000000FE00000003F
C00000007F80000000FF00000000FE00000001FC00000001FC00000003F800000003F800
000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F8000000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000003F8
00000007F000000007F00000000FE00000001FE00000003FC00000007F80000000FE0000
0007F8000000FFE0000000FE00000000236479CA32>I E /FC 20
122 df<00001F00000000001F00000000003F80000000003F80000000003F8000000000
3F80000000003F80000000003F80000000003F80000000003F80000000003F8000000000
3F80000000003F80000000003F80000000003F80000000003F80000000003F8000000000
3F8000007FFFFFFFFF807FFFFFFFFF80FFFFFFFFFFC0FFFFFFFFFFC0FFFFFFFFFFC07FFF
FFFFFF807FFFFFFFFF8000003F80000000003F80000000003F80000000003F8000000000
3F80000000003F80000000003F80000000003F80000000003F80000000003F8000000000
3F80000000003F80000000003F80000000003F80000000003F80000000003F8000000000
1F00000000001F0000002A2B7CB333>43 D<07C00FF01FF83FF83FFC3FFC3FFE3FFE1FFE
0FFE07FE007E00FE00FE00FC01FC03F807F80FF07FE0FFE0FFC0FF00FE0078000F196E8A
33>I<7FFFFFFFFE7FFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFFFE7FFFFF
FFFE28077BA133>I<1F003F807FC0FFE0FFE0FFE0FFE0FFE07FC03F801F000B0B6C8A33>
I<0001FFC00000000FFFF80000003FFFFE000000FFFFFF800001FFFFFFC00003FFFFFFE0
0007FF807FF0000FFC000FF8000FF00007FC001FE00003FC001FE00001FE001FE00001FE
001FE00000FE001FE00000FE000FC00000FE0007800000FE0000000000FE0000000001FE
0000000001FC0000000001FC0000000003FC0000000007F8000000000FF8000000001FF0
000000003FE000000003FFC0000003FFFF80000007FFFF00000007FFFE00000007FFFF00
000007FFFFC0000003FFFFE0000000007FF0000000000FF80000000003FC0000000001FE
0000000000FF00000000007F00000000007F80000000003F80000000003F80000000001F
C0000000001FC0000000001FC03C0000001FC07E0000001FC0FF0000001FC0FF0000001F
C0FF0000003FC0FF0000003F80FF0000007F807F0000007F007F800000FF007FC00001FE
003FE00003FE001FF8000FFC000FFF807FF80007FFFFFFF00003FFFFFFE00001FFFFFF80
00007FFFFF0000000FFFFC00000001FFC000002A3F7CBD33>51 D<000007F8000000003F
FF00000000FFFF80000003FFFFE000000FFFFFF000001FFFFFF800003FFC0FF800007FE0
03FC0000FF8001FC0001FF0000FE0003FC00007E0003F8007E7F0007F801FFBF0007F007
FFFF000FE00FFFFF800FC01FFFFF801FC03FFFFF801F803FC3FF803F807F81FF803F007F
00FFC03F00FE007FC07F00FC003FC07E01FC003FC07E01F8001FC07E01F8001FC0FE01F8
001FC0FC03F8001FC0FC03F0000FC0FC03F0000FC0FC03F0000FC0FC03F0000FC0FC03F0
000FC0FC03F0000FC0FC03F0000FC0FC03F0000FC0FC03F0000FC0FC03F8001FC0FE01F8
001F807E01F8001F807E01F8001F807E01FC003F807F00FC003F003F00FE007F003F007F
00FE003F807F81FE001F803FC3FC001FC03FFFFC000FC01FFFF8000FE00FFFF00007F007
FFE00007F801FF800003F8007E000003FC00000F8001FF00001FC000FF80003FC0007FE0
00FFC0003FFC07FF80001FFFFFFF00000FFFFFFE000003FFFFF8000000FFFFF00000003F
FF8000000007FC00002A3F7CBD33>64 D<0000FFF0000007FFFE00001FFFFF80003FFFFF
C0007FFFFFE001FFFFFFF003FFC01FF003FE000FF007FC000FF00FF8000FF01FF00007E0
1FE00003C03FC00000003F800000003F800000007F800000007F000000007F00000000FF
00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE00
000000FE00000000FE00000000FF000000007F000000007F000000007F800000003F8000
01F03FC00003F81FE00003F81FF00007F80FF80007F007FC000FF007FF001FE003FFE07F
E001FFFFFFC000FFFFFF80003FFFFF00001FFFFC000007FFF8000000FFC000252E79AC33
>99 D<0000007FF800000000FFFC00000001FFFC00000001FFFC00000000FFFC00000000
7FFC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC00000000
01FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC000001FF
01FC000007FFC1FC00001FFFF1FC00007FFFF9FC0000FFFFFFFC0001FFFFFFFC0003FF81
FFFC0007FE003FFC000FF8001FFC000FF0000FFC001FE00007FC001FC00003FC003FC000
03FC003F800001FC007F800001FC007F000001FC007F000001FC00FF000001FC00FE0000
01FC00FE000001FC00FE000001FC00FE000001FC00FE000001FC00FE000001FC00FE0000
01FC00FE000001FC00FE000001FC00FF000001FC007F000001FC007F000003FC007F8000
03FC003F800003FC003FC00007FC003FC00007FC001FE0000FFC001FF0001FFC000FF800
3FFC0007FC007FFC0003FF81FFFFF003FFFFFFFFF800FFFFFDFFFC007FFFF9FFFC003FFF
E1FFF8000FFF80FFF00001FE0000002E3E7DBC33>I<0000FF80000007FFF000001FFFFC
00003FFFFE0000FFFFFF0001FFFFFF8003FF80FFC007FE003FE007F8000FF00FF00007F0
1FE00007F81FC00003F83FC00003FC3F800001FC7F800001FC7F000001FC7F000001FE7F
000000FEFF000000FEFE000000FEFFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFFFFFFFEFFFF
FFFFFEFFFFFFFFFCFE00000000FF000000007F000000007F000000007F000000003F8000
00003F8000007C1FC00000FE1FE00000FE0FF00000FE0FF80001FE07FC0003FC03FF000F
FC01FFC03FF800FFFFFFF0007FFFFFE0003FFFFFC0000FFFFF000003FFFC0000007FE000
272E7BAC33>I<0000003FE0000001FFFC000007FFFE00001FFFFE00003FFFFF00007FFF
FF0000FFC0FF0000FF00FF0001FE007E0001FC003C0003FC00000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800003FFFFFFFF87F
FFFFFFFCFFFFFFFFFCFFFFFFFFFCFFFFFFFFFC7FFFFFFFF80003F800000003F800000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000003F8
00000003F800000003F800000003F800000003F800000003F800000003F800000003F800
000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F800003F
FFFFFF807FFFFFFFC07FFFFFFFC07FFFFFFFC07FFFFFFFC03FFFFFFF80283E7DBD33>I<
0001FE001FE0000FFFC0FFF0003FFFF3FFF8007FFFFFFFFC00FFFFFFFFFC01FFFFFFFFFC
03FF03FFE1FC07FC00FF80F807F8007F80600FF0003FC0000FE0001FC0000FE0001FC000
1FE0001FE0001FC0000FE0001FC0000FE0001FC0000FE0001FC0000FE0001FC0000FE000
1FC0000FE0001FE0001FE0000FE0001FC0000FE0001FC0000FF0003FC00007F8007F8000
07FC00FF800003FF03FF000003FFFFFE000007FFFFFC000007FFFFF8000007FFFFF00000
0FCFFFC000000F81FE0000000F80000000000F80000000000FC0000000000FC000000000
07E00000000007F00000000007FFFFFC000003FFFFFFC00001FFFFFFF00007FFFFFFFC00
0FFFFFFFFF001FFFFFFFFF801FE00007FF803FC000007FC03F0000001FE07F0000000FE0
7E00000007E0FE00000007F0FC00000003F0FC00000003F0FC00000003F0FC00000003F0
FC00000003F0FE00000007F07E00000007E07F0000000FE03F8000001FC03FE000007FC0
1FF80001FF800FFF801FFF0007FFFFFFFE0003FFFFFFFC0000FFFFFFF000003FFFFFC000
000FFFFF00000000FFF000002E447DAB33>I<0000E000000003F800000003F800000007
FC00000007FC00000007FC00000003F800000003F800000000E000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000003FFFF800007FFFFC00007FFFFC00007FFFFC00007FFFFC00003FFFFC0000
0001FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC000000
01FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001
FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC
00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC00000001FC00
000001FC00000001FC00007FFFFFFFC0FFFFFFFFE0FFFFFFFFF0FFFFFFFFF0FFFFFFFFE0
7FFFFFFFC0243E78BD33>105 D<7FF800000000FFFC00000000FFFC00000000FFFC0000
0000FFFC000000007FFC0000000000FC0000000000FC0000000000FC0000000000FC0000
000000FC0000000000FC0000000000FC0000000000FC0000000000FC0000000000FC0000
000000FC0000000000FC0000000000FC01FFFFC000FC03FFFFE000FC07FFFFF000FC07FF
FFF000FC03FFFFE000FC01FFFFC000FC000FF00000FC001FE00000FC003FC00000FC007F
800000FC00FF000000FC01FE000000FC03FC000000FC07F8000000FC0FF0000000FC1FE0
000000FC3FC0000000FC7F80000000FCFFC0000000FDFFE0000000FFFFE0000000FFFFF0
000000FFF3F8000000FFE3FC000000FFC1FC000000FF80FE000000FF007F000000FE007F
000000FC003F800000FC001FC00000FC001FE00000FC000FE00000FC0007F00000FC0003
F80000FC0003FC0000FC0001FC0000FC0000FE007FFFF80FFFF0FFFFFC1FFFF8FFFFFC1F
FFFCFFFFFC1FFFFCFFFFFC1FFFF87FFFF80FFFF02E3D7EBC33>107
D<0000FC007E00007FC3FF01FF8000FFEFFF87FFC000FFFFFFCFFFE000FFFFFFDFFFE000
FFFFFFFFFFF0007FFF0FFF87F00007FE07FF03F00007FC07FE03F80007F803FC01F80007
F803FC01F80007F003F801F80007F003F801F80007F003F801F80007F003F801F80007E0
03F001F80007E003F001F80007E003F001F80007E003F001F80007E003F001F80007E003
F001F80007E003F001F80007E003F001F80007E003F001F80007E003F001F80007E003F0
01F80007E003F001F80007E003F001F80007E003F001F80007E003F001F80007E003F001
F80007E003F001F80007E003F001F80007E003F001F80007E003F001F80007E003F001F8
0007E003F001F80007E003F001F8007FFE0FFF07FF80FFFF1FFF8FFFC0FFFF1FFF8FFFC0
FFFF1FFF8FFFC0FFFF1FFF8FFFC07FFE0FFF07FF80322C80AB33>109
D<000001FF00003FFC07FFC0007FFE1FFFF000FFFE7FFFF800FFFEFFFFF8007FFFFFFFFC
003FFFFF07FE0000FFF801FE0000FFF000FE0000FFE000FF0000FFC0007F0000FF80007F
0000FF80007F0000FF00007F0000FF00007F0000FF00007F0000FE00007F0000FE00007F
0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F
0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F
0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F
0000FE00007F0000FE00007F003FFFF80FFFFC7FFFFC1FFFFEFFFFFE3FFFFFFFFFFE3FFF
FF7FFFFC1FFFFE3FFFF80FFFFC302C7FAB33>I<0001FE0000000FFFC000003FFFF00000
7FFFF80000FFFFFC0001FFFFFE0003FF03FF0007FC00FF800FF8007FC00FF0003FC01FE0
001FE01FC0000FE03F800007F03F800007F07F800007F87F000003F87F000003F87F0000
03F8FE000001FCFE000001FCFE000001FCFE000001FCFE000001FCFE000001FCFE000001
FCFE000001FCFE000001FCFE000001FCFF000003FC7F000003F87F000003F87F800007F8
3F800007F03FC0000FF03FC0000FF01FE0001FE01FF0003FE00FF8007FC007FC00FF8003
FF03FF0001FFFFFE0000FFFFFC00007FFFF800003FFFF000000FFFC0000001FE0000262E
7AAC33>I<00000003FE007FFF801FFF80FFFFC07FFFE0FFFFC1FFFFE0FFFFC3FFFFF0FF
FFC7FFFFF07FFFCFFE0FF0001FDFF00FF0001FFFC007E0001FFF8003C0001FFF00000000
1FFE000000001FFC000000001FF8000000001FF8000000001FF0000000001FF000000000
1FE0000000001FE0000000001FE0000000001FC0000000001FC0000000001FC000000000
1FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC000000000
1FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC000000000
1FC0000000001FC0000000001FC00000007FFFFFFE0000FFFFFFFF0000FFFFFFFF0000FF
FFFFFF0000FFFFFFFF00007FFFFFFE00002C2C7DAB33>114 D<001FFE0F0000FFFF8F80
03FFFFFF800FFFFFFF801FFFFFFF803FFFFFFF803FF007FF807F8001FF807F0000FF80FE
00007F80FC00007F80FC00003F80FC00003F80FC00003F80FE00003F807F00001F007FC0
0000003FF80000003FFFC000001FFFFF00000FFFFFE00003FFFFF80000FFFFFC00001FFF
FF000000FFFF80000007FFC00000007FC00000001FE07C00000FE0FE000007F0FE000003
F0FE000003F0FF000003F0FF000003F0FF800003F0FF800007F0FFC00007E0FFE0000FE0
FFF0003FC0FFFE01FFC0FFFFFFFF80FFFFFFFF00FDFFFFFE00FCFFFFF800F83FFFE00078
07FF0000242E79AC33>I<3FFC001FFE007FFE003FFF00FFFE007FFF00FFFE007FFF007F
FE003FFF003FFE001FFF0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000
FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000
FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000
FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000FE00007F0000
FE00007F0000FE00007F0000FE00007F0000FE0000FF0000FE0000FF0000FE0001FF0000
FE0001FF0000FF0003FF00007F800FFF00007FE03FFFFC003FFFFFFFFE003FFFFFFFFF00
1FFFFF7FFF000FFFFE7FFE0003FFF83FFC0000FFC00000302C7FAA33>117
D<7FFF801FFFE0FFFFC03FFFF0FFFFE07FFFF8FFFFE07FFFF8FFFFC03FFFF07FFF801FFF
E003F80000FC0001F80001FC0001F80001F80001FC0001F80000FC0003F80000FE0003F0
00007E0003F000007E0003F000007F0007E000003F0007E000003F0007E000003F800FC0
00001F800FC000001F800FC000000FC01F8000000FC01F8000000FE01F80000007E03F00
000007E03F00000007F03F00000003F03F00000003F07E00000001F87E00000001F87E00
000001F87C00000000F8FC00000000FCFC00000000FCF8000000007CF8000000007DF800
0000003FF0000000003FF0000000003FF0000000001FE0000000001FE0000000001FE000
0000000FC0000000000FC0000000001FC0000000001F80000000001F80000000003F8000
0000003F00000000003F00000000003F00000000007E00000000007E0000000000FE0000
003F00FC0000003F01FC0000007F81F80000007F83F80000007F87F00000007F9FF00000
007FFFE00000003FFFC00000003FFF800000001FFF000000000FFC0000000003F0000000
002D427DAA33>121 D E /FD 29 122 df<1E007F80FF80FFC0FFC0FFE0FFE0FFE07FE0
1E60006000600060006000E000C000C000C001C0018003800300070006000E001C003800
700060000B1D78891B>44 D<1E007F807F80FFC0FFC0FFC0FFC07F807F801E000A0A7889
1B>46 D<000030000000F0000001F0000003F000001FF00000FFF000FFFFF000FFE7F000
FF07F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F000000FF800
001FFC007FFFFFFF7FFFFFFF7FFFFFFF204278C131>49 D<1C00000000001C0000000000
1F80000000001FFFFFFFFFC01FFFFFFFFFC01FFFFFFFFFC03FFFFFFFFF803FFFFFFFFF80
3FFFFFFFFF003FFFFFFFFE00380000000C00300000001C00700000003800600000003000
60000000700060000000E00060000000C000C0000001C000C00000038000C00000070000
0000000600000000000E00000000001C0000000000180000000000380000000000700000
000000600000000000E00000000001C00000000001C00000000003800000000007800000
00000700000000000F00000000000F00000000001F00000000001E00000000003E000000
00003E00000000007E00000000007C00000000007C0000000000FC0000000000FC000000
0001FC0000000001FC0000000001FC0000000003F80000000003F80000000003F8000000
0003F80000000007F80000000007F80000000007F80000000007F80000000007F8000000
0007F8000000000FF8000000000FF8000000000FF8000000000FF8000000000FF8000000
000FF8000000000FF8000000000FF8000000000FF8000000000FF80000000007F0000000
0001C00000002A457BC231>55 D<0000FF00000007FFE000001FFFF800007F80FC0000FC
007E0001F8003F0003F0001F8007E0000FC00FE00007E01FC00007E01FC00003F03F8000
03F03F800003F87F800001F87F000001FC7F000001FCFF000001FCFF000001FCFF000001
FEFF000000FEFF000000FEFF000000FEFF000000FEFF000000FEFF000000FFFF000000FF
FF000000FFFF000000FF7F000001FF7F000001FF7F000001FF3F800001FF3F800003FF1F
800003FF1FC00003FF0FC00007FF07E00006FF07E0000EFF03F0001CFF01F80038FF007C
0070FF003F01E0FF000FFF80FE0001FE00FE00000000FE00000001FE00000001FC000000
01FC00000001FC00000001FC00000003F800000003F800000003F00F800007F01FC00007
E03FE0000FE03FE0000FC03FE0001F803FE0001F803FC0003F003F80007E001E0000FC00
1C0001F8000F0003F00007E01FE00003FFFF800000FFFE0000001FF0000028447CC131>
57 D<00000000C00000000000000001E00000000000000001E00000000000000001E000
00000000000003F00000000000000003F00000000000000003F00000000000000007F800
00000000000007F80000000000000007F8000000000000000FFC000000000000000FFC00
0000000000000FFC0000000000000019FE0000000000000019FE0000000000000019FE00
00000000000030FF0000000000000030FF0000000000000070FF80000000000000607F80
000000000000607F80000000000000E07FC0000000000000C03FC0000000000000C03FC0
000000000001C03FE0000000000001801FE0000000000001801FE0000000000003001FF0
000000000003000FF0000000000003000FF0000000000006000FF80000000000060007F8
0000000000060007F800000000000C0003FC00000000000C0003FC00000000000C0003FC
0000000000180001FE0000000000180001FE0000000000180001FE0000000000300000FF
0000000000300000FF0000000000700000FF80000000006000007F80000000006000007F
8000000000E000007FC000000000FFFFFFFFC000000000FFFFFFFFC000000001FFFFFFFF
E0000000018000001FE0000000018000001FE0000000030000001FF0000000030000000F
F0000000030000000FF0000000060000000FF80000000600000007F80000000600000007
F80000000C00000003FC0000000C00000003FC0000000C00000003FC0000001800000001
FE0000001800000001FE0000001800000001FE0000003000000000FF0000003000000000
FF0000007800000000FF800000F800000000FF800001FC00000000FFC0000FFF00000003
FFE000FFFFE000007FFFFFC0FFFFE000007FFFFFC0FFFFE000007FFFFFC042477DC649>
65 D<FFFFFFFFFF000000FFFFFFFFFFE00000FFFFFFFFFFFC000001FFC00003FF000000
7F800000FF8000007F8000003FC000007F8000001FE000007F8000000FF000007F800000
07F800007F80000007FC00007F80000003FC00007F80000003FE00007F80000001FE0000
7F80000001FF00007F80000001FF00007F80000001FF00007F80000001FF00007F800000
01FF00007F80000001FF00007F80000001FF00007F80000001FE00007F80000001FE0000
7F80000003FE00007F80000003FC00007F80000007FC00007F80000007F800007F800000
0FF000007F8000001FE000007F8000007FC000007F800000FF0000007F800003FE000000
7F80003FF00000007FFFFFFFE00000007FFFFFFFFC0000007F800000FF8000007F800000
1FC000007F8000000FF000007F80000007F800007F80000003FC00007F80000001FE0000
7F80000000FF00007F80000000FF80007F800000007F80007F800000007FC0007F800000
007FC0007F800000003FC0007F800000003FE0007F800000003FE0007F800000003FE000
7F800000003FE0007F800000003FE0007F800000003FE0007F800000003FE0007F800000
003FE0007F800000007FC0007F800000007FC0007F800000007F80007F80000000FF8000
7F80000001FF00007F80000001FF00007F80000003FE00007F8000000FFC00007F800000
1FF800007F8000007FE00001FFC00003FFC000FFFFFFFFFFFF0000FFFFFFFFFFFC0000FF
FFFFFFFFC000003B447CC345>I<0000000FFE000060000000FFFFC000E0000003FFFFF0
00E000000FFC01FC01E000003FC0003E01E00000FF00000F83E00003FC000003C7E00007
F8000001E7E0000FF0000000FFE0001FE00000007FE0003FC00000003FE0007F80000000
1FE000FF000000000FE001FE000000000FE001FC0000000007E003FC0000000007E007F8
0000000003E007F80000000003E00FF00000000001E00FF00000000001E01FE000000000
00E01FE00000000000E03FE00000000000E03FE00000000000E03FC00000000000607FC0
0000000000607FC00000000000607FC00000000000607FC0000000000000FF8000000000
0000FF80000000000000FF80000000000000FF80000000000000FF80000000000000FF80
000000000000FF80000000000000FF80000000000000FF80000000000000FF8000000000
0000FF80000000000000FF80000000000000FF80000000000000FF800000000000007FC0
0000000000007FC00000000000007FC00000000000607FC00000000000603FC000000000
00603FE00000000000603FE00000000000601FE00000000000E01FF00000000000E00FF0
0000000000C00FF00000000000C007F80000000001C007F800000000018003FC00000000
038001FC00000000038001FE00000000070000FF000000000600007F800000000E00003F
C00000001C00001FE00000003800000FF000000078000007F8000000F0000003FC000001
E0000000FF000007800000003FC0001F000000000FFC00FC0000000003FFFFF000000000
00FFFFC000000000000FFE0000003B487BC546>I<FFFFFFFFFFFFF0FFFFFFFFFFFFF0FF
FFFFFFFFFFF001FFC000007FF0007F8000000FF8007F80000003F8007F80000001F8007F
80000000F8007F8000000078007F8000000038007F8000000038007F800000001C007F80
0000001C007F800000001C007F800000000C007F800000000C007F800000000C007F8000
00000C007F800000000E007F8000000006007F80000C0006007F80000C0006007F80000C
0000007F80000C0000007F80000C0000007F80000C0000007F80000C0000007F80001C00
00007F80001C0000007F80003C0000007F80007C0000007F8001FC0000007FFFFFFC0000
007FFFFFFC0000007FFFFFFC0000007F8001FC0000007F80007C0000007F80003C000000
7F80001C0000007F80001C0000007F80000C0000007F80000C0000007F80000C0000007F
80000C0000007F80000C0000007F80000C0000007F80000C0000007F8000000000007F80
00000000007F8000000000007F8000000000007F8000000000007F8000000000007F8000
000000007F8000000000007F8000000000007F8000000000007F8000000000007F800000
0000007F8000000000007F8000000000007F8000000000007F8000000000007FC0000000
0001FFE000000000FFFFFFF8000000FFFFFFF8000000FFFFFFF800000037447CC340>70
D<FFFFFFC003FFFFFFFFFFFFC003FFFFFFFFFFFFC003FFFFFF01FFE0000007FF80007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007FFF
FFFFFFFE00007FFFFFFFFFFE00007FFFFFFFFFFE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80
000001FE00007F80000001FE00007F80000001FE00007F80000001FE00007F80000001FE
00007F80000001FE0001FFE0000007FF80FFFFFFC003FFFFFFFFFFFFC003FFFFFFFFFFFF
C003FFFFFF40447CC349>72 D<000FFFFFFE000FFFFFFE000FFFFFFE000003FF80000001
FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF
00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00
000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF0000
0000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF000000
00FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000
FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF
00000000FF00000000FF00000000FF00000000FF003F0000FF007F8000FF00FFC000FF00
FFC000FF00FFC000FF00FFC000FF00FFC001FE00FF8001FE00FF0001FE006C0003FC0070
0003F800380007F8001C0007F0000E000FE00007001F800003E07F000000FFFC0000001F
E0000027467BC332>74 D<FFFFFFC00001FFFFC0FFFFFFC00001FFFFC0FFFFFFC00001FF
FFC001FFE00000007FFC0000FFC00000003FE000007F800000003F8000007F800000003E
0000007F800000003C0000007F80000000380000007F80000000700000007F80000000E0
0000007F80000001C00000007F80000003800000007F80000007000000007F8000001E00
0000007F80000038000000007F80000070000000007F800000E0000000007F800001C000
0000007F80000380000000007F80000700000000007F80000E00000000007F80001C0000
0000007F80003800000000007F80007000000000007F8000E000000000007F8001C00000
0000007F8003E000000000007F8007F000000000007F800FF000000000007F801FF80000
0000007F803FFC00000000007F8077FC00000000007F80E3FE00000000007F81C1FF0000
0000007F8381FF00000000007F8700FF80000000007F8E007FC0000000007F9C007FC000
0000007FB8003FE0000000007FF0001FF0000000007FC0001FF0000000007F80000FF800
0000007F800007FC000000007F800007FC000000007F800003FE000000007F800001FF00
0000007F800001FF000000007F800000FF800000007F8000007FC00000007F8000007FC0
0000007F8000003FE00000007F8000001FF00000007F8000001FF00000007F8000000FF8
0000007F80000007FC0000007F80000007FC0000007F80000003FE0000007F80000001FF
0000007F80000001FF0000007F80000000FF8000007F80000000FFC000007F80000000FF
E00000FFC0000000FFF00001FFE0000001FFFC00FFFFFFC0001FFFFFE0FFFFFFC0001FFF
FFE0FFFFFFC0001FFFFFE043447CC34C>I<FFFFFFFFE000000000FFFFFFFFFF00000000
FFFFFFFFFFC000000001FFC0003FF8000000007F800003FC000000007F800000FF000000
007F8000007F800000007F8000003FC00000007F8000001FE00000007F8000000FF00000
007F80000007F80000007F80000007F80000007F80000007FC0000007F80000003FC0000
007F80000003FE0000007F80000003FE0000007F80000003FE0000007F80000003FE0000
007F80000003FE0000007F80000003FE0000007F80000003FE0000007F80000003FC0000
007F80000003FC0000007F80000007FC0000007F80000007F80000007F8000000FF00000
007F8000000FF00000007F8000001FE00000007F8000003FC00000007F8000007F000000
007F800001FE000000007F800007F8000000007F80003FE0000000007FFFFFFF00000000
007FFFFFFC00000000007F80007F80000000007F80000FE0000000007F800007F0000000
007F800003FC000000007F800001FE000000007F800000FE000000007F800000FF000000
007F8000007F800000007F8000007F800000007F8000003FC00000007F8000003FC00000
007F8000003FC00000007F8000003FC00000007F8000003FC00000007F8000003FC00000
007F8000003FC00000007F8000003FE00000007F8000003FE00000007F8000003FE00000
007F8000003FE00000007F8000003FE00000007F8000003FE00000007F8000003FE00000
007F8000003FE00060007F8000003FF00060007F8000001FF00060007F8000001FF00060
007F8000001FF000E0007F8000000FF800C001FFE0000007F801C0FFFFFFC00007F80180
FFFFFFC00001FC0380FFFFFFC00000FE07000000000000003FFE0000000000000007F800
43467CC348>82 D<0007FC000000003FFF80000000F80FE0000003C003F00000070001F8
00000E0000FC00000FC0007E00001FE0007F00001FF0003F80001FF0003F80001FF0003F
80001FF0001FC0001FF0001FC0000FE0001FC0000380001FC0000000001FC0000000001F
C0000000001FC0000000001FC00000000FFFC0000001FFFFC000000FFE1FC000003FC01F
C00000FF001FC00003FC001FC00007F8001FC0000FF0001FC0001FE0001FC0003FC0001F
C0007FC0001FC0007F80001FC0007F80001FC060FF00001FC060FF00001FC060FF00001F
C060FF00003FC060FF00003FC060FF00003FC060FF80007FC0607F8000EFC0607FC000C7
E0C03FC001C7E0C01FE00783F1C007F81E03FF8001FFFC01FF00001FE0007C002B2E7CAC
31>97 D<01FC00000000FFFC00000000FFFC00000000FFFC0000000007FC0000000003FC
0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC
0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC
0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC
0000000001FC0000000001FC03FC000001FC0FFF800001FC3C07E00001FC7001F80001FD
E0007E0001FD80003F0001FF80001F8001FF00001FC001FE00000FE001FC000007E001FC
000007F001FC000007F001FC000003F801FC000003F801FC000003FC01FC000003FC01FC
000001FC01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC
000001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC
000001FC01FC000003FC01FC000003FC01FC000003F801FC000003F801FC000007F001FC
000007F001FE00000FE001FE00000FC001FF00001FC001FB00003F8001F380007E0001E1
C000FC0001E0F001F80001C03C07E00001801FFF8000000003FC00002F467DC436>I<00
007F80000003FFF000000FC07C00003F000F0000FC00038001F80001C003F8000FC007F0
001FE007E0003FE00FE0003FE01FC0003FE01FC0003FE03F80003FE03F80001FC07F8000
07007F800000007F800000007F00000000FF00000000FF00000000FF00000000FF000000
00FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000FF00000000
7F000000007F800000007F800000003F800000003F800000303FC00000301FC00000700F
E00000600FE00000E007F00000C003F80001C001F800038000FC000700003F001E00001F
C078000007FFF0000000FF8000242E7DAC2B>I<0001FE00000007FFC000001F03F00000
7E00FC0000FC007E0001F8003F0003F0003F0007E0001F800FE0001FC00FC0000FC01FC0
000FC03F80000FE03F800007E03F800007E07F800007F07F000007F07F000007F0FF0000
07F0FF000007F0FF000007F0FFFFFFFFF0FFFFFFFFF0FF00000000FF00000000FF000000
00FF00000000FF00000000FF000000007F000000007F000000007F800000007F80000000
3F800000003F800000301FC00000301FC00000700FC00000600FE00000E007F00000C003
F00001C001F800038000FC000700003E001E00001F80F8000003FFE0000000FF0000242E
7DAC2B>101 D<000000000F800001FC007FE0000FFF81F0F0003F07E381F000FC01FF03
F001F800FE01F003F0007E01E007F0007F000007E0003F00000FE0003F80000FC0001F80
001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0
001FC0001FC0001FC0001FC0001FC0001FC0000FC0001F80000FE0003F800007E0003F00
0007F0007F000003F0007E000001F800FC000001FC01F8000003BF07E00000030FFF8000
000701FC0000000700000000000700000000000F00000000000F00000000000F00000000
000F800000000007C00000000007E00000000007FFFFF8000003FFFFFF000003FFFFFFE0
0001FFFFFFF800007FFFFFFC0001FFFFFFFE0007C0000FFF000F800000FF003F0000003F
803E0000001F807C0000000FC07C0000000FC0F800000007C0F800000007C0F800000007
C0F800000007C0F800000007C0FC0000000FC07C0000000F807E0000001F803E0000001F
001F0000003E000F8000007C0007E00001F80001F80007E000007F003F8000001FFFFE00
000001FFE000002C427DAC31>103 D<01E00007F80007F8000FFC000FFC000FFC000FFC
0007F80007F80001E0000000000000000000000000000000000000000000000000000000
0000000000000000000000000001FC00FFFC00FFFC00FFFC0007FC0003FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0003FE00FFFFF8FFFFF8FFFF
F815437DC21C>105 D<01FC00FFFC00FFFC00FFFC0007FC0003FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC
0001FC0001FC0001FC0001FC0001FC0001FC0001FC0001FC0003FE00FFFFF8FFFFF8FFFF
F815457DC41C>108 D<01FC00FF00001FE00000FFFC07FFE000FFFC0000FFFC0F03F801
E07F0000FFFC3C01FC07803F800007FC7000FE0E001FC00003FCE0007E1C000FC00001FD
C0007F38000FE00001FD80007F30000FE00001FF80003FF00007F00001FF00003FE00007
F00001FF00003FE00007F00001FE00003FC00007F00001FE00003FC00007F00001FE0000
3FC00007F00001FC00003F800007F00001FC00003F800007F00001FC00003F800007F000
01FC00003F800007F00001FC00003F800007F00001FC00003F800007F00001FC00003F80
0007F00001FC00003F800007F00001FC00003F800007F00001FC00003F800007F00001FC
00003F800007F00001FC00003F800007F00001FC00003F800007F00001FC00003F800007
F00001FC00003F800007F00001FC00003F800007F00001FC00003F800007F00001FC0000
3F800007F00001FC00003F800007F00001FC00003F800007F00001FC00003F800007F000
01FC00003F800007F00001FC00003F800007F00001FC00003F800007F00001FC00003F80
0007F00001FC00003F800007F00003FE00007FC0000FF800FFFFF81FFFFF03FFFFE0FFFF
F81FFFFF03FFFFE0FFFFF81FFFFF03FFFFE04B2C7DAB52>I<01FC01FE0000FFFC07FFC0
00FFFC1E07F000FFFC3801F80007FC7001FC0003FCE000FC0001FDC000FE0001FD8000FE
0001FF80007F0001FF00007F0001FF00007F0001FE00007F0001FE00007F0001FE00007F
0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F
0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F
0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F
0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F
0001FC00007F0001FC00007F0003FE0000FF80FFFFF83FFFFEFFFFF83FFFFEFFFFF83FFF
FE2F2C7DAB36>I<00007F8000000003FFF00000000FC0FC0000003E001F0000007C000F
800000F80007C00001F00003E00003E00001F00007C00000F8000FC00000FC000FC00000
FC001F8000007E003F8000007F003F8000007F003F0000003F007F0000003F807F000000
3F807F0000003F807F0000003F80FF0000003FC0FF0000003FC0FF0000003FC0FF000000
3FC0FF0000003FC0FF0000003FC0FF0000003FC0FF0000003FC0FF0000003FC0FF000000
3FC07F0000003F807F0000003F807F8000007F803F8000007F003F8000007F001F800000
7E001FC00000FE000FC00000FC000FE00001FC0007E00001F80003F00003F00001F80007
E00000FC000FC000003E001F0000001FC0FE00000007FFF8000000007F8000002A2E7DAC
31>I<01FC03FC0000FFFC0FFF8000FFFC3C07E000FFFC7001F80007FDE000FE0001FD80
007F0001FF80003F8001FF00001FC001FE00001FE001FC00000FE001FC00000FF001FC00
0007F001FC000007F801FC000003F801FC000003FC01FC000003FC01FC000003FC01FC00
0001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC00
0001FE01FC000001FE01FC000001FE01FC000001FE01FC000001FE01FC000003FC01FC00
0003FC01FC000003FC01FC000007F801FC000007F801FC000007F001FC00000FF001FE00
000FE001FE00001FC001FF00003FC001FF00003F8001FF80007E0001FDC000FC0001FCF0
03F80001FC3C0FE00001FC1FFF800001FC03FC000001FC0000000001FC0000000001FC00
00000001FC0000000001FC0000000001FC0000000001FC0000000001FC0000000001FC00
00000001FC0000000001FC0000000001FC0000000001FC0000000001FC0000000003FE00
000000FFFFF8000000FFFFF8000000FFFFF80000002F3F7DAB36>I<03F803F0FFF81FFC
FFF83C3EFFF8707F07F8E0FF03F9C0FF01F980FF01FB80FF01FB007E01FB003C01FF0000
01FE000001FE000001FE000001FE000001FC000001FC000001FC000001FC000001FC0000
01FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC0000
01FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC0000
01FC000001FC000003FF0000FFFFFE00FFFFFE00FFFFFE00202C7DAB26>114
D<003FE01801FFFC3807E01F780F0003F81E0001F83C0000F87C00007878000078F80000
38F8000038F8000018F8000018FC000018FC000018FE000018FF8000007FC000007FFC00
003FFFE0001FFFFC000FFFFF0007FFFFC003FFFFE000FFFFF0001FFFF80000FFF800000F
FC000003FCC00001FEC00000FEC000007EE000007EE000003EE000003EF000003EF00000
3EF000003EF800003CFC00007CFC000078FE0000F8FF0001F0F38003E0F1F00F80E07FFE
00C00FF0001F2E7DAC26>I<0006000000060000000600000006000000060000000E0000
000E0000000E0000000E0000001E0000001E0000001E0000003E0000007E0000007E0000
00FE000001FE000007FE00001FFFFFF0FFFFFFF0FFFFFFF000FE000000FE000000FE0000
00FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE0000
00FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE0000
00FE000000FE000C00FE000C00FE000C00FE000C00FE000C00FE000C00FE000C00FE000C
00FE000C00FE000C007E001C007F0018007F0018003F0038001F8030001FC0700007E0E0
0001FFC000007F001E3E7EBC26>I<01FC00007F00FFFC003FFF00FFFC003FFF00FFFC00
3FFF0007FC0001FF0003FC0000FF0001FC00007F0001FC00007F0001FC00007F0001FC00
007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00
007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00
007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC00
007F0001FC00007F0001FC00007F0001FC00007F0001FC00007F0001FC0000FF0001FC00
00FF0001FC0000FF0001FC0001FF0001FC0001FF0000FC0001FF0000FE0003FF00007E00
077F80007F000E7FC0003F001C7FFE000FC0787FFE0003FFF07FFE00007F807F002F2D7D
AB36>I<FFFFF001FFFCFFFFF001FFFCFFFFF001FFFC07FF00007FE003FE00001F8001FE
00001F0001FE00000E0000FE00000C0000FF00001C00007F00001800007F00001800007F
80003800003F80003000003F80003000001FC0006000001FC0006000001FE000E000000F
E000C000000FE000C0000007F00180000007F00180000007F80380000003F80300000003
F80300000001FC0600000001FC0600000001FE0E00000000FE0C00000000FE0C00000000
7F18000000007F18000000007FB8000000003FB0000000003FB0000000001FE000000000
1FE0000000001FE0000000000FC0000000000FC000000000078000000000078000000000
078000000000030000000000030000000000060000000000060000000000060000000000
0C00000000000C0000000000180000000000180000003C00180000007E0030000000FF00
30000000FF0060000000FF0060000000FF00C0000000FE01C00000007C03800000007007
000000003C1E000000000FFC0000000003F0000000002E3F7EAA33>121
D E /FF 1 44 df<00000003C00000000000000FF00000000000000FF00000000000001F
F80000000000001FF80000000000001FF80000000000001FF80000000000001FF8000000
0000001FF80000000000001FF80000000000001FF80000000000001FF80000000000001F
F80000000000001FF80000000000001FF80000000000001FF80000000000001FF8000000
0000001FF80000000000001FF80000000000001FF80000000000001FF80000000000001F
F80000000000001FF80000000000001FF80000000000001FF80000000000001FF8000000
1FFFFFFFFFFFFFF07FFFFFFFFFFFFFFC7FFFFFFFFFFFFFFCFFFFFFFFFFFFFFFEFFFFFFFF
FFFFFFFEFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFE7FFFFFFFFFFFFFFC7FFFFFFFFFFFFFFC
1FFFFFFFFFFFFFF00000001FF80000000000001FF80000000000001FF80000000000001F
F80000000000001FF80000000000001FF80000000000001FF80000000000001FF8000000
0000001FF80000000000001FF80000000000001FF80000000000001FF80000000000001F
F80000000000001FF80000000000001FF80000000000001FF80000000000001FF8000000
0000001FF80000000000001FF80000000000001FF80000000000001FF80000000000001F
F80000000000001FF80000000000000FF00000000000000FF000000000000003C0000000
3F3E7BCA4A>43 D E /FG 2 80 df<000000000000007FF0000003FC0000000000000007
FFFF00000FFF800000000000001FFFFFC0003FFFE00000000000007FC00FF0007E07F000
0000000001FE0001F801FC01F8000000000003FC0001F803F801F8000000000007F00007
FC07F007FC00000000000FE0000FFC07F00FFC00000000001FC0001FFC0FE01FFC000000
00003FC0001FFC1FE01FFC00000000003F80001FFC1FE01FFC00000000007F80003FF83F
E03FF80000000000FF80003FF83FC03FF80000000000FF00001FF03FC01FF00000000000
FF00001FE07FC01FE00000000001FF000007807FC007800000000001FF000000007F8000
000000000003FE00000000FF8000000000000003FE00000000FF8000000000000003FE00
000000FF8000000000000003FE00000000FF8000000000000007FC00000001FF00000000
00000007FC00000001FF0000000000000007FC00000001FF0000000000000007FC000000
01FF000000000000000FFC00000003FF000000000000000FF800000003FE000000000000
000FF800000003FE000000000000000FF800000003FE000000000000000FF800000003FE
000000000000001FF800000007FE000000000000001FF000000007FC000000000000001F
F000000007FC000000000000001FF000000007FC000000000000001FF000000007FC0000
00000000003FF00000000FFC000000000000003FE00000000FF8000000000000003FE000
00000FF8000000000000003FE00000000FF8000000000007FFFFFFFFFFFFFFFFFFE00000
0007FFFFFFFFFFFFFFFFFFF000000007FFFFFFFFFFFFFFFFFFE000000007FFFFFFFFFFFF
FFFFFFE000000000007FC00000001FF0000000000000007FC00000001FF0000000000000
00FFC00000001FF000000000000000FF800000003FF000000000000000FF800000003FE0
00000000000000FF800000003FE000000000000000FF800000003FE000000000000001FF
800000003FE000000000000001FF800000007FE000000000000001FF000000007FC00000
0000000001FF000000007FC000000000000001FF000000007FC000000000000001FF0000
00007FC000000000000003FF00000000FFC000000000000003FE00000000FF8000000000
000003FE00000000FF8000000000000003FE00000000FF8000000000000003FE00000000
FF8000000000000007FE00000001FF8000000000000007FC00000001FF00000000000000
07FC00000001FF0000000000000007FC00000001FF0000000000000007FC00000001FF00
0000000000000FFC00000003FF000000000000000FF800000003FE000000000000000FF8
00000003FE000000000000000FF800000003FE000000000000000FF800000003FE000000
000000001FF800000007FE000000000000001FF000000007FC000000000000001FF00000
0007FC000000000000001FF000000007FC000000000000001FF000000007FC0000000000
00003FF00000000FFC000000000000003FE00000000FF8000000000000003FE00000000F
F8000000000000003FE00000000FF8000000000000003FE00000000FF800000000000000
7FE00000001FF8000000000000007FC00000001FF8000000000000007FC00000001FF000
0000000000007FC00000001FF0000000000000007FC00000001FF000000000000000FFC0
0000001FF000000000000000FF800000003FF000000000000000FF800000003FE0000000
00000000FF800000003FE000000000000000FF800000003FE000000000000001FF800000
003FE000000000000001FF000000007FC000000000000001FF000000007FC00000000000
0001FF000000007FC000000000000001FF000000007FC000000000000003FF00000000FF
C000000000000003FE00000000FF8000000000000003FE00000000FF8000000000000003
FE00000000FF8000000000000003FE00000000FF8000000000000007FC00000001FF0000
000000000007FC00000001FF0000000000000007FC00000001FF0000000000000007FC00
000001FE000000000000000FF800000003FE000000000000000FF800000003FE00000000
0000000FF800000003FC000000000000000FF000000003FC000000000000000FF0000000
07FC000000000000001FF000000007F8000000000000001FE000000007F8000000000000
001FE000000007F8000000000000001FE00000000FF0000000000007803FC00780000FF0
00000000001FE03FC01FE0000FE000000000003FE03F803FE0001FE000000000007FF03F
807FF0001FC000000000007FF03F007FF0003F800000000000FFE07F00FFE0007F000000
000000FFE07E00FFE0007F000000000000FFE07E00FFE000FE000000000000FFC0FC00FF
C001FC000000000000FF80F800FF8003F80000000000007E01F8007E0007E00000000000
007C03F0007E001FC00000000000003F07E0003FC07F800000000000001FFF80000FFFFE
0000000000000007FF000003FFF80000000000000001FC0000007FC0000000000000006E
8283E456>11 D<0000000000000FFF00000000000000000000FFFFF00000000000000000
07FFFFFE00000000000000003FF803FF8000000000000000FF80007FE000000000000003
FE00001FF00000000000000FF8000007F80000000000003FE0000003FE0000000000007F
80000001FF000000000001FF00000000FF800000000003FE000000007F80000000000FF8
000000007FC0000000001FF0000000003FE0000000003FE0000000001FF0000000007FC0
000000001FF000000000FF80000000000FF800000001FF00000000000FF800000003FE00
000000000FFC00000007FE000000000007FC0000000FFC000000000007FE0000001FF800
0000000007FE0000003FF0000000000003FF0000007FF0000000000003FF000000FFE000
0000000003FF000000FFC0000000000003FF800001FFC0000000000003FF800003FF8000
0000000003FF800007FF00000000000003FF800007FF00000000000003FF80000FFE0000
0000000003FFC0000FFE00000000000003FFC0001FFC00000000000003FFC0003FFC0000
0000000003FFC0003FF800000000000003FFC0007FF800000000000003FFC0007FF00000
0000000003FFC000FFF000000000000003FFC000FFF000000000000003FFC001FFE00000
0000000003FFC001FFE000000000000003FFC003FFE000000000000003FFC003FFC00000
0000000003FFC007FFC000000000000007FFC007FFC000000000000007FFC007FF800000
0000000007FFC00FFF8000000000000007FFC00FFF8000000000000007FF800FFF000000
000000000FFF801FFF000000000000000FFF801FFF000000000000000FFF801FFF000000
000000000FFF803FFE000000000000001FFF003FFE000000000000001FFF003FFE000000
000000001FFF003FFE000000000000001FFF007FFC000000000000003FFE007FFC000000
000000003FFE007FFC000000000000003FFE007FFC000000000000007FFC007FFC000000
000000007FFC007FFC000000000000007FFC007FF800000000000000FFF800FFF8000000
00000000FFF800FFF800000000000000FFF000FFF800000000000001FFF000FFF8000000
00000001FFE000FFF800000000000003FFE000FFF800000000000003FFE000FFF8000000
00000003FFC000FFF800000000000007FF8000FFF800000000000007FF8000FFF8000000
0000000FFF0000FFF80000000000000FFF00007FF80000000000001FFE00007FF8000000
0000001FFE00007FF80000000000003FFC00007FF80000000000003FF800007FF8000000
0000007FF000003FF8000000000000FFF000003FF8000000000000FFE000003FF8000000
000001FFC000003FF8000000000003FF8000001FFC000000000003FF8000001FFC000000
000007FF0000001FFC00000000000FFE0000000FFC00000000001FFC0000000FFE000000
00003FF800000007FE00000000003FF000000007FF00000000007FE000000003FF000000
0000FFC000000001FF0000000001FF8000000001FF8000000003FE0000000000FFC00000
0007FC00000000007FC00000001FF800000000003FE00000003FE000000000001FF00000
007FC000000000000FF8000001FF00000000000007FC000007FE00000000000003FF0000
1FF800000000000000FFC0007FE0000000000000003FF803FF80000000000000000FFFFF
FC000000000000000003FFFFE00000000000000000003FFC000000000000005A686BE46C
>79 D E /FH 22 118 df<0F003FC07FE0FFE0FFF0FFF0FFF0FFF8FFF87FF83FF80F3800
380038003800380038003800380078007800700070007000F000E000E001E001C003C003
80078007000F001E001E003C007800700030000D28748B24>44 D<00000000000F000000
00000000000000000F00000000000000000000000F00000000000000000000001F800000
00000000000000001F80000000000000000000003FC0000000000000000000003FC00000
00000000000000003FC0000000000000000000007FE0000000000000000000007FE00000
00000000000000007FE000000000000000000000FFF000000000000000000000FFF00000
0000000000000000FFF000000000000000000001FFF800000000000000000001DFF80000
0000000000000001DFF8000000000000000000039FFC000000000000000000038FFC0000
00000000000000038FFC000000000000000000070FFE0000000000000000000707FE0000
000000000000000F07FF0000000000000000000E03FF0000000000000000000E03FF0000
000000000000001E03FF8000000000000000001C01FF8000000000000000001C01FF8000
000000000000003C01FFC000000000000000003800FFC000000000000000003800FFC000
000000000000007000FFE0000000000000000070007FE0000000000000000070007FE000
00000000000000E0007FF00000000000000000E0003FF00000000000000000E0003FF000
00000000000001C0003FF80000000000000001C0001FF80000000000000003C0001FFC00
0000000000000380000FFC000000000000000380000FFC000000000000000780000FFE00
00000000000007000007FE0000000000000007000007FE000000000000000F000007FF00
0000000000000E000003FF000000000000000E000003FF000000000000001C000003FF80
0000000000001C000001FF800000000000001C000001FF8000000000000038000001FFC0
00000000000038000000FFC000000000000038000000FFC000000000000070000000FFE0
000000000000700000007FE0000000000000F00000007FF0000000000000E00000003FF0
000000000000E00000003FF0000000000001E00000003FF8000000000001C00000001FF8
000000000001C00000001FF8000000000003C00000001FFC000000000003FFFFFFFFFFFC
000000000003FFFFFFFFFFFC000000000007FFFFFFFFFFFE000000000007FFFFFFFFFFFE
0000000000070000000007FE00000000000E0000000007FF00000000000E0000000003FF
00000000000E0000000003FF00000000001C0000000003FF80000000001C0000000001FF
80000000003C0000000001FFC000000000380000000000FFC000000000380000000000FF
C000000000780000000000FFE0000000007000000000007FE0000000007000000000007F
E000000000F000000000007FF000000000E000000000003FF000000000E000000000003F
F000000001C000000000003FF800000001C000000000001FF800000001C000000000001F
F8000000038000000000001FFC000000038000000000000FFC000000038000000000000F
FC000000070000000000000FFE0000000700000000000007FE0000000F00000000000007
FF0000000F00000000000003FF0000001F00000000000003FF0000003F80000000000003
FF8000007FC0000000000003FF800001FFE0000000000007FFC0000FFFF800000000001F
FFF000FFFFFF0000000007FFFFFFF0FFFFFF0000000007FFFFFFF0FFFFFF0000000007FF
FFFFF0FFFFFF0000000007FFFFFFF05C657DE463>65 D<FFFFFFFFFFFFF000000000FFFF
FFFFFFFFFF00000000FFFFFFFFFFFFFFE0000000FFFFFFFFFFFFFFF800000000FFFC0000
007FFE000000003FF80000000FFF800000001FF800000001FFC00000001FF8000000007F
F00000001FF8000000001FF80000001FF8000000000FFC0000001FF80000000003FE0000
001FF80000000001FF0000001FF80000000000FF8000001FF800000000007FC000001FF8
00000000003FE000001FF800000000001FF000001FF800000000000FF000001FF8000000
00000FF800001FF8000000000007FC00001FF8000000000003FC00001FF8000000000003
FE00001FF8000000000001FF00001FF8000000000001FF00001FF8000000000000FF8000
1FF8000000000000FF80001FF80000000000007FC0001FF80000000000007FC0001FF800
00000000007FE0001FF80000000000003FE0001FF80000000000003FE0001FF800000000
00003FF0001FF80000000000003FF0001FF80000000000001FF0001FF80000000000001F
F8001FF80000000000001FF8001FF80000000000001FF8001FF80000000000001FFC001F
F80000000000001FFC001FF80000000000000FFC001FF80000000000000FFC001FF80000
000000000FFC001FF80000000000000FFC001FF80000000000000FFE001FF80000000000
000FFE001FF80000000000000FFE001FF80000000000000FFE001FF80000000000000FFE
001FF80000000000000FFE001FF80000000000000FFE001FF80000000000000FFE001FF8
0000000000000FFE001FF80000000000000FFE001FF80000000000000FFE001FF8000000
0000000FFE001FF80000000000000FFE001FF80000000000000FFE001FF8000000000000
0FFE001FF80000000000000FFC001FF80000000000000FFC001FF80000000000000FFC00
1FF80000000000000FFC001FF80000000000000FFC001FF80000000000001FFC001FF800
00000000001FF8001FF80000000000001FF8001FF80000000000001FF8001FF800000000
00001FF8001FF80000000000003FF0001FF80000000000003FF0001FF80000000000003F
E0001FF80000000000003FE0001FF80000000000007FE0001FF80000000000007FC0001F
F8000000000000FFC0001FF8000000000000FF80001FF8000000000000FF80001FF80000
00000001FF00001FF8000000000001FF00001FF8000000000003FE00001FF80000000000
07FC00001FF8000000000007FC00001FF800000000000FF800001FF800000000001FF000
001FF800000000003FE000001FF800000000007FC000001FF80000000000FFC000001FF8
0000000001FF8000001FF80000000003FF0000001FF80000000007FC0000001FF8000000
001FF80000001FF8000000007FF00000001FF800000001FFC00000003FF800000007FF80
000000FFFC0000007FFE000000FFFFFFFFFFFFFFF8000000FFFFFFFFFFFFFFE0000000FF
FFFFFFFFFFFF00000000FFFFFFFFFFFFF000000000576279E165>68
D<3FFFFFFFFFFFFFFFFFFFF83FFFFFFFFFFFFFFFFFFFF83FFFFFFFFFFFFFFFFFFFF83FFF
FFFFFFFFFFFFFFFFF83FFFC00003FFC00003FFF83FFC000001FF8000007FF83FF0000001
FF8000000FF83FC0000001FF80000007F87F80000001FF80000003FC7F00000001FF8000
0001FC7E00000001FF80000000FC7C00000001FF800000007C7C00000001FF800000007C
7C00000001FF800000007C7800000001FF800000003C7800000001FF800000003C780000
0001FF800000003C7800000001FF800000003C7000000001FF800000001C7000000001FF
800000001C7000000001FF800000001C7000000001FF800000001C7000000001FF800000
001C7000000001FF800000001CF000000001FF800000001EE000000001FF800000000EE0
00000001FF800000000EE000000001FF800000000EE000000001FF800000000EE0000000
01FF800000000EE000000001FF800000000EE000000001FF800000000E0000000001FF80
000000000000000001FF80000000000000000001FF80000000000000000001FF80000000
000000000001FF80000000000000000001FF80000000000000000001FF80000000000000
000001FF80000000000000000001FF80000000000000000001FF80000000000000000001
FF80000000000000000001FF80000000000000000001FF80000000000000000001FF8000
0000000000000001FF80000000000000000001FF80000000000000000001FF8000000000
0000000001FF80000000000000000001FF80000000000000000001FF8000000000000000
0001FF80000000000000000001FF80000000000000000001FF80000000000000000001FF
80000000000000000001FF80000000000000000001FF80000000000000000001FF800000
00000000000001FF80000000000000000001FF80000000000000000001FF800000000000
00000001FF80000000000000000001FF80000000000000000001FF800000000000000000
01FF80000000000000000001FF80000000000000000001FF80000000000000000001FF80
000000000000000001FF80000000000000000001FF80000000000000000001FF80000000
000000000001FF80000000000000000001FF80000000000000000001FF80000000000000
000001FF80000000000000000001FF80000000000000000001FF80000000000000000001
FF80000000000000000001FF80000000000000000001FF80000000000000000001FF8000
0000000000000001FF80000000000000000001FF80000000000000000001FF8000000000
0000000001FF80000000000000000001FF80000000000000000001FF8000000000000000
0001FF80000000000000000001FF80000000000000000001FF80000000000000000003FF
C0000000000000000003FFC000000000000000001FFFF800000000000001FFFFFFFFFF80
0000000001FFFFFFFFFF800000000001FFFFFFFFFF800000000001FFFFFFFFFF80000057
627CE160>84 D<00003FF0000000000003FFFE00000000000FFFFF80000000003FC03FE0
000000007E0007F800000000F80003FC00000001E00001FE00000003C00000FF00000007
8000007F8000000F0000003FC000000F8000003FC000000FF000001FE000001FF800001F
E000001FFC00000FF000001FFC00000FF000001FFC00000FF000001FFC000007F800001F
FC000007F800001FFC000007F800000FF8000007F8000003E0000007F800000000000007
F800000000000007F800000000000007F800000000000007F800000000000007F8000000
00000007F80000000000007FF800000000007FFFF8000000000FFFFFF8000000007FF807
F800000001FF8007F800000007FC0007F80000001FF00007F80000007FC00007F8000000
FF800007F8000003FE000007F8000007FC000007F800000FFC000007F800000FF8000007
F800001FF0000007F800003FE0000007F800003FE0000007F800007FC0000007F800E07F
C0000007F800E07FC0000007F800E0FFC0000007F800E0FF80000007F800E0FF80000007
F800E0FF8000000FF800E0FF8000000FF800E0FF8000000FF800E0FF8000001FF800E0FF
C000001BF800E07FC000003BF800E07FC0000073F800E07FE0000071FC01C03FF00000E1
FC01C01FF00001C1FC01C00FFC000780FE038007FE000F00FF070001FF807E007FFF0000
7FFFF8003FFE00001FFFE0001FF8000001FF000007E0003B417ABF42>97
D<0003C000000000000007FFC0000000000000FFFFC0000000000000FFFFC00000000000
00FFFFC0000000000000FFFFC000000000000001FFC0000000000000007FC00000000000
00007FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0000000000000003FC0000000000000003FC00000000000
00003FC0000000000000003FC0007FC0000000003FC007FFFC000000003FC01FFFFF0000
00003FC07F007FC00000003FC0F8000FF00000003FC3E00007F80000003FC7800001FC00
00003FCF000000FE0000003FDE0000007F0000003FFC0000003F8000003FF80000003FC0
00003FF00000001FE000003FF00000000FE000003FE00000000FF000003FE000000007F8
00003FC000000007F800003FC000000003FC00003FC000000003FC00003FC000000003FE
00003FC000000001FE00003FC000000001FE00003FC000000001FF00003FC000000001FF
00003FC000000001FF00003FC000000000FF00003FC000000000FF80003FC000000000FF
80003FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000000FF
80003FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000000FF
80003FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000000FF
00003FC000000001FF00003FC000000001FF00003FC000000001FF00003FC000000001FF
00003FC000000001FE00003FC000000003FE00003FC000000003FC00003FC000000003FC
00003FC000000007FC00003FC000000007F800003FE000000007F000003FE00000000FF0
00003FF00000001FE000003FF80000001FC000003FB80000003FC000003F3C0000007F80
00003F1E000000FF0000003F0F000001FE0000003E07800003FC0000003E03C0000FF000
00003C01F0001FE00000003C007E00FF800000003C003FFFFE0000000038000FFFF80000
0000000000FF8000000041657DE349>I<0000000000001E000000000000003FFE000000
00000007FFFE00000000000007FFFE00000000000007FFFE00000000000007FFFE000000
000000000FFE0000000000000003FE0000000000000003FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000000001FE000000
0000000001FE0000000000000001FE0000000000000001FE0000000000FF8001FE000000
000FFFF801FE000000003FFFFE01FE00000000FF803F81FE00000003FC0007C1FE000000
07F80001E1FE0000001FE00000F9FE0000003FC000007DFE0000007F8000003DFE000000
FF0000001FFE000001FE0000000FFE000001FC00000007FE000003FC00000007FE000007
F800000003FE000007F000000001FE00000FF000000001FE00001FF000000001FE00001F
E000000001FE00001FE000000001FE00003FE000000001FE00003FC000000001FE00007F
C000000001FE00007FC000000001FE00007FC000000001FE00007FC000000001FE00007F
8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF
8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF
8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF8000000001FE0000FF
8000000001FE0000FF8000000001FE00007F8000000001FE00007FC000000001FE00007F
C000000001FE00007FC000000001FE00003FC000000001FE00003FC000000001FE00003F
E000000001FE00001FE000000001FE00001FE000000001FE00000FF000000003FE00000F
F000000003FE000007F800000007FE000003F800000007FE000003FC0000000FFE000001
FE0000001FFE000000FE0000003DFE0000007F0000003DFE0000003F800000F9FF000000
1FC00001F1FF0000000FF00003C1FFC0000007F8000F81FFFF800001FF007F01FFFF8000
007FFFFC01FFFF8000001FFFE001FFFF80000001FF0001FF000041657CE349>100
D<000003FE00000000001FFFE000000000FFFFF800000001FE03FE00000007F0007F8000
000FE0003FC000003FC0001FE000007F00000FF00000FF000007F80000FE000003F80001
FC000003FC0003F8000001FC0007F8000001FE0007F0000000FE000FF0000000FF000FF0
0000007F001FE00000007F001FE00000007F803FE00000007F803FC00000003F803FC000
00003F807FC00000003FC07FC00000003FC07FC00000003FC07F800000003FC07F800000
003FC0FF800000003FC0FFFFFFFFFFFFC0FFFFFFFFFFFFC0FFFFFFFFFFFFC0FF80000000
0000FF800000000000FF800000000000FF800000000000FF800000000000FF8000000000
00FF800000000000FF800000000000FF8000000000007F8000000000007FC00000000000
7FC000000000007FC000000000003FC000000000003FC000000000003FE000000000001F
E000000000001FE000000001C00FF000000001C00FF000000003C007F8000000038007F8
000000038003FC000000078001FC0000000F0001FE0000000E0000FF0000001E00007F80
00003C00003FC000007800001FE00000F0000007F00003E0000003FC0007C0000000FF80
3F000000003FFFFC000000000FFFF00000000001FF80000032417CBF3A>I<0000000FF0
000000007FFC00000001FFFF00000007F81F8000000FE00FC000001FC03FC000003F807F
E000007F007FE00000FF007FE00001FE007FE00001FC007FE00003FC003FC00003FC003F
C00007F8000F000007F80000000007F8000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000FFFFFFFFF000FFFFFFFFF000FFFFFFFFF000FFFFFFFFF0
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF00000
00000FF0000000000FF0000000000FF0000000000FF0000000001FF8000000003FFE0000
003FFFFFFF00003FFFFFFF00003FFFFFFF00003FFFFFFF00002B657EE428>I<00000000
00003F80000003FC0001FFE000003FFFC007FFF00000FFFFF01FC1F80003FC03FC3E03F8
0007F000FE7803F8000FE0007FE003F8001FC0003FC003F8003F80001FC001F0007F0000
0FE0000000FE000007F0000000FE000007F0000001FC000003F8000001FC000003F80000
03FC000003FC000003FC000003FC000003F8000001FC000007F8000001FE000007F80000
01FE000007F8000001FE000007F8000001FE000007F8000001FE000007F8000001FE0000
07F8000001FE000007F8000001FE000007F8000001FE000007F8000001FE000003F80000
01FC000003FC000003FC000003FC000003FC000001FC000003F8000001FC000003F80000
00FE000007F0000000FE000007F00000007F00000FE00000003F80001FC00000001FC000
3F800000003FE0007F0000000037F000FE0000000073FC03FC0000000060FFFFF0000000
00E03FFFC000000000E003FC0000000001C000000000000001C000000000000001C00000
0000000001C000000000000001C000000000000001E000000000000001E0000000000000
01F000000000000001F000000000000001F800000000000000FC00000000000000FF0000
0000000000FFFFFFFE000000007FFFFFFFF00000003FFFFFFFFE0000001FFFFFFFFF8000
000FFFFFFFFFE000000FFFFFFFFFF000003FFFFFFFFFFC0000FE000001FFFE0003F80000
001FFE0007E000000003FF000FC000000000FF801F80000000007F803F80000000003FC0
3F00000000001FC07E00000000001FC07E00000000000FE0FE00000000000FE0FC000000
000007E0FC000000000007E0FC000000000007E0FC000000000007E0FC000000000007E0
FC000000000007E0FE00000000000FE07E00000000000FC07E00000000000FC07F000000
00001FC03F80000000003F801FC0000000007F000FC0000000007E0007F000000001FC00
03F800000003F80001FC00000007F000007F0000001FC000003FE00000FF8000000FFE00
0FFE00000001FFFFFFF0000000003FFFFF800000000001FFF00000003D5E7DBF42>I<00
03C000000000000007FFC0000000000000FFFFC0000000000000FFFFC0000000000000FF
FFC0000000000000FFFFC000000000000001FFC0000000000000007FC000000000000000
7FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0007FE0000000003FC003FFFC000000003FC00FFFFF00000000
3FC03F00FFC00000003FC078001FE00000003FC0F0000FF00000003FC1C00007F8000000
3FC3800007FC0000003FC7000003FC0000003FCE000003FE0000003FCE000001FE000000
3FDC000001FE0000003FD8000001FE0000003FF8000000FF0000003FF0000000FF000000
3FF0000000FF0000003FF0000000FF0000003FE0000000FF0000003FE0000000FF000000
3FE0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF000000
3FC0000000FF0000003FC0000000FF0000007FE0000001FF800000FFF0000003FFC000FF
FFFFF003FFFFFFC0FFFFFFF003FFFFFFC0FFFFFFF003FFFFFFC0FFFFFFF003FFFFFFC042
647DE349>I<003C000000FF000001FF800003FFC00003FFC00003FFC00003FFC00003FF
C00003FFC00001FF800000FF0000003C0000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000003C00007FFC0007FFF
C0007FFFC0007FFFC0007FFFC00001FFC000007FC000007FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000007FE00000FFF000FFFFFFE0FFFFFFE0FFFFFFE0FFFFFFE01B5F7DDE23>I<0003C0
000000000007FFC00000000000FFFFC00000000000FFFFC00000000000FFFFC000000000
00FFFFC0000000000001FFC00000000000007FC00000000000007FC00000000000003FC0
0000000000003FC00000000000003FC00000000000003FC00000000000003FC000000000
00003FC00000000000003FC00000000000003FC00000000000003FC00000000000003FC0
0000000000003FC00000000000003FC00000000000003FC00000000000003FC000000000
00003FC00000000000003FC00000000000003FC00000000000003FC00000000000003FC0
0000000000003FC00000000000003FC00000000000003FC00000000000003FC000000000
00003FC00000000000003FC00000000000003FC00000000000003FC00000000000003FC0
0000000000003FC00000000000003FC00003FFFFF8003FC00003FFFFF8003FC00003FFFF
F8003FC00003FFFFF8003FC00000FFFF80003FC000007FFC00003FC000007FE000003FC0
00007FC000003FC000007F0000003FC000007E0000003FC00000FC0000003FC00000F000
00003FC00001E00000003FC00003C00000003FC00007800000003FC0000F000000003FC0
003E000000003FC0007C000000003FC000F8000000003FC001F0000000003FC003E00000
00003FC007C0000000003FC00F80000000003FC01F80000000003FC03FC0000000003FC0
7FE0000000003FC0FFE0000000003FC1FFF0000000003FC3CFF8000000003FC787F80000
00003FCF07FC000000003FFE03FE000000003FFC01FE000000003FF801FF000000003FF0
00FF800000003FE0007F800000003FC0007FC00000003FC0003FE00000003FC0001FE000
00003FC0001FF00000003FC0000FF80000003FC00007F80000003FC00007FC0000003FC0
0003FE0000003FC00001FE0000003FC00001FF0000003FC00000FF8000003FC000007F80
00003FC000007FC000003FC000003FE000003FC000001FE000003FC000001FF000003FC0
00000FF800003FC000000FFC00003FC000000FFC00003FC000000FFE00007FE000000FFF
8000FFF000001FFFE0FFFFFFF000FFFFFFFFFFFFF000FFFFFFFFFFFFF000FFFFFFFFFFFF
F000FFFFFF40647CE346>107 D<0003C00007FFC000FFFFC000FFFFC000FFFFC000FFFF
C00001FFC000007FC000007FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003FC000003F
C000003FC000003FC000003FC000003FC000003FC000003FC000003FC000007FE00000FF
F000FFFFFFF0FFFFFFF0FFFFFFF0FFFFFFF01C647DE323>I<0003C000FFC0000007FE00
000007FFC003FFF800001FFFC00000FFFFC00FFFFE00007FFFF00000FFFFC03F00FF8001
F807FC0000FFFFC078003FC003C001FE0000FFFFC1E0001FE00F0000FF000001FFC3C000
0FF01E00007F8000007FC3800007F81C00003FC000007FC7000007F83800003FC000003F
CE000003FC7000001FE000003FCC000003FC6000001FE000003FDC000003FCE000001FE0
00003FD8000003FCC000001FE000003FF8000001FFC000000FF000003FF0000001FF8000
000FF000003FF0000001FF8000000FF000003FE0000001FF0000000FF000003FE0000001
FF0000000FF000003FE0000001FF0000000FF000003FE0000001FF0000000FF000003FC0
000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000
003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE000000
0FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE
0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC000
0001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF00000
3FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000F
F000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE00
00000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC00000
01FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003F
C0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF0
00003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000
000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0000001
FE0000000FF000003FC0000001FE0000000FF000003FC0000001FE0000000FF000003FC0
000001FE0000000FF000007FE0000003FF0000001FF80000FFF0000007FF8000003FFC00
FFFFFFF007FFFFFF803FFFFFFCFFFFFFF007FFFFFF803FFFFFFCFFFFFFF007FFFFFF803F
FFFFFCFFFFFFF007FFFFFF803FFFFFFC663F7CBE6F>I<0003C0007FE000000007FFC003
FFFC000000FFFFC00FFFFF000000FFFFC03F00FFC00000FFFFC078001FE00000FFFFC0F0
000FF0000001FFC1C00007F80000007FC3800007FC0000007FC7000003FC0000003FCE00
0003FE0000003FCE000001FE0000003FDC000001FE0000003FD8000001FE0000003FF800
0000FF0000003FF0000000FF0000003FF0000000FF0000003FF0000000FF0000003FE000
0000FF0000003FE0000000FF0000003FE0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC000
0000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000007FE000
0001FF800000FFF0000003FFC000FFFFFFF003FFFFFFC0FFFFFFF003FFFFFFC0FFFFFFF0
03FFFFFFC0FFFFFFF003FFFFFFC0423F7DBE49>I<000000FF8000000000000FFFF80000
0000003FFFFE0000000000FF007F8000000003FC001FE000000007F00007F00000000FC0
0001F80000003F800000FE0000007F0000007F0000007E0000003F000000FC0000001F80
0001F80000000FC00003F80000000FE00003F000000007E00007F000000007F0000FE000
000003F8000FE000000003F8001FE000000003FC001FC000000001FC001FC000000001FC
003FC000000001FE003FC000000001FE003FC000000001FE007F8000000000FF007F8000
000000FF007F8000000000FF007F8000000000FF00FF8000000000FF80FF8000000000FF
80FF8000000000FF80FF8000000000FF80FF8000000000FF80FF8000000000FF80FF8000
000000FF80FF8000000000FF80FF8000000000FF80FF8000000000FF80FF8000000000FF
80FF8000000000FF807F8000000000FF007F8000000000FF007FC000000001FF007FC000
000001FF003FC000000001FE003FC000000001FE003FC000000001FE001FE000000003FC
001FE000000003FC001FE000000003FC000FF000000007F80007F000000007F00007F000
000007F00003F80000000FE00001FC0000001FC00001FC0000001FC00000FE0000003F80
00007F0000007F0000003F800000FE0000001FC00001FC0000000FF00007F800000003FC
001FE000000000FF007F80000000007FFFFF00000000000FFFF8000000000001FFC00000
0039417CBF42>I<0003C0007FC000000007FFC007FFFC000000FFFFC01FFFFF000000FF
FFC07F00FFC00000FFFFC0F8001FF00000FFFFC3E00007F8000001FFC7800003FC000000
7FCF000001FE0000007FDE000000FF0000003FFC0000007F8000003FF80000003FC00000
3FF00000003FE000003FF00000001FE000003FE00000001FF000003FE00000000FF80000
3FC00000000FF800003FC000000007FC00003FC000000007FC00003FC000000003FE0000
3FC000000003FE00003FC000000003FE00003FC000000001FF00003FC000000001FF0000
3FC000000001FF00003FC000000001FF00003FC000000001FF80003FC000000000FF8000
3FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000000FF8000
3FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000000FF8000
3FC000000000FF80003FC000000000FF80003FC000000000FF80003FC000000001FF0000
3FC000000001FF00003FC000000001FF00003FC000000001FF00003FC000000001FF0000
3FC000000003FE00003FC000000003FE00003FC000000003FC00003FC000000007FC0000
3FC000000007FC00003FC00000000FF800003FE00000000FF000003FE00000001FF00000
3FF00000003FE000003FF80000003FC000003FF80000007FC000003FFC000000FF800000
3FDE000001FF0000003FCF000003FE0000003FC7800007FC0000003FC3C0000FF0000000
3FC1F0003FE00000003FC07E01FF800000003FC03FFFFE000000003FC00FFFF800000000
3FC000FF80000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000003FC0000000000000003FC000000000000000
3FC0000000000000003FC0000000000000007FE000000000000000FFF0000000000000FF
FFFFF00000000000FFFFFFF00000000000FFFFFFF00000000000FFFFFFF0000000000041
5B7DBE49>I<00078003F80007FF800FFF00FFFF803FFFC0FFFF807C0FE0FFFF81F01FE0
FFFF81E03FF001FF83803FF0007F87003FF0007F8F003FF0003F8E003FF0003F9C001FE0
003F9C000FC0003F98000300003FB8000000003FB8000000003FB0000000003FF0000000
003FF0000000003FE0000000003FE0000000003FE0000000003FE0000000003FE0000000
003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000
003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000
003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000
003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000
003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000003FC0000000
003FC0000000003FC0000000003FC0000000003FC0000000007FE000000000FFF8000000
FFFFFFFC0000FFFFFFFC0000FFFFFFFC0000FFFFFFFC00002C3F7CBE33>114
D<0000FFE00180000FFFFC0380007FFFFF078001FF001FCF8003F80003EF8007E00001FF
800FC00000FF801F8000007F803F0000003F803E0000001F807E0000000F807C0000000F
807C0000000F80FC0000000780FC0000000780FC0000000780FC0000000380FE00000003
80FE0000000380FF0000000380FF80000003807FC0000003807FE0000000007FF8000000
003FFE000000001FFFF00000000FFFFF80000007FFFFF8000003FFFFFF000001FFFFFFC0
00007FFFFFF000001FFFFFF8000007FFFFFE0000007FFFFF00000003FFFF800000003FFF
C000000003FFC000000000FFE0000000007FE0E00000001FF0E00000000FF0E00000000F
F8F000000007F8F000000003F8F000000003F8F000000003F8F800000001F8F800000001
F8F800000001F8FC00000001F8FC00000001F8FE00000001F0FE00000003F0FF00000003
F0FF00000003E0FF80000007E0FFC000000FC0FFE000000F80FDF000001F80F8F800007F
00F83E0000FC00F01FC00FF800F007FFFFE000E001FFFF8000C0003FF800002D417DBF34
>I<00003800000000003800000000003800000000003800000000003800000000003800
00000000380000000000780000000000780000000000780000000000780000000000F800
00000000F80000000000F80000000001F80000000001F80000000001F80000000003F800
00000003F80000000007F8000000000FF8000000001FF8000000001FF8000000007FF800
000000FFF800000003FFF80000000FFFFFFFFF00FFFFFFFFFF00FFFFFFFFFF00FFFFFFFF
FF000007F80000000007F80000000007F80000000007F80000000007F80000000007F800
00000007F80000000007F80000000007F80000000007F80000000007F80000000007F800
00000007F80000000007F80000000007F80000000007F80000000007F80000000007F800
00000007F80000000007F80000000007F80000000007F80000000007F80000000007F800
00000007F80000000007F80000000007F80000000007F80000000007F80000000007F800
00000007F80000000007F80000000007F80000E00007F80000E00007F80000E00007F800
00E00007F80000E00007F80000E00007F80000E00007F80000E00007F80000E00007F800
00E00007F80000E00007F80000E00007F80000E00007F80000E00003FC0001C00003FC00
01C00003FC0001C00003FC0003C00001FE0003800001FE0007800000FF00070000007F80
0F0000003FC01E0000001FF07C0000000FFFF800000003FFE0000000007F80002B597FD7
33>I<0003C00000000F000007FFC000001FFF0000FFFFC00003FFFF0000FFFFC00003FF
FF0000FFFFC00003FFFF0000FFFFC00003FFFF000001FFC0000007FF0000007FC0000001
FF0000007FC0000001FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000FF0000003FC0000000
FF0000003FC0000000FF0000003FC0000001FF0000003FC0000001FF0000003FC0000001
FF0000003FC0000003FF0000003FC0000003FF0000003FC0000003FF0000003FC0000007
FF0000001FC0000006FF0000001FE000000EFF0000001FE000001CFF0000000FE000001C
FF0000000FF0000038FF80000007F0000070FF80000003F80001E0FFE0000001FE0003C0
FFFFC00000FFC01F80FFFFC000003FFFFE00FFFFC000000FFFF800FFFFC0000000FFC000
FF800042407DBE49>I E end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4

userdict/PStoPSxform PStoPSmatrix matrix currentmatrix
 matrix invertmatrix matrix concatmatrix
 matrix invertmatrix put
%%EndSetup
%%Page: (0,1) 1
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
1 0 bop 736 2095 a FH(The)44 b(design)g(and)g(implemen)l(tation)i(of)c
FG(O\013)30 b FF(++)p FH(,)1010 2277 y(a)43 b(Distributed)j(Adaptable)f
(k)l(ernel)729 2643 y FD(F)-8 b(rancisco)32 b(J.)h(Ballesteros)122
b(F)-8 b(abio)31 b(Kon)123 b(Ro)m(y)33 b(H.)g(Campb)s(ell)729
2806 y FC(nemo@gsyc.inf.uc3m.es)189 b FB(f)p FC(f-kon,roy)p
FB(g)p FC(@cs.uiuc.edu)1666 3042 y FD(August,)33 b(1997)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
1 1 bop 1764 1813 a FA(Abstract)515 1995 y Fz(The)20
b Fy(O\013)d Fx(++)j Fz(distributed)h(adaptable)e Fw(\026)p
Fz(k)n(ernel)h(is)g(a)g(minimal)g Fw(\026)p Fz(k)n(ernel)g(whose)f
(only)h(task)g(is)515 2095 y(to)k(safely)g(m)n(ultiplex)h(and)g(exp)r
(ort)f(the)h(distributed)g(hardw)n(are)e(presen)n(t)h(in)g(the)h(net)n
(w)n(ork.)515 2195 y(It)k(is)g(designed)f(to)h(b)r(e)h(used)e(as)h(a)f
(basis)h(for)f(distributed)h(user-lev)n(el)f(OS)g(services.)40
b(This)515 2294 y(tec)n(hnical)27 b(rep)r(ort)g(describ)r(es)g(the)h
(design)f(and)g(implemen)n(tation)h(of)g Fy(O\013)17
b Fx(++)p Fz(,)27 b(the)h(ob)5 b(ject-)515 2394 y(orien)n(ted)35
b(redesign)f(of)i(the)g(O\013)f Fw(\026)p Fz(k)n(ernel)g([2,)h(3)o(].)
61 b Fy(O\013)17 b Fx(++)35 b Fz(extends)h(the)g(functionalities)515
2493 y(pro)n(vided)27 b(b)n(y)g(O\013)h(in)h(order)d(to)i(pro)n(vide)f
(basic)g(supp)r(ort)h(for)g(the)g Fy(2K)40 b Fz(op)r(erating)27
b(system)515 2593 y([5)o(])i(w)n(e)f(are)g(curren)n(tly)f(building.)40
b(This)29 b(do)r(cumen)n(t)f(is)h(mean)n(t)f(to)g(b)r(e)h(the)g
(starting)f(p)r(oin)n(t)515 2693 y(for)f(the)h(system)f(literate)g
(implemen)n(tation.)p eop
PStoPSsaved restore
%%Page: (2,3) 2
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
1 2 bop 515 1187 a Fv(Con)-6 b(ten)g(ts)515 1702 y FA(1)76
b(In)m(tro)s(duction)2166 b(8)639 1802 y Fz(1.1)84 b(Motiv)-5
b(ation)83 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)131
b(8)639 1901 y(1.2)84 b(The)28 b(O\013)g Fw(\026)p Fz(k)n(ernel)h(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)131 b(9)830 2001
y(1.2.1)94 b(Sh)n(uttles.)37 b(Distributed)29 b(Pro)r(cess)c(Services)
56 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)131
b(9)830 2100 y(1.2.2)94 b(P)n(ortals.)35 b(In)n(terpro)r(cess)26
b(comm)n(unication)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
131 b(9)830 2200 y(1.2.3)94 b(D-TLBs.)36 b(Distributed)29
b(Memory)d(Managemen)n(t)44 b(.)e(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(10)639 2300 y(1.3)84 b(Literate)27 b(programming)66
b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(10)639 2399 y(1.4)84
b(Ho)n(w)27 b(to)h(read)f(this)g(do)r(cumen)n(t)69 b(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)90 b(11)639 2499 y(1.5)84 b(T)-7 b(o)r(ols)27
b(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(12)515 2682 y FA(2)76 b(System)31 b(structure)1929
b(13)639 2781 y Fz(2.1)84 b(The)28 b(k)n(ernel)f(mo)r(dules)g(and)h
(the)g(source)e(hiearc)n(h)n(y)39 b(.)i(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)90 b(13)830 2881 y(2.1.1)k(The)28 b(k)n(ernel)e(library)72
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)90 b(13)830 2980 y(2.1.2)k(The)28
b(source)e(co)r(de)h(hierarc)n(h)n(y)36 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(13)639
3080 y(2.2)84 b(Exp)r(orting)27 b(system)g(ob)5 b(jects)71
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)90 b(14)830 3180 y(2.2.1)k(T)-7 b(raps)27
b(and)g(the)h(OO)f(mo)r(del)75 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(14)639 3279 y(2.3)84
b(Resource)27 b(building)g(blo)r(c)n(ks)32 b(.)42 b(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(15)830 3379 y(2.3.1)k(Protection)27 b(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)90 b(16)830 3479 y(2.3.2)k(Reference)27 b(coun)n(ting)42
b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)90 b(23)830 3578 y(2.3.3)k(Sync)n(hronizing)26
b(system)i(resources)41 b(.)g(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)90 b(25)830 3678 y(2.3.4)k(Sequencers)77
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(35)830 3778
y(2.3.5)k(In)n(tegrit)n(y)26 b(c)n(hec)n(ks)31 b(.)41
b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)90 b(36)639 3877 y(2.4)84 b(System)28
b(resources)54 b(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(39)830 3977 y(2.4.1)k(System)28 b(resource)d(o)n(v)n(erview)61
b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)
h(.)90 b(39)830 4076 y(2.4.2)k(Iden)n(ti\014ers)47 b(.)42
b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(49)830 4176 y(2.4.3)k(Con)n
(tainers)26 b(and)h(resource)f(units)35 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(53)830 4276
y(2.4.4)k(Resource)26 b(a)n(v)-5 b(ailabilit)n(y)45 b(.)d(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(63)830 4375 y(2.4.5)k(F)-7 b(reezing)27 b(resources)71
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)90 b(64)830 4475 y(2.4.6)k(Arc)n(hitecture)27
b(a)n(w)n(areness)e(supp)r(ort)39 b(.)i(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)90 b(73)830 4575 y(2.4.7)k(Resource)26
b(Allo)r(cators)72 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(81)830 4674 y(2.4.8)k(Resource)
26 b(rev)n(o)r(cation)65 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(82)830
4774 y(2.4.9)k(Allo)r(cation)27 b(statistics)74 b(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)90 b(84)830 4873 y(2.4.10)52 b(Allo)r(cators)26
b(used)i(in)g(the)g(k)n(ernel)73 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(86)639 4973 y(2.5)84
b(Hardw)n(are)26 b(resources)j(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(116)1926 5255 y(1)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
2 3 bop 830 523 a Fz(2.5.1)94 b(Hardw)n(are)26 b(resources)f(for)i
(plain)h(users)60 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)48 b(118)830 623 y(2.5.2)94 b(Hardw)n(are)26 b(resources)f
Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)67 b(.)41 b(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)48 b(119)639 722 y(2.6)84 b(Abstract)28
b(resources)63 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(121)830 822 y(2.6.1)94 b(Abstract)27 b(resources)f(for)h(plain)g
(users)j(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(123)830 922 y(2.6.2)94 b(Abstract)27 b(resources)f
Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)36 b(.)42 b(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(124)639 1021 y(2.7)84
b(Resource)27 b(unit)h(a)n(v)-5 b(ailabilit)n(y:)35 b(Relo)r(cation)27
b(tables)32 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(125)830 1121 y(2.7.1)94 b(Relo)r(cation)27 b(hash)g(tables)39
b(.)j(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(126)830 1220 y(2.7.2)94 b(Deliv)n(ering)27
b(Missing)g(exceptions)42 b(.)g(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)48 b(132)830 1320 y(2.7.3)94 b(Relo)r(cation)27
b(tables)g Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)83
b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(133)639 1420 y(2.8)84 b(Domains)27 b(and)h(resource)e(allo)r(cation)
70 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(135)639 1519 y(2.9)84 b(Compilation)27 b(information)34
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(136)515 1702 y FA(3)76 b(The)32
b(no)s(de)2201 b(138)639 1802 y Fz(3.1)84 b(The)28 b(no)r(de)g(in)n
(terface)57 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(138)639
1901 y(3.2)84 b(Na)n(vigation)20 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(141)830 2001 y(3.2.1)94 b(The)28
b(no)r(de)f(na)n(vigator)80 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(144)830
2100 y(3.2.2)94 b(The)28 b(no)r(de)f(insp)r(ector)i(.)41
b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)48 b(149)830 2200 y(3.2.3)94 b(No)r(de)28
b(na)n(vigation)e Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)49
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(151)639 2300 y(3.3)84 b(No)r(des)28 b(for)f(plain)g(users)37
b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(152)639 2399 y(3.4)84
b(No)r(de)28 b Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)76
b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(165)639 2499 y(3.5)84
b(System)28 b(b)r(o)r(oting)43 b(.)f(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)48 b(167)830 2599 y(3.5.1)94 b(Main)27 b(en)n(try)g(p)r(oin)n(t)h
Fu(C)7 b Fx(++)27 b Fz(\014les)85 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(169)830 2698
y(3.5.2)94 b(System)28 b(options)49 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(169)830 2798 y(3.5.3)94 b(Starting)27 b(system)g(serv)n(ers)79
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)48 b(176)830 2897 y(3.5.4)94 b(OS)27 b(mo)r(dules)h(startup)67
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(180)639 2997 y(3.6)84 b(System)28
b(halt,)g(reb)r(o)r(ot)f(and)g(susp)r(end)59 b(.)42 b(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(190)639 3097 y(3.7)84 b(F)-7 b(rozen)27 b(no)r(des)70
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(191)639
3196 y(3.8)84 b(T)-7 b(ranslating)26 b(alien)i(resources)d(to)j(nativ)n
(e)f(format)53 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(196)639 3296 y(3.9)84 b(Dumping)28 b(no)r(de)g(con)n(ten)n(ts)67
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(198)639 3396 y(3.10)42 b(Miscellaneous)27
b(no)r(de)g(op)r(erations)c(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(199)830 3495
y(3.10.1)k(Basic)27 b(console)f(output)44 b(.)e(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(199)639 3595 y(3.11)42 b(The)28 b(no)r(de)g(for)f(ix86)f(based)h(arc)
n(hitectures)76 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)48 b(204)830 3694 y(3.11.1)k(Mac)n(hine)27 b(dep)r(enden)n(t)h
(no)r(de)g Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)61
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(205)830 3794
y(3.11.2)k(System)28 b(halt)f(and)h(reb)r(o)r(ot)68 b(.)41
b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)48 b(206)830 3894 y(3.11.3)k(OS)27 b(mo)r(dules)h(startup)67
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(207)830 3993 y(3.11.4)k(Getting)28
b(ph)n(ysical)f(resources)e(b)r(o)r(ot)j(time)g(information)43
b(.)e(.)h(.)f(.)h(.)48 b(212)830 4093 y(3.11.5)k(Serial)27
b(line)h(debugging)37 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(214)515 4276
y FA(4)76 b(Exp)s(orting)31 b(the)h(hardw)m(are)1593
b(217)639 4375 y Fz(4.1)84 b(Ph)n(ysical)26 b(memory)51
b(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(217)830
4475 y(4.1.1)94 b(Memory)27 b(banks)63 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(217)830 4575 y(4.1.2)94 b(P)n(age)26 b(frames)32 b(.)41
b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(222)830 4674 y(4.1.3)94
b(Memory)27 b(allo)r(cation)49 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(224)830 4774 y(4.1.4)94 b(Memory)27 b(rev)n(o)r(cation)e(.)41
b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)48 b(230)830 4873 y(4.1.5)94 b(Memory)27
b(na)n(vigation)e(and)j(insp)r(ection)50 b(.)42 b(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(232)830 4973 y(4.1.6)94
b(F)-7 b(rozen)27 b(memory)39 b(.)i(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(241)1926 5255 y(2)p eop
PStoPSsaved restore
%%Page: (4,5) 3
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
3 4 bop 830 523 a Fz(4.1.7)94 b(Dumping)28 b(memory)74
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(246)830 623 y(4.1.8)94 b(Kernel)27
b(pages,)f(reserv)n(ed)g(pages,)g(and)i(mallo)r(c)f(pages)47
b(.)42 b(.)f(.)h(.)f(.)h(.)48 b(247)830 722 y(4.1.9)94
b(Memory)27 b(banks)g(and)g(page)g(frames)g(for)g(plain)g(users)61
b(.)42 b(.)f(.)h(.)f(.)h(.)48 b(249)830 822 y(4.1.10)k(Memory)27
b(banks)g Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)42
b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(263)830 922 y(4.1.11)k(Con)n(v)n(ersion)25 b(routines)76
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(269)830 1021 y(4.1.12)k(Multiple)28
b(page)f(size)g(supp)r(ort)d(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(270)830 1121 y(4.1.13)k(Memory)27
b(banks)g(for)g(ix86)f(based)h(arc)n(hitectures)68 b(.)42
b(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(273)639 1220 y(4.2)84
b(Input/Output)36 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(281)830 1320 y(4.2.1)94 b(IO)27 b(banks)75 b(.)42 b(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(281)830 1420 y(4.2.2)94 b(IO)27
b(p)r(orts)33 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(285)830 1519 y(4.2.3)94 b(IO)27 b(p)r(ort)h(allo)r(cation)72
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(287)830 1619 y(4.2.4)94 b(IO)27
b(Bank)g(na)n(vigation)f(and)h(insp)r(ection)38 b(.)k(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(290)830 1719 y(4.2.5)94
b(F)-7 b(rozen)27 b(IO)44 b(.)e(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(296)830 1818 y(4.2.6)94 b(Dumping)28 b(IO)f(p)r(orts)58
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(301)830 1918 y(4.2.7)94 b(Input/Output)28
b(for)f(plain)h(users)64 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)48 b(301)830 2017 y(4.2.8)94 b(Input/Output)28
b Fu(C)7 b Fx(++)27 b Fz(source)g(\014les)70 b(.)41 b(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(307)830 2117
y(4.2.9)94 b(IO)27 b(banks)g(for)g(ix86)g(based)g(arc)n(hitectures)79
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(311)639
2217 y(4.3)84 b(T)-7 b(raps)27 b(and)g(in)n(terrupts)49
b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(313)830 2316 y(4.3.1)94
b(Ev)n(en)n(t)27 b(tables)21 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(313)830 2416 y(4.3.2)94 b(Ev)n(en)n(ts)34 b(.)41 b(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)48 b(318)830 2516 y(4.3.3)94 b(Ev)n(en)n(t)27
b(allo)r(cation)73 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(325)830
2615 y(4.3.4)94 b(T)-7 b(rap)27 b(and)g(In)n(terrupt)g(handling)82
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(331)830 2715 y(4.3.5)94 b(Ev)n(en)n(t)27 b(na)n(vigation)e(and)j
(insp)r(ection)74 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(343)830 2814 y(4.3.6)94 b(F)-7 b(rozen)27
b(ev)n(en)n(ts)43 b(.)f(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(347)830
2914 y(4.3.7)94 b(Dumping)28 b(ev)n(en)n(t)f(tables)65
b(.)42 b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)f(.)h(.)48 b(351)830 3014 y(4.3.8)94 b(T)-7 b(raps)27
b(and)g(in)n(terrupts)g(for)g(plain)h(users)79 b(.)41
b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(351)830
3113 y(4.3.9)94 b(T)-7 b(rap)27 b(and)g(in)n(terrupt)g(lo)n(w-lev)n(el)
g(deliv)n(ering)34 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(364)830 3213 y(4.3.10)k(Ev)n(en)n(t)27 b Fu(C)7 b Fx(++)27
b Fz(source)f(\014les)46 b(.)c(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(364)830 3313
y(4.3.11)k(Ev)n(en)n(ts)26 b(for)h(ix86)g(based)g(arc)n(hitectures)39
b(.)j(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(370)639 3412 y(4.4)84 b(Timers)32 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(388)830 3512 y(4.4.1)94
b(Timer)27 b(serv)n(ers)40 b(.)i(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(388)830 3611 y(4.4.2)94 b(Timers)24 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(392)830 3711 y(4.4.3)94 b(Timer)27
b(allo)r(cation)63 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(395)830
3811 y(4.4.4)94 b(Timer)27 b(rev)n(o)r(cation)39 b(.)j(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
48 b(400)830 3910 y(4.4.5)94 b(Timer)27 b(handling)39
b(.)i(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(400)830 4010 y(4.4.6)94
b(Timer)27 b(serv)n(er)f(na)n(vigation)g(and)h(insp)r(ection)82
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(406)830
4110 y(4.4.7)94 b(F)-7 b(rozen)27 b(timers)41 b(.)h(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)
h(.)48 b(409)830 4209 y(4.4.8)94 b(Dumping)28 b(timers.)118
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(410)830 4309 y(4.4.9)94 b(Timer)27
b Fu(C)7 b Fx(++)27 b Fz(source)g(\014les)35 b(.)42 b(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(411)830 4408 y(4.4.10)k(Timers)27 b(for)g(ix86)g(based)g(arc)n
(hitectures)h(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(414)639 4508 y(4.5)84 b(DMA)29 b(lines)24 b(.)41 b(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(416)830 4608 y(4.5.1)94
b(DMA)28 b(lines)g(for)f(plain)h(users)53 b(.)42 b(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(417)639
4707 y(4.6)84 b(Pro)r(cessors)34 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(417)830 4807 y(4.6.1)94 b(Pro)r(cessor)25
b(registers)54 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(422)830 4907
y(4.6.2)94 b(Sc)n(heduling)27 b(facilities)80 b(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(422)830 5006 y(4.6.3)94 b(Time)28 b(slice)f(allo)r
(cation)44 b(.)e(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(429)1926 5255 y(3)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
4 5 bop 830 523 a Fz(4.6.4)94 b(Pro)r(cessor)25 b(na)n(vigation)h(and)h
(insp)r(ection)69 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(433)830 623 y(4.6.5)94 b(F)-7 b(rozen)27 b(pro)r(cessors)f(.)42
b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)48 b(436)830 722 y(4.6.6)94 b(Dumping)28
b(pro)r(cessors)61 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(440)830 822 y(4.6.7)94
b(Pro)r(cessors)24 b(and)k(pro)r(cessor)d(p)r(o)r(ols)j(for)f(plain)g
(users)35 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)48 b(440)830
922 y(4.6.8)94 b(Pro)r(cessors)24 b Fu(C)7 b Fx(++)27
b Fz(source)g(\014les)72 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(446)830 1021 y(4.6.9)94
b(Pro)r(cessors)24 b(for)k(ix86)e(based)h(arc)n(hitectures)33
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(450)515
1204 y FA(5)76 b(Implemen)m(ting)28 b(abstract)34 b(resources)1231
b(458)639 1303 y Fz(5.1)84 b(Sh)n(uttles)58 b(.)42 b(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(458)830 1403
y(5.1.1)94 b(Sh)n(uttle)28 b(serv)n(ers)66 b(.)41 b(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
48 b(459)830 1503 y(5.1.2)94 b(Sh)n(uttles)50 b(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(462)830 1602
y(5.1.3)94 b(Sh)n(uttle)28 b(allo)r(cation)c(.)42 b(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(465)830 1702 y(5.1.4)94 b(Sh)n(uttle)28 b(rev)n(o)r(cation)65
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(470)830 1802 y(5.1.5)94 b(Sh)n(uttles,)28
b(stac)n(ks)e(and)i(SMP)59 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(470)830 1901 y(5.1.6)94
b(Sh)n(uttle)28 b(prop)r(erties)79 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(471)830 2001 y(5.1.7)94 b(Hardwired)27 b(sh)n(uttle)g(prop)r(erties)
71 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)
48 b(484)830 2100 y(5.1.8)94 b(Starting)27 b(and)g(terminating)h(sh)n
(uttles)i(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(503)830 2200 y(5.1.9)94 b(Con)n(text)27 b(switc)n(hing)73
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)48 b(505)830 2300 y(5.1.10)k(Idle)28
b(sh)n(uttles)h(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(506)830 2399 y(5.1.11)k(Sh)n(uttle)28 b(na)n(vigation)e(and)h(insp)r
(ection)e(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(509)830 2499 y(5.1.12)k(F)-7 b(rozen)27 b(sh)n(uttles)53
b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(512)830 2599 y(5.1.13)k(Dumping)28
b(Sh)n(uttles)75 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(514)830 2698
y(5.1.14)k(Sh)n(uttles)28 b(for)f(plain)h(users)22 b(.)42
b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(515)830 2798 y(5.1.15)k(Sh)n(uttles)28 b
Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)j(.)41 b(.)h(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(529)830
2897 y(5.1.16)k(Sh)n(uttles)28 b(for)f(ix86)g(based)g(arc)n(hitectures)
54 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(536)830 2997 y(5.1.17)k(Nesting)27 b(sh)n(uttle)h(con)n(texts)47
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)48 b(545)639 3097 y(5.2)84 b(P)n(ortals)27 b(.)41
b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(551)830 3196 y(5.2.1)94 b(The)28 b(p)r(ortal)f(serv)n(er)33
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(551)830 3296 y(5.2.2)94
b(P)n(ortals)19 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(555)830 3396 y(5.2.3)94 b(P)n(ortal)26 b(allo)r(cation)59
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(561)830 3495 y(5.2.4)94
b(P)n(ortal)26 b(rev)n(o)r(cation)35 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(566)830 3595 y(5.2.5)94 b(Kernel-User)26 b(in)n(terface)f(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(566)830 3694 y(5.2.6)94 b(Doing)27 b(IPC)g(with)h(p)r
(ortals)66 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)48 b(568)830 3794 y(5.2.7)94 b(Up)r(calls)75
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(584)830
3894 y(5.2.8)94 b(P)n(ortal)26 b(na)n(vigation)g(and)h(insp)r(ection)60
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(586)830 3993 y(5.2.9)94 b(F)-7 b(rozen)27 b(p)r(ortals)80
b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(589)830 4093 y(5.2.10)k(Dumping)28
b(P)n(ortals)43 b(.)f(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(591)830 4193
y(5.2.11)k(P)n(ortals)25 b(for)i(plain)h(users)58 b(.)42
b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(592)830 4292 y(5.2.12)k(P)n(ortals)25 b Fu(C)7
b Fx(++)27 b Fz(source)g(\014les)64 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(608)830
4392 y(5.2.13)k(P)n(ortals)25 b(for)i(ix86)g(based)g(arc)n(hitectures)e
(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(613)830 4491 y(5.2.14)k(System)28 b(calls)e(.)41 b(.)h(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(626)830 4591 y(5.2.15)k(P)n(ortals)25
b(for)i(ix86)g(based)g(arc)n(hitectures)f Fu(C)7 b Fx(++)27
b Fz(source)g(\014les)69 b(.)41 b(.)h(.)48 b(627)639
4691 y(5.3)84 b(Distributed)29 b(Memory)d(Managers)70
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)48 b(634)830 4790 y(5.3.1)94 b Ft(dmm)38 b Fz(.)k(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(634)830 4890 y(5.3.2)94
b(Distributed)28 b(TLBs)85 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(639)830
4990 y(5.3.3)94 b(Address)27 b(translations)51 b(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(642)1926 5255 y(4)p eop
PStoPSsaved restore
%%Page: (6,7) 4
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
5 6 bop 830 523 a Fz(5.3.4)94 b Ft(dtlb)27 b Fz(allo)r(cation)i(.)41
b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)48 b(644)830 623 y(5.3.5)94 b
Ft(dtlb)27 b Fz(rev)n(o)r(cation)69 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(649)830 722 y(5.3.6)94 b(Address)27 b(translation)f(allo)r(cation)h
(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(649)830 822 y(5.3.7)94 b(P)n(age)26 b(fault)i(handling)83
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(659)830 922 y(5.3.8)94 b Ft(dtlb)27
b Fz(switc)n(hing)43 b(.)e(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(662)830
1021 y(5.3.9)94 b(The)28 b Ft(dtlb)f Fz(for)g(the)h(ro)r(ot)f(sh)n
(uttle)33 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(664)830 1121 y(5.3.10)k Ft(dmm)27 b Fz(miscellaneous)g
(utilities)61 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)48 b(665)830 1220 y(5.3.11)k Ft(dmm)27
b Fz(na)n(vigation)f(and)i(insp)r(ection)45 b(.)c(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(666)830 1320
y(5.3.12)k(F)-7 b(rozen)27 b Ft(dmm)p Fz(s)59 b(.)42
b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(668)830 1420 y(5.3.13)k(Dumping)29
b Ft(dmm)p Fz(s)g(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(670)830
1519 y(5.3.14)k Ft(dtlb)p Fz(s)27 b(for)g(plain)h(users)e(.)42
b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(671)639 1619 y(5.4)84 b(Distributed)29
b(Memory)d(Managers)g Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)50
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(684)830
1719 y(5.4.1)94 b(Distributed)22 b(Memory)e(Managemen)n(t)g(for)g(ix86)
g(based)h(arc)n(hitec-)1096 1818 y(tures)33 b(.)42 b(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(690)830 1918 y(5.4.2)94
b(DMM)28 b(for)f(ix86)g Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)60
b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(704)639 2017 y(5.5)84 b(Kernel)27 b(address)f(space)h(manager)i(.)42
b(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(706)830 2117 y(5.5.1)94 b(Allo)r(cating)27
b(k)n(ernel)g(pages)79 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(712)830 2217 y(5.5.2)94
b(Kernel)27 b(virtual)g(memory)f(regions)69 b(.)41 b(.)h(.)g(.)f(.)h(.)
f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(718)830 2316
y(5.5.3)94 b(Region)27 b(iteration)78 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(736)830 2416 y(5.5.4)94 b(Kernel)27 b(address)f(space)h(manager)f
Fu(C)7 b Fx(++)27 b Fz(source)f(\014les)66 b(.)42 b(.)f(.)h(.)f(.)h(.)
48 b(737)639 2516 y(5.6)84 b(Kernel)27 b(address)f(space)h(manager)f
(for)h(ix86)g(based)g(arc)n(hitectures)34 b(.)42 b(.)f(.)h(.)48
b(740)830 2615 y(5.6.1)94 b(Supp)r(orting)27 b(k)n(ernel)g(dynamic)g
(memory)73 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(740)515 2798 y FA(6)76 b(Miscellaneous)30 b(data)j(structures)1354
b(743)639 2897 y Fz(6.1)84 b(Double)28 b(link)n(ed)f(lists)66
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(743)830 2997
y(6.1.1)94 b(Double)28 b(link)n(ed)f(lists)h Fu(C)7 b
Fx(++)27 b Fz(source)f(\014les)36 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)48 b(750)639 3097 y(6.2)84 b(Queues)23
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(752)830 3196 y(6.2.1)94 b(Queues)27 b Fu(C)7 b Fx(++)27
b Fz(source)f(\014les)59 b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(754)639 3296
y(6.3)84 b(Hash)28 b(tables)56 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)f(.)h(.)48 b(755)830 3396 y(6.3.1)94 b(Hash)27 b(tables)h
Fu(C)7 b Fx(++)26 b Fz(source)h(\014les)h(.)41 b(.)h(.)f(.)h(.)g(.)f(.)
h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(757)639
3495 y(6.4)84 b(Bitmaps)47 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(758)830 3595 y(6.4.1)94 b(Bitmaps)27
b Fu(C)7 b Fx(++)27 b Fz(source)g(\014les)82 b(.)42 b(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(759)639 3694 y(6.5)84 b(Simple)28 b(output)g(streams)45
b(.)c(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(760)830 3794 y(6.5.1)94
b(Simple)28 b(output)g(streams)f(for)g(users)d(.)41 b(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(762)830 3894
y(6.5.2)94 b(Simple)28 b(output)g(streams)f Fu(C)7 b
Fx(++)27 b Fz(source)f(\014les)81 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(763)639 3993 y(6.6)84 b(Small)28 b(utilit)n(y)g(functions)
58 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(764)830 4093 y(6.6.1)94
b(F)-7 b(reezing)27 b(strings)f(in)n(to)i(user)f(bu\013ers)62
b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(764)830 4193 y(6.6.2)94 b(Signing)27 b(frozen)g(resources)52
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)
f(.)h(.)48 b(767)639 4292 y(6.7)84 b(Miscellaneous)27
b(x86)f(dep)r(enden)n(t)i(utilities)k(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(768)830 4392 y(6.7.1)94
b(Common)27 b(data)g(t)n(yp)r(es)59 b(.)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)
h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(768)830 4491 y(6.7.2)94 b(Mac)n(hine)27 b(dep)r(enden)n(t)h(iden)n
(ti\014ers)j(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f
(.)h(.)48 b(768)830 4591 y(6.7.3)94 b(Spin)28 b(lo)r(c)n(ks)40
b(.)i(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48 b(768)830 4691
y(6.7.4)94 b(Debug)28 b(utilities)68 b(.)41 b(.)h(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)48
b(768)830 4790 y(6.7.5)94 b(Bit)28 b(op)r(erations)e(and)h(atomic)h
(coun)n(ter)e(op)r(erations)45 b(.)c(.)h(.)f(.)h(.)f(.)h(.)48
b(768)830 4890 y(6.7.6)94 b(Mac)n(hine)27 b(dep)r(enden)n(t)h(stac)n
(ks)37 b(.)42 b(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)48 b(769)1926 5255 y(5)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
6 7 bop 515 523 a FA(A)52 b(System)31 b(limits)2026 b(773)639
623 y Fz(A.1)64 b(No)r(de)28 b(limits)60 b(.)42 b(.)f(.)h(.)g(.)f(.)h
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)48 b(773)515 805 y FA(B)56 b(System)31
b(errors)2016 b(774)515 988 y(C)55 b(Index)33 b(of)e(Ch)m(unks)1907
b(775)515 1171 y(D)51 b(Index)33 b(of)e(Iden)m(ti\014ers)1799
b(776)1926 5255 y Fz(6)p eop
PStoPSsaved restore
%%Page: (8,9) 5
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
7 8 bop 515 1187 a Fv(List)76 b(of)i(Figures)639 1619
y Fz(2.1)84 b(System)28 b(calls)33 b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h
(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)90 b(15)639 1719 y(2.2)84 b(Initial)28
b(resource)e(hierarc)n(h)n(y)f(\(not)j(used\))77 b(.)42
b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90
b(16)639 1818 y(2.3)84 b(Basic)27 b(resource)f(hierarc)n(h)n(y)50
b(.)42 b(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)
f(.)h(.)f(.)h(.)f(.)h(.)90 b(17)639 1918 y(2.4)84 b(Con)n(tainers)26
b(and)i(allo)r(cators)66 b(.)41 b(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g
(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)90 b(53)639
2017 y(2.5)84 b(Arc)n(hitecture)27 b(a)n(w)n(areness)e(supp)r(ort:)37
b(Na)n(vigators)25 b(and)j(Insp)r(ectors.)110 b(.)42
b(.)90 b(75)639 2117 y(2.6)84 b(Storage)26 b(of)i(P)n(ortals)d(for)i(t)
n(w)n(o)g(di\013eren)n(t)h(applications.)22 b(.)41 b(.)h(.)g(.)f(.)h(.)
f(.)h(.)f(.)h(.)48 b(107)639 2217 y(2.7)84 b(Hardw)n(are)26
b(resource)g(con)n(tainers)g(and)h(elemen)n(tary)g(units.)79
b(.)41 b(.)h(.)f(.)h(.)f(.)h(.)48 b(116)639 2316 y(2.8)84
b(System)28 b(abstract)f(resource)e(con)n(tainers)h(and)i(elemen)n
(tary)e(units.)39 b(.)j(.)f(.)h(.)48 b(121)639 2499 y(5.1)84
b(Relationship)28 b(among)e(Sh)n(uttles,)i(P)n(ortals,)e
Ft(dtlb)p Fz(s)h(and)g(other)g(resources.)38 b(458)639
2599 y(5.2)84 b(Sh)n(uttle)28 b(activ)-5 b(ations:)37
b(system)27 b(calls)g(and)g(up-calls.)46 b(.)c(.)f(.)h(.)g(.)f(.)h(.)f
(.)h(.)f(.)h(.)48 b(485)639 2698 y(5.3)84 b(A)28 b(distributed)g(TLB)g
(with)g(some)f(lo)r(cal)g(and)g(remote)g(translations.)i(.)41
b(.)h(.)48 b(639)639 2798 y(5.4)84 b(Kernel)27 b(virtual)g(memory)g(la)
n(y)n(out)42 b(.)g(.)f(.)h(.)f(.)h(.)f(.)h(.)g(.)f(.)h(.)f(.)h(.)g(.)f
(.)h(.)f(.)h(.)f(.)h(.)48 b(706)1926 5255 y(7)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
8 9 bop 515 1146 a Fs(Chapter)64 b(1)515 1561 y Fv(In)-6
b(tro)6 b(duction)515 2042 y Fr(1.1)135 b(Motiv)-7 b(ation)515
2224 y Fz(The)33 b(w)n(ell)f(kno)n(wn)g(de\014nition)h(for)f(op)r
(erating)g(system)h(is)f(\\the)h(soft)n(w)n(are)e(that)i(securely)515
2324 y(abstracts)h(and)h(m)n(ultiplexes)g(ph)n(ysical)g(resources")e
([19)o(].)60 b(By)35 b(no)g(means)g(is)g(it)h(kno)n(wn)515
2423 y(that)g(those)g(resources)e(should)i(b)r(e)h(con)n(tained)e(in)h
(a)g(single)g(no)r(de.)62 b(So,)38 b(Wh)n(y)f(are)e(our)515
2523 y(distributed)22 b(op)r(erating)f(systems)h(based)g(on)f(microk)n
(ernels)g(whic)n(h)h(essen)n(tially)f(m)n(ultiplex)515
2623 y(just)28 b(lo)r(cal)f(resources?)639 2722 y(Ob)n(viously)19
b(system)i(services)e(can)h(b)r(e)h(later)f(distributed)h(when)f(using)
g(a)g(\(cen)n(tralized\))515 2822 y(microk)n(ernel.)57
b(Indeed,)37 b(that)e(can)g(b)r(e)g(done)g(ev)n(en)f(when)h(using)g(a)f
(monolithic)h(system)515 2922 y([16)o(].)55 b(But)34
b(this)f(will)h(not)g(solv)n(e)e(the)i(actual)f(problem)g(that)h(the)g
(system)f(is)h Fy(not)41 b Fz(b)r(eing)515 3021 y(actually)20
b(distributed)h(and)f(is)h Fy(not)28 b Fz(transparen)n(tly)19
b(m)n(ultiplexing)i(b)r(oth)g(lo)r(cal)f(and)h(remote)515
3121 y(resources.)639 3220 y(Secondly)-7 b(,)24 b(a)e(ma)5
b(jor)21 b(dra)n(wbac)n(k)f(of)j(curren)n(t)e(distributed)i(op)r
(erating)f(systems)g(is)g(their)515 3320 y(lac)n(k)i(of)i(adaptabilit)n
(y)-7 b(.)35 b(It)26 b(is)f(kno)n(wn)g(that)h(adaptabilit)n(y)f(can)g
(b)r(e)h(ac)n(hiev)n(ed)e(using)h(a)g(min-)515 3420 y(imal)31
b(microk)n(ernel)f(as)h(a)g(foundation)g(for)g(the)h(op)r(erating)e
(system)i([8)o(,)g(7)o(,)g(4)o(,)g(10)o(].)49 b(If)32
b(the)515 3519 y(microk)n(ernel)27 b(is)h(cen)n(tralized,)g(adaptation)
g(of)g(system)h(services)e(for)h(particular)f(require-)515
3619 y(men)n(ts)f(ma)n(y)f(harm)h(the)g(distribution)h(of)f(those)g
(services)e(b)r(ecause)i(they)g(are)g(distributed)515
3719 y(on)j(top)h(of)g(the)g(microk)n(ernel)e(and)i(this)g
(distribution)g(is)g(not)g(supp)r(orted)f(b)n(y)h(the)g(micro-)515
3818 y(k)n(ernel)c(itself.)37 b(\(e.g.)g(a)26 b(bad)h(adaptation)g(of)g
(the)g(Mac)n(h)g Fx(netmsg)e Fz(serv)n(er)g(ma)n(y)h(isolate)h(the)515
3918 y(whole)g(no)r(de)h(and/or)e(slo)n(w-do)n(wn)f Fy(every)36
b Fz(system)28 b(application\).)639 4017 y(The)j(reason)d(is)i(that)h
(user)f(extensions)f(ma)n(y)h(fail)g(to)g(preserv)n(e)f(prop)r(erties)g
(found)i(in)515 4117 y(the)g(distributed)f(hardw)n(are)f(and)h(there)g
(will)h(b)r(e)f(no)h(lo)n(w)n(er)d(la)n(y)n(er)h(supp)r(orting)h(them.)
46 b(If)515 4217 y(the)29 b(microk)n(ernel)f(is)h(itself)h
(distributed,)h(simple)e(system)g(extensions)g(ma)n(y)g(still)g(b)r
(ene\014t)515 4316 y(from)i(system)g(distribution)h(b)r(ecause)f(the)i
(lo)n(w)n(er)d(la)n(y)n(er)g(is)h(distributed)h(b)n(y)g(itself.)49
b(This)515 4416 y(problem)34 b(can)g(b)r(e)g(noticed)h(b)n(y)f(the)g
(fact)h(that)g(it)f(is)h(necessary)d(to)i(mo)r(dify)h(and/or)e(re-)515
4516 y(implemen)n(t)27 b(existing)g(system)g(services)e(to)i(add)g(new)
g(distributed)g(services)f(to)h(a)g(t)n(ypical)515 4615
y(microk)n(ernel)f(based)h(distributed)h(system)f([6,)g(20)o(,)h(13)o
(].)639 4715 y(The)i Fy(2K)i(Op)l(er)l(ating)h(System)j
Fz(is)29 b(b)r(eing)h(built)h(to)f(explore)f(the)h(com)n(bination)f(of)
h(dis-)515 4814 y(tribution)e(and)f(adaptabilit)n(y)-7
b(.)36 b Fy(2K)k Fz(is)28 b(built)g(from)f(t)n(w)n(o)g(main)h(pieces:)
1926 5255 y(8)p eop
PStoPSsaved restore
%%Page: (10,11) 6
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
9 10 bop 639 523 a Fq(\017)41 b Fz(A)29 b(distributed)g(adaptable)f
Fw(\026)p Fz(k)n(ernel)g(\(D)n(AMN)2212 493 y Fp(1)2250
523 y Fz(\))i(exp)r(orting)e(hardw)n(are)e(resources)722
623 y(a)n(v)-5 b(ailable)27 b(in)g(the)h(net)n(w)n(ork)f(without)h(imp)
r(osing)f(an)n(y)g(particular)f(OS)h(structure.)639 789
y Fq(\017)41 b Fz(A)31 b(customizable)e(ORB)h(used)g(to)g(plug-in)g(OS)
g(services)f(constructed)h(as)f(a)h(set)g(of)722 888
y(distributed)e(ob)5 b(jects.)639 1071 y(W)-7 b(e)34
b(exp)r(ect)f(the)g(com)n(bination)f(of)h(b)r(oth)g(elemen)n(ts)g(to)g
(yield)g(a)f(simple)h(easy-to-use)515 1171 y(distributed)28
b(and)f(\015exible)h(OS.)639 1270 y(By)37 b(adopting)f(a)g(strict)h
Fy(ar)l(chite)l(ctur)l(e)h(self-awar)l(eness)45 b Fz(philosoph)n(y)-7
b(,)39 b(w)n(e)d(will)h(allo)n(w)515 1370 y(system)29
b(and)f(user)h(mo)r(dules)g(to)g(b)r(e)g(conscious)f(of)h(its)g(o)n(wn)
g(ph)n(ysical)f(and)h(logical)f(arc)n(hi-)515 1469 y(tecture.)44
b(So,)31 b(the)f(system)g(will)h(b)r(e)f(able)g(to)g(adapt)g(itself)h
(optimizing)f(its)g(p)r(erformance)515 1569 y(and)d(reliabilit)n(y)-7
b(.)639 1669 y(This)41 b(do)r(cumen)n(t)g(describ)r(es)e(the)i(ob)5
b(ject)41 b(orien)n(ted)e(redesign)h(of)g(the)h(O\013)g
Fw(\026)p Fz(k)n(ernel)515 1768 y([2)o(,)36 b(3)o(,)g(1],)h(named)f
Fy(O\013)17 b Fx(++)p Fz(,)37 b(and)e(is)g(mean)n(t)g(to)h(b)r(e)g(the)
g(starting)e(p)r(oin)n(t)i(for)f(its)g(literate)515 1868
y(implemen)n(tation)27 b(\(see)h(section)f(1.3\).)639
1968 y Fy(O\013)17 b Fx(++)27 b Fz(also)f(adds)g(new)h(functionalities)
h(to)e(the)i Fw(\026)p Fz(k)n(ernel)e(in)h(order)f(to)h(pro)n(vide)f
(basic)515 2067 y(supp)r(ort)h(for)g Fy(2K)p Fz(.)h(These)f(new)g
(functionalities)h(include)g(supp)r(ort)f(for)g(arc)n(hitecture)f
(self-)515 2167 y(a)n(w)n(areness,)37 b(system)g(ob)5
b(ject)38 b(bro)n(wsing)e(and)h(insp)r(ection)h(\(see)f(subsections)g
(2.4.6)f(and)515 2267 y(2.4.9\),)26 b(and)i(\015exible)g
(user-de\014ned)e(domains)h(\(see)h(section)f(2.8\).)639
2366 y(Multiple)e(protection)e(domains,)h(m)n(ulti-user)g(op)r
(eration,)f(and)h(m)n(ultitasking)g(are)f(op-)515 2466
y(tional)k(features)g(whic)n(h)h(can)f(b)r(e)h(a)n(v)n(oided)e(in)i
(those)f(no)r(des)g(where)g(they)h(are)f(not)g(useful.)515
2740 y Fr(1.2)135 b(The)45 b(O\013)g Fo(\026)p Fr(k)l(ernel)515
2922 y Fz(The)25 b(three)g(basic)f(abstractions)f(pro)n(vided)h(b)n(y)h
Fy(O\013)42 b Fz(\(sh)n(uttles,)26 b(p)r(ortals)e(and)h
Ft(dtlb)p Fz(s\))g(will)515 3022 y(b)r(e)38 b(describ)r(ed)g(brie\015y)
g(in)g(this)h(section)e(so)h(that)g(the)h(reader)d(will)i(b)r(e)h(able)
f(to)g(b)r(etter)515 3121 y(understand)27 b(the)h(follo)n(wing)f(c)n
(hapters.)515 3354 y Fn(1.2.1)112 b(Sh)m(uttles.)49 b(Distributed)36
b(Pro)s(cess)h(Services)515 3507 y Fz(Pro)r(cess)28 b(services)h(are)g
(quite)i(simple)f(in)h Fy(O\013)17 b Fz(.)45 b(The)30
b(only)g(abstraction)f(pro)n(vided)h(is)g(the)515 3607
y Fy(Shuttle)p Fz(.)45 b(A)30 b(sh)n(uttle)h(is)f(an)h(extensible)f
(hardw)n(are)e(con)n(text.)46 b(Initially)-7 b(,)31 b(it)g(consists)e
(only)515 3706 y(of)g(a)h(program)d(coun)n(ter)i(and)h(a)f(stac)n(k)g
(p)r(oin)n(ter,)h(though)f(they)h(can)f(b)r(e)i(safely)e(extended)515
3806 y(later)18 b(on)h(to)g(include)h(other)e(pieces)h(of)g(con)n(text)
g(or)f Fy(pr)l(op)l(erties)27 b Fz(\(suc)n(h)19 b(lik)n(e)g(general)f
(purp)r(ose)515 3906 y(registers,)26 b(address)g(spaces,)h(privilege)f
(lev)n(els,)h(etc.\))515 4138 y Fn(1.2.2)112 b(P)m(ortals.)49
b(In)m(terpro)s(cess)37 b(comm)m(unication)515 4291 y
Fz(The)20 b(basic)g(in)n(terpro)r(cess)g(comm)n(unication)f(mec)n
(hanism)i(pro)n(vided)e(b)n(y)i Fy(O\013)37 b Fz(is)21
b(the)g Fy(Portal)p Fz(.)515 4391 y(A)f(P)n(ortal)e(can)h(b)r(e)h(seen)
g(lik)n(e)f(a)g(\\distributed)h(in)n(terrupt)f(line")h(or)e(a)i(\\net)n
(w)n(ork-wide)d(gate".)515 4490 y(P)n(ortals)f(ha)n(v)n(e)i(the)h
(basic)f(utilit)n(y)h(of)g(in)n(terrupts,)h(i.e.)34 b(they)19
b(can)f(b)r(e)i(in)n(v)n(ok)n(ed)d(transparen)n(tly)515
4590 y(to)27 b(mak)n(e)g(a)g(handler)g(p)r(erform)g(some)g(task.)639
4690 y(P)n(ortals)c(do)i(not)g(implemen)n(t)g(bu\013ering)g(and)g(do)f
(not)h(sp)r(ecify)g(whether)g(sync)n(hronous)515 4789
y(messages,)37 b(async)n(hronous)c(messages)i(or)h(RPCs)f(are)h(to)g(b)
r(e)g(used.)63 b(The)37 b(mec)n(hanisms)p 515 4859 1146
4 v 607 4912 a Fm(1)642 4936 y Fl(D)p 642 4949 54 4 v(istributed)24
b(A)p 1018 4949 53 4 v -1 w(daptable)i(M)p 1361 4949
65 4 v -1 w(icro-N)p 1563 4949 53 4 v -1 w(ucleus)1926
5255 y Fz(9)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
10 11 bop 515 523 a Fz(and)25 b(p)r(olicies)g(used)g(to)g(lo)r(cate)f
(and)h(to)g(in)n(v)n(ok)n(e)f(p)r(ortals)g(o)n(v)n(er)g(the)h(net)n(w)n
(ork)f(are)g(left)i(up)f(to)515 623 y(the)f(user.)35
b(User)24 b(pro)n(vided)f(transp)r(ort)g(and)i(lo)r(cation)e(proto)r
(cols)g(are)g(used)h(to)g(extend)h(the)515 722 y(p)r(ortal)d(mec)n
(hanism)g(transparen)n(tly)f(o)n(v)n(er)h(the)h(net)n(w)n(ork.)34
b(In)23 b(this)g(w)n(a)n(y)e(traps,)j(in)n(terrupts,)515
822 y(exception)i(and)g(user)g(messages)e(can)i(b)r(e)h(accessed)e(and)
h(adapted)g(in)h(the)f(whole)g(system.)515 1054 y Fn(1.2.3)112
b(D-TLBs.)51 b(Distributed)35 b(Memory)i(Managemen)m(t)515
1208 y Fz(The)32 b(only)g(thing)g(done)g(b)n(y)g Fy(O\013)50
b Fz(is)32 b(to)g(exp)r(ort)g(the)g(net)n(w)n(ork)f(hardw)n(are,)h(and)
g(this)g(also)515 1307 y(holds)g(for)g(memory)f(managemen)n(t.)51
b Fy(O\013)e Fz(implemen)n(ts)33 b(a)f Fy(Distribute)l(d)i(Softwar)l(e)
h(TLB)p Fz(.)515 1407 y(The)24 b(user)f(can)h(establish)g(translations)
f(from)g(virtual)h(to)g(distributed)h(ph)n(ysical)e(memory)515
1506 y(addresses)38 b(and)h(the)h(address)e(translation)g(hardw)n(are)f
(is)j(safely)e(m)n(ultiplexed)i(b)n(y)f Fy(O\013)515
1606 y Fz(among)26 b(the)i(comp)r(eting)g(applications.)515
1881 y Fr(1.3)135 b(Literate)47 b(programming)515 2062
y Fz(As)22 b(this)g(do)r(cumen)n(t)g(is)g(hardcop)n(y)f(of)h(a)f
(literate)h(program)e([14)o(])i(w)n(e)g(think)g(that)h(it)f(is)g(w)n
(orth)515 2162 y(sa)n(ying)17 b(something)h(ab)r(out)g(this)h(tec)n
(hnique.)33 b(W)-7 b(e)19 b(do)f(it)h(b)n(y)f(citing)g(the)h
Fx(comp.programming.)o(li)o(ter)o(at)o(e)515 2262 y Fz(newsgroup)26
b(F)-9 b(A)n(Q:)722 2444 y(\\Literate)39 b(programming)f(is)h(the)h
(com)n(bination)f(of)h(do)r(cumen)n(tation)g(and)722
2544 y(source)26 b(together)g(in)i(a)e(fashion)h(suited)g(for)g
(reading)f(b)n(y)h(h)n(uman)g(b)r(eings.)36 b(In)722
2644 y(fact,)h(literate)e(programs)e(should)h(b)r(e)i(enjo)n(y)n(able)d
(reading,)j(ev)n(en)f(in)n(viting!)722 2743 y([...])57
b(In)34 b(general,)h(literate)f(programs)d(com)n(bine)j(source)f(and)h
(do)r(cumen)n(ta-)722 2843 y(tion)22 b(in)f(a)g(single)g(\014le.)35
b(Literate)21 b(programming)e(to)r(ols)i(then)h(parse)e(the)i(\014le)g
(to)722 2942 y(pro)r(duce)33 b(either)g(readable)f(do)r(cumen)n(tation)
h(or)g(compilable)g(source.)52 b(The)722 3042 y(WEB)24
b(st)n(yle)f(of)h(literate)f(programming)e(w)n(as)i(created)g(b)n(y)g
(D.E.)h(Kn)n(uth)g(dur-)722 3142 y(ing)k(the)g(dev)n(elopmen)n(t)f(of)g
(his)h(T)1756 3160 y(E)1802 3142 y(X)g(t)n(ypsetting)f(soft)n(w)n(are.)
722 3275 y(All)h(the)g(original)e(w)n(ork)g(rev)n(olv)n(es)g(around)g
(a)h(particular)g(literate)g(program-)722 3374 y(ming)h(to)r(ol)f
(called)g(WEB.)h(Kn)n(uth)f(sa)n(ys:)905 3557 y(The)k(philosoph)n(y)f
(b)r(ehind)i(WEB)e(is)h(that)h(an)e(exp)r(erienced)h(sys-)905
3656 y(tem)e(programmer,)e(who)h(w)n(an)n(ts)g(to)h(pro)n(vide)f(the)h
(b)r(est)g(p)r(ossible)905 3756 y(do)r(cumen)n(tation)e(of)g(his)h(or)e
(her)h(soft)n(w)n(are)f(pro)r(ducts,)h(needs)h(t)n(w)n(o)905
3856 y(things)20 b(sim)n(ultaneously:)33 b(a)20 b(language)e(lik)n(e)i
(T)2331 3874 y(E)2378 3856 y(X)g(for)g(formatting,)905
3955 y(and)31 b(a)h(language)e(lik)n(e)h(C)g(for)h(programming.)46
b(Neither)32 b(t)n(yp)r(e)g(of)905 4055 y(language)39
b(can)h(pro)n(vide)f(the)i(b)r(est)g(do)r(cumen)n(tation)f(b)n(y)g
(itself;)905 4155 y(but)34 b(when)g(b)r(oth)g(are)e(appropriately)g
(com)n(bined,)j(w)n(e)e(obtain)g(a)905 4254 y(system)23
b(that)g(is)g(m)n(uc)n(h)g(more)f(useful)i(than)f(either)g(language)e
(sep-)905 4354 y(arately)-7 b(.)905 4470 y(The)35 b(structure)f(of)h(a)
f(soft)n(w)n(are)f(program)f(ma)n(y)i(b)r(e)h(though)n(t)g(of)905
4570 y(as)30 b(a)g(w)n(eb)g(that)g(is)g(made)h(up)f(of)h(man)n(y)e(in)n
(terconnected)h(pieces.)905 4669 y(T)-7 b(o)40 b(do)r(cumen)n(t)h(suc)n
(h)f(a)g(program)e(w)n(e)i(w)n(an)n(t)g(to)h(explain)f(eac)n(h)905
4769 y(individual)27 b(part)f(of)g(the)h(w)n(eb)f(and)h(ho)n(w)f(it)h
(relates)e(to)i(its)f(neigh-)905 4869 y(b)r(ours.)67
b(The)38 b(t)n(yp)r(ographic)f(to)r(ols)g(pro)n(vided)g(b)n(y)g(T)2582
4886 y(E)2629 4869 y(X)h(giv)n(e)f(us)905 4968 y(an)26
b(opp)r(ortunit)n(y)g(to)h(explain)f(the)h(lo)r(cal)f(structure)g(of)h
(eac)n(h)e(part)1905 5255 y(10)p eop
PStoPSsaved restore
%%Page: (12,13) 7
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
11 12 bop 905 523 a Fz(b)n(y)37 b(making)g(that)g(structure)g(visible,)
j(and)d(the)h(programming)905 623 y(to)r(ols)e(pro)n(vided)f(b)n(y)h
(languages)e(suc)n(h)i(as)g(C)g(or)g(F)-7 b(ortran)35
b(mak)n(e)905 722 y(it)g(p)r(ossible)f(for)g(us)h(to)f(sp)r(ecify)h
(the)g(algorithms)e(formally)h(and)905 822 y(unam)n(bigously)-7
b(.)54 b(By)34 b(com)n(bining)f(the)h(t)n(w)n(o,)h(w)n(e)f(can)f(dev)n
(elop)g(a)905 922 y(st)n(yle)g(of)g(programming)e(that)j(maximizes)f
(our)f(abilit)n(y)h(to)g(p)r(er-)905 1021 y(ceiv)n(e)39
b(the)g(structure)g(of)g(a)g(complex)g(piece)g(of)g(soft)n(w)n(are,)i
(and)905 1121 y(at)35 b(the)h(same)e(time)i(the)g(do)r(cumen)n(ted)f
(programs)e(can)i(b)r(e)h(me-)905 1220 y(c)n(hanically)26
b(translated)h(in)n(to)g(a)g(w)n(orking)f(soft)n(w)n(are)f(system)j
(that)905 1320 y(matc)n(hes)f(the)h(do)r(cumen)n(tation.")639
1492 y(What)23 b(follo)n(ws)e(ha)n(v)n(e)h(b)r(een)g(written)h(in)g(a)f
(mixture)g(of)g(L)2370 1475 y Fp(A)2407 1492 y Fz(T)2453
1510 y(E)2499 1492 y(X)h(and)f Fu(C++)p Fz(.)35 b(The)22
b Fu(no)n(w)n(eb)515 1592 y Fz(literate)32 b(programming)e(to)r(ol)i
(has)g(b)r(een)h(used)g(to)f(obtain)h(a)f(L)2511 1575
y Fp(A)2548 1592 y Fz(T)2594 1610 y(E)2639 1592 y(X)h(formatted)g(v)n
(ersion)515 1692 y(of)27 b(the)h(do)r(cumen)n(t)g(as)f(w)n(ell)g(as)g
(the)h Fu(C++)g Fz(co)r(de)g(whic)n(h)f(can)g(b)r(e)h(later)f
(compiled.)515 1963 y Fr(1.4)135 b(Ho)l(w)46 b(to)f(read)g(this)h(do)t
(cumen)l(t)515 2145 y Fz(In)29 b(what)f(follo)n(ws,)h(eac)n(h)f
(description)g(of)h(a)f(part)g(of)h(the)g(system)g(ma)n(y)f(b)r(e)h
(follo)n(w)n(ed)f(b)n(y)g(a)515 2245 y Fy(chunk)36 b
Fz(of)28 b(co)r(de)f(lik)n(e)h(this)f(one)515 2357 y
Fk(h)p Fj(Example)g(chunk)i(of)e(c)l(o)l(de.)h Fk(i)p
Fq(\021)598 2449 y Fi(class)40 b(A_Class)h({)e(...)h(};)639
2570 y Fz(In)27 b(this)g(example,)g(the)g(name)g(of)g(the)g(c)n(h)n
(unk)f(w)n(as)g(\\Example)g(c)n(h)n(unk)g(of)h(co)r(de.")36
b(The)515 2669 y(n)n(um)n(b)r(er)23 b(on)h(the)g(righ)n(t)g(of)f(the)i
(c)n(h)n(unk)e(name,)i(also)d(found)j(on)e(the)i(left)f(margin,)g(iden)
n(ti\014es)515 2769 y(the)j(c)n(h)n(unk)f(and)g(will)h(b)r(e)g(used)g
(in)g(cross-references.)33 b(W)-7 b(e)27 b(will)g(refer)f(to)g(suc)n(h)
g(n)n(um)n(b)r(er)h(as)515 2869 y(the)34 b(\\c)n(h)n(unk)e(n)n(um)n(b)r
(er".)55 b(Also,)34 b(when)g(an)g(in)n(teresting)e(en)n(tit)n(y)i(has)f
(b)r(een)h(de\014ned)g(b)n(y)f(a)515 2968 y(c)n(h)n(unk)25
b(\()p Fx(A)p 836 2968 27 4 v 31 w(Class)f Fz(in)i(the)g(example\))f
(it)i(will)e(b)r(e)i(stated)e(b)r(elo)n(w)h(the)g(c)n(h)n(unk)f(using)g
(a)g(small)515 3068 y(fon)n(t.)639 3167 y(The)40 b(c)n(h)n(unk)g(n)n
(um)n(b)r(er)f(is)h(made)g(the)g(page)f(n)n(um)n(b)r(er)h(\(iden)n
(tifying)g(in)g(whic)n(h)g(page)515 3267 y(the)28 b(c)n(h)n(unk)f(is)g
(de\014ned\))h(and,)g(if)g(necessary)-7 b(,)26 b(a)h(letter)g(to)h
(distinguish)f(b)r(et)n(w)n(een)h(di\013eren)n(t)515
3367 y(c)n(h)n(unks)i(in)h(the)g(same)f(page.)45 b(Using)30
b(this)h(n)n(um)n(b)r(er)f(one)g(is)h(able)f(to)h(quic)n(kly)f(lo)r
(cate)g(an)n(y)515 3466 y(c)n(h)n(unk)d(in)h(the)g(do)r(cumen)n(t.)639
3566 y(Ch)n(unks)40 b(of)h(co)r(de)f(can)h(include)f(other)g(c)n(h)n
(unks,)k(in)c(this)h(case,)i(y)n(ou)d(can)g(use)h(the)515
3666 y(n)n(um)n(b)r(er)c(enclosed)g(with)h(the)g(c)n(h)n(unk)f(name)g
(b)r(et)n(w)n(een)h(angles)e(\(i.e.)68 b(\\)p Fq(h)p
Fz(")37 b(and)g(\\)p Fq(i)p Fz("\))g(to)515 3765 y(lo)r(cate)i(quic)n
(kly)g(the)h(co)r(de)g(for)f(the)h(c)n(h)n(unk)f(b)r(eing)h(included.)
73 b(In)40 b(this)g(example,)j(the)515 3865 y(c)n(h)n(unk)23
b(sho)n(wn)h(ab)r(o)n(v)n(e)f(will)h(b)r(e)h(included)g(in)f(c)n(h)n
(unk)g(3a.)35 b(W)-7 b(e)24 b(then)h(should)f(use)g(the)h(c)n(h)n(unk)
515 3964 y(n)n(um)n(b)r(ers)i(found)h(in)g(the)g(left)g(margin)e(to)i
(lo)r(cate)f(it.)515 4090 y Fk(h)p Fj(A)g(chunk)i(including)e(another.)
i Fk(i)p Fq(\021)676 4182 y Fi(//)40 b(Some)g(code...)676
4273 y Fk(h)p Fj(Example)28 b(chunk)g(of)g(c)l(o)l(de.)g
Fk(i)676 4364 y Fi(//)40 b(And)g(we)f(also)i(use)f(A_Class)676
4456 y(A_Class)h(an_object;)639 4590 y Fz(Finally)-7
b(,)32 b(a)f(c)n(h)n(unk)f(ma)n(y)g(b)r(e)i(con)n(tin)n(ued)e(at)h(a)g
(di\013eren)n(t)g(part)f(of)h(the)h(do)r(cumen)n(t.)47
b(In)515 4689 y(this)29 b(case)e(it)i(will)g(b)r(e)g(said)f(explicitly)
h(b)r(elo)n(w)f(the)h(c)n(h)n(unk)f(using)g(a)g(small)h(fon)n(t,)g(as)e
(it)i(can)515 4789 y(b)r(e)f(seen)f(b)r(elo)n(w.)515
4915 y Fk(h)p Fj(Continuing)g(chunk)i(of)e(c)l(o)l(de.)h
Fk(i)p Fq(\021)676 5006 y Fi(//Mary)41 b(had)1905 5255
y Fz(11)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
12 13 bop 515 523 a Fk(h)p Fj(Continuing)27 b(chunk)i(of)e(c)l(o)l(de.)
h Fk(i)p Fz(+)p Fq(\021)676 614 y Fi(//a)40 b(little)h(lamb.)639
756 y Fz(Note)28 b(the)g(use)f(of)h(the)g(\\+")e(to)i(state)f(that)h
(the)g(c)n(h)n(unk)f(is)h(a)f(con)n(tin)n(uation.)639
855 y(Finally)-7 b(,)38 b(w)n(e)d(suggest)f(reading)h(this)g(do)r
(cumen)n(t)h(as)f(it)h(is.)60 b(Do)36 b(not)f(try)h(to)f(read)g(it)515
955 y(follo)n(wing)c(the)i(order)d(understo)r(o)r(d)i(b)n(y)g(a)g
Fx(C++)f Fz(compiler.)51 b(The)32 b(references)f(b)r(elo)n(w)h(eac)n(h)
515 1054 y(c)n(h)n(unk)27 b(will)h(allo)n(w)e(y)n(ou)h(to)g(na)n
(vigate)g(through)f(this)i(program's)e(w)n(eb.)515 1329
y Fr(1.5)135 b(T)-11 b(o)t(ols)515 1511 y Fz(T)k(o)34
b(implemen)n(t)i Fy(O\013)17 b Fx(++)34 b Fz(sev)n(eral)g(to)r(ols)g
(ha)n(v)n(e)g(b)r(een)h(used.)59 b(They)35 b(are)f(all)h(y)n(ou)f(need)
h(to)515 1610 y(build)28 b(a)f(system)g(image)g(from)h(the)g(on-line)f
(source)f(for)h(this)h(do)r(cumen)n(t.)639 1793 y Fq(\017)41
b Fz(L)744 1776 y Fp(A)781 1793 y Fz(T)827 1811 y(E)873
1793 y(X)g([15)o(])g(has)f(b)r(een)h(used)f(to)h(t)n(yp)r(eset)g(do)r
(cumen)n(ts,)i(including)e(the)g(prin)n(ted)722 1893
y(v)n(ersion)26 b(of)i(the)g(literate)f(source)f(co)r(de.)639
2059 y Fq(\017)41 b Fu(C)7 b Fx(++)24 b Fz([18)o(])g(has)g(b)r(een)g
(the)h(programming)d(language)g(emplo)n(y)n(ed.)35 b(The)24
b(GNU)h(C)f(and)722 2158 y Fu(C)7 b Fx(++)27 b Fz(compiler)g(named)h
(GCC)f(is)h(the)g(one)f(w)n(e)g(use.)639 2324 y Fq(\017)41
b Fz(As)25 b(a)f(supp)r(ort)h(for)f(literate)g(programming,)f
Fx(noweb)f Fz([17])i(has)g(pro)n(v)n(en)f(to)i(b)r(e)g(a)f(nice)722
2424 y(to)r(ol.)639 2590 y Fq(\017)41 b Fz(The)36 b(dev)n(elopmen)n(t)e
(en)n(vironmen)n(t)g(is)i(a)e(GNU)i(based)f(Lin)n(ux)g(system)g(kno)n
(wn)g(as)722 2690 y(RedHat)28 b(GNU/Lin)n(ux.)639 2856
y Fq(\017)41 b Fz(Last,)25 b(but)h(not)e(least)h(\(indeed,)h(w)n(e)e
(should)g(write)h(\\most"\))f(w)n(e)g(use)h(the)g(OSKit)f([9])722
2955 y(for)j(most)h(of)f(the)h(lo)n(w-lev)n(el)e(hardw)n(are)g(glue)h
(co)r(de.)639 3138 y(All)e(these)f(to)r(ols)f(ha)n(v)n(e)g(b)r(een)h
(already)e(used)i(in)h(the)f(construction)f(of)h(the)g(original)e
Fy(O\013)515 3238 y Fz(protot)n(yp)r(e.)1905 5255 y(12)p
eop
PStoPSsaved restore
%%Page: (14,15) 8
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
13 14 bop 515 1146 a Fs(Chapter)64 b(2)515 1561 y Fv(System)77
b(structure)722 1993 y FA(NOTE:)44 b Fz(XXX)i(Clearly)d(iden)n(tify)j
(ev)n(ery)d(design)h(pattern)h(b)r(eing)f(used.)722 2092
y(Should)28 b(cite)g(the)g(on-line)f(w3)g(reference.)515
2366 y Fr(2.1)135 b(The)37 b(k)l(ernel)g(mo)t(dules)g(and)g(the)g
(source)g(hiearc)l(h)l(y)515 2564 y Fn(2.1.1)112 b(The)38
b(k)m(ernel)f(library)515 2718 y Fz(Those)28 b(utilities)i(used)f(ev)n
(erywhere)e(will)j(b)r(e)f(included)h(in)f(a)g(library)e(termed)j(the)f
(k)n(ernel)515 2817 y(library)-7 b(.)35 b(In)28 b(this)g(section)f(w)n
(e)g(describ)r(e)h(it.)515 3049 y Fn(2.1.2)112 b(The)38
b(source)g(co)s(de)f(hierarc)m(h)m(y)515 3202 y Fz(The)27
b(top-lev)n(el)g(directory)f(con)n(tains:)515 3364 y
FA(Build)40 b Fz(Where)28 b(the)g(whole)f(thing)h(is)f(built.)515
3529 y FA(CVS)41 b Fz(Used)28 b(for)f(the)h(v)n(ersion)e(con)n(trol)h
(system.)515 3693 y FA(GNUmak)m(e\014le)40 b Fz(The)28
b(mak)n(e\014le)f(whic)n(h)g(go)n(v)n(erns)f(compilation.)515
3857 y FA(HTML)41 b Fz(Where)28 b(the)g(HTML)g(v)n(ersion)e(of)h(the)h
(co)r(de)g(is)f(k)n(ept.)515 4021 y FA(NOTES)41 b Fz(A)28
b(c)n(hange-log)d(\014le.)515 4185 y FA(TODO)41 b Fz(The)28
b(list)g(of)f(things)h(to)f(b)r(e)h(done.)515 4349 y
FA(dmm)38 b Fz(The)28 b(co)r(de)f(for)h(the)g Ft(dmm)f
Fz(system)g(serv)n(er.)515 4514 y FA(h)m(w)42 b Fz(The)27
b(co)r(de)h(for)f(hardw)n(are)e(resource)h(con)n(tainers.)515
4678 y FA(no)s(de)40 b Fz(The)28 b(co)r(de)g(for)f(the)h(no)r(de)f
(system)h(serv)n(er.)515 4842 y FA(prtl)41 b Fz(The)28
b(co)r(de)f(for)g(the)h(p)r(ortal)f(system)h(serv)n(er.)515
5006 y FA(sh)m(tl)41 b Fz(The)28 b(co)r(de)f(for)g(the)h(sh)n(uttle)g
(system)f(serv)n(er.)1905 5255 y(13)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
14 15 bop 515 523 a FA(klib)41 b Fz(The)25 b(co)r(de)g(for)g(generic)f
(co)r(de)i(used)f(through)f(the)i(k)n(ernel.)35 b(This)26
b(includes)f(abstract)722 623 y(classes)i(and)g(small)g(utilities.)515
789 y FA(include)41 b Fz(A)28 b(directory)e(whic)n(h)h(should)h(b)r(e)g
(included)g(to)f(compile)h Fu(C)7 b Fx(++)27 b Fz(source)f(\014les.)639
955 y(Eac)n(h)h(directory)f(con)n(tains)h(these)g(directories:)515
1121 y FA(Build)40 b Fz(A)28 b(directory)f(to)g(k)n(eep)g(ob)5
b(ject)27 b(and)h(temp)r(orary)e(\014les.)515 1287 y
FA(CVS)41 b Fz(Used)28 b(for)f(the)h(v)n(ersion)e(con)n(trol)h(system.)
515 1453 y FA(F)-8 b(ramew)m(ork)41 b Fz(This)28 b(is)f(the)h(place)f
(where)g(the)h(source)f(literate)g(co)r(de)g(is)h(k)n(ept.)764
1619 y Fx(IntelPC)d Fz(Mac)n(hine)i(dep)r(enden)n(t)h(\014les)f(for)h
(In)n(tel)f(based)g(PCs.)722 1752 y FA(Solaris)41 b Fz(Mac)n(hine)27
b(dep)r(enden)n(t)h(\014les)g(for)f(Solaris)f(hosted)i(en)n(vironmen)n
(ts.)515 1918 y FA(Src)42 b Fz(The)30 b Fu(C)7 b Fx(++)28
b Fz(co)r(de)i(generated)e(automatically)g(from)h(the)h(literate)f
(source)g(co)r(de)g(\(not)722 2017 y(con)n(taining)e(an)n(y)g(in)n
(terface)g(headers)f(nor)h(mac)n(hine)g(dep)r(enden)n(t)h(co)r(de\).)
515 2183 y FA(In)m(terface)43 b Fz(Headers)26 b(exp)r(orted)i(to)f
(other)g(system)g(serv)n(ers.)515 2350 y FA(Mac)m(hDep)42
b Fz(Mac)n(hine)27 b(dep)r(enden)n(t)h Fu(C)7 b Fx(++)27
b Fz(co)r(de)h(generated)e(from)i(the)g(literate)f(source.)639
2516 y(The)h(top-lev)n(el)f Fx(include)d Fz(directory)j(has:)639
2682 y Fq(\017)41 b Fz(links)e(to)f Fx(Interface)d Fz(directories)i(so)
h(that)g(a)g(single)g(\\)p Fx(-I<topdir>/inclu)o(de)o
Fz(")722 2781 y(option)28 b(is)f(needed)h(when)g(compiling)f
Fu(C)7 b Fx(++)27 b Fz(co)r(de.)639 2947 y Fq(\017)41
b Fz(A)28 b Fx(flux)e Fz(link)i(to)f(the)h(OSKit)g(include)g(directory)
-7 b(,)26 b(for)h(the)h(same)f(purp)r(ose.)639 3113 y
Fq(\017)41 b Fz(links)28 b(to)f(the)h(minimal)g(k)n(ernel)f
Fu(C)g Fz(library)g(header)f(\014les.)515 3388 y Fr(2.2)135
b(Exp)t(orting)45 b(system)h(ob)7 b(jects)515 3570 y
Fz(System)29 b(services)e(are)h(made)g(of)h(a)f(bunc)n(h)h(of)f(system)
h(ob)5 b(jects)28 b(exp)r(orted)g(to)h(users.)39 b(The)515
3669 y(mo)r(del)27 b(is)f(actually)g(more)g(generic:)35
b(p)r(ortals)26 b(are)g(used)h(whenev)n(er)e(a)i(protection)e(domain)
515 3769 y(w)n(an)n(ts)h(to)i(exp)r(ort)f(certain)g(services)f(in)i(a)f
(secure)g(w)n(a)n(y)f(to)h(alien)h(users.)36 b(F)-7 b(or)27
b(eac)n(h)f(ob)5 b(ject)515 3869 y(b)r(eing)27 b(exp)r(orted,)h(a)f
(set)g(of)h(metho)r(ds)g(are)e(made)i(a)n(v)-5 b(ailable)26
b(b)n(y)h(means)h(of)f(p)r(ortals.)515 4101 y Fn(2.2.1)112
b(T)-9 b(raps)38 b(and)g(the)g(OO)f(mo)s(del)515 4254
y Fz(The)d Fy(O\013)17 b Fx(++)33 b Fw(\026)p Fz(k)n(ernel)h(is)f(an)h
(ob)5 b(ject)34 b(orien)n(ted)f(system.)56 b(Ho)n(w)n(ev)n(er,)34
b(the)h(b)r(oundary)e(b)r(e-)515 4354 y(t)n(w)n(een)24
b(the)h(user)e(and)i(the)g(k)n(ernel)e(is)i(pro)r(cedural:)34
b(p)r(ortals)23 b(are)h(used)g(to)g(p)r(erform)g(system)515
4453 y(calls)j(\(implemen)n(ted)h(in)g(turn)g(b)n(y)f(means)g(of)h
(traps\),)f(as)g(can)g(b)r(e)h(seen)f(in)h(\014gure)f(2.1.)639
4553 y(The)h(path)g(for)f(a)g(system)g(call)g(pro)r(ceeds)g(as)g(follo)
n(ws:)616 4719 y(1.)41 b(A)28 b(user)f(ob)5 b(ject)28
b(calls)f(a)g(system)g(ob)5 b(ject)27 b(metho)r(d.)616
4885 y(2.)41 b(The)34 b(system)f(ob)5 b(ject)33 b(is)h(actually)e(a)h
(wrapp)r(er)g(that)h(will)f(translate)g(the)h(metho)r(d)722
4985 y(in)n(v)n(o)r(cation)27 b(in)n(to)g(a)g(p)r(ortal)g(in)n(v)n(o)r
(cation.)1905 5255 y(14)p eop
PStoPSsaved restore
%%Page: (16,17) 9
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
15 16 bop 1120 1449 a @beginspecial 0 @llx 0 @lly 344
@urx 210 @ury 1984 @rwi @setspecial
%%BeginDocument: fig/wrappers.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-54.0 231.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Ellipse
n 3750 3150 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 3331 2969 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4156 2744 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4381 3344 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4831 2969 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 5431 3344 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Polyline
gs  clippath
5214 3199 m 5301 3286 l 5184 3250 l 5322 3333 l 5353 3282 l  cp clip
n 4950 3075 m 5325 3300 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 5214 3199 m 5301 3286 l 5184 3250 l  col-1 s
% Polyline
gs  clippath
4722 3405 m 4602 3375 l 4722 3345 l 4560 3345 l 4560 3405 l  cp clip
n 5250 3375 m 4575 3375 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 4722 3405 m 4602 3375 l 4722 3345 l  col-1 s
% Polyline
gs  clippath
4332 3001 m 4341 3124 l 4275 3020 l 4326 3174 l 4383 3155 l  cp clip
n 4275 2925 m 4350 3150 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 4332 3001 m 4341 3124 l 4275 3020 l  col-1 s
% Polyline
gs  clippath
4428 2895 m 4548 2925 l 4428 2955 l 4590 2955 l 4590 2895 l  cp clip
n 4275 2925 m 4575 2925 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 4428 2895 m 4548 2925 l 4428 2955 l  col-1 s
% Polyline
gs  clippath
3600 2859 m 3476 2846 l 3591 2800 l 3431 2822 l 3439 2882 l  cp clip
n 3975 2775 m 3450 2850 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 3600 2859 m 3476 2846 l 3591 2800 l  col-1 s
% Polyline
gs  clippath
4150 3218 m 4249 3289 l 4127 3273 l 4278 3333 l 4300 3278 l  cp clip
n 3900 3150 m 4275 3300 l gs col7 0.50 shd ef gr gs col-1 s gr gr

% arrowhead
n 4150 3218 m 4249 3289 l 4127 3273 l  col-1 s
% Polyline
n 2700 2475 m 5700 2475 l 5700 3825 l 2700 3825 l cp gs col-1 s gr 
/Times-Roman ff 180.00 scf sf
1275 3150 m
gs 1 -1 sc (Off++ microkernel) col-1 sh gr
/Times-Italic ff 180.00 scf sf
3825 3675 m
gs 1 -1 sc (kernel objects) col-1 sh gr
% Ellipse
n 3308 916 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4283 766 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 5183 841 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 3675 1650 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4283 1591 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4883 1666 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 2925 675 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 3750 975 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

% Ellipse
n 4800 600 150 150 0 360 DrawEllipse gs col7 0.50 shd ef gr gs col-1 s gr

15.000 slw
% Polyline
n 2475 2025 m 6600 2025 l gs col-1 s gr 
7.500 slw
% Polyline
n 2700 1350 m 5700 1350 l 5700 1875 l 2700 1875 l cp gs col-1 s gr 
% Polyline
n 2700 375 m 5700 375 l 5700 1275 l 2700 1275 l cp gs col-1 s gr 
% Polyline
 [66.7] 0 sd
gs  clippath
4086 2480 m 4112 2600 l 4032 2507 l 4105 2652 l 4159 2625 l  cp clip
n 3675 1725 m 4125 2625 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 4086 2480 m 4112 2600 l 4032 2507 l  col-1 s
% Polyline
 [66.7] 0 sd
gs  clippath
4243 2406 m 4202 2523 l 4183 2401 l 4169 2562 l 4229 2568 l  cp clip
n 4275 1725 m 4200 2550 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 4243 2406 m 4202 2523 l 4183 2401 l  col-1 s
% Polyline
 [66.7] 0 sd
gs  clippath
4905 2703 m 4875 2823 l 4845 2703 l 4845 2865 l 4905 2865 l  cp clip
n 4875 1875 m 4875 2850 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 4905 2703 m 4875 2823 l 4845 2703 l  col-1 s
/Times-Italic ff 180.00 scf sf
900 1725 m
gs 1 -1 sc (system object wrappers) col-1 sh gr
/Times-Italic ff 180.00 scf sf
2100 2100 m
gs 1 -1 sc (trap) col-1 sh gr
/Times-Italic ff 180.00 scf sf
900 825 m
gs 1 -1 sc (application objects) col-1 sh gr
/Times-Roman ff 180.00 scf sf
4950 2325 m
gs 1 -1 sc (portal calls) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 1510 1632 a Fz(Figure)27 b(2.1:)36 b(System)28
b(calls)616 1980 y(3.)41 b(The)28 b(p)r(ortal)f(in)n(v)n(o)r(cation)f
(will)i(transfer)f(the)h(user)f(con)n(trol)f(\015o)n(w)h(to)g(the)h(k)n
(ernel.)616 2146 y(4.)41 b(Inside)28 b(the)f(k)n(ernel,)g(a)g(system)g
(ob)5 b(ject)27 b(metho)r(d)h(\(that)g(wrapp)r(ed)f(b)n(y)g(the)h
(wrapp)r(er)722 2246 y(ob)5 b(ject)24 b(in)h(step)g(1\))f(will)h(b)r(e)
f(called)h(as)e(part)h(of)h(the)f(p)r(ortal)g(deliv)n(ering)g(mec)n
(hanism.)639 2412 y(Only)j(step)g(3)f(is)h(pro)r(cedural.)35
b(Both)27 b(user)f(and)h(k)n(ernel)f(ob)5 b(jects)26
b(think)i(that)f(they)g(are)515 2512 y(calling)i(no)n(w)g(and)h(then)g
(to)g(other)f(ob)5 b(jects.)43 b(But)31 b(whenev)n(er)e(a)g(protection)
g(domain)h(has)515 2611 y(to)d(b)r(e)h(crossed,)e(a)i(p)r(ortal)f(is)g
(used.)639 2711 y(In)32 b(this)g(w)n(a)n(y)f(no)g(remote)g(metho)r(d)h
(in)n(v)n(o)r(cation)f(has)g(to)h(b)r(e)g(built)g(inside)g(the)g(k)n
(ernel)515 2811 y(so)27 b(that)h(it)g(could)f(b)r(e)h(k)n(ept)f
(simple.)639 2910 y(Th)n(us,)e(the)h(only)e(actual)g(system)h(calls)f
(are)g(those)g(needed)h(to)g(implemen)n(t)g(the)h(p)r(ortal)515
3010 y(deliv)n(ering)k(mec)n(hanism.)46 b(Remaining)31
b(system)g(services)f(are)g(\014rst)h(pro)n(vided)f(b)n(y)h(means)515
3109 y(of)c(p)r(ortals)g(and)g(then)i(wrapp)r(ed)e(at)g(user)g(lev)n
(el)g(b)n(y)h(ob)5 b(jects.)639 3209 y(T)-7 b(o)31 b(mak)n(e)f(it)i
(clear)e(what)h(system)g(services)f(are)g(b)r(eing)h(exp)r(orted)g(to)g
(the)h(user,)f(and)515 3309 y(also)39 b(to)h(a)n(v)n(oid)f(in-k)n
(ernel)g(authen)n(tication)h(\(e.g.)75 b(unnecessary)39
b(access)g(c)n(hec)n(ks)g(when)515 3408 y(op)r(erations)30
b(are)h(requested)h(b)n(y)g(the)g(k)n(ernel)f(itself)6
b(\))33 b(w)n(e)f(will)g(wrap)f(ev)n(ery)g(ob)5 b(ject)32
b(b)r(eing)515 3508 y(exp)r(orted)23 b(to)h(the)g(user.)35
b(Those)24 b(wrapp)r(ers)e(will)j(b)r(e)f(named)g(with)g(the)h
(pre\014x)e Fx(off)p 3115 3508 27 4 v 30 w(u)3184 3478
y Fp(1)3245 3508 y Fz(and)515 3608 y(are)j(describ)r(ed)i(in)g(the)g
(user)f(reference)f(man)n(ual.)639 3707 y(In)31 b(what)f(follo)n(ws,)h
(after)f(describing)g(the)h(actual)f(implemen)n(tation)g(of)h(eac)n(h)e
(system)515 3807 y(service,)d(w)n(e)i(will)f(describ)r(e)h(the)g(wrapp)
r(ers)e(used)i(to)f(exp)r(ort)g(its)h(in)n(terface.)515
4081 y Fr(2.3)135 b(Resource)46 b(building)f(blo)t(c)l(ks)515
4263 y Fz(There)27 b(are)g(some)h(basic)f(in)n(terfaces)g(whic)n(h)h(m)
n(ust)g(b)r(e)g(presen)n(t)g(on)f(almost)h(ev)n(ery)e(system)515
4363 y(ob)5 b(ject.)70 b(They)39 b(w)n(ere)f(initially)h(inherited)g(b)
n(y)f(the)i Fx(Resource)2574 4333 y Fp(2)2647 4363 y
Fz(class,)g(whic)n(h)f(mo)r(dels)515 4462 y(system)27
b(resources,)e(as)i(can)g(b)r(e)g(seen)g(in)h(\014gure)e(2.2,)h(but)h
(w)n(e)f(will)g(b)r(e)h(using)f(aggregation)515 4562
y(instead)g(\(see)h(\014gure)f(2.3\))g(to)g(a)n(v)n(oid)f(m)n(ultiple)i
(inheritance)2412 4532 y Fp(3)2449 4562 y Fz(.)p 515
4636 1146 4 v 607 4690 a Fm(1)642 4713 y Fl(The)c(\\u")g(stands)g(for)f
(\\user".)607 4769 y Fm(2)642 4792 y Fl(Although)h(in)g(the)g(co)r(de)h
(w)n(e)f(will)e(b)r(e)i(using)g(the)g(pre\014x)g Fh(off)p
2266 4792 22 4 v 50 w Fl(w)n(e)g(will)e(omit)h(it)h(in)f(this)h(text.)
607 4848 y Fm(3)642 4872 y Fl(F)-6 b(abio)24 b(seems)f(to)h(hate)h(it.)
1905 5255 y Fz(15)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
16 17 bop 1120 2351 a @beginspecial 0 @llx 0 @lly 263
@urx 304 @ury 1984 @rwi @setspecial
%%BeginDocument: fig/old-res.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-6.0 312.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 2250 1425 m 2100 1575 l 2400 1575 l 2250 1425 l gs col-1 s gr 
% Polyline
n 2250 900 m 2250 1425 l gs col-1 s gr 
% Polyline
n 2325 3825 m 2175 3975 l 2475 3975 l 2325 3825 l gs col-1 s gr 
% Polyline
n 2325 3600 m 2325 3825 l gs col-1 s gr 
/Courier ff 180.00 scf sf
1875 2625 m
gs 1 -1 sc (freeze\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1875 2805 m
gs 1 -1 sc (melt\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1875 2985 m
gs 1 -1 sc (new\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1875 3165 m
gs 1 -1 sc (delete\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1875 3345 m
gs 1 -1 sc (dump\(\)) col-1 sh gr
% Polyline
n 1725 2100 m 2925 2100 l 2925 3450 l 1725 3450 l cp gs col-1 s gr 
% Polyline
n 1725 2400 m 2925 2400 l gs col-1 s gr 
/Courier ff 165.00 scf sf
1905 2355 m
gs 1 -1 sc (Resource) col-1 sh gr
% Polyline
n 118 150 m 1531 150 l 1531 900 l 118 900 l cp gs col-1 s gr 
% Polyline
n 118 400 m 1531 400 l gs col-1 s gr 
% Polyline
n 900 4425 m 2250 4425 l 2250 5175 l 900 5175 l cp gs col-1 s gr 
% Polyline
n 900 4675 m 2250 4675 l gs col-1 s gr 
% Polyline
n 825 900 m 825 1575 l 3750 1575 l 3750 900 l gs col-1 s gr 
% Polyline
n 2250 1575 m 2250 2100 l gs col-1 s gr 
% Polyline
n 1800 4425 m 1800 3975 l 3825 3975 l 3825 4425 l gs col-1 s gr 
% Polyline
gs  clippath
1578 2895 m 1698 2925 l 1578 2955 l 1740 2955 l 1740 2895 l  cp clip
n 900 4725 m 525 4725 l 525 2925 l 1725 2925 l gs col-1 s gr gr

% arrowhead
n 1578 2895 m 1698 2925 l 1578 2955 l  col-1 s
% Polyline
n 2325 3750 m 2325 3450 l gs col-1 s gr 
% Polyline
n 2775 3975 m 2775 4425 l gs col-1 s gr 
% Polyline
n 1725 150 m 2925 150 l 2925 900 l 1725 900 l cp gs col-1 s gr 
% Polyline
n 1725 400 m 2925 400 l gs col-1 s gr 
% Polyline
n 3075 150 m 4275 150 l 4275 900 l 3075 900 l cp gs col-1 s gr 
% Polyline
n 3075 400 m 4275 400 l gs col-1 s gr 
% Polyline
n 2400 4425 m 3075 4425 l 3075 5025 l 2400 5025 l cp gs col-1 s gr 
% Polyline
n 2400 4625 m 3075 4625 l gs col-1 s gr 
% Polyline
n 3262 4425 m 4462 4425 l 4462 5175 l 3262 5175 l cp gs col-1 s gr 
% Polyline
n 3262 4675 m 4462 4675 l gs col-1 s gr 
/Courier ff 165.00 scf sf
3255 375 m
gs 1 -1 sc (Lockable) col-1 sh gr
/Courier ff 165.00 scf sf
165 375 m
gs 1 -1 sc (AccessChecked) col-1 sh gr
/Courier ff 165.00 scf sf
1830 375 m
gs 1 -1 sc (RefCounted) col-1 sh gr
/Courier ff 165.00 scf sf
930 4575 m
gs 1 -1 sc (CompResource) col-1 sh gr
/Courier ff 165.00 scf sf
2550 4575 m
gs 1 -1 sc (Node) col-1 sh gr
/Courier ff 165.00 scf sf
3487 4575 m
gs 1 -1 sc (ResUnit) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 1079 2534 a Fz(Figure)27 b(2.2:)36 b(Initial)28
b(resource)e(hierarc)n(h)n(y)f(\(not)j(used\))515 2887
y Fn(2.3.1)112 b(Protection)515 3040 y Fz(T)-7 b(o)21
b(protect)g(ob)5 b(ject)22 b(access)e(w)n(e)i(de\014ne)g(a)f(generic)g
(set)g(of)h(access)e(op)r(erations)h(\(read,)h(write,)515
3140 y(execute,)32 b(delete,)g(and)g(protect)e(in)i(the)g(curren)n(t)e
(implemen)n(tation)2667 3110 y Fp(4)2704 3140 y Fz(\))i(and)f(for)g
(eac)n(h)f(one)515 3239 y(w)n(e)d(ha)n(v)n(e)f(a)i Fx(Protection)23
b Fz(ob)5 b(ject)27 b(sp)r(ecifying)h(the)g(protection)f(for)g(suc)n(h)
g(op)r(eration.)515 3372 y Fk(h)p Fj(O\013)g(ac)l(c)l(ess)i(op)l(er)l
(ations.)g Fk(i)p Fq(\021)598 3463 y Fi(//)39 b(Operations)j(which)e
(can)g(be)g(protected.)598 3555 y(enum)79 b({)40 b(OFF_OP_R=0,)198
b(//)40 b(Read)912 3646 y(OFF_OP_W,)276 b(//)40 b(Write)912
3737 y(OFF_OP_X,)276 b(//)40 b(eXecute)912 3829 y(OFF_OP_D,)276
b(//)40 b(Deletion)912 3920 y(OFF_OP_P)315 b(//)40 b(Protection)598
4011 y(};)598 4103 y(typedef)h(int)e(off_op_t;)598 4285
y(//)g(#)h(of)g(defined)g(operations.)598 4377 y(const)g(natural_t)h
(OFF_NOPS)g(=)f(5;)p 515 4929 1146 4 v 607 4983 a Fm(4)642
5006 y Fl(Although)24 b(nothing)h(prev)n(en)n(ts)g(future)f(extensions)
h(to)f(consider)g(p)r(er-resource)f(op)r(erations.)1905
5255 y Fz(16)p eop
PStoPSsaved restore
%%Page: (18,19) 10
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
17 18 bop 515 2211 a @beginspecial 0 @llx 0 @lly 448
@urx 277 @ury 3437 @rwi @setspecial
%%BeginDocument: fig/res.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-8.0 321.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 525 3675 m 1875 3675 l 1875 4425 l 525 4425 l cp gs col-1 s gr 
% Polyline
n 525 3925 m 1875 3925 l gs col-1 s gr 
% Polyline
n 2025 4500 m 2700 4500 l 2700 5100 l 2025 5100 l cp gs col-1 s gr 
% Polyline
n 2025 4700 m 2700 4700 l gs col-1 s gr 
/Courier ff 165.00 scf sf
2175 4650 m
gs 1 -1 sc (Node) col-1 sh gr
% Polyline
n 2887 3675 m 4087 3675 l 4087 4425 l 2887 4425 l cp gs col-1 s gr 
% Polyline
n 2887 3925 m 4087 3925 l gs col-1 s gr 
% Polyline
n 3262 4575 m 4462 4575 l 4462 5325 l 3262 5325 l cp gs col-1 s gr 
% Polyline
n 3262 4825 m 4462 4825 l gs col-1 s gr 
% Polyline
n 2400 3225 m 2400 4500 l gs col-1 s gr 
% Polyline
n 1425 3675 m 1425 3225 l 3450 3225 l 3450 3675 l gs col-1 s gr 
% Polyline
n 2700 4875 m 2850 4950 l 3000 4875 l 2850 4800 l 2700 4875 l gs col-1 s gr 
% Polyline
gs  clippath
3078 4845 m 3198 4875 l 3078 4905 l 3240 4905 l 3240 4845 l  cp clip
n 3000 4875 m 3225 4875 l gs col-1 s gr gr

% arrowhead
n 3078 4845 m 3198 4875 l 3078 4905 l  col-1 s
/Courier ff 165.00 scf sf
555 3825 m
gs 1 -1 sc (CompResource) col-1 sh gr
/Courier ff 165.00 scf sf
3112 3825 m
gs 1 -1 sc (ResUnit) col-1 sh gr
/Courier ff 165.00 scf sf
3450 4800 m
gs 1 -1 sc (Sequencer) col-1 sh gr
% Polyline
n 1950 3075 m 1800 3225 l 2100 3225 l 1950 3075 l gs col-1 s gr 
% Polyline
n 1950 2850 m 1950 3075 l gs col-1 s gr 
/Courier ff 180.00 scf sf
1500 1275 m
gs 1 -1 sc (freeze\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1500 1455 m
gs 1 -1 sc (melt\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1500 1635 m
gs 1 -1 sc (new\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1500 1815 m
gs 1 -1 sc (delete\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
1500 1995 m
gs 1 -1 sc (dump\(\)) col-1 sh gr
% Polyline
n 1350 750 m 2550 750 l 2550 2325 l 1350 2325 l cp gs col-1 s gr 
% Polyline
n 1350 1100 m 2550 1100 l gs col-1 s gr 
% Polyline
n 2550 1050 m 2700 1125 l 2850 1050 l 2700 975 l 2550 1050 l gs col-1 s gr 
% Polyline
n 2850 1050 m 3075 1050 l gs col-1 s gr 
% Polyline
n 2700 1425 m 4162 1425 l 4162 2175 l 2700 2175 l cp gs col-1 s gr 
% Polyline
n 2700 1675 m 4162 1675 l gs col-1 s gr 
/Courier ff 165.00 scf sf
2790 1650 m
gs 1 -1 sc (AccessChecker) col-1 sh gr
% Polyline
n 4050 2400 m 5512 2400 l 5512 3150 l 4050 3150 l cp gs col-1 s gr 
% Polyline
n 4050 2650 m 5512 2650 l gs col-1 s gr 
/Courier ff 165.00 scf sf
4200 2625 m
gs 1 -1 sc (Protection) col-1 sh gr
% Polyline
n 6375 2400 m 7575 2400 l 7575 3150 l 6375 3150 l cp gs col-1 s gr 
/Courier ff 165.00 scf sf
6705 2625 m
gs 1 -1 sc (Lock) col-1 sh gr
% Polyline
gs  clippath
1203 1545 m 1323 1575 l 1203 1605 l 1365 1605 l 1365 1545 l  cp clip
n 525 3975 m 150 3975 l 150 1575 l 1350 1575 l gs col-1 s gr gr

% arrowhead
n 1203 1545 m 1323 1575 l 1203 1605 l  col-1 s
% Polyline
n 1950 3000 m 1950 2325 l gs col-1 s gr 
% Polyline
n 5400 1425 m 6600 1425 l 6600 2175 l 5400 2175 l cp gs col-1 s gr 
% Polyline
n 5400 1675 m 6600 1675 l gs col-1 s gr 
% Polyline
n 6375 2700 m 7575 2700 l gs col-1 s gr 
% Polyline
gs  clippath
6105 1278 m 6075 1398 l 6045 1278 l 6045 1440 l 6105 1440 l  cp clip
n 3075 1050 m 6075 1050 l 6075 1425 l gs col-1 s gr gr

% arrowhead
n 6105 1278 m 6075 1398 l 6045 1278 l  col-1 s
% Polyline
gs  clippath
6930 2253 m 6900 2373 l 6870 2253 l 6870 2415 l 6930 2415 l  cp clip
n 3075 1050 m 6900 1050 l 6900 2400 l gs col-1 s gr gr

% arrowhead
n 6930 2253 m 6900 2373 l 6870 2253 l  col-1 s
% Polyline
gs  clippath
3555 1278 m 3525 1398 l 3495 1278 l 3495 1440 l 3555 1440 l  cp clip
n 3075 1050 m 3525 1050 l 3525 1425 l gs col-1 s gr gr

% arrowhead
n 3555 1278 m 3525 1398 l 3495 1278 l  col-1 s
% Polyline
gs  clippath
4755 2253 m 4725 2373 l 4695 2253 l 4695 2415 l 4755 2415 l  cp clip
n 2850 1050 m 4725 1050 l 4725 2400 l gs col-1 s gr gr

% arrowhead
n 4755 2253 m 4725 2373 l 4695 2253 l  col-1 s
/Courier ff 165.00 scf sf
1530 1005 m
gs 1 -1 sc (Resource) col-1 sh gr
/Courier ff 165.00 scf sf
5505 1650 m
gs 1 -1 sc (RefCounter) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 1293 2394 a Fz(Figure)27 b(2.3:)36 b(Basic)27
b(resource)f(hierarc)n(h)n(y)639 2742 y(T)-7 b(o)22 b(com)n(bine)g
(individual)g(op)r(erations)e(\(b)n(y)i(a)g(bit-or)f(op)r(eration\))h
(to)g(sp)r(ecify)g(an)g Fy(ac)l(c)l(ess)515 2842 y(mo)l(de)42
b Fz(\(e.g.)60 b Fx(OFF)p 1097 2842 27 4 v 30 w(M)p 1171
2842 V 31 w(R|OFF)p 1422 2842 V 29 w(M)p 1495 2842 V
31 w(X)35 b Fz(for)g(\\read)f(and)h(execute")g(access)f(mo)r(de\))i(a)f
(di\013eren)n(t)515 2941 y(data)27 b(t)n(yp)r(e)h(is)f(pro)n(vided.)515
3074 y Fk(h)p Fj(O\013)g(ac)l(c)l(ess)i(mo)l(de.)f Fk(i)p
Fq(\021)598 3165 y Fi(//)39 b(Operations)j(as)e(bits.)598
3257 y(enum)79 b({)40 b(OFF_M_R=0x1,)i(OFF_M_W=0x2,)912
3348 y(OFF_M_X=0x4,)g(OFF_M_D=0x8,)f(OFF_M_P=0x10)h(};)598
3439 y(typedef)f(int)e(off_mode_t;)598 3531 y(const)h(off_mode_t)i
(OFF_M_ALL=)f(OFF_M_R|OFF_M_W|OFF_M_X|OFF_M)q(_D|O)q(FF_M)q(_P;)1905
5255 y Fz(17)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
18 19 bop 639 523 a Fz(Also,)41 b(note)d(that)h Fx(natural)p
1562 523 27 4 v 29 w(t)f Fz(and)g(other)g(basic)f(t)n(yp)r(es)i(whic)n
(h)f(w)n(e)g(will)h(b)r(e)f(using)515 623 y(through)27
b(the)i(do)r(cumen)n(t)f(ha)n(v)n(e)f(to)h(b)r(e)h(de\014ned)f(in)g(a)g
(p)r(ortable)g(w)n(a)n(y)f(\(i.e.)38 b(ensuring)28 b(that)515
722 y(they)g(all)f(ha)n(v)n(e)f(the)i(same)f(size)h(across)d
(di\013eren)n(t)j(platforms\).)639 822 y(Three)f(di\013eren)n(t)h(ob)5
b(jects)27 b(are)g(in)n(v)n(olv)n(ed)f(in)i(protection:)639
986 y Fq(\017)41 b Fz(A)30 b Fx(Protection)c Fz(ob)5
b(ject)30 b(will)g(sp)r(ecify)g(the)g(protection)f(of)h(a)f(giv)n(en)g
Fx(Resource)e Fz(for)722 1085 y(di\013eren)n(t)h(access)e(mo)r(des.)639
1250 y Fq(\017)41 b Fz(A)35 b Fx(Rights)d Fz(ob)5 b(ject)34
b(sho)n(ws)f(the)i(access)e(righ)n(ts)g(held)i(b)n(y)f(the)g(user)g
(accessing)f(the)722 1350 y(resource.)639 1514 y Fq(\017)41
b Fx(AccessChecker)26 b Fz(ob)5 b(jects)30 b(implemen)n(t)h(the)g(p)r
(olicy)f(b)n(y)g(whic)n(h)h(access)e(is)h(gran)n(ted)722
1614 y(or)d(denied)h(for)f(a)g(giv)n(en)g Fx(Protection)p
Fz(,)d(access)i Fx(Rights)f Fz(and)j(access)e(mo)r(de.)639
1778 y(The)k(meaning)f(of)h Fx(Protection)c Fz(is)j(then)h(de\014ned)g
(b)n(y)g(the)g Fx(AccessChecker)24 b Fz(ob)5 b(ject.)515
1877 y(Ev)n(ery)17 b(time)j(the)g(system)f(w)n(an)n(ts)g(to)g(kno)n(w)f
(whether)i(access)e(is)h(gran)n(ted)f(or)h(denied,)i(it)f(calls)515
1977 y(the)h(resource)d Fx(access)p 1236 1977 V 29 w(granted)g
Fz(metho)r(d)j(\(whic)n(h)g(is)f(delegated)g(to)g(the)h
Fx(AccessChecker)515 2077 y Fz(with)30 b(the)g(user)f
Fx(Rights)e Fz(and)j(access)f Fx(op)p Fz(\).)42 b(T)-7
b(o)30 b(c)n(hange)e(the)i(protection)f(the)h(\(also)f(dele-)515
2176 y(gated\))e(metho)r(d)h Fx(protect)d Fz(is)i(called)h(instead.)515
2308 y Fk(h)p Fj(O\013)f(ac)l(c)l(ess)i(che)l(cker.)g
Fk(i)p Fq(\021)598 2399 y Fi(//)39 b(Checks)i(access)g(for)f(user)g
(operations)h(on)f(kernel)g(resources.)598 2490 y(//)598
2582 y(class)g(off_AccessChecker)j({)598 2673 y(public:)676
2764 y(//)d(Checks)g(for)g(access)h(rights)g(for)e(the)h(given)h
(operation.)676 2856 y(static)g(boolean_t)g(access_granted\()i(const)d
(off_op_t)h(op,)f(const)g(off_Rights)i(&r,)1696 2947
y(const)e(off_Protection)j(&p)d(\);)676 3130 y(//)g(Changes)h
(protection.)676 3221 y(static)g(void)f(protect\(off_Protection)k
(&old,)d(const)f(off_Protection)i(&now,)1186 3312 y(const)f(off_mode_t)
g(m\);)598 3404 y(};)639 3635 y Fz(Resources)25 b(that)h(need)h(to)f(b)
r(e)g(protected)g(will)g(delegate)g(its)g(protection)g(con)n(trol)e(to)
i(a)515 3735 y(system-wide)20 b Fx(AccessChecker)p Fz(.)29
b(Di\013eren)n(t)21 b(implemen)n(tations)f(of)h(the)g
Fx(off)p 2918 3735 V 30 w(Protection)515 3834 y Fz(in)n(terface)36
b(will)i(pro)n(vide)e(v)-5 b(arious)36 b(protection)g(mec)n(hanisms)h
(including)g(access)f(con)n(trol)515 3934 y(lists)29
b(and)f(capabilities.)41 b(The)29 b(protection)f(information)g(will)i
(b)r(e)f(k)n(ept)g(in)p 2904 3934 V 60 w Fx(prot)3106
3904 y Fp(5)3171 3934 y Fz(inside)515 4033 y(eac)n(h)e(ob)5
b(ject)27 b(b)r(eing)h(protected.)515 4165 y Fk(h)p Fj(O\013)f(private)
i(memb)l(ers)f(for)g(pr)l(ote)l(cte)l(d)i(obje)l(cts.)f
Fk(i)p Fq(\021)598 4256 y Fi(off_Protection)42 b(_prot;)198
b(//)39 b(protection)j(for)e(this)g(resource)639 4396
y Fz(Suc)n(h)23 b(mem)n(b)r(er)g(should)g(b)r(e)g(initialized)h(with)f
(a)g(user)f(giv)n(en)g(protection)g Fx(p)h Fz(at)g(resource)515
4496 y(instan)n(tiation)k(time.)515 4612 y Fk(h)p Fj(O\013)g
(initialization)g(for)g Fi(p)h Fj(pr)l(ote)l(cte)l(d)i(obje)l(cts.)f
Fk(i)p Fq(\021)598 4703 y Fi(_prot=p;)p 515 4771 1146
4 v 607 4825 a Fm(5)642 4848 y Fl(W)-6 b(e)32 b(will)e(pre\014x)i(an)n
(y)g(data)h(mem)n(b)r(er)d(of)h(a)h(class)f(with)h(the)g(initial)f
(letter)h(for)f(the)h(class)f(and)i(an)515 4927 y(underscore)27
b(\(\\)p 937 4927 22 4 v 26 w("\).)39 b(Those)26 b(mem)n(b)r(ers)e
(whic)n(h)j(ma)n(y)e(b)r(e)h(in)g(more)f(than)i(one)g(class)f(|lik)n(e)
f(the)i(reference)515 5006 y(coun)n(ter|)d(will)f(b)r(e)h(just)f
(pre\014xed)i(b)n(y)f(an)g(underscore.)1905 5255 y Fz(18)p
eop
PStoPSsaved restore
%%Page: (20,21) 11
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
19 20 bop 515 523 a Fk(h)p Fj(O\013)27 b(public)g(metho)l(ds)i(for)f
(pr)l(ote)l(cte)l(d)i(obje)l(cts.)f Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Returns)i(the)f(protection.)598 706
y(const)g(off_Protection)j(&get_protection\(void\))h(const)c({)f
(return)i(_prot;)g(})598 797 y(//)e(Checks)i(access)g(for)f(access)g
(rights)h(R)e(and)h(operation)h(OP.)598 888 y(inline)80
b(boolean_t)41 b(access_granted\()h(const)f(off_op_t)g(op,)f(const)g
(off_Rights)i(&r)d(\))h({)715 980 y(return)h
(off_AccessChecker::access_gra)q(nted)q(\(op,r)q(,_pr)q(ot\);)598
1071 y(})598 1162 y(//)e(Sets)i(P)e(as)h(protection)h(for)f(M)g(access)
g(mode.)598 1254 y(inline)g(void)g(protect\(const)j(off_Protection)f
(&p,)e(const)g(off_mode_t)i(m=OFF_M_ALL\))g({)715 1345
y(off_AccessChecker::protect\()q(_prot)q(,p,m)q(\);)598
1436 y(})639 1669 y Fz(The)e(sp)r(eci\014c)g Fx(Protection)c
Fz(mec)n(hanism)j(b)r(eing)h(used)f(can)h(b)r(e)g(c)n(hanged)f(without)
515 1768 y(disturbing)27 b(the)i(rest)e(of)h(the)g(co)r(de.)38
b(Once)27 b(the)h Fy(b)l(est)36 b Fz(protection)27 b(mec)n(hanism)g(b)r
(e)i(kno)n(wn)515 1868 y(empirically)-7 b(,)22 b(the)g(system)g(can)g
(b)r(e)g(optimized)g(b)n(y)g(hardwiring)e(it)i(and)g(a)n(v)n(oiding)e
(dynamic)515 1968 y(dispatc)n(hing.)639 2067 y(Initially)-7
b(,)27 b(a)e Fx(Protection)d Fz(is)j(de\014ned)h(as)g(a)f(big)g(random)
g(n)n(um)n(b)r(er)h(p)r(er)g(op)r(eration.)35 b(A)515
2167 y(sp)r(ecial)j(v)-5 b(alue)38 b(is)g(de\014ned)g(to)g(gran)n(t)f
(access)g(without)i(further)f(c)n(hec)n(king.)67 b(A)38
b Fx(Rights)515 2267 y Fz(ob)5 b(ject)43 b(is)h(also)f(a)h(big)g
(random)f(n)n(um)n(b)r(er.)85 b(They)44 b(are)f(used)h(as)g
(capabilities.)85 b(The)515 2366 y Fx(AccessChecker)21
b Fz(considers)26 b(the)h(access)f(to)h(b)r(e)g(gran)n(ted)f(if)h
Fx(Rights)e Fz(matc)n(hes)h(the)h(n)n(um-)515 2466 y(b)r(ers)f(found)i
(in)f Fx(Protection)c Fz(for)j(the)i(access)d(mo)r(de)j(b)r(eing)f(sp)r
(eci\014ed.)37 b(W)-7 b(e)27 b(b)r(eliev)n(e)g(that)515
2565 y(an)n(y)g(other)g(protection)f(mo)r(del)i(can)f(b)r(e)h(quic)n
(kly)f(incorp)r(orated.)515 2698 y Fk(h)p Fj(O\013)g(pr)l(ote)l(ction)j
(b)l(asic)e(typ)l(es.)g Fk(i)p Fq(\021)598 2790 y Fi(//)39
b(Random)i(nb.)f(used)g(to)g(protect)h(operations.)598
2881 y(typedef)g(unsigned32_t)h(off_cap_t;)598 2972 y(//)d(When)i(set,)
f(grants)g(access)h(without)g(further)g(checking.)598
3064 y(const)f(off_cap_t)h(OFF_CAP_ALLOW=0;)515 3329
y Fk(h)p Fj(O\013)27 b(pr)l(ote)l(ction.)i Fk(i)p Fq(\021)598
3512 y Fi(//)39 b(Protection)j(information)g(for)e(system)g(resources.)
598 3603 y(//)598 3694 y(class)g(off_Protection)j({)598
3786 y(public:)676 3877 y(off_cap_t)e(p_cap[OFF_NOPS];)239
b(//)40 b(One)g(random)h(number)f(per)g(operation.)676
4060 y(//)g(Initializes)i(a)d(protection)j(object.)676
4151 y(//)e(By)g(default)g(access)h(is)f(granted.)676
4242 y(off_Protection\(void\){)755 4334 y(for)g(\(natural_t)h(i=0;)f(i)
g(<OFF_NOPS;)h(i++\))833 4425 y(p_cap[i])g(=)f(OFF_CAP_ALLOW;)676
4516 y(})676 4699 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4699 24 4 v 29 w(Protection)p Fj(.)i Fk(i)598
4882 y Fi(};)1905 5255 y Fz(19)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
20 21 bop 639 523 a Fz(There)39 b(is)g(another)g(constructor)f(to)h
(set)g(the)h(same)f(protection)f(for)h(ev)n(ery)f(access)515
623 y(mo)r(de.)c(Besides,)19 b(it)g(mak)n(es)e(p)r(ossible)h(implicit)i
(con)n(v)n(ersion)c(from)i Fx(off)p 2710 623 27 4 v 30
w(cap)p 2872 623 V 30 w(t)g Fz(to)g Fx(Protection)p Fz(.)515
756 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 756 24 4 v 29 w(Protection)p Fj(.)i Fk(i)p
Fq(\021)598 847 y Fi(//)39 b(Initializes)j(a)e(protection)h(object)g
(s.t.)f(cap)g(is)f(used)i(for)e(every)598 938 y(//)g(access)i(mode.)598
1029 y(off_Protection\(const)j(off_cap_t)d(a_cap\){)755
1121 y(for)f(\(natural_t)h(i=0;)f(i)g(<OFF_NOPS;)h(i++\))833
1212 y(p_cap[i])g(=)f(a_cap;)598 1303 y(})639 1536 y
Fz(This)28 b(metho)r(d)g(generates)e(a)h(random)g(protection.)515
1652 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1652 V 29 w(Protection)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
1743 y Fi(//)39 b(Randomize)j(this.)598 1835 y(void)e
(randomize\(void\);)515 1993 y Fk(h)p Fi(off)p 667 1993
V 29 w(Protection::randomize)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 2084 y Fi(//)39 b(Randomize)j(this.)598
2175 y(void)e(off_Protection::randomize\(void)q(\))598
2267 y({)676 2358 y(off_cap_t)h(a_cap=0xdeadbeef;//\(off_cap)q(_t\)r)q
(and\(\))q(;)676 2449 y(for)f(\(natural_t)i(i=0;)e(i)f(<OFF_NOPS;)j
(i++\))755 2540 y(p_cap[i])f(=)e(a_cap;)598 2632 y(})639
2864 y Fz(It)33 b(is)g(not)f(a)h(problem)f(to)g(randomize)g(a)g
Fx(Protection)p Fz(,)e(as)i(adequate)g(access)f(righ)n(ts)515
2964 y(for)c(it)h(can)f(b)r(e)h(obtained)f(later:)515
3080 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3080 V 29 w(Protection)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
3171 y Fi(//)39 b(Generates)j(access)e(rights)h(for)f(this)g
(protection.)598 3263 y(void)g(mk_rights\(off_Rights)k(*r,)c(off_op_t)h
(op\))f(const;)515 3421 y Fk(h)p Fi(off)p 667 3421 V
29 w(Protection::mk)p 1242 3421 V 31 w(rights)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 3512 y Fi(//)39 b(Generates)j(access)e(rights)h(for)
f(this)g(protection)h(and)f(access)h(mode.)598 3603 y(void)f
(off_Protection::mk_rights\(off_)q(Righ)q(ts)45 b(*r,)40
b(off_op_t)h(op\))f(const)598 3694 y({)676 3786 y(assert\(r\);)676
3877 y(r->r_cap)h(=)f(p_cap[op];)598 3968 y(})515 4234
y Fk(h)p Fj(O\013)27 b(ac)l(c)l(ess)i(rights.)f Fk(i)p
Fq(\021)598 4325 y Fi(//)39 b(Access)i(rights)g(for)f(system)g(users.)
598 4417 y(//)598 4508 y(class)g(off_Rights)i({)598 4599
y(public:)676 4691 y(off_cap_t)f(r_cap;)598 4782 y(};)1905
5255 y Fz(20)p eop
PStoPSsaved restore
%%Page: (22,23) 12
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
21 22 bop 639 523 a Fz(The)26 b(implemen)n(tation)g(of)g
Fx(AccessChecker)20 b Fz(metho)r(ds)26 b(is)g(th)n(us)g(trivial)f(if)h
(w)n(e)g(assume)515 623 y(that)c(v)-5 b(alid)21 b(access)g(mo)r(des)g
(matc)n(h)h(with)g(v)-5 b(alid)21 b(op)r(erations)g(\(i.e.)35
b(an)21 b(access)g(mo)r(de)h(cannot)515 722 y(con)n(tain)27
b(most)g(than)h(one)f(op)r(eration\).)515 855 y Fk(h)p
Fi(off)p 667 855 24 4 v 29 w(AccessChecker::access)p
1515 855 V 33 w(granted)i Fj(implementation.)e Fk(i)p
Fq(\021)598 946 y Fi(//)39 b(Checks)i(access)g(for)f(access)g(rights)h
(R)e(and)h(operation)h(OP.)598 1038 y(inline)598 1129
y(boolean_t)g(off_AccessChecker::access_gra)q(nted)q(\()k(const)40
b(off_op_t)h(op,)2363 1220 y(const)f(off_Rights)i(&r)e(,)2363
1312 y(const)g(off_Protection)j(&p)79 b(\))598 1403 y({)676
1494 y(assert\(off_op_valid\(op\)\);)676 1586 y(return)41
b(\(r.r_cap)g(==)f(p.p_cap[op]\);)598 1677 y(})639 1910
y Fz(Note)34 b(ho)n(w)g(w)n(e)f(used)h Fx(assert)e Fz(to)h(ensure)h
(that)g Fx(op)f Fz(is)h(v)-5 b(alid.)56 b(W)-7 b(e)34
b(will)h(b)r(e)f(using)g(it)515 2009 y(through)f(the)g(k)n(ernel)g(co)r
(de.)55 b(Assertions)32 b(are)h(c)n(hec)n(k)n(ed)f(when)i
Fx(NDEBUG)d Fz(is)i(not)h(de\014ned.)515 2109 y(W)-7
b(e)30 b(will)g(also)f(use)g Fx(kassert)e Fz(for)i(a)h(few)g(critical)f
(assertions)f(whic)n(h)i(should)f(b)r(e)h(c)n(hec)n(k)n(ed)515
2208 y(ev)n(en)d(when)h Fx(NDEBUG)d Fz(has)i(b)r(een)h(de\014ned.)515
2341 y Fk(h)p Fi(off)p 667 2341 V 29 w(AccessChecker::protect)k
Fj(implementation.)27 b Fk(i)p Fq(\021)598 2433 y Fi(//)39
b(Changes)i(protection.)598 2524 y(void)f
(off_AccessChecker::protect\(off)q(_Pro)q(tect)q(ion)45
b(&old,)1853 2615 y(const)40 b(off_Protection)j(&now,)d(const)h
(off_mode_t)g(m\))598 2707 y({)676 2798 y
(assert\(off_mode_valid\(m\)\);)676 2980 y(if)f(\(OFF_M_R&m\))755
3072 y(old.p_cap[OFF_OP_R])j(=)d(now.p_cap[OFF_OP_R];)676
3163 y(if)g(\(OFF_M_W&m\))755 3254 y(old.p_cap[OFF_OP_W])j(=)d
(now.p_cap[OFF_OP_W];)676 3346 y(if)g(\(OFF_M_X&m\))755
3437 y(old.p_cap[OFF_OP_X])j(=)d(now.p_cap[OFF_OP_X];)676
3528 y(if)g(\(OFF_M_D&m\))755 3620 y(old.p_cap[OFF_OP_D])j(=)d
(now.p_cap[OFF_OP_D];)676 3711 y(if)g(\(OFF_M_P&m\))755
3802 y(old.p_cap[OFF_OP_P])j(=)d(now.p_cap[OFF_OP_P];)598
3894 y(})1905 5255 y Fz(21)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
22 23 bop 639 523 a Fz(Finally)-7 b(,)37 b(it)f(should)f(b)r(e)g(clear)
g(that)g(ev)n(ery)f(system)h(ob)5 b(ject)35 b(exp)r(orting)f(a)h
(subset)g(of)515 623 y(metho)r(ds)d(to)g(the)g(user)f(is)h(resp)r
(onsible)f(of)h(calling)f Fx(access)p 2442 623 27 4 v
29 w(granted)e Fz(with)j(the)h(appro-)515 722 y(priate)i(access)g(mo)r
(de)h(at)g(the)h(b)r(eginning)e(of)h(ev)n(ery)f(exp)r(orted)h(op)r
(eration.)61 b(Otherwise)515 822 y(protection)27 b(will)g(not)h(tak)n
(e)f(e\013ect.)639 922 y(Metho)r(ds)d(lik)n(e)f Fx(off)p
1262 922 V 30 w(op)p 1380 922 V 30 w(valid)f Fz(and)h
Fx(off)p 1941 922 V 30 w(mode)p 2147 922 V 30 w(valid)e
Fz(will)j(b)r(e)f(de\014ned)h(for)f(di\013eren)n(t)515
1021 y(data)k(t)n(yp)r(es)g(so)g(that)h(assertions)e(are)h(easy)f(to)i
(write.)515 1141 y Fk(h)p Fj(O\013)f(valid)g(ac)l(c)l(ess)j(op)l(er)l
(ation)f(and)f(mo)l(de.)f Fk(i)p Fq(\021)598 1232 y Fi(extern)40
b(inline)h(boolean_t)g(off_op_valid\()h(const)f(off_op_t)g(op\))79
b({)676 1324 y(return)41 b(\(op)f(>=)f(OFF_OP_R)i(&&)f(op)g(<=)f
(OFF_OP_P\);)598 1415 y(})598 1598 y(extern)h(inline)h(boolean_t)g
(off_mode_valid\()i(const)d(off_mode_t)i(m\))79 b({)676
1689 y(return)41 b(\(m&~OFF_M_ALL\)==0;)598 1780 y(})515
2111 y FA(Protection)32 b Fg(C)7 b Fx(++)30 b FA(source)i(\014les)515
2264 y Fz(Protection)39 b(de\014nitions)h(are)f(k)n(ept)h(in)h(a)e
(couple)h(of)g(\014les)g(named)h Fx(klib/prot.h)35 b
Fz(and)515 2363 y Fx(klib/prot.C)p Fz(.)515 2483 y Fk(h)p
Fj(pr)l(ot.h*)11 b Fk(i)q Fq(\021)598 2575 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2666 y Fi(#ifndef)41 b(__OFF_PROT_H)598 2757
y(#define)80 b(__OFF_PROT_H)42 b(1)598 2940 y Fk(h)p
Fj(O\013)27 b(pr)l(ote)l(ction)j(dep)l(endencies.)f Fk(i)598
3031 y(h)p Fj(O\013)e(pr)l(ote)l(ction)j(b)l(asic)e(typ)l(es.)g
Fk(i)598 3123 y(h)p Fj(O\013)f(ac)l(c)l(ess)i(op)l(er)l(ations.)g
Fk(i)598 3214 y(h)p Fj(O\013)e(ac)l(c)l(ess)i(mo)l(de.)f
Fk(i)598 3397 y(h)p Fj(O\013)f(valid)g(ac)l(c)l(ess)j(op)l(er)l(ation)f
(and)f(mo)l(de.)f Fk(i)598 3579 y(h)p Fj(O\013)g(ac)l(c)l(ess)i
(rights.)f Fk(i)598 3671 y(h)p Fj(O\013)f(pr)l(ote)l(ction.)i
Fk(i)598 3762 y Fi(#ifdef)40 b(__KERNEL__)598 3853 y
Fk(h)p Fj(O\013)27 b(ac)l(c)l(ess)i(che)l(cker.)g Fk(i)598
4036 y(h)p Fi(off)p 750 4036 24 4 v 29 w(AccessChecker::access)p
1598 4036 V 33 w(granted)g Fj(implementation.)e Fk(i)598
4127 y Fi(#endif)40 b(//)g(__KERNEL__)598 4218 y(#endif)g(//)g
(__OFF_PROT_H)515 4367 y Fk(h)p Fj(pr)l(ot.C*)11 b Fk(i)p
Fq(\021)598 4458 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 4641 y Fi(#include)41
b(<klib/prot.h>)395 b(//)40 b(Exported)h(interface.)598
4824 y Fk(h)p Fi(off)p 750 4824 V 29 w(Protection::randomize)32
b Fj(implementation.)27 b Fk(i)598 4915 y(h)p Fi(off)p
750 4915 V 29 w(Protection::mk)p 1325 4915 V 31 w(rights)i
Fj(implementation.)e Fk(i)598 5006 y(h)p Fi(off)p 750
5006 V 29 w(AccessChecker::protect)32 b Fj(implementation.)27
b Fk(i)1905 5255 y Fz(22)p eop
PStoPSsaved restore
%%Page: (24,25) 13
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
23 24 bop 639 523 a Fz(As)25 b(w)n(e)f(ha)n(v)n(e)g(seen,)h
Fx(AccessChecker)19 b Fz(is)25 b(used)g(only)f(inside)h(the)g(k)n
(ernel.)35 b(The)25 b(sym)n(b)r(ol)p 515 623 27 4 v 546
623 V 572 623 a Fx(KERNEL)p 841 623 V 870 623 V 88 w
Fz(will)j(b)r(e)g(de\014ned)g(only)f(when)h(compiling)f(a)g(k)n(ernel)g
(image.)639 722 y(W)-7 b(e)35 b(used)g Fx(boolean)p 1299
722 V 28 w(t)p Fz(,)h Fx(natural)p 1738 722 V 29 w(t)p
Fz(,)g(and)e Fx(rand)f Fz(through)h(the)h(co)r(de.)57
b(W)-7 b(e)35 b(ha)n(v)n(e)e(to)515 822 y(de\014ne)28
b(suc)n(h)f(things.)515 938 y Fk(h)p Fj(O\013)g(pr)l(ote)l(ction)j(dep)
l(endencies.)f Fk(i)p Fq(\021)598 1029 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 1121 y(#include)h
(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 1212 y(#include)h(<stdlib.h>)512 b(//)40 b(for)g(rand)639
1337 y Fz(Finally)-7 b(,)29 b(ev)n(ery)d(source)h(\014le)h(will)h
(include)f(an)g(advice)f(for)h(those)g(willing)g(to)f(read)h(the)515
1436 y(compiler)f(source)f(co)r(de)h(instead)h(of)f(the)h(literate)g
(source)e(co)r(de)h(\(this)i(\014le\).)515 1569 y Fk(h)p
Fj(R)l(e)l(ad)f(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)
g Fk(i)p Fq(\021)598 1660 y Fi(//)598 1752 y(//)39 b(===)h(DO)g(NOT)g
(READ)g(OR)g(MODIFY)g(THIS)g(FILE)h(===)598 1843 y(//)598
1934 y(//)e(This)i(is)e(a)h(source)g(file)g(generated)i(by)d(the)h
(noweb)h(literate)598 2026 y(//)e(programming)j(tool.)598
2117 y(//)598 2208 y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g
(literate)h(source)f(code)g(instead.)598 2300 y(//)515
2574 y Fn(2.3.2)112 b(Reference)38 b(coun)m(ting)515
2727 y Fz(Resources)19 b(exp)r(orted)i(b)n(y)f(the)i(k)n(ernel)e(will)h
(also)f(b)r(e)h(used)g(b)n(y)g(other)f(k)n(ernel)g(resources)f(\(e.g.)
515 2826 y(page)24 b(frames)h(are)g(used)g(b)n(y)h(address)e
(translations\).)35 b(T)-7 b(o)25 b(a)n(v)n(oid)f(resource)g(deletion)i
(while)515 2926 y(its)34 b(b)r(eing)g(used)g(and)f(to)h(pro)n(vide)f
(basic)g(supp)r(ort)h(for)f(garbage)f(collection)h(w)n(e)h(emplo)n(y)
515 3026 y Fy(r)l(efer)l(enc)l(e)27 b(c)l(ounters)k Fz(\()p
Fx(RefCounter)21 b Fz(ob)5 b(jects\).)36 b(When)25 b(a)g
Fx(RefCcounter)20 b Fz(comes)k(do)n(wn)g(to)515 3125
y(zero)g(an)i Fx(UNUSED)d Fz(exception)j(ma)n(y)f(b)r(e)h(raised)f(to)g
(notify)h(users)f(of)h(unreferenced)f(\(ma)n(yb)r(e)515
3225 y(un)n(used\))e(resources.)34 b(The)24 b(k)n(ernel)e(do)r(es)h
Fy(not)32 b Fz(delete)23 b(the)h(resource.)34 b(The)24
b(resource)d(o)n(wner)515 3325 y(should.)639 3424 y(This)31
b(feature)g(is)f(actually)h(included)g(as)f(a)h(builtin)h(service)d(in)
j(ev)n(ery)d Fx(Resource)p Fz(,)g(so)515 3524 y(that)34
b(w)n(e)f(could)g(sa)n(v)n(e)f(some)h(t)n(yping)h(and)f(execution)g
(time)h(using)g Fx(foo->reference\()o(\))515 3624 y Fz(instead)27
b(of)h Fx(foo->reference)p 1517 3624 V 25 w(counter->referenc)o(e\()o
(\))p Fz(.)639 3723 y(The)g(implemen)n(tation)g(is)f(so)g(simple)h
(that)g(w)n(e)f(ha)n(v)n(e)f(folded)i(and)f(inlined)i(it.)515
3856 y Fk(h)p Fj(O\013)e(public)g(metho)l(ds)i(for)f(r)l(efer)l(enc)l
(e)h(c)l(ounting)g(obje)l(cts.)g Fk(i)o Fq(\021)598 3947
y Fi(//)39 b(References)81 b(\(unreferences\))43 b(this)d(object.)598
4039 y(void)g(reference\()h(void)g(\))117 b({)40 b(atomic_inc\(&_rc\);)
j(};)598 4130 y(void)d(unreference\()i(void)e(\))f({)h(if)g
(\(atomic_dec_and_test\(&_rc\)\))45 b(unused\(\);)c(};)598
4221 y(//)e(Returns)i(the)f(number)h(of)e(references.)598
4313 y(natural_t)i(get_num_refs\(void\))i(const)e({)78
b(return)41 b(_rc;)f(};)515 4578 y Fk(h)p Fj(O\013)27
b(r)l(esour)l(c)l(e)j(dep)l(endencies.)f Fk(i)p Fq(\021)598
4670 y Fi(#include)41 b(<klib/mdep/bitops.h>)122 b(//)40
b(for)g(atomic)1905 5255 y Fz(23)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
24 25 bop 639 523 a Fz(The)26 b(only)e(subtle)i(p)r(oin)n(t)f(is)g
(that)h(w)n(e)f(will)g(use)g(the)h(virtual)f(metho)r(d)g
Fx(unused)e Fz(to)i(raise)515 623 y(an)n(y)i(exception)g(\(and)h(p)r
(erhaps)f(destro)n(y)f(the)i(ob)5 b(ject\).)515 756 y
Fk(h)p Fj(O\013)27 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)f(for)f(r)l(efer)l
(enc)l(e)h(c)l(ounting)g(obje)l(cts.)g Fk(i)o Fq(\021)598
847 y Fi(//)39 b(Raises)i(UNUSED)g(exceptions.)598 938
y(virtual)g(void)f(unused\(void\))81 b({;})639 1171 y
Fz(And)28 b(of)g(course.)13 b(.)h(.)515 1287 y Fk(h)p
Fj(O\013)27 b(private)i(memb)l(ers)f(for)g(r)l(efer)l(enc)l(e)h(c)l
(ounting)g(obje)l(cts.)f Fk(i)p Fq(\021)598 1378 y Fi(atomic_t)41
b(_rc;)668 b(//)39 b(#)h(of)f(references)639 1503 y Fz(The)28
b(reference)f(coun)n(ter)f(m)n(ust)i(b)r(e)g(initialized)g(to)f
Fx(0)h Fz(on)f(resource)f(allo)r(cation.)515 1619 y Fk(h)p
Fj(O\013)h(initialization)g(for)g(r)l(efer)l(enc)l(e)j(c)l(ounting)e
(obje)l(cts.)h Fk(i)p Fq(\021)598 1710 y Fi(_rc)40 b(=)f(0;)515
1868 y Fk(h)p Fj(O\013)27 b(aggr)l(e)l(gate)j(initialization)d(for)h(r)
l(efer)l(enc)l(e)h(c)l(ounting)g(obje)l(cts.)f Fk(i)p
Fq(\021)598 1959 y Fi(_rc\(1\))1905 5255 y Fz(24)p eop
PStoPSsaved restore
%%Page: (26,27) 14
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
25 26 bop 639 523 a Fz(Reference)35 b(coun)n(ters)f(help)h(the)h(k)n
(ernel)e(kno)n(w)g(the)i(usage)e(of)h(system)g(resources)e(in)515
623 y(di\013eren)n(t)27 b(w)n(a)n(ys)g(dep)r(ending)h(on)f(the)h
(resource:)515 789 y FA(P)m(ortals)42 b Fz(One)19 b(coun)n(t)g(p)r(er)h
(on-going)d(in)n(v)n(o)r(cation.)33 b(One)19 b(coun)n(t)h(p)r(er)f
(creation.)33 b(One)19 b(coun)n(t)722 888 y(p)r(er)28
b(ev)n(en)n(t)f(attac)n(hed.)515 1054 y FA(Sh)m(uttles)41
b Fz(One)32 b(coun)n(t)h(p)r(er)f(creation.)51 b(One)33
b(coun)n(t)f(p)r(er)h(up)r(call)f(ongoing.)51 b(One)32
b(coun)n(t)722 1154 y(p)r(er)c(p)r(ortal)f(attac)n(hed.)36
b(One)27 b(coun)n(t)h(p)r(er)f(run)h(queue)f(slot)g(attac)n(hed.)515
1320 y FA(dtlbs)41 b Fz(One)27 b(coun)n(t)g(p)r(er)h(creation.)36
b(One)27 b(coun)n(t)g(p)r(er)h(sh)n(uttle)g(or)e(p)r(ortal)h(attac)n
(hed)g(to)h(it.)515 1486 y FA(P)m(age)k(frames)40 b Fz(One)28
b(coun)n(t)f(p)r(er)h(creation.)35 b(One)28 b(coun)n(t)f(p)r(er)g
(address)g(translation.)515 1652 y FA(In)m(terrupt)33
b(lines)40 b Fz(One)27 b(coun)n(t)g(p)r(er)h(creation.)515
1818 y FA(Pro)s(cessor)j(slots)40 b Fz(One)28 b(coun)n(t)f(p)r(er)g
(creation.)515 1984 y FA(IO)k(P)m(orts)42 b Fz(One)28
b(coun)n(t)f(p)r(er)h(creation.)515 2217 y Fn(2.3.3)112
b(Sync)m(hronizing)37 b(system)g(resources)515 2370 y
Fz(T)-7 b(o)20 b(sync)n(hronize)g(access)f(to)i(system)g(ob)5
b(jects,)22 b(w)n(e)e(will)h(use)g(spin)g(lo)r(c)n(ks)f(and)h
(bureaucracy)3344 2340 y Fp(6)515 2470 y Fz(\(read)27
b Fy(c)l(ondition)k(variables)7 b Fz(\))29 b(most)f(of)f(the)h(time.)
515 2685 y FA(Lo)s(c)m(ks)515 2839 y Fz(The)f(access)g(pattern)g(to)h
(system)f(ob)5 b(jects)27 b(in)h(system)f(call)h(is:)616
3005 y(1.)41 b(Call)28 b Fx(make)p 1079 3005 27 4 v 29
w(available\(\))23 b Fz(to)28 b(bring)f(an)n(y)g(needed)g(remote)g(ob)5
b(ject)28 b(here.)616 3171 y(2.)41 b(Ha)n(ving)27 b(the)h(required)f
(ob)5 b(jects)27 b(in)h(the)g(lo)r(cal)f(no)r(de,)g Fx(lock)f
Fz(them.)616 3337 y(3.)41 b(P)n(erform)26 b(the)i(op)r(eration)f
(\(whic)n(h)g(should)h(no)n(w)f(b)r(e)h(non-blo)r(c)n(king\))e(and)i
(return.)639 3503 y(W)-7 b(e)28 b(use)g(simple)f(read-write)g(spin)g
(lo)r(c)n(ks)g(to)g(lo)r(c)n(k)g(resources.)515 3636
y Fk(h)p Fj(O\013)g(lo)l(ckable)h(obje)l(cts.)h Fk(i)p
Fq(\021)598 3727 y Fi(//)39 b(Objects)i(that)f(can)g(be)g(locked.)598
3818 y(//)598 3910 y(class)g(off_Lockable)i({)598 4001
y(private:)676 4092 y(rw_spin_lock_t)h(l_lock;)354 b(//)40
b(The)g(lock.)676 4184 y Fk(h)p Fj(Other)29 b(private)f(metho)l(ds)h
(of)f Fi(off)p 1691 4184 24 4 v 29 w(Lockable)p Fj(.)g
Fk(i)598 4275 y Fi(public:)676 4366 y(off_Lockable\(void\))44
b({)39 b(rw_spin_lock_init\(&l_lock\);})676 4549 y(//)h(Is)g(the)f
(lock)i(set?)676 4640 y(inline)g(boolean_t)g(is_locked\(void\))i(const)
d({)755 4731 y(return)g(rw_spin_lock_locked\(&l_lock\))q(;)676
4823 y(})p 515 4882 1146 4 v 607 4936 a Fm(6)642 4959
y Fl(As)23 b(it)h(is)f(done)h(in)f(the)i(real)e(life.)1905
5255 y Fz(25)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
26 27 bop 676 614 a Fi(//)40 b(How)g(many)g(readers?)676
706 y(inline)h(natural_t)g(get_rd_count\(void\))676 797
y({)f(return)g(rw_spin_lock_get_readers\(&l_)q(lock)q(\);)45
b(})676 888 y(//)40 b(Any)g(writer?)676 980 y(inline)h(boolean_t)g
(get_wr_count\(void\))676 1071 y({)f(return)g
(rw_spin_lock_has_writer\(&l_l)q(ock\))q(;)45 b(})676
1254 y(//)40 b(Spin)g(\(un\)lock)h(on)f(this.)676 1345
y(inline)h(void)f(r_lock\(void\);)676 1436 y(inline)h(void)f
(r_unlock\(void\);)676 1528 y(inline)h(void)f(w_lock\(void\);)676
1619 y(inline)h(void)f(w_unlock\(void\);)676 1802 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
1802 24 4 v 29 w(Lockable)p Fj(.)i Fk(i)598 1893 y Fi(};)639
2114 y Fz(The)j(implemen)n(tation)g(is)g(a)f(mac)n(hine)g(dep)r(enden)n
(t)i(read-write)d(spin)i(lo)r(c)n(k)f(pro)n(vided)515
2214 y(b)n(y)21 b(the)h(OSKit)992 2184 y Fp(7)1029 2214
y Fz(.)35 b(On)22 b(non)f(SMP)h(systems)f(if)h(a)f(resource)f(is)i
(found)g(lo)r(c)n(k)n(ed,)g(the)g(pro)r(cessor)515 2314
y(is)27 b(relinquished.)515 2435 y Fk(h)p Fi(off)p 667
2435 V 29 w(Lockable::lock)j Fj(and)e Fi(unlock)h Fj(implementation.)e
Fk(i)p Fq(\021)598 2527 y Fi(//)39 b(Spin)i(\(un\)lock)g(on)e(this.)598
2618 y(inline)h(void)g(off_Lockable::r_lock\(void\))85
b({)676 2709 y(while)41 b(\(!rw_spin_read_try_lock\(&l_lock)q(\)\){)598
2801 y(#ifdef)f(__NOSMP__)755 2892 y(lock_yield\(\);)598
2983 y(#endif)755 3075 y(while\(rw_spin_lock_has_writer\(&)q(l_lo)q
(ck\)\))46 b(//)39 b(to)h(get)g(ro)g(bus)g(access.)g(\(cheaper\))833
3166 y(;)676 3257 y(})598 3348 y(})598 3440 y(inline)g(void)g
(off_Lockable::r_unlock\(void)q(\){)45 b
(rw_spin_read_unlock\(&l_lock\))q(;})598 3531 y(inline)40
b(void)g(off_Lockable::w_lock\(void\))85 b({)676 3622
y(while\(!rw_spin_write_try_loc)q(k\(&l_)q(lock)q(\)\){)598
3714 y(#ifdef)40 b(__NOSMP__)755 3805 y(lock_yield\(\);)598
3896 y(#endif)715 3988 y(while\(rw_spin_lock_locked\(&)q(l_loc)q(k\)\))
46 b(//)39 b(to)h(get)g(ro)g(bus)f(access.)i(\(cheaper\))833
4079 y(;)676 4170 y(})598 4262 y(})598 4353 y(inline)f(void)g
(off_Lockable::w_unlock\(void)q(\){)45 b(rw_spin_write_unlock\(&l_lock)
q(\);})515 4688 y Fk(h)p Fj(Other)28 b(private)h(metho)l(ds)g(of)e
Fi(off)p 1529 4688 V 29 w(Lockable)p Fj(.)i Fk(i)p Fq(\021)598
4779 y Fi(//)39 b(Yields)i(the)f(processor)h(instead)g(of)f(spinning)h
(for)f(a)f(lock.)598 4870 y(void)h(lock_yield\(void\);)p
515 4929 1146 4 v 607 4983 a Fm(7)642 5006 y Fl(Whic)n(h)24
b(w)n(as)g(added)h(as)e(a)h(patc)n(h)h(from)d(the)i(Lin)n(ux)g(k)n
(ernel)g(source)g(co)r(de.)1905 5255 y Fz(26)p eop
PStoPSsaved restore
%%Page: (28,29) 15
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
27 28 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v 29
w(Lockable::lock)p 1242 523 V 31 w(yield)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Yields)i(the)f(processor)h(instead)
g(of)f(spinning)h(for)f(a)f(lock.)598 706 y(void)h
(off_Lockable::lock_yield\(void\))598 797 y({)676 888
y(do_debug\(putchar\('!'\)\);)676 980 y(off_Shtl::self\(\)->yield\(\);)
598 1071 y(})515 1337 y Fk(h)p Fj(O\013)27 b(L)l(o)l(ckable)i
(implementation)f(dep)l(endencies.)h Fk(i)p Fq(\021)598
1428 y Fi(#include)41 b(<shtl/Shtl.h>)395 b(//)40 b(for)g(yield.)598
1519 y(#include)h(<flux/debug.h>)356 b(//)40 b(for)g(do_debug)639
1660 y Fz(Another)27 b(bunc)n(h)h(of)f(metho)r(ds)h(are)e(pro)n(vided)h
(to)g(inhibit)h(in)n(terrupts)f(while)h(the)g(lo)r(c)n(k)515
1760 y(is)k(held.)51 b(T)-7 b(o)32 b(allo)n(w)f(nesting,)i(the)g(user)e
(k)n(eeps)h(the)h(lo)r(c)n(king)e(state)h(so)f(that)i(it)g(could)f(b)r
(e)515 1860 y(reset)27 b(to)g(a)g(previous)g(v)-5 b(alue.)515
1976 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1976 V 29 w(Lockable)p Fj(.)i Fk(i)o Fq(\021)598
2067 y Fi(#ifdef)40 b(__KERNEL__)598 2159 y(//)f(Spin)i(\(un\)lock)g
(on)e(this)h(maintaning)i(the)e(previous)h(interrupt-enabling)i(state.)
598 2250 y(inline)d(void)g(r_lock\(off_lock_state_t)45
b(&state\))794 2341 y({)39 b(rw_spin_read_lock_irqsave\(&l)q(_loc)q
(k,st)q(ate\);)46 b(})598 2433 y(inline)40 b(void)g
(r_unlock\(off_lock_state_t)45 b(old_state\))794 2524
y({)39 b(rw_spin_read_unlock_irqresto)q(re\(&)q(l_lo)q(ck,ol)q(d_st)q
(ate\);)q(})598 2615 y(inline)h(void)g(w_lock\(off_lock_state_t)45
b(&state\))794 2707 y({)39 b(rw_spin_write_lock_irqsave\(&)q(l_lo)q
(ck,s)q(tate\))q(;)45 b(})598 2798 y(inline)40 b(void)g
(w_unlock\(off_lock_state_t)45 b(old_state\))794 2889
y({)39 b(rw_spin_write_unlock_irqrest)q(ore\()q(&l_l)q(ock,o)q(ld_s)q
(tate\))q(;})598 2980 y(#endif)h(//)g(__KERNEL__)639
3105 y Fz(where)515 3221 y Fk(h)p Fj(O\013)27 b(lo)l(ck)h(state)h(data)
g(typ)l(e.)f Fk(i)p Fq(\021)598 3313 y Fi(typedef)41
b(register_t)g(off_lock_state_t;)639 3528 y Fz(The)31
b(implemen)n(tation)g(dep)r(ends)g(b)r(oth)h(on)e(the)h(OSKit)g(spin)g
(lo)r(c)n(k)f(implemen)n(tation)515 3628 y(and)d(on)g(the)h(in)n
(terrupt)g(inhibiting)g(spin)g(lo)r(c)n(k)f(implemen)n(tation)g
(\(describ)r(ed)h(b)r(elo)n(w\).)515 3761 y Fk(h)p Fj(O\013)f(L)l(o)l
(ckable)i(dep)l(endencies.)g Fk(i)p Fq(\021)598 3852
y Fi(#include)41 b(<klib/mdep/types.h>)598 3944 y(#include)g
(<klib/mdep/rw_spin_lock.h>)k(//)40 b(spin)g(locks.)639
4085 y Fz(Finally)-7 b(,)28 b(some)f Fy(try)j(only)35
b Fz(v)n(ersions)26 b(are)h(pro)n(vided)f(to)r(o.)515
4201 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4201 V 29 w(Lockable)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
4292 y Fi(//)39 b(Sping)i(try)f(lock)g(on)g(this.)598
4384 y(inline)g(boolean_t)i(r_try_lock\(void\))82 b({return)41
b(rw_spin_read_try_lock\(&l_lock\);)46 b(})598 4475 y(inline)40
b(boolean_t)i(w_try_lock\(void\))82 b({return)41 b
(rw_spin_write_try_lock\(&l_lock\))q(;)k(})1905 5255
y Fz(27)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
28 29 bop 515 523 a FA(Lo)s(c)m(ks)32 b Fg(C)7 b Fx(++)31
b FA(source)h(\014les)515 676 y Fz(The)43 b Fx(Lockable)d
Fz(implemen)n(tation)j(go)r(es)f(in)n(to)h(\014les)g(named)g
Fx(klib/Lockable.h)37 b Fz(and)515 776 y Fx(klib/lockable.C)p
Fz(.)31 b(Because)36 b(none)h(of)g(the)h(co)r(de)f(is)g(ev)n(er)f(seen)
h(outside)g(the)h(k)n(ernel,)515 876 y(w)n(e)27 b(include)h(the)g(co)r
(de)f(only)h(when)f(the)p 1805 876 27 4 v 1836 876 V
91 w Fx(KERNEL)p 2131 876 V 2160 876 V 88 w Fz(sym)n(b)r(ol)g(has)g(b)r
(een)h(de\014ned.)515 1008 y Fk(h)p Fj(L)l(o)l(ckable.h*)11
b Fk(i)q Fq(\021)598 1100 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1191 y Fi(#ifndef)41 b(__OFF_LOCKABLE_H)598 1282 y(#define)80
b(__OFF_LOCKABLE_H)43 b(1)598 1465 y Fk(h)p Fj(O\013)27
b(L)l(o)l(ckable)i(dep)l(endencies.)g Fk(i)598 1739 y(h)p
Fj(O\013)e(lo)l(ck)h(state)h(data)g(typ)l(e.)f Fk(i)598
1830 y(h)p Fj(O\013)f(lo)l(ckable)h(obje)l(cts.)h Fk(i)598
2013 y(h)p Fi(off)p 750 2013 24 4 v 29 w(Lockable::lock)h
Fj(and)e Fi(unlock)h Fj(implementation.)e Fk(i)598 2287
y Fi(#endif)40 b(//)g(__OFF_LOCKABLE_H)515 2461 y Fk(h)p
Fj(L)l(o)l(ckable.C*)11 b Fk(i)q Fq(\021)598 2553 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 2735 y Fi(#include)41 b(<klib/Lockable.h>)239
b(//)40 b(Exported)h(interface.)598 2827 y Fk(h)p Fj(O\013)27
b(L)l(o)l(ckable)i(implementation)f(dep)l(endencies.)h
Fk(i)598 3009 y(h)p Fi(off)p 750 3009 V 29 w(Lockable::lock)p
1325 3009 V 31 w(yield)g Fj(implementation.)e Fk(i)515
3184 y(h)p Fj(uL)l(o)l(ckable.C*)11 b Fk(i)q Fq(\021)598
3275 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3366 y Fi(#undef)40
b(__KERNEL__)598 3458 y(#include)h(<klib/Lockable.h>)239
b(//)40 b(Exported)h(interface.)598 3549 y(#include)g(<shtl/Shtl.h>)598
3640 y(#include)g(<node/Node.h>)598 3823 y(//)e(Yields)i(the)f
(processor)h(instead)g(of)f(spinning)h(for)f(a)f(lock.)598
3914 y(void)h(off_Lockable::lock_yield\(void\))598 4005
y({)676 4097 y(putchar\('!'\);)676 4188 y
(off_uShtl::self\(\).set_prop\(O)q(FF_SH)q(TLP_)q(RUNS)q(,off_)q(id_t)q
(\(0,OF)q(F_SH)q(TL_R)q(YLD\),)q(__nd)q(r,__n)q(dr\);)598
4279 y(})1905 5255 y Fz(28)p eop
PStoPSsaved restore
%%Page: (30,31) 16
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
29 30 bop 515 523 a FA(Kernel)31 b(bureaucracy)515 676
y Fz(In)24 b(order)f(to)h(w)n(ait)f(for)h(a)f(resource)g(to)h(reac)n(h)
e(a)i(giv)n(en)f(state,)i(or)e(to)h(do)g(long-term)f(w)n(aiting)515
776 y(due)40 b(to)f(resources)f(b)r(eing)h(temp)r(orarily)g(una)n(v)-5
b(ailable,)42 b(w)n(e)d(use)g Fx(Bureaucrat)p Fz(s.)69
b(More)515 876 y(seriously)-7 b(,)30 b(w)n(e)g(use)h(either)f
(semaphores)f(or)h(condition)h(v)-5 b(ariables.)44 b(Eac)n(h)30
b(resource)f(that)515 975 y(ma)n(y)23 b(cause)h(long-term)f(w)n(aiting)
g(\(p)r(ortals\))h(will)g(pro)n(vide)f(one)h(or)g(more)f
Fx(Bureaucrat)p Fz(s)d(so)515 1075 y(that)29 b(sh)n(uttles)f(blo)r(c)n
(k)g(on)g(them)i(un)n(til)e(some)g(new)h(state)f(is)h(reac)n(hed.)38
b Fx(Bureaucrat)p Fz(s)24 b(can)515 1174 y(b)r(e)k(understo)r(o)r(d)f
(as)g(condition)g(v)-5 b(ariables)27 b(but)h(can)f(b)r(e)h(implemen)n
(ted)g(b)n(y)g(other)f(means.)639 1274 y(The)33 b(use)g(of)g
(semaphores)e(or)h(condition)g(v)-5 b(ariables)32 b(is)g(not)h(an)g
(obstacle)f(to)g(system)515 1374 y(distribution)24 b(b)r(ecause)f(w)n
(e)h(will)g(b)r(e)g(using)g(lists)f(of)h(iden)n(ti\014ers)g(\(and)g
(not)g(lists)f(of)h(ob)5 b(jects\))515 1473 y(to)24 b(represen)n(t)f
(the)i(set)f(of)g(sh)n(uttles)g(w)n(aiting)g(on)g(condition)g(v)-5
b(ariables.)34 b(Th)n(us)24 b(a)g(single)g(list)515 1573
y(ma)n(y)j(span)g(sev)n(eral)f(no)r(des.)639 1673 y(The)34
b(bureaucrat)f(con)n(tains)f(the)j(common)e(logic)g(to)h(semaphores,)f
(condition)h(v)-5 b(ari-)515 1772 y(ables)27 b(et)h(al.)515
1905 y Fk(h)p Fj(O\013)f(bur)l(e)l(aucr)l(at.)j Fk(i)p
Fq(\021)598 1996 y Fi(//)39 b(Bureaucracy)j(shuttles)f(sleep)g(in.)598
2088 y(//)598 2179 y(class)f(off_Bureaucrat)j(:)c(public)i
(off_Lockable)h({)598 2270 y(protected:)676 2362 y(DLinkedQueue)81
b(b_shtls;)41 b(//)f(Queue)g(of)g(shuttle)h(identifiers.)676
2544 y(//)f(Puts)g(the)g(caller)h(to)e(sleep)i(on)e(this)h(bureaucrat.)
i(The)e(lock)g(must)g(be)676 2636 y(//)g(held)g(in)g(write)g(mode.)g
(\(releases)i(the)e(lock\))676 2727 y(err_t)h(sleep\(void\);)676
2818 y(//)f(Awakes)g(the)g(first)h(enqueued)g(guy.)f(The)g(lock)g(must)
g(be)676 2910 y(//)g(held)g(in)g(write)g(mode.)676 3001
y(err_t)h(wakeup\(void\);)676 3092 y(//)f(Destroyes)h(a)f(Bureaucrat)
676 3184 y(virtual)h(~off_Bureaucrat\(void\);)598 3366
y(};)639 3507 y Fz(T)-7 b(o)36 b(implemen)n(t)h(a)f Fx(Bureaucrat)c
Fz(w)n(e)k(m)n(ust)g(main)n(tain)g(a)g(list)g(of)h(blo)r(c)n(k)n(ed)e
(sh)n(uttles.)515 3607 y(The)29 b(list)g(is)g(main)n(tained)f(using)h
(the)g(stac)n(ks)f(of)h(the)g(sleeping)f(callers.)40
b(In)29 b(an)n(y)f(case,)h(the)515 3707 y(list)f(con)n(tains)e(iden)n
(ti\014ers,)h(not)h(p)r(oin)n(ters.)515 3839 y Fk(h)p
Fj(O\013)f(bur)l(e)l(aucr)l(at)j(no)l(de.)e Fk(i)p Fq(\021)598
3931 y Fi(class)40 b(off_LinkedId)i(:)e(public)g(DLinkedNode)i({)598
4022 y(public:)676 4113 y(off_id_t)f(l_id;)676 4205 y
(off_LinkedId\(const)j(off_shtl_id_t)e(&id\))e(:)f(l_id\(id\))i({;})598
4296 y(};)1905 5255 y Fz(29)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
30 31 bop 639 523 a Fz(A)31 b(bureaucrat)e(will)h(assume)g(that)g(the)h
(lo)r(c)n(k)f(on)g(the)g(ob)5 b(ject)30 b(is)h(already)d(held)j(when)
515 623 y Fx(sleep)25 b Fz(or)i Fx(wakeup)e Fz(b)r(e)j(called.)515
743 y Fk(h)p Fi(off)p 667 743 24 4 v 29 w(Bureaucrat::sleep)j
Fj(implementation.)c Fk(i)p Fq(\021)598 834 y Fi(//)39
b(Puts)i(the)e(caller)i(to)f(sleep)g(on)g(this)g(bureaucrat.)i(The)e
(lock)g(must)g(be)598 925 y(//)f(held)i(in)e(write)i(mode.)f
(\(releases)h(the)f(lock\))598 1017 y(err_t)g
(off_Bureaucrat::sleep\(void\))598 1108 y({)676 1199
y(off_Shtl)h(*me=off_Shtl::self\(\);)676 1291 y(off_LinkedId)h
(lid\(me->get_id\(\)\);)676 1382 y(b_shtls.enqueue\(&lid\);)676
1473 y(w_unlock\(\);)676 1565 y(me->block\(\);)598 1656
y(})639 1875 y Fz(The)21 b(implemen)n(tation)g(of)f Fx(wakeup)f
Fz(will)i(un)n(blo)r(c)n(k)f(the)h(\014rst)f(enqueue)h(sh)n(uttle)g
(\(if)h(an)n(y\).)515 1995 y Fk(h)p Fi(off)p 667 1995
V 29 w(Bureaucrat::wakeup)31 b Fj(implementation.)d Fk(i)o
Fq(\021)598 2087 y Fi(//)39 b(Awakes)i(the)f(first)g(enqueued)h(guy.)f
(The)g(lock)h(must)f(be)598 2178 y(//)f(held)i(in)e(write)i(mode.)598
2269 y(err_t)f(off_Bureaucrat::wakeup\(void\))598 2361
y({)676 2452 y(off_LinkedId)i(*lid=\(off_LinkedId*\)b_shtls.)q(deque)q
(ue\(\))q(;)676 2543 y(if)e(\(!lid\))755 2635 y(return)g(ENOENT;)676
2726 y(if)g(\(!shtl.is_local\(lid->l_id\)\){)676 2817
y(do_debug\(printf\("bureaucrat:)46 b(should)40 b(raise)h(missing)g
(but)e(not)h(yet)g(implemented"\)\);)755 2909 y(return)g(ENOSYS;)676
3000 y(})676 3091 y(else)g({)755 3183 y(off_Shtl)h(*s=shtl+lid->l_id;)
755 3274 y(s->unblock\(\);)755 3365 y(return)f(EOK;)676
3456 y(})598 3548 y(})639 3767 y Fz(W)-7 b(e)19 b(ha)n(v)n(e)e(used)i
(some)e(metho)r(ds)i(that)g(will)f(b)r(e)h(describ)r(ed)f(b)r(elo)n(w.)
34 b(Namely)-7 b(,)20 b Fx(IdQueue::enqueue)515 3867
y Fz(and)28 b Fx(IdQueue::dequeue)22 b Fz(to)28 b(insert)g(and)g(remo)n
(v)n(e)f(elemen)n(ts)h(in)h(a)f(queue)g(of)g(iden)n(ti\014ers)515
3967 y(and)f(also)g Fx(block)p Fz(,)e Fx(unblock)p Fz(,)g(and)j
Fx(self)e Fz(to)h(b)r(e)h(describ)r(ed)f(in)h(the)g(sh)n(uttle)g(serv)n
(er.)639 4066 y(When)k(a)e(Bureaucrat)f(is)h(destro)n(y)n(ed)g(it)h
(will)g(try)f(to)h(a)n(w)n(ak)n(e)d(ev)n(ery)i(sh)n(uttle)h(sleeping)
515 4166 y(on)c(it.)515 4276 y Fk(h)p Fi(off)p 667 4276
V 29 w(Bureaucrat::~off)p 1320 4276 V 31 w(Bureaucrat)j
Fj(implementation.)e Fk(i)o Fq(\021)598 4367 y Fi(//)39
b(Destroyes)j(a)d(bureaucrat.)598 4458 y
(off_Bureaucrat::~off_Bureaucra)q(t\(voi)q(d\))598 4550
y({)676 4641 y(while)i(\(wakeup\(\)==EOK\))755 4732 y(;)676
4824 y(assert\(b_shtls.is_empty\(\)\);)598 4915 y(})1905
5255 y Fz(30)p eop
PStoPSsaved restore
%%Page: (32,33) 17
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
31 32 bop 639 523 a Fz(Using)30 b(these)g(bureaucrats)e(w)n(e)h(can)h
(implemen)n(t)g(b)r(oth)g(semaphores)f(and)g(condition)515
623 y(v)-5 b(ariables.)515 756 y Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l
(acy.)j Fk(i)p Fq(\021)598 847 y Fi(//)39 b(A)h(typical)h(bureaucrat,)g
(a)f(semaphore.)598 938 y(class)g(off_Sem)h(:)e(public)i
(off_Bureaucrat)h({)598 1029 y(protected:)676 1121 y(natural_t)238
b(b_nwait;)394 b(//)39 b(-#)h(of)g(shuttles)h(waiting)g(or)e(0)h(or)f
(#)h(slots)598 1212 y(public:)676 1303 y(off_Sem\(natural_t)j
(free_slots=1\))f(:)e(b_nwait\(free_slots\),off_Burea)q(ucrat)q(\(\))45
b({;})676 1395 y(void)40 b(up\(void\);)676 1486 y(err_t)80
b(down\(void\);)598 1577 y(};)598 1760 y(//)39 b(A)h(typical)h
(bureaucrat,)g(a)f(condition)h(variable)598 1851 y(class)f(off_Cond)h
(:)f(public)g(off_Bureaucrat)j({)598 1943 y(protected:)676
2034 y(natural_t)238 b(b_nwait;)394 b(//#)40 b(of)f(shuttles)i(waiting)
598 2125 y(public:)676 2217 y(off_Cond\(void\))i(:)c(b_nwait\(0\))j
({;})676 2308 y(err_t)f(wait\(void\);)676 2399 y(void)80
b(signal\(void\);)676 2491 y(void)g(signalall\(void\);)598
2582 y(};)515 2848 y Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l(acy)j
(implementation.)e Fk(i)p Fq(\021)598 2939 y Fi(void)40
b(off_Sem::up\(void\))598 3030 y({)676 3122 y(w_lock\(\);)676
3213 y(if)g(\(b_nwait++)h(<)f(0\))755 3304 y(wakeup\(\);)676
3396 y(w_unlock\(\);)598 3487 y(})598 3578 y(err_t)g
(off_Sem::down\(void\))598 3670 y({)676 3761 y(w_lock\(\);)676
3852 y(if)g(\(--b_nwait)h(<)f(0\))755 3944 y(return)g(sleep\(\);)676
4035 y(else{)755 4126 y(w_unlock\(\);)755 4218 y(return)g(EOK;)676
4309 y(})598 4400 y(})1905 5255 y Fz(31)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
32 33 bop 515 523 a Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l(acy)j
(implementation.)e Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(err_t)40
b(off_Cond::wait\(void\))598 706 y({)676 797 y(w_lock\(\);)676
888 y(b_nwait++;)676 980 y(return)h(sleep\(\);)598 1071
y(})598 1254 y(void)79 b(off_Cond::signal\(void\))598
1345 y({)676 1436 y(w_lock\(\);)676 1528 y(if)40 b(\(b_nwait>0\))i({)
755 1619 y(--b_nwait;)755 1710 y(wakeup\(\);)676 1802
y(})676 1893 y(w_unlock\(\);)598 1984 y(})598 2167 y(void)79
b(off_Cond::signalall\(void\))598 2258 y({)676 2350 y(w_lock\(\);)676
2441 y(while)41 b(\(b_nwait>0\))g({)755 2532 y(--b_nwait;)755
2623 y(wakeup\(\);)676 2715 y(})676 2806 y(w_unlock\(\);)598
2897 y(})1905 5255 y Fz(32)p eop
PStoPSsaved restore
%%Page: (34,35) 18
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
33 34 bop 639 523 a Fz(Sligh)n(tly)22 b(di\013eren)n(t)h(implemen)n
(tations)f(are)f(a)n(v)-5 b(ailable)21 b(for)g(use)h(in)h(userland.)34
b(Only)22 b(the)515 623 y(bureaucrat)k(itself)i(needs)f(to)h(b)r(e)g
(patc)n(hed.)515 756 y Fk(h)p Fj(O\013)f(bur)l(e)l(aucr)l(acy)j(for)e
(users)h(implementation.)e Fk(i)p Fq(\021)598 938 y Fk(h)p
Fi(off)p 750 938 24 4 v 29 w(Bureaucrat::~off)p 1403
938 V 31 w(Bureaucrat)j Fj(implementation.)e Fk(i)598
1121 y Fi(//)39 b(Puts)i(the)e(caller)i(to)f(sleep)g(on)g(this)g
(bureaucrat.)i(The)e(lock)g(must)g(be)598 1212 y(//)f(held)i(in)e
(write)i(mode.)f(\(releases)h(the)f(lock\))598 1303 y(err_t)g
(off_Bureaucrat::sleep\(void\))598 1395 y({)676 1486
y(off_uShtl)h(me=off_uShtl::self\(\);)676 1577 y(off_LinkedId)h
(lid\(me.get_id\(\)\);)676 1669 y(b_shtls.enqueue\(&lid\);)676
1760 y(w_unlock\(\);)676 1851 y(me.set_prop\(OFF_SHTLP_RUNS,o)q(ff_id)q
(_t\(0)q(,OFF)q(_SHTL)q(_RBL)q(K\),__)q(ndr,)q(__nd)q(r\);)598
2034 y(})598 2217 y(//)d(Awakes)i(the)f(first)g(enqueued)h(guy.)f(The)g
(lock)h(must)f(be)598 2308 y(//)f(held)i(in)e(write)i(mode.)598
2399 y(err_t)f(off_Bureaucrat::wakeup\(void\))598 2491
y({)676 2582 y(off_LinkedId)i(*lid=\(off_LinkedId*\)b_shtls.)q(deque)q
(ue\(\))q(;)676 2673 y(if)e(\(!lid\))755 2765 y(return)g(ENOENT;)676
2856 y(else)g({)755 2947 y(off_uShtl)h(s\(lid->l_id\);)755
3039 y(s.set_prop\(OFF_SHTLP_RUNS,off_i)q(d_t\()q(0,OF)q(F_SHT)q(L_RR)q
(DY\),_)q(_ndr)q(,__n)q(dr\);)755 3130 y(return)f(EOK;)676
3221 y(})598 3313 y(})598 3495 y Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l
(acy)j(implementation.)e Fk(i)1905 5255 y Fz(33)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
34 35 bop 515 523 a FA(Bureaucracy)34 b Fg(C)7 b Fx(++)31
b FA(source)h(\014les)515 676 y Fz(The)18 b(source)f(\014les)i(con)n
(taining)e(this)i(co)r(de)f(are)f(named)h Fx(klib/Bureaucrat.h)12
b Fz(and)18 b Fx(klib/Bureaucrat.)o(C)p Fz(.)639 776
y(The)28 b(in)n(terface)f(is)g(only)h(visible)f(inside)h(the)g(k)n
(ernel.)515 892 y Fk(h)p Fj(Bur)l(e)l(aucr)l(at.h*)11
b Fk(i)r Fq(\021)598 983 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 1075
y Fi(#ifndef)41 b(__OFF_BUREAUCRAT_H)598 1166 y(#define)80
b(__OFF_BUREAUCRAT_H)43 b(1)598 1349 y(#include)e(<assert.h>)512
b(//)40 b(for)g(assert)598 1440 y(#include)h(<klib/ids.h>)434
b(//)40 b(for)g(off_shtl_id_t)598 1531 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)598 1623 y(#include)h(<klib/BlockAllocator.h>)j
(//)c(for)g(off_BlockAllocator)598 1714 y(#include)h(<klib/dqueue.h>)
317 b(//)40 b(for)g(DLinkedQueue)i(et)d(al)598 1805 y(#include)i
(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t,)h(natural_t)g(et)f
(al.)598 2079 y(#include)h(<klib/mdep/bitops.h>)122 b(//)40
b(for)g(atomic)598 2171 y(#include)h(<klib/Lockable.h>)598
2536 y Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l(at)j(no)l(de.)e
Fk(i)598 2627 y(h)p Fj(O\013)f(bur)l(e)l(aucr)l(at.)j
Fk(i)598 2719 y(h)p Fj(O\013)d(bur)l(e)l(aucr)l(acy.)j
Fk(i)598 2901 y Fi(#endif)40 b(//)g(__OFF_BUREAUCRAT_H)515
3059 y Fk(h)p Fj(Bur)l(e)l(aucr)l(at.C*)11 b Fk(i)r Fq(\021)598
3150 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3333 y Fi(#include)41
b(<klib/Bureaucrat.h>)161 b(//)40 b(Exported)h(interface.)598
3424 y(#include)g(<shtl/ShtlSrv.h>)598 3698 y Fk(h)p
Fi(off)p 750 3698 24 4 v 29 w(Bureaucrat::~off)p 1403
3698 V 31 w(Bureaucrat)30 b Fj(implementation.)e Fk(i)598
3790 y(h)p Fi(off)p 750 3790 V 29 w(Bureaucrat::sleep)j
Fj(implementation.)c Fk(i)598 3881 y(h)p Fi(off)p 750
3881 V 29 w(Bureaucrat::wakeup)k Fj(implementation.)d
Fk(i)598 3972 y(h)p Fj(O\013)f(bur)l(e)l(aucr)l(acy)j(implementation.)e
Fk(i)515 4147 y(h)p Fj(uBur)l(e)l(aucr)l(at.C*)11 b Fk(i)r
Fq(\021)598 4238 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 4329 y Fi(#undef)40
b(__KERNEL__)598 4421 y(#include)h(<prtl/ex.h>)598 4512
y(#include)g(<klib/Bureaucrat.h>)161 b(//)40 b(Exported)h(interface.)
598 4603 y(#include)g(<shtl/ShtlSrv.h>)598 4695 y(#include)g
(<node/Node.h>)598 4969 y Fk(h)p Fj(O\013)27 b(bur)l(e)l(aucr)l(acy)j
(for)e(users)h(implementation.)e Fk(i)1905 5255 y Fz(34)p
eop
PStoPSsaved restore
%%Page: (36,37) 19
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
35 36 bop 515 523 a Fn(2.3.4)112 b(Sequencers)515 676
y Fz(Some)25 b(ob)5 b(jects)25 b(will)h(need)g(to)f(atomically)g
(obtain)g(unique)h(sequence)f(n)n(um)n(b)r(ers)g(to)g(create)515
776 y(unique)h(iden)n(ti\014ers)g(\(for)h(other)e(ob)5
b(jects)26 b(con)n(tained)g(inside\).)37 b(Again,)26
b(this)h(functionalit)n(y)515 876 y(is)g(incorp)r(orated)f(in)n(to)i
(the)g(aggregate.)515 1008 y Fk(h)p Fj(O\013)f(private)i(memb)l(ers)f
(for)g(se)l(quencing)h(obje)l(cts.)f Fk(i)p Fq(\021)598
1100 y Fi(off_seq_t)41 b(_seq;)472 b(//)40 b(Next)g(sequence)h(nb.)515
1274 y Fk(h)p Fj(O\013)27 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)f(for)f(se)
l(quencing)h(obje)l(cts.)g Fk(i)o Fq(\021)598 1365 y
Fi(//)39 b(Gets)i(a)e(new)h(sequence)h(number.)g(\(Container)g(object)g
(must)f(be)g(locked.\))598 1457 y(inline)g(off_seq_t)i(get_seq\(void\))
g({return)f(_seq++;};)639 1598 y Fz(Note)26 b(that)f(the)h(ob)5
b(ject)25 b(m)n(ust)h(b)r(e)g(lo)r(c)n(k)n(ed)e(during)h
Fx(get)p 2369 1598 27 4 v 30 w(seq)f Fz(and)i(the)f(sequence)g(n)n(um-)
515 1697 y(b)r(er)i(m)n(ust)h(b)r(e)g(initialized)g(b)n(y)f(the)h
(aggregate.)515 1814 y Fk(h)p Fj(O\013)f(initialization)g(for)g(se)l
(quencing)j(obje)l(cts.)e Fk(i)p Fq(\021)598 1905 y Fi(_seq=0;)1905
5255 y Fz(35)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
36 37 bop 515 523 a Fn(2.3.5)112 b(In)m(tegrit)m(y)36
b(c)m(hec)m(ks)515 676 y Fz(T)-7 b(o)26 b(ensure)g(that)i(references)d
(to)i(system)g(resources)d(are)i(v)-5 b(alid,)27 b(ev)n(ery)f(resource)
f(includes)515 776 y(a)i(magic)g(n)n(um)n(b)r(er)g(whic)n(h)h(can)f(b)r
(e)h(tested)g(at)f(run)h(time.)639 876 y(The)g(magic)f(n)n(um)n(b)r(er)
g(is)h(actually)f(a)g(string)g(of)g(four)g(c)n(haracters.)515
1008 y Fk(h)p Fj(O\013)g(magic)g(numb)l(er.)h Fk(i)p
Fq(\021)598 1191 y Fi(class)40 b(off_Magic)h({)598 1282
y(private:)676 1374 y(off_magic_t)h(m_number;)512 b(//)40
b(The)g(magic)g(number.)598 1465 y(public:)676 1556 y(//)g(Creates)h
(an)e(unitilized)j(magic)e(number.)676 1648 y(off_Magic\(void\){;})676
1739 y(//)g(Creates)h(a)e(magic)i(number.)676 1830 y(off_Magic\()h
(const)e(char)g(*str)g(\))g(:)f(m_number\(*\(off_magic_t*\)str\))46
b({)39 b(assert\(str\);)j(})676 1922 y(//)e(Creates)h(a)e(magic)i
(number.)676 2013 y(off_Magic\()h(const)e(off_magic_t)i(n\))d(:)h
(m_number\(n\))i({)d(})676 2196 y(//)h(Test)g(a)f(magic)i(number)676
2287 y(boolean_t)g(operator==\(const)i(off_Magic)f(other\))e(const)h({)
755 2378 y(return)f(\(m_number)i(==)d(other.m_number\);)676
2470 y(})676 2561 y(boolean_t)i(operator==\(const)i(off_magic_t)f
(other\))f(const)f({)755 2652 y(return)g(\(m_number)i(==)d(other\);)676
2744 y(})676 2835 y(boolean_t)i(operator!=\(const)i(off_Magic)f
(other\))e(const)h({)755 2926 y(return)f(\(m_number)i(!=)d
(other.m_number\);)676 3018 y(})676 3109 y(boolean_t)i
(operator!=\(const)i(off_magic_t)f(other\))f(const)f({)755
3200 y(return)g(\(m_number)i(!=)d(other\);)676 3291 y(})676
3383 y Fk(h)p Fj(Other)29 b(public)e(memb)l(ers)i(of)e
Fi(off)p 1677 3383 24 4 v 29 w(Magic)p Fj(.)h Fk(i)598
3565 y Fi(};)639 3798 y Fz(This)g(co)r(de)f(dep)r(ends)h(on)g
(de\014nitions)f(found)h(in)g Fx(types.h)p Fz(.)515 3914
y Fk(h)p Fj(O\013)f(magic)g(numb)l(er)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 4005 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 4097 y(#include)h(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)639
4221 y Fz(Resources)26 b(can)i(no)n(w)f(include)h(this)f(mem)n(b)r(er.)
515 4338 y Fk(h)p Fj(O\013)g(private)i(memb)l(ers)f(for)g(inte)l(grity)
h(che)l(cke)l(d)g(r)l(esour)l(c)l(es.)h Fk(i)p Fq(\021)598
4429 y Fi(off_Magic)41 b(_magic;)590 b(//)40 b(Magic)g(number)639
4553 y Fz(Concrete)c(instances)g(of)h(system)f(resource)f(should)i
(initialize)f(the)h(magic)f(n)n(um)n(b)r(er)515 4653
y(with)29 b(appropriate)e(v)-5 b(alues)29 b(for)f(further)h(c)n(hec)n
(king.)40 b(It)29 b(m)n(ust)g(b)r(e)h(initialized)f(at)g(resource)515
4753 y(instan)n(tiation)e(time.)515 4885 y Fk(h)p Fj(O\013)g
(initialization)g(for)g(inte)l(grity)i(che)l(cke)l(d)h(r)l(esour)l(c)l
(es)g(with)d Fi(magic)p Fj(.)i Fk(i)o Fq(\021)598 4977
y Fi(_magic\(magic\))1905 5255 y Fz(36)p eop
PStoPSsaved restore
%%Page: (38,39) 20
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
37 38 bop 639 523 a Fz(Those)23 b(in)n(tegrit)n(y)g(c)n(hec)n(k)n(ed)f
(ob)5 b(jects)23 b(whic)n(h)h(are)e(not)i(resources)e(should)h(b)r(e)h
(initialized)515 623 y(to)r(o.)515 739 y Fk(h)p Fj(Initialize)i(inte)l
(grity)j(che)l(cke)l(d)h(obje)l(ct)e(with)g Fi(magic)p
Fj(.)g Fk(i)p Fq(\021)598 830 y Fi(_magic=magic;)639
955 y Fz(Thereafter,)f(the)h(magic)f(n)n(um)n(b)r(er)g(can)g(b)r(e)h
(obtained)g(with)g(this)g(metho)r(d.)515 1071 y Fk(h)p
Fj(O\013)f(pr)l(ote)l(cte)l(d)j(metho)l(ds)f(for)f(inte)l(grity)h(che)l
(cke)l(d)g(r)l(esour)l(c)l(es.)h Fk(i)p Fq(\021)598 1162
y Fi(//)39 b(Returns)i(the)f(magic)h(number.)598 1254
y(off_Magic)g(get_magic\(void\))i(const)d({return)h(_magic;})639
1378 y Fz(As)30 b(the)g(magic)f(n)n(um)n(b)r(er)g(iden)n(ti\014es)g
(the)h(class)f(a)g(resource)f(b)r(elongs)h(to,)h(w)n(e)f(also)f(use)515
1478 y(magic)g(n)n(um)n(b)r(ers)h(to)h(obtain)f(the)h(name)f(for)g(a)g
(giv)n(en)g(magic)f(n)n(um)n(b)r(er.)43 b(This)29 b(w)n(a)n(y)f(ev)n
(ery)515 1577 y(resource)e(can)h(kno)n(w)g(its)g(o)n(wn)g(class.)515
1694 y Fk(h)p Fj(Other)h(public)g(memb)l(ers)g(of)f Fi(off)p
1515 1694 24 4 v 29 w(Magic)p Fj(.)h Fk(i)p Fq(\021)598
1785 y Fi(//)39 b(Returns)i(a)f(full)g(name)g(for)g(this)g(magic)g
(number.)598 1876 y(const)g(char)g(*nameof\(void\);)639
2001 y Fz(Its)28 b(implemen)n(tation)g(is)f(a)g(big)h
Fx(switch)d Fz(on)i(the)h(magic)f(n)n(um)n(b)r(er)g(v)-5
b(alue.)515 2117 y Fk(h)p Fi(off)p 667 2117 V 29 w(Magic::nameof)30
b Fj(implementation.)d Fk(i)p Fq(\021)598 2208 y Fi(//)39
b(Returns)i(a)f(full)g(name)g(for)g(this)g(magic)g(number.)598
2300 y(const)g(char)g(*off_Magic::nameof\(void\))598
2391 y({)676 2482 y(switch\(m_number\))j({)755 2574 y
Fk(h)p Fi(off)p 907 2574 V 28 w(Magic::nameof)31 b Fj(c)l(ase)e(for)e
Fi(m)p 1799 2574 V 29 w(number)p Fj(s.)h Fk(i)676 2665
y Fi(default:)755 2756 y(return)40 b("bad)g(magic";)676
2848 y(})598 2939 y(})639 3064 y Fz(As)c(w)n(e)e(in)n(tro)r(duce)h(new)
g(magic)g(n)n(um)n(b)r(ers)g(through)f(this)i(do)r(cumen)n(t,)h(w)n(e)e
(will)g(add)515 3163 y(new)d Fx(case)f Fz(statemen)n(ts)i(to)f(this)h
(metho)r(d.)52 b(Those)32 b(statemen)n(ts)g(use)g(constan)n(ts)g
(\(whic)n(h)515 3263 y(are)26 b(also)h(exp)r(orted\))g(for)g(existing)h
(magic)e(n)n(um)n(b)r(ers.)515 3396 y Fk(h)p Fj(O\013)h(magic)g(numb)l
(er)i(data)f(typ)l(e.)h Fk(i)p Fq(\021)598 3487 y Fi(//)39
b(Magic)i(number)f(constants.)598 3670 y(enum)79 b({)598
3761 y(OFF_MAGIC_START_AT=0xdeadbeef,)598 3852 y Fk(h)p
Fj(O\013)27 b(magic)g(numb)l(ers.)i Fk(i)598 3944 y Fi(};)598
4035 y(typedef)41 b(int)e(off_magic_t;)1905 5255 y Fz(37)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
38 39 bop 515 523 a FA(Magic)31 b(n)m(um)m(b)s(ers)g
Fg(C)7 b Fx(++)31 b FA(source)g(\014les)515 676 y Fz(Magic)26
b(n)n(um)n(b)r(er)i(co)r(de)f(is)h(k)n(ept)f(in)h Fx(klib/Magic.h)23
b Fz(and)k Fx(klib/Magic.C)p Fz(.)515 793 y Fk(h)p Fj(Magic.h*)11
b Fk(i)p Fq(\021)598 884 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 1066
y Fi(#ifndef)41 b(__OFF_MAGIC_H)598 1158 y(#define)g(__OFF_MAGIC_H)h(1)
598 1340 y Fk(h)p Fj(O\013)27 b(magic)g(numb)l(er)i(dep)l(endencies.)g
Fk(i)598 1523 y(h)p Fj(O\013)e(magic)g(numb)l(er)i(data)f(typ)l(e.)h
Fk(i)598 1614 y(h)p Fj(O\013)e(magic)g(numb)l(er.)h Fk(i)598
1797 y Fi(#endif)40 b(//)g(__OFF_MAGIC_H)515 2046 y Fk(h)p
Fj(Magic.C*)11 b Fk(i)o Fq(\021)598 2137 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2320 y Fi(#include)41 b(<klib/Magic.h>)356 b(//)40
b(Exported)h(interface.)598 2503 y Fk(h)p Fi(off)p 750
2503 24 4 v 29 w(Magic::nameof)30 b Fj(implementation.)d
Fk(i)1905 5255 y Fz(38)p eop
PStoPSsaved restore
%%Page: (40,41) 21
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
39 40 bop 515 523 a Fr(2.4)135 b(System)45 b(resources)515
721 y Fn(2.4.1)112 b(System)37 b(resource)h(o)m(v)m(erview)515
875 y Fz(Eac)n(h)26 b(resource)g(in)i(the)g(system)g(supp)r(orts)f(a)g
(set)h(of)g(w)n(ell-de\014ned)f(op)r(erations.)36 b(Namely)-7
b(,)515 974 y(those)34 b(pro)n(vided)f(b)n(y)i(building)f(blo)r(c)n(ks)
g(that)h(w)n(e)f(ha)n(v)n(e)f(seen)h(b)r(efore)h(and)f(a)g(few)h
(others)515 1074 y(lik)n(e)e Fx(nameof)p Fz(,)g(to)g(get)h(the)g
(resource)e(name,)j Fx(freeze)p Fz(,)d(to)i(get)f(the)h(state)g(of)f
(the)h(ob)5 b(ject)515 1174 y(and)29 b(defer)f(an)n(y)h(further)g(in)n
(v)n(o)r(cations,)e Fx(melt)p Fz(,)h(to)h(recreate)f(a)g(frozen)h(ob)5
b(ject,)29 b(and)g(\\)p Fx(<<)p Fz(",)515 1273 y(whic)n(h)e(will)h
(prin)n(t)g(a)f(represen)n(tation)f(of)h(the)h(resource)e(state.)515
1406 y Fk(h)p Fj(O\013)h(r)l(esour)l(c)l(e.)i Fk(i)p
Fq(\021)598 1497 y Fi(//)39 b(A)h(system)g(resource.)598
1589 y(//)598 1680 y(class)g(off_Resource)i(:)e(public)g(off_Lockable)i
({)598 1771 y(private:)676 1863 y Fk(h)p Fj(O\013)27
b(private)i(memb)l(ers)g(for)e(inte)l(grity)i(che)l(cke)l(d)g(r)l
(esour)l(c)l(es.)h Fk(i)676 1954 y(h)p Fj(O\013)d(private)i(memb)l(ers)
g(for)e(pr)l(ote)l(cte)l(d)k(obje)l(cts.)d Fk(i)676 2045
y(h)p Fj(O\013)f(private)i(memb)l(ers)g(for)e(r)l(efer)l(enc)l(e)j(c)l
(ounting)e(obje)l(cts.)h Fk(i)676 2137 y(h)p Fj(Other)g(private)f(memb)
l(ers)h(of)e Fi(off)p 1713 2137 24 4 v 29 w(Resource)p
Fj(.)i Fk(i)598 2228 y Fi(protected:)676 2319 y Fk(h)p
Fj(Other)g(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e Fi(off)p
1778 2319 V 29 w(Resource)p Fj(.)i Fk(i)676 2411 y(h)p
Fj(O\013)e(pr)l(ote)l(cte)l(d)k(metho)l(ds)e(for)e(inte)l(grity)i(che)l
(cke)l(d)h(r)l(esour)l(c)l(es.)f Fk(i)676 2502 y(h)p
Fj(O\013)e(pr)l(ote)l(cte)l(d)k(metho)l(ds)e(for)e(r)l(efer)l(enc)l(e)j
(c)l(ounting)f(obje)l(cts.)f Fk(i)676 2593 y(h)p Fj(Other)h(pr)l(ote)l
(cte)l(d)h(metho)l(ds)f(of)e Fi(off)p 1755 2593 V 29
w(Resource)p Fj(.)i Fk(i)598 2685 y Fi(public:)676 2867
y Fk(h)p Fj(O\013)e(public)h(metho)l(ds)h(for)e(r)l(efer)l(enc)l(e)j(c)
l(ounting)f(obje)l(cts.)f Fk(i)676 2959 y(h)p Fj(O\013)f(public)h
(metho)l(ds)h(for)e(pr)l(ote)l(cte)l(d)k(obje)l(cts.)d
Fk(i)676 3233 y Fi(//)40 b(Every)g(resource)h(\(be)f(it)g(simple)g(or)g
(compound\))h(is)f(named)g(and)g(is)g(able)g(to)g(be)676
3324 y(//)79 b(dumped)41 b(for)f(inspection)h(and)f(frozen/melted.)676
3415 y(//)g(Names)g(it.)676 3507 y(virtual)h(const)f(char)h
(*nameof\(void\)=0;)676 3598 y(//)f(Names)g(its)g(class.)676
3689 y(virtual)h(const)f(char)h(*kindof\(void\))h({)d(return)i
(get_magic\(\).nameof\(\);)j(})676 3780 y(//)c(Gives)g(its)g(URL)676
3872 y(virtual)h(const)f(char)h(*get_url\(void\)=0;)676
3963 y(//)f(Dumps)g(it.)676 4054 y(friend)h(OStr)f(&operator<<\(OStr)j
(&s,)d(const)g(off_Resource)i(&r\);)676 4237 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
4237 V 29 w(Resource)p Fj(.)i Fk(i)598 4328 y Fi(};)1905
5255 y Fz(39)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
40 41 bop 639 523 a Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(already)f(in)n(tro)r
(duced)h(a)g(few)h(dep)r(endencies.)515 639 y Fk(h)p
Fj(O\013)f(r)l(esour)l(c)l(e)j(dep)l(endencies.)f Fk(i)p
Fz(+)p Fq(\021)598 731 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
822 y(#include)h(<klib/Lockable.h>)239 b(//)40 b(for)g(Lockable.)598
913 y(#include)h(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)i(et)
e(al.)598 1005 y(#include)h(<klib/Magic.h>)356 b(//)40
b(for)g(off_Magic)h(et)f(al.)598 1096 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)598 1187
y(#include)h(<klib/str.h>)434 b(//)40 b(for)g(OStr)639
1312 y Fz(Also,)26 b(w)n(e)g(should)f(men)n(tion)h(that)g(some)f
(resource)f(mem)n(b)r(ers)i(are)e(initialized)i(at)g(allo-)515
1411 y(cation)k(time)i(with)f(the)h(information)e(pro)n(vided)g(b)n(y)h
(system)g(users.)46 b(That)31 b(information)515 1511
y(includes)38 b(the)g(protection)g(for)f(the)h(resource,)h(the)g
(resource)d(iden)n(ti\014er)i(and)f(an)h(iden-)515 1611
y(ti\014er)d(used)g(to)h(iden)n(tify)g(the)f(user-lev)n(el)f(en)n(tit)n
(y)i(resp)r(onsible)e(for)h(the)h(ob)5 b(ject)35 b(after)g(its)515
1710 y(allo)r(cation;)26 b(w)n(e)i(name)f(suc)n(h)g(en)n(tit)n(y)h(the)
g(ob)5 b(ject)27 b Fy(domain)p Fz(.)639 1810 y(Being)34
b(the)h Fy(Portal)45 b Fz(the)35 b(IPC)f(mec)n(hanism)g(pro)n(vided)g
(b)n(y)g(the)h(k)n(ernel,)g(the)g(domain)515 1910 y(iden)n(ti\014er)25
b(is)h(indeed)g(a)f(p)r(ortal)h(iden)n(ti\014er)f(of)h(t)n(yp)r(e)g
Fx(off)p 2278 1910 27 4 v 30 w(prtl)p 2484 1910 V 30
w(id)p 2602 1910 V 30 w(t)p Fz(.)36 b(By)26 b(doing)f(that,)h(w)n(e)515
2009 y(can)i(ha)n(v)n(e)g(the)i(k)n(ernel)e(p)r(erforming)g(up)r(calls)
h(to)g(either)g(user-lev)n(el)e(or)h(in-k)n(ernel)g(domain)515
2109 y(serv)n(ers)k(whic)n(h)i(will)g(b)r(e)g(resp)r(onsible)f(for)h
(allo)r(cated)f(system)h(resources.)54 b(Besides,)35
b(the)515 2208 y(meaning)24 b(of)g(the)h(domain)e(abstraction)g(is)i
(de\014ned)f(b)n(y)g(the)h(user)f(and)g(not)g(b)n(y)g(the)h(k)n(ernel,)
515 2308 y(as)i(will)g(b)r(e)h(discussed)g(in)f(section)h(2.8.)515
2441 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2441 24 4 v 29 w(Resource)p Fj(.)g Fk(i)p
Fq(\021)598 2532 y Fi(off_prtl_id_t)42 b(r_domain;)355
b(//)40 b(Domain)g(for)g(the)g(resource)598 2623 y(off_id_t)h(r_id;)707
b(//)40 b(Resource)h(identifier.)515 2798 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2798 V 29
w(Resource)p Fj(.)i Fk(i)o Fq(\021)598 2889 y Fi(//)39
b(Returns)i(the)f(resource)h(domain.)598 2980 y(const)f(off_prtl_id_t)i
(&get_domain\()g(void)e(\))g(const)g({)g(return)g(r_domain;)i(})598
3072 y(//)d(Returns)i(the)f(resource)h(identifier.)598
3163 y(const)f(off_id_t)80 b(&get_id\(void\))43 b(const)d({)f(return)i
(r_id;)f(})639 3304 y Fz(The)28 b(domain)f(migh)n(t)h(b)r(e)g(reset)f
(so)g(w)n(e)g(pro)n(vide)f(this)i(metho)r(d.)515 3421
y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3421 V 29 w(Resource)p Fj(.)i Fk(i)o Fq(\021)598
3512 y Fi(//)39 b(Sets)i(the)e(resource)j(domain.)598
3603 y(void)e(set_domain\(const)j(off_prtl_id_t)f(&d\))e({)f
(r_domain=d;)j(})598 3694 y(//)d(Sets)i(the)e(resource)j(identifier.)
598 3786 y(void)197 b(set_id\(const)42 b(off_id_t)f(&id\))f({)f(r_id)i
(=)e(id;)h(})515 3944 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(dep)l
(endencies.)f Fk(i)p Fz(+)p Fq(\021)598 4035 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(off_prtl_id_t)i(et)d(al.)1905
5255 y Fz(40)p eop
PStoPSsaved restore
%%Page: (42,43) 22
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
41 42 bop 639 523 a Fz(The)28 b(constructor)e(do)r(es)h(the)h(job.)515
639 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 639 24 4 v 29 w(Resource)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 731 y Fi(//)39 b(Creates)i(a)f(resource.)598
822 y(off_Resource\(const)j(off_Protection)f(&p,)1108
913 y(const)e(off_prtl_id_t)i(&domain,)f(const)g(off_id_t)276
b(&id,)1108 1005 y(const)40 b(off_magic_t)i(magic)e(\):)676
1096 y Fk(h)p Fj(O\013)27 b(initialization)g(for)h(inte)l(grity)h(che)l
(cke)l(d)g(r)l(esour)l(c)l(es)h(with)e Fi(magic)p Fj(.)g
Fk(i)p Fi(,)676 1187 y(r_domain\(domain\),)43 b(r_id\(id\),)676
1279 y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 1279 V 29 w(Resource)p Fj(.)g Fk(i)598
1370 y Fi({)715 1461 y Fk(h)p Fj(O\013)g(initialization)e(for)i
Fi(p)g Fj(pr)l(ote)l(cte)l(d)i(obje)l(cts.)f Fk(i)715
1553 y(h)p Fj(O\013)f(initialization)e(for)i(r)l(efer)l(enc)l(e)h(c)l
(ounting)g(obje)l(cts.)g Fk(i)598 1644 y Fi(})639 1860
y Fz(A)f(con)n(v)n(en)n(tion)f(is)g(used)h(through)f(the)i(k)n(ernel,)e
(resources)e(used)j(for)f(the)i(k)n(ernel)e(itself)515
1959 y(b)r(elong)k(to)g(a)g(\\k)n(ernel")f(domain,)i(th)n(us)g(a)n(v)-5
b(ailable)30 b(resources)g(main)n(tain)h(alw)n(a)n(ys)f(a)h
Fx(NULL)515 2059 y Fz(domain.)515 2192 y Fk(h)p Fj(Other)d(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2192 V 29 w(Resource)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 2283 y Fi(//)39 b(Is)h(this)g
(resource)h(free?)598 2374 y(boolean_t)g(is_free\(void\))h(const)f({)e
(return)i(r_domain)g(==)e(OFF_PRTL_NULL;)k(})639 2516
y Fz(Finally)-7 b(,)28 b(this)g(dump)g(routine)f(is)h(pro)n(vided)e(as)
h(a)g(debug)h(aid.)515 2632 y Fk(h)p Fi(off)p 667 2632
V 29 w(Resource::operator<<)k Fj(implementation.)27 b
Fk(i)p Fq(\021)598 2723 y Fi(//)39 b(Dumps)i(the)f(resource.)598
2814 y(OStr)g(&operator<<\(OStr)j(&s,)d(const)g(off_Resource)i(&r\))598
2906 y({)676 2997 y(s)e(<<)f(\(r.is_locked\(\)?"L)k(":"u)e("\))e(<<)h
("RC=")g(<<)g(r.get_num_refs\(\))j(<<)d(")f(";)676 3088
y(s)h(<<)f("F=")h(<<)g(fmt\("0x\04502x",r.r_flags\))45
b(<<")40 b(")f(<<)h(nl;)676 3180 y(s)g(<<)f("id=")i(<<)e(r.get_id\(\))j
(<<)e(")f(";)676 3271 y(return)i(s;)598 3362 y(})1905
5255 y Fz(41)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
42 43 bop 515 523 a FA(Resource)31 b(for)h(users)515
676 y Fz(Resources)39 b(are)h(exp)r(orted)g(b)n(y)h(these)g(wrapp)r
(ers.)75 b(There)40 b(is)h(a)f(user)g(wrapp)r(er)g(whic)n(h)515
776 y(con)n(tains)33 b(the)i(resource)e(iden)n(ti\014er)h(\(hence,)j
(the)e(p)r(ortal)f(where)g(it)h(can)f(b)r(e)h(found\).)59
b(It)515 876 y(transforms)26 b(metho)r(d)i(in)n(v)n(o)r(cation)e(in)n
(to)i(p)r(ortal)f(in)n(v)n(o)r(cation.)515 1008 y Fk(h)p
Fj(O\013)g(r)l(esour)l(c)l(e)j(user)e(wr)l(app)l(er.)h
Fk(i)p Fq(\021)598 1100 y Fi(class)40 b(off_UWrapper)i({)598
1191 y(public:)676 1282 y(off_prtl_id_t)g(w_p;)598 1374
y(#ifdef)e(__KERNEL__)676 1465 y(off_UWrapper\(off_Resource)45
b(*r\);)598 1556 y(#endif)676 1648 y(off_UWrapper\(const)f(off_id_t)d
(&id\):)f(w_p\(id\))h({;})676 1739 y(off_UWrapper\(void\){;})676
1830 y(off_id_t)g(get_id\(void\))h(const)f({)e(return)i(w_p;)f(})598
2104 y(};)639 2337 y Fz(When)25 b(inside)g(the)f(k)n(ernel,)h(a)f(p)r
(oin)n(ter)g(to)g(a)g(k)n(ernel)f(ob)5 b(ject)24 b(can)g(b)r(e)h
(transformed)e(in)n(to)515 2436 y(a)k(user)g(wrapp)r(er)g(b)n(y)g(lo)r
(oking)f(up)i(its)g(iden)n(ti\014er.)515 2569 y Fk(h)p
Fi(off)p 667 2569 24 4 v 29 w(UWrapper::off)p 1203 2569
V 31 w(UWrapper)h Fj(implementation.)e Fk(i)p Fq(\021)598
2661 y Fi(off_UWrapper::off_UWrapper\(off)q(_Reso)q(urce)46
b(*r\):)676 2752 y(w_p\(r->get_id\(\)\))598 2843 y({;})639
3076 y Fz(A)33 b(k)n(ernel)f(wrapp)r(er)g(is)h(resp)r(onsible)f(for)h
(handling)f(messages)f(receiv)n(ed,)j(v)-5 b(alidating)515
3175 y(parameters)29 b(and)i(p)r(erforming)f(an)n(y)h(access)f(c)n(hec)
n(ks.)46 b(Then)31 b(it)h(calls)e(to)h(the)h(real)e(k)n(ernel)515
3275 y(ob)5 b(ject.)515 3408 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j
(kernel)e(wr)l(app)l(er.)h Fk(i)p Fq(\021)598 3499 y
Fi(class)40 b(off_Resource;)598 3590 y(class)g(off_Prtl;)598
3682 y(class)g(off_kWrapper)i({)598 3773 y(protected:)676
3864 y(off_Prtl)198 b(*w_p;)676 3956 y(off_Resource)42
b(*w_r;)598 4047 y(public:)676 4138 y(off_kWrapper\(off_Resource)j
(*r=NULL\))c(:)f(w_r\(r\){};)676 4230 y(void)g(start\(off_Resource)k
(*r,off_KernPrtlHandlerFn)g(*entry\);)676 4321 y(virtual)d(err_t)f
(handle\(const)i(off_shtl_id_t)h(&sender,)1500 4412 y(vm_size_t)e(msz,)
f(vm_size_t)i(rsz,)1500 4504 y(off_KernReq)g(*m,)e(off_KernRep)h
(*r\)=0;)598 4595 y(};)1905 5255 y Fz(42)p eop
PStoPSsaved restore
%%Page: (44,45) 23
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
43 44 bop 515 523 a Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(wr)l(app)l
(er)f(dep)l(endencies.)g Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<klib/ids.h>)598 706 y(#include)g(<klib/mdep/types.h>)598
797 y(#include)g(<prtl/ex.h>)639 938 y Fz(T)-7 b(o)28
b(create)g(the)h(k)n(ernel)e(wrapp)r(er)h(p)r(ortal,)g(a)g
Fx(start)f Fz(metho)r(d)i(is)f(pro)n(vided.)38 b(It)29
b(trans-)515 1038 y(forms)c(the)g(resource)f(iden)n(ti\014er)h(in)n(to)
g(a)g(p)r(ortal)g(iden)n(ti\014er)h(and)f(then)h(creates)e(it)i(with)g
(the)515 1137 y(en)n(try)h(pro)n(vided)f(b)n(y)i(the)g(caller.)515
1270 y Fk(h)p Fj(O\013)f(r)l(esour)l(c)l(e)j(wr)l(app)l(ers)f
(starting.)g Fk(i)p Fq(\021)598 1362 y Fi(//)39 b(Starts)i(wrapper)g
(operation.)598 1453 y(void)f(off_kWrapper::start\(off_Resour)q(ce)45
b(*r,off_KernPrtlHandlerFn)g(*entry\))c({)676 1544 y(w_r=r;)676
1636 y(w_p=new\(off_id_t\(w_r->get_id)q(\(\).ge)q(t_nd)q(\(\),0)q
(,w_r-)q(>get)q(_id\(\))q(.get)q(_srv)q(\(\)\)\))755
1727 y(off_Prtl\(nd.get_protection\(\),nd)q(.get)q(_dom)q(ain\(\))q(,)
1108 1818 y(\(vm_offset_t\)entry,0,OFF_ID_NU)q(LL,NU)q(LL,O)q(FF_M_)q
(ALL,)q(255\))q(;)598 1910 y(})515 2175 y Fk(h)p Fj(O\013)27
b(r)l(esour)l(c)l(e)j(wr)l(app)l(ers)f(implementation)f(dep)l
(endencies.)i Fk(i)o Fq(\021)598 2267 y Fi(#include)41
b(<klib/wrap.h>)598 2358 y(#include)g(<node/Node.h>)598
2449 y(#include)g(<prtl/Prtl.h>)639 2590 y Fz(User)f(wrapp)r(ers)f
(send)h(messages)e(to)i(k)n(ernel)g(p)r(ortals.)73 b(Those)40
b(messages)e(will)j(b)r(e)515 2690 y(de\014ned)33 b(while)h(k)n(ernel)e
(services)g(are)g(b)r(eing)i(describ)r(ed.)53 b(Starting)33
b(with)h(messages)d(un-)515 2790 y(dersto)r(o)r(d)c(b)n(y)g(ev)n(ery)f
(system)i(resource,)e(w)n(e)h(ha)n(v)n(e)f(these)i(ones:)515
2972 y FA(Initialization)40 b Fz(It)28 b(is)f(not)h(used)f(and)g(is)g
(pro)n(vided)g(as)f(a)h(ho)r(ok)g(to)g(let)h(resources)d(receiv)n(e)722
3072 y(initialization)19 b(messages.)32 b(Should)19 b(b)r(e)h(only)e
(used)h(within)g(the)h(k)n(ernel)e(and)h(receiv)n(es:)822
3238 y Fq(\017)41 b Fz(A)28 b(p)r(oin)n(ter)f(to)h(the)g(resource)d
Fx(rp)822 3371 y Fq(\017)41 b Fz(The)28 b(access)e(righ)n(ts)h(for)g
(the)h(resource)d Fx(r)p Fz(.)722 3504 y Fk(h)p Fj(O\013)i(r)l(esour)l
(c)l(e)j(messages.)f Fk(i)p Fq(\021)805 3595 y Fi(#define)41
b(OFF_MSG_R_INIT)121 b(0x000)884 3686 y(struct)40 b(off_r_init_req:)j
(public)e(off_KernReq)g({)962 3778 y(off_Resource)h(*rp;)962
3869 y(off_r_init_req\(off_Resource)k(*res,)40 b(off_Rights)h(r\))f(:)
1041 3960 y(off_KernReq\(OFF_MSG_R_INIT,r\),)q(rp\(re)q(s\))45
b({;})884 4051 y(};)884 4143 y(struct)40 b(off_r_init_rep:)j(public)e
(off_KernRep)g({)962 4234 y(off_r_init_rep\(err_t)j(res=0\))d(:)1041
4325 y(off_KernRep\(res\))i({;})884 4417 y(};)1905 5255
y Fz(43)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
44 45 bop 515 523 a FA(nameof)40 b Fz(Inquires)27 b(the)h(name)f(of)h
(the)g(resource.)35 b(Receiv)n(es)822 689 y Fq(\017)41
b Fz(The)28 b(\(read\))f(access)f(righ)n(ts)h(for)g(the)h(resource)e
Fx(r)p Fz(.)722 822 y Fk(h)p Fj(O\013)h(r)l(esour)l(c)l(e)j(messages.)f
Fk(i)p Fz(+)p Fq(\021)805 1005 y Fi(#define)41 b(OFF_MSG_R_NAMEOF)i
(0x001)884 1096 y(struct)d(off_r_nameof_req:)j(public)e(off_KernReq)h
({)962 1187 y(off_r_nameof_req\(off_Rights)k(r\))39 b(:)h
(off_KernReq\(OFF_MSG_R_NAMEOF,r)q(\))45 b({;})884 1279
y(};)884 1370 y(struct)40 b(off_r_nameof_rep:)j(public)e(off_KernRep)h
({)962 1461 y(char)e(*nm;)962 1553 y(off_r_nameof_rep\(char)k(*n,)c
(err_t)h(res=0\))f(:)1041 1644 y(nm\(n\),)g(off_KernRep\(res\))j({;})
884 1735 y(};)639 1993 y Fz(The)28 b(in)n(terface)f(pro)n(vided)f(b)n
(y)i(users)e(includes:)515 2109 y Fk(h)p Fj(O\013)h(r)l(esour)l(c)l(e)j
(for)d(users.)i Fk(i)p Fq(\021)598 2200 y Fi(class)40
b(off_uResource)i(:)e(public)g(off_UWrapper)i({)598 2291
y(public:)598 2383 y(#ifdef)e(__KERNEL__)676 2474 y
(off_uResource\(off_Resource)45 b(*r\):)40 b(off_UWrapper\(r\))j({;})
598 2565 y(#endif)676 2657 y(off_uResource\(void\))h({;})676
2748 y(off_uResource\(const)g(off_id_t)d(&id\):)f(off_UWrapper\(id\))j
({;})598 2839 y(#ifndef)e(__KERNEL__)676 2931 y(const)g(char)f
(*nameof\(off_Rights)j(r\))d({)755 3022 y(static)g(char)g(nmbuf[80];)
755 3113 y(off_r_nameof_req)j(req\(r\);)755 3205 y(off_r_nameof_rep)g
(rep\(nmbuf\);)755 3296 y(err_t)d(err=off_prtl_pct\(w_p,sizeof\(r)q
(eq\),)q(sizeo)q(f\(re)q(p\),&r)q(eq,&)q(rep,)q(0\);)755
3387 y(if)f(\(err)h(||)g(rep.m_err\))833 3479 y
(errno=\(err\)?err:rep.m_err;)755 3570 y(return)g(nmbuf;)676
3661 y(})598 3753 y(#endif)598 3844 y(};)1905 5255 y
Fz(44)p eop
PStoPSsaved restore
%%Page: (46,47) 24
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
45 46 bop 639 523 a Fz(This)21 b(is)g(the)g(k)n(ernel)f(wrapp)r(er.)33
b(It)21 b(includes)g(a)g(bunc)n(h)g(of)f(metho)r(ds)h(servicing)f
(concrete)515 623 y(messages)26 b(and)h(a)g(generic)g
Fx(handle)e Fz(en)n(try)i(p)r(oin)n(t.)515 756 y Fk(h)p
Fj(O\013)g(r)l(esour)l(c)l(e)j(for)d(users)i(in-kernel.)f
Fk(i)p Fq(\021)598 847 y Fi(class)40 b(off_kResource)i(:)e(public)g
(off_kWrapper)i({)598 938 y(public:)676 1029 y
(off_kResource\(off_Resource)j(*r=NULL\))c(:)f(off_kWrapper\(r\))i({;})
676 1212 y(virtual)f(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)
1461 1303 y(vm_size_t)e(msz,)f(vm_size_t)h(rsz,)1461
1395 y(off_KernReq)g(*m,)f(off_KernRep)i(*r\);)676 1486
y(void)e(nameof\(off_r_nameof_req)45 b(*m,)40 b(off_r_nameof_rep)j
(*r\))676 1577 y({)755 1669 y(\(void\)m;)755 1760 y
(strcpy\(r->nm,w_r->nameof\(\)\);)676 1851 y(})598 2034
y(};)639 2175 y Fz(The)25 b Fx(handle)d Fz(en)n(try)j(p)r(oin)n(t)f
(insp)r(ects)h(the)h(message)d(and)h(delegates)g(to)h(the)g(appropri-)
515 2275 y(ate)i(metho)r(d.)515 2391 y Fk(h)p Fi(off)p
667 2391 24 4 v 29 w(kResource::handle)k Fj(implementation.)c
Fk(i)p Fq(\021)598 2482 y Fi(err_t)40 b(off_kResource::handle\(const)45
b(off_shtl_id_t)e(&sender,)1225 2574 y(vm_size_t)f(msz,)e(vm_size_t)h
(rsz,)1225 2665 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
2756 y({)676 2848 y(//kcout)f(<<)f("r:)g(call)g(from)g(")f(<<)h(sender)
h(<<)e(")h(";)676 2939 y(//kcout)h(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 3030 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 3122 y(\(void\)sender;)676
3213 y(switch\(m->m_type\){)676 3304 y(case)h(OFF_MSG_R_NAMEOF:)755
3396 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_R,m)q(->m_)q(right)q
(s\)\))833 3487 y(return)i(EPERM;)755 3578 y(if)e
(\(msz!=sizeof\(off_r_nameof_re)q(q\))45 b(||)40 b
(rsz!=sizeof\(off_r_nameof_rep\))q(\))833 3670 y(return)h(EINVAL;)755
3761 y(nameof\(\(off_r_nameof_req)j(*\)m,)c(\(off_r_nameof_rep)k
(*\)r\);)755 3852 y(return)c(r->m_err;)676 3944 y(default:)755
4035 y(kcout)g(<<)g("res:)g(invalid)h(type)f(")f(<<)h
(fmt\("\045d\\n",m->m_type\);)755 4126 y(otsan\(\);)755
4218 y(return)g(ENOSYS;)676 4309 y(})598 4400 y(})1905
5255 y Fz(45)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
46 47 bop 515 523 a FA(Resource)31 b Fg(C)7 b Fx(++)31
b FA(source)g(\014les)515 676 y Fz(Resource)d(co)r(de)h(is)g(con)n
(tained)f(in)i Fx(klib/Resource.h)23 b Fz(and)29 b Fx(klib/Resource.C)
23 b Fz(source)515 776 y(\014les.)515 909 y Fk(h)p Fj(R)l(esour)l(c)l
(e.h*)11 b Fk(i)r Fq(\021)598 1000 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 1091 y Fi(#ifndef)41 b(__OFF_RESOURCE_H)598
1183 y(#define)80 b(__OFF_RESOURCE_H)43 b(1)598 1365
y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(dep)l(endencies.)f
Fk(i)598 1548 y(h)p Fj(O\013)e(r)l(esour)l(c)l(e)j(\015ag)e(bits.)g
Fk(i)598 1731 y Fi(#ifdef)40 b(__KERNEL__)598 1822 y
Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e.)i Fk(i)598 1913
y Fi(#endif)40 b(//)g(__KERNEL__)598 2096 y(#include)h(<prtl/ex.h>)598
2187 y(#include)g(<klib/wrap.h>)598 2279 y(#include)g
(<klib/uResource.h>)598 2644 y(#endif)f(//)g(__OFF_RESOURCE_H)515
2818 y Fk(h)p Fj(R)l(esour)l(c)l(e.C*)11 b Fk(i)q Fq(\021)598
2910 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3092 y Fi(#include)41
b(<klib/Resource.h>)239 b(//)40 b(Exported)h(interface.)598
3184 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(implementation)e(dep)l
(endencies.)h Fk(i)598 3366 y(h)p Fi(off)p 750 3366 24
4 v 29 w(Resource::operator<<)j Fj(implementation.)27
b Fk(i)598 3458 y(h)p Fj(Implementation)h(of)f(other)i(metho)l(ds)g(of)
e Fi(off)p 1976 3458 V 29 w(Resource)p Fj(.)i Fk(i)1905
5255 y Fz(46)p eop
PStoPSsaved restore
%%Page: (48,49) 25
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
47 48 bop 515 523 a Fk(h)p Fj(wr)l(ap.h*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y Fi(#ifndef)41
b(__OFF_WRAP_H)598 797 y(#define)g(__OFF_WRAP_H)h(1)598
980 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(wr)l(app)l(er)f(dep)l
(endencies.)g Fk(i)598 1162 y Fi(#ifdef)40 b(__KERNEL__)598
1254 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(kernel)e(wr)l(app)l
(er.)h Fk(i)598 1345 y Fi(#endif)598 1528 y Fk(h)p Fj(O\013)e(r)l
(esour)l(c)l(e)j(user)e(wr)l(app)l(er.)h Fk(i)598 1710
y Fi(#endif)40 b(//)g(!__OFF_WRAP_H)515 1976 y Fk(h)p
Fj(wr)l(ap.C*)11 b Fk(i)p Fq(\021)598 2067 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2159 y(h)p Fj(O\013)f(r)l(esour)l(c)l(e)j(wr)l(app)l(ers)f
(implementation)f(dep)l(endencies.)i Fk(i)598 2341 y(h)p
Fj(O\013)d(r)l(esour)l(c)l(e)j(wr)l(app)l(ers)f(starting.)g
Fk(i)598 2433 y(h)p Fi(off)p 750 2433 24 4 v 29 w(UWrapper::off)p
1286 2433 V 31 w(UWrapper)g Fj(implementation.)e Fk(i)515
2607 y(h)p Fj(uR)l(esour)l(c)l(e.h*)11 b Fk(i)r Fq(\021)598
2698 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2790 y(h)p Fj(O\013)f(r)l(esour)l(c)l
(e)j(messages.)f Fk(i)598 2881 y(h)p Fj(O\013)e(r)l(esour)l(c)l(e)j
(for)d(users.)i Fk(i)1905 5255 y Fz(47)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
48 49 bop 515 523 a Fk(h)p Fj(kR)l(esour)l(c)l(e.h*)11
b Fk(i)r Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y
Fi(#include)41 b(<klib/Resource.h>)598 797 y(#include)g(<klib/str.h>)
277 b(//)40 b(for)g(kcout)598 888 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 980 y(#include)h(<string.h>)598
1162 y(#ifndef)g(__OFF_KRESOURCE_H)598 1254 y(#define)g
(__OFF_KRESOURCE_H)i(1)598 1436 y(#ifdef)d(__KERNEL__)598
1619 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(for)d(users)i
(in-kernel.)f Fk(i)598 1710 y(h)p Fj(O\013)f(r)l(esour)l(c)l(e)j(unit)e
(r)l(esour)l(c)l(e)i(for)d(users)i(in-kernel.)f Fk(i)598
1802 y(h)p Fj(O\013)f(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(for)d(users)
i(in-kernel.)f Fk(i)598 1893 y(h)p Fj(O\013)f(HW)g(r)l(esour)l(c)l(e)j
(unit)e(for)f(users)i(in-kernel.)f Fk(i)598 1984 y(h)p
Fj(O\013)f(HW)g(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(for)d(users)i
(in-kernel.)f Fk(i)598 2076 y(h)p Fj(O\013)f(abstr)l(act)j(r)l(esour)l
(c)l(e)g(unit)e(for)f(users)i(in-kernel.)f Fk(i)598 2167
y(h)p Fj(O\013)f(abstr)l(act)j(c)l(omp)l(ound)f(r)l(esour)l(c)l(e)h
(for)d(users)i(in-kernel.)f Fk(i)598 2350 y Fi(#endif)40
b(//)g(__KERNEL__)598 2441 y(#endif)g(//)g(__OFF_KRESOURCE_H)515
2707 y Fk(h)p Fj(kR)l(esour)l(c)l(e.C*)11 b Fk(i)r Fq(\021)598
2798 y Fi(//)598 2889 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g(MODIFY)g
(THIS)g(FILE)h(===)598 2980 y(//)598 3072 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
3163 y(//)e(programming)j(tool.)598 3254 y(//)598 3346
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 3437 y(//)598 3620 y(#include)h
(<klib/Resource.h>)239 b(//)40 b(Exported)h(interface.)598
3711 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
3802 y(#include)h(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
3894 y(#include)h(<string.h>)598 3985 y(#include)g(<klib/mdep/debug.h>)
598 4076 y(#include)g(<klib/kResource.h>)598 4259 y Fk(h)p
Fi(off)p 750 4259 24 4 v 29 w(kResource::handle)31 b
Fj(implementation.)c Fk(i)1905 5255 y Fz(48)p eop
PStoPSsaved restore
%%Page: (50,51) 26
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
49 50 bop 515 523 a Fn(2.4.2)112 b(Iden)m(ti\014ers)515
676 y Fy(O\013)17 b Fx(++)j Fz(uses)g(iden)n(ti\014ers)h(comp)r(osed)f
(b)n(y)g Fx(node-id:name-used)o(-i)o(n-h)o(w)p Fz(.)28
b(The)21 b(no)r(de)g(iden-)515 776 y(ti\014es)i(b)r(oth)g(the)g(mac)n
(hine)f(and)h(the)g(serv)n(er)e(where)h(the)h(iden)n(ti\014ed)g
(resource)e(w)n(as)h(created.)515 876 y(Metho)r(ds)28
b Fx(get)p 994 876 27 4 v 30 w(nd)e Fz(and)i Fx(get)p
1432 876 V 30 w(srv)f Fz(can)g(b)r(e)h(used)f(to)h(extract)f(suc)n(h)g
(v)-5 b(alues.)639 975 y(Iden)n(ti\014ers)22 b(for)g(comp)r(ound)g
(resources)e(let)i(us)h(kno)n(w)e(their)h(p)r(ortal)g(iden)n
(ti\014ers.)34 b(Giv)n(en)515 1075 y(an)24 b(iden)n(ti\014er)h
Fx(m:s:o)e Fz(\(mac)n(hine/serv)n(er/o\013set\),)f(the)j(p)r(ortal)f
(for)h(the)g(serv)n(er)e(in)n(v)n(olv)n(ed)g(is)515 1174
y(guaran)n(teed)j(to)h(ha)n(v)n(e)f(the)i(iden)n(ti\014er)g
Fx(m:0:s)p Fz(.)639 1274 y(The)g(size)f(of)h(eac)n(h)f(iden)n(ti\014er)
g(\014eld)h(is)f(de\014ned)h(as)f(sho)n(wn.)515 1390
y Fk(h)p Fj(O\013)g(identi\014er)h(\014elds)g(data)h(typ)l(es.)f
Fk(i)p Fq(\021)598 1482 y Fi(//)39 b(Fields)i(for)f(system)h
(identifiers.)598 1573 y(typedef)g(unsigned32_t)81 b(off_node_t;)g(//)
39 b(Node)i(descriptor)598 1664 y(typedef)g(off_mdep_offset_t)i
(off_offset_t;//)f(Elementary)g(unit)e(offset)h(number)639
1880 y Fz(Null)28 b(constan)n(ts)f(are)g(pro)n(vided)f(for)h(ev)n(ery)g
(\014eld.)515 1996 y Fk(h)p Fj(O\013)g(identi\014er)h(\014eld)g(nul)t
(l)f(values.)h Fk(i)p Fq(\021)598 2088 y Fi(const)40
b(off_node_t)120 b(OFF_ND_NULL)159 b(=)40 b(\(off_node_t\)0;)598
2179 y(const)g(off_offset_t)i(OFF_OFFSET_NULL=)h(\(off_offset_t\)0;)515
2337 y Fk(h)p Fj(O\013)27 b(identi\014er)h(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2428 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)639
2569 y Fz(Note)28 b(that)f(the)h(o\013set)g(is)f(a)g(mac)n(hine)g(dep)r
(enden)n(t)h(v)-5 b(alue,)27 b(b)r(ecause)g(it)h(usually)f(corre-)515
2669 y(sp)r(ond)22 b(to)f(the)i(ph)n(ysical)e(resource)f(name)i(whic)n
(h)f(turns)h(out)g(to)g(\014t)g(in)h(a)e(mac)n(hine)g(register.)639
2768 y(Th)n(us,)28 b(iden)n(ti\014ers)f(are)f(t)n(yp)r(ed:)515
2885 y Fk(h)p Fj(O\013)h(identi\014ers.)h Fk(i)p Fq(\021)598
2976 y Fi(//)39 b(Relocatable)j(top)e(level)g(identifier)598
3067 y(//)598 3159 y(typedef)598 3250 y(struct)80 b(off_id_t)41
b({)676 3341 y(off_node_t)h(i_node;)472 b(//)40 b(Creation)h(node)f
(for)g(the)g(object)676 3433 y(off_offset_t)i(i_offset;)238
b(//)39 b(id)h(relative)h(to)f(the)g(container.)h(\(phys)f(name\))676
3524 y Fk(h)p Fj(Other)29 b(public)e(memb)l(ers)i(of)e
Fi(off)p 1677 3524 24 4 v 29 w(id)p 1784 3524 V 28 w(t)p
Fj(.)h Fk(i)598 3615 y Fi(};)598 3798 y(typedef)41 b(unsigned32_t)81
b(off_seq_t;)120 b(//)39 b(Sequence)i(numbers)598 3889
y(const)f(off_seq_t)159 b(OFF_SEQ_NULL)120 b(=)40 b(\(off_seq_t\)0;)598
4072 y(//)f(elementary)j(unit)e(identifier)598 4163 y(//)598
4255 y(typedef)h(off_id_t)g(off_eu_id_t;)515 4412 y Fk(h)p
Fj(O\013)27 b(identi\014er)h(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 4504 y Fi(#include)41 b(<klib/mdep/ids.h>)239
b(//)40 b(for)g(off_mdep_offset_t)1905 5255 y Fz(49)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
50 51 bop 515 523 a Fk(h)p Fj(Other)28 b(public)g(memb)l(ers)g(of)f
Fi(off)p 1515 523 24 4 v 29 w(id)p 1622 523 V 29 w(t)p
Fj(.)g Fk(i)p Fq(\021)676 614 y Fi(int)40 b(operator==\(const)j
(off_id_t)e(&other\))g(const)f({)755 706 y(return)g(\(i_offset)i(==)d
(other.i_offset)k(&&)912 797 y(\(i_node&0xffff0000\))g(==)d
(\(other.i_node&0xffff0000\))84 b(\);)676 888 y(})676
980 y(int)40 b(operator!=\(const)j(off_id_t)e(&other\))g(const)f({)755
1071 y(return)g(\(i_offset)i(!=)d(other.i_offset)k(||)912
1162 y(\(i_node&0xffff0000\))g(!=)d(\(other.i_node&0xffff0000\))84
b(\);)676 1254 y(})639 1486 y Fz(An)39 b(elemen)n(tary)e(unit)i(iden)n
(ti\014er)g(can)e(b)r(e)i(declared)f(uninitialized)g(and)h(also)e(con-)
515 1586 y(structed)27 b(with)h(a)g(pre-sp)r(eci\014ed)f(v)-5
b(alue.)515 1702 y Fk(h)p Fj(Other)28 b(public)g(memb)l(ers)g(of)f
Fi(off)p 1515 1702 V 29 w(id)p 1622 1702 V 29 w(t)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 1793 y Fi(off_id_t\(void\){;})598
1885 y(off_id_t\(off_node_t)43 b(nd,)d(off_offset_t)i(offset\):)676
1976 y(i_node\(nd\),i_offset\(offset\))598 2067 y({;})598
2159 y(off_id_t\(off_node_t)h(nd,)d(off_node_t)i(srv,)e(off_offset_t)i
(offset\):)676 2250 y(i_node\(\(\(nd&0xffff\)<<16\)|\(sr)q(v&0xf)q
(fff\))q(\),i_)q(offse)q(t\(of)q(fset\))598 2341 y({;})598
2433 y(off_node_t)f(get_nd\(void\))h(const)80 b({)39
b(return)i(\(i_node>>16\);)h(})598 2524 y(off_node_t)f(get_srv\(void\))
h(const)f({)e(return)i(\(i_node&0xffff\);)i(})598 2615
y(off_id_t\(const)f(off_id_t)f(&p,)f(const)g(off_offset_t)i(o\))598
2707 y({)d(*this=p;)i(i_offset=o;)h(})639 2831 y Fz(Besides,)27
b(some)g(arithmetic)h(can)f(b)r(e)h(done)f(on)h(iden)n(ti\014ers.)515
2947 y Fk(h)p Fj(Other)g(public)g(memb)l(ers)g(of)f Fi(off)p
1515 2947 V 29 w(id)p 1622 2947 V 29 w(t)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 3039 y Fi(const)40 b(off_id_t)h(operator+\(const)i
(int)d(i\))f(const)i({)676 3130 y(return)g
(off_id_t\(*this,i_offset+i\);)598 3221 y(})598 3313
y(const)f(off_id_t)h(operator-\(const)i(int)d(i\))f(const)i({)676
3404 y(return)g(off_id_t\(*this,i_offset-i\);)598 3495
y(})598 3587 y(off_id_t)g(&operator++\(void\))82 b({)40
b(i_offset++;)h(return)g(*this;)f(})598 3678 y(off_id_t)h
(&operator--\(void\))82 b({)40 b(i_offset--;)h(return)g(*this;)f(})598
3769 y(off_id_t)h(operator++\(int)h(i\))79 b({)676 3861
y(off_id_t)41 b(r=*this;)g(i_offset+=i;)h(return)f(r;)598
3952 y(})598 4043 y(off_id_t)g(operator--\(int)h(i\))79
b({)676 4134 y(off_id_t)41 b(r=*this;)g(i_offset+=i;)h(return)f(r;)598
4226 y(})598 4317 y(const)f(off_id_t)h(&operator+=\(const)i(int)d(i\))
79 b({)40 b(i_offset+=i;)h(return)g(*this;)g(})598 4408
y(const)f(off_id_t)h(&operator-=\(const)i(int)d(i\))79
b({)40 b(i_offset-=i;)h(return)g(*this;)g(})598 4500
y(int)f(operator-\(const)i(off_id_t)f(&u\))f(const)h({)e(return)i
(i_offset-u.i_offset;)i(})639 4624 y Fz(Finally)-7 b(,)42
b(an)d(elemen)n(tary)g(unit)g(can)g(also)f(b)r(e)i(understo)r(o)r(d)f
(as)f(a)h(\(lo)r(cal\))g(mac)n(hine)515 4724 y(dep)r(enden)n(t)28
b(name.)515 4840 y Fk(h)p Fj(Other)g(public)g(memb)l(ers)g(of)f
Fi(off)p 1515 4840 V 29 w(id)p 1622 4840 V 29 w(t)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 4932 y Fi(operator)41 b(off_offset_t\(void\))
i(const)d({)g(return)h(i_offset;)g(})1905 5255 y Fz(50)p
eop
PStoPSsaved restore
%%Page: (52,53) 27
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
51 52 bop 639 523 a Fz(There)22 b(are)g(some)g(synon)n(yms)f(de\014ned)
i(mostly)f(for)g(do)r(cumen)n(tation)g(purp)r(oses.)34
b(They)515 623 y(corresp)r(ond)26 b(to)h(system)h(ob)5
b(jects)27 b(that)h(w)n(e)f(will)h(b)r(e)g(seeing)e(b)r(elo)n(w.)515
739 y Fk(h)p Fj(O\013)h(identi\014er)h(synonyms.)h Fk(i)o
Fq(\021)598 830 y Fi(//)39 b(Some)i(synonyms)g(for)f(common)g(system)h
(object)f(identifiers.)598 922 y(typedef)h(off_id_t)g(off_shtl_id_t;)h
(//)e(Shuttle)h(identifier.)598 1013 y(typedef)g(off_id_t)g
(off_prtl_id_t;)h(//)e(Portal)g(identifier.)598 1104
y(typedef)h(off_id_t)g(off_dtlb_id_t;)h(//)e(DTLB)g(identifer.)598
1196 y(typedef)h(off_id_t)119 b(off_proc_id_t;)42 b(//)e(Processor)h
(id.)598 1287 y(typedef)g(off_eu_id_t)g(off_pg_id_t;)h(//)e(Page)g
(frame)g(id.)598 1378 y(typedef)h(off_eu_id_t)g(off_io_id_t;)h(//)e(IO)
g(port)g(id.)598 1469 y(typedef)h(off_eu_id_t)g(off_ev_id_t;)h(//)e(HW)
g(Event)g(id.)598 1561 y(typedef)h(off_eu_id_t)g(off_tmr_id_t;)h(//)e
(HW)g(timer)g(id.)598 1652 y(typedef)h(off_eu_id_t)g(off_dma_id_t;)82
b(//)39 b(DMA)h(line)g(id.)598 1743 y(typedef)h(off_eu_id_t)g
(off_ts_id_t;)h(//)e(Processor)h(time)f(slice.)639 1959
y Fz(Null)28 b(v)-5 b(alues)28 b(are)e(also)h(a)n(v)-5
b(ailable.)515 2076 y Fk(h)p Fj(O\013)27 b(identifer)h(nul)t(l)f
(values.)g Fk(i)p Fq(\021)598 2167 y Fi(extern)40 b(const)h(off_id_t)g
(OFF_ID_NULL;)598 2258 y(extern)f(const)h(off_id_t)g(OFF_SHTL_NULL;)598
2350 y(extern)f(const)h(off_id_t)g(OFF_PRTL_NULL;)598
2441 y(extern)f(const)h(off_id_t)g(OFF_DTLB_NULL;)598
2532 y(extern)f(const)h(off_eu_id_t)g(OFF_EU_ID_NULL;)515
2690 y Fk(h)p Fj(O\013)27 b(identi\014er)h(nul)t(l)f(values)h
(initializers.)f Fk(i)p Fq(\021)598 2781 y Fi(const)40
b(off_id_t)h(OFF_ID_NULL\(0,0\);)598 2873 y(const)f(off_id_t)h
(OFF_SHTL_NULL=OFF_ID_NULL;)598 2964 y(const)f(off_id_t)h
(OFF_PRTL_NULL=OFF_ID_NULL;)598 3055 y(const)f(off_id_t)h
(OFF_DTLB_NULL=OFF_ID_NULL;)598 3147 y(const)f(off_eu_id_t)i
(OFF_EU_ID_NULL=OFF_ID_NULL;)639 3288 y Fz(Finally)-7
b(,)28 b(an)f(op)r(erator)f(is)i(pro)n(vided)e(to)i(prin)n(t)f(system)g
(iden)n(ti\014ers.)515 3404 y Fk(h)p Fj(O\013)g(identi\014ers)i
Fi(operator<<)p Fj(.)g Fk(i)p Fq(\021)598 3495 y Fi(//)39
b(Dumps)i(an)e(ID.)598 3587 y(OStr)h(&operator<<\(OStr)j(&s,)d(const)g
(off_id_t)h(&i\);)515 3836 y Fk(h)p Fj(O\013)27 b(identi\014er)h(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3927 y Fi(#include)41
b(<klib/str.h>)434 b(//)40 b(for)g(OStr)639 4068 y Fz(There)27
b(implemen)n(tation)h(is)g(simple.)515 4184 y Fk(h)p
Fj(O\013)f(identi\014ers)i Fi(operator<<)g Fj(implementation.)f
Fk(i)p Fq(\021)598 4276 y Fi(//)39 b(Dumps)i(an)e(ID.)598
4367 y(OStr)h(&operator<<\(OStr)j(&s,)d(const)g(off_id_t)h(&i\))598
4458 y({)676 4550 y(s)f(<<)f(fmt\("\04508x",i.i_node\))44
b(<<)c("::")g(<<)g(fmt\("\04508x",i.i_offset\);)676 4641
y(return)h(s;)598 4732 y(})1905 5255 y Fz(51)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
52 53 bop 515 523 a FA(Iden)m(ti\014ers)31 b Fg(C)7 b
Fx(++)31 b FA(source)h(\014les)515 676 y Fz(Iden)n(ti\014er)27
b(co)r(de)h(can)f(b)r(e)h(found)g(in)g Fx(klib/ids.h)23
b Fz(and)k Fx(klib/ids.C)p Fz(.)515 809 y Fk(h)p Fj(ids.h*)11
b Fk(i)p Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y
Fi(#ifndef)41 b(__OFF_IDS_H)598 1083 y(#define)80 b(__OFF_IDS_H)42
b(1)598 1266 y Fk(h)p Fj(O\013)27 b(identi\014er)h(dep)l(endencies.)h
Fk(i)598 1448 y(h)p Fj(O\013)e(identi\014er)h(\014elds)g(data)h(typ)l
(es.)f Fk(i)598 1540 y(h)p Fj(O\013)f(identi\014ers.)h
Fk(i)598 1631 y(h)p Fj(O\013)f(identi\014er)h(synonyms.)h
Fk(i)598 1722 y(h)p Fj(O\013)e(identi\014er)h(\014eld)g(nul)t(l)f
(values.)h Fk(i)598 1814 y(h)p Fj(O\013)f(identifer)h(nul)t(l)f
(values.)g Fk(i)598 1905 y(h)p Fj(O\013)g(identi\014ers)i
Fi(operator<<)p Fj(.)g Fk(i)598 2088 y Fi(#endif)40 b(//)g(__OFF_IDS_H)
515 2262 y Fk(h)p Fj(ids.C*)11 b Fk(i)o Fq(\021)598 2353
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2536 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(Exported)h(interface.)598 2719 y Fk(h)p Fj(O\013)27
b(identi\014er)h(nul)t(l)f(values)h(initializers.)f Fk(i)598
2901 y(h)p Fj(O\013)g(identi\014ers)i Fi(operator<<)g
Fj(implementation.)f Fk(i)515 3076 y(h)p Fj(uids.C*)11
b Fk(i)o Fq(\021)598 3167 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3258 y Fi(#undef)40 b(__KERNEL__)598 3350 y(#include)h(<klib/ids.h>)434
b(//)40 b(Exported)h(interface.)598 3532 y Fk(h)p Fj(O\013)27
b(identi\014er)h(nul)t(l)f(values)h(initializers.)f Fk(i)1905
5255 y Fz(52)p eop
PStoPSsaved restore
%%Page: (54,55) 28
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
53 54 bop 515 3036 a @beginspecial 0 @llx 0 @lly 480
@urx 435 @ury 3437 @rwi @setspecial
%%BeginDocument: fig/compalloc.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-3.0 438.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 2175 2550 m 2025 2700 l 2325 2700 l 2175 2550 l gs col-1 s gr 
% Polyline
n 2175 2325 m 2175 2550 l gs col-1 s gr 
% Polyline
n 5775 2550 m 5625 2700 l 5925 2700 l 5775 2550 l gs col-1 s gr 
% Polyline
n 5775 2325 m 5775 2550 l gs col-1 s gr 
% Polyline
n 75 3350 m 1650 3350 l gs col-1 s gr 
% Polyline
n 75 3150 m 1650 3150 l 1650 3750 l 75 3750 l cp gs col-1 s gr 
% Polyline
n 1875 3750 m 2925 3750 l 2925 4350 l 1875 4350 l cp gs col-1 s gr 
% Polyline
n 1875 3950 m 2925 3950 l gs col-1 s gr 
% Polyline
n 2550 4425 m 4350 4425 l 4350 5100 l 2550 5100 l cp gs col-1 s gr 
% Polyline
n 2550 4650 m 4350 4650 l gs col-1 s gr 
% Polyline
n 3300 5100 m 3225 5250 l 3300 5400 l 3375 5250 l 3300 5100 l gs col-1 s gr 
% Polyline
n 3300 5400 m 3300 5625 l gs col-1 s gr 
% Polyline
n 1425 375 m 2850 375 l 2850 1125 l 1425 1125 l cp gs col-1 s gr 
% Polyline
n 1425 625 m 2850 625 l gs col-1 s gr 
% Polyline
n 4950 1500 m 6375 1500 l 6375 2325 l 4950 2325 l cp gs col-1 s gr 
% Polyline
n 4950 1775 m 6375 1775 l gs col-1 s gr 
% Polyline
n 5025 75 m 6225 75 l 6225 975 l 5025 975 l cp gs col-1 s gr 
% Polyline
n 5025 375 m 6225 375 l gs col-1 s gr 
% Polyline
n 5550 1200 m 5400 1350 l 5700 1350 l 5550 1200 l gs col-1 s gr 
% Polyline
n 5550 975 m 5550 1200 l gs col-1 s gr 
% Polyline
n 3825 3150 m 5475 3150 l 5475 3750 l 3825 3750 l cp gs col-1 s gr 
% Polyline
n 3825 3350 m 5475 3350 l gs col-1 s gr 
/Courier ff 180.00 scf sf
3900 3300 m
gs 1 -1 sc (FixedAllocator) col-1 sh gr
% Polyline
n 6375 3600 m 8025 3600 l 8025 4500 l 6375 4500 l cp gs col-1 s gr 
% Polyline
n 6375 3900 m 8025 3900 l gs col-1 s gr 
/Courier ff 165.00 scf sf
6450 4275 m
gs 1 -1 sc (grow\(\)) col-1 sh gr
/Courier ff 180.00 scf sf
6450 3825 m
gs 1 -1 sc (BlockAllocator) col-1 sh gr
% Polyline
n 150 6000 m 3825 6000 l 3825 7275 l 150 7275 l cp gs col-1 s gr 
% Polyline
n 2175 2700 m 825 2700 l 825 3150 l gs col-1 s gr 
% Polyline
n 2175 2700 m 3075 2700 l 3075 4425 l gs col-1 s gr 
% Polyline
n 2175 2700 m 2175 2700 l 2175 3750 l gs col-1 s gr 
% Polyline
gs  clippath
3753 5820 m 3873 5850 l 3753 5880 l 3915 5880 l 3915 5820 l  cp clip
n 3300 5475 m 3300 5850 l 3900 5850 l gs col-1 s gr gr

% arrowhead
n 3753 5820 m 3873 5850 l 3753 5880 l  col-1 s
% Polyline
 [66.7] 0 sd
gs  clippath
3678 3420 m 3798 3450 l 3678 3480 l 3840 3480 l 3840 3420 l  cp clip
n 1650 3450 m 3825 3450 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 3678 3420 m 3798 3450 l 3678 3480 l  col-1 s
% Polyline
 [66.7] 0 sd
gs  clippath
6645 4647 m 6675 4527 l 6705 4647 l 6705 4485 l 6645 4485 l  cp clip
n 6675 4500 m 6675 5175 l 7050 5175 l 7050 4500 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 6645 4647 m 6675 4527 l 6705 4647 l  col-1 s
% Polyline
 [66.7] 0 sd
n 2700 4725 m 1875 4725 l 1875 6000 l gs col-1 s gr  [] 0 sd
% Polyline
n 3900 5550 m 4875 5550 l 4875 6225 l 3900 6225 l cp gs col-1 s gr 
% Polyline
n 3900 5775 m 4875 5775 l gs col-1 s gr 
% Polyline
gs  clippath
4878 570 m 4998 600 l 4878 630 l 5040 630 l 5040 570 l  cp clip
n 2850 600 m 5025 600 l gs col-1 s gr gr

% arrowhead
n 4878 570 m 4998 600 l 4878 630 l  col-1 s
% Polyline
n 2175 1125 m 2175 2550 l gs col-1 s gr 
% Polyline
n 5925 2700 m 6750 2700 l 6750 3600 l gs col-1 s gr 
% Polyline
n 5850 2700 m 4200 2700 l 4200 3150 l gs col-1 s gr 
% Polyline
n 5550 1350 m 5550 1500 l gs col-1 s gr 
% Polyline
 [66.7] 0 sd
gs  clippath
6228 4020 m 6348 4050 l 6228 4080 l 6390 4080 l 6390 4020 l  cp clip
n 2925 4050 m 6375 4050 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 6228 4020 m 6348 4050 l 6228 4080 l  col-1 s
% Polyline
 [66.7] 0 sd
gs  clippath
6228 4470 m 6348 4500 l 6228 4530 l 6390 4530 l 6390 4470 l  cp clip
n 4350 4500 m 6375 4500 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 6228 4470 m 6348 4500 l 6228 4530 l  col-1 s
% Polyline
gs  clippath
5622 3705 m 5502 3675 l 5622 3645 l 5460 3645 l 5460 3705 l  cp clip
n 6375 3675 m 5475 3675 l gs col-1 s gr gr

% arrowhead
n 5622 3705 m 5502 3675 l 5622 3645 l  col-1 s
% Interp Spline
gs n 450 6000 m
	358.0 6023.1 320.5 6041.8 300 6075 curveto
	290.8 6089.8 290.8 6108.6 300 6150 curveto
 gs col-1 s gr
 gr

% Interp Spline
gs n 300 6150 m
	207.0 6174.0 170.0 6192.0 150 6225 curveto
	141.0 6239.0 141.0 6258.0 150 6300 curveto
 gs col-1 s gr
 gr

/Courier ff 165.00 scf sf
375 6390 m
gs 1 -1 sc (   found) col-1 sh gr
/Courier ff 165.00 scf sf
375 6720 m
gs 1 -1 sc (   notify\(\)) col-1 sh gr
/Courier ff 165.00 scf sf
375 6885 m
gs 1 -1 sc (else) col-1 sh gr
/Courier ff 165.00 scf sf
375 7050 m
gs 1 -1 sc (   missing\(\)) col-1 sh gr
/Courier ff 165.00 scf sf
375 6225 m
gs 1 -1 sc (if \( object in allocator \)) col-1 sh gr
/Courier ff 165.00 scf sf
375 6555 m
gs 1 -1 sc (else if \( reloctlb.lookup\(obj\)\)) col-1 sh gr
/Courier ff 165.00 scf sf
150 3300 m
gs 1 -1 sc (HWCompResource) col-1 sh gr
/Courier ff 165.00 scf sf
1950 3900 m
gs 1 -1 sc (Processor) col-1 sh gr
/Courier ff 165.00 scf sf
3975 5700 m
gs 1 -1 sc (RelocTbl) col-1 sh gr
/Courier ff 180.00 scf sf
5175 300 m
gs 1 -1 sc (Allocator) col-1 sh gr
/Courier ff 180.00 scf sf
5175 1725 m
gs 1 -1 sc (BKAllocator) col-1 sh gr
/Courier ff 165.00 scf sf
2700 4575 m
gs 1 -1 sc (AbsCompResource) col-1 sh gr
/Courier ff 165.00 scf sf
1455 600 m
gs 1 -1 sc (CompResource) col-1 sh gr
/Courier ff 165.00 scf sf
2700 4875 m
gs 1 -1 sc (make_available\(\)) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 1269 3218 a Fz(Figure)27 b(2.4:)36 b(Con)n(tainers)26
b(and)h(allo)r(cators)515 3567 y Fn(2.4.3)112 b(Con)m(tainers)37
b(and)i(resource)e(units)515 3720 y Fz(Resources)31 b(are)g(arranged)g
(as)g(recursiv)n(e)g(con)n(tainers,)i(b)r(eing)f(the)h
Fx(node)e Fz(the)i(outermost)515 3820 y(one)640 3789
y Fp(8)677 3820 y Fz(.)69 b(Resource)38 b(con)n(tainers)f(are)g(iden)n
(ti\014ed)i(with)h Fx(off)p 2399 3820 27 4 v 30 w(id)p
2517 3820 V 30 w(t)p Fz(.)70 b(Suc)n(h)38 b(iden)n(ti\014er)h(will)515
3919 y(usually)d(corresp)r(ond)f(with)i(the)g(iden)n(ti\014er)f(of)h
(the)g(p)r(ortal)f(used)h(b)n(y)f(the)h(con)n(tainer)e(to)515
4019 y(accept)27 b(user)g(requests.)639 4118 y(These)c(con)n(tainers)f
(delegate)h(allo)r(cation)f(to)h(an)g Fx(Allocator)d
Fz(ob)5 b(ject)23 b(whic)n(h)g(can)g(\(and)515 4218 y(will\))37
b(b)r(e)h(further)e(wrapp)r(ed)1436 4188 y Fp(9)1510
4218 y Fz(to)h(delegate)f(usage)g(statistics)h(to)g(a)f
Fx(bookkeeper)p Fz(.)61 b(See)515 4318 y(\014gure)27
b(2.4.)515 4451 y Fk(h)p Fj(O\013)g(c)l(omp)l(ound)i(r)l(esour)l(c)l
(e.)g Fk(i)p Fq(\021)598 4542 y Fi(//)39 b(Compound)i(resource.)h(Uses)
e(an)g(allocator)h(to)f(allocate)h(resource)g(units.)598
4633 y(class)f(off_CompResource)j(:)c(public)i(off_Resource)h({)598
4724 y(protected:)p 515 4794 1146 4 v 607 4848 a Fm(8)642
4871 y Fl(Ev)n(en)24 b(though)h(the)g Fh(node)f Fl(is)f(not)i(a)f
Fh(CompResource)j Fl(it)c(can)i(b)r(e)f(considered)g(to)g(b)r(e)g(a)g
(con)n(tainer.)607 4927 y Fm(9)642 4951 y Fl(cf.)31 b(the)24
b Ff(wr)l(app)l(er)33 b Fl(or)23 b Ff(de)l(c)l(or)l(ator)33
b Fl(design)24 b(pattern)h(\(see)g([11],)e(pp)h(175.\))1905
5255 y Fz(53)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
54 55 bop 676 523 a Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(memb)l
(ers)f(of)e Fi(off)p 1778 523 24 4 v 29 w(CompResource)p
Fj(.)i Fk(i)676 614 y(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h(metho)l(ds)f
(of)e Fi(off)p 1755 614 V 29 w(CompResource)p Fj(.)j
Fk(i)598 706 y Fi(public:)676 797 y(//)40 b(Dumps)g(it.)676
888 y(friend)h(OStr)f(&operator<<\(OStr)j(&s,)d(const)g
(off_CompResource)j(&r\);)598 1071 y(};)515 1337 y Fk(h)p
Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(dep)l(endencies.)f
Fk(i)p Fq(\021)598 1428 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(off_id_t)h(et)e(al.)598 1519 y(#include)i
(<klib/Resource.h>)239 b(//)40 b(for)g(off_Resource)598
1611 y(#include)h(<klib/Allocator.h>)200 b(//)40 b(for)g
(off_Allocator.)639 1752 y Fz(As)19 b(an)n(y)f(other)g(resource,)h
(resource)e(con)n(tainers)g(are)h(created)f(with)j(a)e(giv)n(en)g
(protection)515 1851 y(and)23 b(domain.)36 b(Ho)n(w)n(ev)n(er,)22
b(for)h(resource)f(con)n(tainers)h(a)g(p)r(ortal)g(iden)n(ti\014er)h
(\(corresp)r(onding)515 1951 y(to)e(a)g(v)-5 b(alid)22
b(p)r(ortal\))g(m)n(ust)g(b)r(e)h(pro)n(vided)e(to)r(o.)35
b(It)22 b(will)h(b)r(e)g(used)f(as)f(the)i(resource)d(con)n(tainer)515
2051 y(iden)n(ti\014er.)515 2183 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
2183 V 29 w(CompResource)p Fj(.)i Fk(i)p Fq(\021)598
2275 y Fi(//)39 b(Creates)i(a)f(CompResource.)598 2366
y(off_CompResource::off_CompReso)q(urce\()q(cons)q(t)45
b(off_Protection)d(&p,)1971 2457 y(const)e(off_prtl_id_t)i(&domain,)
1971 2549 y(const)e(off_prtl_id_t)i(&id,)1971 2640 y(const)e
(off_magic_t)i(magic)315 b(\))39 b(:)1304 2731 y
(off_Resource\(p,domain,id,magic)q(\))598 2823 y
({do_debug\(putchar\('c'\)\);})515 3088 y Fk(h)p Fj(O\013)27
b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(dep)l(endencies.)f
Fk(i)p Fz(+)o Fq(\021)598 3180 y Fi(#include)41 b(<klib/mdep/debug.h>)
161 b(//)40 b(for)g(do_debug)h(et)e(al.)1905 5255 y Fz(54)p
eop
PStoPSsaved restore
%%Page: (56,57) 29
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
55 56 bop 639 523 a Fz(Sp)r(eci\014c)22 b(resource)e(units)h(main)n
(tain)g(a)g(reference)g(to)g(their)g(con)n(tainer.)34
b(Concrete)20 b(sub-)515 623 y(classes)f(also)g(rede\014ne)g(the)i
Fx(new)e Fz(op)r(erator)f(so)h(that)i(it)f(could)g(b)r(e)h(used)f(to)g
(allo)r(cate)f(resource)515 722 y(units)28 b(from)f(a)g(con)n(tainer's)
f(p)r(o)r(ol.)37 b(This)28 b(w)n(a)n(y)e(w)n(e)h(can)g(a)n(v)n(oid)g
(memory)f(fragmen)n(tation.)515 855 y Fk(h)p Fj(O\013)h(elementary)i(r)
l(esour)l(c)l(e)h(unit.)d Fk(i)p Fq(\021)598 946 y Fi(//)39
b(Elementary)j(resource)f(unit.)598 1038 y(class)f(off_ResUnit)i(:)d
(public)i(off_Resource)h({)598 1129 y(private:)676 1220
y(off_CompResource)h(*r_container;)f(//)e(Container)h(for)f(this)g
(resource)h(unit.)598 1312 y(protected:)676 1403 y(void)f
(set_container\(off_CompResour)q(ce)45 b(*c\))40 b({)g(r_container=c;)i
(})676 1494 y(//Creates)f(a)f(resource)h(unit.)676 1586
y(off_ResUnit\(const)i(off_Protection)g(&p,)d(const)g(off_prtl_id_t)i
(&domain,)1147 1677 y(const)e(off_id_t)h(&id,)1147 1768
y(const)f(off_magic_t)i(magic,)1147 1860 y(off_CompResource)h
(*container)e(\):)755 1951 y(off_Resource\(p,domain,id,magic\))q(,)755
2042 y(r_container\(container\))676 2134 y({;})676 2316
y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 2316 24 4 v 29 w(ResUnit)p Fj(.)i Fk(i)598
2408 y Fi(public:)676 2499 y(off_CompResource)43 b
(*get_container\(void\))h(const)c({)g(return)g(r_container;)i(})676
2682 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2682 V 29 w(ResUnit)p Fj(.)i Fk(i)598 2773
y Fi(};)515 3039 y Fk(h)p Fj(O\013)e(elementary)i(r)l(esour)l(c)l(e)h
(unit)e(dep)l(endencies.)h Fk(i)p Fq(\021)598 3130 y
Fi(#include)41 b(<klib/Resource.h>)239 b(//)40 b(for)g(off_Resource)598
3221 y(#include)h(<klib/CompResource.h>)83 b(//)40 b(for)g
(off_CompResource)639 3362 y Fz(Resource)32 b(units)i(should)f(b)r(e)h
(pre-initialized)e(b)n(y)h(their)h(con)n(tainers)d(so)i(that)h(only)e
(a)515 3462 y(protection)37 b(and)h(domain)g(b)r(e)h(needed)f(at)h
(resource)d(allo)r(cation)h(time)i(\(the)g(iden)n(ti\014er,)515
3562 y(magic)h(n)n(um)n(b)r(er)h(and)g(con)n(tainer)e(reference)h(will)
i(alw)n(a)n(ys)d(remain)h(the)i(same)e(but)i(for)515
3661 y(cac)n(hed)27 b(resource)e(units\).)38 b(Be)27
b(they)h(pre-initialized,)f(this)h(constructor)e(shall)h(b)r(e)h(used.)
515 3794 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3794 V 29 w(ResUnit)p Fj(.)h Fk(i)p Fq(\021)598
3885 y Fi(//)39 b(Creates)i(a)f(pre-initialized)i(resource)f(unit.)598
3977 y(off_ResUnit\(const)i(off_Protection)f(&p,)79 b(const)41
b(off_prtl_id_t)h(&domain\))f(:)676 4068 y(off_Resource\(p,domain\))598
4159 y({;})1905 5255 y Fz(55)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
56 57 bop 639 523 a Fz(A)28 b(new)g Fx(Resource)c Fz(constructor)i(is)i
(needed.)515 639 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e
(of)e Fi(off)p 1594 639 24 4 v 29 w(Resource)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 731 y Fi(//)39 b(Creates)i(a)f
(pre-initialized)i(resource.)598 822 y(off_Resource\(const)h
(off_Protection)f(&p,)80 b(const)40 b(off_prtl_id_t)i(&domain\))f(:)676
913 y Fk(h)p Fj(O\013)27 b(aggr)l(e)l(gate)k(initialization)c(for)g(r)l
(efer)l(enc)l(e)i(c)l(ounting)g(obje)l(cts.)g Fk(i)p
Fi(,)676 1005 y(r_domain\(domain\),)676 1096 y Fk(h)p
Fj(Initialize)e(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 1096 V 29 w(Resource)p Fj(.)g Fk(i)598
1187 y Fi({)715 1279 y Fk(h)p Fj(O\013)g(initialization)e(for)i
Fi(p)g Fj(pr)l(ote)l(cte)l(d)i(obje)l(cts.)f Fk(i)598
1370 y Fi(})639 1494 y Fz(T)-7 b(o)19 b(pre-initialize)f(a)h(resource)e
(unit,)22 b(this)d(constructor)f(is)h(giv)n(en)f(so)g(that)i(the)f
(reference)515 1594 y(to)27 b(the)h(con)n(tainer,)f(domain)g(and)g
(magic)g(n)n(um)n(b)r(er)g(can)h(b)r(e)g(pre-set.)515
1727 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1727 V 29 w(ResUnit)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 1818 y Fi(//)39 b(Pre-initializes)k(a)d(resource)h(unit.)
598 1910 y(off_ResUnit\(const)82 b(off_id_t)41 b(&id,)1068
2001 y(const)g(off_magic_t)h(magic,)1068 2092 y(off_CompResource)h
(*container)f(\))d(:)676 2183 y(off_Resource\(id,magic\),)676
2275 y(r_container\(container\))598 2366 y({;})639 2599
y Fz(A)28 b(new)g(constructor)e(is)h(no)n(w)g(needed)h(for)f
Fx(Resource)p Fz(s.)515 2715 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 2715 V 29 w(Resource)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 2806 y Fi(//)39 b(Pre-initializes)k(a)
d(resource)598 2897 y(off_Resource\(const)j(off_id_t)e(&id,)f(const)h
(off_magic_t)g(magic\))g(:)676 2989 y Fk(h)p Fj(O\013)27
b(initialization)g(for)h(inte)l(grity)h(che)l(cke)l(d)g(r)l(esour)l(c)l
(es)h(with)e Fi(magic)p Fj(.)g Fk(i)p Fi(,)676 3080 y(r_id\(id\))598
3171 y({;})639 3296 y Fz(When)33 b(resource)d(units)i(are)f(destro)n(y)
n(ed,)h(their)g(domain)g(is)f(reset)h(to)g(a)f(n)n(ull)h(domain)515
3396 y(and)27 b(protection)g(is)h(reset.)515 3528 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3528
V 29 w(ResUnit)p Fj(.)h Fk(i)p Fq(\021)598 3620 y Fi(//)39
b(Destroyes)j(the)e(resource.)598 3711 y(virtual)h
(~off_ResUnit\(void\);)515 3885 y Fk(h)p Fi(off)p 667
3885 V 29 w(ResUnit::~off)p 1203 3885 V 31 w(ResUnit)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 3977 y Fi(//)39
b(Destroyes)j(the)e(resource.)598 4068 y
(off_ResUnit::~off_ResUnit\(void)q(\))598 4159 y({)676
4251 y(set_domain\(OFF_PRTL_NULL\);)676 4342 y
(protect\(off_Protection\(\)\);)598 4433 y(})1905 5255
y Fz(56)p eop
PStoPSsaved restore
%%Page: (58,59) 30
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
57 58 bop 639 523 a Fz(The)30 b Fx(make)p 993 523 27
4 v 29 w(available)c Fz(metho)r(d)j(is)h(pro)n(vided)e(b)n(y)h(con)n
(tainers)e(to)i(allo)n(w)f(remote)h(re-)515 623 y(source)17
b(units)i(to)f(b)r(e)h(a)n(v)-5 b(ailable)17 b(\(b)n(y)h(cac)n(hing)f
(them\))j(in)e(the)h(lo)r(cal)f(no)r(de.)34 b(All)19
b Fx(make)p 3095 623 V 29 w(available)515 722 y Fz(do)r(es)27
b(is)h(to)f(implemen)n(t)i(the)f(algorithm)e(sho)n(wn)h(in)h(section)g
(2.4.4.)36 b(It)28 b(uses)f Fx(is)p 3034 722 V 30 w(local)f
Fz(to)515 822 y(determine)h(if)i(the)e(sp)r(eci\014ed)h(resource)e
(unit)i(is)g(lo)r(cal)f(or)g(not.)515 952 y Fk(h)p Fj(Implementation)h
(of)f Fi(off)p 1308 952 24 4 v 29 w(CompResource::make)p
2039 952 V 32 w(available)p Fj(.)i Fk(i)p Fq(\021)598
1043 y Fi(//)39 b(We)h(may)g(wish)g(to)g(cache)g(a)g(resource)h(unit.)
598 1134 y(//)e(Returns)i(error)g(code)f(if)f(the)h(resource)h(is)f
(not)g(available.)h(Zero)g(otherwise.)598 1226 y(err_t)f
(make_available\(off_id_t)45 b(&u)39 b(\))598 1317 y({)676
1408 y Fk(h)p Fj(Bo)l(dy)28 b(of)f Fi(off)p 1111 1408
V 29 w(CompResource::make)p 1842 1408 V 33 w(available)p
Fj(.)i Fk(i)598 1500 y Fi(})515 1759 y Fk(h)p Fj(Bo)l(dy)f(of)f
Fi(off)p 950 1759 V 29 w(CompResource::make)p 1681 1759
V 32 w(available)p Fj(.)i Fk(i)p Fq(\021)598 1851 y Fi(if)39
b(\()h(is_local\(u\))1022 b(||)118 b(//)40 b(It)g(is)f(local)794
1942 y(c_reloc.is_relocated\(u\))44 b(&&)c(is_local\(u\)\))120
b(//)40 b(It)g(is)f(cached)676 2033 y(return)i(EOK;)598
2125 y(else)676 2216 y(return)g(c_reloc.missing\(OFF_PRTL_NULL,)q(get_)
q(umagi)q(c\(\),)q(u\);)k(//)40 b(XXX)g(use)g(ex.)g(prtl.)794
2307 y(//)g(Usr.)g(could)g(fetch)g(the)g(unit.)639 2446
y Fz(Where)26 b Fx(get)p 1040 2446 27 4 v 30 w(umagic)e
Fz(is)i(a)f(new)h(virtual)f(metho)r(d)i(to)f(b)r(e)g(pro)n(vided)f(b)n
(y)h(resource)e(con-)515 2545 y(tainers.)36 b(It)28 b(returns)f(the)h
(magic)e(for)i(con)n(tained)e(resource)g(units.)515 2660
y Fk(h)p Fj(Other)i(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2660 24 4 v 29 w(CompResource)p Fj(.)i
Fk(i)p Fz(+)p Fq(\021)598 2751 y Fi(virtual)41 b(off_magic_t)g
(get_umagic\(void\)=0;)515 2905 y Fk(h)p Fj(O\013)27
b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(dep)l(endencies.)f
Fk(i)p Fz(+)o Fq(\021)598 2996 y Fi(#include)41 b(<klib/Magic.h>)356
b(//)40 b(for)g(off_Magic)598 3087 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)639 3225
y Fz(T)-7 b(o)31 b(do)f(so,)h(the)h(con)n(tainer)d(needs)i(a)f(relo)r
(cation)g(table.)47 b(Suc)n(h)31 b(table)f(main)n(tains)h(the)515
3325 y(corresp)r(ondence)i(b)r(et)n(w)n(een)i(the)g(remote)f(resource)f
(unit)j(and)f(the)g(lo)r(cal)f(resource)f(unit)515 3425
y(used)d(as)g(a)h(cac)n(he)e(\(remem)n(b)r(er)i(that)g(the)g(k)n(ernel)
e(do)r(es)i(not)f(implemen)n(t)i(an)n(y)d(particular)515
3524 y(coherence)i(or)h(concurrency)f(con)n(trol)h(proto)r(col\).)51
b(There)32 b(is)h(a)f(single)h(relo)r(cation)e(table)515
3624 y(p)r(er)c(no)r(de)h(whic)n(h)f(is)h(shared)f(among)f(ev)n(ery)g
(con)n(tainer.)515 3754 y Fk(h)p Fj(Other)i(pr)l(ote)l(cte)l(d)j(memb)l
(ers)d(of)f Fi(off)p 1616 3754 V 29 w(CompResource)p
Fj(.)j Fk(i)p Fq(\021)598 3845 y Fi(static)40 b(off_RelocTbl)i
(c_reloc;)81 b(//)39 b(relocation)j(table.)515 4014 y
Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(dep)l
(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 4105 y Fi(#include)41
b(<klib/RelocTbl.h>)161 b(//)39 b(for)h(off_RelocTbl)639
4243 y Fz(The)28 b(relo)r(cation)f(table)h(uses)f(the)h(k)n(ernel)f
(virtual)h(memory)f(manager,)f Fx(KVM)p Fz(,)h(and)h(the)515
4343 y(core)20 b(memory)g(bank,)i Fx(MBank)p Fz(,)f(to)g(allo)r(cate)f
(page)h(frames.)34 b(They)21 b(will)g(b)r(e)h(describ)r(ed)f(later.)515
4473 y Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h
(static)e(memb)l(ers.)g Fk(i)p Fq(\021)598 4655 y Fi(off_RelocTbl)42
b(off_CompResource::c_reloc;)515 4824 y Fk(h)p Fj(O\013)27
b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(implementation)e(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4915 y Fi(#include)41
b(<hw/MBank.h>)434 b(//)40 b(for)g(off_MBank)598 5006
y(#include)h(<dmm/KVM.h>)473 b(//)40 b(for)g(off_KVM)1905
5255 y Fz(57)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
58 59 bop 639 523 a Fz(No)n(w)39 b(that)h(w)n(e)f(ha)n(v)n(e)g(sho)n
(wn)g(ho)n(w)g Fx(make)p 2000 523 27 4 v 29 w(available)d
Fz(is)k(implemen)n(ted,)j(w)n(e)c(ha)n(v)n(e)515 623
y(to)h(sa)n(y)f(that)i(it)g(is)f Fy(not)48 b Fz(implemen)n(ted)41
b(b)n(y)f Fx(CompResource)p Fz(.)70 b(It)41 b(is)f(implemen)n(ted)h(b)n
(y)515 722 y(sub)r(classes)31 b(of)i Fx(CompResource)28
b Fz(instead.)51 b(The)33 b(rationale)e(is)h(that)h(mak)n(e)f(a)n(v)-5
b(ailable)31 b(de-)515 822 y(p)r(ends)37 b(on)g Fx(is)p
980 822 V 31 w(local)p Fz(,)g(whic)n(h)h(m)n(ust)f(b)r(e)g(implemen)n
(ted)h(b)n(y)f(the)h(allo)r(cator)d(con)n(taining)515
922 y(the)i(resource)f(units.)66 b(T)-7 b(aking)36 b(in)n(to)h(accoun)n
(t)g(that)g(there)g(will)h(b)r(e)f(few)h(sub)r(classes)e(of)515
1021 y Fx(CompResource)p Fz(,)21 b(w)n(e)j(can)h(a)n(v)n(oid)f(dynamic)
g(dispatc)n(hing)h(plus)g(extra)f(indirections)h(to)g(ac-)515
1121 y(cess)f(the)i(allo)r(cator)d(b)n(y)i(mo)n(ving)f(b)r(oth)h(the)g
(allo)r(cator)f(and)g Fx(is)p 2488 1121 V 31 w(local)f
Fz(to)i Fx(CompResource)515 1220 y Fz(sub)r(classes.)639
1320 y(Some)j(debug)f(aids)g(are)g(pro)n(vided.)515 1436
y Fk(h)p Fi(off)p 667 1436 24 4 v 29 w(CompResource::operator<<)32
b Fj(implementation.)c Fk(i)p Fq(\021)598 1528 y Fi(//)39
b(Dumps)i(the)f(resource.)598 1619 y(OStr)g(&operator<<\(OStr)j(&s,)d
(const)g(off_CompResource)j(&r\))598 1710 y({)676 1802
y(s)d(<<)f(*\(off_Resource*\)&r;)676 1893 y(return)i(s;)598
1984 y(})639 2200 y Fz(Names)32 b(and)g(URLs)g(for)g(resource)e(units)i
(are)f(obtained)h(using)g(those)g(of)g(their)g(con-)515
2300 y(tainers.)515 2433 y Fk(h)p Fj(Other)c(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2433 V 29 w(ResUnit)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 2524 y Fi(//)39 b(Get)h(the)g(resource)h(unit)f(URL.)598
2615 y(const)g(char)g(*get_url\(void\);)598 2707 y(//)f(Returns)i(the)f
(resource)h(unit)f(name.)598 2798 y(//)f(The)h(caller)h(should)g
(delete)f(the)g(given)g(name)h(after)f(use.)598 2889
y(const)g(char)g(*nameof\(void\);)639 3122 y Fz(The)33
b(name)g(of)g(a)g(resource)e(unit)j(is)f(that)h(of)f(its)g(con)n
(tainer)f(complemen)n(ted)h(with)g(a)515 3221 y(prin)n(table)27
b(represen)n(tation)f(of)h(its)h(address.)36 b(The)27
b(URL)h(is)g(built)g(in)g(a)f(similar)g(w)n(a)n(y)-7
b(.)639 3321 y(Names)25 b(for)f(resource)e(units)j(are)f(created)g(on)g
(demand.)36 b(The)25 b(caller)e(of)i Fx(nameof)d Fz(m)n(ust)515
3421 y(delete)28 b(the)g(name)f(after)g(using)g(it.)515
3553 y Fk(h)p Fi(off)p 667 3553 V 29 w(ResUnit::nameof)j
Fj(implementation.)e Fk(i)p Fq(\021)598 3645 y Fi(//)39
b(Returns)i(the)f(resource)h(name.)598 3736 y(const)f(char)g
(*off_ResUnit::nameof\(void\))598 3827 y({)676 3919 y(extern)h(void)f
(*operator)h(new\(size_t)h(s\);)676 4010 y(char)e(*name;)676
4193 y(name)g(=)g(new)g(char[strlen\(get_container\(\)->n)q(ameof)q
(\(\)\)+)q(10];)2598 4284 y(//)g('/'+)g(8)g(hex)g(digits)g(+)g(0)676
4375 y(if)g(\(name\))755 4467 y(sprintf\(name,"\045s/\04508x",get_cont)
q(aine)q(r\(\)-)q(>name)q(of\(\))q(,\(nat)q(ural)q(_t\)g)q(et_id)q
(\(\)\);)676 4558 y(return)h(name;)598 4649 y(})1905
5255 y Fz(58)p eop
PStoPSsaved restore
%%Page: (60,61) 31
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
59 60 bop 639 523 a Fz(Since)33 b(ev)n(ery)e(concrete)h(resource)f
(unit)i(instance)f(shares)f(the)i(URL)g(with)g(other)f(in-)515
623 y(stances)h(of)h(the)h(same)e(resource,)h(the)g(URL)h(is)f(syn)n
(thesized)f(on)h(demand)g(and)g(is)g(k)n(ept)515 722
y(in)29 b(a)g(static)g(mem)n(b)r(er)h(of)f(ev)n(ery)f(concrete)g
(Resource)g(unit.)43 b(A)30 b(reference)e(to)h(suc)n(h)g(static)515
822 y(mem)n(b)r(er)c(is)f(obtained)h(through)f(this)h(priv)-5
b(ate)25 b(metho)r(d.)36 b(Besides,)25 b(the)h(relativ)n(e)d(URL)j(for)
515 922 y(the)i(con)n(tainer)e(m)n(ust)i(b)r(e)g(kno)n(wn;)f(it)h(is)f
(supplied)h(b)n(y)f(another)g(protected)g(metho)r(d.)515
1054 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1054 24 4 v 29 w(ResUnit)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 1146 y Fi(virtual)41 b(char)f
(*&get_url_holder\(void\)=0;)598 1237 y(virtual)h(const)f(char)g
(*get_rurl\(void\))j(const)d(=0;)515 1411 y Fk(h)p Fi(off)p
667 1411 V 29 w(ResUnit::get)p 1164 1411 V 30 w(url)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 1503 y Fi(//)39
b(Get)h(the)g(resource)h(unit)f(URL.)598 1594 y(const)g(char)g
(*off_ResUnit::get_url\(void\))598 1685 y({)676 1868
y(if)g(\(!get_url_holder\(\)\){)755 1959 y(get_url_holder\(\))j(=)c
(new)833 2051 y(char[strlen\(get_container\(\)->)q(get_)q(url\()q
(\)\)+st)q(rlen)q(\(get_)q(rurl)q(\(\)\)])q(;)755 2142
y(if)g(\(get_url_holder\(\)\))833 2233 y
(sprintf\(get_url_holder\(\),"\045s\045)q(s",g)q(et_c)q(ontai)q(ner\()q
(\)->ge)q(t_ur)q(l\(\),)q(get_r)q(url\()q(\)\);)676 2325
y(})676 2416 y(return)i(get_url_holder\(\);)598 2507
y(})515 2856 y FA(Comp)s(ound)29 b(resources)j(and)g(resource)g(units)f
(for)h(plain)g(users)515 3001 y Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i
(r)l(esour)l(c)l(e)h(for)d(users.)i Fk(i)o Fq(\021)598
3092 y Fi(//)39 b(Compoud)i(resource)g(for)f(users.)598
3183 y(//)598 3275 y(class)g(off_uCompResource)j(:)d(public)g
(off_uResource)i({)598 3366 y(public:)598 3457 y(#ifdef)e(__KERNEL__)
676 3549 y(off_uCompResource\(off_CompRe)q(sourc)q(e)45
b(*r\):)40 b(off_uResource\(r\))j({;})598 3640 y(#endif)676
3731 y(off_uCompResource\(void\))i({;})676 3823 y
(off_uCompResource\(const)g(off_id_t)c(&id\):)f(off_uResource\(id\))j
({;})676 3914 y(off_prtl_id_t)f(get_prtl\(void\))h({)755
4005 y(return)d(off_id_t\(w_p.get_nd\(\),0,w_p.)q(get_)q(srv\(\))q(\);)
676 4097 y(})598 4279 y(};)1905 5255 y Fz(59)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
60 61 bop 515 523 a Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l
(c)l(e)h(for)d(users)i(in-kernel.)f Fk(i)p Fq(\021)598
614 y Fi(class)40 b(off_kCompResource)j(:)d(public)g(off_kResource)i({)
598 706 y(public:)676 797 y(err_t)f(handle\(const)h(off_shtl_id_t)g
(&sender,)1029 888 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1029
980 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e({)755
1071 y(return)g(off_kResource::handle\(sender)q(,msz)q(,rsz,)q(m,r\))q
(;)676 1162 y(})598 1345 y(};)639 1486 y Fz(W)-7 b(e)26
b(do)g(not)f(exp)r(ort)g(to)h(users)e(an)n(ything)h(b)r(esides)h(that)g
(exp)r(orted)f(b)n(y)g(a)g Fx(Resource)e Fz(in)515 1586
y Fx(ResUnit)i Fz(system)i(ob)5 b(jects.)515 1719 y Fk(h)p
Fj(O\013)27 b(elementary)i(r)l(esour)l(c)l(e)h(unit)e(for)f(users.)i
Fk(i)p Fq(\021)598 1810 y Fi(//)39 b(Elementary)j(resource)f(unit)f
(for)g(users.)598 1901 y(//)598 1993 y(class)g(off_uResUnit)i(:)e
(public)g(off_uResource)i({)598 2084 y(public:)598 2175
y(#ifdef)e(__KERNEL__)676 2267 y(off_uResUnit\(off_ResUnit)45
b(*r\):)40 b(off_uResource\(r\))j({;})598 2358 y(#endif)676
2449 y(off_uResUnit\(void\))h({;})676 2540 y(off_uResUnit\(const)g
(off_id_t)d(&id\):)f(off_uResource\(id\))j({;})676 2723
y(off_uCompResource)g(get_container\(void\))83 b({)755
2814 y(return)40 b(off_id_t\(w_p.i_node,0\);)676 2906
y(})676 2997 y(operator)h(vm_offset_t\(void\))i(const)e({)e(return)i
(w_p.i_offset;)h(})598 3180 y(};)515 3445 y Fk(h)p Fj(O\013)27
b(r)l(esour)l(c)l(e)j(unit)e(r)l(esour)l(c)l(e)i(for)d(users)i
(in-kernel.)f Fk(i)p Fq(\021)598 3537 y Fi(class)40 b(off_kResUnit)i(:)
e(public)g(off_kResource)i({)598 3628 y(public:)676 3719
y(off_kResUnit\(off_Resource)j(*r=NULL\))c(:)f(off_kResource\(r\))i
({;})676 3811 y(err_t)f(handle\(const)h(off_shtl_id_t)g(&sender,)1029
3902 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1029 3993
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e({)755 4085
y(return)g(off_kResource::handle\(sender)q(,msz)q(,rsz,)q(m,r\))q(;)676
4176 y(})598 4359 y(};)1905 5255 y Fz(60)p eop
PStoPSsaved restore
%%Page: (62,63) 32
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
61 62 bop 515 523 a FA(Comp)s(ound)29 b(resources)j(and)g(resource)g
(units)f Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
676 y Fz(Comp)r(ound)18 b(resource)f(source)g(co)r(de)h(is)g(k)n(ept)h
(in)f Fx(CompResource.h)13 b Fz(and)18 b Fx(CompResource.C)p
Fz(.)515 809 y Fk(h)p Fj(CompR)l(esour)l(c)l(e.h*)11
b Fk(i)r Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y
Fi(#ifndef)41 b(__OFF_COMP_RESOURCE_H)598 1083 y(#define)g
(__OFF_COMP_RESOURCE_H)j(1)598 1266 y Fk(h)p Fj(O\013)27
b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(dep)l(endencies.)f
Fk(i)598 1448 y Fi(#ifdef)40 b(__KERNEL__)598 1540 y
Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e.)g
Fk(i)598 1631 y Fi(#endif)598 1722 y Fk(h)p Fj(O\013)e(c)l(omp)l(ound)i
(r)l(esour)l(c)l(e)h(for)d(users.)i Fk(i)598 1996 y Fi(#endif)40
b(//)g(__OFF_COMP_RESOURCE_H)515 2171 y Fk(h)p Fj(CompR)l(esour)l(c)l
(e.C*)11 b Fk(i)q Fq(\021)598 2262 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2445 y Fi(#include)41 b(<klib/CompResource.h>)83
b(//)40 b(Exported)h(interface)598 2536 y Fk(h)p Fj(O\013)27
b(c)l(omp)l(ound)i(r)l(esour)l(c)l(e)h(implementation)e(dep)l
(endencies.)h Fk(i)598 2719 y(h)p Fj(O\013)e(c)l(omp)l(ound)i(r)l
(esour)l(c)l(e)h(static)e(memb)l(ers.)g Fk(i)598 2901
y(h)p Fi(off)p 750 2901 24 4 v 29 w(CompResource::operator<<)k
Fj(implementation.)c Fk(i)639 3134 y Fz(Resource)f(unit)h(co)r(de)f(is)
h(k)n(ept)f(in)h Fx(ResUnit.h)c Fz(and)k Fx(ResUnit.C)p
Fz(.)515 3267 y Fk(h)p Fj(R)l(esUnit.h*)11 b Fk(i)p Fq(\021)598
3358 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3449 y Fi(#ifndef)41
b(__OFF_RES_UNIT_H)598 3541 y(#define)g(__OFF_RES_UNIT_H)h(1)598
3723 y Fk(h)p Fj(O\013)27 b(elementary)i(r)l(esour)l(c)l(e)h(unit)e
(dep)l(endencies.)h Fk(i)598 3906 y Fi(#ifdef)40 b(__KERNEL__)598
3997 y Fk(h)p Fj(O\013)27 b(elementary)i(r)l(esour)l(c)l(e)h(unit.)d
Fk(i)598 4088 y Fi(#endif)598 4180 y Fk(h)p Fj(O\013)g(elementary)i(r)l
(esour)l(c)l(e)h(unit)e(for)f(users.)i Fk(i)598 4362
y Fi(#endif)40 b(//)g(__OFF_RES_UNIT_H)1905 5255 y Fz(61)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
62 63 bop 515 523 a Fk(h)p Fj(R)l(esUnit.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<klib/ResUnit.h>)278 b(//)40 b(Exported)h(interface)598
980 y Fk(h)p Fi(off)p 750 980 24 4 v 29 w(ResUnit::~off)p
1286 980 V 31 w(ResUnit)29 b Fj(implementation.)e Fk(i)598
1071 y(h)p Fi(off)p 750 1071 V 29 w(ResUnit::nameof)j
Fj(implementation.)e Fk(i)598 1162 y(h)p Fi(off)p 750
1162 V 29 w(ResUnit::get)p 1247 1162 V 31 w(url)g Fj(implementation.)f
Fk(i)1905 5255 y Fz(62)p eop
PStoPSsaved restore
%%Page: (64,65) 33
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
63 64 bop 515 523 a Fn(2.4.4)112 b(Resource)38 b(a)m(v)-6
b(ailabilit)m(y)515 676 y Fz(When)24 b(users)e(issue)h(a)g(system)g
(call,)h(it)g(is)f(targeted)f(to)i(a)f(particular)f(system)h(ob)5
b(ject.)35 b(The)515 776 y(system)g(call)g(is)g(pro)r(cessed)g(in)h
(the)f(lo)r(cal)g(no)r(de)h(only)f(when)h(that)f(ob)5
b(ject)36 b(is)f(lo)r(cal.)60 b(In)515 876 y(an)n(y)32
b(other)h(case)f(w)n(e)h(forw)n(ard)f(the)i(system)f(call)f(to)i(a)e
(remote)h(no)r(de)g(b)n(y)g(raising)f(a)h Fx(FWD)515
975 y Fz(exception)27 b(to)h(the)f(user.)639 1075 y(Assuming)d(the)g
(target)f(system)g(ob)5 b(ject)24 b(is)f(lo)r(cal,)h(so)f(that)h(the)g
(system)g(call)f(pro)r(ceeds,)515 1174 y(it)30 b(is)f(not)h(guaran)n
(teed)e(that)i(ev)n(ery)e(resource)g(needed)i(b)n(y)f(that)h(system)f
(call)h(b)r(e)g(presen)n(t)515 1274 y(in)e(the)g(lo)r(cal)f(no)r(de.)
639 1374 y(T)-7 b(o)28 b(deal)f(with)h(remote)f(resources,)f(ev)n(ery)g
(resource)g(con)n(tainer)g(\()p Fx(CompResource)p Fz(s)3281
1344 y Fp(10)3347 1374 y Fz(\))515 1473 y(implemen)n(ts)f(a)g
Fx(make)p 1201 1473 27 4 v 29 w(available)d Fz(metho)r(d)j(so)g(that)g
(whenev)n(er)f(a)g(resource)g(is)h(needed)g(it)515 1573
y(could)i(b)r(e)h(fetc)n(hed)g(to)g(the)g(lo)r(cal)f(no)r(de)g(\(if)i
(that)e(is)h(really)f(required\).)639 1673 y(Besides,)43
b(when)d(the)h(con)n(tainer)d(b)r(eing)i(considered)g(is)f(an)h
Fx(AbsCompResource)34 b Fz(\(a)515 1772 y(con)n(tainer)g(of)i(abstract)
f(resources\),)h(w)n(e)g(ha)n(v)n(e)e(to)i(tak)n(e)f(in)n(to)h(accoun)n
(t)f(that)h(resources)515 1872 y(con)n(tained)28 b(inside)h(it)g
(\(abstract)f(resources\))f(are)h(able)g(to)h(mo)n(v)n(e)e(around.)40
b(Th)n(us,)29 b(in)g(this)515 1971 y(case)d(w)n(e)i(will)g(emplo)n(y)e
(a)i(relo)r(cation)e(table)i(to)f(cac)n(he)g(kno)n(wn)g(ob)5
b(ject)27 b(lo)r(cations.)639 2071 y(In)h(ev)n(ery)e
Fx(CompResource)p Fz(,)d Fx(make)p 1717 2071 V 30 w(available)h
Fz(pro)r(ceeds)j(as)f(follo)n(ws:)616 2237 y(1.)41 b(Using)23
b(the)h(resource)e(iden)n(ti\014er,)i(it)g(tries)f(to)g(lo)r(cate)g
(the)h(resource)d(in)j(the)g(allo)r(cator)722 2337 y(used)29
b(b)n(y)f(the)h Fx(AbsCompResource)23 b Fz(\(using)28
b(the)i Fx(slot)d Fz(\014eld)i(of)f(the)h(resource)e(iden-)722
2436 y(ti\014er\).)54 b(If)33 b(the)g(resource)f(is)h(found)g(there,)h
(then)g(there)e(is)h(nothing)g(more)f(to)h(do.)722 2536
y(When)28 b(talking)f(ab)r(out)h Fx(HWCompResource)p
Fz(s)o(,)22 b(w)n(e)27 b(use)g(the)h Fx(off)p 2719 2536
V 30 w(id)p 2837 2536 V 31 w(t)f Fz(con)n(tained)g(in)722
2636 y(the)h Fx(off)p 1002 2636 V 30 w(eu)p 1120 2636
V 31 w(id)p 1239 2636 V 31 w(t)f Fz(instead)g(\(i.e.)37
b(an)28 b Fx(off)p 2050 2636 V 30 w(id)p 2168 2636 V
30 w(t)g Fz(with)g(the)g Fx(offset)d Fz(\014eld)j(zero)r(ed\).)616
2802 y(2.)41 b(If)32 b(the)g(resource)e(w)n(as)g(not)i(presen)n(t)f(in)
g(the)h(allo)r(cator,)f(the)h(relo)r(cation)e(table)i(has)722
2901 y(to)26 b(b)r(e)h(consulted)f(to)g(\014nd)g(out)g(if)h(w)n(e)f
(kno)n(w)f(of)h(an)n(y)f(ob)5 b(ject)26 b(relo)r(cation.)35
b(If)27 b(w)n(e)f(\014nd)722 3001 y(an)i(en)n(try)-7
b(,)27 b(w)n(e)g(no)n(w)g(kno)n(w)g(where)g(the)h(ob)5
b(ject)27 b(is)h(and)f(w)n(e)g(are)g(done.)616 3167 y(3.)41
b(If)26 b(w)n(e)e(don't)h(kno)n(w)f(where)h(the)g(ob)5
b(ject)25 b(is)g(at)f(this)i(p)r(oin)n(t,)f(w)n(e)g(assume)f(it)i(is)e
(lo)r(cated)722 3267 y(in)d(its)f(creation)g(no)r(de)g(\(kno)n(wn)g(b)n
(y)g(lo)r(oking)f(in)i(the)g(resource)d(iden)n(ti\014er\).)35
b(Th)n(us,)21 b(w)n(e)722 3366 y(susp)r(ect)31 b(where)f(the)h(ob)5
b(ject)30 b(is)g(and)h(raise)e(a)h Fx(MISSING)d Fz(exception)k(pro)n
(viding)e(the)722 3466 y(exp)r(ected)j(lo)r(cation)e(to)h(the)g(user)g
(so)f(that)i(he)f(could)g(fetc)n(h)g(the)g(remote)g(resource)722
3565 y(and)d(bring)f(it)h(to)f(the)h(lo)r(cal)f(con)n(tainer.)757
3731 y(\(a\))42 b(If)36 b(the)h(ob)5 b(ject)36 b(w)n(as)f(indeed)h(at)g
(its)h(exp)r(ected)f(lo)r(cation)g(\(it)h(did)f(not)g(mo)n(v)n(e)905
3831 y(around\))d(the)i(system)f(call)g(is)g(able)f(to)h(pro)r(ceed)g
(as)f(so)r(on)h(as)f(the)i Fx(MISSING)905 3931 y Fz(exception)j
(handler)f(completes)h(successfully)-7 b(.)68 b(Should)38
b(the)g(handler)g(fail,)905 4030 y(the)29 b(system)f(call)g(is)h(ab)r
(orted)f(and)g(an)g Fx(ILL)g Fz(\(illegal)g(instruction\))g(exception)
905 4130 y(is)f(raised)g(to)g(the)h(Sh)n(uttle)h(domain.)753
4263 y(\(b\))42 b(If)24 b(the)f(ob)5 b(ject)23 b(w)n(as)f(not)h(at)g
(its)h(exp)r(ected)f(lo)r(cation)g(w)n(e)f(will)i(notice)f(it)g(as)g
(so)r(on)905 4362 y(as)34 b(the)i(user)e(is)h(noti\014ed)g(b)n(y)g(the)
g(remote)g(resource)e(con)n(tainer)h(\(where)g(w)n(e)905
4462 y(exp)r(ected)25 b(to)g(\014nd)g(the)g(resource\).)35
b(In)25 b(this)g(case,)g(a)f(lo)r(cation)g(algorithm)g(will)905
4562 y(b)r(e)29 b(run)f(b)n(y)g(the)h(user.)38 b(The)29
b(resulting)e(lo)r(cation)h(should)g(b)r(e)h(inserted)f(in)h(the)905
4661 y(con)n(tainer)d(relo)r(cation)h(table,)g(if)h(an)n(y)-7
b(.)p 515 4731 1146 4 v 577 4784 a Fm(10)642 4808 y Fl(Indeed,)30
b Fh(make)p 1040 4808 22 4 v 26 w(available)g Fl(is)d(implemen)n(ted)g
(in)g(sub)r(classes)h(of)f Fh(CompResource)k Fl(b)r(ecause)f(resource)
515 4887 y(units)24 b(ha)n(v)n(e)g(iden)n(ti\014ers)g(of)g(di\013eren)n
(t)g(kinds.)1905 5255 y Fz(63)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
64 65 bop 639 523 a Fz(W)-7 b(e)22 b(should)e(note)h(that)h(resource)d
(\\relo)r(cation")g(coun)n(ts)h(mostly)h(for)f(p)r(ortals,)i(sh)n
(uttles)515 623 y(and)g Ft(dtlb)p Fz(s.)35 b(Elemen)n(tary)22
b(resource)f(units)i(are)f(not)h(able)f(to)h(mo)n(v)n(e)f(around,)h(so)
f(they)h(will)515 722 y(alw)n(a)n(ys)i(b)r(e)j(at)g(their)f(creation)g
(no)r(des.)639 822 y(Besides,)20 b(b)r(ecause)f(the)h(system)e(can)h(b)
r(e)h(heterogeneous,)f(a)f(remote)h(resource)e(brough)n(t)515
922 y(to)28 b(the)i(lo)r(cal)e(no)r(de)h(ma)n(y)f(b)r(e)h(meaningless)f
(to)g(us)h(or)f(require)g(some)g(sort)g(of)h(marshaling)515
1021 y(\(eg.)74 b(when)41 b(it)f(corresp)r(onds)f(to)h(a)g(di\013eren)n
(t)g(arc)n(hitecture\).)74 b(In)40 b(this)h(case,)h(an)e
Fx(XDT)515 1121 y Fz(exception)29 b(is)g(raised)f(in)i(order)e(to)h
(request)g(to)h(a)f(trusted)g(user)g(translator)e(an)i(image)g(of)515
1220 y(the)f(remote)f(ob)5 b(ject)27 b(in)h(the)g(nativ)n(e)f(format.)
639 1320 y(W)-7 b(e)29 b(m)n(ust)f(tak)n(e)f(in)n(to)g(accoun)n(t)g
(frozen)h(resources)d(in)k Fx(make)p 2527 1320 27 4 v
29 w(available)p Fz(.)34 b(As)28 b(w)n(e)g(will)515 1420
y(sa)n(y)35 b(in)h(section)g(2.4.5)f(that)i(an)n(y)e(attempt)i(to)f(op)
r(erate)f(on)h(a)g(frozen)g(resource)e(causes)515 1519
y(a)39 b Fx(FROZEN)f Fz(exception)i(to)g(b)r(e)g(raised,)i(but)f(for)f
Fx(melt)e Fz(op)r(erations.)73 b(Th)n(us,)43 b(whenev)n(er)515
1619 y(the)c(k)n(ernel)e(calls)h Fx(make)p 1301 1619
V 30 w(available)c Fz(this)39 b(function)g(m)n(ust)g(consider)e(the)i
(resource)e(as)515 1719 y(\\absen)n(t")d(from)h(its)h(con)n(tainer)e
(it)i(the)g(resource)d(is)j(frozen.)60 b(The)36 b(implemen)n(tation)f
(of)515 1818 y Fx(melt)26 b Fz(should)h(then)h(a)n(v)n(oid)e
Fx(make)p 1569 1818 V 30 w(available)e Fz(to)j(lo)r(cate)h(the)g
(resource)d(to)j(b)r(e)g(melted.)515 2051 y Fn(2.4.5)112
b(F)-9 b(reezing)37 b(resources)515 2204 y Fz(Resources)26
b(can)h(b)r(e)h(frozen)f(and)g(melted)i(using)515 2320
y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2320 24 4 v 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 2411 y Fi(//)39 b(Freezes)i(it.)f(Returns)h(in)f(the)g
(frozen)g(state)h(in)e(to)h(\(if)g(non-null\))h(and)f(size.)598
2503 y(//)f(Additional)j(state)e(is)g(stored)h(in)e(user)h(provide)h
(buffer)g(buf.)598 2594 y(//)e(Any)h(attempt)h(to)f(access)g(this)h
(frozen)f(resource)h(will)f(cause)h(an)e(exception)598
2685 y(//)g(delivered)j(to)d(frozen_domain)598 2777 y(virtual)i(err_t)f
(freeze\(char)i(*&buf,)e(size_t)h(&bsize,)1422 2868 y(char)f
(*&to,size_t)h(&size,)1422 2959 y(const)f(off_prtl_id_t)i
(&frozen_domain,)1422 3051 y(boolean_t)f(sign_it=FALSE\);)598
3142 y(//)e(Melts)i(a)e(resource.)j(Both)e(the)g(frozen)g(resource)h
(and)f(the)g(additional)598 3233 y(//)f(state)i(obtained)g(by)f(freeze)
g(must)g(be)g(provided.)h(If)f(from)g(is)g(null)g(it)g(is)598
3325 y(//)f(assumed)i(that)f(the)g(resource)h(already)g(has)f(its)g
(frozen)h(state.)598 3416 y(//)e(The)h(domain)h(is)f(restored)h(as)e
(specified)j(by)d(melted_domain)598 3507 y(virtual)i(err_t)f
(melt\(char)h(*&buf,)g(size_t)f(&bsize,)1343 3599 y(char)g(*&from,)h
(size_t)g(&size,)1343 3690 y(const)f(off_prtl_id_t)j(&melted_domain,)
1343 3781 y(boolean_t)e(was_signed=FALSE\);)1905 5255
y Fz(64)p eop
PStoPSsaved restore
%%Page: (66,67) 34
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
65 66 bop 639 523 a Fz(As)27 b(w)n(e)g(sa)n(w)e(b)r(efore,)i(the)g(t)n
(w)n(o)f(primitiv)n(es)h Fx(freeze)d Fz(and)j Fx(melt)e
Fz(p)r(ermit)i(access)f(to)h(the)515 623 y(state)g(of)g(a)g(resource)e
(and)i(recreation)f(of)h(a)g(resource)e(whose)i(state)g(is)g(kno)n(wn.)
36 b(This)27 b(can)515 722 y(b)r(e)h(used)f(to)h(migrate,)e(replicate)h
(and)h(mak)n(e)f(ph)n(ysical)f(resources)g(p)r(ersist.)639
822 y(The)i(seman)n(tic)f(of)h(b)r(oth)g(op)r(erations)e(is)h(as)g
(follo)n(ws:)515 963 y FA(frozen)32 b(resource)42 b Fz(A)22
b(frozen)g(resource)e(main)n(tains)i(its)h(iden)n(ti\014er)f(but)h(is)f
(not)g(accessible)722 1063 y(\(but)33 b(for)e Fx(melt)f
Fz(op)r(erations\).)48 b(An)n(y)31 b(attempt)h(to)g(op)r(erate)e(on)i
(a)f(frozen)g(resource)722 1163 y(will)h(cause)e(a)h
Fx(FROZEN)e Fz(exception)i(to)g(b)r(e)h(raised.)47 b(The)31
b(system)g(call)g(causing)g(the)722 1262 y(exception)c(will)g(a)n(w)n
(ait)f(un)n(til)i(the)f(exception)g(is)g(handled)g(\(indeed,)h(the)f
(exception)722 1362 y(will)h(b)r(e)g(handled)g(using)f(the)h(\015o)n(w)
f(of)g(con)n(trol)g(of)g(the)h(call\).)722 1489 y(A)j(p)r(ositiv)n(e)e
(answ)n(er)g(from)h(the)g(exception)g(handler)g(allo)n(ws)e(the)j(call)
f(to)g(pro)r(ceed.)722 1588 y(A)e(negativ)n(e)f(answ)n(er)f(from)h(the)
h(exception)f(mak)n(es)g(the)h(system)f(call)g(fail.)515
1742 y FA(melted)i(resource)42 b Fz(A)27 b(melted)h(resource)d(is)i
Fy(e)l(qual)36 b Fz(to)26 b(the)i(source)d(\(previously)h(frozen\))722
1842 y(one.)35 b(Its)22 b(iden)n(ti\014er)f(matc)n(hes)h(the)g(source)f
(iden)n(ti\014er,)i(as)e(w)n(ell)g(as)g(other)h(state)f(do)r(es.)639
1983 y(Starting)32 b(with)g(the)g(most)g(simple)g(metho)r(ds)g(of)g
(the)h(implemen)n(tation,)g(w)n(e)e(pro)n(vide)515 2083
y(a)26 b(default)i(implemen)n(tation)f(for)f Fx(is)p
1673 2083 27 4 v 31 w(freezeable)d Fz(and)j Fx(is)p 2415
2083 V 31 w(frozen)f Fz(using)h(a)h(\015ags)f(\014eld.)515
2182 y(In)i(this)f(w)n(a)n(y)g(these)g(tests)h(can)f(b)r(e)h(fast.)515
2303 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2303 24 4 v 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 2394 y Fi(//)39 b(Returns)i(FALSE)g(if)e(it's)h(not)g
(frozen.)598 2485 y(boolean_t)h(is_frozen\(void\))i(const)d({)676
2577 y(return)h(r_flags)g(&)e(OFF_RF_FROZEN;)j(})598
2668 y(//)d(Returns)i(FALSE)g(if)e(it's)h(not)g(freezeable.)598
2759 y(virtual)h(boolean_t)g(is_freezeable\(void\))i(const)e({)676
2851 y(return)g(\(r_flags)g(&)e(OFF_RF_FREEZABLE\))k(&&)d
(!is_frozen\(\);)598 2942 y(})515 3183 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f Fi(off)p 1616
3183 V 29 w(Resource)p Fj(.)i Fk(i)p Fq(\021)598 3274
y Fi(u_char)40 b(r_flags;)669 b(//)40 b(Resource)h(flags.)515
3424 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 3424 V 29 w(Resource)p Fj(.)i Fk(i)p
Fq(\021)598 3516 y Fi(r_flags\(0\))639 3644 y Fz(W)-7
b(e)28 b(m)n(ust)g(de\014ne)g(no)n(w)f(the)h(sym)n(b)r(ols)f(used)g(ab)
r(o)n(v)n(e.)515 3754 y Fk(h)p Fj(O\013)g(r)l(esour)l(c)l(e)j(\015ag)e
(bits.)g Fk(i)o Fq(\021)598 3846 y Fi(//)39 b(Resource)i(flag)g(bits.)
598 3937 y(const)f(u_char)h(OFF_RF_FREEZABLE=0x1;)j(//)39
b(Is)h(this)g(resource)h(freezeable?)598 4028 y(const)f(u_char)h
(OFF_RF_FROZEN)120 b(=0x2;)41 b(//)e(Is)h(this)g(resource)h(frozen?)639
4147 y Fz(Another)33 b(couple)f(of)h(metho)r(ds)g(is)f(pro)n(vided)g
(so)g(that)h(these)f(bits)h(could)g(b)r(e)g(set)g(ap-)515
4246 y(propriately)-7 b(.)515 4367 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
4367 V 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
4458 y Fi(//)39 b(Sets/Clears)j(the)e(freezeable)i(bit.)598
4550 y(void)e(set_rf_freezeable\(void\))k({)c(r_flags)h(|=)e
(OFF_RF_FREEZABLE;)k(})598 4641 y(void)d(clr_rf_freezeable\(void\))k({)
c(r_flags)h(&=)e(~OFF_RF_FREEZABLE;)44 b(})598 4732 y(//)39
b(Sets/Clears)j(the)e(frozen)h(bit.)598 4824 y(void)f
(set_rf_frozen\(void\))j({)d(r_flags)h(|=)e(OFF_RF_FROZEN;)k(})598
4915 y(void)d(clr_rf_frozen\(void\))j({)d(r_flags)h(&=)e
(~OFF_RF_FROZEN;)k(})1905 5255 y Fz(65)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
66 67 bop 639 523 a Fz(The)39 b(remaining)e(six)h(bits)h(of)f
Fx(r)p 1684 523 27 4 v 31 w(flags)e Fz(remain)i(un)n(used.)69
b(They)38 b(can)g(b)r(e)h(used)f(in)515 623 y(di\013eren)n(t)27
b(w)n(a)n(ys)g(b)n(y)g(sub)r(classes)f(of)i Fx(Resource)p
Fz(.)639 722 y(T)-7 b(o)30 b(freeze)h(a)f(system)g(resource)f(w)n(e)h
(m)n(ust)h(rely)f(on)g(sp)r(eci\014c)h(functions)f(whic)n(h)h(kno)n(w)
515 822 y(ho)n(w)c(to)g(freeze)g(the)h(resource)e(state.)639
922 y(First,)32 b(the)f(resource)e(state)i(is)g(frozen)f(using)h(the)g
(already)f(used)h(resource)e(memory)-7 b(.)515 1021 y(But)25
b(additional)g(\(dynamic\))g(state)g(whic)n(h)g(cannot)g(b)r(e)h(k)n
(ept)f(inside)g(the)h(resouce)e(itself)h(is)515 1121
y(stored)c(in)h(the)h(user)e(supplied)i(bu\013er)f Fx(buf)p
Fz(.)34 b(W)-7 b(e)22 b(will)h(\014ll)f(it)g(up)h(using)f(a)f(p)r(oin)n
(ter)h(\()p Fx(curbuf)p Fz(\))515 1220 y(to)27 b(the)h(trailing)f(free)
g(space)g(in)h Fx(buf)f Fz(and)g(a)g(coun)n(t)g(of)h(the)g(n)n(um)n(b)r
(er)f(of)h(b)n(ytes)f Fx(avail)p Fz(.)515 1353 y Fk(h)p
Fi(off)p 667 1353 24 4 v 29 w(Resource::freeze)k Fj(lo)l(c)l(al)c
(variables.)h Fk(i)p Fq(\021)598 1445 y Fi(char)40 b(*curbuf=buf;)591
b(//)40 b(Unused)g(portion)h(of)f(buf.)598 1536 y(size_t)g
(avail=bsize;)513 b(//)40 b(Avilable)h(#)e(of)h(bytes)g(in)g(buf.)639
1677 y Fz(A)31 b(resource)e(sp)r(eci\014c)i(metho)r(d)g
Fx(freeze)p 1925 1677 27 4 v 29 w(state)d Fz(will)j(do)f(the)h(job.)46
b(The)31 b(default)g(im-)515 1777 y(plemen)n(tation)c(assumes)g(that)h
(there)f(is)h(no)f(dynamic)g(state.)515 1910 y Fk(h)p
Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 1910 24 4 v 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 2001 y Fi(//)39 b(Freeze)i(dynamic)g(resource)g(state)f(in)
g(curbuf)h(with)f(avail)g(bytes.)598 2092 y(virtual)h(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2183 y(char)g(*&curto,)80 b(size_t)41 b(&toavail,)1657
2275 y(const)f(off_prtl_id_t)82 b(&frozen_domain)f(\);)515
2449 y Fk(h)p Fi(off)p 667 2449 V 29 w(Resource::freeze)p
1320 2449 V 31 w(state)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2540 y Fi(//)39 b(Freeze)i(dynamic)g(resource)g(state)f(in)
g(curbuf)h(with)f(avail)g(bytes.)598 2632 y(err_t)g
(off_Resource::freeze_state\(ch)q(ar)45 b(*buf,)c(char)f(*&curbuf,)1892
2723 y(size_t)h(&avail,)1892 2814 y(char)f(*&curto,)81
b(size_t)40 b(&toavail,)1892 2906 y(const)h(off_prtl_id_t)81
b(&frozen_domain)h(\))598 2997 y({)755 3088 y(assert\(buf)41
b(&&)f(curbuf)g(&&)g(avail)g(>)g(0\);)755 3180 y(\(void\)buf;)h
(\(void\)curbuf;)h(\(void\)avail;)g(\(void\)curto;)g(\(void\)toavail;)
755 3271 y(\(void\)frozen_domain;)755 3362 y(return)e(EOK;)598
3454 y(})515 3628 y Fk(h)p Fj(Implementation)28 b(of)f(other)i(metho)l
(ds)g(of)e Fi(off)p 1893 3628 V 29 w(Resource)p Fj(.)i
Fk(i)o Fq(\021)598 3719 y Fk(h)p Fi(off)p 750 3719 V
29 w(Resource::freeze)p 1403 3719 V 31 w(state)g Fj(implementation.)e
Fk(i)639 3861 y Fz(Second,)35 b(an)f(additional)f(bu\013er)g
Fx(to)g Fz(is)h(supplied)g(b)n(y)f(the)h(user)f(when)h(the)g(resource)
515 3960 y(state)25 b(frozen)h(on-site)f(\(i.e.)37 b(using)25
b(its)i(o)n(wn)e(memory\))g(m)n(ust)h(b)r(e)h(copied)e(to)h(a)g(user)f
(bu\013er)515 4060 y(\()p Fx(to)p Fz(\).)36 b(W)-7 b(e)28
b(use)g(another)f(couple)g(of)g(lo)r(cal)g(v)-5 b(ariables)27
b(to)g(handle)h(this)g(bu\013er.)515 4193 y Fk(h)p Fi(off)p
667 4193 V 29 w(Resource::freeze)j Fj(lo)l(c)l(al)c(variables.)h
Fk(i)p Fz(+)p Fq(\021)598 4284 y Fi(char)118 b(*curto=to;)598
4375 y(size_t)40 b(toavail=size;)639 4516 y Fz(In)28
b(this)g(case,)f Fx(copy)p 1285 4516 27 4 v 29 w(state)f
Fz(will)i(do)f(the)h(job.)515 4633 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l
(d)j(metho)l(ds)e(of)e Fi(off)p 1594 4633 24 4 v 29 w(Resource)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 4724 y Fi(//)39 b(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
4815 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g(=0;)1905 5255 y Fz(66)p eop
PStoPSsaved restore
%%Page: (68,69) 35
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
67 68 bop 639 523 a Fz(Once)27 b(these)h(t)n(w)n(o)f(functions)h(are)e
(implemen)n(ted,)j(w)n(e)e(can)g(write)h Fx(freeze)d
Fz(as)i(follo)n(ws.)515 643 y Fk(h)p Fi(off)p 667 643
24 4 v 29 w(Resource::freeze)k Fj(implementation.)c Fk(i)p
Fq(\021)598 734 y Fi(//)39 b(Freezes)i(it.)f(Returns)h(in)f(the)g
(frozen)g(state)h(in)e(to)h(\(if)g(non-null\))h(and)f(size.)598
825 y(//)f(Additional)j(state)e(is)g(stored)h(in)e(user)h(provide)h
(buffer)g(buf.)598 917 y(//)e(Any)h(attempt)h(to)f(access)g(this)h
(frozen)f(resource)h(will)f(cause)h(an)e(exception)598
1008 y(//)g(delivered)j(to)d(frozen_domain)598 1099 y(err_t)h
(off_Resource::freeze\(char)45 b(*&buf,)c(size_t)f(&bsize,)1657
1191 y(char)g(*&to,size_t)i(&size,)1657 1282 y(const)e(off_prtl_id_t)i
(&frozen_domain,)1657 1373 y(boolean_t)f(sign_it)g(\))598
1465 y({)676 1556 y(err_t)g(err=EOK;)676 1647 y Fk(h)p
Fi(off)p 828 1647 V 29 w(Resource::freeze)31 b Fj(lo)l(c)l(al)d
(variables.)g Fk(i)676 1830 y Fi(w_lock\(\);)676 1921
y(if)40 b(\(is_freezeable\(\)\){)755 2012 y(set_rf_frozen\(\);)755
2104 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ate)28 b(sp)l(ac)l(e)h(at)f
Fi(curbuf)h Fj(in)e Fi(avail)h Fj(bytes)h(to)g(stor)l(e)g
Fi(sigstart)p Fj(.)g Fk(i)755 2195 y(h)p Fj(Identify)e(the)h(fr)l(ozen)
h(r)l(esour)l(c)l(e)h(in)d Fi(curbuf)i Fj(of)e(length)h
Fi(avail)p Fj(.)g Fk(i)755 2286 y Fi(if)39 b
(\(\(err=freeze_state\(buf,curbu)q(f,av)q(ail,)q(curto)q(,toa)q(vail,)q
(froz)q(en_d)q(omain)q(\)\))45 b(||)912 2378 y
(\(err=copy_state\(curto,toavail\)\))q(\){)833 2469 y(natural_t)c
(i=curbuf-buf,)i(j=curto-to;)833 2560 y(w_unlock\(\);)833
2652 y(melt\(buf,i,to,j,get_domain\(\)\))q(;)833 2743
y(return)e(err;)755 2834 y(})755 2926 y Fk(h)p Fj(R)l(e)l(c)l(or)l(d)29
b Fi(sigstart)g Fj(at)f Fi(curbuf)h Fj(in)e Fi(buf)p
Fj(.)h Fk(i)755 3017 y Fi(if)39 b(\(sign_it\){)833 3108
y Fk(h)p Fj(Sign)27 b(fr)l(om)h Fi(buf)g Fj(to)g Fi(curbuf)h
Fj(and)f Fi(to)g Fj(in)f Fi(avail)h Fj(bytes.)h Fk(i)755
3200 y Fi(})755 3291 y(set_domain\(frozen_domain\);)755
3382 y(w_unlock\(\);)755 3474 y(bsize=curbuf-buf;)755
3565 y(if)39 b(\(to\))833 3656 y(size=curto-to;)755 3748
y(return)h(EOK;)676 3839 y(})676 3930 y(else)g({)755
4022 y(w_unlock\(\);)755 4113 y(return)g(EFROZEN;)676
4204 y(})598 4296 y(})639 4606 y Fz(Note)21 b(ho)n(w)f(the)h(lo)r(c)n
(k)f(prev)n(en)n(ts)f(race)h(conditions)g(on)g(concurren)n(t)f
Fx(freeze)f Fz(op)r(erations.)515 4706 y(The)24 b Fx(is)p
775 4706 27 4 v 30 w(freezeable)d Fz(test)j(prev)n(en)n(ts)f(an)h
(already)e(frozen)i(resource)e(to)i(b)r(e)h(frozen)e(again.)515
4805 y(That)k(is)h(considered)e(to)i(b)r(e)g(an)f(error:)515
4915 y Fk(h)p Fj(Other)h(O\013)f(err)l(or)j(numb)l(ers.)e
Fk(i)p Fq(\021)598 5006 y Fi(EFROZEN)982 b(//)40 b(Resource)h(is)e
(frozen.)1905 5255 y Fz(67)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
68 69 bop 639 523 a Fz(The)28 b(dynamic)g(frozen)f(state)g(bu\013er)h
(supplied)g(b)n(y)g(the)g(user)f(will)h(alw)n(a)n(ys)d(start)j(with)515
623 y(t)n(w)n(o)39 b(strings:)60 b(one)39 b(iden)n(tifying)h(the)g
(frozen)f(resource)f(and)i(another)f(iden)n(tifying)h(the)515
722 y(arc)n(hitecture)26 b(format)1217 692 y Fp(11)1287
722 y Fz(.)515 855 y Fk(h)p Fj(Identify)h(the)h(fr)l(ozen)h(r)l(esour)l
(c)l(e)h(in)d Fi(curbuf)i Fj(of)e(length)h Fi(avail)p
Fj(.)g Fk(i)p Fq(\021)598 946 y Fi(if)39 b
(\(!::freeze\(get_magic\(\).name)q(of\(\),)q(curb)q(uf,a)q(vail\))46
b(||)755 1038 y(!::freeze\(off_Version::arch,cur)q(buf,)q(avai)q(l\))
516 b(\))676 1129 y(return)41 b(ENOSPC;)515 1395 y Fk(h)p
Fj(O\013)27 b(r)l(esour)l(c)l(e)j(implementation)e(dep)l(endencies.)h
Fk(i)p Fq(\021)598 1486 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 1577 y(#include)h(<klib/Version.h>)278
b(//)40 b(for)g(off_Version)598 1669 y(#include)h(<klib/freeze.h>)317
b(//)40 b(for)g(freeze)639 1810 y Fz(Finally)-7 b(,)28
b(a)g(secure)f(digital)h(signature)f(can)g(b)r(e)i(requested.)37
b(T)-7 b(o)28 b(quic)n(kly)f(lo)r(cate)h(it)g(w)n(e)515
1910 y(store)e(the)i(index)g(in)g Fx(buf)e Fz(where)h(the)h(signature)f
(starts.)515 2026 y Fk(h)p Fi(off)p 667 2026 24 4 v 29
w(Resource::freeze)k Fj(lo)l(c)l(al)c(variables.)h Fk(i)p
Fz(+)p Fq(\021)598 2117 y Fi(unsigned32_t)42 b(*sigstart;)355
b(//)40 b(End)g(of)f(frozen)i(data/)f(start)h(of)e(signature)515
2275 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ate)28 b(sp)l(ac)l(e)h(at)f
Fi(curbuf)h Fj(in)e Fi(avail)h Fj(bytes)i(to)e(stor)l(e)h
Fi(sigstart)p Fj(.)g Fk(i)o Fq(\021)598 2366 y Fi
(sigstart=\(unsigned32_t)44 b(*\)curbuf;)598 2457 y(if)39
b(\(avail<=sizeof\(unsigned32_t)q(\)\))676 2549 y(return)i(ENOSPC;)598
2640 y(curbuf+=sizeof\(unsigned32_t\);)598 2731 y
(avail-=sizeof\(unsigned32_t\);)515 2906 y Fk(h)p Fj(R)l(e)l(c)l(or)l
(d)29 b Fi(sigstart)g Fj(at)f Fi(curbuf)h Fj(in)e Fi(buf)p
Fj(.)h Fk(i)o Fq(\021)598 2997 y Fi(assert\(sigstart\);)598
3088 y(*sigstart=curbuf-buf;)639 3230 y Fz(If)j(requested,)f(w)n(e)f
(sign)h(the)g(user)f(bu\013er)h(so)g(that)g(w)n(e)g(could)f(ensure)h
(data)f(in)n(tegrit)n(y)515 3329 y(whenev)n(er)d(the)i(no)r(de)g
(melts.)37 b(W)-7 b(e)28 b(use)g(the)g(utilit)n(y)g Fx(sign)e
Fz(whic)n(h)h(is)h(describ)r(ed)f(b)r(elo)n(w.)515 3445
y Fk(h)p Fj(Sign)g(fr)l(om)g Fi(buf)i Fj(to)f Fi(curbuf)g
Fj(and)g Fi(to)g Fj(in)f Fi(avail)i Fj(bytes.)g Fk(i)p
Fq(\021)598 3537 y Fi(if\(\(to)80 b(&&)39 b
(!sign\(curbuf,avail,to,curto-)q(to,b)q(uf,cu)q(rbuf)q(-buf\))q(\))45
b(||)715 3628 y(\(!to)c(&&)e(!sign\(curbuf,avail,buf,curbu)q(f-bu)q
(f\)\))45 b(\){)676 3719 y(natural_t)c(i=curbuf-buf,j=curto-to;)676
3811 y(w_unlock\(\);)676 3902 y(melt\(buf,i,to,j,get_domain\(\))q(\);)
676 3993 y(return)g(ENOSPC;)598 4085 y(})515 4242 y Fk(h)p
Fj(O\013)27 b(r)l(esour)l(c)l(e)j(implementation)e(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 4334 y Fi(#include)41 b(<klib/sign.h>)395
b(//)40 b(for)g(sign)p 515 4850 1146 4 v 577 4904 a Fm(11)642
4927 y Fl(W)-6 b(e)26 b(use)g Fh(off)p 998 4927 22 4
v 27 w(Version)p Fl(,)h(an)f(ob)t(ject)h(whic)n(h)f(k)n(eeps)h(k)n
(ernel)e(v)n(ersion)h(and)g(compilation)g(information.)515
5006 y(It)e(is)f(describ)r(ed)h(in)g(section)g(2.9.)1905
5255 y Fz(68)p eop
PStoPSsaved restore
%%Page: (70,71) 36
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
69 70 bop 639 523 a Fz(The)29 b(signature)f(can)g(b)r(e)i(c)n(hec)n(k)n
(ed)d(when)i(the)h(resource)d(is)h(melted)i(b)n(y)e(lo)r(cating)h(it)g
(in)515 623 y(the)e(bu\013er)f(using)g Fx(sigstart)p
Fz(,)e(whic)n(h)i(w)n(as)g(stored)g(at)g(the)h(b)r(eginning)f(of)h(the)
g(bu\013er)f(and)515 722 y(using)h(the)h Fx(sign)p 1056
722 27 4 v 30 w(ok)f Fz(utilit)n(y)h(\(describ)r(ed)f(later\).)515
839 y Fk(h)p Fi(from)h Fj(\(len)g Fi(size)p Fj(\))g(and)g
Fi(buf)h Fj(\()p Fi(bsize)p Fj(\))g(inte)l(grity)g(is)e(ok.)h
Fk(i)o Fq(\021)598 930 y Fi(\(\(from\))41 b(?)715 1021
y(sign_ok\(buf+\(*\(unsigned32_t)q(*\)buf)q(\),bs)q(ize-)q(\(*\(un)q
(sign)q(ed32_)q(t*\)b)q(uf\),)990 1112 y(from,size,buf,bsize\))637
1204 y(:)715 1295 y(sign_ok\(buf+\(*\(unsigned32_t)q(*\)buf)q(\),bs)q
(ize-)q(\(*\(un)q(sign)q(ed32_)q(t*\)b)q(uf\),)q(buf,b)q(size)q(\)\))
639 1420 y Fz(Be)25 b(a)f(resource)e(frozen)i(or)g(not,)h(a)f(frozen)g
(image)g(can)g(b)r(e)h(melted)g(on)f(it.)37 b(W)-7 b(e)24
b(w)n(e)h(melt)515 1519 y(a)i(frozen)f(image)h(in)n(to)g(a)g(fresh)g
(resource)f(w)n(e)h(will)g(thro)n(w)g(a)n(w)n(a)n(y)e(an)n(y)i
(previous)f(state)h(and)515 1619 y(reset)i(the)i(resource)d(state)i(to)
g(that)g(found)h(in)f(the)h(frozen)e(image.)44 b(If)30
b(the)h(resource)d(w)n(as)515 1719 y(frozen,)f(its)h(frozen)f(state)g
(is)g(melted.)639 1818 y(T)-7 b(o)25 b(melt)h(a)g(system)f(resource)f
(w)n(e)h(m)n(ust)g(\014rst)h(c)n(hec)n(k)e(the)i(in)n(tegrit)n(y)f(of)g
(the)h(data)f(\(if)i(it)515 1918 y(w)n(as)g(signed)i(on)f
Fx(freeze)p Fz(\).)38 b(Then)29 b(c)n(hec)n(k)e(that)i(the)g(image)f
(corresp)r(ond)f(to)i(the)g(resource)515 2017 y(t)n(yp)r(e.)36
b(If)25 b(ev)n(erything)e(lo)r(oks)g(\014ne)i(w)n(e)f(can)g(pro)r(ceed)
g(b)n(y)g(melting)h(the)f(resource)f(static)h(and)515
2117 y(dynamic)j(state.)515 2250 y Fk(h)p Fi(off)p 667
2250 24 4 v 29 w(Resource::melt)j Fj(implementation.)e
Fk(i)o Fq(\021)598 2341 y Fi(//)39 b(Melts)i(a)e(resource.)j(Both)e
(the)g(frozen)g(resource)h(and)f(the)g(additional)598
2433 y(//)f(state)i(obtained)g(by)f(freeze)g(must)g(be)g(provided.)80
b(If)40 b(from)g(is)g(null)g(it)g(is)598 2524 y(//)f(assumed)i(that)f
(the)g(resource)h(already)g(has)f(its)g(frozen)h(state)f(on-site.)598
2615 y(//)f(The)h(domain)h(is)f(restored)h(as)e(specified)j(by)d
(melted_domain)598 2707 y(err_t)h(off_Resource::melt\(char)45
b(*&buf,)40 b(size_t)h(&bsize,)1578 2798 y(char)g(*&from,)f(size_t)h
(&size,)1578 2889 y(const)g(off_prtl_id_t)h(&melted_domain,)1578
2980 y(boolean_t)g(was_signed)f(\))598 3072 y({)676 3163
y(assert\(buf)h(&&)d(bsize)i(>0\);)676 3254 y(if)f(\(bsize)g(<)g
(sizeof\(unsigned32_t\)\))755 3346 y(return)g(EINVAL;)676
3437 y(if)g(\(was_signed)i(&&)833 3528 y(!)e Fk(h)p Fi(from)28
b Fj(\(len)g Fi(size)p Fj(\))g(and)g Fi(buf)g Fj(\()p
Fi(bsize)p Fj(\))i(inte)l(grity)f(is)e(ok.)g Fk(i)p Fi(\))755
3620 y(return)40 b(EPERM;)676 3802 y Fk(h)p Fj(Ensur)l(e)29
b Fi(buf)f Fj(\()p Fi(bsize)h Fj(bytes\))g(has)g(this)f(r)l(esour)l(c)l
(e)i(kind.)d Fk(i)676 3985 y Fi(w_lock\(\);)676 4076
y(if)40 b(\(!is_frozen\(\)\))755 4168 y(cleanup\(\);)708
b(//)40 b(forget)g(about)h(the)f(old)f(state.)676 4259
y(if)h(\(from\))755 4350 y(restore_state\(from,size\);)676
4442 y(melt_state\(buf,bsize,from,si)q(ze,me)q(lted)q(_dom)q(ain\);)676
4533 y(clr_rf_frozen\(\);)676 4624 y(set_domain\(melted_domain\);)676
4716 y(w_unlock\(\);)676 4807 y(return)h(EOK;)598 4898
y(})1905 5255 y Fz(69)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
70 71 bop 639 523 a Fz(W)-7 b(e)34 b(\014rst)g(ensure)f(that)g(w)n(e)h
(are)e(melting)i(a)f(no)r(de)h(for)f(the)h(nativ)n(e)f(arc)n
(hitecture.)54 b(If)515 623 y(that)26 b(is)f(not)g(the)h(case,)g(w)n(e)
f(assume)f(that)i(it)g(is)g(a)f(foreign-arc)n(hitecture)e(frozen)i(no)r
(de)g(and)515 722 y(try)i(to)h(assimilate)e(it)i(to)g(the)g(nativ)n(e)f
(format.)515 853 y Fk(h)p Fj(Ensur)l(e)h Fi(buf)h Fj(\()p
Fi(bsize)g Fj(bytes\))g(has)f(this)g(r)l(esour)l(c)l(e)i(kind.)d
Fk(i)p Fq(\021)598 944 y Fi(//)39 b(Are)h(we)g(melting)h(this)f(kind)g
(of)g(resource)h(in)f(the)f(native)i(format?)598 1036
y(if\(strncmp\(::melt\(buf,buf,bsiz)q(e\),ki)q(ndof)q(\(\),s)q(trlen)q
(\(kin)q(dof\(\))q(\)\))k(||)715 1127 y(strncmp\(::melt\(buf,buf,bsiz)q
(e\),of)q(f_Ve)q(rsio)q(n::ar)q(ch,s)q(trlen)q(\(off)q(_Ver)q(sion:)q
(:arc)q(h\)\)\){)676 1218 y(if)40 b(\(!assimilate\(kindof\(\),off_Vers)
q(ion:)q(:arc)q(h,buf)q(,siz)q(e\)\))755 1310 y(return)g(EINVAL;)598
1401 y(})515 1571 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
1663 y Fi(#include)41 b(<string.h>)512 b(//)40 b(for)g(strncmp)g(et)g
(al.)639 1802 y Fz(Where)19 b Fx(assimilate)c Fz(m)n(ust)20
b(b)r(e)f(implemen)n(ted)h(for)e(concrete)h(instances)f(of)h
Fx(Resource)p Fz(.)515 1917 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 1917 24 4 v 29 w(Resource)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 2008 y Fi(virtual)41 b(err_t)f
(assimilate\(const)j(char)d(*kind,)1108 2099 y(const)g(char)g(*arch,)h
(char)f(*&buf,)h(size_t)f(&size\);)515 2254 y Fk(h)p
Fi(off)p 667 2254 V 29 w(Resource::assimilate)32 b Fj(implementation.)
27 b Fk(i)p Fq(\021)598 2345 y Fi(err_t)40 b
(off_Resource::assimilate\(cons)q(t)45 b(char)40 b(*kind,)1814
2437 y(const)g(char)g(*arch,)h(char)f(*&buf,)1814 2528
y(size_t)g(&size\))598 2619 y({)676 2711 y(\(void\)kind;)i
(\(void\)arch;)g(\(void\)buf;)f(\(void\)size;)676 2802
y(return)g(ENOSYS;)598 2893 y(})515 3155 y Fk(h)p Fj(Implementation)28
b(of)f(other)i(metho)l(ds)g(of)e Fi(off)p 1893 3155 V
29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 3246
y Fk(h)p Fi(off)p 750 3246 V 29 w(Resource::assimilate)j
Fj(implementation.)27 b Fk(i)639 3385 y Fz(Sub)r(classes)21
b(of)g Fx(Resource)e Fz(m)n(ust)i(implemen)n(t)h Fx(cleanup)p
Fz(,)e(to)h(do)g(an)n(y)g(in)n(ternal)g(clean)n(up)515
3485 y(prior)36 b(to)h(discarding)f(state.)66 b(The)37
b(default)h(implemen)n(tation)f(assumes)g(that)g(there)g(is)515
3584 y(nothing)27 b(to)h(clean)f(up.)515 3715 y Fk(h)p
Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 3715 V 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
3807 y Fi(//)39 b(Does)i(resource)g(cleanup.)g(No)e(external)i
(resource)g(should)g(be)f(used)g(after)598 3898 y(//)f(return.)598
3989 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(EOK;)g(})639
4128 y Fz(They)g(m)n(ust)g(also)e(implemen)n(t)i Fx(restore)p
1995 4128 27 4 v 29 w(state)e Fz(to)h(restore)f(static)i(state)f(from)g
(a)515 4228 y(user)23 b(supplied)h(bu\013er,)h(and)f
Fx(melt)p 1608 4228 V 30 w(state)e Fz(to)i(restore)e(an)n(y)h(dynamic)h
(state.)36 b(The)24 b(default)515 4328 y(implemen)n(tation)j(of)f
Fx(melt)p 1381 4328 V 30 w(state)f Fz(assumes)h(that)h(there)f(is)h(no)
g(dynamic)f(state)h(to)g(melt.)515 4458 y Fk(h)p Fj(Other)h(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 4458 24 4
v 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 4550
y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 4641 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\)=0;)598 4824 y(//)f(Restores)i(dynamic)g
(resource)g(state.)598 4915 y(virtual)g(err_t)f(melt_state\(char)j
(*&buf,)d(size_t)h(&bsize,)g(char)f(*&from,)h(size_t)f(&size,)1578
5006 y(const)h(off_prtl_id_t)h(&melted_domain\);)1905
5255 y Fz(70)p eop
PStoPSsaved restore
%%Page: (72,73) 37
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
71 72 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v 29
w(Resource::melt)p 1242 523 V 31 w(state)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Restores)i(dynamic)g(resource)g
(state.)598 706 y(err_t)f(off_Resource::melt_state\(char)46
b(*&buf,)1814 797 y(size_t)40 b(&bsize,)h(char)f(*&from,)1814
888 y(size_t)g(&size,)1814 980 y(const)g(off_prtl_id_t)i
(&melted_domain\))598 1071 y({)715 1162 y(assert\(buf)g(&&)e
(bsize>0\);)715 1254 y(\(void\)buf;)i(\(void\)bsize;)g(\(void\)from;)g
(\(void\)size;)f(\(void\)melted_domain;)715 1345 y(return)g(EOK;)598
1436 y(})515 1702 y Fk(h)p Fj(Implementation)28 b(of)f(other)i(metho)l
(ds)g(of)e Fi(off)p 1893 1702 V 29 w(Resource)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 1793 y Fk(h)p Fi(off)p 750
1793 V 29 w(Resource::melt)p 1325 1793 V 31 w(state)g
Fj(implementation.)e Fk(i)639 1934 y Fz(All)35 b(the)g(implemen)n
(tations)f(sho)n(wn)f(ab)r(o)n(v)n(e)g(is)h(included)h(with)g
(remaining)e(resource)515 2034 y(implemen)n(tation)27
b(co)r(de.)515 2150 y Fk(h)p Fj(Implementation)h(of)f(other)i(metho)l
(ds)g(of)e Fi(off)p 1893 2150 V 29 w(Resource)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 2242 y Fk(h)p Fi(off)p 750
2242 V 29 w(Resource::freeze)i Fj(implementation.)c Fk(i)598
2333 y(h)p Fi(off)p 750 2333 V 29 w(Resource::melt)j
Fj(implementation.)e Fk(i)639 2549 y Fz(Another)j(metho)r(d)g
Fx(make)p 1454 2549 27 4 v 29 w(melted)e Fz(should)h(b)r(e)h(called)f
(b)r(efore)g(op)r(eration)g(on)g(the)h(re-)515 2648 y(source.)k(It)28
b(is)g(resp)r(onsible)f(of)g(raising)f Fx(FROZEN)g Fz(exceptions)h
(when)g(appropriate.)515 2765 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2765 24 4 v 29 w(Resource)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 2856 y Fi(//)39 b(Ensures)i(the)f(resource)h
(is)f(not)g(frozen)g(by)g(raising)h(FROZEN)598 2947 y(//)e(exceptions)j
(when)e(appropriate.)598 3039 y(err_t)g(make_melted\(void\))j({)676
3130 y(return)e(\(!is_frozen\(\)\))h(?)e(EOK)g(:)f(request_melt\(\);)
598 3221 y(})639 3346 y Fz(The)31 b Fx(request)p 1126
3346 27 4 v 28 w(melt)e Fz(metho)r(d)i(simply)f(raises)f(a)h
Fx(FROZEN)e Fz(exception.)45 b(The)31 b(handler)515 3445
y(pro)n(vided)f(error)g(co)r(de)h(determines)g(is)h(the)g(call)f(ma)n
(y)g(pro)r(ceed.)48 b(The)31 b(default)h(action)f(is)515
3545 y(to)c(ab)r(ort.)515 3661 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 3661 24 4 v 29 w(Resource)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 3753 y Fi(//)39 b(Raises)i(a)e(FROZEN)
i(exception.)598 3844 y(virtual)g(err_t)f(request_melt\(void\))j({)676
3935 y(return)e(::request_melt\(get_domain\(\),ge)q(t_ma)q(gic\(\))q
(,get)q(_id\(\))q(\);)598 4027 y(})515 4184 y Fk(h)p
Fj(O\013)27 b(r)l(esour)l(c)l(e)j(dep)l(endencies.)f
Fk(i)p Fz(+)p Fq(\021)598 4276 y Fi(#include)41 b(<klib/freeze.h>)639
4417 y Fz(Where)28 b Fx(::request)p 1306 4417 27 4 v
27 w(melt)e Fz(is)i(a)f(utilit)n(y)h(to)g(raise)e Fx(FROZEN)f
Fz(exceptions.)515 4550 y Fk(h)p Fi(request)p 823 4550
24 4 v 29 w(melt)k Fj(utilities.)e Fk(i)p Fq(\021)598
4641 y Fi(//)39 b(Raises)i(a)e(FROZEN)i(exception.)598
4732 y(err_t)f(request_melt\(const)j(off_prtl_id_t)g(&ex,)1343
4824 y(const)d(off_Magic)i(kind,)e(const)g(off_id_t)h(&eid\);)1905
5255 y Fz(71)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
72 73 bop 515 523 a Fk(h)p Fi(request)p 823 523 24 4
v 29 w(melt)29 b Fj(utilities)e(dep)l(endencies.)i Fk(i)p
Fq(\021)598 614 y Fi(#include)41 b(<klib/ids.h>)434 b(//)40
b(for)g(prtl_id_t)h(et)f(al.)598 706 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)598 797
y(#include)h(<klib/Magic.h>)356 b(//)40 b(for)g(off_Magic.)639
938 y Fz(The)24 b(implemen)n(tation)g(deliv)n(ers)f(an)h(exception)f
(to)h(the)h(user)e(supplying)h(\(in)g(addition)515 1038
y(to)j(the)h(exception)f(t)n(yp)r(e,)h Fx(m)p 1389 1038
27 4 v 31 w(type)p Fz(\))f(the)h(kind)f(of)h(resource)e(and)h(the)h
(resource)e(iden)n(ti\014er.)515 1171 y Fk(h)p Fj(O\013)h(user-kernel)j
(messages.)f Fk(i)p Fq(\021)598 1262 y Fi(//)39 b(Frozen)i(message.)598
1353 y(struct)f(off_FrozenReq)j(:)c(public)i(off_MsgReq)g({)676
1445 y(off_Magic)159 b(m_obj;)433 b(//)40 b(Object)g(kind.)676
1536 y(off_id_t)198 b(m_id;)472 b(//)40 b(Object)g(id.)676
1719 y(//)g(Creates)h(a)e(frozen)i(request.)676 1810
y(off_FrozenReq\(const)j(off_Magic)d(obj,)f(const)h(off_eu_id_t)g(id\))
f(:)755 1901 y(off_MsgReq\(OFF_EX_FROZEN\),)45 b(m_obj\(obj\),)d
(m_id\(id\))f({;})598 1993 y(};)515 2258 y Fk(h)p Fj(O\013)27
b(user-kernel)j(messages)f(dep)l(endencies.)g Fk(i)p
Fq(\021)598 2350 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(off_eu_id_t)h(et)f(al.)598 2441 y(#include)h
(<klib/Magic.h>)356 b(//)40 b(for)g(off_Magic)639 2582
y Fz(The)d(user)e(is)h(exp)r(ected)h(to)f(return)g(an)n(y)f(of:)55
b Fx(EOK)35 b Fz(when)h(the)h(call)f(should)g(b)r(e)g(able)515
2682 y(to)c(pro)r(ceed,)g Fx(EFROZEN)d Fz(when)k(the)f(call)g(should)f
(b)r(e)i(ab)r(orted,)f(and)g Fx(ENOPRTL)d Fz(when)k(the)515
2781 y(resource)26 b(should)h(b)r(e)h(considered)e(to)i(b)r(e)g
(missing)f(un)n(til)h(it)g(is)g(melted)g(again.)515 2914
y Fk(h)p Fj(O\013)f(user-kernel)j(messages.)f Fk(i)p
Fz(+)o Fq(\021)598 3005 y Fi(struct)40 b(off_FrozenRep)j(:)c(public)i
(off_MsgRep)g({)676 3097 y(off_id_t)159 b(m_id;)511 b(//)40
b(New)g(relocation)h(\(if)f(known\))h(or)e(OFF_ID_NULL)676
3188 y(off_FrozenRep\(void\){;})676 3279 y(off_FrozenRep\(const)44
b(off_eu_id_t)d(id\))f(:)g(m_id\(id\))h({;})598 3371
y(};)1905 5255 y Fz(72)p eop
PStoPSsaved restore
%%Page: (74,75) 38
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
73 74 bop 515 523 a Fk(h)p Fi(request)p 823 523 24 4
v 29 w(melt)29 b Fj(utility)e(implementation.)h Fk(i)p
Fq(\021)598 614 y Fi(//)39 b(Raises)i(a)e(FROZEN)i(exception.)598
706 y(err_t)f(request_melt\(const)j(off_prtl_id_t)g(&ex,)1343
797 y(const)d(off_Magic)i(kind,)e(const)g(off_id_t)h(&eid\))598
888 y({)676 980 y(err_t)g(e=EOK;)676 1071 y(\(void\)ex;)g
(\(void\)kind;)h(\(void\)eid;)598 1162 y(#if)e(0)1059
b(//)40 b(XXX)g(include)g(it)676 1254 y(off_FrozenReq)i(m\(kind,)f
(eid\);)676 1345 y(off_FrozenRep)h(r;)676 1436 y(if)e(\(ex)g(==)f
(OFF_PRTL_NULL\))755 1528 y(return)h(ENOPRTL;)676 1619
y(if)g(\(\(e=prtl.kpct\(ex,off_Shtl::sel)q(f\(\),)q(size)q(of\(m\))q
(,siz)q(eof\(r)q(\),&m)q(,&r,)q(0\)\)\))755 1710 y(return)g(e;)676
1802 y(return)h(\(r.m_err\))g(?)f(EFROZEN)g(:)g(EOK;)598
1893 y(#endif)676 1984 y(return)h(e;)598 2076 y(})515
2341 y Fk(h)p Fi(request)p 823 2341 V 29 w(melt)29 b
Fj(utility)e(implementation)h(dep)l(endencies.)h Fk(i)p
Fq(\021)598 2433 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40
b(for)g(off_Frozen{Req|Rep})598 2524 y(#include)h(<prtl/PrtlSrv.h>)278
b(//)40 b(for)g(prtl.)598 2615 y(#include)h(<shtl/Shtl.h>)395
b(//)40 b(for)g(Shtl)g(and)g(self.)639 2756 y Fz(These)c(utilities)g
(are)f(de\014ned)h(in)g Fx(klib/freeze.h)p Fz(,)d(whic)n(h)j(m)n(ust)g
(b)r(e)g(included)g(b)n(y)515 2856 y Fx(CompResource)p
Fz(.)515 2972 y Fk(h)p Fj(O\013)27 b(c)l(omp)l(ound)i(r)l(esour)l(c)l
(e)h(dep)l(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 3064
y Fi(#include)41 b(<klib/freeze.h>)317 b(//)40 b(for)g(::request_melt)
515 3321 y Fn(2.4.6)112 b(Arc)m(hitecture)35 b(a)m(w)m(areness)k(supp)s
(ort)515 3474 y Fz(Eac)n(h)19 b Fx(resource)e Fz(will)k(b)r(e)g(wrapp)r
(ed)f(with)h(a)f Fx(Navigator)d Fz(and)j(an)g Fx(Inspector)p
Fz(.)31 b(This)20 b(w)n(a)n(y)-7 b(,)515 3574 y(the)21
b(OS)g(built)h(on)f(top)h(of)f(the)h Fw(\026)p Fz(k)n(ernel)e(will)i(b)
r(e)f(able)g(to)g(transparen)n(tly)f(na)n(vigate)g(through)515
3673 y(its)38 b(comp)r(onen)n(ts)g(and)f(later)h(on)g(ask)f(ab)r(out)h
(resource)e(attributes)i(\(e.g.)68 b(bandwidth,)515 3773
y(p)r(ersistence,)27 b(etc.\),)639 3873 y(The)19 b(class)e(hierarc)n
(hies)g(of)h Fx(Navigator)p Fz(s)c(and)19 b Fx(Inspector)p
Fz(s)14 b(mimic)19 b(that)g(of)f Fx(Resource)p Fz(,)515
3972 y(th)n(us)27 b(w)n(e)h(omit)f(them)h(b)n(y)g(no)n(w.)639
4072 y(Ev)n(ery)17 b(resource)g(will)h(include)h(t)n(w)n(o)e(metho)r
(ds,)k Fx(get)p 2243 4072 27 4 v 30 w(navigator)15 b
Fz(and)j Fx(get)p 2968 4072 V 30 w(inspector)p Fz(,)515
4171 y(to)30 b(pro)n(vide)f(a)h(p)r(oin)n(ter)g(to)h(its)f(sp)r
(eci\014c)h(na)n(vigator)d(and)i(insp)r(ector.)45 b(Both)30
b(of)h(them)g(will)515 4271 y(b)r(e)e(friends)h(of)f(the)h(ob)5
b(ject)29 b(considered)f(and)h(will)h(b)r(e)g(able)f(to)g(access)f(its)
i(state)f(in)g(order)515 4371 y(to)e(supp)r(ort)h(their)f(services.)515
4504 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4504 24 4 v 29 w(Resource)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 4595 y Fi(//)39 b(Returns)i(the)f(navigator)h(for)f(the)g
(resource.)598 4686 y(virtual)h(off_Navigator)h(*get_navigator\(void\))
i(const)c({)f(return)i(NULL;)f(})598 4778 y(//)f(Returns)i(the)f
(inspector)h(for)f(the)g(resource.)598 4869 y(virtual)h(off_Inspector)h
(*get_inspector\(void\))i(const)c({)f(return)i(NULL;)f(})1905
5255 y Fz(73)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
74 75 bop 639 523 a Fz(By)38 b(enquiring)g(the)h(na)n(vigator,)f
(references)g(to)g(other)g(system)g(resources)e(ma)n(y)i(b)r(e)515
623 y(obtained)27 b(and)g Fx(get)p 1154 623 27 4 v 31
w(navigator)d Fz(or)i Fx(get)p 1838 623 V 30 w(inspector)e
Fz(ma)n(y)j(b)r(e)h(used)g(again.)639 722 y(The)g(sc)n(heme)f(w)n(orks)
f(as)h(sho)n(wn)g(in)h(the)g(example)f(of)g(the)h(\014gure)f(2.5:)616
888 y(1.)41 b(The)28 b(user)f(has)g(a)g(reference)g(to)g(a)g(memory)g
(bank.)616 1054 y(2.)41 b(Using)26 b Fx(get)p 1091 1054
V 30 w(navigator)p Fz(,)d(a)j(reference)f(to)i(its)f(na)n(vigator)e(is)
i(obtained.)36 b(This)26 b(na)n(vi-)722 1154 y(gator)g(implemen)n(ts)i
(the)g Fx(Navigator)c Fz(in)n(terface.)616 1320 y(3.)41
b(Bro)n(wsing)26 b(with)i(the)g(na)n(vigator,)d(a)i(page)g(frame)g(is)h
(lo)r(cated)616 1486 y(4.)41 b(Its)29 b(metho)r(d)g Fx(get)p
1286 1486 V 30 w(inspector)c Fz(is)j(used)h(to)f(obtain)g(a)h
(reference)e(to)i(an)f(ob)5 b(ject)28 b(im-)722 1586
y(plemen)n(ting)23 b(the)f Fx(Inspector)d Fz(in)n(terface.)34
b(A)23 b(common)f(proto)r(col)f(can)h(b)r(e)g(used)h(no)n(w)722
1685 y(to)28 b(\014nd)g(out)f(ab)r(out)h(the)g(page)f(frame)g(p)r
(ersistence,)g(size,)g(etc.)639 1851 y(Resources)f(no)n(w)h(dep)r(end)i
(on)e(the)h Fx(Navigator)c Fz(class.)515 1968 y Fk(h)p
Fj(O\013)j(r)l(esour)l(c)l(e)j(dep)l(endencies.)f Fk(i)p
Fz(+)p Fq(\021)598 2059 y Fi(#include)41 b(<klib/nav.h>)639
2183 y Fz(Ho)n(w)n(ev)n(er,)34 b(na)n(vigators)d(and)j(insp)r(ectors)f
(use)h(the)g(resource)f(class.)55 b(T)-7 b(o)33 b(circum)n(v)n(en)n(t)
515 2283 y(the)28 b(circular)e(reference)h(w)n(e)g(will)h(use)f(this)h
(dep)r(endency)515 2399 y Fk(h)p Fj(O\013)f(r)l(esour)l(c)l(e)j
(navigator)f(dep)l(endencies.)g Fk(i)p Fq(\021)598 2491
y Fi(class)40 b(off_Resource;)199 b(//)40 b(to)g(break)g(circular)h
(dependency.)639 2615 y Fz(after)33 b(declaring)f Fx(Navigator)d
Fz(and)k Fx(Inspector)c Fz(classes,)k(w)n(e)g(will)g(imp)r(ort)g
(resource)515 2715 y(de\014nitions.)515 2831 y Fk(h)p
Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator)f(late)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2922 y Fi(#include)41 b(<klib/Resource.h>)639
3047 y Fz(A)28 b Fx(Navigator)c Fz(pro)n(vides)i(metho)r(ds)i(to)g
(select)f(and)h(lo)r(okup)f(comp)r(onen)n(ts.)515 3180
y Fk(h)p Fj(O\013)g(r)l(esour)l(c)l(e)j(navigator.)e
Fk(i)p Fq(\021)598 3271 y Fi(//)39 b(A)h(resource)h(navigator)598
3362 y(//)598 3454 y(class)f(off_Navigator)i({)598 3545
y(public:)715 3636 y(//)e(Returns)h(a)e(reference)j(to)d(the)h
(resource)h(being)g(navigated)715 3728 y(virtual)g(off_Resource)h
(*get_current\(void\)=0;)715 3910 y(//)e(Advances)h(the)f(iteration)h
(and)f(returns)h(the)f(next)g(element.)715 4002 y(virtual)h
(off_Resource)h(*get_next\(void\)=0;)715 4093 y(//)e(Resets)h(the)f
(iteration)h(so)f(that)g(get_next)h(will)f(return)g(the)g(1st)g
(element.)715 4184 y(virtual)h(void)f(reset\(void\)=0;)715
4367 y(//)g(Select)h(a)e(component)i(by)f(name)g(or)g(id.)715
4458 y(virtual)h(off_Resource)h(*operator[]\(const)h(char)d(*name\)=0;)
715 4550 y(virtual)h(off_Resource)h(*operator[]\(const)h(off_id_t)e
(&id\)=0;)598 4641 y(};)1905 5255 y Fz(74)p eop
PStoPSsaved restore
%%Page: (76,77) 39
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
75 76 bop 515 2068 a @beginspecial 0 @llx 0 @lly 526
@urx 299 @ury 3437 @rwi @setspecial
%%BeginDocument: fig/navigator.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-8.0 307.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 7087 150 m 8287 150 l 8287 900 l 7087 900 l cp gs col-1 s gr 
% Polyline
n 7087 400 m 8287 400 l gs col-1 s gr 
/Courier ff 165.00 scf sf
7200 300 m
gs 1 -1 sc (Inspector) col-1 sh gr
% Polyline
n 4237 150 m 5437 150 l 5437 900 l 4237 900 l cp gs col-1 s gr 
% Polyline
n 4237 400 m 5437 400 l gs col-1 s gr 
/Courier ff 165.00 scf sf
4425 300 m
gs 1 -1 sc (Navigator) col-1 sh gr
% Polyline
n 7200 3375 m 8850 3375 l 8850 4125 l 7200 4125 l cp gs col-1 s gr 
% Polyline
n 7200 3625 m 8850 3625 l gs col-1 s gr 
/Courier ff 165.00 scf sf
7275 3540 m
gs 1 -1 sc (PFrameInspector) col-1 sh gr
% Polyline
n 3300 1800 m 4875 1800 l 4875 2550 l 3300 2550 l cp gs col-1 s gr 
% Polyline
n 3300 2050 m 4875 2050 l gs col-1 s gr 
/Courier ff 165.00 scf sf
3375 1950 m
gs 1 -1 sc (MBankNavigator) col-1 sh gr
% Polyline
n 6225 2325 m 7800 2325 l 7800 3075 l 6225 3075 l cp gs col-1 s gr 
% Polyline
n 6225 2575 m 7800 2575 l gs col-1 s gr 
/Courier ff 165.00 scf sf
6300 2490 m
gs 1 -1 sc (MBankInspector) col-1 sh gr
% Polyline
n 4200 4350 m 5775 4350 l 5775 5100 l 4200 5100 l cp gs col-1 s gr 
% Polyline
n 4200 4600 m 5775 4600 l gs col-1 s gr 
/Courier ff 165.00 scf sf
4275 4500 m
gs 1 -1 sc (NullNavigator) col-1 sh gr
% Rotated Ellipse
gs
1500 3750 tr
-270.001 rot
n 0 0 75 75 0 360 DrawEllipse gs col-1 s gr
gr

% Polyline
gs  clippath
1530 3528 m 1500 3648 l 1470 3528 l 1470 3690 l 1530 3690 l  cp clip
n 1500 3375 m 1500 3675 l gs col-1 s gr gr

% arrowhead
n 1530 3528 m 1500 3648 l 1470 3528 l  col-1 s
% Polyline
n 1500 3000 m 1425 3150 l 1500 3300 l 1575 3150 l 1500 3000 l gs col-1 s gr 
% Polyline
n 1500 3300 m 1500 3525 l gs col-1 s gr 
% Polyline
n 600 2250 m 2625 2250 l 2625 3000 l 600 3000 l cp gs col-1 s gr 
% Polyline
n 600 2500 m 2625 2500 l gs col-1 s gr 
% Polyline
n 675 3825 m 2400 3825 l 2400 4575 l 675 4575 l cp gs col-1 s gr 
% Polyline
n 675 4075 m 2400 4075 l gs col-1 s gr 
/Courier ff 165.00 scf sf
900 2700 m
gs 1 -1 sc (get_navigator) col-1 sh gr
/Courier ff 165.00 scf sf
900 2865 m
gs 1 -1 sc (get_inspector) col-1 sh gr
/Courier ff 165.00 scf sf
825 4275 m
gs 1 -1 sc (get_navigator) col-1 sh gr
/Courier ff 165.00 scf sf
825 4440 m
gs 1 -1 sc (get_inspector) col-1 sh gr
/Courier ff 165.00 scf sf
825 675 m
gs 1 -1 sc (get_navigator) col-1 sh gr
/Courier ff 165.00 scf sf
825 840 m
gs 1 -1 sc (get_inspector) col-1 sh gr
% Polyline
n 600 225 m 2625 225 l 2625 975 l 600 975 l cp gs col-1 s gr 
% Polyline
n 600 475 m 2625 475 l gs col-1 s gr 
/Courier ff 165.00 scf sf
1200 375 m
gs 1 -1 sc (Resource) col-1 sh gr
% Polyline
n 1575 1200 m 1425 1350 l 1725 1350 l 1575 1200 l gs col-1 s gr 
% Polyline
n 1575 975 m 1575 1200 l gs col-1 s gr 
% Polyline
n 4800 1125 m 4650 1275 l 4950 1275 l 4800 1125 l gs col-1 s gr 
% Polyline
n 4800 900 m 4800 1125 l gs col-1 s gr 
% Polyline
n 7650 1125 m 7500 1275 l 7800 1275 l 7650 1125 l gs col-1 s gr 
% Polyline
n 7650 900 m 7650 1125 l gs col-1 s gr 
% Polyline
n 1575 1350 m 1575 1650 l gs col-1 s gr 
% Polyline
n 1575 1875 m 1575 2250 l gs col-1 s gr 
% Polyline
 [15 50.0] 50.0 sd
n 1575 1650 m 1575 1875 l gs col-1 s gr  [] 0 sd
% Polyline
n 4875 1275 m 4125 1275 l 4125 1800 l gs col-1 s gr 
% Polyline
n 4800 1275 m 5325 1275 l 5325 1275 l 5325 4350 l gs col-1 s gr 
% Polyline
n 7650 1275 m 6900 1275 l 6900 2325 l gs col-1 s gr 
% Polyline
n 7725 1275 m 8250 1275 l 8250 1275 l 8250 3375 l gs col-1 s gr 
% Polyline
n 3225 2025 m 3225 2025 l gs col-1 s gr
% Interp Spline
gs  clippath
754 2589 m 873 2623 l 752 2649 l 914 2656 l 916 2596 l  cp clip
 [15 50.0] 50.0 sd
n 150 2100 m
	358.2 2095.7 433.2 2114.4 450 2175 curveto
	473.0 2258.1 203.9 2310.4 225 2400 curveto
	260.4 2550.2 429.2 2606.4 900 2625 curveto
 gs col-1 s gr
 gr
 [] 0 sd
% arrowhead
n 754 2589 m 873 2623 l 752 2649 l  col-1 s
% Interp Spline
gs  clippath
3082 1904 m 3198 1947 l 3076 1964 l 3237 1981 l 3243 1922 l  cp clip
 [15 50.0] 50.0 sd
n 2325 2625 m
	2539.1 2643.6 2632.8 2643.6 2700 2625 curveto
	2804.4 2596.1 3047.0 2555.8 3075 2400 curveto
	3105.7 2228.9 2727.2 2149.8 2775 2025 curveto
	2809.0 1936.1 2921.5 1917.3 3225 1950 curveto
 gs col-1 s gr
 gr
 [] 0 sd
% arrowhead
n 3082 1904 m 3198 1947 l 3076 1964 l  col-1 s
% Interp Spline
gs  clippath
2616 4026 m 2501 3978 l 2625 3966 l 2464 3943 l 2456 4003 l  cp clip
 [15 50.0] 50.0 sd
n 4200 2325 m
	3664.3 2915.1 3458.0 3196.3 3375 3450 curveto
	3345.2 3540.9 3461.8 3722.5 3375 3825 curveto
	3216.6 4012.0 2991.6 4049.5 2475 3975 curveto
 gs col-1 s gr
 gr
 [] 0 sd
% arrowhead
n 2616 4026 m 2501 3978 l 2625 3966 l  col-1 s
% Interp Spline
gs  clippath
6976 3435 m 7098 3452 l 6982 3495 l 7143 3478 l 7137 3419 l  cp clip
 [15 50.0] 50.0 sd
n 2250 4425 m
	3072.1 4427.9 3428.4 4409.1 3675 4350 curveto
	4015.4 4268.3 4694.1 3845.2 5025 3750 curveto
	5381.3 3647.5 5906.3 3572.5 7125 3450 curveto
 gs col-1 s gr
 gr
 [] 0 sd
% arrowhead
n 6976 3435 m 7098 3452 l 6982 3495 l  col-1 s
/Courier ff 165.00 scf sf
1275 2400 m
gs 1 -1 sc (MBank) col-1 sh gr
/Courier ff 165.00 scf sf
1200 3975 m
gs 1 -1 sc (PFrame) col-1 sh gr
/Times-Bold ff 180.00 scf sf
4575 3825 m
gs 1 -1 sc (4) col-1 sh gr
/Times-Bold ff 180.00 scf sf
3525 3525 m
gs 1 -1 sc (3) col-1 sh gr
/Times-Bold ff 180.00 scf sf
2700 2025 m
gs 1 -1 sc (2) col-1 sh gr
/Times-Bold ff 180.00 scf sf
150 2025 m
gs 1 -1 sc (1) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 626 2251 a Fz(Figure)27 b(2.5:)36 b(Arc)n(hitecture)27
b(a)n(w)n(areness)e(supp)r(ort:)37 b(Na)n(vigators)25
b(and)j(Insp)r(ectors.)639 2599 y(An)j Fx(Inspector)d
Fz(has)i(t)n(w)n(o)g(main)h(metho)r(ds)g(to)f(lo)r(okup)g(attributes)h
(either)g(b)n(y)f(name)515 2699 y(or)g(b)n(y)i(index.)48
b(A)n(ttribute)33 b(indexes)e(will)h(v)-5 b(ary)30 b(from)h
Fx(0)h Fz(to)f(some)g(arbitrary)e(v)-5 b(alue.)49 b(The)515
2798 y(\014rst)27 b(in)n(v)-5 b(alid)28 b(attribute)f(is)h(guaran)n
(teed)e(to)h(ha)n(v)n(e)g(a)g Fx(NULL)f Fz(name)h(and)h(t)n(yp)r(e.)639
2898 y(T)-7 b(o)29 b(a)n(v)n(oid)f(usage)g(of)i Fx(void)42
b(*)p Fz(,)29 b(users)g(are)f(requested)h(to)g(sp)r(ecify)g(the)h(exp)r
(ected)g(t)n(yp)r(e)515 2998 y(of)35 b(an)h(attribute.)61
b(As)35 b(it)h(is)g(unrealistic)f(to)g(force)g(users)g(to)h(kno)n(w)e
(in)i(adv)-5 b(ance)35 b(whic)n(h)515 3097 y(attributes)29
b(can)h(b)r(e)g(presen)n(t,)f(a)g(metho)r(d)i Fx(nameof)c
Fz(is)i(pro)n(vided)g(to)g(obtain)h(the)g(name)f(of)515
3197 y(a)e(giv)n(en)g(attribute,)h(and)f(a)g(metho)r(d)h
Fx(kindof)d Fz(is)j(pro)n(vided)e(to)i(obtain)f(its)h(t)n(yp)r(e.)515
3330 y Fk(h)p Fj(O\013)f(r)l(esour)l(c)l(e)j(insp)l(e)l(ctor.)f
Fk(i)p Fq(\021)598 3421 y Fi(//)39 b(A)h(resource)h(inspector)598
3512 y(//)598 3604 y(class)f(off_Inspector)i({)598 3695
y(private:)715 3786 y Fk(h)p Fj(Other)29 b(private)g(memb)l(ers)f(of)f
Fi(off)p 1752 3786 24 4 v 29 w(Inspector)p Fj(.)i Fk(i)598
3878 y Fi(protected:)715 3969 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)f Fi(off)p 1795 3969 V 28 w(Inspector)p
Fj(.)h Fk(i)598 4060 y Fi(public:)715 4152 y Fk(h)p Fj(Other)g(public)e
(metho)l(ds)i(of)f Fi(off)p 1694 4152 V 28 w(Inspector)p
Fj(.)h Fk(i)715 4243 y Fi(//)40 b(Returns)80 b(the)40
b(name)g(of)g(an)g(attribute)h(at)f([idx])715 4334 y(virtual)h(const)g
(char)f(*nameof\(natural_t)j(idx\))d(const;)715 4426
y(//)g(Returns)h(the)f(type)g(of)g(an)f(attribute)715
4517 y(virtual)i(off_attr_kind_t)i(kindof\(natural_t)g(idx\))d(const;)
715 4608 y(//)g(Returns)h(the)f(#)f(of)h(attributes.)715
4700 y(virtual)h(natural_t)h(length\(void\))f(const;)715
4882 y(//)f(Look)g(up)g(a)f(boolean)i(attribute)g(by)f(name)g(or)g(by)g
(index)715 4973 y(virtual)h(boolean_t)h(get_bool_attr\(const)h(char)d
(*name\))198 b(const;)1905 5255 y Fz(75)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
76 77 bop 715 523 a Fi(virtual)41 b(boolean_t)h
(get_bool_attr\(natural_t)i(idx\))79 b(const;)715 706
y(//)40 b(Look)g(up)g(a)f(natural)i(attribute)g(by)f(name)g(or)g(by)g
(index)715 797 y(virtual)h(natural_t)h(get_nat_attr\(const)h(char)d
(*name\))237 b(const;)715 888 y(virtual)41 b(natural_t)h
(get_nat_attr\(natural_t)i(idx\))118 b(const;)715 1071
y(//)40 b(Look)g(up)g(a)f(string)i(attribute)g(by)f(name)g(or)g(by)f
(index)715 1162 y(virtual)i(char)f(*get_str_attr\(const)k(char)c
(*name\))394 b(const;)715 1254 y(virtual)41 b(char)f
(*get_str_attr\(natural_t)45 b(idx\))275 b(const;)715
1436 y(//)40 b(Look)g(up)g(an)g(id)f(attribute)j(by)d(name)h(or)g(by)g
(index)715 1528 y(virtual)h(off_id_t)g(get_id_attr\(const)i(char)e
(*name\))79 b(const;)715 1619 y(virtual)41 b(off_id_t)g
(get_id_attr\(natural_t)j(idx\))c(const;)598 1893 y(};)515
2133 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator)f(dep)l
(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 2224 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 2315 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)
639 2444 y Fz(The)c(default)f(implemen)n(tation)h(is)f(to)g(ignore)f
(the)i(argumen)n(ts)e(and)h(return)g(a)g(silly)515 2543
y(v)-5 b(alue,)26 b(so)e(that)i(suc)n(h)f(function)h(could)f(b)r(e)h
(ignored:)35 b(not)25 b(ev)n(ery)g(resource)e(has)i(attributes)515
2643 y(of)k(ev)n(ery)g(t)n(yp)r(e.)43 b(Th)n(us,)30 b(only)g
Fx(nameof)p Fz(,)e Fx(kindof)f Fz(and)i(one)h(of)f(the)i(for)e
(previous)f(pairs)h(of)515 2742 y(metho)r(ds)f(m)n(ust)f(b)r(e)h(pro)n
(vided)f(b)n(y)g(an)n(y)g(sub)r(class.)639 2842 y(The)h(v)-5
b(alid)28 b(attribute)f(t)n(yp)r(es)h(are)515 2952 y
Fk(h)p Fj(O\013)f(attribute)j(typ)l(e)e(ids.)f Fk(i)p
Fq(\021)598 3043 y Fi(//)39 b(Kinds)i(of)e(attribute.)598
3135 y(enum)79 b({)40 b(OFF_NULL_ATTR,//)i(Not)e(an)g(attribute.)912
3226 y(OFF_BOOL_ATTR,//)i(boolean_t)912 3317 y(OFF_NAT_ATTR,)g(//)d
(natural_t)912 3409 y(OFF_STR_ATTR,)j(//)d(char)i(*)e(\(null)h
(terminated\).)912 3500 y(OFF_ID_ATTR)120 b(//)39 b(off_id_t)598
3591 y(};)598 3682 y(typedef)i(int)e(off_attr_kind_t;)639
3892 y Fz(Finally)-7 b(,)28 b(an)n(y)f(resource)f(should)h(ha)n(v)n(e)f
(at)i(least)f(these)h(attributes)f(de\014ned)515 4002
y Fk(h)p Fj(O\013)g(attributes.)i Fk(i)p Fq(\021)598
4093 y Fi(//)39 b(attributes)j(that)e(should)h(be)e(defined)i(by)f
(every)g(system)h(resource.)598 4184 y(//)598 4276 y(enum)f({)f
(OFF_ATTR_NAME,)239 b(//)40 b(Name)g(of)f(this)i(resource)119
b(\(string\))872 4367 y(OFF_ATTR_CLASS,)200 b(//)40 b(Class)g(for)g
(this)g(resource)h(\(string\))872 4458 y(OFF_ATTR_DOM,)278
b(//)40 b(Resource)h(domain)79 b(\(id\))872 4550 y(OFF_ATTR_ID,)317
b(//)40 b(Resource)h(id)e(\(or)h(container)h(id)f(when)g(offset)h(is)f
(0\))872 4641 y(OFF_ATTR_URL,)278 b(//)40 b(URL)f(for)h(the)g(resource)
h(literate)g(source)g(code)1657 4732 y(//)79 b(\(string\))872
4824 y Fk(h)p Fj(Other)29 b(O\013)e(r)l(esour)l(c)l(e)j(attributes.)g
Fk(i)676 4915 y Fi(};)1905 5255 y Fz(76)p eop
PStoPSsaved restore
%%Page: (78,79) 40
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
77 78 bop 639 523 a Fz(Besides,)22 b(those)e(resources)f(represen)n
(ting)g(system)i(serv)n(ers)d(or)i(system)h(services)e(whic)n(h)515
623 y(are)27 b(indep)r(enden)n(t)i(en)n(tities)f(should)g(at)g(least)f
(supp)r(ort)h(this)g(t)n(w)n(o)g(attributes,)g(so)f(that)h(an)515
722 y(automatic)f(con\014guration)f(engine)h(could)g(b)r(e)h(used.)515
839 y Fk(h)p Fj(Other)g(O\013)f(r)l(esour)l(c)l(e)j(attributes.)g
Fk(i)p Fq(\021)598 930 y Fi(OFF_ATTR_PROVIDES,)553 b(//)40
b(Resource)h(provided)80 b(\(string)41 b(w/o)f(blanks\).)598
1021 y(OFF_ATTR_REQUIRES)592 b(//)40 b(Resources)h(required)g
(\(string\))639 1146 y Fz(The)23 b(\014rst)g(one)g(is)f(an)h(iden)n
(ti\014er)g(used)g(to)g(name)f(the)i(resource)d(b)r(eing)i(pro)n
(vided.)34 b(Eac)n(h)515 1245 y(resource)f(pro)n(vider)g(ma)n(y)i(dep)r
(end)g(on)g(other)g(resources)e(to)i(pro)n(vide)f(its)h(service.)58
b(The)515 1345 y(second)31 b(attribute)g(is)h(a)f(string)g(con)n
(taining)g(the)h(iden)n(ti\014ers)f(\(names\))h(of)f(the)h(resources)
515 1445 y(required)26 b(\(separated)h(b)n(y)g(blanks\).)639
1544 y(Na)n(vigators)j(are)h(implemen)n(ted)i(almost)e(b)n(y)h(hand)g
(b)n(y)g(sub)r(classes)f(of)h Fx(Navigators)p Fz(,)515
1644 y(but)23 b(insp)r(ectors)g(are)f(v)n(ery)g(similar)g(one)h(to)g
(another)f(and)h(most)g(of)g(their)g(implemen)n(tation)515
1743 y(is)k(con)n(tained)g(in)h Fx(Inspector)p Fz(.)639
1843 y(An)40 b(insp)r(ector)f(k)n(eeps)f(an)h(arra)n(y)e(of)j
(attributes)f(indexed)g(b)n(y)g(attribute)h(id)f(and)g(a)515
1943 y(p)r(oin)n(ter)27 b(to)g(the)h(resource)e(b)r(eing)i(insp)r
(ected.)515 2059 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2059 24 4 v 29 w(Inspector)p Fj(.)h Fk(i)o
Fq(\021)598 2150 y Fi(off_Resource)42 b(*i_res;)472 b(//)40
b(Resource)h(being)f(inspected)598 2242 y(const)g(off_attr_t)i
(*i_attr;)276 b(//)40 b(Attribute)h(list.)598 2333 y(const)f(natural_t)
81 b(i_nattrs;)237 b(//)40 b(#)f(of)h(attributes.)639
2457 y Fz(A)n(ttributes)28 b(m)n(ust)g(b)r(e)g(an)n(y)f(of)g(these)h
(de\014ned)g(b)r(elo)n(w.)515 2574 y Fk(h)p Fj(O\013)f(attribute)j
(data)e(typ)l(e.)g Fk(i)p Fq(\021)598 2665 y Fi(union)40
b(off_attr_val_t)j({)676 2756 y(boolean_t)e
(\(off_Resource::*b\)\(void\);)676 2848 y(natural_t)g
(\(off_Resource::*n\)\(void\);)676 2939 y(char)197 b
(*\(off_Resource::*s\)\(void\);)676 3030 y(off_id_t)80
b(\(off_Resource::*i\)\(void\);)676 3122 y(off_attr_val_t\(boolean_t)45
b(\(off_Resource::*ab\)\(void\)\))g(:)39 b(b\(ab\))i({};)676
3213 y(off_attr_val_t\(natural_t)k(\(off_Resource::*an\)\(void\)\))g(:)
39 b(n\(an\))i({};)676 3304 y(off_attr_val_t\(char)j
(*\(off_Resource::*as\)\(void\)\))h(:)40 b(s\(as\))g({};)676
3396 y(off_attr_val_t\(off_id_t)45 b(\(off_Resource::*ai\)\(void\)\))g
(:)39 b(i\(ai\))i({};)598 3487 y(};)598 3578 y(struct)f(off_attr_t)i({)
676 3670 y(off_attr_kind_t)h(a_kind;)276 b(//)40 b(kind)g(of)g
(attribute.)676 3761 y(char)433 b(*a_name;)276 b(//)40
b(Attribute)h(name.)676 3852 y(off_attr_val_t)82 b(a_val;)315
b(//)40 b(Ptr.)g(to)g(function)h(giving)f(attribute's)i(value.)598
3944 y(};)639 4068 y Fz(The)35 b(insp)r(ector)f(constructor)f(only)h
(needs)g(to)g(receiv)n(e)g(the)g(attribute)h(arra)n(y)d(and)i(a)515
4168 y(p)r(oin)n(ter)27 b(to)g(the)h(ob)5 b(ject)28 b(b)r(eing)f(insp)r
(ected.)515 4284 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4284 V 29 w(Inspector)p Fj(.)i Fk(i)p Fq(\021)598
4375 y Fi(off_Inspector\(off_Resource)45 b(*r,)40 b(const)g(off_attr_t)
i(*attrs,natural_t)h(nattrs\):)676 4467 y(i_res\(r\),i_attr\(attrs\),)i
(i_nattrs\(nattrs\))598 4558 y({})1905 5255 y Fz(77)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
78 79 bop 639 523 a Fz(Once)27 b(the)h(arra)n(y)e(is)h(set,)h(insp)r
(ector)f(metho)r(ds)h(are)e(straigh)n(tforw)n(ard)f(to)j(implemen)n(t.)
515 656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(Inspector::nameof)j
Fj(implementation.)c Fk(i)p Fq(\021)598 747 y Fi(const)40
b(char)g(*off_Inspector::nameof\(natur)q(al_t)46 b(idx\))40
b(const)598 839 y({)676 1021 y(return)h(\(idx)f(>=)g(i_nattrs\))h(?)e
(\(char*\)NULL)j(:)e(i_attr[idx].a_name;)598 1112 y(})515
1378 y Fk(h)p Fi(off)p 667 1378 V 29 w(Inspector::kindof)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 1469 y Fi(off_attr_kind_t)42
b(off_Inspector::kindof\(natur)q(al_t)k(idx\))40 b(const)598
1561 y({)676 1652 y(return)h(\(idx)f(>=)g(i_nattrs\))h(?)e
(OFF_NULL_ATTR)k(:)c(i_attr[idx].a_kind;)598 1835 y(})515
2100 y Fk(h)p Fi(off)p 667 2100 V 29 w(Inspector::length)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 2192 y Fi(natural_t)41
b(off_Inspector::length\(void\))k(const)598 2283 y({)676
2374 y(return)c(i_nattrs;)598 2466 y(})515 2731 y Fk(h)p
Fi(off)p 667 2731 V 29 w(Inspector::get)p 1242 2731 V
31 w(bool)p 1429 2731 V 29 w(attr)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 2823 y Fi(boolean_t)41 b
(off_Inspector::get_bool_attr\()q(natu)q(ral_t)46 b(idx\))40
b(const)598 2914 y({)676 3005 y(if)g(\(idx)g(<=)g(i_nattrs)h(&&)e
(kindof\(idx\)==OFF_BOOL_ATTR\))755 3097 y(return)h
(\(i_res->*i_attr[idx].a_val.b)q(\)\(\);)676 3188 y(else)755
3279 y(return)g(FALSE;)598 3371 y(})515 3636 y Fk(h)p
Fi(off)p 667 3636 V 29 w(Inspector::get)p 1242 3636 V
31 w(nat)p 1390 3636 V 29 w(attr)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 3728 y Fi(natural_t)41 b
(off_Inspector::get_nat_attr\(n)q(atur)q(al_t)46 b(idx\))40
b(const)598 3819 y({)676 3910 y(if)g(\(idx)g(<=)g(i_nattrs)h(&&)e
(kindof\(idx\)==OFF_NAT_ATTR\))755 4002 y(return)h
(\(i_res->*i_attr[idx].a_val.n)q(\)\(\);)676 4093 y(else)755
4184 y(return)g(0;)598 4276 y(})1905 5255 y Fz(78)p eop
PStoPSsaved restore
%%Page: (80,81) 41
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
79 80 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v 29
w(Inspector::get)p 1242 523 V 31 w(str)p 1390 523 V 29
w(attr)28 b Fj(implementation.)g Fk(i)p Fq(\021)598 614
y Fi(char)40 b(*off_Inspector::get_str_attr\(n)q(atur)q(al_t)46
b(idx\))40 b(const)598 706 y({)676 797 y(if)g(\(idx)g(<=)g(i_nattrs)h
(&&)e(kindof\(idx\)==OFF_STR_ATTR\))755 888 y(return)h
(\(i_res->*i_attr[idx].a_val.s)q(\)\(\);)676 980 y(else)755
1071 y(return)g(NULL;)598 1162 y(})515 1428 y Fk(h)p
Fi(off)p 667 1428 V 29 w(Inspector::get)p 1242 1428 V
31 w(id)p 1351 1428 V 29 w(attr)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1519 y Fi(off_id_t)41 b
(off_Inspector::get_id_attr\(nat)q(ural)q(_t)k(idx\))40
b(const)598 1611 y({)676 1702 y(if)g(\(idx)g(<=)g(i_nattrs)h(&&)e
(kindof\(idx\)==OFF_ID_ATTR\))755 1793 y(return)h
(\(i_res->*i_attr[idx].a_val.i)q(\)\(\);)676 1885 y(else)755
1976 y(return)g(OFF_ID_NULL;)598 2067 y(})639 2300 y
Fz(T)-7 b(o)30 b(implemen)n(t)h(the)g(v)n(ersion)e(of)i(these)f(metho)r
(ds)h(sho)n(wn)e(ab)r(o)n(v)n(e)h(taking)f(a)h(name)h(as)515
2399 y(an)c(argumen)n(t)g(w)n(e)g(rely)g(on)g(this)h(protected)f(metho)
r(d:)515 2516 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)
e Fi(off)p 1594 2516 V 29 w(Inspector)p Fj(.)i Fk(i)p
Fq(\021)598 2607 y Fi(natural_t)41 b(lookup_by_name\(const)j(char)c
(*name\))h(const)f(;)515 2765 y Fk(h)p Fi(off)p 667 2765
V 29 w(Inspector::lookup)p 1359 2765 V 32 w(by)p 1469
2765 V 28 w(name)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
2856 y Fi(natural_t)41 b(off_Inspector::lookup_by_name)q(\(con)q(st)k
(char)40 b(*name\))h(const)598 2947 y({)676 3039 y(natural_t)g(idx;)676
3130 y(assert\(name\);)676 3221 y(for)f(\()g(idx=0;)g(idx)g(<)g
(i_nattrs)h(&&)e(strcmp\(nameof\(idx\),name\))45 b(;)39
b(idx++\))755 3313 y(;)676 3404 y(return)i(idx;)598 3495
y(})1905 5255 y Fz(79)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
80 81 bop 515 523 a Fk(h)p Fj(A)l(c)l(c)l(essors)30 b(by)e(name)g(of)f
Fi(off)p 1409 523 24 4 v 29 w(Inspector)i Fj(implementation.)f
Fk(i)o Fq(\021)598 614 y Fi(boolean_t)41 b
(off_Inspector::get_bool_attr\()q(cons)q(t)k(char)40
b(*name\))h(const)598 706 y({)676 797 y(assert\(name\);)676
888 y(return)g(get_bool_attr\(lookup_by_name\(n)q(ame\))q(\);)598
980 y(})598 1071 y(natural_t)g(off_Inspector::get_nat_attr\(c)q(onst)46
b(char)40 b(*name\))237 b(const)598 1162 y({)676 1254
y(assert\(name\);)676 1345 y(return)41 b
(get_nat_attr\(lookup_by_name\(na)q(me\)\))q(;)598 1436
y(})598 1528 y(char)f(*off_Inspector::get_str_attr\(c)q(onst)46
b(char)40 b(*name\))394 b(const)598 1619 y({)676 1710
y(assert\(name\);)676 1802 y(return)41 b
(get_str_attr\(lookup_by_name\(na)q(me\)\))q(;)598 1893
y(})598 1984 y(off_id_t)g(off_Inspector::get_id_attr\(con)q(st)k(char)
40 b(*name\))80 b(const)598 2076 y({)676 2167 y(assert\(name\);)676
2258 y(return)41 b(get_id_attr\(lookup_by_name\(nam)q(e\)\);)598
2350 y(})515 2615 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator)
f(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 2707 y
Fi(#include)41 b(<assert.h>)512 b(//)40 b(for)g(assert)515
2964 y FA(Na)m(vigation)32 b Fg(C)7 b Fx(++)30 b FA(source)i(\014les)
515 3117 y Fz(Na)n(vigation)26 b(supp)r(ort)h(co)r(de)h(is)f(con)n
(tained)g(in)h Fx(klib/nav.h)23 b Fz(and)28 b Fx(klib/nav.C)p
Fz(.)515 3250 y Fk(h)p Fj(nav.h*)11 b Fk(i)p Fq(\021)598
3341 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3433 y Fi(#ifndef)41
b(__OFF_NAV_H)598 3524 y(#define)g(__OFF_NAV_H)g(1)598
3707 y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator)f(dep)l
(endencies.)g Fk(i)598 3889 y(h)p Fj(O\013)e(attribute)j(typ)l(e)e
(ids.)f Fk(i)598 3981 y(h)p Fj(O\013)g(attributes.)j
Fk(i)598 4072 y(h)p Fj(O\013)d(attribute)j(data)e(typ)l(e.)g
Fk(i)598 4254 y Fi(#ifdef)40 b(__KERNEL__)598 4346 y
Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator.)f
Fk(i)598 4437 y(h)p Fj(O\013)e(r)l(esour)l(c)l(e)j(insp)l(e)l(ctor.)f
Fk(i)598 4528 y Fi(#endif)40 b(//)g(__KERNEL__)598 4711
y Fk(h)p Fj(O\013)27 b(r)l(esour)l(c)l(e)j(navigator)f(late)f(dep)l
(endencies.)h Fk(i)598 4894 y Fi(#endif)40 b(//)g(__OFF_NAV_H)1905
5255 y Fz(80)p eop
PStoPSsaved restore
%%Page: (82,83) 42
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
81 82 bop 515 523 a Fk(h)p Fj(nav.C*)11 b Fk(i)p Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<klib/nav.h>)434
b(//)40 b(Exported)h(interface.)598 980 y Fk(h)p Fi(off)p
750 980 24 4 v 29 w(Inspector::nameof)31 b Fj(implementation.)c
Fk(i)598 1071 y(h)p Fi(off)p 750 1071 V 29 w(Inspector::kindof)k
Fj(implementation.)c Fk(i)598 1162 y(h)p Fi(off)p 750
1162 V 29 w(Inspector::length)k Fj(implementation.)c
Fk(i)598 1254 y(h)p Fi(off)p 750 1254 V 29 w(Inspector::get)p
1325 1254 V 31 w(bool)p 1512 1254 V 29 w(attr)h Fj(implementation.)g
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(Inspector::get)p
1325 1345 V 31 w(nat)p 1473 1345 V 29 w(attr)g Fj(implementation.)g
Fk(i)598 1436 y(h)p Fi(off)p 750 1436 V 29 w(Inspector::get)p
1325 1436 V 31 w(str)p 1473 1436 V 29 w(attr)g Fj(implementation.)g
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(Inspector::get)p
1325 1528 V 31 w(id)p 1434 1528 V 29 w(attr)g Fj(implementation.)g
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(Inspector::lookup)p
1442 1619 V 32 w(by)p 1552 1619 V 28 w(name)h Fj(implementation.)e
Fk(i)598 1710 y(h)p Fj(A)l(c)l(c)l(essors)j(by)e(name)g(of)f
Fi(off)p 1492 1710 V 29 w(Inspector)i Fj(implementation.)f
Fk(i)515 2059 y FA(Naming)i(the)h(source)h(co)s(de)515
2212 y Fy(O\013)17 b Fx(++)25 b Fz(kno)n(ws)f(what)i(is)g(the)g(URL)g
(for)f(the)h(source)e(co)r(de)i(of)g(ev)n(ery)e(resource)g(it)i(con)n
(tains.)515 2312 y(As)39 b(w)n(e)g(will)h(see,)i(eac)n(h)c(no)r(de)i
(has)e(a)h(base)g(URL)h(and)f(eac)n(h)f(resource)g(has)h(to)g(de\014ne)
515 2411 y(its)c(relativ)n(e)f(URL)i(with)f(resp)r(ect)g(to)h(that)f
(base.)59 b(These)35 b(relativ)n(e)f(URLs)h(are)g(k)n(ept)g(in)515
2511 y Fx(klib/url.h)p Fz(.)515 2644 y Fk(h)p Fj(url.h*)11
b Fk(i)p Fq(\021)598 2735 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2826 y Fi(#ifndef)41 b(__OFF_URL_H)598 2918 y(#define)g(__OFF_URL_H)g
(1)598 3009 y Fk(h)p Fj(O\013)27 b(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e
Fk(i)598 3100 y Fi(#endif)40 b(//)g(__OFF_URL_H)515 3466
y Fn(2.4.7)112 b(Resource)38 b(Allo)s(cators)515 3619
y Fz(Allo)r(cators)25 b(implemen)n(t)j(resource)c(unit)k(allo)r(cation)
d(and)i(are)f(resp)r(onsible)g(for)g(initiating)515 3719
y(resource)g(rev)n(o)r(cation)f(when)j(no)f(more)g(resource)f(units)i
(are)f(a)n(v)-5 b(ailable.)515 3851 y Fk(h)p Fj(O\013)27
b(al)t(lo)l(c)l(ator.)h Fk(i)p Fq(\021)598 3943 y Fi(//)39
b(A)h(resource)h(allocator.)598 4034 y(//)598 4125 y(class)f
(off_Allocator)i({)598 4217 y(protected:)676 4308 y Fk(h)p
Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 4308 V 29 w(Allocator)p Fj(.)i Fk(i)598
4399 y Fi(public:)676 4491 y Fk(h)p Fj(Other)g(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 4491 V 29 w(Allocator)p Fj(.)i Fk(i)598
4582 y Fi(};)1905 5255 y Fz(81)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
82 83 bop 639 523 a Fz(W)-7 b(e)23 b(could)e(ha)n(v)n(e)g(de\014ned)i
(a)e(resource)f(allo)r(cation)h(in)n(terface)h(at)f(this)i(p)r(oin)n
(t,)g(but)g(doing)515 623 y(so)j(w)n(ould)h(mean)f(that)h(explicit)h(t)
n(yp)r(e)f(casts)f(\(prone)h(to)f(errors\))f(w)n(ould)i(b)r(e)g
(necessary)e(on)515 722 y(eac)n(h)j(resource)f(allo)r(cation.)39
b(Instead,)29 b(what)g(w)n(e)f(do)h(is)f(to)h(build)g(a)g(hierarc)n(h)n
(y)d(using)j(the)515 822 y Fx(Allocator)d Fz(class)j(as)g(a)g(base.)43
b(That)30 b(hierarc)n(h)n(y)d(uses)j(a)f Fx(void)f Fz(p)r(oin)n(ter)i
(based)f(resource)515 922 y(allo)r(cation)j(in)n(terface)g(whic)n(h)h
(is)g(wrapp)r(ed)g(b)n(y)g(t)n(yp)r(e-safe)f(in)n(terfaces.)53
b(In)33 b(that)h(w)n(a)n(y)d(w)n(e)515 1021 y(a)n(v)n(oid)f(co)r(de)i
(duplication)g(\(due)g(to)g(template)h(instan)n(tiations\),)f(dynamic)g
(binding)g(and)515 1121 y(t)n(yp)r(e)c(information)e(loss.)515
1337 y FA(Resource)31 b(allo)s(cator)h Fg(C)7 b Fx(++)30
b FA(source)i(\014les)515 1490 y Fz(The)27 b(allo)r(cator)f
(de\014nition)i(is)g(k)n(ept)f(in)h Fx(klib/Allocator.h)o
Fz(.)515 1623 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 1714 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1805 y Fi(#ifndef)41 b(__OFF_ALLOCATOR_H)598 1897 y(#define)g
(__OFF_ALLOCATOR_H)i(1)598 2171 y(#ifdef)d(__KERNEL__)598
2262 y Fk(h)p Fj(O\013)27 b(al)t(lo)l(c)l(ator)i(data)f(typ)l(es.)h
Fk(i)598 2353 y(h)p Fj(O\013)e(al)t(lo)l(c)l(ator.)h
Fk(i)598 2445 y Fi(#endif)40 b(//)g(__KERNEL__)598 2627
y(#endif)g(//)g(__OFF_ALLOCATOR_H)515 2992 y Fn(2.4.8)112
b(Resource)38 b(rev)m(o)s(cation)515 3146 y Fz(Resources)g(are)g(not)i
(rev)n(ok)n(ed)d(b)n(y)i(the)h Fy(O\013)17 b Fx(++)39
b Fw(\026)p Fz(k)n(ernel.)71 b(Instead,)42 b(an)e Fx(UNAVAILABLE)515
3245 y Fz(exception)24 b(is)h(raised)f(for)h(the)g(resource)e
(exhausted;)j(so)e(that)i(users)e(could)g(run)h(whatev)n(er)515
3345 y(algorithm)h(is)i(needed)f(to)h(mak)n(e)f(more)f(units)i(of)g
(the)g(resource)e(b)r(eing)h(exhausted.)639 3445 y(The)39
b(exception)g(trigger)f(is)h(the)g(allo)r(cator)e(b)r(eing)j(used.)71
b(System)39 b(allo)r(cators)e(are)515 3544 y(pro)n(vided)26
b(with)i(an)g Fx(Exhausted)c Fz(ob)5 b(ject)27 b(at)g(instan)n(tiation)
h(time)g(for)f(that)h(purp)r(ose.)515 3660 y Fk(h)p Fj(Other)g(pr)l
(ote)l(cte)l(d)j(memb)l(ers)d(of)f Fi(off)p 1616 3660
24 4 v 29 w(Allocator)p Fj(.)i Fk(i)p Fq(\021)598 3752
y Fi(off_Exhausted)42 b(*a_revocator;)160 b(//)79 b(Resource)41
b(revocator.)515 3910 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3910 V 29 w(Allocator)p Fj(.)i Fk(i)p Fq(\021)598
4001 y Fi(//)39 b(Creates)i(an)f(allocator.)598 4092
y(off_Allocator\(off_Exhausted)45 b(*r\))79 b
({\(void\)\(a_revocator=r\);})639 4233 y Fz(The)28 b
Fx(Exhausted)c Fz(data)j(t)n(yp)r(e)h(is)f(included)h(together)f(with)h
(the)g(allo)r(cator)e(co)r(de.)515 4350 y Fk(h)p Fj(O\013)h(al)t(lo)l
(c)l(ator)i(data)f(typ)l(es.)h Fk(i)p Fq(\021)598 4441
y Fk(h)p Fj(O\013)e(Exhauste)l(d)j(r)l(esour)l(c)l(e)g(r)l(evo)l(c)l
(ation)f(trigger.)g Fk(i)1905 5255 y Fz(82)p eop
PStoPSsaved restore
%%Page: (84,85) 43
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
83 84 bop 639 523 a Fz(The)39 b Fx(Exhausted)34 b Fz(ob)5
b(ject)39 b(pro)n(vides)d(a)i(single)g(metho)r(d)h Fx(notify)d
Fz(to)i(let)h(allo)r(cators)515 623 y(trigger)26 b(the)i(prop)r(er)e
(action)h(\(b)n(y)h(default,)g(to)g(raise)e(an)h Fx(UNAVAILABLE)c
Fz(exception\).)515 756 y Fk(h)p Fj(O\013)k(Exhauste)l(d)j(r)l(esour)l
(c)l(e)g(r)l(evo)l(c)l(ation)f(trigger.)g Fk(i)p Fq(\021)598
847 y Fi(//)39 b(Resource)i(revocator.)598 938 y(//)598
1029 y(signature)g(off_Exhausted)h({)598 1121 y(//)d(NB:)h(A)g
(signature)h(always)g(has)f(public)g(access.)715 1303
y(//)g(Notify)h(that)f(resource)h(is)f(exhausted)715
1395 y(void)h(notify\(void\);)598 1486 y(};)639 1810
y Fz(Allo)r(cators)27 b(pro)n(vide)f(an)h Fx(exhausted)d
Fz(metho)r(d)k(whic)n(h)g(relies)f(on)g Fx(notify)p Fz(.)515
1926 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1926 24 4 v 29 w(Allocator)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 2017 y Fi(//)39 b(This)i(resource)g(is)e(exhausted.)j
(Trigger)f(appropriate)g(actions.)598 2109 y(void)f(exhausted\(void\){)
j(\(void\)a_revocator->notify\(\);)i(})639 2325 y Fz(Consider)33
b(again)f(the)i Fx(a)p 1417 2325 27 4 v 31 w(revocator)c
Fz(mem)n(b)r(er)j(in)h Fx(Allocator)p Fz(.)50 b(There)33
b(is)h(a)f(single)515 2424 y(w)n(a)n(y)e(to)h(initialize)g(it:)47
b(passing)32 b(an)g(argumen)n(t)f(to)h(the)h Fx(Allocator)28
b Fz(constructor.)50 b(This)515 2524 y(will)28 b(also)e(happ)r(en)i
(with)g(other)f(mem)n(b)r(ers)g(of)h Fx(Allocator)c Fz(sub)r(classes.)
639 2623 y(Ho)n(w)n(ev)n(er,)37 b(sometimes)g(it)g(is)g(useful)g(to)g
(declare)e(an)i Fx(Allocator)c Fz(and)k(initialize)g(it)515
2723 y(later)23 b(on)g(\(eg.)35 b(to)24 b(reserv)n(e)d(enough)i(space)g
(for)g(a)g(mem)n(b)r(er)h(of)g(t)n(yp)r(e)f Fx(Allocator)p
Fz(\).)32 b(W)-7 b(e)24 b(can)515 2823 y(do)31 b(it)g(b)n(y)g(using)g
(a)g(cop)n(y)f(op)r(erator)g(and)h(de\014ning)g(another)f(\(empt)n(y\))
i(constructor.)47 b(W)-7 b(e)515 2922 y(will)28 b(b)r(e)g(doing)f(the)h
(same)f(with)h(sub)r(classes)e(of)i Fx(Allocator)p Fz(.)515
3055 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3055 24 4 v 29 w(Allocator)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 3147 y Fi(//)39 b(Allows)i(declarations)h(of)e
(uninitialized)i(allocators.)598 3238 y(off_Allocator\(void\))h({;})515
3504 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3504 V 29 w(Allocator)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 3595 y Fi(off_Allocator&operator=\(off_Al)q(locat)q(or&o)q
(ther)q(\){)676 3686 y(\(void\)\(a_revocator=other.a_r)q(evoca)q(tor\))
q(;)676 3778 y(return)80 b(*this;)598 3869 y(})1905 5255
y Fz(83)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
84 85 bop 639 523 a Fz(It)30 b(should)g(b)r(e)g(clear)e(that)i(no)f
(allo)r(cator)f(can)h(b)r(e)h(used)g(b)r(efore)f(initialized)h(either)f
(b)n(y)515 623 y(calling)e(its)g(\014rst)h(constructor)e(or)h(b)n(y)g
(cop)n(ying)f(on)i(it)g(an)f(allo)r(cator)f(already)g(initialized.)515
854 y Fn(2.4.9)112 b(Allo)s(cation)35 b(statistics)515
1007 y Fz(Statistics)19 b(are)g(main)n(tained)g(b)n(y)g(b)r(o)r(okk)n
(eeping)g(allo)r(cators)e(\()p Fx(BKAllocators)p Fz(\).)30
b(Ev)n(ery)18 b(sys-)515 1107 y(tem)j(allo)r(cator)d(will)j(inherit)f
(from)g(this)h(class.)33 b(Concrete)20 b(c)n(hildren)g(m)n(ust)g(also)f
(implemen)n(t)515 1206 y(the)28 b(resource)e(allo)r(cation)g(in)n
(terface.)639 1306 y(Note)21 b(ho)n(w)e(lo)r(c)n(king)h(facilities)g
(are)g(missing.)34 b(The)20 b(resource)f(con)n(taining)g(the)i(allo)r
(cator)515 1406 y(should)27 b(use)h(its)f(o)n(wn)g(lo)r(c)n(king)g
(facilities)h(for)f(concurrency)f(con)n(trol.)515 1536
y Fk(h)p Fj(O\013)h(b)l(o)l(okke)l(eping)j(al)t(lo)l(c)l(ator.)e
Fk(i)p Fq(\021)598 1627 y Fi(//)39 b(A)h(Bookkeeping)i(allocator.)598
1719 y(//)598 1810 y(class)e(off_BKAllocator)j(:)c(public)i
(off_Allocator)h({)598 1901 y(private:)676 1993 y(natural_t)f
(b_ntotal;)395 b(//)79 b(#)39 b(of)h(nodes)g(in)g(the)g(allocator.)676
2084 y(natural_t)h(b_nfree;)434 b(//)79 b(#)39 b(of)h(free)g(nodes)676
2175 y(natural_t)h(b_nalloc;)395 b(//)79 b(#)39 b(of)h(allocated)h
(nodes)676 2267 y(natural_t)g(b_maxalloc;)317 b(//)79
b(Maximum)41 b(#)e(of)h(ever)g(allocated)h(nodes)676
2358 y(natural_t)g(b_nallocrq;)317 b(//)79 b(#)39 b(of)h(alloc)g
(requests)676 2449 y(natural_t)h(b_nfreerq;)356 b(//)79
b(#)39 b(of)h(free)g(requests)598 2540 y(protected:)676
2632 y(//)g(Reset)g(the)g(number)h(of)e(free)i(nodes.)676
2723 y(void)f(resize\(natural_t)j(l\))d({)755 2814 y(b_nfree)g(+=)g(l;)
755 2906 y(b_ntotal+=)h(l;)755 2997 y(assert\()f(b_ntotal)i(==)d
(b_nalloc)i(+)f(b_nfree\);)676 3088 y(})676 3180 y(//)g(Allocator)h
(bookkeeping)h(methods.)676 3271 y(void)e(allocate\(void\);)676
3362 y(void)g(deallocate\(void\);)598 3545 y(public:)676
3636 y(//)g(Allows)g(declarations)i(of)e(uninitialized)i(bookkeeping)g
(allocators.)676 3728 y(off_BKAllocator\(void\){;})676
3910 y(//)e(Initialize)h(statistics)676 4002 y
(off_BKAllocator\(off_Exhauste)q(d)k(*r,)40 b(natural_t)h(size=0\):)755
4093 y(off_Allocator\(r\))676 4184 y({)794 4276 y
(b_nalloc=b_maxalloc=b_nallocrq)q(=b_n)q(free)q(rq=0;)794
4367 y(b_ntotal=b_nfree=size;)794 4458 y(assert\()g(b_ntotal)g(==)e
(b_nalloc)i(+)f(b_nfree\);)676 4550 y(})676 4732 y(//)g(Get)g(some)g
(statistics)676 4824 y(inline)h(natural_t)g(get_nfree\(void\))i(const)d
({return)h(b_nfree;})676 4915 y(inline)g(natural_t)g
(get_nalloc\(void\))i(const)d({return)h(b_nalloc;})676
5006 y(inline)g(natural_t)g(get_maxalloc\(void\))i(const)e({return)g
(b_maxalloc;})1905 5255 y Fz(84)p eop
PStoPSsaved restore
%%Page: (86,87) 44
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
85 86 bop 676 523 a Fi(inline)41 b(natural_t)g(get_num_allocrq\(void\))
j(const)c({return)h(b_nallocrq;})676 614 y(inline)g(natural_t)g
(get_num_freerq\(void\))j(const)c({return)h(b_nfreerq;})676
706 y(inline)g(natural_t)g(get_length\(void\))i(const)d({return)h
(b_ntotal;})598 980 y(};)515 1245 y Fk(h)p Fj(O\013)27
b(b)l(o)l(okke)l(eping)j(al)t(lo)l(c)l(ator)e(dep)l(endencies.)h
Fk(i)p Fq(\021)598 1337 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 1428 y(#include)h(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
1519 y(#include)h(<klib/Allocator.h>)200 b(//)40 b(for)g(off_Allocator)
515 1694 y Fk(h)p Fi(off)p 667 1694 24 4 v 29 w(BKAllocator::allocate)
32 b Fj(and)c Fi(deallocate)h Fj(implementation.)f Fk(i)p
Fq(\021)598 1785 y Fi(//)39 b(Allocator)j(bookkeeping)f(methods.)598
1876 y(void)f(off_BKAllocator::allocate\(void)q(\))598
1968 y({)676 2059 y(b_nfree--;)i(b_nalloc++;)f(b_nallocrq++;)676
2150 y(if)f(\(b_maxalloc)i(<)d(b_nalloc\))755 2242 y(b_maxalloc)i(=)f
(b_nalloc;)676 2333 y(assert\()h(b_ntotal)g(==)f(b_nalloc)h(+)e
(b_nfree\);)598 2424 y(})598 2516 y(void)h
(off_BKAllocator::deallocate\(vo)q(id\))598 2607 y({)676
2698 y(b_nfree++;)i(b_nalloc--;)f(b_nfreerq++;)676 2790
y(assert\()g(b_ntotal)g(==)f(b_nalloc)h(+)e(b_nfree\);)598
2881 y(})515 3229 y FA(Allo)s(cation)30 b(statistics)i
Fg(C)7 b Fx(++)30 b FA(source)i(\014les)515 3383 y Fz(The)18
b(b)r(o)r(okk)n(eeping)f(allo)r(cator)g(is)h(de\014ned)h(in)g
Fx(klib/BKAllocato)o(r.h)12 b Fz(and)18 b Fx(klib/BKAllocator)o(.C)o
Fz(.)515 3516 y Fk(h)p Fj(BKA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)p Fq(\021)598 3607 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3698 y Fi(#ifndef)41 b(__OFF_BK_ALLOCATOR_H)598 3790
y(#define)g(__OFF_BK_ALLOCATOR_H)i(1)598 3972 y Fk(h)p
Fj(O\013)27 b(b)l(o)l(okke)l(eping)j(al)t(lo)l(c)l(ator)e(dep)l
(endencies.)h Fk(i)598 4064 y Fi(#ifdef)40 b(__KERNEL__)598
4155 y Fk(h)p Fj(O\013)27 b(b)l(o)l(okke)l(eping)j(al)t(lo)l(c)l(ator.)
e Fk(i)598 4246 y Fi(#endif)40 b(//)g(__KERNEL__)598
4429 y(#endif)g(//)g(__OFF_BK_ALLOCATOR_H)1905 5255 y
Fz(85)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
86 87 bop 515 523 a Fk(h)p Fj(BKA)n(l)t(lo)l(c)l(ator.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<klib/BKAllocator.h>)122 b(//)40 b(Exported)h
(interface.)598 980 y Fk(h)p Fi(off)p 750 980 24 4 v
29 w(BKAllocator::allocate)32 b Fj(and)c Fi(deallocate)h
Fj(implementation.)f Fk(i)515 1345 y Fn(2.4.10)112 b(Allo)s(cators)36
b(used)i(in)f(the)g(k)m(ernel)515 1498 y FA(A)32 b(ra)m(w)h(allo)s
(cator)515 1651 y Fz(T)-7 b(o)33 b(pro)n(vide)f(a)h(uniform)h(in)n
(terface)f(to)g(allo)r(cation)g(without)h(dynamic)f(binding)h(w)n(e)f
(use)515 1751 y(indexers.)45 b(They)30 b(are)g(simply)g(arra)n(ys)e(in)
n(terfacing)i(with)h(the)g(outside)f(w)n(orld)f(b)n(y)i(means)515
1851 y(of)c Fx(void)e Fz(p)r(oin)n(ters.)37 b(Their)26
b(use)h(is)g(safe)g(b)r(ecause)g(they)g(are)f(later)h(wrapp)r(ed)g(b)n
(y)g(t)n(yp)r(e-safe)515 1950 y(in)n(terfaces.)515 2083
y Fk(h)p Fj(O\013)g(indexer.)h Fk(i)p Fq(\021)598 2174
y Fi(template)41 b(<class)f(T>)598 2266 y(class)g(off_Indexer)i({)598
2357 y(public:)676 2540 y(void)e(*add\(const)i(void)e(*p,)g(int)g(i\))f
(const)i({)e(return)i(\(void*\)\(\(T*\)p+i\);)i(})676
2631 y(void)d(*sub\(const)i(void)e(*p,)g(int)g(i\))f(const)i({)e
(return)i(\(void*\)\(\(T*\)p-i\);)i(})676 2722 y(natural_t)e
(sub\(const)h(void)79 b(*p,)40 b(const)g(void)80 b(*q\))40
b(const{)755 2814 y(return)g(\(T*\)p)h(-)e(\(T*\)q;)676
2905 y(})676 2996 y(natural_t)i(sub_unaligned\(const)j(void)c(*p,)g
(const)g(void)h(*q\))e(const)i({)755 3088 y(return)f(\(\(char*\)p)i(-)d
(\(char*\)q\)/sizeof\(T\);)676 3179 y(})676 3270 y(void)h(*inc\(void)i
(*&p\))314 b(const)41 b({)e(return)i(p=\(void*\)\(\(T*\)p+1\);)i(})676
3362 y(void)d(*dec\(void)i(*&p\))314 b(const)41 b({)e(return)i
(p=\(void*\)\(\(T*\)p-1\);)i(})676 3544 y(size_t)e(sz\(void\))433
b(const)40 b({)g(return)h(sizeof\(T\);)g(})598 3727 y(};)515
3901 y Fk(h)p Fj(O\013)27 b(indexer)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 3993 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)1905
5255 y Fz(86)p eop
PStoPSsaved restore
%%Page: (88,89) 45
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
87 88 bop 639 523 a Fz(Allo)r(cator)18 b(users)f(will)i(access)e(to)h
Fx(Indexer)e Fz(instan)n(tiations)h(b)n(y)h(means)g(of)h(the)f
Fx(Indexable)515 623 y Fz(in)n(terface.)515 756 y Fk(h)p
Fj(O\013)27 b(indexable.)h Fk(i)p Fq(\021)598 847 y Fi(signature)41
b(off_Indexable)h({)676 938 y(void)e(*add\(const)i(void)79
b(*p,)40 b(int)g(i\))g(const;)676 1029 y(void)g(*sub\(const)i(void)79
b(*p,)40 b(int)g(i\))g(const;)676 1121 y(natural_t)h(sub\(const)h(void)
e(*p,)g(const)g(void)g(*q\))g(const;)676 1212 y(natural_t)h
(sub_unaligned\(const)j(void)c(*p,)g(const)g(void)h(*q\))e(const;)676
1303 y(void)h(*inc\(void)i(*&p\))275 b(const;)676 1395
y(void)40 b(*dec\(void)i(*&p\))275 b(const;)676 1486
y(size_t)41 b(sz\(void\))433 b(const;)598 1577 y(};)515
1926 y FA(The)32 b(basic)g(k)m(ernel)g(allo)s(cator)515
2079 y Fz(Ev)n(ery)c(k)n(ernel)g(allo)r(cator)g(uses)i(an)f
Fx(Indexable)d Fz(as)j(the)h(means)f(for)g(resource)f(allo)r(cation)515
2179 y(and)f(pro)n(vides)f(statistics)i(b)n(y)f(deriving)g(from)g
Fx(BKAllocator)p Fz(.)515 2312 y Fk(h)p Fj(O\013)g(b)l(asic)h(kernel)g
(al)t(lo)l(c)l(ator.)h Fk(i)p Fq(\021)598 2403 y Fi(class)40
b(off_KernAllocator)j(:)d(public)g(off_BKAllocator)j({)598
2494 y(protected:)676 2586 y(const)e(off_Indexable)h(*k_idx;)119
b(//)40 b(Resource)h(indexer.)676 2677 y(void)393 b(*k_first;)277
b(//)40 b(First)g(resource)h(unit.)676 2768 y(void)393
b(*k_last;)316 b(//)40 b(Last)g(resource)h(unit.)598
2860 y(public:)676 2951 y(//)f(To)g(declare)g(uninitialized)j
(allocators.)676 3042 y(off_KernAllocator\(void\){;})676
3225 y(//)d(To)g(copy)g(them)676 3316 y(off_KernAllocator)j
(&operator=\(off_KernAllocator)j(&other\){)755 3408 y
(*\(off_BKAllocator*\)this=other;)755 3499 y
(\(void\)\(k_idx=other.k_idx\);)755 3590 y(k_first=other.k_first;)755
3682 y(k_last=other.k_last;)755 3773 y(return)40 b(*this;)676
3864 y(})676 4138 y(//)g(Creates)h(a)e(basic)i(kernel)f(allocator.)676
4230 y(off_KernAllocator\(off_Exhaus)q(ted)45 b(*r,)40
b(const)h(off_Indexable)h(*idx,)1382 4321 y(void)e(*first,)h(natural_t)
h(len\))e(:)755 4412 y(off_BKAllocator\(r,len\),)755
4504 y(k_first\(first\),)i(k_last\(idx->add\(first,len\)\))676
4595 y({)e(\(void\)\(k_idx=idx\);)82 b(})676 4778 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
4778 24 4 v 29 w(KernAllocator)p Fj(.)j Fk(i)598 4869
y Fi(};)1905 5255 y Fz(87)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
88 89 bop 515 523 a Fk(h)p Fj(O\013)27 b(b)l(asic)h(kernel)g(al)t(lo)l
(c)l(ator)h(dep)l(endencies.)g Fk(i)p Fq(\021)598 614
y Fi(#include)41 b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 706 y(#include)h(<klib/BKAllocator.h>)122
b(//)40 b(for)g(off_BKAllocator)598 797 y(#include)h(<klib/Indexer.h>)
278 b(//)40 b(for)g(off_Indexable)639 938 y Fz(Some)28
b(simple)f(metho)r(ds)h(are)f(pro)n(vide)f(as)h(a)g(supp)r(ort)h(for)f
(p)r(oin)n(ter)g(arithmetic.)515 1054 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1054 24 4 v 29 w(KernAllocator)p
Fj(.)j Fk(i)p Fq(\021)598 1146 y Fi(void)40 b(*operator+\(natural_t)k
(at\))c(const;)598 1237 y(natural_t)h(pos\(const)g(void*p\))g(const;)
515 1395 y Fk(h)p Fi(off)p 667 1395 V 29 w(KernAllocator::operator+)32
b Fj(and)c Fi(operator-)i Fj(implementation.)d Fk(i)p
Fq(\021)598 1486 y Fi(void)40 b(*off_KernAllocator::operator+\()q(natu)
q(ral_)q(t)45 b(at\))40 b(const)637 1577 y({)676 1669
y(return)h(k_idx->add\(k_first,at\);)598 1760 y(})598
1851 y(natural_t)g(off_KernAllocator::pos\(const)46 b(void*p\))40
b(const)598 1943 y({)676 2034 y(assert\(ptr_valid\(p\)\);)676
2125 y(return)h(k_idx->sub\(p,k_first\);)598 2217 y(})639
2358 y Fz(Besides,)27 b(an)n(y)g(p)r(oin)n(ter)g(giv)n(en)g(to)h(the)g
(user)f(m)n(ust)g(b)r(e)h(in)g(that)g(range.)515 2474
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2474 V 29 w(KernAllocator)p Fj(.)j Fk(i)p Fz(+)o
Fq(\021)598 2565 y Fi(boolean_t)41 b(ptr_valid\(const)i(void)d(*p\))g
(const)g({)676 2657 y(return)80 b(k_first)41 b(<=)f(p)f(&&)h(p)f(<=)h
(k_last;)598 2748 y(})1905 5255 y Fz(88)p eop
PStoPSsaved restore
%%Page: (90,91) 46
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
89 90 bop 515 523 a FA(The)32 b(bitmap)e(allo)s(cator)515
676 y Fz(The)39 b Fx(BmAllocator)34 b Fz(has)39 b(a)f(bitmap)h(to)g
(main)n(tain)g(resource)e(unit)i(allo)r(cation)f(status.)515
776 y(Resource)26 b(units)i(are)f(then)h(tak)n(en)f(from)g(a)g(simple)h
(arra)n(y)d(con)n(tained)i(in)h(the)g(allo)r(cator.)515
909 y Fk(h)p Fj(O\013)f(bitmap)h(al)t(lo)l(c)l(ator.)g
Fk(i)p Fq(\021)598 1000 y Fi(//)39 b(A)h(bitmap)g(based)h(allocator.)
598 1091 y(//)598 1183 y(class)f(off_BmAllocator)j(:)c(public)i
(off_KernAllocator)i({)598 1274 y(private:)676 1365 y(Bitmap)e(b_map;)
668 b(//)40 b(TRUE)g(allocated/)h(FALSE)g(free)598 1457
y(public:)676 1548 y(//)f(To)g(declare)g(uninitialized)j(allocators.)
676 1639 y(off_BmAllocator\(natural_t)i(len\))40 b(:)g(b_map\(len\))h
({;})676 1822 y(//)f(Creates)h(a)e(bitmap)i(allocator.)676
1913 y(off_BmAllocator\(off_Exhauste)q(d)k(*r,)40 b(const)g
(off_Indexable)i(*idx,)990 2005 y(void)e(*first,)80 b(natural_t)41
b(len\))g(:)755 2096 y(off_KernAllocator\(r,idx,first,l)q(en\),)755
2187 y(b_map\(len\))637 2279 y({)e(do_debug\(putchar\('b'\)\);)45
b(})676 2461 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2461 24 4 v 29 w(BmAllocator)p Fj(.)j Fk(i)598
2644 y Fi(};)515 2910 y Fk(h)p Fj(O\013)d(bitmap)h(al)t(lo)l(c)l(ator)g
(dep)l(endencies.)i Fk(i)p Fq(\021)598 3001 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 3092 y(#include)h(<klib/mdep/debug.h>)161 b(//)40
b(for)g(do_debug)h(et)e(al.)598 3184 y(#include)i(<klib/bmap.h>)395
b(//)40 b(for)g(Bitmap)598 3275 y(#include)h(<klib/KernAllocator.h>)j
(//)c(for)g(off_KernAllocator)598 3366 y(#include)h(<klib/Indexer.h>)
278 b(//)40 b(for)g(off_Indexable)639 3507 y Fz(The)31
b(bitmap)h(allo)r(cator)d(pro)n(vides)h(allo)r(cation)g(of)h(pre-sp)r
(eci\014ed)g(resource)e(units.)48 b(If)515 3607 y(an)n(y)40
b(resource)f(unit)i(\(i.e.)78 b(not)40 b(an)h(sp)r(eci\014c)g(one\))g
(su\016ces)f(to)h(satisfy)g(an)f(allo)r(cation)515 3707
y(request,)27 b(an)g(allo)r(cator)f(with)i(a)f(free-list)g(is)h(b)r
(etter)g(\(see)f(the)h(next)g(section\).)515 3823 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3823
V 29 w(BmAllocator)p Fj(.)i Fk(i)p Fq(\021)598 3914 y
Fi(//)39 b(Allocate)i(\(deallocate\))h(units.)598 4005
y(//)d(Return)i(NULL)f(when)g(allocation)i(failed.)598
4097 y(void)e(*allocate\(natural_t)j(at\);)598 4188 y(void)79
b(deallocate\(void)43 b(*p\);)598 4279 y(void)79 b
(deallocate\(natural_t)44 b(at\);)1905 5255 y Fz(89)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
90 91 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v 29
w(BmAllocator::allocate)32 b Fj(and)c Fi(deallocate)h
Fj(implementation.)f Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Allocates)j(units.)598 706 y(//)d(Return)i(NULL)f(when)g(allocation)i
(failed.)598 797 y(void)e(*off_BmAllocator::allocate\(nat)q(ural)q(_t)
45 b(at\))598 888 y({)676 1071 y(if)40 b(\(b_map.get_bit\(at\)\))755
1162 y(return)g(NULL;)676 1254 y(else)g({)755 1345 y
(off_BKAllocator::allocate\(\);)755 1436 y
(assert\(!b_map.get_bit\(at\)\);)755 1528 y(b_map.set_bit\(at\);)755
1619 y(return)g(k_idx->add\(k_first,at\);)676 1710 y(})598
1802 y(})598 1984 y(//)f(Deallocates)j(units.)598 2076
y(void)79 b(off_BmAllocator::deallocate\(v)q(oid)46 b(*p\))598
2167 y({)676 2258 y(natural_t)41 b(pos=k_idx->sub\(p,k_first\);)676
2350 y(assert\(ptr_valid\(p\)\);)676 2441 y
(off_BKAllocator::deallocate\()q(\);)676 2532 y
(assert\(b_map.get_bit\(pos\)\);)676 2623 y(b_map.clr_bit\(pos\);)598
2715 y(})598 2897 y(//)e(Deallocates)j(units.)598 2989
y(void)79 b(off_BmAllocator::deallocate\(n)q(atur)q(al_t)46
b(at\))598 3080 y({)676 3263 y(off_BKAllocator::deallocate\()q(\);)676
3354 y(assert\(b_map.get_bit\(at\)\);)676 3445 y(b_map.clr_bit\(at\);)
598 3537 y(})515 3802 y Fk(h)p Fj(O\013)27 b(bitmap)h(al)t(lo)l(c)l
(ator)g(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
3894 y Fi(#include)41 b(<assert.h>)512 b(//)40 b(for)g(assert)1905
5255 y Fz(90)p eop
PStoPSsaved restore
%%Page: (92,93) 47
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
91 92 bop 639 523 a Fz(When)29 b(a)g(t)n(yp)r(e-safe)f(bitmap)h(allo)r
(cator)e(is)h(needed)h(this)g(template)g(can)f(b)r(e)h(instan)n(ti-)515
623 y(ated.)36 b(All)25 b(instances)f(will)h(share)f(a)h(single)f(cop)n
(y)g(of)h(the)g(real)f(bitmap)h(op)r(erator,)f(though.)515
722 y(Note)j(ho)n(w)g(it)h(simply)g(wraps)f(bitmap)h(metho)r(ds)f(to)h
(pro)n(vide)e(t)n(yp)r(e-safe)h(op)r(erations.)515 855
y Fk(h)p Fj(O\013)g(typ)l(e)i(safe)e(bitmap)h(al)t(lo)l(c)l(ator.)h
Fk(i)o Fq(\021)598 946 y Fi(//)39 b(A)h(type)g(safe)g(bitmap)h(based)f
(allocator.)598 1038 y(//)598 1129 y(template)h(<class)f(T>)598
1220 y(class)g(off_TBmAllocator)j(:)c(private)i(off_BmAllocator)i({)598
1312 y(public:)676 1403 y(off_TBmAllocator\(natural_t)i(len\))40
b(:)g(off_BmAllocator\(len\))k({;})676 1586 y
(off_TBmAllocator\(off_Exhaust)q(ed)h(*r,)40 b(const)h(off_Indexable)h
(*idx,)990 1677 y(T)d(*first,)81 b(natural_t)41 b(len)f(\))f(:)755
1768 y(off_BmAllocator\(r,)k(idx,)d(\(void*\)first,)i(len\))e({;})676
1951 y(T)g(*)f(allocate\(natural_t)k(at\))197 b({)40
b(return)g(\(T*\)off_BmAllocator::allocat)q(e\(at)q(\);)45
b(})676 2042 y(void)40 b(deallocate\(T)i(*p\))e({)g
(off_BmAllocator::deallocate\(\(vo)q(id*\))q(p\);)46
b(})676 2134 y(void)40 b(deallocate\(natural_t)k(at\))c({)f
(off_BmAllocator::deallocate)q(\(at\))q(;)45 b(})676
2225 y(T)40 b(*operator)h(+\(natural_t)h(at\))e({)755
2316 y(return)g(\(T*\)\(this->off_KernAllocator)q(::op)q(erato)q(r+\(a)
q(t\)\);)676 2408 y(})676 2590 y(natural_t)h(pos\(T)g(*p\))f({)f
(return)i(off_KernAllocator::pos\(\(void*\))q(p\);)85
b(})676 2682 y(off_BKAllocator::get_nfree;)676 2773 y
(off_BKAllocator::get_nalloc;)676 2864 y(off_BKAllocator::get_maxallo)q
(c;)676 2956 y(off_BKAllocator::get_num_all)q(ocrq;)676
3047 y(off_BKAllocator::get_num_fre)q(erq;)676 3138 y
(off_BKAllocator::get_length;)676 3321 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 3321 24 4
v 29 w(TBmAllocator)p Fj(.)j Fk(i)598 3504 y Fi(};)639
3645 y Fz(T)-7 b(o)36 b(allo)n(w)g(initialization)g(of)g(pre-allo)r
(cated)f Fx(TBmAllocator)p Fz(s)d(an)k(op)r(erator)f
Fx(new)g Fz(is)515 3744 y(pro)n(vided.)515 3877 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
3877 V 29 w(TBmAllocator)p Fj(.)i Fk(i)p Fq(\021)598
3968 y Fi(void)40 b(*)f(operator)i(new\(size_t)h(s,)e(void)g(*p\))g({)f
(\(void\)s;)i(return)g(p;)e(})1905 5255 y Fz(91)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
92 93 bop 515 523 a FA(The)32 b(soft)m(w)m(are)g(allo)s(cator)515
676 y Fz(The)h Fx(SwAllocator)28 b Fz(is)33 b(a)g Fx(BKAllocator)28
b Fz(with)34 b(a)e(simple)h(allo)r(cation)f(sc)n(heme.)53
b(Its)33 b(im-)515 776 y(plemen)n(tation)c(ma)n(y)g(v)-5
b(ary)e(,)29 b(but)h(in)f(general)f(it)i(consists)e(on)h(an)h(arra)n(y)
d(and)i(a)g(link)n(ed)g(list)515 876 y(of)38 b(free)g(no)r(des.)68
b(W)-7 b(e)38 b(call)g(it)g(\\soft)n(w)n(are")e(allo)r(cator)g(b)r
(ecause)i(its)g(allo)r(cation)f(table)h(is)515 975 y(not)25
b(used)g(b)n(y)g(the)h(hardw)n(are)d(\(other)i(system)g(allo)r(cators)e
(use)i(mac)n(hine)g(dep)r(enden)n(t)h(data)515 1075 y(structures)e
(needed)h(b)n(y)g(the)g(hardw)n(are)e(to)h(main)n(tain)h(the)g(allo)r
(cation)f(table\).)36 b(Again,)25 b(w)n(e)515 1174 y(pro)n(vide)g
(\014rst)h(a)h Fx(void)e Fz(p)r(oin)n(ter)h(based)g(allo)r(cator)f
(whic)n(h)h(can)g(b)r(e)h(further)g(wrapp)r(ed)f(b)n(y)g(a)515
1274 y(t)n(yp)r(e-safe)h(in)n(terface.)515 1407 y Fk(h)p
Fj(O\013)g(softwar)l(e)i(al)t(lo)l(c)l(ator.)f Fk(i)p
Fq(\021)598 1590 y Fi(//)39 b(A)h(software-table)i(based)f(allocator.)
598 1681 y(//)598 1772 y(class)f(off_SwAllocator)j(:)c(public)i
(off_KernAllocator)i({)598 1863 y(private:)676 1955 y
Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e Fi(off)p
1713 1955 24 4 v 29 w(SwAllocator)p Fj(.)j Fk(i)598 2046
y Fi(protected:)676 2137 y Fk(h)p Fj(Other)f(pr)l(ote)l(cte)l(d)h(memb)
l(ers)f(of)e Fi(off)p 1778 2137 V 29 w(SwAllocator)p
Fj(.)i Fk(i)598 2229 y Fi(public:)676 2320 y(//)40 b(Allows)g
(declarations)i(of)e(uninitialized)i(software)f(allocators.)676
2411 y(off_SwAllocator\(void\){;})676 2594 y(//)f(Creates)h(a)e
(software)i(allocator.)676 2685 y(off_SwAllocator\(off_Exhauste)q(d)k
(*r,)40 b(const)g(off_Indexable)i(*i,)1304 2777 y(void)e(*first,)h
(natural_t)g(len)354 b(\))39 b(:)755 2868 y
(off_KernAllocator\(r,i,first,len)q(\),)755 2959 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 2168 2959 V 29 w(SwAllocator)p Fj(.)j Fk(i)676
3051 y Fi({)40 b(;)78 b(})676 3233 y(//)40 b(Allocate)h(\(deallocate\))
h(units.)676 3325 y(//)e(Return)g(NULL)h(when)f(allocation)h(failed.)
676 3416 y(void)f(*allocate\(boolean_t)k(use_revocation=FALSE)g(\);)676
3507 y(void)c(*allocate\(natural_t)k(at,)c(boolean_t)h
(use_revocation=FALSE\);)676 3690 y(void)80 b(deallocate\(void)42
b(*p\);)676 3873 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3873 V 29 w(SwAllocator)p Fj(.)j Fk(i)598
3964 y Fi(};)515 4230 y Fk(h)p Fj(O\013)d(softwar)l(e)i(al)t(lo)l(c)l
(ator)f(dep)l(endencies.)i Fk(i)p Fq(\021)598 4321 y
Fi(#include)41 b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 4412 y(#include)h(<klib/KernAllocator.h>)j
(//)c(for)g(off_KernAllocator)598 4504 y(#include)h(<klib/Indexer.h>)
278 b(//)40 b(for)g(off_Indexable)1905 5255 y Fz(92)p
eop
PStoPSsaved restore
%%Page: (94,95) 48
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
93 94 bop 639 523 a Fz(Ob)5 b(jects)33 b(are)f(allo)r(cated)g(from)h
(the)h(ra)n(w)e(store)g(\()p Fx(k)p 2260 523 27 4 v 31
w(items)p Fz(\))f(left)j(to)f(righ)n(t.)53 b(Initially)-7
b(,)515 623 y(all)30 b(the)h(no)r(des)f(in)h(the)g(arra)n(y)d(will)i(b)
r(e)h(a)n(v)-5 b(ailable;)31 b(during)f(system)g(op)r(eration)g(the)g
(arra)n(y)515 722 y(will)k(ha)n(v)n(e)e(allo)r(cated)i(no)r(des)f(on)h
(the)g(left)h(section)e(and)h(a)n(v)-5 b(ailable)32 b(no)r(des)i(on)g
(the)g(righ)n(t)515 822 y(section.)57 b(A)34 b(p)r(oin)n(ter)g(to)h
(the)f(start)g(of)h(the)f(unallo)r(cated)g(section,)i
Fx(s)p 2759 822 V 31 w(next)p Fz(,)f(is)f(used)g(to)515
922 y(distinguish)e(b)r(et)n(w)n(een)f(those)h(sections.)49
b(A)32 b(free)g(list)g(is)g(used)f(to)h(reuse)f(no)r(des)h(that)g(are)
515 1021 y(no)24 b(longer)g(useful.)36 b(No)r(des)25
b(of)g(the)g(store)f(m)n(ust)h(matc)n(h)g(the)g(t)n(yp)r(e)g
Fx(DLinkedNode)p Fz(,)d(so)i(that)515 1121 y(they)k(could)f(b)r(e)h
(link)n(ed)f(without)h(using)g(dynamic)f(memory)-7 b(.)515
1254 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 1254 24 4 v 29 w(SwAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 1345 y Fi(void)40 b(*s_next;)747 b(//)40
b(first)g(unallocated)i(element)f(in)e(the)h(arry.)515
1519 y Fk(h)p Fj(O\013)27 b(softwar)l(e)i(al)t(lo)l(c)l(ator)f(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 1611 y Fi(#include)41
b(<klib/dlist.h>)356 b(//)40 b(for)g(DLinkedNode)h(et)f(al.)639
1752 y Fz(The)34 b(free)g(list)g(is)g(a)f(single)h(link)n(ed)g(list)g
(whic)n(h)g(do)r(es)f(not)h(allo)r(cate)f(memory)g(for)h(its)515
1851 y(no)r(des)28 b(\(a)g Fx(DLinkedList)p Fz(\).)35
b(Instead,)28 b(it)h(uses)f(another)f(ra)n(w)g(allo)r(cator)g(to)h
(main)n(tain)g(the)515 1951 y(list.)515 2084 y Fk(h)p
Fj(Other)g(private)h(memb)l(ers)f(of)g Fi(off)p 1552
2084 V 29 w(SwAllocator)p Fj(.)h Fk(i)p Fq(\021)598 2175
y Fi(DLinkedList)41 b(s_free;)512 b(//)40 b(list)g(of)g(free)g(nodes.)
639 2316 y Fz(W)-7 b(e)28 b(still)g(ha)n(v)n(e)f(to)g(initialize)h(the)
g(new)f(mem)n(b)r(ers)h(de\014ned)g(ab)r(o)n(v)n(e.)515
2433 y Fk(h)p Fj(Initialize)e(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 2433 V 29 w(SwAllocator)p Fj(.)j
Fk(i)o Fq(\021)598 2524 y Fi(s_free\(\),s_next\(k_first\))515
2682 y Fk(h)p Fj(O\013)d(softwar)l(e)i(al)t(lo)l(c)l(ator)f(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 2773 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)1905 5255 y Fz(93)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
94 95 bop 639 523 a Fz(Allo)r(cation)26 b(is)f(simple,)h(pro)n(vided)f
(there)g(is)h(enough)f(memory)-7 b(.)35 b(W)-7 b(e)27
b(\014rst)e(try)g(the)h(free)515 623 y(list.)36 b(If)25
b(it)g(is)f(exhausted)g(w)n(e)h(will)f(tak)n(e)g(the)h(memory)f(from)g
(the)h(unallo)r(cated)f(part)g(of)h(the)515 722 y(arra)n(y)-7
b(.)34 b(Be)28 b(no)f(free)g(no)r(de)h(a)n(v)-5 b(ailable,)26
b(w)n(e)i(m)n(ust)f(trigger)f(rev)n(o)r(cation.)515 855
y Fk(h)p Fi(off)p 667 855 24 4 v 29 w(SwAllocator::allocate)32
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 946 y Fi(//)39
b(Allocates)j(units.)598 1038 y(//)d(Returns)i(NULL)f(when)h
(allocation)g(fails.)598 1129 y(void)f(*off_SwAllocator::allocate\(boo)
q(lean)q(_t)45 b(use_revocation\))598 1220 y({)676 1312
y(assert\(ptr_valid\(s_next\)\);)676 1403 y(if)40 b(\(!get_nfree\(\)\))
755 1494 y(if)f(\(use_revocation\))833 1586 y(exhausted\(\);)755
1677 y(else)833 1768 y(return)i(NULL;)676 1860 y
(assert\(ptr_valid\(s_next\)\);)676 1951 y(if)f
(\(!s_free.is_empty\(\)\){)755 2042 y(void)g(*nd;)755
2134 y(off_BKAllocator::allocate\(\);)755 2225 y
(assert\(ptr_valid\(s_next\)\);)755 2316 y
(nd=\(void*\)s_free.unlink_head\(\);)755 2408 y
(assert\(ptr_valid\(nd\)\);)755 2499 y(return)g(nd;)676
2590 y(})676 2682 y(else)g({)755 2773 y(void)g(*nd=s_next;)755
2864 y(\(void\)k_idx->inc\(s_next\);)755 2956 y
(off_BKAllocator::allocate\(\);)755 3047 y
(assert\(ptr_valid\(s_next\)\);)755 3138 y(return)g(nd;)676
3230 y(})598 3321 y(})1905 5255 y Fz(94)p eop
PStoPSsaved restore
%%Page: (96,97) 49
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
95 96 bop 639 523 a Fz(T)-7 b(o)24 b(allo)r(cate)f(an)h(elemen)n(t)g
(at)g(a)g(giv)n(en)f(p)r(osition)h(w)n(e)f(m)n(ust)i(c)n(hec)n(k)e(the)
h(giv)n(en)f(index)i(for)515 623 y(v)-5 b(alidit)n(y)e(.)35
b(When)25 b(the)g(no)r(de)f(is)g(presen)n(t)g(in)g(the)h(unallo)r
(cated)e(part)h(of)g(the)h(arra)n(y)c(w)n(e)j(mo)n(v)n(e)515
722 y(previous)33 b(unallo)r(cated)g(no)r(des)h(in)n(to)f(the)i(free)e
(list)h(and)g(mark)f(the)i(no)r(de)f(as)f(allo)r(cated.)515
822 y(Otherwise)26 b(it)i(can)g(b)r(e)g(allo)r(cated)f(only)g(when)h
(it)g(is)f(found)h(in)g(the)g(free)f(list.)515 955 y
Fk(h)p Fi(off)p 667 955 24 4 v 29 w(SwAllocator::allocate)32
b Fj(implementation.)27 b Fk(i)p Fz(+)p Fq(\021)598 1046
y Fi(//)39 b(Allocates)j(units.)598 1137 y(//)d(Returns)i(NULL)f(when)h
(allocation)g(fails.)598 1229 y(void)f(*off_SwAllocator::allocate\(nat)
q(ural)q(_t)45 b(at,)1853 1320 y(boolean_t)c(use_revocation\))598
1411 y({)676 1503 y(DLinkedNode)h(*n=\(DLinkedNode*\)\(k_idx->add\()q
(k_fir)q(st,a)q(t\)\);)676 1685 y(assert\(n)f(&&)f
(ptr_valid\(s_next\)\);)676 1777 y(\(void\)use_revocation;)676
1868 y(if)g(\(!ptr_valid\(n\)\))755 1959 y(return)g(NULL;)676
2051 y(else)g({)755 2142 y(if)f(\(s_next<=\(void*\)n\){)833
2233 y(for\()h(;s_next<\(void*\)n;)j(\(void\)k_idx->inc\(s_next\)\))912
2325 y(s_free.link_first\(\(DLinkedNode*)q(\)s_n)q(ext\);)833
2416 y(\(void\)k_idx->inc\(s_next\);)833 2507 y
(off_BKAllocator::allocate\(\);)833 2599 y
(assert\(ptr_valid\(s_next\)\);)833 2690 y(return)e(\(void*\)n;)755
2781 y(})755 2873 y(else)f(if)f(\(s_free.is_linked\(n\)\){)833
2964 y(s_free.unlink\(n\);)833 3055 y(off_BKAllocator::allocate\(\);)
833 3147 y(assert\(ptr_valid\(s_next\)\);)833 3238 y(return)i
(\(void*\)n;)755 3329 y(})755 3421 y(else)833 3512 y(return)g(NULL;)676
3603 y(})598 3694 y(})639 3836 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(used)g
Fx(is)p 1256 3836 27 4 v 31 w(free)p Fz(.)35 b(W)-7 b(e)28
b(exp)r(ort)f(this)h(metho)r(d)g(as)f(a)g(con)n(v)n(enience)g(for)g
(users.)515 3952 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3952 24 4 v 29 w(SwAllocator)p Fj(.)i Fk(i)p
Fq(\021)598 4043 y Fi(//)39 b(Is)h(it)g(free?)598 4134
y(boolean_t)h(is_free\(natural_t)i(at\))d(const)g({)676
4226 y(void)g(*p=k_idx->add\(k_first,at\);)676 4317 y
(assert\(ptr_valid\(p\)\);)676 4408 y(return)h
(s_free.is_linked\(\(DLinkedNode*)q(\)p\))46 b(||)39
b(p)h(>=)f(s_next;)80 b(})1905 5255 y Fz(95)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
96 97 bop 639 523 a Fz(Deallo)r(cation)27 b(is)h(the)g(most)f(simple)h
(metho)r(d.)515 639 y Fk(h)p Fi(off)p 667 639 24 4 v
29 w(SwAllocator::deallocate)k Fj(implementation.)c Fk(i)p
Fq(\021)598 731 y Fi(//)39 b(Dellocates)j(units.)598
822 y(void)e(off_SwAllocator::deallocate\()45 b(void)c(*p\))598
913 y({)676 1005 y(assert\(p)g(&&)f(ptr_valid\(s_next\))j(&&)d
(ptr_valid\(p\)\);)676 1096 y(off_BKAllocator::deallocate\()q(\);)676
1187 y(s_free.link_first\(\(DLinkedNo)q(de*\)p)q(\);)598
1279 y(})639 1494 y Fz(Users)29 b(should)f(not)i(instan)n(tiate)e(this)
i(allo)r(cator,)d(that)j(is)f(wh)n(y)f(w)n(e)h(are)f(not)h(going)f(to)
515 1594 y(implemen)n(t)g(t)n(yp)r(e-safe)f(wrapp)r(ers)f(for)h(it.)639
1694 y(No)n(w)32 b(that)h(w)n(e)g(ha)n(v)n(e)e(a)i(complete)f(allo)r
(cator)f(with)i(a)g(soft)n(w)n(are-based)d(mac)n(hine)i(in-)515
1793 y(dep)r(enden)n(t)26 b(allo)r(cation)f(table,)h(w)n(e)g(m)n(ust)g
(pro)n(vide)e(t)n(w)n(o)h(kinds)h(of)g(allo)r(cator:)34
b(a)26 b(\014xed-size)515 1893 y(static)h(allo)r(cator)f(and)h(a)h(gro)
n(wing)d(dynamic)j(allo)r(cator.)515 2109 y FA(The)k(\014xed)g(allo)s
(cator)515 2262 y Fz(The)g(\014xed)g(allo)r(cator)e(is)i(used)g(in)h
(those)f(resource)e(con)n(tainers)g(that)j(cannot)e(gro)n(w.)49
b(Its)515 2362 y(length)27 b(is)h(\014xed)g(once)f(giv)n(en)f(at)i
(instan)n(tiation)f(time.)515 2494 y Fk(h)p Fj(O\013)g(\014xe)l(d)h(al)
t(lo)l(c)l(ator.)h Fk(i)o Fq(\021)598 2586 y Fi(//)39
b(A)h(software-table)i(fixed-size)g(allocator.)598 2677
y(//)598 2768 y(class)e(off_FixedAllocator:)k(public)c(off_SwAllocator)
j({)598 2860 y(public:)676 2951 y(//)d(Allows)g(declarations)i(of)e
(uninitialized)i(fixed)f(allocators.)676 3042 y
(off_FixedAllocator\(void\){;})676 3225 y(//Creates)g(a)f(sw.)g(fixed)g
(allocator.)676 3316 y(off_FixedAllocator\(off_Exhau)q(sted)46
b(*r,)40 b(const)g(off_Indexable)i(*i,)1422 3408 y(void)e(*first,)g
(natural_t)i(len)e(\))f(:)755 3499 y(off_SwAllocator\(r,i,first,len\))
676 3590 y({)h(;)78 b(})598 3773 y(};)515 4039 y Fk(h)p
Fj(O\013)27 b(\014xe)l(d)h(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g
Fk(i)p Fq(\021)598 4130 y Fi(#include)41 b(<klib/SwAllocator.h>)122
b(//)40 b(for)g(off_SwAllocator)1905 5255 y Fz(96)p eop
PStoPSsaved restore
%%Page: (98,99) 50
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
97 98 bop 639 523 a Fz(A)27 b(\014xed)f(allo)r(cator)e(can)i(b)r(e)g
(instan)n(tiated,)g(so)g(w)n(e)f(pro)n(vide)g(a)h(t)n(yp)r(e-safe)f(in)
n(terface)h(for)515 623 y(it.)515 756 y Fk(h)p Fj(O\013)h(typ)l(e)i
(safe)e(\014xe)l(d)i(al)t(lo)l(c)l(ator.)f Fk(i)p Fq(\021)598
847 y Fi(//)39 b(A)h(software-table)i(fixed-size)g(allocator.)598
938 y(//)598 1029 y(template)f(<class)f(T>)598 1121 y(class)g
(off_TFixedAllocator)k(:)39 b(private)i(off_FixedAllocator)i({)598
1212 y(public:)676 1303 y(//)d(Allows)g(declarations)i(of)e
(uninitialized)i(fixed)f(allocators.)676 1395 y
(off_TFixedAllocator\(void\))k(:)40 b(off_FixedAllocator\(\))j({;})676
1577 y(//Creates)e(a)f(sw.)g(fixed)g(allocator.)676 1669
y(off_TFixedAllocator\(off_Exha)q(usted)46 b(*r,)40 b(const)g
(off_Indexable)i(*i,)1461 1760 y(T)d(*first,)i(natural_t)g(len)f(\))g
(:)755 1851 y(off_FixedAllocator\(r,)k(i,)39 b(\(void)i(*\)first,)g
(len)f(\))676 1943 y({)g(;)78 b(})676 2125 y(//)40 b(Allocate)h
(\(deallocate\))h(units.)676 2217 y(//)e(Return)g(NULL)h(when)f
(allocation)h(failed.)676 2308 y(T)f(*allocate\(boolean_t)j
(use_revocation=FALSE)h(\))39 b({)755 2399 y(return)h
(\(T*\)off_FixedAllocator::allo)q(cate)q(\(use_)q(revo)q(catio)q(n\);)
676 2491 y(})676 2582 y(T)g(*allocate\(natural_t)j(at,)d(boolean_t)h
(use_revocation=FALSE\))j({)755 2673 y(return)c(\(T*\))g
(off_FixedAllocator::allocat)q(e\(at,)q(use_)q(revoc)q(atio)q(n\);)676
2765 y(})676 2947 y(void)80 b(deallocate\(T)42 b(*p\))d({)h
(off_FixedAllocator::deallocate)q(\(\(vo)q(id*\))q(p\);)45
b(})676 3130 y(off_FixedAllocator::is_free;)676 3313
y(T)40 b(*operator)h(+\(natural_t)h(at\))e({)755 3404
y(return)g(\(T*\)\(this->off_KernAllocator)q(::op)q(erato)q(r+\(a)q
(t\)\);)676 3495 y(})676 3678 y(natural_t)h(pos\(T)g(*p\))f({)f(return)
i(off_KernAllocator::pos\(\(void*\))q(p\);)85 b(})676
3769 y(off_BKAllocator::get_nfree;)676 3861 y
(off_BKAllocator::get_nalloc;)676 3952 y(off_BKAllocator::get_maxallo)q
(c;)676 4043 y(off_BKAllocator::get_num_all)q(ocrq;)676
4134 y(off_BKAllocator::get_num_fre)q(erq;)676 4226 y
(off_BKAllocator::get_length;)676 4408 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 4408 24 4
v 29 w(TFixedAllocator)p Fj(.)k Fk(i)598 4591 y Fi(};)1905
5255 y Fz(97)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
98 99 bop 639 523 a Fz(T)-7 b(o)32 b(allo)n(w)e(initialization)i(of)f
(pre-allo)r(cated)f Fx(TFixedAllocator)p Fz(s)c(an)31
b(op)r(erator)f Fx(new)515 623 y Fz(is)d(pro)n(vided.)515
756 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 756 24 4 v 29 w(TFixedAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 847 y Fi(void)40 b(*)f(operator)i(new\(size_t)h(s,)e(void)g
(*p\))g({)f(\(void\)s;)i(return)g(p;)e(})515 1104 y FA(The)32
b(sparse)f(allo)s(cator)515 1257 y Fz(Sometimes)h(w)n(e)g(ha)n(v)n(e)f
(a)h(\014xed)g(n)n(um)n(b)r(er)g(of)g(allo)r(catable)f(resource)g
(units)h(but)h(w)n(e)f(kno)n(w)515 1357 y(in)d(adv)-5
b(ance)29 b(that)h(only)f(a)g(small)g(subset)g(of)g(units)h(will)g(b)r
(e)f(allo)r(cated)g(at)g(most.)42 b(In)30 b(that)515
1457 y(case)39 b(w)n(e)i(w)n(an)n(t)f(a)g(\014xed)h(allo)r(cator)d(but)
k(w)n(e)e(don't)h(w)n(an)n(t)f(to)g(main)n(tain)g(b)r(o)r(okk)n(eeping)
515 1556 y(information)27 b(for)g(ev)n(ery)f(existing)h(resource)f
(unit.)639 1656 y(F)-7 b(or)32 b(suc)n(h)h(o)r(ccasions)e(w)n(e)h(use)h
(a)f(sparse)f(allo)r(cator.)50 b(A)n(t)33 b(instan)n(tiation)g(time)g
(it)g(will)515 1756 y(receiv)n(e)26 b(the)i(theoretical)f(size)g(along)
f(with)j(the)f(real)e(one.)515 1888 y Fk(h)p Fj(O\013)h(sp)l(arse)i(al)
t(lo)l(c)l(ator.)f Fk(i)p Fq(\021)598 1980 y Fi(//)39
b(An)h(sparse)h(fixed)f(allocator.)598 2071 y(//)598
2162 y(class)g(off_SparseAllocator)k(:)39 b(protected)i
(off_FixedAllocator)j({)598 2254 y(private:)676 2345
y(natural_t)d(s_len;)598 2436 y(protected:)676 2528 y
Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 2528 V 29 w(SparseAllocator)p Fj(.)j Fk(i)676
2619 y(h)p Fj(Other)f(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 2619 V 29 w(SparseAllocator)p Fj(.)k Fk(i)598
2710 y Fi(public:)676 2802 y(//)40 b(So)g(that)g(we)f(could)i(declare)g
(uninitialized)h(instances.)676 2893 y(off_SparseAllocator\(void\){;})
676 3076 y(//)e(Creates)h(an)e(sparse)i(allocator.)676
3167 y(off_SparseAllocator\(off_Exha)q(usted)46 b(*r,)40
b(const)g(off_Indexable)i(*i,)1461 3258 y(void)e(*first,)h(natural_t)g
(real_len,)g(natural_t)h(len)d(\))h(:)755 3350 y
(off_FixedAllocator\(r,i,first,re)q(al_l)q(en\),)755
3441 y(s_len\(len\))676 3532 y({)755 3624 y Fk(h)p Fj(Initialize)26
b(other)j(pr)l(ote)l(cte)l(d)i(memb)l(ers)d(of)f Fi(off)p
2158 3624 V 29 w(SparseAllocator)p Fj(.)k Fk(i)676 3715
y Fi(})676 3989 y(//)40 b(Allocate)h(\(deallocate\))h(units.)676
4080 y(//)e(Return)g(NULL)h(when)f(allocation)h(failed.)676
4171 y(void)f(*allocate\(natural_t)k(at,)c(boolean_t)h
(use_revocation=FALSE\);)676 4354 y(void)80 b(deallocate\()41
b(void)f(*p\);)676 4445 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 4445 V 29 w(SparseAllocator)p Fj(.)k
Fk(i)598 4628 y Fi(};)515 4894 y Fk(h)p Fj(O\013)c(sp)l(arse)i(al)t(lo)
l(c)l(ator)g(dep)l(endencies.)g Fk(i)p Fq(\021)598 4985
y Fi(#include)41 b(<klib/FixedAllocator.h>)j(//)c(for)g
(off_FixedAllocator)1905 5255 y Fz(98)p eop
PStoPSsaved restore
%%Page: (100,101) 51
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
99 100 bop 639 523 a Fz(Eac)n(h)23 b(allo)r(cated)h(item)h(has)f(a)g
(real)f(p)r(osition)i(in)f(the)h Fx(FixedAllocator)19
b Fz(as)k(w)n(ell)i(as)e(an)515 623 y(o\016cial)i(p)r(osition)h(as)g
(seen)g(b)n(y)f(the)i(user.)36 b(T)-7 b(o)26 b(map)g(the)g(user)g(view)
g(to)g(the)g(realit)n(y)f(w)n(e)h(use)515 722 y(an)j(arra)n(y)f(of)h
(indexes.)44 b(The)29 b Fx(i)p Fz(th)h(item)h(in)f(the)g(arra)n(y)d
(main)n(tains)i(the)i(o\016cial)e(index)h(for)515 822
y(the)e(elemen)n(t)f(in)h Fx(FixedAllocator[i])37 b Fz(.)515
938 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 938 24 4 v 29 w(SparseAllocator)p Fj(.)k
Fk(i)p Fq(\021)676 1029 y Fi(natural_t)41 b(*s_pos;)515
1187 y Fk(h)p Fj(Initialize)26 b(other)j(pr)l(ote)l(cte)l(d)i(memb)l
(ers)d(of)f Fi(off)p 1918 1187 V 29 w(SparseAllocator)p
Fj(.)k Fk(i)p Fq(\021)598 1279 y Fi(s_pos)40 b(=)g(new)f
(natural_t[real_len];)598 1370 y(for)h(\(natural_t)h(i=0;)f
(i<real_len;)i(i++\))676 1461 y(s_pos[i]=s_len;)592 b(//)40
b(ANY)g(invalid)g(value)639 1602 y Fz(T)-7 b(o)35 b(allo)r(cate)g(a)g
(giv)n(en)g(unit)h(w)n(e)f(scan)g(the)h Fx(s)p 2092 1602
27 4 v 31 w(pos)e Fz(arra)n(y)g(and)h(allo)r(cate)g(a)g(new)g(slot)515
1702 y(when)28 b(it)g(w)n(as)e(not)i(already)e(allo)r(cated.)515
1835 y Fk(h)p Fi(off)p 667 1835 24 4 v 29 w(SparseAllocator::allocate)
33 b Fj(implementation.)27 b Fk(i)p Fq(\021)598 1926
y Fi(//)39 b(Allocate)81 b(units.)598 2017 y(//)39 b(Return)i(NULL)f
(when)g(allocation)i(failed.)598 2109 y(void)e
(*off_SparseAllocator::allocate)q(\(nat)q(ural)q(_t)45
b(at,)40 b(boolean_t)h(use_revocation\))598 2200 y({)676
2291 y(void)f(*n;)676 2383 y(if)g(\(lookup\(at\))i(||)d
(\(n=off_FixedAllocator::alloc)q(ate\()q(use_r)q(evoc)q(atio)q(n\)\))45
b(==)40 b(NULL\))755 2474 y(return)g(NULL;)676 2565 y(else)g({)755
2657 y(s_pos[off_FixedAllocator::pos\(n)q(\)])45 b(=)40
b(at;)755 2748 y(return)g(n;)676 2839 y(})598 2931 y(})639
3163 y Fz(W)-7 b(e)28 b(used)g Fx(lookup)d Fz(whic)n(h)j(con)n(v)n
(erts)d(an)j(o\016cial)f(index)g(in)n(to)h(a)f(real)g(one.)515
3296 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3296 V 29 w(SparseAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 3387 y Fi(//)39 b(Translates)j(the)e(official)h(index)f(at)
g(to)g(the)g(real)g(one.)598 3479 y(//)f(returns)i(TRUE)f(when)h(the)e
(item)i(was)e(found.)598 3570 y(boolean_t)i(lookup\(natural_t)i(&at\))d
(const;)515 3744 y Fk(h)p Fi(off)p 667 3744 V 29 w
(SparseAllocator::lookup)32 b Fj(implementation.)c Fk(i)p
Fq(\021)598 3836 y Fi(//)39 b(Translates)j(the)e(official)h(index)f(at)
g(to)g(the)g(real)g(one.)598 3927 y(//)f(returns)i(TRUE)f(when)h(the)e
(item)i(was)e(found.)598 4018 y(boolean_t)i
(off_SparseAllocator::lookup\(n)q(atur)q(al_t)46 b(&at\))40
b(const)598 4110 y({)676 4201 y(for)g(\(natural_t)i(i=0;)e
(i<off_BKAllocator::get_length\()q(\);)45 b(i++\))755
4292 y(if)39 b(\(s_pos[i]==at\){)833 4384 y(at)h(=)f(i;)833
4475 y(return)i(TRUE;)755 4566 y(})676 4658 y(return)g(FALSE;)598
4749 y(})1905 5255 y Fz(99)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
100 101 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(SparseAllocator::deallocate)33 b Fj(implementation.)28
b Fk(i)o Fq(\021)598 614 y Fi(void)79 b(off_SparseAllocator::dealloca)q
(te\()46 b(void)40 b(*p\))598 706 y({)676 797 y
(assert\(ptr_valid\(p\)\);)676 888 y(s_pos[off_FixedAllocator::po)q
(s\(p\)])q(=)45 b(s_len;)598 980 y(})639 1212 y Fz(No)n(w)39
b(w)n(e)f(ha)n(v)n(e)f(to)i(rede\014ne)f(those)h(metho)r(ds)g(using)f
(indexes)h(to)f(op)r(erate)g(on)h(the)515 1312 y(\\o\016cial")26
b(ones.)515 1445 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1445 V 29 w(SparseAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 1536 y Fi(//)39 b(Is)h(it)g(free?)598 1627
y(boolean_t)h(is_free\(natural_t)i(at\))d(const)g({)g(return)g
(!lookup\(at\);)i(})598 1719 y(void)e(*operator+\(natural_t)k(at\))c
(const;)598 1810 y(natural_t)h(pos\(const)g(void*p\);)598
1901 y(natural_t)g(get_length\(void\))i(const)d({)g(return)g(s_len;})
639 2042 y Fz(It)25 b(no)n(w)f(m)n(ust)h(scan)f(the)h(list)f(of)h(no)r
(des)f(and)h(consider)e(the)i(giv)n(en)f(one)g(to)g(b)r(e)h(free)f
(only)515 2142 y(when)k(it)g(is)f(not)h(found)g(in)f(the)h(list)g(of)g
(o\016cial)f(slots.)515 2275 y Fk(h)p Fi(off)p 667 2275
V 29 w(SparseAllocator::operator+)33 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 2366 y Fi(void)40 b
(*off_SparseAllocator::operator)q(+\(na)q(tura)q(l_t)45
b(at\))40 b(const)598 2457 y({)676 2549 y(if\()g(lookup\(at\))i(\))755
2640 y(return)e(this->off_FixedAllocator::op)q(erat)q(or+\(a)q(t\);)676
2731 y(else)755 2823 y(return)g(NULL;)598 2914 y(})515
3180 y Fk(h)p Fi(off)p 667 3180 V 29 w(SparseAllocator::pos)32
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 3271 y Fi(natural_t)41
b(off_SparseAllocator::pos\(cons)q(t)k(void*p\))598 3362
y({)676 3454 y(if)40 b(\(!ptr_valid\(p\)\))755 3545 y(return)g
(\(natural_t\)-1;)676 3636 y(else)755 3728 y(return)g
(s_pos[off_FixedAllocator::po)q(s\(p\))q(];)598 3819
y(})639 4051 y Fz(Although)33 b(ab)r(o)n(v)n(e)f(metho)r(ds)h
(rede\014ne)g(the)g(allo)r(cated)g(unit)g(p)r(ositions,)h(it)g(is)f
(con)n(v)n(e-)515 4151 y(nien)n(t)25 b(to)g(main)n(tain)g(another)f
(metho)r(d)i(whic)n(h)f(could)g(b)r(e)h(used)f(to)g(access)f(resources)
g(with)515 4251 y(real)i(indexes)i(\(mostly)f(to)h(pre-initialize)f
(the)h(allo)r(cated)f(resources\).)515 4384 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4384
V 29 w(SparseAllocator)p Fj(.)j Fk(i)p Fz(+)p Fq(\021)598
4475 y Fi(void)40 b(*real_add\(natural_t)j(at\))d(const)h({)676
4566 y(return)g(this->off_FixedAllocator::oper)q(ator)q(+\(at\))q(;)598
4658 y(})1885 5255 y Fz(100)p eop
PStoPSsaved restore
%%Page: (102,103) 52
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
101 102 bop 639 523 a Fz(T)-7 b(o)27 b(use)h(a)f Fx(SparseAllocator)22
b Fz(this)27 b(t)n(yp)r(e-safe)g(v)n(ersion)g(should)g(b)r(e)h
(preferred.)515 656 y Fk(h)p Fj(O\013)f(typ)l(e)i(safe)e(sp)l(arse)j
(al)t(lo)l(c)l(ator.)e Fk(i)p Fq(\021)598 747 y Fi(//)39
b(An)h(sparse)h(fixed)f(allocator.)598 839 y(//)598 930
y(template)h(<class)f(T>)598 1021 y(class)g(off_TSparseAllocator)k(:)39
b(private)i(off_SparseAllocator)j({)598 1112 y(public:)676
1204 y(off_TSparseAllocator\(void\):)i(off_SparseAllocator\(\))e({;})
676 1386 y(//)c(Creates)h(an)e(sparse)i(allocator.)676
1478 y(off_TSparseAllocator\(off_Exh)q(auste)q(d)k(*r,)40
b(const)g(off_Indexable)j(*i,)1500 1569 y(T)c(*first,)i(natural_t)h
(real_len,)f(natural_t)g(len)f(\))f(:)755 1660 y
(off_SparseAllocator\(r,)44 b(i,)c(\(void*\)first,)i(real_len,)f(len)f
(\))676 1752 y({;})676 1934 y(//)g(Allocate)h(\(deallocate\))h(units.)
676 2026 y(//)e(Return)g(NULL)h(when)f(allocation)h(failed.)676
2117 y(T)f(*allocate\(natural_t)j(at,)d(boolean_t)h
(use_revocation=FALSE\))j({)755 2208 y(return)c
(\(T*\)off_SparseAllocator::all)q(ocat)q(e\(at,)q(use_)q(revoc)q(atio)q
(n\);)676 2300 y(})676 2482 y(void)80 b(deallocate\()41
b(T)f(*p\))g({)f(off_SparseAllocator::dealloca)q(te\(\()q(void)q
(*\)p\);)46 b(})676 2574 y(//)40 b(Is)g(it)f(free?)676
2665 y(off_SparseAllocator::is_free)q(;)676 2756 y(T)h
(*operator+\(natural_t)j(at\))d(const)h({)755 2848 y(return)f
(\(T*\)\(this->off_SparseAllocat)q(or::)q(opera)q(tor+)q(\(at\)\))q(;)
676 2939 y(})676 3030 y(natural_t)h(pos\(const)h(T*p\))e({)f(return)i
(off_SparseAllocator::pos\(\(voi)q(d*\)p\))q(;})676 3122
y(off_SparseAllocator::get_len)q(gth;)676 3304 y(T)f
(*real_add\(natural_t)j(at\))d(const)g({)755 3396 y(return)g
(\(T*\)off_SparseAllocator::rea)q(l_ad)q(d\(at\))q(;)676
3487 y(})676 3670 y(off_BKAllocator::get_nfree;)676 3761
y(off_BKAllocator::get_nalloc;)676 3852 y(off_BKAllocator::get_maxallo)
q(c;)676 3944 y(off_BKAllocator::get_num_all)q(ocrq;)676
4035 y(off_BKAllocator::get_num_fre)q(erq;)676 4218 y
Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 4218 24 4 v 29 w(TSparseAllocator)p Fj(.)k Fk(i)598
4400 y Fi(};)639 4541 y Fz(T)-7 b(o)26 b(allo)n(w)f(initialization)h
(of)h(pre-allo)r(cated)d Fx(TSparseAllocator)p Fz(s)c(an)26
b(op)r(erator)e Fx(new)515 4641 y Fz(is)j(pro)n(vided.)515
4774 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4774 V 29 w(TSparseAllocator)p Fj(.)j Fk(i)p Fq(\021)598
4865 y Fi(void)40 b(*)f(operator)i(new\(size_t)h(s,)e(void)g(*p\))g({)f
(\(void\)s;)i(return)g(p;)e(})1885 5255 y Fz(101)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
102 103 bop 515 523 a FA(The)32 b(blo)s(c)m(k)g(allo)s(cator)515
676 y Fz(The)27 b Fx(BlockAllocator)22 b Fz(is)28 b(an)f(allo)r(cator)f
(whic)n(h)h(can)h(gro)n(w)e(dynamically)-7 b(.)515 802
y Fk(h)p Fj(O\013)27 b(blo)l(ck)h(al)t(lo)l(c)l(ator.)g
Fk(i)p Fq(\021)598 893 y Fi(//)39 b(A)h(growing)h(allocator.)598
984 y(//)598 1076 y(class)f(off_BlockAllocator:)k(public)c
(off_SwAllocator)j({)598 1167 y(private:)676 1258 y Fk(h)p
Fj(Other)29 b(private)f(memb)l(ers)h(of)e Fi(off)p 1713
1258 24 4 v 29 w(BlockAllocator)p Fj(.)j Fk(i)598 1350
y Fi(public:)676 1441 y(//)40 b(Allows)g(declarations)i(of)e
(uninitialized)i(block)f(allocators.)676 1532 y
(off_BlockAllocator\(void\){;})676 1715 y(//)f(Makes)g(it)g(grow.)676
1806 y(boolean_t)81 b(grow\(void\);)676 1989 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
1989 V 29 w(BlockAllocator)p Fj(.)j Fk(i)598 2080 y Fi(};)515
2423 y Fk(h)p Fj(O\013)d(blo)l(ck)h(al)t(lo)l(c)l(ator)h(dep)l
(endencies.)g Fk(i)p Fq(\021)598 2514 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 2605 y(#include)h(<klib/SwAllocator.h>)122 b(//)40
b(for)g(off_BKAllocator)639 2739 y Fz(T)-7 b(o)20 b(b)r(e)g(able)f(to)h
(obtain)g(new)g(k)n(ernel)f(virtual)g(memory)-7 b(,)21
b(blo)r(c)n(k)e(allo)r(cators)f(need)i(certain)515 2839
y(services)j(from)h(the)h(k)n(ernel)e Ft(dmm)p Fz(.)36
b(When)25 b(no)f Ft(dtlb)h Fz(supp)r(ort)f(is)g(included)h(in)g(the)g
(k)n(ernel,)515 2939 y(these)40 b(allo)r(cators)f(ma)n(y)h(fail)h(to)f
(gro)n(w.)74 b(Nev)n(ertheless,)43 b(they)e(are)f(una)n(w)n(are)e(of)47
b Ft(dtlb)515 3038 y Fz(supp)r(ort.)639 3138 y(What)c(they)g(do)g(kno)n
(w)f(is)h(ho)n(w)f(to)g(allo)r(cate)g(and)h(deallo)r(cate)f(a)g(page)g
(of)h(k)n(ernel)515 3237 y(memory)30 b(\(virtual)h(or)f(ph)n(ysical;)i
(dep)r(ending)f(on)g Ft(dtlb)g Fz(a)n(v)-5 b(ailabilit)n(y\))30
b(and)h(what)g(is)g(the)515 3337 y(size)h(of)g(pages)f(b)r(eing)i(allo)
r(cated.)50 b(The)32 b(constructor)f(receiv)n(es)g(a)h(p)r(oin)n(ter)g
(to)g(an)g(ob)5 b(ject)515 3437 y(\()p Fx(KVMRegion)p
Fz(,)34 b(see)h(section)h(5.5.2\))e(pro)n(viding)h(page)f(allo)r
(cation)h(routines.)60 b(It)36 b(also)f(re-)515 3536
y(ceiv)n(es)26 b(a)i(rev)n(o)r(cation)d(trigger)h(\()p
Fx(Exhausted)p Fz(\).)515 3662 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 3662 V 29 w(BlockAllocator)p Fj(.)j
Fk(i)p Fq(\021)598 3753 y Fi(//)39 b(Creates)i(a)f(block)g(allocator.)
598 3845 y(off_BlockAllocator\(off_Exhaust)q(ed)45 b(*r,)40
b(const)h(off_Indexable)h(*i,)1343 3936 y(off_KVMRegion)g(*reg\);)515
4096 y Fk(h)p Fj(O\013)27 b(blo)l(ck)h(al)t(lo)l(c)l(ator)h(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 4187 y Fi(#include)41
b(<dmm/KVMRegion.h>)239 b(//)40 b(for)g(off_KVMRegion)639
4321 y Fz(T)-7 b(o)39 b(create)g(a)g(blo)r(c)n(k)g(allo)r(cator)e(w)n
(e)i(simply)h(record)e(the)h(information)g(needed)h(for)515
4420 y(normal)29 b(op)r(eration.)42 b(It)30 b(is)g(supp)r(osed)f(that)i
(the)f(allo)r(cator)e(has)h(b)r(een)h(assigned)f(initially)515
4520 y(a)g(single)g(memory)g(page.)42 b(It)29 b(will)h(k)n(eep)f(in)h
Fx(b)p 1963 4520 27 4 v 31 w(end)e Fz(a)i(p)r(oin)n(ter)f(the)h(end)f
(of)h(the)g(allo)r(cated)515 4620 y(memory)d(area.)515
4732 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4732 24 4 v 29 w(BlockAllocator)p Fj(.)i
Fk(i)p Fq(\021)598 4824 y Fi(off_KVMRegion)42 b(*b_region;)316
b(//)40 b(Page)g(allocator.)598 4915 y(vm_size_t)119
b(b_pgsz;)512 b(//)40 b(Page)g(size.)598 5006 y(vm_offset_t)h(b_end;)
551 b(//)40 b(End)g(of)f(preallocated)j(memory.)1885
5255 y Fz(102)p eop
PStoPSsaved restore
%%Page: (104,105) 53
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
103 104 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(BlockAllocator::off)p 1437 523 V 32 w(BlockAllocator)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Creates)i(a)f(block)g(allocator.)598 706 y
(off_BlockAllocator::off_BlockA)q(lloca)q(tor\()1343
797 y(off_Exhausted)i(*r,)e(const)h(off_Indexable)h(*i,)1343
888 y(off_KVMRegion)g(*reg)e(\))g(:)676 980 y
(off_SwAllocator\(r,i,\(void*\)r)q(eg->g)q(et_s)q(tart)q(\(\),)1304
1071 y(\(reg->get_pgsz\(\)/i->sz\(\)\)\),)676 1162 y(b_region\(reg\),)
676 1254 y(b_pgsz\(reg->get_pgsz\(\)\),)676 1345 y
(b_end\(reg->get_start\(\)+reg->)q(get_p)q(gsz\()q(\)\))598
1436 y({)676 1528 y(assert\(reg!=NULL)j(&&)d(b_pgsz>0)h(&&)e
(reg->get_start\(\)>0\);)598 1619 y(})515 1793 y Fk(h)p
Fj(O\013)27 b(blo)l(ck)h(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g
Fk(i)p Fz(+)o Fq(\021)598 1885 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)639 2026 y Fz(The)h(blo)r(c)n(k)f(allo)r(cator)e
(uses)i(ra)n(w)g(memory)f(allo)r(cation)g(routines)h(to)h(request)e
(free)515 2125 y(pages)27 b(to)h(b)r(e)h(used)f(as)g(the)h(arra)n(y)d
(of)i(the)h Fx(SwAllocator)p Fz(.)34 b(Besides,)28 b(when)h(no)f(free)g
(no)r(de)515 2225 y(is)f(a)n(v)-5 b(ailable,)27 b(more)f(memory)h(will)
h(b)r(e)g(allo)r(cated.)515 2358 y Fk(h)p Fj(Other)g(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 2358 V 29 w(BlockAllocator)p
Fj(.)j Fk(i)p Fz(+)o Fq(\021)598 2449 y Fi(//)39 b(Allocates)j(units)e
(from)g(a)g(growing)g(store.)598 2540 y(//)f(Returns)i(NULL)f(when)h
(allocation)g(fails.)598 2632 y(void)f(*allocate\(boolean_t)j
(use_revocation=FALSE\))598 2723 y({)676 2814 y(if)d
(\(!get_nfree\(\)\))755 2906 y(grow\(\);)676 2997 y(return)h
(off_SwAllocator::allocate\(use_)q(revo)q(catio)q(n\);)598
3088 y(})1885 5255 y Fz(103)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
104 105 bop 639 523 a Fz(As)36 b(w)n(e)f(do)h(not)f(rede\014ne)g(allo)r
(cation)g(at)g(a)h(sp)r(eci\014ed)g(p)r(osition)f(\(w)n(e)g(do)h(no)n
(w)f(gro)n(w)515 623 y(automatically)f(in)i(suc)n(h)f(case\),)h(w)n(e)f
(b)r(e)h(careful)f(when)g(using)g(this)h(metho)r(d.)60
b(In)36 b(a)f(fu-)515 722 y(ture)g(k)n(ernel)f(v)n(ersion)g(the)h(arra)
n(y)e(should)i(gro)n(w)f(and)h(use)g(zero-\014ll)f(on)h(demand)g(k)n
(ernel)515 822 y(virtual)25 b(memory)-7 b(.)35 b(In)26
b(that)g(case,)f(the)h(allo)r(cation)e(algorithm)h(m)n(ust)g(b)r(e)h(c)
n(hanged)f(to)g(skip)515 922 y(sparse)19 b(allo)r(cated)h(no)r(des)g
(\(b)r(ecause)g(of)h(the)g(curren)n(t)e(assumption)h(that)h(ev)n(ery)e
(no)r(des)h(after)515 1021 y Fx(b)p 564 1021 27 4 v 31
w(next)26 b Fz(are)g(a)n(v)-5 b(ailable)27 b(will)g(no)h(longer)e
(hold\).)639 1121 y(T)-7 b(o)35 b(mak)n(e)g(the)g(arra)n(y)e(gro)n(w)h
(w)n(e)h(ask)f(for)h(another)f(page)h(of)g(memory)-7
b(.)59 b(W)-7 b(e)36 b(sp)r(ecify)515 1220 y(its)d(address)f(so)h(the)h
(arra)n(y)d(b)r(eha)n(v)n(es)h(as)h(an)g(arra)n(y)e(\(i.e.)55
b(it)34 b(is)f(con)n(tiguous\).)53 b(If)34 b(w)n(e)f(are)515
1320 y(using)e(k)n(ernel)g(virtual)h(memory)1554 1290
y Fp(12)1655 1320 y Fz(the)g(page)f(migh)n(t)h(b)r(e)g(zero-\014ll)f
(on)h(demand,)h(so)e(that)515 1420 y(w)n(e)c(could)g(mak)n(e)g(the)h
(arra)n(y)d(gro)n(w)h(arbitrarily)g(without)i(w)n(asting)e(ph)n(ysical)
h(memory)-7 b(.)515 1553 y Fk(h)p Fi(off)p 667 1553 24
4 v 29 w(BlockAllocator::grow)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 1644 y Fi(//)39 b(Resizes)i(the)f(store.)598
1735 y(//)f(Returns)i(non-zero)g(if)f(successful.)598
1826 y(boolean_t)h(off_BlockAllocator::grow\(void)q(\))598
1918 y({)676 2009 y(void)f(*olast=k_last;)676 2100 y(if)g
(\(b_region->pg_alloc\(b_end\))45 b(!=)40 b(b_end\))755
2192 y(return)g(FALSE;)676 2374 y(k_last)h(=)e
(k_idx->add\(k_first,k_idx->su)q(b_un)q(align)q(ed\(\()q(void*)q(\)b_e)
q(nd,k)q(_firs)q(t\)\);)676 2466 y(resize\(k_idx->sub\(k_last,ola)q
(st\)\);)676 2557 y(assert\(ptr_valid\(s_next\)\);)676
2648 y(return)i(TRUE;)598 2740 y(})p 515 4929 1146 4
v 577 4983 a Fm(12)642 5006 y Fl(Read,)24 b(if)e(there)j(is)e
Fe(dtlb)h Fl(supp)r(ort)g(in)f(the)i(k)n(ernel.)1885
5255 y Fz(104)p eop
PStoPSsaved restore
%%Page: (106,107) 54
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
105 106 bop 639 523 a Fz(A)28 b(t)n(yp)r(e)g(safe)f(blo)r(c)n(k)g(allo)
r(cator)f(is)i(also)e(pro)n(vided.)515 656 y Fk(h)p Fj(O\013)h(typ)l(e)
i(safe)e(blo)l(ck)i(al)t(lo)l(c)l(ator.)f Fk(i)p Fq(\021)598
747 y Fi(//)39 b(A)h(growing)h(allocator.)598 839 y(//)598
930 y(template)g(<class)f(T>)598 1021 y(class)g(off_TBlockAllocator:)k
(private)d(off_BlockAllocator)i({)598 1112 y(public:)676
1204 y(//)d(Allows)g(declarations)i(of)e(uninitialized)i(block)f
(allocators.)676 1295 y(off_TBlockAllocator\(void\))k(:)40
b(off_BlockAllocator\(\))j({;})676 1478 y(//)d(Creates)h(a)e(block)i
(allocator.)676 1569 y(off_TBlockAllocator\(off_Exha)q(usted)46
b(*r,)40 b(const)g(off_Indexable)i(*i,)1461 1660 y(off_KVMRegion)g
(*reg)e(\):)755 1752 y(off_BlockAllocator\(r,)k(i,)39
b(reg\))676 1843 y({do_debug\(putchar\('B'\)\);})676
2026 y(off_BlockAllocator::grow;)676 2300 y(//)h(Allocates)h(units)g
(from)f(a)f(growing)i(store.)676 2391 y(//)f(Returns)h(NULL)f(when)g
(allocation)h(fails.)676 2482 y(T)f(*allocate\(boolean_t)j
(use_revocation=FALSE\))h({)755 2574 y(return)c
(\(T*\)off_BlockAllocator::allo)q(cate)q(\(use_)q(revo)q(catio)q(n\);)
676 2665 y(})676 2756 y(T)g(*allocate\(natural_t)j(at,)d(boolean_t)h
(use_revocation=FALSE\))j({)755 2848 y(return)c
(\(T*\)off_SwAllocator::allocat)q(e\(at)q(,use_)q(revo)q(catio)q(n\);)
676 2939 y(})676 3030 y(void)80 b(deallocate\(T)42 b(*p\))d({)h
(off_BlockAllocator::deallocate)q(\(\(vo)q(id*\))q(p\);})676
3213 y(off_SwAllocator::is_free;)676 3304 y
(off_BKAllocator::get_nfree;)676 3396 y(off_BKAllocator::get_nalloc;)
676 3487 y(off_BKAllocator::get_maxallo)q(c;)676 3578
y(off_BKAllocator::get_num_all)q(ocrq;)676 3670 y
(off_BKAllocator::get_num_fre)q(erq;)676 3761 y
(off_BKAllocator::get_length;)676 3944 y(natural_t)h(pos\(T)g(*p\))f({)
f(return)i(off_KernAllocator::pos\(\(void*\))q(p\);)85
b(})676 4218 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4218 24 4 v 29 w(TBlockAllocator)p Fj(.)k
Fk(i)598 4309 y Fi(};)515 4575 y Fk(h)p Fj(O\013)c(blo)l(ck)h(al)t(lo)l
(c)l(ator)h(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
4666 y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40
b(for)g(do_debug)h(et)e(al.)1885 5255 y Fz(105)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
106 107 bop 639 523 a Fz(T)-7 b(o)32 b(allo)n(w)e(initialization)i(of)f
(pre-allo)r(cated)f Fx(TBlockAllocator)p Fz(s)c(an)31
b(op)r(erator)f Fx(new)515 623 y Fz(is)d(pro)n(vided.)515
756 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 756 24 4 v 29 w(TBlockAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 847 y Fi(void)40 b(*)f(operator)i(new\(size_t)h(s,)e(void)g
(*p\))g({)f(\(void\)s;)i(return)g(p;)e(})1885 5255 y
Fz(106)p eop
PStoPSsaved restore
%%Page: (108,109) 55
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
107 108 bop 515 523 a FA(The)32 b(paging)f(blo)s(c)m(k)h(allo)s(cator)
515 676 y Fz(The)d Fx(BlockAllocator)24 b Fz(is)30 b(used)g(in)g
Fy(O\013)17 b Fx(++)p Fz(,)29 b(most)h(of)f(the)h(times,)h(to)e(allo)r
(cate)g(abstract)515 776 y(system)h(resources)f(\(sh)n(uttles,)j(p)r
(ortals)d(and)i Ft(dtlb)p Fz(s\).)46 b(It)31 b(uses)f(k)n(ernel)g
(virtual)g(memory)515 876 y(b)r(ecause)g(it)h(is)f(desirable)g(to)h(a)n
(v)n(oid)e(static)h(limits)h(in)g(the)g(amoun)n(t)f(of)h(resources)d
(an)j(ap-)515 975 y(plication)e(can)f(allo)r(cate.)41
b(So,)30 b(eac)n(h)e(application)h(can)f(allo)r(cate,)h(for)g
(instance,)g(as)g(man)n(y)515 1075 y(sh)n(uttles)k(as)f(it)h(w)n(an)n
(ts)f(and)h(as)f(man)n(y)g(p)r(ortals)g(as)h(it)g(w)n(an)n(ts.)52
b(T)-7 b(o)32 b(implemen)n(t)i(that,)g(w)n(e)515 1174
y(c)n(hose)26 b(to)i(allo)r(cate)e(abstract)h(system)g(resources)f(in)i
(k)n(ernel)e(virtual)i(memory)-7 b(.)639 1274 y(Ho)n(w)n(ev)n(er,)25
b(adding)g(this)h(\015exibilit)n(y)g(to)g(the)g(allo)r(cator)e(could)i
(cause)f(problems)h(in)g(the)515 1374 y(case)36 b(when)i(a)f(single)f
(application)h(allo)r(cates)f(man)n(y)h(resources)e(\(e.g.)66
b(man)n(y)37 b(p)r(ortals\))515 1473 y(harming)26 b(other)h
(applications')g(p)r(erformance.)639 1573 y(W)-7 b(e)21
b(further)g(deriv)n(e)f Fx(BlockAllocator)15 b Fz(in)21
b Fx(PgBlkAllocator)15 b Fz(to)20 b(solv)n(e)g(this)h(problem)515
1673 y(b)n(y)h(allo)r(cating)e(elemen)n(tary)i(units)g(\(i.e.)35
b(sh)n(uttles,)24 b(p)r(ortals)d(and)h Ft(dtlb)p Fz(s\))g(so)f(that)h
(those)g(of)515 1772 y(a)g(particular)f(application)h(can)g(b)r(e)h
(paged)f(out)h(without)g(disturbing)f(other)g(applications.)515
1872 y(The)k(k)n(ernel)g(virtual)g(memory)g(ma)n(y)g(lo)r(ok)g(lik)n(e)
g(the)h(one)f(depicted)h(in)g(\014gure)f(2.6.)36 b(In)27
b(this)515 1971 y(situation)j(the)h(large)f(n)n(um)n(b)r(er)g(of)h(VM)g
(pages)f(used)g(to)h(store)f(one)g(of)h(the)g(applications')515
2071 y(\()p Fy(x\014g)7 b Fz(\))31 b(p)r(ortals)f(do)r(es)h(not)g(a)n
(v)n(oid)f(the)h(other)g(\()p Fy(gc)l(c)5 b Fz(\))32
b(to)e(ha)n(v)n(e)g(the)i(opp)r(ortunit)n(y)e(to)h(freely)515
2171 y(allo)r(cate)26 b(its)i(p)r(ortals.)515 3210 y
@beginspecial 0 @llx 0 @lly 465 @urx 150 @ury 3437 @rwi
@setspecial
%%BeginDocument: fig/prtlkvmem.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-12.0 190.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 1275 1050 m 1650 975 l 4087 975 l 4275 900 l gs col-1 s gr 
% Polyline
n 4275 900 m 4650 975 l 7087 975 l 7275 1050 l gs col-1 s gr 
% Polyline
n 525 1200 m 1275 1200 l 1275 1575 l 525 1575 l cp gs col-1 s gr 
% Polyline
n 525 1575 m 225 1575 l 300 1500 l 225 1350 l 300 1200 l 525 1200 l
 525 1575 l gs col-1 s gr 
15.000 slw
% Polyline
 [100.0] 0 sd
n 375 1875 m 1125 1875 l 1125 2250 l 375 2250 l cp gs col-1 s gr  [] 0 sd
7.500 slw
% Polyline
n 1275 1200 m 2025 1200 l 2025 1575 l 1275 1575 l cp gs 0.95 setgray ef gr gs col-1 s gr 
% Polyline
n 375 2775 m 1125 2775 l 1125 3150 l 375 3150 l cp gs 0.65 setgray ef gr gs col-1 s gr 
% Polyline
n 375 2325 m 1125 2325 l 1125 2700 l 375 2700 l cp gs 0.95 setgray ef gr gs col-1 s gr 
% Polyline
n 6525 1200 m 7275 1200 l 7275 1575 l 6525 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr 
% Polyline
n 7275 1200 m 7575 1200 l 7500 1275 l 7575 1425 l 7500 1575 l 7275 1575 l
 7275 1200 l gs col-1 s gr 
15.000 slw
% Polyline
 [100.0] 0 sd
n 2775 1200 m 3525 1200 l 3525 1575 l 2775 1575 l cp gs 0.95 setgray ef gr gs col-1 s gr  [] 0 sd
7.500 slw
% Polyline
n 2025 1200 m 2775 1200 l 2775 1575 l 2025 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr 
% Polyline
n 3525 1200 m 4275 1200 l 4275 1575 l 3525 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr 
15.000 slw
% Polyline
 [100.0] 0 sd
n 5775 1200 m 6525 1200 l 6525 1575 l 5775 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr  [] 0 sd
% Polyline
 [100.0] 0 sd
n 5025 1200 m 5775 1200 l 5775 1575 l 5025 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr  [] 0 sd
% Polyline
 [100.0] 0 sd
n 4275 1200 m 5025 1200 l 5025 1575 l 4275 1575 l cp gs 0.65 setgray ef gr gs col-1 s gr  [] 0 sd
/Times-Roman ff 180.00 scf sf
600 1425 m
gs 1 -1 sc (one page) col-1 sh gr
/Times-Roman ff 180.00 scf sf
3825 825 m
gs 1 -1 sc (Portal storage) col-1 sh gr
/Times-Italic ff 180.00 scf sf
1275 3015 m
gs 1 -1 sc (xfig's portals) col-1 sh gr
/Times-Italic ff 180.00 scf sf
1275 2550 m
gs 1 -1 sc (gcc's portals) col-1 sh gr
/Times-Italic ff 180.00 scf sf
1275 2100 m
gs 1 -1 sc (paged out) col-1 sh gr
/Times-Roman ff 180.00 scf sf
6300 1800 m
gs 1 -1 sc (Kernel virtual memory) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 858 3393 a(Figure)f(2.6:)36 b(Storage)27
b(of)g(P)n(ortals)f(for)h(t)n(w)n(o)f(di\013eren)n(t)i(applications.)
639 3675 y(As)e(the)h(system)e(do)r(es)h(not)g(kno)n(w)f(what)h(a)f
(\\user)g(application")g(is,)h(it)h(is)e(not)h(p)r(ossible)515
3775 y(to)33 b(mak)n(e)f(the)h(allo)r(cator)e(use)i(a)g(di\013eren)n(t)
g(page)f(for)h(eac)n(h)f(application.)52 b(Ho)n(w)n(ev)n(er,)33
b(the)515 3875 y Fx(PgBlkAllocator)27 b Fz(can)32 b(use)h(the)g
(resource)e(domain)h(iden)n(ti\014er)h(\()p Fx(r)p 2676
3875 27 4 v 31 w(domain)p Fz(\))e(as)h(a)h(hin)n(t.)515
3974 y(So,)k(what)f(w)n(e)f(actually)g(do)h(is)g(to)f(use)h(a)f
(di\013eren)n(t)h(set)g(of)f(virtual)h(memory)f(pages)f(to)515
4074 y(allo)r(cate)26 b(resources)g(for)h(eac)n(h)g(application)g
(domain.)639 4173 y(T)-7 b(o)27 b(kno)n(w)g(where)g(to)g(place)g(allo)r
(cated)g(resources,)e(w)n(e)i(use)g Fx(r)p 2577 4173
V 31 w(domain)p Fz(.)35 b(A)28 b(new)f(alter-)515 4273
y(nate)32 b(allo)r(cation)g(metho)r(d)h(receiv)n(es)e(suc)n(h)h(v)-5
b(alue)33 b(and)f(tries)g(to)h(allo)r(cate)f(memory)f(suc)n(h)515
4373 y(that)e(it)g(is)g(surrounded)f(b)n(y)g(other)h(resources)d(with)k
(the)f(same)f Fx(r)p 2586 4373 V 31 w(domain)p Fz(.)39
b(As)29 b(of)g(to)r(da)n(y)-7 b(,)515 4472 y(it)28 b(is)f(not)h
(implemen)n(ted.)515 4605 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 4605 24 4 v 29 w(PgBlkAllocator)p Fj(.)j
Fk(i)p Fq(\021)598 4697 y Fi(//)39 b(Allocates)j(\(deallocates\))g
(units)e(from)g(a)g(growing)h(store)598 4788 y(//)e(for)h(the)g(given)h
(domain.)f(--Not)h(implemented.)h(XXX)598 4879 y(T)d
(*allocate\(off_prtl_id_t)45 b(domain,)40 b(boolean_t)i
(use_revocation=FALSE\){return)j(NULL;})1885 5255 y Fz(107)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
108 109 bop 515 523 a FA(F)-8 b(reezing)31 b(allo)s(cators)515
676 y Fz(No)n(w)g(w)n(e)h(get)g(in)n(to)g(an)g(in)n(teresting)g(part,)g
(freezing)g(and)g(melting)g(an)g(allo)r(cator.)49 b(Some)515
776 y(w)n(ork)33 b(needs)i(to)g(b)r(e)g(done)g(in)g(those)g(allo)r
(cators)e(using)h(link)n(ed)h(lists)g(to)g(obtain)f(and)h(to)515
876 y(melt)28 b(a)f(frozen)g(image.)515 1008 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1008
24 4 v 29 w(SwAllocator)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
1100 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598 1191
y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e(buf)h
(with)g(avail)h(bytes.)598 1282 y(virtual)g(err_t)f(freeze_state\(char)
j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657 1374
y(char)g(*&curto,)h(size_t)g(&toavail\);)598 1465 y(//)e(Restores)i
(dynamic)g(resource)g(state.)598 1556 y(virtual)g(err_t)f
(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g(char)f(*&from,)h
(size_t)f(&size\);)515 1822 y Fk(h)p Fj(O\013)27 b(softwar)l(e)i(al)t
(lo)l(c)l(ator)f(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
1913 y Fi(#include)41 b(<klib/err.h>)639 2054 y Fz(It)19
b(is)g(done)f(b)n(y)h(these)g(metho)r(ds)g(whic)n(h)f(are)g(also)g
(supp)r(orted)g(b)n(y)h(the)g(t)n(yp)r(e)g(safe)f(v)n(ersions)515
2154 y(of)27 b(the)h(allo)r(cator)e(and)i(its)f(sub)r(classes.)515
2270 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2270 V 29 w(TBlockAllocator)p Fj(.)j Fk(i)p Fz(+)p
Fq(\021)598 2362 y Fi(off_SwAllocator::freeze_state;)598
2453 y(off_SwAllocator::melt_state;)515 2611 y Fk(h)p
Fj(Other)e(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2611
V 29 w(TFixedAllocator)p Fj(.)j Fk(i)p Fz(+)p Fq(\021)598
2702 y Fi(off_SwAllocator::freeze_state;)598 2793 y
(off_SwAllocator::melt_state;)1885 5255 y Fz(108)p eop
PStoPSsaved restore
%%Page: (110,111) 56
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
109 110 bop 639 523 a Fz(The)19 b(allo)r(cator)d(main)n(tains)i(list)h
(p)r(oin)n(ters)e(whic)n(h)i(m)n(ust)f(b)r(e)h(translated)e(to)i(a)f(p)
r(ortable)3314 493 y Fp(13)515 623 y Fz(represen)n(tation.)35
b(W)-7 b(e)27 b(simple)h(assume)e(that)i(the)g(allo)r(cator)d(p)r(oin)n
(ters)i(are)f(within)i(a)f(con-)515 722 y(tiguous)22
b(range)f(of)i(memory)-7 b(.)35 b(In)22 b(suc)n(h)h(case)f(they)h(can)f
(b)r(e)h(adjusted)g(on)g(a)f(melt)h(op)r(eration)515
822 y(b)n(y)32 b(adding)f(to)h(them)h(the)g(o\013set)f(b)r(et)n(w)n
(een)g(the)g(starting)g(address)f(prior)f(to)j(freeze)e(and)515
922 y(the)23 b(starting)g(address)f(at)h(melt)g(time.)36
b(Th)n(us,)24 b(it)g(su\016ces)f(to)g(store)f(in)i Fx(buf)e
Fz(the)h(address)f(of)515 1021 y(the)i(\014rst)g Fx(PFrame)e
Fz(in)i(the)g(allo)r(cator)f(so)g(that)h(w)n(e)g(can)g(compute)g(the)g
(o\013set)g(at)g(melt)h(time.)515 1121 y(Besides,)31
b(if)h(the)g(user)e(supplied)i(a)f Fx(curto)e Fz(bu\013er)i(the)h
(whole)f(state)g(of)g(the)h(allo)r(cator)d(is)515 1220
y(copied.)515 1353 y Fk(h)p Fi(off)p 667 1353 24 4 v
29 w(SwAllocator::freeze)p 1437 1353 V 32 w(state)g Fj(implementation.)
e Fk(i)p Fq(\021)598 1445 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
1536 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 1627 y(err_t)f
(off_SwAllocator::freeze_state)q(\(cha)q(r)45 b(*buf,)40
b(char)h(*&curbuf,)g(size_t)f(&avail,)2010 1719 y(char)g(*&curto,)h
(size_t)g(&toavail\))598 1810 y({)676 1901 y(assert\(buf)h(&&)d
(curbuf\);)676 1993 y(if)h(\(sizeof\(void*\))82 b(>)39
b(avail)h(||)833 2084 y(\(curto)h(&&)e(\(k_last-k_first\)*k_idx->sz\()q
(\))45 b(>)39 b(toavail\))i(\))755 2175 y(return)f(ENOSPC;)676
2267 y(*\(void**\)curbuf)j(=)c(k_first;)676 2358 y(curbuf)i(+=)e
(sizeof\(void*\);)676 2449 y(avail)80 b(-=)39 b(sizeof\(void*\);)676
2540 y(if)h(\(curto\))h({)755 2632 y(vm_size_t)g
(size=k_idx->sub\(k_last,k_firs)q(t\)*k_)q(idx-)q(>sz\(\))q(;)755
2723 y(memcpy\(curto,k_first,size\);)755 2814 y(curto)118
b(+=)40 b(size;)755 2906 y(toavail)g(-=)g(size;)676 2997
y(})676 3088 y(return)h(EOK;)598 3180 y(})515 3445 y
Fk(h)p Fj(O\013)27 b(softwar)l(e)i(al)t(lo)l(c)l(ator)f(implementation)
g(dep)l(endencies.)i Fk(i)p Fq(\021)598 3537 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)p 515 4850 1146
4 v 577 4904 a Fm(13)642 4927 y Fl(Note)24 b(that)g(w)n(e)f(do)h
Ff(not)29 b Fl(mean)22 b(to)i(a)f(net)n(w)n(ork)h(represen)n(tation.)33
b(With)23 b(p)r(ortable)h(w)n(e)f(actually)h(mean)515
5006 y(\\self-con)n(tained".)1885 5255 y Fz(109)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
110 111 bop 639 523 a Fz(Using)28 b(it,)g(w)n(e)f(can)g(write:)515
656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(SwAllocator::melt)p
1359 656 V 32 w(state)h Fj(implementation.)g Fk(i)p Fq(\021)598
747 y Fi(//)39 b(Restores)i(dynamic)g(resource)g(state.)598
839 y(err_t)f(off_SwAllocator::melt_state\(c)q(har)46
b(*&buf,)40 b(size_t)h(&bsize,)1931 930 y(char)g(*&from,)f(size_t)h
(&size\))598 1021 y({)676 1112 y(vm_offset_t)h(offset;)676
1204 y(vm_size_t)120 b(rawsize=k_idx->sub\(k_last,k_f)q(irst\))q(*k_i)q
(dx->s)q(z\(\);)676 1295 y(assert\(buf\);)676 1386 y(if)40
b(\(sizeof\(void*\))82 b(<)39 b(bsize)h(||)833 1478 y(\(from)g(&&)79
b(rawsize)41 b(<)f(size\))g(\))755 1569 y(return)g(ENOSPC;)676
1752 y(offset=)h(\(char*\)*\(char**\)buf)j(-)78 b(\(char*\)k_first;)676
1843 y(buf)40 b(+=)g(sizeof\(void*\);)676 1934 y(bsize-=)h
(sizeof\(void*\);)676 2117 y(::adjust\(k_first,offset\);)676
2208 y(::adjust\(k_last,offset\);)676 2300 y
(::adjust\(s_next,offset\);)676 2574 y(if)f(\(from\))g({)755
2665 y(memcpy\(k_first,from,rawsize\);)755 2756 y(from)g(+=)f(rawsize;)
755 2848 y(size)h(-=)f(rawsize;)676 2939 y(})676 3122
y(s_free.adjust\(offset\);)676 3304 y(return)i(EOK;)598
3396 y(})639 3537 y Fz(A)28 b(function)g(template)g(to)g(adjust)g(p)r
(oin)n(ters)f(w)n(as)f(handy)i(no)n(w)515 3653 y Fk(h)p
Fi(adjust)g Fj(utilities.)f Fk(i)p Fq(\021)598 3744 y
Fi(template)41 b(<class)f(T>)598 3836 y(void)g(adjust\()h(T)e(*&p,)h
(const)h(int)f(offset\){)676 3927 y(p)g(=)f(\(p\))h(?)f(\()h
(\(T*\)\(\(char*\)p)i(+)e(offset\))g(\))990 4018 y(:)118
b(\(\(T*\)NULL\);)598 4110 y(})515 4359 y Fk(h)p Fj(Other)28
b(utilities)g(for)f Fi(freeze)p Fj(.)h Fk(i)p Fq(\021)598
4450 y Fk(h)p Fi(adjust)g Fj(utilities.)f Fk(i)515 4624
y(h)p Fj(O\013)g(softwar)l(e)i(al)t(lo)l(c)l(ator)f(implementation)g
(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 4716 y
Fi(#include)41 b(<klib/freeze.h>)317 b(//)40 b(for)g(adjust)1885
5255 y Fz(110)p eop
PStoPSsaved restore
%%Page: (112,113) 57
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
111 112 bop 639 523 a Fz(The)26 b Fx(adjust)d Fz(pro)n(vided)h(b)n(y)h
(the)h Fx(DLinkedList)20 b Fz(will)26 b(carefully)f(adjust)g(ev)n(ery)f
(link)i(in)515 623 y(it)i(b)n(y)f(the)h(giv)n(en)f(o\013set.)515
739 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(DLinkedList)p
Fj(.)i Fk(i)p Fq(\021)598 830 y Fi(//)39 b(Adjusts)i(pointers)g(by)f
(offset.)598 922 y(void)g(adjust\()h(int)f(offset\);)515
1079 y Fk(h)p Fi(DLinkedList::adjust)31 b Fj(implementation.)d
Fk(i)p Fq(\021)598 1171 y Fi(//)39 b(Adjusts)i(pointers)g(by)f(offset.)
598 1262 y(void)g(DLinkedList::adjust\()k(int)c(offset\))598
1353 y({)676 1445 y(DLinkedNode)i(*n;)676 1536 y
(::adjust\(l_head,offset\);)676 1627 y(::adjust\(l_tail,offset\);)676
1719 y(n=l_head;)676 1810 y(do{)755 1901 y
(::adjust\(n->l_prev,offset\);)755 1993 y
(::adjust\(n->l_next,offset\);)755 2084 y(n=n->l_next;)676
2175 y(})e(while)g(\(n)g(!=)f(l_head\);)676 2267 y(assert\(valid\);)598
2358 y(})515 2532 y Fk(h)p Fj(Implementation)28 b(of)f(other)i(public)e
(metho)l(ds)i(of)e Fi(DLinkedList)p Fj(.)j Fk(i)p Fq(\021)598
2623 y Fk(h)p Fi(DLinkedList::adjust)h Fj(implementation.)d
Fk(i)515 2798 y(h)p Fj(Double)f(linke)l(d)h(list)f(implementation)h
(dep)l(endencies.)i Fk(i)p Fq(\021)598 2889 y Fi(#include)41
b(<klib/freeze.h>)317 b(//)40 b(for)g(adjust)1885 5255
y Fz(111)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
112 113 bop 639 523 a Fz(Once)33 b(a)g(soft)n(w)n(are)e(allo)r(cator)g
(can)i(b)r(e)g(frozen,)h(a)f(sparse)e(bitmap)j(allo)r(cator)d(can)i(b)r
(e)515 623 y(frozen)27 b(to)r(o.)722 805 y FA(NOTE:)22
b Fz(XXX)h(add)f(freeze)g(and)g(melt)h(state)f(for)g(sparse)f(bitmaps.)
35 b(It's)23 b(just)722 905 y(a)i(simple)f(delegation)g(to)h(the)g
(\014xed)g(allo)r(cator)e(they)i(use)f(to)h(allo)r(cate)f(no)r(des.)722
1088 y FA(NOTE:)36 b Fz(XXX)h(mo)r(dify)g(allo)r(cator)e(and)h(bank)h
(freezing.)63 b(The)36 b(allo)r(cator)722 1187 y(should)30
b(remain)g(un)n(touc)n(hed)g(and)g(it)h(is)f(probably)f(wiser)h(to)g
(cop)n(y)f(resource)722 1287 y(unit)g(state)e(eagerly)f(and)h(not)h
(lazily)-7 b(.)515 1503 y FA(Kernel)31 b(allo)s(cators)g
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 1656 y Fz(The)27
b(indexer)h(is)f(found)h(in)g Fx(klib/Indexer.h)515 1789
y Fk(h)p Fj(Indexer.h*)11 b Fk(i)q Fq(\021)598 1880 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 1971 y Fi(#ifndef)41 b(__OFF_INDEXER_H)598
2063 y(#define)g(__OFF_INDEXER_H)h(1)598 2245 y Fk(h)p
Fj(O\013)27 b(indexer)i(dep)l(endencies.)g Fk(i)598 2428
y Fi(#ifdef)40 b(__KERNEL__)598 2519 y Fk(h)p Fj(O\013)27
b(indexer.)h Fk(i)598 2611 y(h)p Fj(O\013)f(indexable.)h
Fk(i)598 2702 y Fi(#endif)40 b(//)g(__KERNEL__)598 2885
y(#endif)g(//)g(__OFF_INDEXER_H)639 3026 y Fz(The)19
b(k)n(ernel)e(allo)r(cator)g(is)h(at)g Fx(klib/KernAllocato)o(r.)o(h)12
b Fz(and)19 b Fx(klib/KernAlloca)o(tor)o(.C)o Fz(.)515
3159 y Fk(h)p Fj(KernA)n(l)t(lo)l(c)l(ator.h*)11 b Fk(i)q
Fq(\021)598 3250 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 3341 y Fi(#ifndef)41
b(__OFF_KERN_ALLOCATOR_H)598 3433 y(#define)g(__OFF_KERN_ALLOCATOR_H)j
(1)598 3615 y Fk(h)p Fj(O\013)27 b(b)l(asic)h(kernel)g(al)t(lo)l(c)l
(ator)h(dep)l(endencies.)g Fk(i)598 3798 y Fi(#ifdef)40
b(__KERNEL__)598 3889 y Fk(h)p Fj(O\013)27 b(b)l(asic)h(kernel)g(al)t
(lo)l(c)l(ator.)h Fk(i)598 4072 y Fi(#endif)40 b(//)g(__KERNEL__)598
4254 y(#endif)g(//)g(__OFF_KERN_ALLOCATOR_H)515 4429
y Fk(h)p Fj(KernA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q
Fq(\021)598 4520 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 4703 y Fi(#include)41
b(<klib/KernAllocator.h>)j(//)c(Exported)h(interface.)598
4885 y Fk(h)p Fi(off)p 750 4885 24 4 v 29 w(KernAllocator::operator+)32
b Fj(and)c Fi(operator-)i Fj(implementation.)d Fk(i)1885
5255 y Fz(112)p eop
PStoPSsaved restore
%%Page: (114,115) 58
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
113 114 bop 639 523 a Fz(Bitmap)19 b(allo)r(cator)f(co)r(de)g(is)h(at)g
Fx(klib/BmAllocator)o(.h)13 b Fz(and)18 b Fx(klib/BmAllocator.)o(C)p
Fz(.)515 640 y Fk(h)p Fj(BmA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)p Fq(\021)598 732 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 823 y
Fi(#ifndef)41 b(__OFF_BM_ALLOCATOR_H)598 914 y(#define)g
(__OFF_BM_ALLOCATOR_H)i(1)598 1097 y Fk(h)p Fj(O\013)27
b(bitmap)h(al)t(lo)l(c)l(ator)g(dep)l(endencies.)i Fk(i)598
1188 y Fi(#ifdef)40 b(__KERNEL__)598 1280 y Fk(h)p Fj(O\013)27
b(bitmap)h(al)t(lo)l(c)l(ator.)g Fk(i)598 1371 y(h)p
Fj(O\013)f(typ)l(e)i(safe)e(bitmap)h(al)t(lo)l(c)l(ator.)h
Fk(i)598 1462 y Fi(#endif)40 b(//)g(__KERNEL__)598 1645
y(#endif)g(//)g(__OFF_BM_ALLOCATOR_H)515 1789 y Fk(h)p
Fj(BmA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)p Fq(\021)598
1880 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2063 y Fi(#include)41
b(<klib/BmAllocator.h>)122 b(//)40 b(Exported)h(interface.)598
2245 y Fk(h)p Fi(off)p 750 2245 24 4 v 29 w(BmAllocator::allocate)32
b Fj(and)c Fi(deallocate)h Fj(implementation.)f Fk(i)639
2462 y Fz(Soft)n(w)n(are)17 b(allo)r(cator)g(co)r(de)h(can)g(b)r(e)h
(found)g(in)f Fx(klib/SwAllocator.)o(h)12 b Fz(and)18
b Fx(klib/SwAllocator.)o(C)p Fz(.)515 2580 y Fk(h)p Fj(SwA)n(l)t(lo)l
(c)l(ator.h*)11 b Fk(i)q Fq(\021)598 2671 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2762 y Fi(#ifndef)41 b(__OFF_SW_ALLOCATOR_H)598
2854 y(#define)g(__OFF_SW_ALLOCATOR_H)i(1)598 3036 y
Fk(h)p Fj(O\013)27 b(softwar)l(e)i(al)t(lo)l(c)l(ator)f(dep)l
(endencies.)i Fk(i)598 3128 y Fi(#ifdef)40 b(__KERNEL__)598
3219 y Fk(h)p Fj(O\013)27 b(softwar)l(e)i(al)t(lo)l(c)l(ator.)f
Fk(i)598 3310 y Fi(#endif)40 b(//)g(__KERNEL__)598 3493
y(#endif)g(//)g(__OFF_SW_ALLOCATOR_H)598 3676 y Fk(h)p
Fj(O\013)27 b(softwar)l(e)i(al)t(lo)l(c)l(ator)f(implementation)g(dep)l
(endencies.)i Fk(i)515 4093 y(h)p Fj(SwA)n(l)t(lo)l(c)l(ator.C*)11
b Fk(i)p Fq(\021)598 4184 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4367 y Fi(#include)41 b(<klib/SwAllocator.h>)122 b(//)40
b(Exported)h(interface.)598 4458 y Fk(h)p Fj(O\013)27
b(softwar)l(e)i(al)t(lo)l(c)l(ator)f(implementation)g(dep)l(endencies.)
i Fk(i)598 4641 y(h)p Fi(off)p 750 4641 V 29 w(SwAllocator::allocate)i
Fj(implementation.)27 b Fk(i)598 4732 y(h)p Fi(off)p
750 4732 V 29 w(SwAllocator::deallocate)32 b Fj(implementation.)c
Fk(i)598 4824 y(h)p Fi(off)p 750 4824 V 29 w(SwAllocator::freeze)p
1520 4824 V 32 w(state)h Fj(implementation.)e Fk(i)598
4915 y(h)p Fi(off)p 750 4915 V 29 w(SwAllocator::melt)p
1442 4915 V 32 w(state)h Fj(implementation.)g Fk(i)1885
5255 y Fz(113)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
114 115 bop 639 523 a Fz(Fixed)28 b(allo)r(cator)e(co)r(de)h(is)h(con)n
(tained)f(in)h Fx(klib/FixedAlloc)o(ato)o(r.)o(h)p Fz(.)515
656 y Fk(h)p Fj(Fixe)l(dA)n(l)t(lo)l(c)l(ator.h*)11 b
Fk(i)q Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y
Fi(#ifndef)41 b(__OFF_FIXED_ALLOCATOR_H)598 930 y(#define)g
(__OFF_FIXED_ALLOCATOR_H)j(1)598 1112 y Fk(h)p Fj(O\013)27
b(\014xe)l(d)h(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g
Fk(i)598 1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y
Fk(h)p Fj(O\013)27 b(\014xe)l(d)h(al)t(lo)l(c)l(ator.)h
Fk(i)598 1478 y(h)p Fj(O\013)e(typ)l(e)i(safe)e(\014xe)l(d)i(al)t(lo)l
(c)l(ator.)f Fk(i)598 1569 y Fi(#endif)40 b(//)g(__KERNEL__)598
1752 y(#endif)g(//)g(__OFF_FIXED_ALLOCATOR_H)639 1984
y Fz(The)19 b(sparse)e(allo)r(cator)f(can)i(b)r(e)h(found)g(in)f
Fx(klib/SparseAlloca)o(tor)o(.h)12 b Fz(and)18 b Fx(klib/SparseAlloc)o
(ato)o(r.)o(C)p Fz(.)515 2117 y Fk(h)p Fj(Sp)l(arseA)n(l)t(lo)l(c)l
(ator.h*)11 b Fk(i)r Fq(\021)598 2208 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2300 y Fi(#ifndef)41 b(__OFF_SPARSE_ALLOCATOR_H)598
2391 y(#define)g(__OFF_SPARSE_ALLOCATOR_H)j(1)598 2574
y Fk(h)p Fj(O\013)27 b(sp)l(arse)i(al)t(lo)l(c)l(ator)g(dep)l
(endencies.)g Fk(i)598 2756 y Fi(#ifdef)40 b(__KERNEL__)598
2848 y Fk(h)p Fj(O\013)27 b(sp)l(arse)i(al)t(lo)l(c)l(ator.)f
Fk(i)598 2939 y(h)p Fj(O\013)f(typ)l(e)i(safe)e(sp)l(arse)j(al)t(lo)l
(c)l(ator.)e Fk(i)598 3030 y Fi(#endif)40 b(//)g(__KERNEL__)598
3304 y(#endif)g(//)g(__OFF_SPARSE_ALLOCATOR_H)515 3479
y Fk(h)p Fj(Sp)l(arseA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)r
Fq(\021)598 3570 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 3753 y Fi(#include)41
b(<klib/SparseAllocator.h>)j(//)c(Exported)h(interface.)598
3935 y Fk(h)p Fi(off)p 750 3935 24 4 v 29 w(SparseAllocator::allocate)
33 b Fj(implementation.)27 b Fk(i)598 4027 y(h)p Fi(off)p
750 4027 V 29 w(SparseAllocator::lookup)32 b Fj(implementation.)c
Fk(i)598 4118 y(h)p Fi(off)p 750 4118 V 29 w
(SparseAllocator::deallocate)33 b Fj(implementation.)28
b Fk(i)598 4209 y(h)p Fi(off)p 750 4209 V 29 w
(SparseAllocator::operator+)33 b Fj(implementation.)27
b Fk(i)598 4301 y(h)p Fi(off)p 750 4301 V 29 w(SparseAllocator::pos)32
b Fj(implementation.)27 b Fk(i)1885 5255 y Fz(114)p eop
PStoPSsaved restore
%%Page: (116,117) 59
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
115 116 bop 639 523 a Fz(The)28 b(blo)r(c)n(k)f(allo)r(cator)f(stands)h
(at)h Fx(klib/BlockAlloc)o(ato)o(r.)o(h)p Fz(.)515 656
y Fk(h)p Fj(Blo)l(ckA)n(l)t(lo)l(c)l(ator.h*)11 b Fk(i)q
Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y Fi(#ifndef)41
b(__OFF_BLOCK_ALLOCATOR_H)598 930 y(#define)g(__OFF_BLOCK_ALLOCATOR_H)j
(1)598 1112 y Fk(h)p Fj(O\013)27 b(blo)l(ck)h(al)t(lo)l(c)l(ator)h(dep)
l(endencies.)g Fk(i)598 1295 y Fi(#ifdef)40 b(__KERNEL__)598
1386 y Fk(h)p Fj(O\013)27 b(blo)l(ck)h(al)t(lo)l(c)l(ator.)g
Fk(i)598 1478 y(h)p Fj(O\013)f(typ)l(e)i(safe)e(blo)l(ck)i(al)t(lo)l(c)
l(ator.)f Fk(i)598 1569 y Fi(#endif)40 b(//)g(__KERNEL__)598
1752 y(#endif)g(//)g(__OFF_BLOCK_ALLOCATOR_H)515 2017
y Fk(h)p Fj(Blo)l(ckA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q
Fq(\021)598 2109 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2291 y Fi(#include)41
b(<klib/BlockAllocator.h>)j(//)c(Exported)h(interface.)598
2474 y Fk(h)p Fi(off)p 750 2474 24 4 v 29 w(BlockAllocator::off)p
1520 2474 V 32 w(BlockAllocator)31 b Fj(implementation.)c
Fk(i)598 2565 y(h)p Fi(off)p 750 2565 V 29 w(BlockAllocator::grow)32
b Fj(implementation.)27 b Fk(i)1885 5255 y Fz(115)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
116 117 bop 515 2284 a @beginspecial 0 @llx 0 @lly 637
@urx 318 @ury 4252 @rwi @setspecial
%%BeginDocument: fig/hwsrvres.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-3.0 339.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
 [15 50.0] 50.0 sd
n 3075 1200 m 2925 1350 l 3225 1350 l 3075 1200 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 3075 975 m 3075 1200 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 3975 3375 m 3825 3525 l 4125 3525 l 3975 3375 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 3975 3150 m 3975 3375 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 1275 m 8100 1425 l 8400 1425 l 8250 1275 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 1050 m 8250 1275 l gs col-1 s gr  [] 0 sd
% Ellipse
n 7800 750 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
7578 720 m 7698 750 l 7578 780 l 7740 780 l 7740 720 l  cp clip
n 7425 750 m 7725 750 l gs col-1 s gr gr

% arrowhead
n 7578 720 m 7698 750 l 7578 780 l  col-1 s
% Polyline
n 4500 2625 m 4644 2700 l 4788 2625 l 4644 2550 l 4500 2625 l gs col-1 s gr 
% Polyline
n 4788 2625 m 5005 2625 l gs col-1 s gr 
% Ellipse
n 8252 2625 73 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
8034 2595 m 8154 2625 l 8034 2655 l 8196 2655 l 8196 2595 l  cp clip
n 7891 2625 m 8181 2625 l gs col-1 s gr gr

% arrowhead
n 8034 2595 m 8154 2625 l 8034 2655 l  col-1 s
% Polyline
n 5005 2625 m 7964 2625 l gs col-1 s gr 
% Polyline
n 5175 3075 m 5325 3150 l 5474 3075 l 5325 3000 l 5175 3075 l gs col-1 s gr 
% Polyline
n 5474 3075 m 5700 3075 l gs col-1 s gr 
% Ellipse
n 9074 3075 76 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
8853 3045 m 8973 3075 l 8853 3105 l 9015 3105 l 9015 3045 l  cp clip
n 8699 3075 m 9000 3075 l gs col-1 s gr gr

% arrowhead
n 8853 3045 m 8973 3075 l 8853 3105 l  col-1 s
% Polyline
n 5700 3075 m 8775 3075 l gs col-1 s gr 
% Polyline
n 6150 3600 m 6300 3675 l 6450 3600 l 6300 3525 l 6150 3600 l gs col-1 s gr 
% Polyline
n 6450 3600 m 6675 3600 l gs col-1 s gr 
% Ellipse
n 6900 3600 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6678 3570 m 6798 3600 l 6678 3630 l 6840 3630 l 6840 3570 l  cp clip
n 6525 3600 m 6825 3600 l gs col-1 s gr gr

% arrowhead
n 6678 3570 m 6798 3600 l 6678 3630 l  col-1 s
% Polyline
n 750 2700 m 900 2775 l 1050 2700 l 900 2625 l 750 2700 l gs col-1 s gr 
% Polyline
n 1050 2700 m 1275 2700 l gs col-1 s gr 
% Polyline
n 4875 5325 m 5025 5400 l 5174 5325 l 5025 5250 l 4875 5325 l gs col-1 s gr 
% Polyline
n 5174 5325 m 5400 5325 l gs col-1 s gr 
% Ellipse
n 8774 5325 76 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
8553 5295 m 8673 5325 l 8553 5355 l 8715 5355 l 8715 5295 l  cp clip
n 8399 5325 m 8700 5325 l gs col-1 s gr gr

% arrowhead
n 8553 5295 m 8673 5325 l 8553 5355 l  col-1 s
% Polyline
n 5400 5325 m 8475 5325 l gs col-1 s gr 
% Polyline
n 3825 4575 m 3980 4650 l 4136 4575 l 3980 4500 l 3825 4575 l gs col-1 s gr 
% Polyline
n 4136 4575 m 4370 4575 l gs col-1 s gr 
% Ellipse
n 7871 4575 79 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
7648 4545 m 7768 4575 l 7648 4605 l 7810 4605 l 7810 4545 l  cp clip
n 7482 4575 m 7795 4575 l gs col-1 s gr gr

% arrowhead
n 7648 4545 m 7768 4575 l 7648 4605 l  col-1 s
% Polyline
n 4370 4575 m 7561 4575 l gs col-1 s gr 
% Polyline
n 7200 3900 m 7125 4050 l 7200 4200 l 7275 4050 l 7200 3900 l gs col-1 s gr 
% Polyline
n 7200 4200 m 7200 4425 l gs col-1 s gr 
% Polyline
n 3525 2400 m 4500 2400 l 4500 3150 l 3525 3150 l cp gs col-1 s gr 
% Polyline
n 3525 2650 m 4500 2650 l gs col-1 s gr 
% Polyline
n 4425 750 m 4575 825 l 4725 750 l 4575 675 l 4425 750 l gs col-1 s gr 
% Polyline
n 4725 750 m 4950 750 l gs col-1 s gr 
% Polyline
n 2775 375 m 4425 375 l 4425 975 l 2775 975 l cp gs col-1 s gr 
% Polyline
n 2775 575 m 4425 575 l gs col-1 s gr 
% Polyline
n 7875 375 m 8925 375 l 8925 1050 l 7875 1050 l cp gs col-1 s gr 
% Polyline
n 7875 600 m 8925 600 l gs col-1 s gr 
% Polyline
n 2775 2300 m 3450 2300 l gs col-1 s gr 
% Polyline
n 2775 2100 m 3450 2100 l 3450 2700 l 2775 2700 l cp gs col-1 s gr 
% Polyline
n 3450 2250 m 3594 2325 l 3738 2250 l 3594 2175 l 3450 2250 l gs col-1 s gr 
% Polyline
n 3738 2250 m 3955 2250 l gs col-1 s gr 
% Ellipse
n 7202 2250 73 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6984 2220 m 7104 2250 l 6984 2280 l 7146 2280 l 7146 2220 l  cp clip
n 6842 2250 m 7131 2250 l gs col-1 s gr gr

% arrowhead
n 6984 2220 m 7104 2250 l 6984 2280 l  col-1 s
% Polyline
n 3955 2250 m 6914 2250 l gs col-1 s gr 
% Polyline
n 6975 3300 m 8100 3300 l 8100 3900 l 6975 3900 l cp gs col-1 s gr 
% Polyline
n 6975 3500 m 8100 3500 l gs col-1 s gr 
% Polyline
n 9675 3450 m 10650 3450 l 10650 4050 l 9675 4050 l cp gs col-1 s gr 
% Polyline
n 9675 3650 m 10650 3650 l gs col-1 s gr 
/Courier ff 165.00 scf sf
9750 3600 m
gs 1 -1 sc (ProcSlot) col-1 sh gr
% Polyline
n 6450 1575 m 7200 1575 l 7200 2100 l 6450 2100 l cp gs col-1 s gr 
% Polyline
n 6450 1750 m 7200 1750 l gs col-1 s gr 
% Polyline
n 2700 1800 m 2841 1875 l 2983 1800 l 2841 1725 l 2700 1800 l gs col-1 s gr 
% Polyline
n 2983 1800 m 3195 1800 l gs col-1 s gr 
% Ellipse
n 6379 1800 71 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6162 1770 m 6282 1800 l 6162 1830 l 6324 1830 l 6324 1770 l  cp clip
n 6025 1800 m 6309 1800 l gs col-1 s gr gr

% arrowhead
n 6162 1770 m 6282 1800 l 6162 1830 l  col-1 s
% Polyline
n 3195 1800 m 6096 1800 l gs col-1 s gr 
% Polyline
n 3900 1350 m 3900 1350 l gs col-1 s gr
% Polyline
 [15 50.0] 50.0 sd
n 2325 1575 m 2325 1350 l 4875 1350 l 4875 2925 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 3075 1350 m 3075 2100 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 4050 1350 m 4050 2400 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 4950 1350 m 5700 1350 l 5700 3225 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 3375 4350 m 3375 3525 l 4500 3525 l 4500 5025 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 1425 m 8625 1425 l 8625 2250 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 1425 m 9675 1425 l 9675 2625 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8175 1425 m 6900 1425 l 6900 1575 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 1425 m 7650 1425 l 7650 1800 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8700 2850 m 8700 3750 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8700 3750 m 8550 3900 l 8850 3900 l 8700 3750 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8700 3900 m 9150 3900 l 9150 5100 l gs col-1 s gr  [] 0 sd
% Polyline
 [15 50.0] 50.0 sd
n 8250 4275 m 8250 3900 l 8700 3900 l gs col-1 s gr  [] 0 sd
% Polyline
gs  clippath
9528 3570 m 9648 3600 l 9528 3630 l 9690 3630 l 9690 3570 l  cp clip
n 8100 3600 m 9675 3600 l gs col-1 s gr gr

% arrowhead
n 9528 3570 m 9648 3600 l 9528 3630 l  col-1 s
% Polyline
n 4950 750 m 7500 750 l gs col-1 s gr 
% Polyline
gs  clippath
1878 1845 m 1998 1875 l 1878 1905 l 2040 1905 l 2040 1845 l  cp clip
n 2025 1875 m 1275 1875 l 1275 2700 l gs col-1 s gr gr

% arrowhead
n 1878 1845 m 1998 1875 l 1878 1905 l  col-1 s
% Polyline
gs  clippath
2703 2445 m 2823 2475 l 2703 2505 l 2865 2505 l 2865 2445 l  cp clip
n 2850 2475 m 1275 2475 l 1275 2700 l gs col-1 s gr gr

% arrowhead
n 2703 2445 m 2823 2475 l 2703 2505 l  col-1 s
% Polyline
gs  clippath
4503 3345 m 4623 3375 l 4503 3405 l 4665 3405 l 4665 3345 l  cp clip
n 4650 3375 m 1275 3375 l 1275 2700 l 1200 2700 l gs col-1 s gr gr

% arrowhead
n 4503 3345 m 4623 3375 l 4503 3405 l  col-1 s
% Polyline
gs  clippath
5178 3720 m 5298 3750 l 5178 3780 l 5340 3780 l 5340 3720 l  cp clip
n 5325 3750 m 1275 3750 l 1275 2700 l gs col-1 s gr gr

% arrowhead
n 5178 3720 m 5298 3750 l 5178 3780 l  col-1 s
% Polyline
gs  clippath
3972 4455 m 3852 4425 l 3972 4395 l 3810 4395 l 3810 4455 l  cp clip
n 7200 4275 m 7200 4425 l 3825 4425 l gs col-1 s gr gr

% arrowhead
n 3972 4455 m 3852 4425 l 3972 4395 l  col-1 s
% Polyline
gs  clippath
5022 5130 m 4902 5100 l 5022 5070 l 4860 5070 l 4860 5130 l  cp clip
n 7200 4275 m 7200 5100 l 4875 5100 l gs col-1 s gr gr

% arrowhead
n 5022 5130 m 4902 5100 l 5022 5070 l  col-1 s
% Polyline
n 75 2325 m 750 2325 l 750 2925 l 75 2925 l cp gs col-1 s gr 
% Polyline
n 75 2525 m 750 2525 l gs col-1 s gr 
% Polyline
n 2025 1575 m 2700 1575 l 2700 2175 l 2025 2175 l cp gs col-1 s gr 
% Polyline
n 2025 1775 m 2700 1775 l gs col-1 s gr 
% Polyline
n 3000 4350 m 3825 4350 l 3825 4950 l 3000 4950 l cp gs col-1 s gr 
% Polyline
n 3000 4550 m 3825 4550 l gs col-1 s gr 
% Polyline
n 4050 5025 m 4875 5025 l 4875 5625 l 4050 5625 l cp gs col-1 s gr 
% Polyline
n 4050 5225 m 4875 5225 l gs col-1 s gr 
% Polyline
n 5325 3225 m 6150 3225 l 6150 3825 l 5325 3825 l cp gs col-1 s gr 
% Polyline
n 5325 3425 m 6150 3425 l gs col-1 s gr 
% Polyline
n 7275 1800 m 8025 1800 l 8025 2400 l 7275 2400 l cp gs col-1 s gr 
% Polyline
n 7275 2000 m 8025 2000 l gs col-1 s gr 
% Polyline
n 8325 2250 m 9000 2250 l 9000 2850 l 8325 2850 l cp gs col-1 s gr 
% Polyline
n 8325 2450 m 9000 2450 l gs col-1 s gr 
% Polyline
n 9150 2625 m 10050 2625 l 10050 3300 l 9150 3300 l cp gs col-1 s gr 
% Polyline
n 9150 2850 m 10050 2850 l gs col-1 s gr 
% Polyline
n 7950 4275 m 8475 4275 l 8475 4800 l 7950 4800 l cp gs col-1 s gr 
% Polyline
n 7950 4450 m 8475 4450 l gs col-1 s gr 
% Polyline
n 8850 5100 m 9375 5100 l 9375 5625 l 8850 5625 l cp gs col-1 s gr 
% Polyline
n 8850 5275 m 9375 5275 l gs col-1 s gr 
% Polyline
n 4650 2925 m 5175 2925 l 5175 3525 l 4650 3525 l cp gs col-1 s gr 
% Polyline
n 4650 3125 m 5175 3125 l gs col-1 s gr 
/Courier ff 165.00 scf sf
225 2475 m
gs 1 -1 sc (Node) col-1 sh gr
/Courier ff 165.00 scf sf
2100 1740 m
gs 1 -1 sc (MBank) col-1 sh gr
/Courier ff 165.00 scf sf
3600 2550 m
gs 1 -1 sc (EventTbl) col-1 sh gr
/Courier ff 165.00 scf sf
4800 3075 m
gs 1 -1 sc (DMA) col-1 sh gr
/Courier ff 165.00 scf sf
5400 3375 m
gs 1 -1 sc (ProcTbl) col-1 sh gr
/Courier ff 165.00 scf sf
7050 3450 m
gs 1 -1 sc (Processor) col-1 sh gr
/Courier ff 165.00 scf sf
3075 4515 m
gs 1 -1 sc (TrapTbl) col-1 sh gr
/Courier ff 165.00 scf sf
4200 5175 m
gs 1 -1 sc (IrqTbl) col-1 sh gr
/Courier ff 165.00 scf sf
9000 5250 m
gs 1 -1 sc (Irq) col-1 sh gr
/Courier ff 165.00 scf sf
8400 2400 m
gs 1 -1 sc (Event) col-1 sh gr
/Courier ff 165.00 scf sf
9225 2775 m
gs 1 -1 sc (DMALine) col-1 sh gr
/Courier ff 165.00 scf sf
2850 525 m
gs 1 -1 sc (HWCompResource) col-1 sh gr
/Courier ff 165.00 scf sf
7950 525 m
gs 1 -1 sc (HWResUnit) col-1 sh gr
/Courier ff 165.00 scf sf
2775 2265 m
gs 1 -1 sc (IOBank) col-1 sh gr
/Courier ff 165.00 scf sf
7350 1950 m
gs 1 -1 sc (IOport) col-1 sh gr
/Courier ff 165.00 scf sf
6525 1725 m
gs 1 -1 sc (PFrame) col-1 sh gr
/Courier ff 165.00 scf sf
8025 4425 m
gs 1 -1 sc (Trap) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 789 2566 a Fz(Figure)27 b(2.7:)36 b(Hardw)n(are)26
b(resource)g(con)n(tainers)g(and)h(elemen)n(tary)g(units.)515
2827 y Fr(2.5)135 b(Hardw)l(are)46 b(resources)515 3008
y Fz(Hardw)n(are)31 b(resources)g(are)h(not)i(able)e(to)i(mo)n(v)n(e)e
(and)h(are)f(alw)n(a)n(ys)f(lo)r(cated)i(at)g(the)h(same)515
3108 y(place.)39 b(If)30 b(they)f(gro)n(w,)e(they)i(gro)n(w)e(one)h
(con)n(tainer)f(at)i(a)f(time)h(\(i.e.)41 b(when)29 b(new)g(disks)f(or)
515 3208 y(pluggable)23 b(memory)h(banks)f(are)g(added)i(to)f(the)g
(system\).)36 b(Hardw)n(are)23 b(resource)f(con)n(tain-)515
3307 y(ers)i(ma)n(y)h(mo)n(v)n(e)g(b)n(y)g(replacing)f(a)h(whole)g(con)
n(tainer)f(b)n(y)i(another.)35 b(So,)26 b(usually)-7
b(,)25 b(hardw)n(are)515 3407 y(con)n(tainers)h(will)i(use)f(a)g
(\014xed)h(allo)r(cator.)639 3507 y(The)37 b(hardw)n(are)e(resources)g
(exp)r(orted)i(b)n(y)g(the)g(k)n(ernel)f(are)h(arranged)d(as)j
(recursiv)n(e)515 3606 y(con)n(tainers)26 b(starting)h(from)g
Fx(Node)p Fz(.)35 b(See)28 b(\014gure)f(2.7.)639 3706
y(Hardw)n(are)e(resource)g(con)n(tainers)h(emplo)n(y)g(\014xed)h(allo)r
(cators)e(b)r(ecause)h(they)h(are)f(usu-)515 3805 y(ally)h(unable)g(to)
h(gro)n(w)1218 3775 y Fp(14)1286 3805 y Fz(.)639 3905
y(The)23 b(\014xed)g(allo)r(cator)e(is)i(not)g(giv)n(en)f(to)h(the)g
(con)n(tainer)e(\(it)j(will)f(b)r(e)g(giv)n(en)f(to)h(construc-)515
4005 y(tors)f(in)h(eac)n(h)e(sub)r(class)h(of)h Fx(HWCompResource)p
Fz(,)18 b(instan)n(tiated)23 b(for)f(the)h(con)n(tained)f(elemen)n(t)
515 4104 y(class\).)515 4235 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)
l(esour)l(c)l(e)h(c)l(ontainer.)f Fk(i)p Fq(\021)598
4326 y Fi(//)39 b(A)h(hardware)h(resource)g(container.)g(Units)g(will)f
(be)g(allocated)598 4417 y(//)f(within)i(it.)598 4509
y(class)f(off_HWCompResource)j(:)d(public)g(off_CompResource)j({)598
4600 y(protected:)676 4691 y(//)d(Creates)h(a)e(HWCompResource.)676
4783 y(off_HWCompResource\(const)45 b(off_Protection)d(&p,)p
515 4850 1146 4 v 577 4904 a Fm(14)642 4927 y Fl(When)30
b(ph)n(ysical)e(resourced)i(are)e(added)i(or)f(remo)n(v)n(ed)f
(dynamically)g(to)h(a)g(running)g(system,)g(they)515
5006 y(are)23 b(added)i(or)f(remo)n(v)n(ed)f(a)h(con)n(tainer)h(at)f(a)
g(time)e(and)j(not)f(a)g(unit)g(at)g(a)g(time.)1885 5255
y Fz(116)p eop
PStoPSsaved restore
%%Page: (118,119) 60
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
117 118 bop 1422 523 a Fi(const)40 b(off_prtl_id_t)i(&domain,)1422
614 y(const)e(off_prtl_id_t)i(&id,)1422 706 y(const)e(off_magic_t)i
(magic)e(\):)872 797 y(off_CompResource\(p,domain,id)q(,mag)q(ic\))676
888 y({do_debug\(putchar\('h'\)\);})598 1254 y(};)515
1519 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(c)l
(ontainer)f(dep)l(endencies.)h Fk(i)o Fq(\021)598 1611
y Fi(#include)41 b(<klib/ids.h>)434 b(//)40 b(for)g(off_eu_id_t)598
1702 y(#include)h(<klib/mdep/debug.h>)161 b(//)40 b(for)g(do_debug)h
(et)e(al.)598 1793 y(#include)i(<klib/prot.h>)395 b(//)40
b(for)g(off_Protection)i(et)e(al.)598 1885 y(#include)h
(<klib/CompResource.h>)83 b(//)40 b(for)g(CompResource)639
2026 y Fz(Hardw)n(are)c(resource)g(units)i(use)f Fx(off)p
1870 2026 27 4 v 31 w(id)p 1989 2026 V 30 w(t)g Fz(iden)n(ti\014ers)h
(as)f(remaining)f(system)i(re-)515 2125 y(sources)22
b(do.)35 b(The)23 b(o\013set)g(matc)n(hes)g(the)h(resource)d(ph)n
(ysical)h(name,)i(i.e.)36 b(that)23 b(understo)r(o)r(d)515
2225 y(b)n(y)k(the)h(hardw)n(are.)515 2358 y Fk(h)p Fj(O\013)f(har)l
(dwar)l(e)i(r)l(esour)l(c)l(e)h(unit.)d Fk(i)p Fq(\021)598
2449 y Fi(//)39 b(A)h(hardware)h(resource)g(unit.)598
2540 y(//)e(Uses)i(virtualized)g(identifiers)h(<container)g(id><hw)e
(id>)598 2632 y(//)f(and)h(a)g(fixed)g(allocation)i(scheme.)598
2723 y(class)e(off_HWResUnit)i(:)e(public)g(off_ResUnit)i({)598
2814 y(protected:)676 2906 y(//)e(Constructs)h(a)f(hardware)h(resource)
g(unit.)676 2997 y(off_HWResUnit\(const)j(off_Protection)e(&p,const)f
(off_prtl_id_t)h(&domain,)912 3088 y(const)e(off_id_t)h(&id,)f(const)g
(off_magic_t)i(magic,)912 3180 y(off_HWCompResource)h(*container)e(\))f
(:)755 3271 y(off_ResUnit\(p,domain,id,magic,c)q(onta)q(iner)q(\))676
3362 y({;})676 3545 y(//)g(Pre-initializes)j(a)c(hardware)i(resource)g
(unit.)676 3636 y(off_HWResUnit\(const)83 b(off_id_t)41
b(&id,)1225 3728 y(const)g(off_magic_t)g(magic,)1225
3819 y(off_HWCompResource)j(*container)d(\))f(:)794 3910
y(off_ResUnit\(id,magic,container)q(\))676 4002 y({;})676
4184 y(//)g(Creates)h(an)e(already)i(pre-initialized)i(hw)d(resource)h
(unit.)676 4276 y(off_HWResUnit\(const)j(off_Protection)e(&p,)e(const)g
(off_prtl_id_t)j(&domain)d(\):)755 4367 y(off_ResUnit\(p,domain\))676
4458 y({;})598 4550 y(public:)676 4641 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 4641 24 4
v 29 w(HWResUnit)p Fj(.)i Fk(i)598 4732 y Fi(};)1885
5255 y Fz(117)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
118 119 bop 515 523 a Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l
(c)l(e)h(unit)e(dep)l(endencies.)h Fk(i)p Fq(\021)598
614 y Fi(#include)41 b(<klib/ids.h>)434 b(//)40 b(for)g(off_eu_id_t)598
706 y(#include)h(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
797 y(#include)h(<klib/ResUnit.h>)278 b(//)40 b(for)g(off_ResUnit)598
888 y(#include)h(<klib/HWCompResource.h>)j(//)c(for)g
(off_HWCompResource)639 1018 y Fz(Hardw)n(are)19 b(resource)g(units)j
(can)e(b)r(e)h(used)g(as)f(mac)n(hine)h(addresses.)33
b(It)21 b(is)g(a)f(con)n(v)n(enien)n(t)515 1118 y(implicit)28
b(cast)f(to)h(the)g(mac)n(hine)f(dep)r(enden)n(t)h(name.)515
1239 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1239 24 4 v 29 w(HWResUnit)p Fj(.)i Fk(i)p Fq(\021)598
1331 y Fi(operator)41 b(vm_offset_t\(void\))i(const)d({)g(return)g
(get_id\(\);)i(})515 1588 y Fn(2.5.1)112 b(Hardw)m(are)38
b(resources)g(for)f(plain)g(users)515 1742 y Fz(Users)27
b(can)g(ask)g(for)g(the)h(iden)n(ti\014er)f(of)h(a)f(giv)n(en)g
(resouce)f(unit.)515 1863 y Fk(h)p Fj(O\013)h(har)l(dwar)l(e)i(r)l
(esour)l(c)l(e)h(unit)e(for)f(users.)p Fk(i)q Fq(\021)598
1955 y Fi(//)39 b(Elementary)j(HW)e(resource)h(unit)f(for)g(users.)598
2046 y(//)598 2137 y(class)g(off_uHWResUnit)j(:)c(public)i
(off_uResUnit)h({)598 2229 y(public:)598 2320 y(#ifdef)e(__KERNEL__)676
2411 y(off_uHWResUnit\(off_HWResUnit)46 b(*r\):)40 b(off_uResUnit\(r\))
j({;})598 2503 y(#endif)676 2594 y(off_uHWResUnit\(void\))h({;})676
2685 y(off_uHWResUnit\(const)g(off_id_t)d(&id\):)f(off_uResUnit\(id\))j
({;})598 2777 y(};)515 2928 y Fk(h)p Fj(O\013)27 b(HW)g(r)l(esour)l(c)l
(e)j(unit)e(for)f(users)i(in-kernel.)f Fk(i)p Fq(\021)598
3020 y Fi(class)40 b(off_kHWResUnit)j(:)c(public)i(off_kResUnit)h({)598
3111 y(public:)676 3202 y(off_kHWResUnit\(off_Resource)k(*r=NULL\))41
b(:)e(off_kResUnit\(r\))k({;})676 3294 y(err_t)e(handle\(const)h
(off_shtl_id_t)g(&sender,)1029 3385 y(vm_size_t)g(msz,)e(vm_size_t)h
(rsz,)1029 3476 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e({)755
3568 y(return)g(off_kResUnit::handle\(sender,)q(msz,)q(rsz,m)q(,r\);)
676 3659 y(})598 3750 y(};)639 3880 y Fz(Comp)r(ound)28
b(hardw)n(are)d(resources)h(do)h(not)h(exp)r(ort)f(an)n(ything.)515
4002 y Fk(h)p Fj(O\013)g(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(c)l
(ontainer)f(for)f(users.)g Fk(i)p Fq(\021)598 4093 y
Fi(//)39 b(Compoud)i(HW)f(resource)h(for)f(users.)598
4184 y(//)598 4276 y(class)g(off_uHWCompResource)k(:)39
b(public)i(off_uCompResource)i({)598 4367 y(public:)598
4458 y(#ifdef)d(__KERNEL__)676 4550 y(off_uHWCompResource\(off_HWCo)q
(mpRes)q(ourc)q(e)45 b(*r\):)40 b(off_uCompResource\(r\))k({;})598
4641 y(#endif)676 4732 y(off_uHWCompResource\(void\))h({;})676
4824 y(off_uHWCompResource\(const)g(off_id_t)c(&id\):)g
(off_uCompResource\(id\))j({;})598 4915 y(};)1885 5255
y Fz(118)p eop
PStoPSsaved restore
%%Page: (120,121) 61
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
119 120 bop 515 523 a Fk(h)p Fj(O\013)27 b(HW)g(c)l(omp)l(ound)i(r)l
(esour)l(c)l(e)h(for)d(users)i(in-kernel.)f Fk(i)p Fq(\021)598
614 y Fi(class)40 b(off_kHWCompResource)k(:)39 b(public)i
(off_kCompResource)i({)598 706 y(public:)676 797 y(err_t)e
(handle\(const)h(off_shtl_id_t)g(&sender,)1029 888 y(vm_size_t)g(msz,)e
(vm_size_t)h(rsz,)1029 980 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e
({)755 1071 y(return)g(off_kCompResource::handle\(se)q(nder)q(,msz,)q
(rsz,)q(m,r\);)676 1162 y(})598 1254 y(};)515 1528 y
Fn(2.5.2)112 b(Hardw)m(are)38 b(resources)g Fd(C)8 b
FC(++)38 b Fn(source)f(\014les)515 1681 y Fz(Hardw)n(are)d(resource)h
(con)n(tainer)g(de\014nitions)i(are)e(k)n(ept)i(in)g
Fx(klib/HWCompReso)o(urc)o(e.)o(h)515 1780 y Fz(and)27
b Fx(klib/HWCompResour)o(ce)o(.C)o Fz(.)515 1913 y Fk(h)p
Fj(HWCompR)l(esour)l(c)l(e.h*)11 b Fk(i)q Fq(\021)598
2005 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2096 y Fi(#ifndef)41
b(__OFF_HW_COMP_RESOURCE_H)598 2187 y(#define)g
(__OFF_HW_COMP_RESOURCE_H)j(1)598 2370 y Fk(h)p Fj(O\013)27
b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(c)l(ontainer)f(dep)l(endencies.)
h Fk(i)598 2553 y Fi(#ifdef)40 b(__KERNEL__)598 2644
y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(c)l
(ontainer.)f Fk(i)598 2735 y Fi(#endif)40 b(//)g(__KERNEL__)598
2826 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(c)l
(ontainer)f(for)f(users.)g Fk(i)598 3009 y Fi(#endif)40
b(//)g(__OFF_HW_COMP_RESOURCE_H)515 3275 y Fk(h)p Fj(HWCompR)l(esour)l
(c)l(e.C*)11 b Fk(i)q Fq(\021)598 3366 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 3549 y Fi(#include)41 b(<klib/HWCompResource.h>)j(//)c
(Exported)h(interface)1885 5255 y Fz(119)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
120 121 bop 639 523 a Fz(Hardw)n(are)17 b(resource)f(units)j(are)e
(found)i(in)g Fx(klib/HWResUnit.h)12 b Fz(and)18 b Fx(klib/HWResUnit.C)
o Fz(.)515 639 y Fk(h)p Fj(HWR)l(esUnit.h*)11 b Fk(i)p
Fq(\021)598 731 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 822 y Fi(#ifndef)41
b(__OFF_HW_RES_UNIT_H)598 913 y(#define)g(__OFF_HW_RES_UNIT_H)i(1)598
1096 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(unit)e
(dep)l(endencies.)h Fk(i)598 1279 y Fi(#ifdef)40 b(__KERNEL__)598
1370 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(unit.)
e Fk(i)598 1461 y Fi(#endif)40 b(//)g(__KERNEL__)598
1553 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(r)l(esour)l(c)l(e)h(unit)e
(for)g(users.)p Fk(i)598 1735 y Fi(#endif)40 b(//)g
(__OFF_HW_RES_UNIT_H)515 1984 y Fk(h)p Fj(HWR)l(esUnit.C*)11
b Fk(i)p Fq(\021)598 2076 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2258 y Fi(#include)41 b(<klib/HWResUnit.h>)200 b(//)40
b(Exported)h(interface)1885 5255 y Fz(120)p eop
PStoPSsaved restore
%%Page: (122,123) 62
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
121 122 bop 515 1547 a @beginspecial 0 @llx 0 @lly 484
@urx 187 @ury 3437 @rwi @setspecial
%%BeginDocument: fig/syssrvres.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-17.0 199.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 3300 1200 m 3150 1350 l 3450 1350 l 3300 1200 l gs col-1 s gr 
% Polyline
n 3300 975 m 3300 1200 l gs col-1 s gr 
% Polyline
n 7425 1125 m 7275 1275 l 7575 1275 l 7425 1125 l gs col-1 s gr 
% Polyline
n 7425 900 m 7425 1125 l gs col-1 s gr 
% Polyline
n 4875 3000 m 4975 3075 l 5074 3000 l 4975 2925 l 4875 3000 l gs col-1 s gr 
% Polyline
n 5074 3000 m 5225 3000 l gs col-1 s gr 
% Ellipse
n 7025 3000 51 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6829 2970 m 6949 3000 l 6829 3030 l 6991 3030 l 6991 2970 l  cp clip
n 6775 3000 m 6976 3000 l gs col-1 s gr gr

% arrowhead
n 6829 2970 m 6949 3000 l 6829 3030 l  col-1 s
% Polyline
n 5225 3000 m 6826 3000 l gs col-1 s gr 
% Polyline
n 2700 1800 m 2850 1875 l 2999 1800 l 2850 1725 l 2700 1800 l gs col-1 s gr 
% Polyline
n 2999 1800 m 3225 1800 l gs col-1 s gr 
% Polyline
n 3825 2325 m 3975 2400 l 4124 2325 l 3975 2250 l 3825 2325 l gs col-1 s gr 
% Polyline
n 4124 2325 m 4350 2325 l gs col-1 s gr 
% Ellipse
n 6299 2325 76 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6078 2295 m 6198 2325 l 6078 2355 l 6240 2355 l 6240 2295 l  cp clip
n 5924 2325 m 6225 2325 l gs col-1 s gr gr

% arrowhead
n 6078 2295 m 6198 2325 l 6078 2355 l  col-1 s
% Ellipse
n 7724 1800 76 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
7503 1770 m 7623 1800 l 7503 1830 l 7665 1830 l 7665 1770 l  cp clip
n 7349 1800 m 7650 1800 l gs col-1 s gr gr

% arrowhead
n 7503 1770 m 7623 1800 l 7503 1830 l  col-1 s
% Polyline
n 6375 2175 m 6900 2175 l 6900 2775 l 6375 2775 l cp gs col-1 s gr 
% Polyline
n 6375 2375 m 6900 2375 l gs col-1 s gr 
% Polyline
n 7125 2625 m 7650 2625 l 7650 3225 l 7125 3225 l cp gs col-1 s gr 
% Polyline
n 7125 2825 m 7650 2825 l gs col-1 s gr 
% Polyline
n 7800 1575 m 8325 1575 l 8325 2175 l 7800 2175 l cp gs col-1 s gr 
% Polyline
n 7800 1775 m 8325 1775 l gs col-1 s gr 
% Polyline
n 975 2250 m 1125 2325 l 1275 2250 l 1125 2175 l 975 2250 l gs col-1 s gr 
% Polyline
n 1275 2250 m 1500 2250 l gs col-1 s gr 
% Polyline
n 300 1950 m 975 1950 l 975 2550 l 300 2550 l cp gs col-1 s gr 
% Polyline
n 300 2150 m 975 2150 l gs col-1 s gr 
% Polyline
n 6900 225 m 8100 225 l 8100 900 l 6900 900 l cp gs col-1 s gr 
% Polyline
n 6900 450 m 8100 450 l gs col-1 s gr 
% Polyline
n 4125 675 m 4252 750 l 4377 675 l 4252 600 l 4125 675 l gs col-1 s gr 
% Polyline
n 4377 675 m 4568 675 l gs col-1 s gr 
% Ellipse
n 6848 675 64 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6639 645 m 6759 675 l 6639 705 l 6801 705 l 6801 645 l  cp clip
n 6532 675 m 6786 675 l gs col-1 s gr gr

% arrowhead
n 6639 645 m 6759 675 l 6639 705 l  col-1 s
% Polyline
n 4568 675 m 6596 675 l gs col-1 s gr 
% Polyline
n 2400 300 m 4125 300 l 4125 975 l 2400 975 l cp gs col-1 s gr 
% Polyline
n 2400 525 m 4125 525 l gs col-1 s gr 
% Polyline
gs  clippath
2028 1770 m 2148 1800 l 2028 1830 l 2190 1830 l 2190 1770 l  cp clip
n 1500 1800 m 1500 1800 l 2175 1800 l gs col-1 s gr gr

% arrowhead
n 2028 1770 m 2148 1800 l 2028 1830 l  col-1 s
% Polyline
gs  clippath
2778 2295 m 2898 2325 l 2778 2355 l 2940 2355 l 2940 2295 l  cp clip
n 1500 1800 m 1500 2325 l 2925 2325 l gs col-1 s gr gr

% arrowhead
n 2778 2295 m 2898 2325 l 2778 2355 l  col-1 s
% Polyline
gs  clippath
3828 3045 m 3948 3075 l 3828 3105 l 3990 3105 l 3990 3045 l  cp clip
n 1500 1800 m 1500 3075 l 3975 3075 l gs col-1 s gr gr

% arrowhead
n 3828 3045 m 3948 3075 l 3828 3105 l  col-1 s
% Polyline
n 2400 1575 m 2400 1350 l 3300 1350 l 3300 2175 l gs col-1 s gr 
% Polyline
n 3300 1350 m 4500 1350 l 4500 2550 l gs col-1 s gr 
% Polyline
n 6600 2175 m 6600 1275 l 7050 1275 l gs col-1 s gr 
% Polyline
n 7050 1275 m 7425 1275 l 7425 2625 l gs col-1 s gr 
% Polyline
n 7125 1275 m 8100 1275 l 8100 1575 l gs col-1 s gr 
% Polyline
n 4350 2325 m 6000 2325 l gs col-1 s gr 
% Polyline
n 3150 1800 m 7350 1800 l gs col-1 s gr 
% Polyline
n 2175 1575 m 2700 1575 l 2700 2175 l 2175 2175 l cp gs col-1 s gr 
% Polyline
n 2175 1775 m 2700 1775 l gs col-1 s gr 
% Polyline
n 2925 2175 m 3825 2175 l 3825 2925 l 2925 2925 l cp gs col-1 s gr 
% Polyline
n 2925 2425 m 3825 2425 l gs col-1 s gr 
% Polyline
n 3975 2550 m 4875 2550 l 4875 3300 l 3975 3300 l cp gs col-1 s gr 
% Polyline
n 3975 2800 m 4875 2800 l gs col-1 s gr 
/Courier ff 165.00 scf sf
450 2100 m
gs 1 -1 sc (Node) col-1 sh gr
/Courier ff 165.00 scf sf
2325 1710 m
gs 1 -1 sc (DMM) col-1 sh gr
/Courier ff 165.00 scf sf
3000 2355 m
gs 1 -1 sc (PrtlSrv) col-1 sh gr
/Courier ff 165.00 scf sf
4050 2745 m
gs 1 -1 sc (ShtlSrv) col-1 sh gr
/Courier ff 165.00 scf sf
6450 2325 m
gs 1 -1 sc (Prtl) col-1 sh gr
/Courier ff 165.00 scf sf
7200 2775 m
gs 1 -1 sc (Shtl) col-1 sh gr
/Courier ff 165.00 scf sf
7875 1725 m
gs 1 -1 sc (DTLB) col-1 sh gr
/Courier ff 165.00 scf sf
6975 375 m
gs 1 -1 sc (AbsResUnit) col-1 sh gr
/Courier ff 165.00 scf sf
2475 450 m
gs 1 -1 sc (AbsCompResource) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 673 1729 a Fz(Figure)27 b(2.8:)36 b(System)27
b(abstract)g(resource)f(con)n(tainers)g(and)h(elemen)n(tary)g(units.)
515 2078 y Fr(2.6)135 b(Abstract)45 b(resources)515 2259
y Fz(Sh)n(uttles,)29 b(P)n(ortals,)e(and)h Ft(dtlb)p
Fz(s)g(\(see)h(1.2\))f(are)f(system)i(abstractions,)e(and)h(are)g(able)
g(to)515 2359 y(mo)n(v)n(e)g(around.)40 b(Consequen)n(tly)-7
b(,)28 b(abstract)g(resource)f(con)n(tainers)h(\()p Fx(AbsCompResource)
p Fz(s\))515 2459 y(pro)n(vide)23 b(a)h(metho)r(d)h Fx(make)p
1353 2459 27 4 v 30 w(available)c Fz(whic)n(h)j(uses)h(a)f(relo)r
(cation)f(table)i(so)e(that)i(system)515 2558 y(co)r(de)g(ma)n(y)g
(request)g(to)h(one)f(of)h(the)g(system)g(con)n(tainers)e(to)h(mak)n(e)
g(a)g(particular)g(resource)515 2658 y(unit)h(a)n(v)-5
b(ailable)24 b(at)h(the)h(lo)r(cal)f(no)r(de.)36 b(These)25
b(con)n(tainers)f(use)h(their)g(o)n(wn)g(iden)n(ti\014er)g(and)g(a)515
2758 y(sequence)i(n)n(um)n(b)r(er)g(to)h(create)e(iden)n(ti\014ers)i
(for)f(con)n(tained)f(resource)g(units.)639 2857 y(They)31
b(are)g(arranged,)f(as)g(ph)n(ysical)h(resources)e(are,)i(as)g
(recursiv)n(e)e(con)n(tainers)h(b)r(eing)515 2957 y(the)e
Fx(Node)e Fz(the)i(top-lev)n(el)e(con)n(tainer)h(\(see)g(\014gure)g
(2.8\).)639 3056 y(The)35 b(blo)r(c)n(k)f(allo)r(cator)e(is)j(not)f
(giv)n(en)g(to)g(the)h(con)n(tainer)e(\(it)i(will)g(b)r(e)g(giv)n(en)e
(to)i(con-)515 3156 y(structors)30 b(in)h(eac)n(h)g(sub)r(class)g(of)g
Fx(AbsCompResource)p Fz(,)26 b(instan)n(tiated)31 b(for)g(the)h(con)n
(tained)515 3256 y(elemen)n(t)27 b(class\).)515 3388
y Fk(h)p Fj(O\013)g(system)i(server.)g Fk(i)p Fq(\021)598
3480 y Fi(//)39 b(A)h(system)g(resource)i(container.)598
3571 y(//)598 3662 y(class)e(off_AbsCompResource)k(:)39
b(public)i(off_CompResource)i({)598 3754 y(private:)676
3845 y Fk(h)p Fj(O\013)27 b(private)i(memb)l(ers)g(for)e(se)l(quencing)
i(obje)l(cts.)g Fk(i)598 3936 y Fi(protected:)676 4028
y Fk(h)p Fj(O\013)e(pr)l(ote)l(cte)l(d)k(metho)l(ds)e(for)e(se)l
(quencing)j(obje)l(cts.)e Fk(i)676 4210 y Fi(//)40 b(Constructs)h(a)f
(system)g(resource)h(container.)676 4302 y(off_AbsCompResource\(const)k
(off_Protection)e(&p,)1461 4393 y(const)d(off_prtl_id_t)i(&domain,)1461
4484 y(const)e(off_prtl_id_t)i(&id,)1461 4576 y(const)e(off_magic_t)i
(magic)e(\))g(:)794 4667 y(off_CompResource\(p,domain,id,m)q(agic)q(\))
676 4758 y({)676 4850 y Fk(h)p Fj(O\013)27 b(initialization)g(for)h(se)
l(quencing)h(obje)l(cts.)f Fk(i)676 4941 y Fi(})1885
5255 y Fz(121)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
122 123 bop 598 797 a Fi(};)515 971 y Fk(h)p Fj(O\013)27
b(system)i(server)g(dep)l(endencies.)g Fk(i)p Fq(\021)598
1063 y Fi(#include)41 b(<klib/ids.h>)434 b(//)40 b(for)g(off_prtl_id_t)
i(et)d(al.)598 1154 y(#include)i(<klib/prot.h>)395 b(//)40
b(for)g(off_Protection)i(et)e(al.)598 1245 y(#include)h
(<klib/CompResource.h>)83 b(//)40 b(for)g(CompResource)515
1420 y Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e.)g
Fk(i)p Fq(\021)598 1511 y Fi(//)39 b(A)h(system)g(resource)i(unit.)e
(It's)g(relocatable)i(by)d(nature.)598 1602 y(//)598
1694 y(class)h(off_AbsResUnit)j(:)c(public)i(off_ResUnit)g({)598
1785 y(protected:)676 1876 y(//)f(Constructs)h(and)f(abstract)h
(resource)g(unit.)676 1968 y(off_AbsResUnit\(const)j(off_Protection)e
(&p,)e(const)h(off_prtl_id_t)h(&domain,)1265 2059 y(const)e(off_id_t)h
(&id,)f(const)h(off_magic_t)g(magic,)951 2150 y(off_AbsCompResource)i
(*container)81 b(\))40 b(:)755 2242 y(off_ResUnit\(p,domain,id,magic,c)
q(onta)q(iner)q(\))676 2333 y({;})676 2516 y(//)g(Pre-initializes)j(an)
c(abstract)i(resource)g(unit.)676 2607 y(off_AbsResUnit\(const)83
b(off_id_t)41 b(&id,)1225 2698 y(const)g(off_magic_t)g(magic,)1225
2790 y(off_AbsCompResource)j(*container)d(\))f(:)794
2881 y(off_ResUnit\(id,magic,container)q(\))676 2972
y({;})676 3155 y(//)g(Creates)h(an)e(already)i(pre-initialized)i
(abstract)e(resource)g(unit.)676 3246 y(off_AbsResUnit\(const)j
(off_Protection)e(&p,)e(const)h(off_prtl_id_t)h(&domain)f(\):)755
3337 y(off_ResUnit\(p,domain\))676 3429 y({;})598 3611
y(};)515 3877 y Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e)h(dep)l
(endencies.)f Fk(i)p Fq(\021)598 3968 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)h(et)e(al.)598
4060 y(#include)i(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
4151 y(#include)h(<klib/ResUnit.h>)278 b(//)40 b(for)g(off_ResUnit)598
4242 y(#include)h(<klib/AbsCompResource.h>)j(//)c(for)g
(off_AbsCompResource)1885 5255 y Fz(122)p eop
PStoPSsaved restore
%%Page: (124,125) 63
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
123 124 bop 515 523 a Fn(2.6.1)112 b(Abstract)37 b(resources)h(for)f
(plain)g(users)515 676 y Fz(The)23 b(wrapp)r(ers)e(for)h(abstract)g
(resources)f(are)g(so)h(simple)h(that)g(w)n(e)g(will)f(not)h(discuss)f
(them.)515 809 y Fk(h)p Fj(O\013)27 b(system)i(server)g(for)f(users.)g
Fk(i)p Fq(\021)598 900 y Fi(//)39 b(Compoud)i(Abs)f(resource)h(for)f
(users.)598 992 y(//)598 1083 y(class)g(off_uAbsCompResource)k(:)39
b(public)i(off_uCompResource)i({)598 1174 y(public:)598
1266 y(#ifdef)d(__KERNEL__)676 1357 y(off_uAbsCompResource\(off_Abs)q
(CompR)q(esou)q(rce)46 b(*r\):)40 b(off_uCompResource\(r\))j({;})598
1448 y(#endif)676 1540 y(off_uAbsCompResource\(void\))i({;})676
1631 y(off_uAbsCompResource\(const)g(off_id_t)c(&id\):)g
(off_uCompResource\(id\))j({;})598 1722 y(};)515 1897
y Fk(h)p Fj(O\013)27 b(abstr)l(act)j(c)l(omp)l(ound)f(r)l(esour)l(c)l
(e)h(for)d(users)i(in-kernel.)f Fk(i)p Fq(\021)598 1988
y Fi(class)40 b(off_kAbsCompResource)k(:)39 b(public)i
(off_kCompResource)i({)598 2079 y(public:)676 2171 y(err_t)e
(handle\(const)h(off_shtl_id_t)g(&sender,)1029 2262 y(vm_size_t)g(msz,)
e(vm_size_t)h(rsz,)1029 2353 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e
({)755 2445 y(return)g(off_kCompResource::handle\(se)q(nder)q(,msz,)q
(rsz,)q(m,r\);)676 2536 y(})598 2627 y(};)515 2802 y
Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e)h(for)d(users.)i
Fk(i)p Fq(\021)598 2893 y Fi(//)39 b(Elementary)j(Abs)e(resource)h
(unit)f(for)g(users.)598 2984 y(//)598 3076 y(class)g(off_uAbsResUnit)j
(:)c(public)i(off_uResUnit)h({)598 3167 y(public:)598
3258 y(#ifdef)e(__KERNEL__)676 3350 y(off_uAbsResUnit\(off_AbsResUn)q
(it)45 b(*r\):)40 b(off_uResUnit\(r\))j({;})598 3441
y(#endif)676 3532 y(off_uAbsResUnit\(void\))h({;})676
3624 y(off_uAbsResUnit\(const)g(off_id_t)d(&id\):)g(off_uResUnit\(id\))
h({;})598 3715 y(};)515 3981 y Fk(h)p Fj(O\013)27 b(abstr)l(act)j(r)l
(esour)l(c)l(e)g(unit)e(for)f(users)i(in-kernel.)f Fk(i)p
Fq(\021)598 4072 y Fi(class)40 b(off_kAbsResUnit)j(:)c(public)i
(off_kResUnit)h({)598 4163 y(public:)676 4255 y
(off_kAbsResUnit\(off_Resource)k(*r=NULL\))41 b(:)e(off_kResUnit\(r\))k
({;})676 4346 y(err_t)e(handle\(const)h(off_shtl_id_t)g(&sender,)1029
4437 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1029 4529
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))e({)755 4620
y(return)g(off_kResUnit::handle\(sender,)q(msz,)q(rsz,m)q(,r\);)676
4711 y(})598 4802 y(};)1885 5255 y Fz(123)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
124 125 bop 515 523 a Fn(2.6.2)112 b(Abstract)37 b(resources)h
Fd(C)8 b FC(++)37 b Fn(source)h(\014les)515 676 y Fz(Con)n(tainer)17
b(de\014nitions)h(can)g(b)r(e)h(found)g(in)f Fx(klib/AbsCompResou)o
(rce)o(.h)12 b Fz(and)18 b Fx(klib/AbsCompReso)o(urc)o(e.)o(C)p
Fz(.)515 809 y Fk(h)p Fj(A)n(bsCompR)l(esour)l(c)l(e.h*)11
b Fk(i)r Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y
Fi(#ifndef)41 b(__OFF_ABS_COMP_RESOURCE_H)598 1083 y(#define)g
(__OFF_ABS_COMP_RESOURCE_H)j(1)598 1266 y Fk(h)p Fj(O\013)27
b(system)i(server)g(dep)l(endencies.)g Fk(i)598 1448
y Fi(#ifdef)40 b(__KERNEL__)598 1540 y Fk(h)p Fj(O\013)27
b(system)i(server.)g Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598
1722 y Fk(h)p Fj(O\013)27 b(system)i(server)g(for)f(users.)g
Fk(i)598 1905 y Fi(#endif)40 b(//)g(__OFF_ABS_COMP_RESOURCE_H)515
2079 y Fk(h)p Fj(A)n(bsCompR)l(esour)l(c)l(e.C*)11 b
Fk(i)r Fq(\021)598 2171 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2353 y
Fi(#include)41 b(<klib/AbsCompResource.h>)j(//)c(Exported)h(interface)
639 2677 y Fz(Resource)17 b(units)i(can)f(b)r(e)h(found)g(at)f
Fx(klib/AbsResUnit.)o(h)12 b Fz(and)19 b Fx(klib/AbsResUnit)o(.C)p
Fz(.)515 2810 y Fk(h)p Fj(A)n(bsR)l(esUnit.h*)11 b Fk(i)q
Fq(\021)598 2901 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2993 y Fi(#ifndef)41
b(__OFF_ABS_RES_UNIT_H)598 3084 y(#define)g(__OFF_ABS_RES_UNIT_H)598
3267 y Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e)h(dep)l
(endencies.)f Fk(i)598 3449 y Fi(#ifdef)40 b(__KERNEL__)598
3541 y Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e.)g
Fk(i)598 3632 y Fi(#endif)40 b(//)g(__KERNEL__)598 3723
y Fk(h)p Fj(O\013)27 b(system)i(r)l(esour)l(c)l(e)h(for)d(users.)i
Fk(i)598 3906 y Fi(#endif)40 b(//)g(__OFF_ABS_RES_UNIT_H)515
4080 y Fk(h)p Fj(A)n(bsR)l(esUnit.C*)11 b Fk(i)q Fq(\021)598
4172 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 4354 y Fi(#include)41
b(<klib/AbsResUnit.h>)i(//)d(Exported)h(interface)1885
5255 y Fz(124)p eop
PStoPSsaved restore
%%Page: (126,127) 64
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
125 126 bop 515 523 a Fr(2.7)135 b(Resource)71 b(unit)g(a)l(v)-7
b(ailabilit)l(y:)114 b(Relo)t(cation)72 b(ta-)821 672
y(bles)515 854 y Fz(A)28 b(relo)r(cation)e(table)h(is)h(resp)r(onsible)
e(for)h(talking)g(\(i.e.)38 b(up)r(calling\))27 b(to)h(the)g(user)f
(and)g(ask)515 954 y(for)k(lo)r(cal)g(copies)g(of)h(remote)f
(resources.)48 b(Sync)n(hronization)30 b(is)i(tak)n(en)f(in)n(to)g
(accoun)n(t)g(b)n(y)515 1054 y(relo)r(cation)26 b(tables,)h(so)g(it)h
(can)g(b)r(e)g(ignored)e(b)n(y)h(relo)r(cation)g(table)g(users.)515
1186 y Fk(h)p Fj(O\013)g(r)l(elo)l(c)l(ation)i(table.)f
Fk(i)p Fq(\021)598 1278 y Fi(//)39 b(A)h(relocation)h(table.)g(It)f(is)
f(used)h(to)g(bring)h(resources)g(to)e(the)h(local)h(node)598
1369 y(//)e(with)i(the)e(help)i(of)e(system)i(users.)598
1460 y(class)f(off_RelocTbl)i(:)e(public)g(off_Lockable)i({)598
1552 y(private:)676 1643 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h
(of)e Fi(off)p 1713 1643 24 4 v 29 w(RelocTbl)p Fj(.)i
Fk(i)598 1734 y Fi(public:)676 1826 y Fk(h)p Fj(Other)g(public)e(memb)l
(ers)i(of)e Fi(off)p 1677 1826 V 29 w(RelocTbl)p Fj(.)i
Fk(i)676 1917 y(h)p Fj(Other)g(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 1917 V 29 w(RelocTbl)p Fj(.)i Fk(i)598
2008 y Fi(};)515 2457 y Fk(h)p Fj(O\013)e(r)l(elo)l(c)l(ation)i(table)f
(dep)l(endencies.)h Fk(i)p Fq(\021)598 2548 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(off_prtl_id_t)i(et)d(al.)598
2639 y(#include)i(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)
g(numbers.)598 2731 y(#include)h(<klib/Magic.h>)356 b(//)40
b(for)g(off_Magic)598 2822 y(#include)h(<klib/mdep/bitops.h>)122
b(//)40 b(for)g(RCs)g(\(atomic)g(et)g(al\).)1885 5255
y Fz(125)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
126 127 bop 639 523 a Fz(A)19 b Fx(RelocTbl)c Fz(implemen)n(t)k(t)n(w)n
(o)f(imp)r(ortan)n(t)g(metho)r(ds:)32 b Fx(is)p 2472
523 27 4 v 31 w(relocated)15 b Fz(and)j Fx(missing)p
Fz(.)515 623 y(The)27 b Fx(missing)c Fz(metho)r(d)28
b(\(whic)n(h)f(is)f(usually)g(in)n(v)n(ok)n(ed)g(from)g
Fx(make)p 2630 623 V 30 w(available)p Fz(\))d(deliv)n(ers)515
722 y(a)40 b Fx(MISSING)d Fz(exception)j(and)h(request)e(for)h(a)g
(particular)f(resource)g(unit)i(to)f(b)r(e)h(made)515
822 y(a)n(v)-5 b(ailable.)515 955 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 955 24 4 v
29 w(RelocTbl)p Fj(.)i Fk(i)o Fq(\021)598 1046 y Fi(//)39
b(Looks)i(up)e(for)h(resource)h(id)f(and)g(updates)h(the)f(given)g(id)g
(to)f(reflect)598 1137 y(//)g(the)h(actual)h(\(local\))g(location)g(or)
e(returns)i(FALSE)g(to)e(state)i(that)f(the)598 1229
y(//)f(resource)i(is)f(not)g(being)g(cached.)598 1320
y(//)f(If)h(reference)h(is)f(TRUE,)g(a)g(new)g(reference)h(is)f
(counted)h(for)e(the)h(given)598 1411 y(//)f(resource)i(relocation.)598
1503 y(boolean_t)g(is_relocated\(off_id_t)j(&id,)c(boolean_t)h
(reference=FALSE\);)598 1685 y(//)e(Talks)i(to)e(the)h(user)h(at)e(ex)h
(to)g(fetch)g(ID)g(which)g(is)g(missing.)598 1777 y(//)f(Returns)i(0)f
(when)g(resource)h(has)f(been)g(made)g(available)h(\(error)g(code)f
(otherwise\).)598 1868 y(err_t)g(missing\(const)i(off_prtl_id_t)g(&ex,)
1147 1959 y(const)e(off_Magic)i(id_type,off_id_t)g(&id\);)598
2142 y(//)d(Establishes)j(a)e(new)g(relocation)h(and)f(counts)h(a)e
(reference)i(to)f(it.)598 2233 y(err_t)g(relocate\(const)j(off_id_t)e
(&lcl,)f(const)g(off_id_t)h(&rem\);)598 2416 y(//)e(Releases)i(an)f
(existing)h(relocation)h(\(actually,)f(discounts)g(a)f(reference)h(to)f
(it\).)598 2507 y(void)g(unrelocate\(const)j(off_id_t)e(&rem\);)515
2864 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2956 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 3047 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g
(off_eu_id_t)h(et)f(al.)598 3138 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)598 3230
y(#include)h(<klib/RelocTbl.h>)239 b(//)40 b(for)g(off_RelocTbl.)598
3321 y(#include)h(<klib/Magic.h>)199 b(//)40 b(for)g(off_Magic)515
3595 y Fn(2.7.1)112 b(Relo)s(cation)36 b(hash)i(tables)515
3748 y Fz(The)31 b(relo)r(cation)f(table)h(main)n(tains)g(a)g(table)g
(of)g(translations)f(for)h(resource)e(units)j(b)r(eing)515
3848 y(cac)n(hed.)k(It)28 b(uses)f(a)h(blo)r(c)n(k)f(allo)r(cator)f(to)
h(k)n(eep)h(its)g(relo)r(cation)e(en)n(tries)h(and)h(a)f(hash)g(table)
515 3947 y(to)g(do)h(e\016cien)n(t)f(lo)r(okups.)515
4080 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4080 V 29 w(RelocTbl)p Fj(.)g Fk(i)p Fq(\021)598
4171 y Fi(static)40 b(off_TBlockAllocator<off_Relo)q(cTbl)q(Ent>)46
b(r_alloc;)41 b(//)e(Entry)i(allocator.)598 4263 y(static)f
(DHashTbl<off_RelocTblEnt,off)q(_Rel)q(ocTb)q(lHash)q(er,o)q(ff_id)q
(_t,O)q(FF_R)q(LC_NE)q(NTS>)715 4354 y(r_hash;)1650 b(//)39
b(Hash)h(table.)515 4528 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i
(table)f(static)h(memb)l(ers.)f Fk(i)p Fq(\021)598 4620
y Fi(//)39 b(Entry)i(allocator.)598 4711 y
(off_TBlockAllocator<off_RelocT)q(blEnt)q(>)k(off_RelocTbl::r_alloc;)
598 4802 y(//)39 b(Hash)i(table.)598 4894 y
(DHashTbl<off_RelocTblEnt,off_R)q(elocT)q(blHa)q(sher)q(,off_)q(id_t)q
(,OFF_)q(RLC_)q(NENT)q(S>)715 4985 y(off_RelocTbl::r_hash;)1885
5255 y Fz(126)p eop
PStoPSsaved restore
%%Page: (128,129) 65
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
127 128 bop 515 523 a Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)
f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 614 y
Fi(#include)41 b(<klib/BlockAllocator.h>)j(//)c(for)g
(off_BlockAllocator)598 706 y(#include)h(<klib/dhash.h>)395
b(//)40 b(for)g(DHashTbl)639 847 y Fz(T)-7 b(o)20 b(create)f(a)g(relo)r
(cation)g(table,)j(the)e(creator)e(migh)n(t)i(supply)g(the)h
(information)e(needed)515 946 y(to)27 b(instan)n(tiate)g(a)h(blo)r(c)n
(k)f(allo)r(cator)f(\(the)i(hash)f(table)h(uses)f(it\).)515
1079 y Fk(h)p Fj(Other)h(public)g(memb)l(ers)g(of)f Fi(off)p
1515 1079 24 4 v 29 w(RelocTbl)p Fj(.)i Fk(i)p Fq(\021)598
1171 y Fi(//)39 b(Creates)i(a)f(new)g(RelocTbl)598 1262
y(off_RelocTbl\(void\);)639 1403 y Fz(Ho)n(w)n(ev)n(er,)26
b(the)i(blo)r(c)n(k)f(allo)r(cator)f(is)i(not)f(created)g(at)h(relo)r
(cation)e(table)i(instan)n(tiation)515 1503 y(time,)g(w)n(e)f(simply)h
(k)n(eep)f(that)h(information)f(needed)g(to)h(create)f(it.)515
1636 y Fk(h)p Fi(off)p 667 1636 V 29 w(RelocTbl::off)p
1203 1636 V 31 w(RelocTbl)i Fj(implementation.)e Fk(i)p
Fq(\021)598 1727 y Fi(//)39 b(Creates)i(a)f(new)g(RelocTbl)598
1818 y(off_RelocTbl::off_RelocTbl\(voi)q(d\))598 1910
y({)676 2001 y(r_revocator)i(=)d(\(off_Exhausted*\)this;)598
2092 y(})515 2267 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2267 V 29 w(RelocTbl)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2358 y Fi(static)40 b(off_Exhausted)j(*r_revocator;)515
2623 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(static)h
(memb)l(ers.)f Fk(i)p Fz(+)o Fq(\021)598 2715 y Fi(off_Exhausted)42
b(*off_RelocTbl::r_revocator;)639 2856 y Fz(Instead,)21
b(the)f(allo)r(cator)e(is)h(created)g(when)g(the)h(relo)r(cation)e
(table)i(is)f(explicitly)h(started)515 2956 y(b)n(y)27
b(means)g(of)h Fx(start)p Fz(.)515 3088 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3088 V 29 w(RelocTbl)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 3180 y Fi(//)39 b(Starts)i(relocation)
h(table)e(operation.)598 3271 y(static)g(err_t)h(start\(off_KVMRegion)i
(*reg\);)515 3445 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3537 y
Fi(#include)41 b(<dmm/KVMRegion.h>)639 3678 y Fz(What)d(w)n(e)f(do)g
(is)g(to)h(use)f(a)g(sp)r(ecial)g Fx(new)f Fz(op)r(erator)g(de\014ned)h
(for)g(blo)r(c)n(k)g(allo)r(cators)515 3778 y(whic)n(h)27
b(p)r(ermits)h(initialization)f(of)h(pre-allo)r(cated)e(blo)r(c)n(k)h
(allo)r(cators.)515 3910 y Fk(h)p Fi(off)p 667 3910 V
29 w(RelocTbl::start)j Fj(implementation.)e Fk(i)p Fq(\021)598
4002 y Fi(//)39 b(Starts)i(a)e(new)h(RelocTbl)598 4093
y(err_t)g(off_RelocTbl::start\(off_KVMRe)q(gion)46 b(*reg\))598
4184 y({)676 4276 y(off_TBlockAllocator<off_Relo)q(cTblE)q(nt>)85
b(*alloc;)676 4458 y(alloc=)41 b(new\(\(void*\)&r_alloc\))1068
4550 y(off_TBlockAllocator<off_Rel)q(ocTb)q(lEnt>)q(\(r_r)q(evoca)q
(tor,)2520 4641 y(\(const)f(off_Indexable*\)&r_idx,)2520
4732 y(reg\);)676 4824 y(assert\(reg)i(&&)d(alloc\);)676
4915 y(return)i(\(alloc\))g(?)e(EOK)h(:)f(ENOMEM;)598
5006 y(})1885 5255 y Fz(127)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
128 129 bop 639 523 a Fz(Where)28 b Fx(r)p 954 523 27
4 v 31 w(idx)e Fz(is)i(an)f(indexer)g(for)g(relo)r(cation)f(table)i(en)
n(tries.)515 639 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 639 24 4 v 29 w(RelocTbl)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 731 y Fi(static)40 b(off_Indexer<off_RelocTblEnt>)46
b(r_idx;)515 888 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f
(static)h(memb)l(ers.)f Fk(i)p Fz(+)o Fq(\021)598 980
y Fi(off_Indexer<off_RelocTblEnt>)45 b(off_RelocTbl::r_idx;)639
1121 y Fz(As)31 b(w)n(e)g(see)f(\(to)h(pass)f(the)i Fx(this)d
Fz(parameter\),)h(relo)r(cation)g(tables)h(m)n(ust)f(implemen)n(t)515
1220 y(the)e(rev)n(o)r(cation)e(in)n(terface.)515 1337
y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1337 V 29 w(RelocTbl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
1428 y Fi(virtual)41 b(void)f(notify\(void\))i({)d(;})515
1586 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 1677 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)639 1818 y Fz(The)29
b(hash)e(table)h(uses)g(a)g Fx(RelocTblHasher)22 b Fz(implemen)n(ting)
29 b(the)f(hash)g(function)h(re-)515 1918 y(sp)r(onsible)e(for)g
(hashing)g Fx(off)p 1442 1918 27 4 v 30 w(id)p 1560 1918
V 31 w(t)g Fz(elemen)n(ts.)515 2051 y Fk(h)p Fj(O\013)g(r)l(elo)l(c)l
(ation)i(table)f(hasher.)h Fk(i)p Fq(\021)598 2142 y
Fi(//)39 b(A)h(hasher)g(for)g(off_id_t's)598 2233 y(//)f(Hashs)i(into)
79 b(set)40 b([0,OFF_RLC_NENTS-1])598 2325 y(//)598 2416
y(class)g(off_RelocTblHasher)j({)598 2507 y(public:)676
2599 y(natural_t)e(hash\(const)h(off_id_t)f(&key\))f({)794
2690 y(return)g(\(key.i_offset)j(^)c(key.i_node\))j(\045)d
(OFF_RLC_NENTS;)676 2781 y(})676 2964 y(boolean_t)i
(match\(off_RelocTblEnt)j(*nd,)d(const)f(off_id_t)h(&key\))f({)755
3055 y(return)g(nd->r_remote)i(==)e(key;)676 3147 y(})598
3329 y(};)639 3562 y Fz(The)28 b(size)f(of)h(the)g(hash)f(table)g(is)h
(a)f(system)h(de\014ned)f(limit.)515 3678 y Fk(h)p Fj(O\013)g(limits.)f
Fk(i)p Fq(\021)598 3769 y Fi(const)40 b(int)g(OFF_RLC_NENTS)i(=)e(255;)
79 b(//)40 b(size)g(of)g(the)f(hash)i(in)e(HW)h(relocation)h(tables.)
515 3927 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4018 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(for)g(OFF_HWR_NENTS)1885
5255 y Fz(128)p eop
PStoPSsaved restore
%%Page: (130,131) 66
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
129 130 bop 639 523 a Fz(En)n(tries)20 b(con)n(tain)h(translations)e
(from)i(remote)g(to)g(lo)r(cal)f(iden)n(ti\014ers)h(and)g(are)f
(reference)515 623 y(coun)n(ted.)62 b(They)36 b(m)n(ust)g(inherit)g
(from)g Fx(DLinkedNode)31 b Fz(to)36 b(b)r(e)h(in)f(the)g(relo)r
(cation)f(table)515 722 y(allo)r(cator.)515 855 y Fk(h)p
Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(entry.)h
Fk(i)o Fq(\021)598 946 y Fi(//)39 b(A)h(relocation)h(table)g(entry.)598
1038 y(class)f(off_RelocTblEnt)j(:)c(public)i(DLinkedNode)h({)598
1129 y(private:)676 1220 y Fk(h)p Fj(O\013)27 b(private)i(memb)l(ers)g
(for)e(r)l(efer)l(enc)l(e)j(c)l(ounting)e(obje)l(cts.)h
Fk(i)598 1312 y Fi(public:)676 1403 y(off_id_t)41 b(r_remote;)355
b(//)40 b(remote)h(resource)g(being)f(chached.)676 1494
y(off_id_t)h(r_local;)394 b(//)40 b(local)g(resource)h(used)g(as)e(a)h
(cache.)676 1677 y(//)g(Creates)h(are)f(relocation)h(table)f(entry.)676
1768 y(off_RelocTblEnt\(const)k(off_id_t)d(&rem=OFF_ID_NULL,)1304
1860 y(const)f(off_id_t)h(&lcl=OFF_ID_NULL\))i(:)755
1951 y(r_remote\(rem\),)755 2042 y(r_local\(lcl\))676
2134 y({)755 2225 y Fk(h)p Fj(O\013)27 b(initialization)g(for)g(r)l
(efer)l(enc)l(e)j(c)l(ounting)e(obje)l(cts.)h Fk(i)676
2316 y Fi(})676 2499 y Fk(h)p Fj(O\013)e(public)h(metho)l(ds)h(for)e(r)
l(efer)l(enc)l(e)j(c)l(ounting)f(obje)l(cts.)f Fk(i)676
2590 y(h)p Fj(Other)h(public)e(metho)l(ds)i(of)e Fi(off)p
1654 2590 24 4 v 29 w(RelocTblEnt)p Fj(.)j Fk(i)598 2773
y Fi(};)639 3005 y Fz(Remem)n(b)r(er)22 b(that)g Fx(RelocTblEnt)p
Fz(s)17 b(are)k(used)h(in)g(hash)f(tables.)35 b(Therefore,)22
b(they)g(m)n(ust)515 3105 y(implemen)n(t)28 b(the)g Fx(get)p
1203 3105 27 4 v 30 w(key)e Fz(metho)r(d.)515 3221 y
Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3221 24 4 v 29 w(RelocTblEnt)p Fj(.)i Fk(i)p Fq(\021)598
3313 y Fi(off_id_t)41 b(get_key\(void\))h(const)e({)g(return)g
(r_remote;)i(})1885 5255 y Fz(129)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
130 131 bop 639 523 a Fz(W)-7 b(e)32 b(are)e(no)n(w)g(in)h(p)r(osition)
g(to)g(implemen)n(t)g(the)h Fx(is)p 2280 523 27 4 v 30
w(relocated)27 b Fz(metho)r(d)32 b(b)n(y)f(means)515
623 y(of)c(the)h(hash)f(table.)515 739 y Fk(h)p Fi(off)p
667 739 24 4 v 29 w(RelocTbl::is)p 1164 739 V 30 w(relocated)j
Fj(implementation.)d Fk(i)p Fq(\021)598 830 y Fi(//)39
b(Looks)i(up)e(for)h(resource)h(id)f(and)g(updates)h(the)f(given)g(id)g
(to)f(reflect)598 922 y(//)g(the)h(actual)h(\(local\))g(location)g(or)e
(returns)i(FALSE)g(to)e(state)i(that)f(the)598 1013 y(//)f(resource)i
(is)f(not)g(being)g(cached.)598 1104 y(//)f(If)h(reference)h(is)f
(TRUE,)g(a)g(new)g(reference)h(is)f(counted)h(for)e(the)h(given)598
1196 y(//)f(resource)i(relocation.)598 1287 y(boolean_t)g
(off_RelocTbl::is_relocated\(of)q(f_id)q(_t)k(&id,)2049
1378 y(boolean_t)c(reference\))598 1469 y({)715 1561
y(off_RelocTblEnt)i(*el;)715 1652 y(r_lock\(\);)715 1743
y(el=r_hash.lookup\(id\);)715 1835 y(r_unlock\(\);)715
1926 y(if)d(\(el==NULL\))794 2017 y(return)g(FALSE;)715
2109 y(else)h({)794 2200 y(id=el->r_local;)794 2291 y(if)f
(\(reference\))872 2383 y(el->reference\(\);)794 2474
y(return)g(TRUE;)715 2565 y(})598 2657 y(})639 2873 y
Fz(A)28 b(new)g(relo)r(cation)e(is)i(just)g(a)f(new)h(en)n(try)f(added)
g(to)h(the)g(hash)f(table.)515 3005 y Fk(h)p Fi(off)p
667 3005 V 29 w(RelocTbl::relocate)k Fj(implementation.)d
Fk(i)o Fq(\021)598 3097 y Fi(//)39 b(Establishes)j(a)e(new)g
(relocation)h(\(perhaps)g(replacing)g(an)f(old)g(one\).)598
3188 y(err_t)g(off_RelocTbl::relocate\(const)46 b(off_id_t)41
b(&lcl,)f(const)g(off_id_t)i(&rem\))598 3279 y({)715
3371 y(boolean_t)g(res=TRUE;)715 3462 y(off_RelocTblEnt)h(*ent;)715
3553 y(w_lock\(\);)715 3645 y(ent=)e(new)e(off_RelocTblEnt;)715
3736 y(if)h(\(ent\){)794 3827 y(ent->r_remote=rem;)794
3919 y(ent->r_local=lcl;)794 4010 y(ent->reference\(\);)794
4101 y(r_hash.insert\(ent\);)715 4193 y(})715 4284 y(w_unlock\(\);)715
4375 y(return)h(\(ent&&res\)?EOK:ENOMEM;)598 4467 y(})1885
5255 y Fz(130)p eop
PStoPSsaved restore
%%Page: (132,133) 67
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
131 132 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(RelocTbl::unrelocate)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Releases)i(an)f(existing)h
(relocation)h(\(actually,)f(discounts)g(a)f(reference)h(to)f(it\).)598
706 y(void)g(off_RelocTbl::unrelocate\(const)46 b(off_id_t)41
b(&rem\))598 797 y({)715 888 y(off_RelocTblEnt)i(*ent;)715
980 y(w_lock\(\);)715 1071 y(ent=)e(r_hash.lookup\(rem\);)715
1162 y(if)f(\(ent\){)833 1254 y(ent->unreference\(\);)715
1345 y(})715 1436 y(w_unlock\(\);)598 1528 y(})639 1669
y Fz(Note)28 b(ho)n(w)f Fx(unreference)c Fz(could)k(call)h
Fx(unused)d Fz(on)i(the)h Fx(RelocTblEnt)p Fz(.)515 1802
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1802 V 29 w(RelocTblEnt)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
1893 y Fi(void)40 b(unused\(void\))598 1984 y({)676 2076
y(delete)h(this;)598 2167 y(})639 2308 y Fz(W)-7 b(e)29
b(used)g Fx(new)f Fz(and)g Fx(delete)p Fz(.)39 b(They)28
b(are)g(de\014ned)h(using)g(the)g(relo)r(cation)e(table)i(allo-)515
2408 y(cation)e(facilities.)515 2540 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2540 V 29 w(RelocTblEnt)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 2632 y Fi(//)39 b(Allocates)j(a)d(new)
h(entry.)598 2723 y(static)g(void)g(*)g(operator)h(new\(const)g(size_t)
g(size\);)598 2814 y(static)f(void)g(operator)i(delete\(void)f
(*item\);)515 2989 y Fk(h)p Fi(off)p 667 2989 V 29 w
(RelocTblEnt::new/delete)32 b Fj(implementation.)c Fk(i)p
Fq(\021)598 3080 y Fi(void)40 b(*)f(off_RelocTblEnt::operator)45
b(new\(const)d(size_t)e(size\))598 3171 y({)676 3263
y(\(void\)size;)676 3354 y(return)h(\(void*\))g
(off_RelocTbl::r_alloc.allocate\()q(\);)598 3445 y(})598
3628 y(void)f(off_RelocTblEnt::operator)45 b(delete\(void)d(*item\))598
3719 y({)676 3811 y(assert\(item\);)676 3902 y
(off_RelocTbl::r_alloc.deallo)q(cate\()q(\(off)q(_Rel)q(ocTbl)q(Ent*)q
(\)item)q(\);)598 3993 y(})639 4226 y Fz(T)-7 b(o)27
b(access)g Fx(r)p 1056 4226 27 4 v 31 w(alloc)p Fz(,)f(w)n(e)h(m)n(ust)
g(b)r(e)h(declared)f(friends.)515 4342 y Fk(h)p Fj(Other)h(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 4342 24 4 v 29 w(RelocTbl)p
Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 4433 y Fi(friend)40
b(void)g(*off_RelocTblEnt::operator)46 b(new\(const)41
b(size_t)f(size\);)598 4525 y(friend)g(void)g
(off_RelocTblEnt::operator)45 b(delete\(void)d(*item\);)1885
5255 y Fz(131)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
132 133 bop 515 523 a Fn(2.7.2)112 b(Deliv)m(ering)35
b(Missing)i(exceptions)515 676 y Fz(Exception)28 b(deliv)n(ering)f(is)h
(done)g(b)n(y)h Fx(missing)p Fz(.)36 b(It)29 b(uses)f(the)h(p)r(ortal)f
(serv)n(er)f Fx(kpct)g Fz(utilit)n(y)515 776 y(to)22
b(issue)f(a)h(PCT)f(from)h(the)g(k)n(ernel)f(to)h(the)g(user)f(\(i.e.)
36 b(to)21 b(up)r(call)i(the)f(user\).)35 b(The)21 b(message)515
876 y(deliv)n(ered)27 b(is)g(of)h(t)n(yp)r(e)f Fx(MissingReq)d
Fz(and)j(a)g(reply)h(of)f(t)n(yp)r(e)h Fx(MissingRep)23
b Fz(is)28 b(exp)r(ected.)639 975 y(In)c(the)g(missing)f(request)g(the)
h(k)n(ernel)e(supplies)i(\(in)g(addition)f(to)h(the)g(exception)f(t)n
(yp)r(e,)515 1075 y Fx(m)p 564 1075 27 4 v 31 w(type)p
Fz(\))31 b(the)j(missing)e(ob)5 b(ject)33 b(iden)n(ti\014er)f(and)h
(the)g(ob)5 b(ject)33 b(kind)g(\(b)r(ecause)g(the)g(iden)n(ti-)515
1174 y(\014er)h(could)g(corresp)r(ond)e(to)i(di\013eren)n(t)h
(resources)d(in)i(the)h(case)e(of)i(abstract)e(resources\).)515
1274 y(Message)26 b(t)n(yp)r(e)i(is)f Fx(EX)p 1204 1274
V 31 w(MISSING)p Fz(.)515 1407 y Fk(h)p Fj(O\013)g(user-kernel)j
(messages.)f Fk(i)p Fz(+)o Fq(\021)598 1498 y Fi(//)39
b(Missing)i(message.)598 1590 y(struct)f(off_MissingReq)j(:)c(public)i
(off_MsgReq)g({)676 1681 y(off_Magic)g(m_obj;)237 b(//)40
b(Object)g(kind.)676 1772 y(off_id_t)80 b(m_id;)276 b(//)40
b(Object)g(id.)676 1955 y(//)g(Creates)h(a)e(missing)i(request.)676
2046 y(off_MissingReq\(const)j(off_Magic)d(obj,)f(const)h(off_id_t)g
(&id\))f(:)755 2137 y(off_MsgReq\(OFF_EX_MISSING\),)45
b(m_obj\(obj\),)d(m_id\(id\))f({;})598 2229 y(};)515
2494 y Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 2586 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(off_eu_id_t)h(et)f(al.)639 2727 y Fz(The)27
b(user)f(is)g(exp)r(ected)h(to)f(fetc)n(h)h(the)g(remote)f(resource,)f
(\014x)i(the)f(resource)f(iden)n(ti\014er)515 2827 y
Fx(slot)d Fz(\014eld)i(to)f(matc)n(h)h(the)g(en)n(try)f(used)h(in)g
(the)g(lo)r(cal)f(resource)f(allo)r(cator)g(and)h(return)h(the)515
2926 y(\014xed)h(iden)n(ti\014er.)36 b(If)25 b(due)h(to)f(some)f
(circumstances)g(the)i(resource)d(could)i(not)g(b)r(e)h(fetc)n(hed,)515
3026 y(a)h(n)n(ull)h(iden)n(ti\014er)f(m)n(ust)h(b)r(e)g(returned)f(b)n
(y)g(the)h(user.)515 3159 y Fk(h)p Fj(O\013)f(user-kernel)j(messages.)f
Fk(i)p Fz(+)o Fq(\021)598 3250 y Fi(struct)40 b(off_MissingRep)j(:)c
(public)i(off_MsgRep)g({)676 3341 y(off_id_t)g(m_id;)511
b(//)40 b(Local)g(object)h(id.)676 3433 y(off_MissingRep\(void\){;})676
3524 y(off_MissingRep\(const)j(off_id_t)d(&id\))f(:)g(m_id\(id\))h({;})
598 3615 y(};)639 3848 y Fz(These)28 b(message)e(t)n(yp)r(es)h(are)g
(de\014ned)h(in)g Fx(prtl/ex.h)p Fz(.)515 3964 y Fk(h)p
Fj(O\013)f(r)l(elo)l(c)l(ation)i(table)f(implementation)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4055 y Fi(//#include)41
b(<prtl/ex.h>)473 b(//)40 b(for)g(off_Missing{Req|Rep})k(XXX)c
(uncomment)h(it)1885 5255 y Fz(132)p eop
PStoPSsaved restore
%%Page: (134,135) 68
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
133 134 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(RelocTbl::missing)31 b Fj(implementation.)c Fk(i)p
Fq(\021)598 614 y Fi(//)39 b(Talks)i(to)e(the)h(user)h(at)e(ex)h(to)g
(fetch)g(ID)g(which)g(is)g(missing.)598 706 y(//)f(Returns)i(non-zero)g
(error)g(code)f(when)g(failed.)598 797 y(err_t)g
(off_RelocTbl::missing\(const)45 b(off_prtl_id_t)e(&ex,)1696
888 y(const)d(off_Magic)i(id_type,)f(off_id_t)g(&id\))598
980 y({)676 1071 y(err_t)g(r=EOK;)598 1162 y(#if)f(0)1059
b(//)40 b(XXX)676 1254 y(off_MissingReq)j(m\(id_type,)e(id\);)676
1345 y(off_MissingRep)i(r;)676 1436 y(if)d(\(ex)g(==)f(OFF_PRTL_NULL\))
755 1528 y(return)h(ENOPRTL;)676 1619 y(if)g
(\(\(r=prtl.kpct\(ex,off_Shtl::sel)q(f\(\),)q(size)q(of\(m\))q(,siz)q
(eof\(r)q(\),&m)q(,&r,)q(0\)\)\))755 1710 y(return)g(r;)676
1802 y(else)755 1893 y(return)g(\(\(id=r.m_id\))i(==)e(OFF_ID_NULL\))i
(?)d(ENOENT)i(:)e(EOK;)598 1984 y(#endif)676 2076 y
(\(void\)ex;\(void\)id_type;\(void)q(\)id;)676 2167 y(return)i(r;)598
2258 y(})515 2524 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
2615 y Fi(#include)41 b(<prtl/PrtlSrv.h>)278 b(//)40
b(for)g(prtl.)598 2707 y(#include)h(<shtl/Shtl.h>)395
b(//)40 b(for)g(off_Shtl)h(and)f(self.)515 2980 y Fn(2.7.3)112
b(Relo)s(cation)36 b(tables)h Fd(C)8 b FC(++)38 b Fn(source)g(\014les)
515 3134 y Fz(Relo)r(cation)27 b(tables)g(are)g(k)n(ept)g(in)h
Fx(klib/RelocTbl.h)21 b Fz(and)28 b Fx(klib/RelocTbl.C)p
Fz(.)515 3267 y Fk(h)p Fj(R)l(elo)l(cTbl.h*)11 b Fk(i)p
Fq(\021)598 3358 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 3449 y Fi(#ifndef)41
b(__OFF_RELOC_TBL_H)598 3540 y(#define)g(__OFF_RELOC_TBL_H)i(1)598
3723 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f(dep)l
(endencies.)h Fk(i)598 3906 y Fi(#ifdef)40 b(__KERNEL__)598
3997 y(class)g(off_RelocTbl;)598 4088 y Fk(h)p Fj(O\013)27
b(r)l(elo)l(c)l(ation)i(table)f(entry.)h Fk(i)598 4180
y(h)p Fj(O\013)e(r)l(elo)l(c)l(ation)i(table)f(hasher.)h
Fk(i)598 4271 y(h)p Fj(O\013)e(r)l(elo)l(c)l(ation)i(table.)f
Fk(i)598 4362 y Fi(#endif)40 b(//)g(__KERNEL__)598 4545
y(#endif)g(//)g(__OFF_RELOC_TBL_H)1885 5255 y Fz(133)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
134 135 bop 515 523 a Fk(h)p Fj(R)l(elo)l(cTbl.C*)11
b Fk(i)o Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<klib/RelocTbl.h>)239 b(//)40 b(Exported)h(interface.)
598 888 y Fk(h)p Fj(O\013)27 b(r)l(elo)l(c)l(ation)i(table)f
(implementation)g(dep)l(endencies.)h Fk(i)598 1071 y(h)p
Fj(O\013)e(r)l(elo)l(c)l(ation)i(table)f(static)h(memb)l(ers.)f
Fk(i)598 1162 y(h)p Fi(off)p 750 1162 24 4 v 29 w(RelocTbl::off)p
1286 1162 V 31 w(RelocTbl)h Fj(implementation.)e Fk(i)598
1254 y(h)p Fi(off)p 750 1254 V 29 w(RelocTblEnt::new/delete)32
b Fj(implementation.)c Fk(i)598 1345 y(h)p Fi(off)p 750
1345 V 29 w(RelocTbl::is)p 1247 1345 V 31 w(relocated)h
Fj(implementation.)e Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(RelocTbl::relocate)k Fj(implementation.)d
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(RelocTbl::unrelocate)k
Fj(implementation.)27 b Fk(i)598 1619 y(h)p Fi(off)p
750 1619 V 29 w(RelocTbl::missing)k Fj(implementation.)c
Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w(RelocTbl::start)j
Fj(implementation.)e Fk(i)1885 5255 y Fz(134)p eop
PStoPSsaved restore
%%Page: (136,137) 69
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
135 136 bop 515 523 a Fr(2.8)135 b(Domains)46 b(and)e(resource)i(allo)t
(cation)515 705 y Fz(The)d(k)n(ernel)f(do)r(es)h(not)g(implemen)n(ts)g
(either)g(\\pro)r(cesses")e(or)h(an)n(y)g(other)h(\\resource-)515
805 y(con)n(tainer")24 b(abstractions.)35 b(Users)26
b(allo)r(cate)f(system)h(resources)f(and)h(release)f(them)i(bac)n(k)515
904 y(to)h(the)i(k)n(ernel)e(when)h(they)g(are)e(no)i(longer)e(needed.)
41 b(None)29 b(of)g(the)g(system)f(resources)f(is)515
1004 y(resp)r(onsible)g(for)g(con)n(taining)f(the)i(resources)e(of)h(a)
g(giv)n(en)g(application.)639 1103 y(Besides,)k(as)f(w)n(e)g(will)h
(see,)f(the)h(system)g(resource)d(that)j(is)f(the)h(most)g(similar)e
(to)i(the)515 1203 y(traditional)j(pro)r(cess)f(abstraction)h(\(the)h
(\\sh)n(uttle"\))g(do)r(es)f(not)h(con)n(tain)f(the)h(resources)515
1303 y(accessed)26 b(during)h(its)h(execution.)37 b(Th)n(us,)28
b(ho)n(w)f(are)f(b)r(o)r(okk)n(eeping)h(tasks)g(accomplished?)515
1402 y(And,)h(ho)n(w)f(are)g(resources)e(released)h(up)r(on)i
(application)f(crashes?)639 1502 y(Certainly)-7 b(,)27
b(a)f(user-lev)n(el)g(\(i.e.)37 b(a)27 b(non-)p Fw(\026)p
Fz(k)n(ernel\))e(pro)r(cess)h(or)g(\\application")g(abstrac-)515
1602 y(tion)i(is)f(needed.)38 b(T)-7 b(o)28 b(help)g(on)g(this)g(task,)
f(the)h(k)n(ernel)f(delegates)g(resource)f(b)r(o)r(okk)n(eeping)515
1701 y(to)h(its)h(users.)639 1801 y(Users)c(should)g(implemen)n(t)h
(resource)e Fy(domains)32 b Fz(con)n(taining)24 b(a)g(set)g(of)h
(resources)d(used)515 1900 y(b)n(y)j(a)f(user)h(application.)35
b(This)25 b(concept)g(is)g(in)n(tro)r(duced)g(in)g(the)h(system)f(in)g
(order)f(to)h(help)515 2000 y(solving)h(the)i(three)g(follo)n(wing)e
(problems:)639 2150 y Fq(\017)41 b Fz(Ho)n(w)27 b(to)h(release)e
(resources)g(when)h(the)h(application)f(using)h(them)g(dies.)639
2308 y Fq(\017)41 b Fz(Ho)n(w)27 b(to)h(recognize)e(who)h(is)h(resp)r
(onsible)e(for)h(a)h(giv)n(en)e(resource.)639 2465 y
Fq(\017)41 b Fz(Ho)n(w)27 b(to)h(e\016cien)n(tly)f(protect)h(and)f
(share)g(system)g(and)g(user)g(resources.)639 2615 y(Whenev)n(er)35
b(a)g(user)g(issues)g(a)g(resource)f(allo)r(cation)h(request,)i(it)f
(pro)n(vides)e(a)h(target)515 2715 y Fy(domain)29 b(identi\014er)35
b Fz(for)25 b(that)h(new)f(resource.)35 b(Then,)26 b(the)g(k)n(ernel)e
(en)n(titles)i(that)g(resource)515 2814 y(to)j(suc)n(h)g(domain)g
(\(i.e.)43 b(sets)30 b(the)f Fx(r)p 1643 2814 27 4 v
31 w(domain)e Fz(of)j(the)g Fx(Resource)c Fz(b)r(eing)k(allo)r(cated)e
(to)i(the)515 2914 y(supplied)e(domain)f(iden)n(ti\014er)g(|)h(as)f
(de\014ned)h(in)g(2.4\).)639 3014 y(The)g(domain)f(iden)n(ti\014er)h(m)
n(ust)g(b)r(e)g(a)f(p)r(ortal)g(iden)n(ti\014er)h(and)g(write)f(access)
g(righ)n(ts)f(on)515 3113 y(that)i(p)r(ortal)f(are)f(necessary)g(to)i
(en)n(title)f(new)h(resource)e(to)h(the)h(domain)g(in)n(v)n(olv)n(ed.)
639 3213 y(When)f(the)f(resource)e(gets)i(\014nally)f(un)n(used,)i(the)
f(k)n(ernel)f(noti\014es)h(that)g(b)n(y)g(raising)e(an)515
3313 y(exception)h(to)g(its)g(domain)g(iden)n(ti\014er)g(\(as)f(a)h(p)r
(ortal)g(name\).)36 b(That)25 b(w)n(a)n(y)f(users)g(could)h(up-)515
3412 y(date)g(their)g(allo)r(cation)e(tables.)36 b(Th)n(us,)25
b(domain)g(iden)n(ti\014ers)g(m)n(ust)g(b)r(e)g(p)r(ortal)f(iden)n
(ti\014ers.)639 3512 y(As)38 b(w)n(e)f(said,)j(the)e(meaning)f(of)h(a)f
Fy(domain)45 b Fz(is)38 b(de\014ned)g(b)n(y)f(the)h(user,)i(not)d(b)n
(y)h(the)515 3611 y(k)n(ernel.)639 3711 y(The)23 b Fy(2K)36
b Fz(op)r(erating)22 b(system)h(will)g(utilize)h(this)f(basic)g(mec)n
(hanism)f(for)h(implemen)n(ting)515 3811 y(the)34 b(concept)h(of)f
Fy(neste)l(d)i(domains)p Fz(.)58 b(F)-7 b(rom)34 b(a)g(single)g
(abstraction,)g(it)h(will)g(b)r(e)f(p)r(ossible)515 3910
y(to)c(implemen)n(t)h(replacemen)n(ts)f(for)g(traditional)f(OS)h
(abstractions)f(lik)n(e)h Fy(gr)l(oup)j(of)g(users)p
Fz(,)515 4010 y Fy(user)p Fz(,)d Fy(pr)l(o)l(c)l(ess)j(gr)l(oup)p
Fz(,)e Fy(pr)l(o)l(c)l(ess)p Fz(,)g(and)f Fy(thr)l(e)l(ad)p
Fz(.)44 b(This)30 b(will)h(b)r(e)f(p)r(ossible)g(b)r(ecause)f(nothing)
515 4110 y(forbids)24 b(domains)g(to)g(p)r(ersist,)i(so)e(that)h(a)f(p)
r(ermanen)n(t)g(user)g(can)h(b)r(e)g(seen)f(as)g(a)g(p)r(ersisten)n(t)
515 4209 y(domain.)639 4309 y Fy(2K)34 b Fz(will)21 b(also)e(b)r(e)j
(able)e(to)h(supp)r(ort)g(new)g(abstractions)e(lik)n(e,)j(for)e
(example,)i Fy(temp)l(or)l(ary)515 4408 y(users)p Fz(.)35
b(They)23 b(w)n(ould)g(b)r(e)h(implemen)n(ted)g(as)f(non-p)r(ersisten)n
(t)g(domains)g(and)g(could)g(b)r(e)h(cre-)515 4508 y(ated)h(b)n(y)f
(regular)f(users)h(inheriting)h(a)f(subset)h(of)g(the)g(creator)f(p)r
(ermissions.)35 b(This)25 b(w)n(ould)515 4608 y(add)19
b(\015exibilit)n(y)h(compared)f(to)h(existing)f(systems)h(in)g(whic)n
(h)g(usually)f(only)h(a)f(\\sup)r(er-user")515 4707 y(is)27
b(allo)n(w)n(ed)f(to)i(create)f(new)g(users.)639 4807
y(A)37 b(resource)d(could)i(b)r(e)g(also)f(logically)g(mo)n(v)n(ed)g
(from)h(one)g(domain)f(to)h(another)f(b)n(y)515 4907
y(c)n(hanging)28 b(its)j Fx(r)p 1033 4907 V 31 w(domain)p
Fz(.)42 b(There)29 b(is)h(nothing)g(in)g(the)h(system)f(arc)n
(hitecture)e(forbidding)515 5006 y(suc)n(h)f(feature.)1885
5255 y(135)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
136 137 bop 515 523 a Fr(2.9)135 b(Compilation)47 b(information)515
705 y Fz(A)34 b(\014le)g(named)g Fx(klib/version.h)28
b Fz(will)34 b(b)r(e)h(generated)e(ev)n(ery)f(time)j
Fx(make)d Fz(generates)g(a)515 805 y(new)27 b(system)h(image.)36
b(It)28 b(will)g(con)n(tain)f(de\014nitions)g(for)g(these)h(sym)n(b)r
(ols:)639 957 y Fq(\017)41 b Fx(OFF)p 859 957 27 4 v
30 w(VERSION)p Fz(,)24 b(a)h(string)h(with)g(the)g(source)f(co)r(de)h
(v)n(ersion)e(iden)n(ti\014er)i(\(as)g(rep)r(orted)722
1057 y(b)n(y)i(cvs\).)639 1211 y Fq(\017)41 b Fx(OFF)p
859 1211 V 30 w(COMPILE)p 1197 1211 V 29 w(DATE)p Fz(,)26
b(a)h(string)g(with)h(the)g(date)g(the)g(compilation)f(w)n(as)f
(started.)639 1365 y Fq(\017)41 b Fx(OFF)p 859 1365 V
30 w(COMPILE)p 1197 1365 V 29 w(TIME)p Fz(,)26 b(a)h(string)g(with)h
(the)g(time)g(the)g(compilation)f(w)n(as)g(started.)639
1519 y Fq(\017)41 b Fx(OFF)p 859 1519 V 30 w(COMPILE)p
1197 1519 V 29 w(BY)p Fz(,)24 b(a)h(string)f(with)h(the)g(user)f(name)h
(for)f(the)i(user)e(who)g(started)h(the)722 1618 y(compilation.)639
1772 y Fq(\017)41 b Fx(OFF)p 859 1772 V 30 w(COMPILE)p
1197 1772 V 29 w(HOST)p Fz(,)d(a)i(string)f(with)i(the)f(name)g(of)g
(the)h(host)f(the)g(k)n(ernel)f(w)n(as)722 1872 y(compiled)28
b(in.)639 2026 y Fq(\017)41 b Fx(OFF)p 859 2026 V 30
w(COMPILER)25 b Fz(a)i(string)g(with)h(the)g(name)f(of)h(the)g
Fu(C)7 b Fx(++)27 b Fz(compiler)g(used.)639 2180 y Fq(\017)41
b Fx(OFF)p 859 2180 V 30 w(ARCH)p Fz(a)30 b(string)h(with)i(the)f(name)
g(of)f(the)i(arc)n(hitecture)d(the)j(k)n(ernel)d(w)n(as)h(built)722
2279 y(for.)639 2433 y Fq(\017)41 b Fx(OFF)p 859 2433
V 30 w(URL)31 b Fz(a)g(string)f(with)i(the)g(ro)r(ot)f(of)g(the)h(w)n
(eb)f(site)h(where)f(literate)g(sources)f(for)722 2533
y(this)e(k)n(ernel)f(v)n(ersion)f(are)h(k)n(ept.)639
2685 y(They)e(will)h(b)r(e)g(k)n(ept)f(in)g(a)g(static)g(ob)5
b(ject)26 b(con)n(taining)e(those)h(strings.)35 b(Its)25
b(in)n(tend)h(is)f(to)515 2785 y(k)n(eep)i(them)h(inside)g(eac)n(h)f
(system)g(image.)515 2906 y Fk(h)p Fj(V)-6 b(ersion.h*)11
b Fk(i)p Fq(\021)598 2997 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3088 y Fi(#ifndef)41 b(__OFF_K_VERSION_H)598 3180 y(#define)g
(__OFF_K_VERSION_H)i(1)598 3362 y(#include)e(<klib/version.h>)598
3545 y(//)e(Version)i(information.)598 3636 y(class)f(off_Version)i({)
598 3728 y(public:)676 3819 y(static)f(const)f(char)g(*cvs_id;)277
b(//)39 b(CVS)h(release)h(ID.)676 3910 y(static)g(const)f(char)g
(*version;)238 b(//)39 b(Official)i(Version)g(nb.)676
4002 y(static)g(const)f(char)g(*compile_date;)j(//)c(Compilation)j
(date.)676 4093 y(static)f(const)f(char)g(*compile_time;)j(//)c
(Compilation)j(time)676 4184 y(static)f(const)f(char)g(*compile_by;)121
b(//)39 b(Who)h(started)h(the)f(compilation.)676 4276
y(static)h(const)f(char)g(*compile_host;)j(//)c(Where)i(was)f(this)g
(kernel)g(compiled)h(in.)676 4367 y(static)g(const)f(char)g(*compiler;)
199 b(//)39 b(Which)i(compiler)g(has)f(been)g(used.)676
4458 y(static)h(const)f(char)g(*arch;)355 b(//)39 b(Architecture)j
(this)80 b(was)40 b(compiled)h(for.)676 4550 y(static)g(const)f(char)g
(*url;)276 b(//)40 b(URL)g(with)g(the)g(literate)h(source)f(code)g(for)
g(this)1853 4641 y(//)g(kernel)598 4732 y(};)598 4915
y(#endif)g(//)g(__OFF_K_VERSION_H)1885 5255 y Fz(136)p
eop
PStoPSsaved restore
%%Page: (138,139) 70
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
137 138 bop 515 523 a Fk(h)p Fj(V)-6 b(ersion.C*)11 b
Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<klib/Version.h>)278 b(//)40 b(Exported)h(interface.)
598 980 y(const)f(char)g(*off_Version::cvs_id)k(=)39
b(")h($Id:)g(off.nw,v)h(1.10)f(1998/09/04)i(14:10:36)f(nemo)f(Exp)g($)f
(";)598 1071 y(const)h(char)g(*off_Version::version)k(=)c(OFF_VERSION;)
598 1162 y(const)g(char)g(*off_Version::compile_date)45
b(=)40 b(OFF_COMPILE_DATE;)598 1254 y(const)g(char)g
(*off_Version::compile_time)45 b(=)40 b(OFF_COMPILE_TIME;)598
1345 y(const)g(char)g(*off_Version::compile_by)45 b(=)39
b(OFF_COMPILE_BY;)598 1436 y(const)h(char)g(*off_Version::compile_host)
45 b(=)40 b(OFF_COMPILE_HOST;)598 1528 y(const)g(char)g
(*off_Version::compiler)k(=)c(OFF_COMPILER;)598 1619
y(const)g(char)g(*off_Version::arch)200 b(=)40 b(OFF_ARCH;)598
1710 y(const)g(char)g(*off_Version::url)j(=)d(OFF_URL;)1885
5255 y Fz(137)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
138 139 bop 515 1146 a Fs(Chapter)64 b(3)515 1561 y Fv(The)77
b(no)6 b(de)515 2042 y Fr(3.1)135 b(The)45 b(no)t(de)f(in)l(terface)515
2224 y Fz(A)36 b Fx(Node)e Fz(ob)5 b(ject)35 b(is)h(resp)r(onsible)f
(for)g(bringing)f(the)i(system)g(in)n(to)f(op)r(eration)g(and)g(also)
515 2324 y(for)30 b(sh)n(utting)g(it)h(do)n(wn)f(\(i.e.)46
b(to)30 b(either)h Fx(halt)p Fz(,)e Fx(reboot)p Fz(,)g(or)h
Fx(suspend)e Fz(it\).)46 b Fx(Node)29 b Fz(is)h(also)515
2423 y(a)35 b(singleton)916 2393 y Fp(1)989 2423 y Fz(used)h(as)g(a)g
(placeholder)f(for)g(no)r(de-wide)h(system)g(prop)r(erties)f(\(e.g.)63
b(the)515 2523 y(p)r(ortal)26 b(for)g(the)i(authen)n(tication)e(serv)n
(er)f(used)i(to)g(establish)f(trust)h(relationships)f(among)515
2623 y(distributed)h(k)n(ernels)f(\()p Fx(auth)p Fz(\),)h(and)g(the)g
(p)r(ortal)g(for)f(the)i(external)e(data)h(translator)e(used)515
2722 y(to)33 b(translate)g(foreign)g(k)n(ernel)g(ob)5
b(jects)33 b(to)h(the)g(nativ)n(e)f(arc)n(hitecture)f(\()p
Fx(xdt)p Fz(\))i(are)e(placed)515 2822 y(here.\))639
2922 y(Being)g(the)h(outer-most)f(starting)g(p)r(oin)n(t)g(in)h(the)g
(con)n(tainer)f(hierarc)n(h)n(y)-7 b(,)32 b(its)h Fx(id)e
Fz(\(ob-)515 3021 y(tained)38 b(from)g(the)h(metho)r(d)g
Fx(get)p 1590 3021 27 4 v 30 w(id)p Fz(\))f(is)h(all)f(the)h(user)e
(needs)i(to)f(kno)n(w)g(ho)n(w)f(to)i(start)515 3121
y(lo)r(oking)34 b(for)h(a)n(v)-5 b(ailable)35 b(system)g(resources.)59
b(No)r(des)35 b(ha)n(v)n(e)g(a)g(name,)i(as)e(an)n(y)g(other)g(re-)515
3220 y(source)26 b(do.)515 3353 y Fk(h)p Fj(O\013)h(no)l(de.)h
Fk(i)p Fq(\021)598 3445 y Fi(//)39 b(An)h(Off)g(Node.)598
3536 y(//)f(Can)h(be)g(also)g(handled)h(as)f(a)f(resource:)i(freeze,)g
(melt,)g(etc.)598 3627 y(class)f(off_Node)h(:)f(public)g(off_Resource)i
({)598 3719 y(private:)676 3810 y(char)158 b(*n_name;)551
b(//)40 b(Node)g(name.)676 3901 y Fk(h)p Fj(O\013)27
b(private)i(memb)l(ers)g(for)e(se)l(quencing)i(obje)l(cts.)g
Fk(i)676 3993 y(h)p Fj(Other)g(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 3993 24 4 v 29 w(Node)p Fj(.)h Fk(i)598
4084 y Fi(protected:)676 4175 y(off_prtl_id_t)42 b(n_xdt;)472
b(//)40 b(External)h(data)f(translator.)676 4267 y(off_prtl_id_t)i
(n_auth;)433 b(//)40 b(Authenticator.)676 4358 y Fk(h)p
Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 4358 V 29 w(Node)p Fj(.)h Fk(i)676 4449
y(h)p Fj(O\013)f(pr)l(ote)l(cte)l(d)k(metho)l(ds)e(for)e(se)l(quencing)
j(obje)l(cts.)e Fk(i)676 4540 y(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 4540 V 29 w(Node)p Fj(.)h
Fk(i)598 4632 y Fi(public:)676 4723 y Fk(h)p Fi(off)p
828 4723 V 29 w(Node::valid)i Fj(public)d(metho)l(d.)i
Fk(i)p 515 4868 1146 4 v 607 4921 a Fm(1)642 4945 y Fl(see)24
b(the)g Ff(singleton)g Fl(design)g(patterm)g(in)46 b([11)q(],)22
b(pp)i(127.)1885 5255 y Fz(138)p eop
PStoPSsaved restore
%%Page: (140,141) 71
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
139 140 bop 676 523 a Fi(//)40 b(Returns)h(the)f(node)g(name.)676
614 y(const)h(char)f(*nameof\(void\))81 b({)40 b(assert\(valid\(\)\);)i
(return)f(n_name;)g(})676 797 y(//)f(Returns)h(or)e(sets)i(the)e
(authorization)k(server)d(and)676 888 y(//)g(the)g(external)h(data)f
(translator)h(portals.)676 980 y(off_prtl_id_t)h(get_auth\(void\))82
b({)755 1071 y(off_prtl_id_t)42 b(p;)755 1162 y(assert\(valid\(\)\);)h
(r_lock\(\);)e(p=n_auth;)g(r_unlock\(\);)h(return)e(p;)676
1254 y(})676 1345 y(off_prtl_id_t)i(get_xdt\(void\))121
b({)755 1436 y(off_prtl_id_t)42 b(p;)755 1528 y(assert\(valid\(\)\);)h
(r_lock\(\);)e(p=n_xdt;)g(r_unlock\(\);)h(return)e(p;)676
1619 y(})676 1710 y(void)g(set_auth\(const)j(off_prtl_id_t)f(&p\))e({)
755 1802 y(assert\(valid\(\)\);)j(if)c(\(!is_frozen\(\)\))k({)c
(w_lock\(\);)i(n_auth=p;)h(w_unlock\(\);)f(})676 1893
y(})676 1984 y(void)f(set_xdt\(const)j(off_prtl_id_t)f(&p\))e({)755
2076 y(assert\(valid\(\)\);)j(if)c(\(!is_frozen\(\)\))k({)c
(w_lock\(\);)i(n_xdt=p;)g(w_unlock\(\);)h(})676 2167
y(})676 2350 y(//)e(Halts,)g(reboots,)i(or)d(suspends)i(this)f(node)676
2441 y(void)158 b(halt\(const)42 b(char)e(*msg="System)i(On.)e(Now)f
(you)h(can)g(run)g(Linux.")h(\);)676 2532 y(void)158
b(reboot\()41 b(void)f(\);)676 2623 y(err_t)119 b(suspend\()41
b(void)f(\);)676 2806 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2806 24 4 v 29 w(Node)p Fj(.)h Fk(i)598
2897 y Fi(};)639 3130 y Fz(Note)d(ho)n(w)e(w)n(e)h(ha)n(v)n(e)g(used)g
Fx(assert)e Fz(to)i(ensure)g(w)n(e)g(are)f(op)r(erating)h(on)g(a)g
Fx(valid)e Fz(no)r(de.)515 3230 y(Suc)n(h)27 b(c)n(hec)n(k)g(will)h(b)r
(e)g(describ)r(ed)f(b)r(elo)n(w.)515 3346 y Fk(h)p Fj(O\013)g(no)l(de)h
(dep)l(endencies.)h Fk(i)p Fq(\021)598 3437 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 3528 y(#include)h
(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)h(et)e(al.)598
3620 y(#include)i(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)
g(numbers.)598 3711 y(#include)h(<klib/Resource.h>)239
b(//)40 b(for)g(off_Resource)639 3836 y Fz(The)33 b Fx(Node)e
Fz(can)h(b)r(e)h(also)e(considered)g(to)i(b)r(e)f(a)g
Fy(fa\030)-38 b(cade)2410 3805 y Fp(2)2483 3836 y Fz(\(see)64
b([11]\))32 b(for)g(no)r(de-wide)515 3935 y(system)27
b(op)r(erations.)639 4035 y(There)g(is)h(a)f(single)g(no)r(de)h
(instance)f(whic)n(h)h(is)f(made)g(a)n(v)-5 b(ailable)27
b(system-wide.)515 4151 y Fk(h)p Fj(O\013)g(no)l(de)h(exp)l(orte)l(d)i
(variables.)e Fk(i)p Fq(\021)598 4242 y Fi(extern)40
b(off_Node)h(nd;)511 b(//)40 b(Node)g(instance)h(for)f(this)g(node.)515
4400 y Fk(h)p Fj(O\013)27 b(no)l(de)h(glob)l(al)g(variables.)g
Fk(i)p Fq(\021)598 4491 y Fi(off_Node)41 b(nd;)510 b(//)40
b(Node)g(instance)h(for)f(this)g(node.)598 4583 y(#include)h("kNode.C")
515 4757 y Fk(h)p Fj(O\013)27 b(no)l(de)h(implementation)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4848 y Fi(#include)41
b("kNode.h")p 515 4902 1146 4 v 607 4955 a Fm(2)642 4979
y Fl(It)24 b(will)e(cen)n(tralize)j(access)g(to)f(no)r(de-wide)g
(services)g(lik)n(e)f(serial)g(debugging,)i(message)e(logging,)h(etc.)
1885 5255 y Fz(139)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
140 141 bop 639 523 a Fz(The)28 b(no)r(de)g(instance)f(is)h(staticly)f
(initialized)h(with)h(silly)e(default)h(v)-5 b(alues.)37
b(Its)28 b(initial-)515 623 y(ization)f(will)h(b)r(e)g(actually)f(done)
g(during)g Fx(main)f Fz(en)n(try)h(p)r(oin)n(t)h(execution.)515
739 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fq(\021)598
830 y Fi(//)39 b(Creates)i(an)f(initial)h(off_Node)598
922 y(off_Node\(void\);)515 1079 y Fk(h)p Fi(off)p 667
1079 V 29 w(Node::off)p 1047 1079 V 30 w(Node)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 1171 y Fi(//)39 b(Creates)i(an)f(initial)h(off_Node)
598 1262 y(off_Node::off_Node\(void\))j(:)676 1353 y
(off_Resource\(off_Protection\()q(\),)h(OFF_PRTL_NULL,OFF_ID_NULL,)g
(OFF_MAGIC_NODE\),)676 1445 y Fk(h)p Fj(Initialize)27
b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g Fi(off)p
2090 1445 V 29 w(Node)p Fj(.)f Fk(i)598 1536 y Fi({)676
1627 y Fk(h)p Fj(O\013)g(initialization)g(for)h(se)l(quencing)h(obje)l
(cts.)f Fk(i)676 1719 y Fi(n_name=NULL;)676 1810 y(n_xdt)41
b(=)e(n_auth)i(=)e(OFF_PRTL_NULL;)676 1901 y Fk(h)p Fj(Initialize)27
b(other)i(private)f(memb)l(ers)h(of)e Fi(off)p 2015 1901
V 29 w(Node)p Fj(.)h Fk(i)598 1993 y Fi(})515 2258 y
Fk(h)p Fj(O\013)f(no)l(de)h(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 2350 y Fi(#include)41 b(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection.)598 2441 y(#include)h(<klib/Magic.h>)
356 b(//)40 b(for)g(off_magic_t)h(and)f(magic)h(numbers.)639
2582 y Fz(Note)25 b(ho)n(w)e(w)n(e)h(ha)n(v)n(e)f(used)h(the)h(magic)f
(n)n(um)n(b)r(er)g(for)f(no)r(des.)36 b(It)25 b(is)f(de\014ned)g(as)g
(follo)n(ws.)515 2698 y Fk(h)p Fj(O\013)j(magic)g(numb)l(ers.)i
Fk(i)p Fq(\021)598 2790 y Fi(OFF_MAGIC_NODE,)42 b(//)e(Node)g(magic)h
(nb.)639 2914 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h
(to)h(the)g(implemen)n(tation)f(of)h Fx(Magic::nameof)p
Fz(.)515 3030 y Fk(h)p Fi(off)p 667 3030 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 3030 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 3122 y Fi(case)40 b(OFF_MAGIC_NODE:)676
3213 y(return)h("off_Node";)639 3337 y Fz(No)r(de)28
b(users)f(can)g(c)n(hec)n(k)g(their)g(references)g(to)g(no)r(des)h
(with)515 3454 y Fk(h)p Fi(off)p 667 3454 V 29 w(Node::valid)h
Fj(public)f(metho)l(d.)g Fk(i)p Fq(\021)598 3545 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(node?)598 3636 y(boolean_t)i
(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i(==)e
(OFF_MAGIC_NODE;)i(})1885 5255 y Fz(140)p eop
PStoPSsaved restore
%%Page: (142,143) 72
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
141 142 bop 639 523 a Fz(W)-7 b(e)38 b(will)g(b)r(e)g(seeing)e(the)i
(implemen)n(tation)g(of)f(remaining)f(metho)r(ds)i(of)g
Fx(off)p 3180 523 27 4 v 30 w(Node)515 623 y Fz(through)30
b(this)h(c)n(hapter)f(b)r(ecause)h(they)g(ha)n(v)n(e)f(to)h(do)f(with)i
(di\013eren)n(t)f(asp)r(ects)f(of)h(system)515 722 y(op)r(eration.)515
997 y Fr(3.2)135 b(Na)l(vigation)515 1179 y Fz(T)-7 b(o)27
b(supp)r(ort)h(e\016cien)n(t)g(bro)n(wsing)f(of)g(no)r(de)i(comp)r
(onen)n(ts,)e(the)h Fx(Node)f Fz(has)g(a)h(set)g(of)g(meth-)515
1278 y(o)r(ds)36 b(that)h(pro)n(vide)f(access)f(to)i(its)g(comp)r(onen)
n(ts.)64 b(Most)36 b(of)h(them)g(will)g(b)r(e)g(simply)g(in-)515
1378 y(lined.)56 b(No)r(de)34 b(na)n(vigation)f(is)h(imp)r(ortan)n(t)f
(b)r(ecause)h(ev)n(ery)f(\(outermost\))h(resource)e(con-)515
1478 y(tainer)23 b(found)h(in)g(the)g(lo)r(cal)f(no)r(de)h(will)g(ha)n
(v)n(e)e(an)i(instance)f(aggregated)e(to)j(the)g Fx(Node)p
Fz(.)34 b(F)-7 b(or)515 1577 y(example,)27 b(for)g(memory)g(banks)g(w)n
(e)g(ha)n(v)n(e:)515 1693 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 1693 24 4 v 29 w(Node)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 1785 y Fi(//)39 b(Returns)i(the)f(number)h(of)e
(specific)i(containers)h(found)e(at)g(this)g(node)598
1876 y(inline)g(natural_t)i(get_num_mbanks\(void\))h(const)e({)676
1967 y(assert\(valid\(\)\);)i(return)e(n_nmbanks;)g(})598
2059 y(//)e(Returns)i(a)f(pointer)h(to)e(a)h(local)g(memory)h(bank.)598
2150 y(inline)f(off_MBank)120 b(&get_mbank\()42 b(natural_t)f(id)f(=)f
(0)h(\))78 b({)676 2241 y(assert\(valid\(\)\);)43 b(return)e
(n_mbank[id];})639 2457 y Fz(A)28 b(lo)r(cal)f(arra)n(y)e(of)j(memory)f
(banks)g(is)g(k)n(ept.)515 2573 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)
j(memb)l(ers)d(of)f Fi(off)p 1616 2573 V 29 w(Node)p
Fj(.)h Fk(i)p Fq(\021)598 2665 y Fi(natural_t)80 b(n_nmbanks;)630
b(//)40 b(#)f(of)h(local)g(mbanks.)598 2756 y(off_MBank)80
b(n_mbank[OFF_NMBANKS_MAX];)45 b(//)40 b(Local)g(memory)h(banks.)515
2914 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 2914 V 29 w(Node)p Fj(.)h Fk(i)p
Fq(\021)598 3005 y Fi(n_nmbanks\(0\))639 3146 y Fz(The)23
b(maxim)n(um)f(n)n(um)n(b)r(er)g(of)g(memory)g(banks)f
Fx(OFF)p 2258 3146 27 4 v 30 w(NMBANKS)p 2596 3146 V
29 w(MAX)g Fz(is)h(a)g(system)g(limit.)515 3263 y Fk(h)p
Fj(O\013)27 b(limits.)f Fk(i)p Fq(\021)598 3354 y Fi(const)40
b(int)g(OFF_NMBANKS_MAX)j(=)c(4;)157 b(//)40 b(Max.)g(number)h(of)f
(memory)g(banks)515 3512 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3603 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(for)g(OFF_NMBANKS_MAX)i(et)e(al.)598
3694 y(#include)h(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 3786 y(#include)h(<hw/MBank.h>)434
b(//)40 b(for)g(off_MBank)1885 5255 y Fz(141)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
142 143 bop 639 523 a Fz(The)27 b(same)f(holds)g(for)g(remaining)f
(resource)g(con)n(tainers.)35 b(Note)26 b(ho)n(w)g(ev)n(ery)f(resource)
515 623 y(con)n(tainer)i(is)h(k)n(ept)g(inside)g(the)h(no)r(de)f
(instance)g(but)h(for)e(the)i(p)r(ortal)f(serv)n(er,)e(the)j(sh)n
(uttle)515 722 y(serv)n(er)g(and)j(the)g Ft(dmm)p Fz(,)g(whic)n(h)g
(are)f(system)g(serv)n(ers)e(on)j(their)f(o)n(wn)g(and)h(pro)n(vide)e
(their)515 822 y(o)n(wn)f(global)f(instances.)42 b(Nev)n(ertheless,)29
b(the)g(no)r(de)h(pretends)f(that)h(they)f(are)g(con)n(tained)515
922 y(inside)e(it)h(for)g(na)n(vigation)d(purp)r(oses.)515
1054 y Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1054 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1146 y Fi(//)39 b(Return)i(the)f(number)h(of)e(specific)i(containers)h
(found)e(at)g(this)g(node)598 1237 y(//)f(Get)h(a)g(pointer)h(to)e(a)h
(hardware)h(resource)g(container)598 1328 y(inline)f(natural_t)i
(get_num_iobanks\(void\))i(const)c({)676 1420 y(assert\(valid\(\)\);)j
(return)e(n_niobanks;)598 1511 y(})598 1602 y(inline)f(off_IOBank)81
b(&get_iobank\()42 b(natural_t)f(id=0)f(\))79 b({)676
1694 y(assert\(valid\(\)\);)43 b(return)e(n_iobank[id];)598
1785 y(})598 1876 y(inline)f(natural_t)i(get_num_procs\(void\))h(const)
e({)676 1968 y(assert\(valid\(\)\);)i(return)e(n_nprocs;)598
2059 y(})598 2150 y(inline)f(off_Processor)j(&get_proc\(natural_t)g
(id=0\){)676 2242 y(assert\(valid\(\)\);)g(return)e(n_proc[id];)598
2333 y(})598 2424 y(inline)f(off_ShtlSrv)121 b(&get_shtl\()41
b(void)f(\))79 b({assert\(valid\(\)\);)43 b(return)e(*n_shtl;})598
2516 y(inline)f(off_DMM)277 b(&get_dmm\()41 b(void)f(\))118
b({assert\(valid\(\)\);)43 b(return)e(*n_dmm;})598 2607
y(inline)f(off_PrtlSrv)121 b(&get_prtl\()41 b(void)f(\))79
b({assert\(valid\(\)\);)43 b(return)e(*n_prtl;})598 2790
y(#if)f(0)1059 b(//)40 b(XXX)g(fix)g(this.)598 2881 y(inline)g
(natural_t)i(get_num_dmas\(void\))h(const)d({)676 2972
y(assert\(valid\(\)\);)j(return)e(n_ndmas;)598 3064 y(})598
3155 y(inline)f(off_DMA)198 b(&get_dma\()41 b(natural_t)h(id=0)e(\))78
b({)676 3246 y(assert\(valid\(\)\);)43 b(return)e(n_dma[id];)598
3337 y(})598 3429 y(#endif)515 3603 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f Fi(off)p 1616
3603 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 3694
y Fi(off_DMM)237 b(*n_dmm;)g(//)39 b(DMM.)598 3786 y(natural_t)198
b(n_niobanks;)277 b(//)40 b(#)f(of)h(iobanks)598 3877
y(off_IOBank)159 b(n_iobank[OFF_NIOBANKS_MAX];)124 b(//)39
b(IO)h(banks)598 3968 y(natural_t)198 b(n_nprocs;)355
b(//)40 b(#)f(of)h(processors.)598 4060 y(off_Processor)i
(n_proc[OFF_NPROC_MAX];)280 b(//)39 b(Processors.)598
4151 y(off_ShtlSrv)120 b(*n_shtl;)433 b(//)40 b(Shuttle)h(server.)598
4242 y(off_PrtlSrv)81 b(*n_prtl;)198 b(//)39 b(Portal)i(server)598
4425 y(#if)f(0)1883 b(//)79 b(XXXX)40 b(fix)g(this.)598
4516 y(natural_t)h(n_ndmas;)276 b(//)40 b(#)g(of)f(DMAs)598
4608 y(off_DMA)276 b(n_dma[OFF_NDMAS_MAX];)83 b(//)40
b(DMAs)598 4699 y(#endif)1885 5255 y Fz(142)p eop
PStoPSsaved restore
%%Page: (144,145) 73
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
143 144 bop 515 523 a Fk(h)p Fj(Initialize)26 b(other)j(private)g(memb)
l(ers)g(of)e Fi(off)p 1854 523 24 4 v 29 w(Node)p Fj(.)h
Fk(i)o Fq(\021)598 614 y Fi(n_niobanks=0;)598 706 y(//n_ndmas=0;)598
797 y(n_prtl=&prtl;)598 888 y(n_shtl=&shtl;)598 980 y(n_dmm=&dmm;)639
1121 y Fz(The)19 b(maxim)n(um)f(n)n(um)n(b)r(er)g(of)g(IO)g(banks,)i
Fx(OFF)p 2061 1121 27 4 v 30 w(NMBANKS)p 2399 1121 V
29 w(MAX)p Fz(,)d(and)h(DMAs,)j Fx(OFF)p 3162 1121 V
30 w(NDMAS)p 3412 1121 V 29 w(MAX)p Fz(,)515 1220 y(are)26
b(system)i(limits.)515 1337 y Fk(h)p Fj(O\013)f(limits.)f
Fk(i)p Fz(+)p Fq(\021)598 1428 y Fi(const)40 b(int)g(OFF_NIOBANKS_MAX)j
(=)c(1;)598 1519 y(const)h(int)g(OFF_NDMAS_MAX)121 b(=)39
b(1;)79 b(//)40 b(Max.)g(number)g(of)g(DMAs)598 1611
y(const)g(int)g(OFF_NPROC_MAX)121 b(=)39 b(1;)79 b(//)40
b(Max.)g(number)g(of)g(Processors.)515 1768 y Fk(h)p
Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h Fk(i)p Fz(+)p
Fq(\021)598 1860 y Fi(#include)41 b(<hw/IOBank.h>)395
b(//)40 b(for)g(off_IOBank)598 1951 y(#include)h(<hw/Processor.h>)278
b(//)40 b(for)g(off_Processor)598 2042 y(#include)h(<shtl/ShtlSrv.h>)
278 b(//)40 b(for)g(off_ShtlSrv)598 2134 y(#include)h(<dmm/DMM.h>)473
b(//)40 b(for)g(off_DMM)598 2225 y(#include)h(<prtl/PrtlSrv.h>)356
b(//)40 b(for)g(off_PrtlSrv)598 2316 y(//#include)h(<hw/DMA.h>)512
b(//)40 b(for)g(off_DMA)119 b(fix)40 b(this)g(XXX)1885
5255 y Fz(143)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
144 145 bop 639 523 a Fz(Besides,)20 b(a)f(generic)e(na)n(vigator)g(sp)
r(ecialized)h(for)g(the)i Fx(Node)d Fz(will)i(supp)r(ort)f(the)i
(common)515 623 y(in)n(terface)f(for)g(na)n(vigation.)32
b(That)20 b(is)f(primarily)g(for)g(system)g(users)g(and)g(not)h(for)f
(the)h(k)n(ernel)515 722 y(itself.)515 955 y Fn(3.2.1)112
b(The)38 b(no)s(de)g(na)m(vigator)515 1108 y Fz(The)27
b(no)r(de)h(na)n(vigator)d(giv)n(es)i(access)f(to)h(ev)n(ery)g
(resource)f(con)n(tainer)g(in)i(the)g(lo)r(cal)f(no)r(de.)515
1241 y Fk(h)p Fj(O\013)g(no)l(de)h(navigator.)h Fk(i)p
Fq(\021)598 1332 y Fi(//)39 b(A)h(node)g(navigator.)598
1423 y(//)598 1515 y(class)g(off_NodeNav)i(:)d(public)i(off_Navigator)h
({)598 1606 y(private:)676 1697 y(off_Node)f(&n_nd;)676
1789 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 1789 24 4 v 29 w(NodeNav)p Fj(.)i Fk(i)598
1880 y Fi(public:)676 1971 y(//)40 b(Creates)h(a)e(node)h(navigator.)
676 2063 y(off_NodeNav\(off_Node)k(&nd\);)676 2245 y(//)c(Returns)h(a)e
(reference)i(to)f(the)g(resource)h(being)f(navigated)676
2337 y(virtual)h(off_Resource)h(*get_current\(void\);)676
2519 y(//)e(Advances)h(the)f(iteration)h(and)f(returns)h(the)f(next)g
(element.)676 2611 y(virtual)h(off_CompResource)i(*get_next\(void\);)
676 2702 y(//)d(Resets)g(the)g(iteration)i(so)d(that)h(get_next)i(will)
e(return)g(the)g(1st)g(element.)676 2793 y(virtual)h(void)f
(reset\(void\);)676 2976 y(//)g(Selects)h(a)e(component)i(by)f(name.)
676 3067 y(virtual)h(off_CompResource)i(*operator[]\(const)g(char)d
(*name\);)676 3159 y(virtual)h(off_CompResource)i(*operator[]\(const)g
(off_id_t)e(&id\);)598 3524 y(};)515 3790 y Fk(h)p Fj(O\013)27
b(no)l(de)h(navigator)h(dep)l(endencies.)h Fk(i)o Fq(\021)598
3881 y Fi(#include)41 b(<assert.h>)512 b(//)40 b(for)g(assert)598
3972 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)h(et)e(al.)
598 4064 y(#include)i(<klib/CompResource.h>)83 b(//)40
b(for)g(off_CompResource.)598 4155 y(#include)h(<klib/nav.h>)434
b(//)40 b(for)g(off_Navigator.)598 4246 y(class)g(off_Node;)669
b(//)40 b(to)f(break)i(circular)g(dependency.)515 4421
y Fk(h)p Fj(O\013)27 b(no)l(de)h(navigator)h(late)f(dep)l(endencies.)i
Fk(i)o Fq(\021)598 4512 y Fi(#include)41 b(<node/Node.h>)395
b(//)40 b(for)g(off_Node.)1885 5255 y Fz(144)p eop
PStoPSsaved restore
%%Page: (146,147) 74
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
145 146 bop 639 523 a Fz(The)31 b(no)r(de)f(na)n(vigator)e(is)i
(generated)f(dynamically)h(ev)n(ery)f(time)i(it)g(is)f(needed)g(using)
515 623 y(a)d(simple)h(constructor.)515 739 y Fk(h)p
Fi(off)p 667 739 24 4 v 29 w(NodeNav::off)p 1164 739
V 30 w(NodeNav)i Fj(implementation.)d Fk(i)p Fq(\021)598
830 y Fi(//)39 b(Creates)i(a)f(node)g(navigator.)598
922 y(off_NodeNav::off_NodeNav\(off_N)q(ode)45 b(&nd\))c(:)755
1013 y(n_nd\(nd\),)755 1104 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
2168 1104 V 29 w(NodeNav)p Fj(.)i Fk(i)598 1196 y Fi({)676
1287 y(assert\(nd.valid\(\)\);)598 1378 y(})639 1503
y Fz(No)n(w)e(w)n(e)h(can)f(implemen)n(t)h(this)g(metho)r(d:)515
1619 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1619 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1710 y Fi(off_Navigator)42 b(*get_navigator\(void\))83
b({)39 b(return)i(new)f(off_NodeNav\(*this\);)j(})515
1868 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1959 y Fi(#include)41 b(<klib/nav.h>)434
b(//)40 b(for)g(off_Navigator)598 2051 y(#include)h(<node/ndnav.h>)356
b(//)40 b(for)g(off_NodeNav)639 2192 y Fz(Besides,)27
b(this)h(other)f(one)g(is)h(fairly)f(trivial)g(to)r(o.)515
2308 y Fk(h)p Fi(off)p 667 2308 V 29 w(NodeNav::get)p
1164 2308 V 30 w(current)j Fj(implementation.)d Fk(i)p
Fq(\021)598 2399 y Fi(//)39 b(Returns)i(a)f(reference)h(to)f(the)g
(resource)h(being)f(navigated)598 2491 y(off_Resource)i
(*off_NodeNav::get_current\(void)q(\))598 2582 y({)676
2673 y(return)f(&n_nd;)598 2765 y(})639 2889 y Fz(The)25
b(k)n(ey)e(metho)r(ds)i(are)e Fx(reset)f Fz(and)i Fx(get)p
1957 2889 27 4 v 30 w(next)p Fz(.)35 b(They)24 b(use)g(some)g(mem)n(b)r
(ers)f(to)i(k)n(eep)515 2989 y(the)j(iteration)f(state.)515
3105 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3105 24 4 v 29 w(NodeNav)p Fj(.)g Fk(i)p
Fq(\021)598 3196 y Fi(enum)79 b({)676 3288 y(N_MBANK=0,)676
3379 y(N_IOBANK,)676 3470 y(N_PROC,)676 3562 y(//)g(N_DMA,)676
3653 y(N_SHTL,)676 3744 y(N_PRTL,)676 3836 y(N_DMM,)676
3927 y(N_EXHAUST)598 4018 y(};)598 4110 y(natural_t)41
b(n_resource;)434 b(//)40 b(resource)h(kind)f(being)g(navigated)i
(inside)e(n_nd.)598 4201 y(natural_t)h(n_pos;)629 b(//)40
b(resource)h(nb.)598 4384 y(boolean_t)g(valid\(void\))h(const)e({)676
4475 y(return)h(n_resource)g(<=)f(N_EXHAUST;)159 b(//)40
b(It's)g(always)h(>=N_MBANK)598 4566 y(})515 4724 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 4724 V 29 w(NodeNav)p Fj(.)i Fk(i)p Fq(\021)676
4815 y Fi(n_resource\(N_MBANK\),)44 b(n_pos\(0\))1885
5255 y Fz(145)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
146 147 bop 639 523 a Fz(The)28 b(initial)g(state)f(is)h(reco)n(v)n
(ered)d(b)n(y)i Fx(reset)p Fz(.)515 656 y Fk(h)p Fi(off)p
667 656 24 4 v 29 w(NodeNav::reset)j Fj(implementation.)e
Fk(i)o Fq(\021)598 747 y Fi(//)39 b(Resets)i(the)f(iteration)h(so)f
(that)g(get_next)h(will)f(return)h(the)f(1st)g(element.)598
839 y(void)g(off_NodeNav::reset\(void\))598 930 y({)676
1021 y(n_resource=N_MBANK;)676 1112 y(n_pos=0;)598 1204
y(})1885 5255 y Fz(146)p eop
PStoPSsaved restore
%%Page: (148,149) 75
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
147 148 bop 639 523 a Fz(Iteration)29 b(is)g(adv)-5 b(anced)29
b(b)n(y)g Fx(get)p 1688 523 27 4 v 30 w(next)p Fz(.)41
b(It)30 b(adv)-5 b(ances)28 b(the)i(iterator)e(using)h(the)h(no)r(de)
515 623 y(na)n(vigation)c(metho)r(ds.)515 739 y Fk(h)p
Fi(off)p 667 739 24 4 v 29 w(NodeNav::get)p 1164 739
V 30 w(next)j Fj(implementation.)e Fk(i)p Fq(\021)598
830 y Fi(//)39 b(Advances)i(the)f(iteration)i(and)e(returns)g(the)g
(next)g(element.)598 922 y(off_CompResource)j
(*off_NodeNav::get_next\(void\))598 1013 y({)676 1104
y(off_CompResource)g(*res=NULL;)676 1196 y(assert\(valid\(\)\);)676
1287 y(switch\(n_resource\){)676 1378 y(case)d(N_MBANK:)755
1469 y(if)f(\(n_pos==n_nd.get_num_mbanks\()q(\)\){)833
1561 y(n_pos=0;)i(n_resource++;)833 1652 y(res=)f(get_next\(\);)755
1743 y(})755 1835 y(else)g({)833 1926 y
(res=&n_nd.get_mbank\(n_pos++\);)833 2017 y(break;)755
2109 y(})676 2200 y(case)g(N_IOBANK:)755 2291 y(if)f
(\(n_pos==n_nd.get_num_iobanks)q(\(\)\){)833 2383 y(n_pos=0;)i
(n_resource++;)833 2474 y(res=)f(get_next\(\);)755 2565
y(})755 2657 y(else)833 2748 y(res=&n_nd.get_iobank\(n_pos++\))q(;)755
2839 y(break;)676 2931 y(case)g(N_PROC:)755 3022 y(if)f
(\(n_pos==n_nd.get_num_procs\(\))q(\){)833 3113 y(n_pos=0;)i
(n_resource++;)833 3205 y(res=)f(get_next\(\);)755 3296
y(})755 3387 y(else)833 3479 y(res=&n_nd.get_proc\(n_pos++\);)755
3570 y(break;)598 3661 y(#if)g(0)588 b(//)40 b(XXX)g(fix)g(this)676
3753 y(case)g(N_DMA:)755 3844 y(if)f(\(n_pos==n_nd.get_num_dmas\(\)\))q
({)833 3935 y(n_pos=0;)i(n_resource++;)833 4027 y(res=)f(get_next\(\);)
755 4118 y(})755 4209 y(else)833 4301 y(res=&n_nd.get_dma\(n_pos++\);)
755 4392 y(break;)598 4483 y(#endif)g(//)g(0)676 4575
y(case)g(N_SHTL:)755 4666 y(res=&n_nd.get_shtl\(\);)755
4757 y(n_resource++;)755 4848 y(break;)676 4940 y(case)g(N_PRTL:)1885
5255 y Fz(147)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
148 149 bop 755 523 a Fi(res=&n_nd.get_prtl\(\);)755
614 y(n_resource++;)755 706 y(break;)676 797 y(case)40
b(N_DMM:)755 888 y(res=&n_nd.get_dmm\(\);)755 980 y(n_resource++;)755
1071 y(break;)676 1162 y(case)g(N_EXHAUST:)755 1254 y(break;)676
1345 y(default:)755 1436 y(panic\("node)h(nagivator:)h(invalid)f
(resource)g(id."\);)676 1528 y(})676 1619 y(return)g(res;)598
1710 y(})515 1959 y Fk(h)p Fj(O\013)27 b(no)l(de)h(navigator)h
(implementation)f(dep)l(endencies.)i Fk(i)o Fq(\021)598
2051 y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40
b(for)g(otsan)g(et)g(al.)639 2192 y Fz(The)h(last)f(couple)g(of)g
(iteration)f(metho)r(ds)i(are)e(implemen)n(ted)i(with)g(those)f(sho)n
(wn)515 2291 y(ab)r(o)n(v)n(e.)515 2424 y Fk(h)p Fi(off)p
667 2424 24 4 v 29 w(NodeNav::operator[])71 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 2516 y Fi(//)39 b(Selects)i(a)f(component)h(by)f
(name.)598 2607 y(off_CompResource)j(*off_NodeNav::operator[]\(const)j
(char)40 b(*name\))598 2698 y({)676 2790 y(off_CompResource)j(*res;)676
2881 y(assert\(name)f(&&)e(valid\(\)\);)676 2972 y(reset\(\);)676
3064 y(while)h(\()e(\(res=get_next\(\)\))k(&&)d
(strcmp\(res->nameof\(\),name\))45 b(\))755 3155 y(;)676
3246 y(return)c(res;)598 3337 y(})515 3603 y Fk(h)p Fi(off)p
667 3603 V 29 w(NodeNav::operator[])71 b Fj(implementation.)27
b Fk(i)p Fz(+)o Fq(\021)598 3694 y Fi(//)39 b(Selects)i(a)f(component)h
(by)f(name.)598 3786 y(off_CompResource)j
(*off_NodeNav::operator[]\(const)j(off_id_t)41 b(&id\))598
3877 y({)676 3968 y(off_CompResource)i(*res;)676 4060
y(assert\(valid\(\)\);)676 4151 y(reset\(\);)676 4242
y(while)e(\()e(\(res=get_next\(\)\))k(&&)d(res->get_id\(\))i(!=)d(id)h
(\))755 4334 y(;)676 4425 y(return)h(res;)598 4516 y(})1885
5255 y Fz(148)p eop
PStoPSsaved restore
%%Page: (150,151) 76
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
149 150 bop 515 523 a Fn(3.2.2)112 b(The)38 b(no)s(de)g(insp)s(ector)
515 676 y Fz(The)27 b(no)r(de)h(insp)r(ector's)f(attribute)h(arra)n(y)d
(lo)r(oks)i(lik)n(e)g(this:)515 793 y Fk(h)p Fj(O\013)g
Fi(nd)h Fj(insp)l(e)l(ctor)h(attribute)h(arr)l(ay)f(initializer.)d
Fk(i)p Fq(\021)598 884 y Fi({)39 b({)h(OFF_STR_ATTR)i(,)d("name",)198
b(&off_Node::nameof)43 b(},)637 975 y({)c(OFF_STR_ATTR,)82
b("class",)159 b(&off_Node::kindof)43 b(},)637 1066 y({)c(OFF_ID_ATTR,)
121 b("dom",)237 b(&off_Node::get_domain)44 b(},)637
1158 y({)39 b(OFF_ID_ATTR,)121 b("id",)276 b(&off_Node::get_id)43
b(},)637 1249 y({)c(OFF_STR_ATTR,)82 b("url",)237 b(&off_Node::get_url)
43 b(},)637 1340 y({)c(OFF_STR_ATTR,)82 b("provides",)42
b(&off_Node::nameof)h(},)637 1432 y({)c(OFF_STR_ATTR,)82
b(NULL,)276 b(NULL)157 b(},)h(//)39 b(no)h(requeriments.)637
1523 y(//)g(Node)g(specific)h(attributes.)637 1614 y({)e(OFF_STR_ATTR,)
82 b("arch",)198 b(&off_Node::get_arch)82 b(},)40 b(//)g(Architecture)
637 1706 y({)f(OFF_STR_ATTR,)82 b("owner",)159 b(&off_Node::get_owner)
43 b(},)d(//)g(Owner's)h(email)637 1797 y({)e(OFF_STR_ATTR,)82
b("kvers",)159 b(&off_Node::get_kvers)43 b(},)d(//)g(Kernel)g(version)
637 1888 y({)f(OFF_NULL_ATTR,)k(NULL,)276 b(NULL)40 b(})f(})h(//)f(End)
h(of)g(attribute)h(list.)515 2046 y Fk(h)p Fj(O\013)27
b(no)l(de)h(insp)l(e)l(ctor)i(attribute)f(arr)l(ay)g(length.)f
Fk(i)p Fq(\021)598 2137 y Fi(const)40 b(int)g(OFF_NINSP_NATTR=10;)122
b(//)40 b(not)g(counting)h(final)f(NULL)g(attr.)639 2279
y Fz(W)-7 b(e)39 b(already)e(knew)h(man)n(y)g(no)r(de)h(attributes,)i
(only)d(accessors)e(for)i(new)g(no)r(de)h(at-)515 2378
y(tributes)27 b(m)n(ust)h(no)n(w)f(b)r(e)h(implemen)n(ted.)515
2511 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2511 24 4 v 29 w(Node)p Fj(.)f Fk(i)p Fq(\021)598
2602 y Fi(char)40 b(*n_owner;)708 b(//)40 b(Node)g(owner.)598
2694 y(char)g(*n_url;)786 b(//)40 b(Source)g(code)g(url)515
2868 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2868 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)676 2959 y Fi(//)40 b(Get)g(the)g(node)g(URL)g(architecture)i
(and)e(kernel)g(version.)676 3051 y(const)h(char)f(*get_url\(void\))81
b({)e(return)41 b(n_url;)f(})676 3142 y(const)h(char)f
(*get_arch\(void\))i(const)f({)e(return)i(off_Version::arch;)i(})676
3233 y(const)e(char)f(*get_kvers\(void\))j(const)d({)f(return)i
(off_Version::version;)j(})676 3325 y(const)d(char)f
(*get_owner\(void\))j(const)d({)f(return)i(n_owner;)g(})515
3499 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 3590 y Fi(#include)41 b(<klib/Version.h>)278
b(//)40 b(for)g(off_Version)639 3731 y Fz(The)29 b(o)n(wner's)f(email)h
(and)g(source)f(URL)i(are)e(initialized)h(at)g(b)r(o)r(ot)g(time,)i
(when)e(b)r(o)r(ot)515 3831 y(time)f(options)f(are)f(pro)r(cessed.)36
b(Initially)28 b(they)g(are)e(set)i(to)f(n)n(ull)h(v)-5
b(alues.)515 3947 y Fk(h)p Fj(Initialize)26 b(other)j(private)g(memb)l
(ers)g(of)e Fi(off)p 1854 3947 V 29 w(Node)p Fj(.)h Fk(i)o
Fz(+)p Fq(\021)598 4039 y Fi(n_owner=n_url=NULL;)1885
5255 y Fz(149)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
150 151 bop 639 523 a Fz(Giv)n(en)28 b(this)g(attribute)f(list,)h(the)g
(no)r(de)g(insp)r(ector)f(is)g(de\014ned)h(as)f(follo)n(ws)515
639 y Fk(h)p Fj(O\013)g(no)l(de)h(insp)l(e)l(ctor.)h
Fk(i)p Fq(\021)598 731 y Fi(//)39 b(A)h(node)g(inspector.)598
822 y(//)598 913 y(class)g(off_NodeInsp)i(:)e(public)g(off_Inspector)i
({)598 1005 y(private:)676 1096 y(static)f(off_attr_t)g
(n_attrs[OFF_NINSP_NATTR+1];)46 b(//)39 b(for)h(final)h(NULL)f(attr.)
598 1187 y(public:)676 1279 y(//)g(Creates)h(a)e(node)h(inspector.)676
1370 y(off_NodeInsp\(off_Node)k(*nd\);)598 1553 y(};)515
1802 y Fk(h)p Fj(O\013)27 b(no)l(de)h(navigator)h(dep)l(endencies.)h
Fk(i)o Fz(+)p Fq(\021)598 1893 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)639 2034 y Fz(Where)28 b(the)g(attribute)f(arra)
n(y)f(is)h(shared.)515 2150 y Fk(h)p Fj(O\013)g(no)l(de)h(insp)l(e)l
(ctor)i(static)e(memb)l(ers.)h Fk(i)o Fq(\021)598 2242
y Fi(//)39 b(inspector)j(attributes)f(for)f(node.)598
2333 y(off_attr_t)h(off_NodeInsp::n_attrs[OFF_NI)q(NSP_)q(NATTR)q(+1])
46 b(=)1186 2424 y Fk(h)p Fj(O\013)27 b Fi(nd)h Fj(insp)l(e)l(ctor)i
(attribute)f(arr)l(ay)g(initializer.)e Fk(i)598 2516
y Fi(;)639 2640 y Fz(Ev)n(ery)k(time)i Fx(get)p 1214
2640 27 4 v 30 w(inspector)c Fz(is)j(called,)i(a)e(new)g(insp)r(ector)g
(is)h(created.)50 b(The)33 b(user)515 2740 y(should)27
b Fx(delete)e Fz(it)j(whenev)n(er)f(it)h(is)f(no)h(longer)e(needed.)515
2873 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2873 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2964 y Fi(off_Inspector)42 b(*get_inspector\(void\))83
b({)637 3055 y(return)41 b(new)e(off_NodeInsp\(this\);)598
3147 y(})639 3288 y Fz(The)28 b(constructor)e(is)i(v)n(ery)e(simple.)
515 3404 y Fk(h)p Fi(off)p 667 3404 V 29 w(NodeInsp::off)p
1203 3404 V 31 w(NodeInsp)j Fj(implementation.)e Fk(i)p
Fq(\021)598 3495 y Fi(//)39 b(Creates)i(a)f(node)g(inspector.)598
3587 y(off_NodeInsp::off_NodeInsp\(off)q(_Node)46 b(*nd\))40
b(:)676 3678 y(off_Inspector\(nd,)j(n_attrs,)e(OFF_NINSP_NATTR\))598
3769 y({)676 3861 y(assert\(nd)g(&&)f(nd->valid\(\)\);)598
3952 y(})1885 5255 y Fz(150)p eop
PStoPSsaved restore
%%Page: (152,153) 77
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
151 152 bop 515 523 a Fn(3.2.3)112 b(No)s(de)38 b(na)m(vigation)f
Fd(C)8 b FC(++)37 b Fn(source)h(\014les)515 676 y Fz(The)27
b(na)n(vigation)f(co)r(de)i(for)f(no)r(des)g(is)h(k)n(ept)f(in)h
Fx(node/ndnav.h)23 b Fz(and)k Fx(node/ndnav.C)p Fz(.)515
809 y Fk(h)p Fj(ndnav.h*)11 b Fk(i)p Fq(\021)598 900
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_NODE_NAV_H)598
1083 y(#define)g(__OFF_NODE_NAV_H)h(1)598 1266 y Fk(h)p
Fj(O\013)27 b(no)l(de)h(navigator)h(dep)l(endencies.)h
Fk(i)598 1448 y(h)p Fj(O\013)d(no)l(de)h(insp)l(e)l(ctor)i(attribute)f
(arr)l(ay)g(length.)f Fk(i)598 1540 y Fi(#ifdef)40 b(__KERNEL__)598
1631 y Fk(h)p Fj(O\013)27 b(no)l(de)h(navigator.)h Fk(i)598
1722 y(h)p Fj(O\013)e(no)l(de)h(insp)l(e)l(ctor.)h Fk(i)598
1814 y Fi(#endif)40 b(//)g(__KERNEL__)598 1996 y Fk(h)p
Fj(O\013)27 b(no)l(de)h(navigator)h(late)f(dep)l(endencies.)i
Fk(i)598 2179 y Fi(#endif)40 b(//)g(__OFF_NODE_NAV_H)515
2353 y Fk(h)p Fj(ndnav.C*)11 b Fk(i)p Fq(\021)598 2445
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2627 y Fi(#include)41 b(<node/ndnav.h>)356
b(//)40 b(Exported)h(interface.)598 2719 y Fk(h)p Fj(O\013)27
b(no)l(de)h(navigator)h(implementation)f(dep)l(endencies.)i
Fk(i)598 2901 y(h)p Fj(O\013)d(no)l(de)h(insp)l(e)l(ctor)i(static)e
(memb)l(ers.)h Fk(i)598 3084 y(h)p Fi(off)p 750 3084
24 4 v 29 w(NodeNav::off)p 1247 3084 V 31 w(NodeNav)g
Fj(implementation.)e Fk(i)598 3175 y(h)p Fi(off)p 750
3175 V 29 w(NodeInsp::off)p 1286 3175 V 31 w(NodeInsp)i
Fj(implementation.)e Fk(i)598 3267 y(h)p Fi(off)p 750
3267 V 29 w(NodeNav::get)p 1247 3267 V 31 w(current)i
Fj(implementation.)e Fk(i)598 3358 y(h)p Fi(off)p 750
3358 V 29 w(NodeNav::reset)j Fj(implementation.)e Fk(i)598
3449 y(h)p Fi(off)p 750 3449 V 29 w(NodeNav::get)p 1247
3449 V 31 w(next)g Fj(implementation.)f Fk(i)598 3541
y(h)p Fi(off)p 750 3541 V 29 w(NodeNav::operator[])71
b Fj(implementation.)27 b Fk(i)1885 5255 y Fz(151)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
152 153 bop 515 523 a Fr(3.3)135 b(No)t(des)45 b(for)g(plain)h(users)
515 697 y Fk(h)p Fj(O\013)27 b(no)l(de)h(for)g(users.)g
Fk(i)p Fq(\021)598 788 y Fi(class)40 b(off_uNode)h(:)f(public)g
(off_uResource)j({)598 879 y(private:)676 971 y(off_prtl_id_t)f
(get_prtl\(void\))h({)755 1062 y(return)d
(off_id_t\(w_p.get_nd\(\),0,w_p.)q(get_)q(srv\(\))q(\);)676
1153 y(})598 1245 y(public:)598 1336 y(#ifdef)g(__KERNEL__)676
1427 y(off_uNode\(off_Node)k(*r\):)c(off_uResource\(r\))j({;})676
1518 y(off_uNode\(off_Node)h(&r\):)c(off_uResource\(&r\))j({;})598
1610 y(#endif)676 1701 y(off_uNode\(void\))g({;})676
1792 y(off_uNode\(const)g(off_id_t)e(&id\):)f(off_uResource\(id\))j
({;})598 1884 y(#ifndef)e(__KERNEL__)676 1975 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)l(ds.)g Fk(i)598
2158 y Fi(#endif)598 2249 y(};)639 2390 y Fz(No)r(des)f(exp)r(ort)f
(these)h(services.)515 2556 y FA(puts)41 b Fz(Prin)n(ts)27
b(a)g(string)g(on)g(the)h(system)f(console.)36 b(Receiv)n(es:)822
2722 y Fq(\017)41 b Fz(A)28 b(p)r(oin)n(ter)f(to)h(the)g(string)e
Fx(m)p Fz(.)822 2855 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(Access)f(righ)n(ts)g(for)g(the)h(no)r(de)f Fx(r)p Fz(.)722
2988 y Fk(h)p Fj(O\013)g(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fq(\021)805 3079 y Fi(void)40 b(puts\(char)i(m[],)e(off_Rights)h
(r\))f({)884 3171 y(off_nd_puts_req)i(req\(m,r\);)884
3262 y(off_nd_puts_rep)g(rep;)884 3353 y(err_t)e
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 3445 y(if)f(\(err)i(||)e
(rep.m_err\))884 3536 y(errno=\(err\)?err:rep.m_err;)884
3627 y(})722 3835 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fq(\021)805 3926 y Fi(#define)41 b(OFF_MSG_ND_PUTS)i(0x00f)884
4017 y(struct)d(off_nd_puts_req:)j(public)e(off_KernReq)h({)962
4109 y(char)e(*msg;)962 4200 y(off_nd_puts_req\(char)k(s[],)c
(off_Rights)i(r\))d(:)h(msg\(s\),)1041 4291 y
(off_KernReq\(OFF_MSG_ND_PUTS,r\))46 b({;})884 4383 y(};)884
4474 y(struct)40 b(off_nd_puts_rep:)j(public)e(off_KernRep)h({)962
4565 y(off_nd_puts_rep\(err_t)i(res=0\))d(:)e(off_KernRep\(res\))k({;})
884 4657 y(};)1885 5255 y Fz(152)p eop
PStoPSsaved restore
%%Page: (154,155) 78
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
153 154 bop 722 523 a Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fq(\021)805 614 y Fi(void)40
b(puts\(off_nd_puts_req)k(*m,)c(off_nd_puts_rep)j(*r\))805
706 y({)884 797 y(\(void\)r;)884 888 y(if)c(\(!m->msg\))962
980 y(putchar\('\\n'\);)884 1071 y(else)962 1162 y
(printf\("\045s",m->msg\);)805 1254 y(})515 1586 y FA(halt)i
Fz(Stops)28 b(system)f(op)r(eration.)36 b(Receiv)n(es:)822
1752 y Fq(\017)41 b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h(no)
r(de)g Fx(r)p Fz(.)722 1885 y Fk(h)p Fj(O\013)f(no)l(de)i(for)e(users)i
(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 1976 y Fi(void)40
b(halt\(off_Rights)j(r\))d({)962 2067 y(off_nd_halt_req)j(req\(r\);)962
2159 y(off_nd_halt_rep)g(rep;)962 2250 y(err_t)e
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 2341 y(if)f(\(err)g(||)g(rep.m_err\))
1041 2433 y(errno=\(err\)?err:rep.m_err;)884 2524 y(})722
2731 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g Fk(i)p
Fz(+)o Fq(\021)805 2823 y Fi(#define)41 b(OFF_MSG_ND_HALT)i(0x01f)884
2914 y(struct)d(off_nd_halt_req:)j(public)e(off_KernReq)h({)962
3005 y(off_nd_halt_req\(off_Rights)j(r\):)1041 3097 y
(off_KernReq\(OFF_MSG_ND_HALT,r\))h({;})884 3188 y(};)884
3279 y(struct)40 b(off_nd_halt_rep:)j(public)e(off_KernRep)h({)962
3371 y(off_nd_halt_rep\(err_t)i(res=0\))d(:)e(off_KernRep\(res\))k({;})
884 3462 y(};)722 3670 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
3761 y Fi(void)40 b(halt\(off_nd_halt_req)k(*m,)c(off_nd_halt_rep)j
(*r\))805 3852 y({)884 3944 y(\(void\)m;)884 4035 y(\(void\)r;)884
4126 y(nd.halt\("terminated)g(by)d(user)g(process."\);)805
4218 y(})1885 5255 y Fz(153)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
154 155 bop 515 523 a FA(getn)m(umm)m(banks)39 b Fz(Returns)28
b(the)g(n)n(um)n(b)r(er)f(of)h(lo)r(cal)f(memory)f(banks.)37
b(Receiv)n(es:)822 689 y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f
(for)h(the)h(no)r(de)g Fx(r)p Fz(.)722 822 y Fk(h)p Fj(O\013)f(no)l(de)
i(for)e(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805
913 y Fi(natural_t)42 b(get_num_mbanks\(off_Rights)j(r\))39
b({)962 1005 y(off_nd_getnummbanks_req)45 b(req\(r\);)962
1096 y(off_nd_getnummbanks_rep)g(rep;)962 1187 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 1279 y(if)f(\(err)g(||)g(rep.m_err\))
1041 1370 y(errno=\(err\)?err:rep.m_err;)962 1461 y(return)h(rep.n;)884
1553 y(})722 1760 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 1851 y Fi(#define)41 b
(OFF_MSG_ND_GETNUMMBANKS)k(0x03f)884 1943 y(struct)40
b(off_nd_getnummbanks_req:)45 b(public)c(off_KernReq)g({)962
2034 y(off_nd_getnummbanks_req\(off_)q(Righ)q(ts)k(r\))40
b(:)1041 2125 y(off_KernReq\(OFF_MSG_ND_GETNUMM)q(BANKS)q(,r\))46
b({;})884 2217 y(};)884 2308 y(struct)40 b(off_nd_getnummbanks_rep:)45
b(public)c(off_KernRep)g({)962 2399 y(unsigned8_t)h(n;)962
2491 y(off_nd_getnummbanks_rep\(err_)q(t)j(res=0\))c(:)e
(off_KernRep\(res\))k({;})884 2582 y(};)722 2790 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(for)e(users)i(in-kernel)g(metho)l(ds.)f
Fk(i)p Fz(+)p Fq(\021)805 2881 y Fi(void)40 b
(get_num_mbanks\(off_nd_getnu)q(mmba)q(nks_r)q(eq)45
b(*m,)40 b(off_nd_getnummbanks_rep)45 b(*r\))805 2972
y({)884 3064 y(\(void\)m;)884 3155 y(r->n=nd.get_num_mbanks\(\);)805
3246 y(})722 3454 y Fz(There)27 b(are)g(similar)g(messages)f(for)h
(other)g(con)n(tainers)f(within)i(the)g(no)r(de.)722
3570 y Fk(h)p Fj(O\013)f(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)805 3661 y Fi(natural_t)42 b
(get_num_iobanks\(off_Rights)j(r\))39 b({)884 3753 y
(off_nd_getnumiobanks_req)44 b(req\(r\);)884 3844 y
(off_nd_getnumiobanks_rep)g(rep;)884 3935 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 4027 y(if)f(\(err)i(||)e
(rep.m_err\))884 4118 y(errno=\(err\)?err:rep.m_err;)884
4209 y(return)h(rep.n;)884 4301 y(})1885 5255 y Fz(154)p
eop
PStoPSsaved restore
%%Page: (156,157) 79
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
155 156 bop 722 523 a Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41 b
(OFF_MSG_ND_GETNUMIOBANKS)k(0x05f)884 706 y(struct)40
b(off_nd_getnumiobanks_req:)45 b(public)c(off_KernReq)h({)962
797 y(off_nd_getnumiobanks_req\(off)q(_Rig)q(hts)j(r\))40
b(:)1041 888 y(off_KernReq\(OFF_MSG_ND_GETNUMI)q(OBANK)q(S,r\))46
b({;})884 980 y(};)884 1071 y(struct)40 b(off_nd_getnumiobanks_rep:)45
b(public)c(off_KernRep)h({)962 1162 y(unsigned8_t)g(n;)962
1254 y(off_nd_getnumiobanks_rep\(err)q(_t)j(res=0\))c(:)e
(off_KernRep\(res\))k({;})884 1345 y(};)722 1553 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(for)e(users)i(in-kernel)g(metho)l(ds.)f
Fk(i)p Fz(+)p Fq(\021)805 1644 y Fi(void)40 b
(get_num_iobanks\(off_nd_getn)q(umio)q(banks)q(_req)46
b(*m,)40 b(off_nd_getnumiobanks_rep)k(*r\))805 1735 y({)884
1826 y(\(void\)m;)884 1918 y(r->n=nd.get_num_iobanks\(\);)805
2009 y(})722 2308 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)
l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 2399 y Fi(natural_t)42
b(get_num_procs\(off_Rights)i(r\))c({)884 2491 y
(off_nd_getnumprocs_req)k(req\(r\);)884 2582 y(off_nd_getnumprocs_rep)g
(rep;)884 2673 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
2765 y(if)f(\(err)i(||)e(rep.m_err\))884 2856 y
(errno=\(err\)?err:rep.m_err;)884 2947 y(return)h(rep.n;)884
3039 y(})722 3337 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 3429 y Fi(#define)41 b
(OFF_MSG_ND_GETNUMPROCS)j(0x07f)884 3520 y(struct)c
(off_nd_getnumprocs_req:)45 b(public)40 b(off_KernReq)i({)962
3611 y(off_nd_getnumprocs_req\(off_R)q(ight)q(s)j(r\))40
b(:)1041 3703 y(off_KernReq\(OFF_MSG_ND_GETNUMP)q(ROCS,)q(r\))45
b({;})884 3794 y(};)884 3885 y(struct)40 b(off_nd_getnumprocs_rep:)45
b(public)40 b(off_KernRep)i({)962 3977 y(unsigned8_t)g(n;)962
4068 y(off_nd_getnumprocs_rep\(err_t)k(res=0\))40 b(:)g
(off_KernRep\(res\))j({;})884 4159 y(};)722 4367 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(for)e(users)i(in-kernel)g(metho)l(ds.)f
Fk(i)p Fz(+)p Fq(\021)805 4458 y Fi(void)40 b
(get_num_procs\(off_nd_getnum)q(proc)q(s_req)46 b(*m,)40
b(off_nd_getnumprocs_rep)k(*r\))805 4550 y({)884 4641
y(\(void\)m;)884 4732 y(r->n=nd.get_num_procs\(\);)805
4824 y(})1885 5255 y Fz(155)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
156 157 bop 515 523 a FA(getm)m(bank)41 b Fz(Returns)27
b(a)g(memory)g(bank.)37 b(Receiv)n(es:)822 689 y Fq(\017)k
Fz(The)28 b(n)n(um)n(b)r(er)f(of)g(bank)h(w)n(e)f(w)n(an)n(t)g(to)g
(get)h Fx(id)p Fz(.)822 822 y Fq(\017)41 b Fz(Read)27
b(access)g(righ)n(ts)f(for)h(the)h(no)r(de)g Fx(r)p Fz(.)722
955 y Fk(h)p Fj(O\013)f(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)884 1046 y Fi(off_uMBank)41 b
(get_mbank\(natural_t)j(id,)c(off_Rights)h(r\))f({)962
1137 y(off_nd_getmbank_req)k(req\(id,r\);)962 1229 y
(off_nd_getmbank_rep)g(rep;)962 1320 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 1411 y(if)f(\(err)g(||)g(rep.m_err\))
1041 1503 y(errno=\(err\)?err:rep.m_err;)962 1594 y(return)h
(rep.mbank;)884 1685 y(})722 1893 y Fk(h)p Fj(O\013)27
b(no)l(de)i(messages.)g Fk(i)p Fz(+)o Fq(\021)805 1984
y Fi(#define)41 b(OFF_MSG_ND_GETMBANK)j(0x04f)884 2076
y(struct)c(off_nd_getmbank_req:)k(public)d(off_KernReq)g({)962
2167 y(unsigned8_t)h(n;)962 2258 y(off_nd_getmbank_req\(natural_)q(t)j
(i,)40 b(off_Rights)h(r\))f(:)f(n\(\(unsigned8_t\)i\),)1041
2350 y(off_KernReq\(OFF_MSG_ND_GETMBAN)q(K,r\))46 b({;})884
2441 y(};)884 2532 y(struct)40 b(off_nd_getmbank_rep:)k(public)d
(off_KernRep)g({)962 2623 y(off_uMBank)h(mbank;)962 2715
y(off_nd_getmbank_rep\(err_t)j(res=0\))c(:)e(off_KernRep\(res\))k({;})
884 2806 y(};)722 3014 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
3105 y Fi(void)40 b(get_mbank\(off_nd_getmbank_r)q(eq)45
b(*m,)40 b(off_nd_getmbank_rep)k(*r\))805 3196 y({)884
3288 y(if)39 b(\(m->n)i(<)e(nd.get_num_mbanks\(\)\))962
3379 y(r->mbank=nd.get_mbank\(m->n\);)884 3470 y(else)962
3562 y(r->m_err=EINVAL;)805 3653 y(})722 3861 y Fz(There)27
b(are)g(equiv)-5 b(alen)n(t)27 b(metho)r(ds)h(for)f(other)g(banks.)722
3977 y Fk(h)p Fj(O\013)g(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)884 4159 y Fi(off_uIOBank)41 b
(get_iobank\(natural_t)j(id,)c(off_Rights)i(r\))d({)962
4251 y(off_nd_getiobank_req)44 b(req\(id,r\);)962 4342
y(off_nd_getiobank_rep)g(rep;)962 4433 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 4525 y(if)f(\(err)g(||)g(rep.m_err\))
1041 4616 y(errno=\(err\)?err:rep.m_err;)962 4707 y(return)h
(rep.iobank;)884 4799 y(})1885 5255 y Fz(156)p eop
PStoPSsaved restore
%%Page: (158,159) 80
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
157 158 bop 722 523 a Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 706 y Fi(#define)41 b(OFF_MSG_ND_GETIOBANK)j
(0x06f)884 797 y(struct)c(off_nd_getiobank_req:)k(public)d(off_KernReq)
h({)962 888 y(unsigned8_t)g(n;)962 980 y(off_nd_getiobank_req\(natural)
q(_t)j(i,)40 b(off_Rights)h(r\))f(:)g(n\(\(unsigned8_t\)i\),)1041
1071 y(off_KernReq\(OFF_MSG_ND_GETIOBA)q(NK,r\))46 b({;})884
1162 y(};)884 1254 y(struct)40 b(off_nd_getiobank_rep:)k(public)d
(off_KernRep)h({)962 1345 y(off_uIOBank)g(iobank;)962
1436 y(off_nd_getiobank_rep\(err_t)j(res=0\))c(:)e(off_KernRep\(res\))k
({;})884 1528 y(};)722 1826 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e
(users)i(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
2009 y Fi(void)40 b(get_iobank\(off_nd_getiobank)q(_req)46
b(*m,)40 b(off_nd_getiobank_rep)j(*r\))805 2100 y({)884
2192 y(if)c(\(m->n)i(<)e(nd.get_num_iobanks\(\)\))962
2283 y(r->iobank=nd.get_iobank\(m->n)q(\);)884 2374 y(else)962
2466 y(r->m_err=EINVAL;)805 2557 y(})722 2856 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)l(ds.)g Fk(i)p
Fz(+)o Fq(\021)884 2947 y Fi(off_uProcessor)42 b(get_proc\(natural_t)i
(id,)39 b(off_Rights)j(r\))e({)962 3039 y(off_nd_getproc_req)k
(req\(id,r\);)962 3130 y(off_nd_getproc_rep)g(rep;)962
3221 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q
(size)q(of\(r)q(ep\),&)q(req,)q(&rep,)q(0\);)962 3313
y(if)f(\(err)g(||)g(rep.m_err\))1041 3404 y
(errno=\(err\)?err:rep.m_err;)962 3495 y(return)h(rep.proc;)884
3587 y(})722 3794 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 3885 y Fi(#define)41 b(OFF_MSG_ND_GETPROC)i
(0x08f)884 3977 y(struct)d(off_nd_getproc_req:)k(public)d(off_KernReq)g
({)962 4068 y(unsigned8_t)h(n;)962 4159 y
(off_nd_getproc_req\(natural_t)k(i,)40 b(off_Rights)h(r\))f(:)f
(n\(\(unsigned8_t\)i\),)1041 4251 y(off_KernReq\(OFF_MSG_ND_GETPROC)q
(,r\))45 b({;})884 4342 y(};)884 4433 y(struct)40 b
(off_nd_getproc_rep:)k(public)d(off_KernRep)g({)962 4525
y(off_uProcessor)i(proc;)962 4616 y(off_nd_getproc_rep\(err_t)i
(res=0\))c(:)e(off_KernRep\(res\))k({;})884 4707 y(};)1885
5255 y Fz(157)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
158 159 bop 722 523 a Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
614 y Fi(void)40 b(get_proc\(off_nd_getproc_req)46 b(*m,)40
b(off_nd_getproc_rep)j(*r\))805 706 y({)884 797 y(if)c(\(m->n)i(<)e
(nd.get_num_procs\(\)\))962 888 y(r->proc=nd.get_proc\(m->n\);)884
980 y(else)962 1071 y(r->m_err=EINVAL;)805 1162 y(})722
1370 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)884 1461 y Fi(off_uShtlSrv)42 b
(get_shtl\(off_Rights)h(r\))d({)962 1553 y(off_nd_getshtl_req)k
(req\(r\);)962 1644 y(off_nd_getshtl_rep)g(rep;)962 1735
y(err_t)d(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q
(of\(r)q(ep\),&)q(req,)q(&rep,)q(0\);)962 1826 y(if)f(\(err)g(||)g
(rep.m_err\))1041 1918 y(errno=\(err\)?err:rep.m_err;)962
2009 y(return)h(rep.s;)884 2100 y(})722 2308 y Fk(h)p
Fj(O\013)27 b(no)l(de)i(messages.)g Fk(i)p Fz(+)o Fq(\021)805
2491 y Fi(#define)41 b(OFF_MSG_ND_GETSHTL)i(0x09f)884
2582 y(struct)d(off_nd_getshtl_req:)k(public)d(off_KernReq)g({)962
2673 y(off_nd_getshtl_req\(off_Right)q(s)k(r\):)1041
2765 y(off_KernReq\(OFF_MSG_ND_GETSHTL)q(,r\))g({;})884
2856 y(};)884 2947 y(struct)40 b(off_nd_getshtl_rep:)k(public)d
(off_KernRep)g({)962 3039 y(off_uShtlSrv)h(s;)962 3130
y(off_nd_getshtl_rep\(err_t)j(res=0\))c(:)e(off_KernRep\(res\))k({;})
884 3221 y(};)722 3520 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
3611 y Fi(void)40 b(get_shtl\(off_nd_getshtl_req)46 b(*m,)40
b(off_nd_getshtl_rep)j(*r\))805 3703 y({)884 3794 y(\(void\)m;)884
3885 y(r->s=nd.get_shtl\(\);)805 3977 y(})722 4184 y
Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)884 4276 y Fi(off_uPrtlSrv)42 b
(get_prtl\(off_Rights)h(r\))d({)962 4367 y(off_nd_getprtl_req)k
(req\(r\);)962 4458 y(off_nd_getprtl_rep)g(rep;)962 4550
y(err_t)d(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q
(of\(r)q(ep\),&)q(req,)q(&rep,)q(0\);)962 4641 y(if)f(\(err)g(||)g
(rep.m_err\))1041 4732 y(errno=\(err\)?err:rep.m_err;)962
4824 y(return)h(rep.p;)884 4915 y(})1885 5255 y Fz(158)p
eop
PStoPSsaved restore
%%Page: (160,161) 81
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
159 160 bop 722 523 a Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_ND_GETPRTL)i
(0x0af)884 706 y(struct)d(off_nd_getprtl_req:)k(public)d(off_KernReq)g
({)962 797 y(off_nd_getprtl_req\(off_Right)q(s)k(r\))40
b(:)1041 888 y(off_KernReq\(OFF_MSG_ND_GETPRTL)q(,r\))45
b({;})884 980 y(};)884 1071 y(struct)40 b(off_nd_getprtl_rep:)k(public)
d(off_KernRep)g({)962 1162 y(off_uPrtlSrv)h(p;)962 1254
y(off_nd_getprtl_rep\(err_t)j(res=0\))c(:)e(off_KernRep\(res\))k({;})
884 1345 y(};)722 1553 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
1644 y Fi(void)40 b(get_prtl\(off_nd_getprtl_req)46 b(*m,)40
b(off_nd_getprtl_rep)j(*r\))805 1735 y({)884 1826 y(\(void\)m;)884
1918 y(r->p=nd.get_prtl\(\);)805 2009 y(})722 2217 y
Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)884 2308 y Fi(off_uDMM)41 b(get_dmm\(off_Rights)i
(r\))d({)962 2399 y(off_nd_getdmm_req)j(req\(r\);)962
2491 y(off_nd_getdmm_rep)g(rep;)962 2582 y(err_t)e
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 2673 y(if)f(\(err)g(||)g(rep.m_err\))
1041 2765 y(errno=\(err\)?err:rep.m_err;)962 2856 y(return)h(rep.d;)884
2947 y(})722 3155 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 3246 y Fi(#define)41 b(OFF_MSG_ND_GETDMM)i
(0x0bf)884 3337 y(struct)d(off_nd_getdmm_req:)k(public)c(off_KernReq)i
({)962 3429 y(off_nd_getdmm_req\(off_Rights)k(r\))40
b(:)1041 3520 y(off_KernReq\(OFF_MSG_ND_GETDMM,)q(r\))45
b({;})884 3611 y(};)884 3703 y(struct)40 b(off_nd_getdmm_rep:)k(public)
c(off_KernRep)i({)962 3794 y(off_uDMM)f(d;)962 3885 y
(off_nd_getdmm_rep\(err_t)k(res=0\))40 b(:)g(off_KernRep\(res\))j({;})
884 3977 y(};)722 4184 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
4276 y Fi(void)40 b(get_dmm\(off_nd_getdmm_req)45 b(*m,)40
b(off_nd_getdmm_rep)j(*r\))805 4367 y({)884 4458 y(\(void\)m;)884
4550 y(r->d=nd.get_dmm\(\);)805 4641 y(})1885 5255 y
Fz(159)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
160 161 bop 515 523 a FA(setcout)41 b Fz(Install)28 b(a)f(user)g
(handler)g(for)g(console)f(logging.)36 b(Receiv)n(es:)822
689 y Fq(\017)41 b Fz(The)28 b(p)r(ortal)f(where)g(log)f(messages)g
(should)i(b)r(e)g(sen)n(t)f Fx(p)p Fz(.)822 822 y Fq(\017)41
b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(no)r(de)f
Fx(nr)p Fz(.)822 955 y Fq(\017)41 b Fz(Execute)27 b(access)f(righ)n(ts)
h(for)g(the)h(p)r(ortal)f Fx(pr)p Fz(.)722 1088 y Fk(h)p
Fj(O\013)g(no)l(de)i(for)e(users)i(metho)l(ds.)g Fk(i)p
Fz(+)o Fq(\021)884 1179 y Fi(err_t)40 b(set_cout\(const)j
(off_prtl_id_t)f(p,)1158 1270 y(off_Rights)g(r,)e(off_Rights)h(pr\))f
({)962 1362 y(off_nd_setcout_req)k(req\(p,r,pr\);)962
1453 y(off_nd_setcout_rep)g(rep;)962 1544 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),siz)q(eof\()q(req\),)q(size)q(of\(r)q
(ep\),&)q(req,)q(&rep,)q(0\);)962 1636 y(if)f(\(err)g(||)g(rep.m_err\))
1041 1727 y(return)g(errno=\(err\)?err:rep.m_err;)962
1818 y(else)1041 1910 y(return)g(EOK;)884 2001 y(})722
2208 y Fk(h)p Fj(O\013)27 b(no)l(de)i(messages.)g Fk(i)p
Fz(+)o Fq(\021)805 2300 y Fi(#define)41 b(OFF_MSG_ND_SETCOUT)i(0x0cf)
884 2391 y(struct)d(off_nd_setcout_req:)k(public)d(off_KernReq)g({)962
2482 y(const)g(off_prtl_id_t)h(out;)962 2574 y(off_Rights)g(outr;)962
2665 y(off_nd_setcout_req\(const)j(off_prtl_id_t)d(p,)1394
2756 y(off_Rights)f(nr,off_Rights)h(pr\))e(:)g(out\(p\),outr\(pr\),)
1041 2848 y(off_KernReq\(OFF_MSG_ND_SETCOUT)q(,nr\))46
b({;})884 2939 y(};)884 3030 y(struct)40 b(off_nd_setcout_rep:)k
(public)d(off_KernRep)g({)962 3122 y(off_nd_setcout_rep\(err_t)k
(res=0\))c(:)e(off_KernRep\(res\))k({;})884 3213 y(};)722
3421 y Fk(h)p Fj(O\013)27 b(no)l(de)i(for)e(users)i(in-kernel)g(metho)l
(ds.)f Fk(i)p Fz(+)p Fq(\021)805 3512 y Fi(void)40 b
(set_cout\(off_nd_setcout_req)46 b(*m,)40 b(off_nd_setcout_rep)j(*r\))
805 3603 y({)884 3694 y(if)c(\(!)h(\(prtl+m->out\)->access_grante)q
(d\(OFF)q(_OP_)q(X,m->)q(outr)q(\)\))962 3786 y(r->m_err=EPERM;)884
3877 y(else)962 3968 y(r->m_err=nd.set_cout\(m->out\))q(;)805
4060 y(})1885 5255 y Fz(160)p eop
PStoPSsaved restore
%%Page: (162,163) 82
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
161 162 bop 515 523 a Fk(h)p Fj(O\013)27 b(no)l(de)h(for)g(users)h
(in-kernel.)f Fk(i)p Fq(\021)598 614 y Fi(class)40 b(off_kNode)h(:)f
(public)g(off_kResource)j({)598 706 y(public:)676 980
y(static)e(err_t)f(handler\(const)i(off_shtl_id_t)h(&sender,)1500
1071 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 1162
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676 1345 y(virtual)g(err_t)f
(handle\(const)i(off_shtl_id_t)h(&sender,)1186 1436 y(vm_size_t)e(msz,)
g(vm_size_t)g(rsz,)1186 1528 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))d
({)755 1619 y(return)h(off_kResource::handle\(sender)q(,msz)q(,rsz,)q
(m,r\))q(;)676 1710 y(})676 1893 y Fk(h)p Fj(O\013)27
b(no)l(de)i(for)e(users)i(in-kernel)g(metho)l(ds.)f Fk(i)598
2076 y Fi(};)1885 5255 y Fz(161)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
162 163 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kNode::handler)30 b Fj(implementation.)e Fk(i)o
Fq(\021)598 614 y Fi(err_t)40 b(off_kNode::handler\(const)45
b(off_shtl_id_t)d(&sender,)1578 706 y(vm_size_t)g(msz,)e(vm_size_t)h
(rsz,)1578 797 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
888 y({)676 980 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y(r->m_err=EOK;)676
1345 y(switch\(m->m_type\){)676 1436 y(case)h(OFF_MSG_R_INIT:)755
1528 y(return)g(EOK;)676 1619 y(case)g(OFF_MSG_ND_PUTS:)755
1710 y(if)f(\(!nd.access_granted\(OFF_OP_W)q(,m->)q(m_ri)q(ghts\))q(\))
833 1802 y(r->m_err=EPERM;)755 1893 y(else)h(if)f
(\(msz!=sizeof\(off_nd_puts_re)q(q\))45 b(||)40 b
(rsz!=sizeof\(off_nd_puts_rep\)\))833 1984 y(r->m_err=EINVAL;)755
2076 y(else)g({)833 2167 y(knd.puts\(\(off_nd_puts_req)45
b(*\)m,)1029 2258 y(\(off_nd_puts_rep)e(*\)r\);)755 2350
y(})755 2441 y(return)d(EOK;)676 2532 y(case)g(OFF_MSG_ND_HALT:)755
2623 y(if)f(\(!nd.access_granted\(OFF_OP_D)q(,m->)q(m_ri)q(ghts\))q(\))
833 2715 y(r->m_err=EPERM;)755 2806 y(else)h(if)f
(\(msz!=sizeof\(off_nd_halt_re)q(q\))45 b(||)40 b
(rsz!=sizeof\(off_nd_halt_rep\)\))833 2897 y(r->m_err=EINVAL;)755
2989 y(else)g({)833 3080 y(knd.halt\(\(off_nd_halt_req)45
b(*\)m,)1029 3171 y(\(off_nd_halt_rep)e(*\)r\);)755 3263
y(})755 3354 y(return)d(EOK;)676 3445 y(case)g
(OFF_MSG_ND_GETNUMMBANKS:)755 3537 y(if)f
(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))833
3628 y(r->m_err=EPERM;)755 3719 y(else)h(if)f
(\(msz!=sizeof\(off_nd_getnumm)q(bank)q(s_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_nd_getnummbank)q(s_re)q(p\)\))833
3811 y(r->m_err=EINVAL;)755 3902 y(else)g({)833 3993
y(knd.get_num_mbanks\(\(off_nd_ge)q(tnum)q(mban)q(ks_re)q(q)45
b(*\)m,)1108 4085 y(\(off_nd_getnummbanks_rep)f(*\)r\);)755
4176 y(})755 4267 y(return)c(EOK;)676 4359 y(case)g
(OFF_MSG_ND_GETMBANK:)755 4450 y(if)f(\(!nd.access_granted\(OFF_OP_R)q
(,m->)q(m_ri)q(ghts\))q(\))833 4541 y(r->m_err=)i(EPERM;)755
4633 y(else)f(if)f(\(msz!=sizeof\(off_nd_getmban)q(k_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_nd_getmbank_re)q(p\)\))833
4724 y(r->m_err=)h(EINVAL;)755 4815 y(else)f({)833 4907
y(knd.get_mbank\(\(off_nd_getmban)q(k_re)q(q)45 b(*\)m,)1068
4998 y(\(off_nd_getmbank_rep)f(*\)r\);)1885 5255 y Fz(162)p
eop
PStoPSsaved restore
%%Page: (164,165) 83
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
163 164 bop 755 523 a Fi(})755 614 y(return)40 b(EOK;)676
706 y(case)g(OFF_MSG_ND_GETNUMIOBANKS:)755 797 y(if)f
(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))833
888 y(r->m_err=)i(EPERM;)755 980 y(else)f(if)f
(\(msz!=sizeof\(off_nd_getnumi)q(oban)q(ks_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_nd_getnumioba)q(nks_)q(rep\)\))833
1071 y(r->m_err=)h(EINVAL;)755 1162 y(else)f({)833 1254
y(knd.get_num_iobanks\(\(off_nd_g)q(etnu)q(miob)q(anks_)q(req)46
b(*\)m,)1147 1345 y(\(off_nd_getnumiobanks_rep)f(*\)r\);)755
1436 y(})755 1528 y(return)40 b(EOK;)676 1710 y(case)g
(OFF_MSG_ND_GETIOBANK:)755 1802 y(if)f(\(!nd.access_granted\(OFF_OP_R)q
(,m->)q(m_ri)q(ghts\))q(\))833 1893 y(r->m_err=)i(EPERM;)755
1984 y(else)f(if)f(\(msz!=sizeof\(off_nd_getioba)q(nk_r)q(eq\))45
b(||)40 b(rsz!=sizeof\(off_nd_getiobank_)q(rep\))q(\))833
2076 y(r->m_err=)h(EINVAL;)755 2167 y(else)f({)833 2258
y(knd.get_iobank\(\(off_nd_getiob)q(ank_)q(req)46 b(*\)m,)1108
2350 y(\(off_nd_getiobank_rep)e(*\)r\);)755 2441 y(})755
2532 y(return)c(EOK;)676 2715 y(case)g(OFF_MSG_ND_GETNUMPROCS:)755
2806 y(if)f(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))
833 2897 y(r->m_err=)i(EPERM;)755 2989 y(else)f(if)f
(\(msz!=sizeof\(off_nd_getnump)q(rocs)q(_req\))46 b(||)40
b(rsz!=sizeof\(off_nd_getnumprocs_)q(rep\))q(\))833 3080
y(r->m_err=)h(EINVAL;)755 3171 y(else)f({)833 3263 y
(knd.get_num_procs\(\(off_nd_get)q(nump)q(rocs)q(_req)46
b(*\)m,)1068 3354 y(\(off_nd_getnumprocs_rep)f(*\)r\);)755
3445 y(})755 3537 y(return)40 b(EOK;)676 3719 y(case)g
(OFF_MSG_ND_GETPROC:)755 3811 y(if)f(\(!nd.access_granted\(OFF_OP_R)q
(,m->)q(m_ri)q(ghts\))q(\))833 3902 y(r->m_err=)i(EPERM;)755
3993 y(else)f(if)f(\(msz!=sizeof\(off_nd_getproc)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_nd_getproc_rep\))q(\))833
4085 y(r->m_err=)h(EINVAL;)755 4176 y(else)f({)833 4267
y(knd.get_proc\(\(off_nd_getproc_)q(req)46 b(*\)m,)1029
4359 y(\(off_nd_getproc_rep)e(*\)r\);)755 4450 y(})755
4541 y(kcout)c(<<)g("proc["<<\(\(off_nd_getproc_rep)46
b(*\)r\)->proc.w_p)c(<<"]";)755 4633 y
(printf\("err\(\045x\)",r->m_err\);)755 4724 y(return)e(EOK;)676
4815 y(case)g(OFF_MSG_ND_GETSHTL:)755 4907 y(if)f
(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))833
4998 y(r->m_err=)i(EPERM;)1885 5255 y Fz(163)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
164 165 bop 755 523 a Fi(else)40 b(if)f(\(msz!=sizeof\(off_nd_getshtl)q
(_req)q(\))45 b(||)40 b(rsz!=sizeof\(off_nd_getshtl_rep\))q(\))833
614 y(r->m_err=)h(EINVAL;)755 706 y(else)f({)833 797
y(knd.get_shtl\(\(off_nd_getshtl_)q(req)46 b(*\)m,)1029
888 y(\(off_nd_getshtl_rep)e(*\)r\);)755 980 y(})755
1071 y(return)c(EOK;)676 1162 y(case)g(OFF_MSG_ND_GETPRTL:)755
1254 y(if)f(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))
833 1345 y(r->m_err=)i(EPERM;)755 1436 y(else)f(if)f
(\(msz!=sizeof\(off_nd_getprtl)q(_req)q(\))45 b(||)40
b(rsz!=sizeof\(off_nd_getprtl_rep\))q(\))833 1528 y(r->m_err=)h
(EINVAL;)755 1619 y(else)f({)833 1710 y
(knd.get_prtl\(\(off_nd_getprtl_)q(req)46 b(*\)m,)1029
1802 y(\(off_nd_getprtl_rep)e(*\)r\);)755 1893 y(})755
1984 y(return)c(EOK;)676 2076 y(case)g(OFF_MSG_ND_GETDMM:)755
2167 y(if)f(\(!nd.access_granted\(OFF_OP_R)q(,m->)q(m_ri)q(ghts\))q(\))
833 2258 y(r->m_err=)i(EPERM;)755 2350 y(else)f(if)f
(\(msz!=sizeof\(off_nd_getdmm_)q(req\))46 b(||)39 b
(rsz!=sizeof\(off_nd_getdmm_r)q(ep\)\))833 2441 y(r->m_err=)i(EINVAL;)
755 2532 y(else)f({)833 2623 y(knd.get_dmm\(\(off_nd_getdmm_re)q(q)45
b(*\)m,)990 2715 y(\(off_nd_getdmm_rep)e(*\)r\);)755
2806 y(})755 2897 y(return)d(EOK;)676 3080 y(case)g
(OFF_MSG_ND_SETCOUT:)755 3171 y(if)f(\(!nd.access_granted\(OFF_OP_R)q
(,m->)q(m_ri)q(ghts\))q(\))833 3263 y(r->m_err=)i(EPERM;)755
3354 y(else)f(if)f(\(msz!=sizeof\(off_nd_setcout)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_nd_setcout_rep\))q(\))833
3445 y(r->m_err=)h(EINVAL;)755 3537 y(else)f({)833 3628
y(knd.set_cout\(\(off_nd_setcout_)q(req)46 b(*\)m,)1029
3719 y(\(off_nd_setcout_rep)e(*\)r\);)755 3811 y(})755
3902 y(return)c(EOK;)676 4085 y(default:)755 4176 y(return)g
(knd.handle\(sender,msz,rsz,m,)q(r\);)676 4267 y(})598
4359 y(})1885 5255 y Fz(164)p eop
PStoPSsaved restore
%%Page: (166,167) 84
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
165 166 bop 515 523 a Fr(3.4)135 b(No)t(de)45 b Fc(C)10
b Fb(++)44 b Fr(source)h(\014les)515 705 y Fz(Main)30
b(no)r(de)h(de\014nitions)g(are)e(found)i(in)g Fx(node/Node.h)p
Fz(.)41 b(The)31 b(implemen)n(tation)g(is)f(k)n(ept)515
805 y(in)e Fx(node/Node.C)p Fz(.)515 937 y Fk(h)p Fj(No)l(de.h*)11
b Fk(i)p Fq(\021)598 1029 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1211 y Fi(#ifndef)41 b(__OFF_NODE_H)598 1303 y(#define)g(__OFF_NODE_H)h
(1)598 1485 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h
Fk(i)598 1668 y Fi(#ifdef)40 b(__KERNEL__)598 1759 y
Fk(h)p Fj(O\013)27 b(no)l(de.)h Fk(i)598 1851 y(h)p Fj(O\013)f(no)l(de)
h(exp)l(orte)l(d)i(variables.)e Fk(i)598 1942 y(h)p Fi(off)p
750 1942 24 4 v 29 w(Node::initialized)j Fj(implementation.)c
Fk(i)598 2033 y Fi(#endif)40 b(//)g(__KERNEL__)598 2216
y(#include)h(<prtl/ex.h>)598 2307 y(#include)g(<node/uNode.h>)598
2490 y(#endif)f(//)g(__OFF_NODE_H)515 2756 y Fk(h)p Fj(No)l(de.C*)11
b Fk(i)p Fq(\021)598 2847 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2938 y Fi(#define)41 b(__OFF_NODE_C)598 3029 y(#include)g
(<node/Node.h>)238 b(//)40 b(Exported)h(interface.)598
3121 y Fk(h)p Fj(O\013)27 b(no)l(de)h(implementation)g(dep)l
(endencies.)h Fk(i)598 3395 y(h)p Fj(O\013)e(no)l(de)h(glob)l(al)g
(variables.)g Fk(i)598 3486 y(h)p Fi(off)p 750 3486 V
29 w(Node::off)p 1130 3486 V 30 w(Node)g Fj(implementation.)g
Fk(i)598 3577 y(h)p Fi(off)p 750 3577 V 29 w(Node::halt)h
Fj(implementation.)f Fk(i)598 3669 y(h)p Fi(off)p 750
3669 V 29 w(Node::reboot)i Fj(implementation.)d Fk(i)598
3760 y(h)p Fi(off)p 750 3760 V 29 w(Node::suspend)j Fj(implementation.)
d Fk(i)598 4034 y(h)p Fj(Implementation)h(of)f(other)i(metho)l(ds)g(of)
e Fi(off)p 1976 4034 V 29 w(Node)p Fj(.)h Fk(i)1885 5255
y Fz(165)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
166 167 bop 515 523 a Fk(h)p Fj(uNo)l(de.h*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y(h)p Fj(O\013)f(no)l(de)h
(messages.)h Fk(i)598 797 y(h)p Fj(O\013)e(no)l(de)h(for)g(users.)g
Fk(i)598 980 y Fi(#ifndef)41 b(__KERNEL__)598 1071 y(extern)f
(off_uNode)i(__nd;)236 b(//)40 b(the)g(local)g(Off++)g(node)598
1162 y(extern)g(off_uShtlSrv)i(__shtlsrv;)598 1254 y(extern)e
(off_uPrtlSrv)i(__prtlsrv;)598 1345 y(extern)e(off_uDMM)198
b(__dmm;)598 1436 y(#endif)515 1702 y Fk(h)p Fj(kNo)l(de.h*)11
b Fk(i)q Fq(\021)598 1793 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1885 y Fi(#include)41 b(<node/Node.h>)238 b(//)40 b(Exported)h
(interface.)598 1976 y(#include)g(<klib/str.h>)277 b(//)40
b(for)g(kcout)598 2067 y(#include)h(<klib/kResource.h>)598
2159 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
2250 y(#include)h(<string.h>)598 2433 y(#ifndef)g(__OFF_KNODE_H)598
2524 y(#define)g(__OFF_KNODE_H)h(1)598 2615 y(#ifdef)e(__KERNEL__)598
2798 y Fk(h)p Fj(O\013)27 b(no)l(de)h(for)g(users)h(in-kernel.)f
Fk(i)598 2980 y Fi(#endif)40 b(//)g(__KERNEL__)598 3072
y(#endif)g(//)g(__OFF_KNODE_H)515 3337 y Fk(h)p Fj(kNo)l(de.C*)11
b Fk(i)p Fq(\021)598 3429 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3611 y Fi(#include)41 b(<node/Node.h>)238 b(//)40 b(Exported)h
(interface.)598 3703 y(#include)g(<klib/str.h>)277 b(//)40
b(for)g(kcout)598 3794 y(#include)h(<prtl/ex.h>)473 b(//)40
b(for)g(XDT{Req|Rep})598 3885 y(#include)h(<string.h>)598
4068 y(#include)g("kNode.h")598 4251 y(static)f(off_kNode)i(knd;)275
b(//)40 b(Node)g(wrapper)598 4433 y Fk(h)p Fi(off)p 750
4433 24 4 v 29 w(kNode::handler)30 b Fj(implementation.)e
Fk(i)1885 5255 y Fz(166)p eop
PStoPSsaved restore
%%Page: (168,169) 85
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
167 168 bop 515 523 a Fr(3.5)135 b(System)45 b(b)t(o)t(oting)515
705 y Fz(The)30 b(system)g(en)n(try)g(p)r(oin)n(t,)i(whic)n(h)e(is)g
(called)g(b)n(y)g(the)h(mac)n(hine)f(dep)r(enden)n(t)h(startup)f(af-)
515 805 y(ter)h(basic)f(hardw)n(are)f(initialization)i(is)f(named)h
Fx(main)p Fz(.)46 b(Its)31 b(argumen)n(ts)e(come)i(from)g(the)515
904 y(secondary)26 b(b)r(o)r(ot)h(loader.)639 1004 y(The)20
b(b)r(o)r(otstrapping)e(pro)r(cess)g(consists)h(on)g(pro)r(cessing)f
(system)h(options,)h(creating)e(an)515 1103 y(instance)k(of)g
Fx(Node)f Fz(\(to)h(initialize)h(system)f(global)f(data)h(structures)f
(and)h(create)g(instances)515 1203 y(for)f(system)h(ob)5
b(jects)21 b(to)h(re\015ect)g(the)g(a)n(v)-5 b(ailable)21
b(hardw)n(are)f(and)i(system)g(services\),)g(issuing)515
1303 y(a)35 b(hello)h(message)1092 1273 y Fp(3)1127 1303
y Fz(,)i(and)e(\014nally)f(bringing)g(an)n(y)g(OS)h(mo)r(dule)g(loaded)
f(along)f(with)j(the)515 1402 y(k)n(ernel)30 b(in)n(to)h(op)r(eration)f
(\(b)r(efore)h Fx(main)f Fz(gets)h(called)g(the)g(m)n(ultib)r(o)r(ot)h
(pro)r(cess)e(ma)n(y)h(load)515 1502 y(other)c(system)g(mo)r(dules\).)
639 1602 y(In)n(terrupts)g(are)g(cleared)f(un)n(til)i(ev)n(ery)f
(system)g(serv)n(er)f(has)h(b)r(een)h(started.)515 1734
y Fk(h)p Fj(O\013)f(main)g(entry)i(p)l(oint)f(implementation.)f
Fk(i)p Fq(\021)598 1826 y Fi(//)39 b(main)i(system)f(entry)h(point.)598
1917 y(//)598 2008 y(int)f(main\(int)h(argc,)f(char)g(*argv[]\))598
2100 y({)676 2282 y(off_mdep_init\(\);)676 2374 y({)755
2465 y Fk(h)p Fj(L)l(o)l(c)l(al)28 b(variables)g(of)f
Fi(main)p Fj(.)h Fk(i)755 2648 y Fi(off_Processor::clri\(\);)755
2830 y Fk(h)p Fj(Initialize)e(the)j Fi(nd)e Fj(instanc)l(e.)i
Fk(i)755 2922 y(h)p Fj(Say)f(hel)t(lo)f(to)h(users.)g
Fk(i)755 3013 y(h)p Fj(Start)h(system)g(servers.)g Fk(i)755
3104 y Fi(off_Processor::seti\(\);)755 3196 y Fk(h)p
Fj(Bring)e(OS)h(mo)l(dules)g(up)g(into)f(op)l(er)l(ation.)i
Fk(i)676 3287 y Fi(})598 3378 y(}//main)639 3611 y Fz(T)-7
b(o)28 b(pro)r(cess)e(system)i(options)f(w)n(e)h(emplo)n(y)f(an)h
Fx(Options)d Fz(ob)5 b(ject.)37 b(It)28 b(will)g(do)g(the)g(job)515
3710 y(and)f(pro)n(vide)g(en)n(try)g(p)r(oin)n(ts)g(to)h(insp)r(ect)g
(option)f(settings.)515 3843 y Fk(h)p Fj(L)l(o)l(c)l(al)h(variables)g
(of)f Fi(main)p Fj(.)h Fk(i)p Fq(\021)598 3934 y Fi(off_Options)41
b(opts\(argc,argv\);)514 b(//)40 b(option)g(settings)h(at)f(boot)g
(time.)515 4109 y Fk(h)p Fj(O\013)27 b(main)g(entry)i(p)l(oint)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fq(\021)598
4200 y Fi(#include)41 b(<node/Options.h>)278 b(//)40
b(for)g(off_Options)598 4291 y(#include)h(<hw/Processor.h>)278
b(//)40 b(for)g(clri,)g(seti)g(et)g(al.)p 515 4929 1146
4 v 607 4983 a Fm(3)642 5006 y Fl(This)23 b(is)g(the)h(most)f(imp)r
(ortan)n(t)h(part)g(of)f(the)h(b)r(o)r(oting)h(pro)r(cess.)1885
5255 y Fz(167)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
168 169 bop 639 523 a Fz(Option)29 b(pro)r(cessing)f(will)i(b)r(e)f
(describ)r(ed)g(in)h(section)f(3.5.2,)f(while)h(w)n(e)g(sa)n(y)f(what)i
(op-)515 623 y(tions)c(are)g(a)n(v)-5 b(ailable.)35 b(F)-7
b(or)27 b(ev)n(ery)e(option,)i(the)g(e\013ect)g(in)g(the)g(b)r(eha)n
(vior)f(of)g(the)i(system)e(is)515 722 y(describ)r(ed)h(along)g(with)h
(the)g(description)f(of)g(the)h(system)g(ob)5 b(jects)27
b(in)n(v)n(olv)n(ed.)639 822 y(The)41 b(no)r(de)g(instance,)i
Fx(nd)d Fz(will)h(receiv)n(e)e(the)i(options)f(settings)g(b)n(y)h
Fx(set)p 3026 822 27 4 v 30 w(options)p Fz(.)515 922
y(Then,)28 b(it)h(will)g(pass)e(them)i(in)g(turn)f(to)g(ev)n(ery)f
(system)h(ob)5 b(ject)28 b(it)h(instan)n(tiates.)39 b(Besides,)515
1021 y(the)c(no)r(de)g(protection)f(will)h(b)r(e)g(set)g(b)n(y)g
(generating)e(a)h(new)h(randomized)f Fx(Protection)515
1121 y Fz(\(and)27 b(will)h(b)r(e)g(used)g(later)f(on)g(to)h(protect)f
(remaining)f(system)i(serv)n(ers\).)515 1254 y Fk(h)p
Fj(Initialize)e(the)j Fi(nd)f Fj(instanc)l(e.)g Fk(i)p
Fq(\021)598 1345 y Fi(nd.set_options\(opts\);)598 1436
y(p.randomize\(\);)598 1528 y(nd.protect\(p,OFF_M_ALL\);)515
1702 y Fk(h)p Fj(L)l(o)l(c)l(al)g(variables)g(of)f Fi(main)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 1793 y Fi(off_Protection)42
b(p;)515 1968 y Fk(h)p Fj(O\013)27 b(main)g(entry)i(p)l(oint)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
2059 y Fi(#include)41 b(<klib/prot.h>)395 b(//)40 b(for)g
(off_Protection,)i(OFF_M_ALL)g(et)d(al.)598 2150 y(#include)i
(<node/Node.h>)395 b(//)40 b(for)g(nd)f(and)h(off_Node)639
2291 y Fz(Once)27 b Fx(nd)g Fz(options)g(ha)n(v)n(e)g(b)r(een)h(set,)f
(w)n(e)h(will)f(sa)n(y)g(hello)g(to)h(an)n(y)f(casual)f(user.)515
2408 y Fk(h)p Fj(Say)i(hel)t(lo)f(to)h(users.)h Fk(i)o
Fq(\021)598 2499 y Fi(kcout)40 b(<<)g(nl)f(<<)912 2590
y("System)h(Off")h(<<)e(nl;)598 2773 y(kcout)h(<<"Off++)h
("<<OFF_VERSION<<")i("<<)912 2864 y(OFF_COMPILE_DATE<<")g
("OFF_COMPILE_TIME<<")h("<<)912 2956 y
("\("<<OFF_COMPILE_BY<<"@"<<OFF_C)q(OMPI)q(LE_HO)q(ST<<)q(")h
("<<OFF_COMPILER<<"\)")f(<<)912 3047 y(nl)39 b(<<)h(nl;)639
3171 y Fz(The)20 b(sym)n(b)r(ols)f(used)h(are)e(tak)n(en)i(from)f(a)g
(source)g(\014le)h(generated)e(ev)n(ery)h(time)h(the)g(k)n(ernel)515
3271 y(is)e(built.)35 b(Suc)n(h)19 b(\014le)g(is)g(named)f
Fx(version.h)e Fz(and)i(can)h(b)r(e)g(found)g(in)g(the)g
Fx(klib/Interfaces)515 3371 y Fz(directory)j(\(see)h(section)f
(2.1.1\).)35 b(W)-7 b(e)23 b(m)n(ust)g(th)n(us)h(include)f(that)h
(\014le)f(as)f(w)n(ell)h(as)g(the)g Fx(stdio)515 3470
y Fz(facilities)k(w)n(e)h(are)e(using.)515 3603 y Fk(h)p
Fj(O\013)h(main)g(entry)i(p)l(oint)f(implementation)g(dep)l(endencies.)
h Fk(i)p Fz(+)p Fq(\021)598 3694 y Fi(#include)41 b(<klib/version.h>)
278 b(//)40 b(Compilation)h(&)f(version)h(symbols.)598
3786 y(#include)g(<stdio.h>)551 b(//)40 b(Basic)g(I/O)g(facilities.)639
3927 y Fz(T)-7 b(o)30 b(bring)g(the)h(system)f(up,)i(system)e(serv)n
(ers)e(are)i(started)f(and)i(protected)f(with)h(the)515
4027 y(same)c(protection)g(created)f(b)r(efore)i(for)f(the)h(no)r(de)f
(itself.)515 4143 y Fk(h)p Fj(Start)i(system)g(servers.)g
Fk(i)p Fq(\021)598 4234 y Fi(nd.srvstart\(p\);)639 4359
y Fz(The)f Fx(srvstart)c Fz(metho)r(d)k(do)r(es)g(the)g(job.)515
4475 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4475 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
4566 y Fi(//)39 b(Starts)i(system)g(servers.)598 4658
y(void)f(srvstart\(const)i(off_Protection)h(&prot\);)1885
5255 y Fz(168)p eop
PStoPSsaved restore
%%Page: (170,171) 86
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
169 170 bop 639 523 a Fz(Finally)-7 b(,)25 b(after)e(ev)n(erything)g
(has)g(b)r(een)h(initialized)g(and)f(the)h(system)g(brough)n(t)e(up)i
(in)n(to)515 623 y(op)r(eration,)40 b(w)n(e)d(will)i(start)f(an)n(y)f
(OS)h(mo)r(dule)h(loaded)e(along)g(with)i(the)g(k)n(ernel)e(image)515
722 y(b)n(y)f(the)h(secondary)e(b)r(o)r(ot)i(loader.)63
b(These)36 b(mo)r(dules)h(will)g(start)f(in)h(turn)g(OS)f(services)515
822 y(for)31 b(system)h(users.)49 b(A)32 b(new)g(metho)r(d)h(in)f
Fx(Node)p Fz(,)g Fx(modstart)p Fz(,)e(will)i(do)f(the)i(job.)50
b(Mo)r(dule)515 922 y(startup)27 b(co)r(de)g(is)h(th)n(us)g(con)n
(tained)e(inside)i(the)g Fx(Node)e Fz(singleton.)515
1054 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1054 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1146 y Fi(//)39 b(Starts)i(any)f(user)g(module)h(loaded)f(along)h(with)
f(the)g(kernel)g(image.)598 1237 y(void)g(modstart\(void\);)722
1461 y FA(NOTE:)27 b Fz(Add)h(sp)r(ecial)g(mo)r(dule)f(to)h(melt)g
(frozen)f(no)r(des.)639 1644 y(As)36 b(the)h(k)n(ernel)e(will)h(b)r(e)g
(no)g(longer)f(executing)h(after)f(starting)g(up)i(user)e(mo)r(dules,)
515 1743 y(a)e(return)h(from)f Fx(modstart)e Fz(will)j(b)r(e)g
(considered)f(to)h(b)r(e)g(system)f(failure.)56 b(W)-7
b(e)34 b(will)g(not)515 1843 y(call)d Fx(modstart)d Fz(from)j
Fx(main)p Fz(.)47 b(It)32 b(is)f(the)h(idle)g(sh)n(uttle)g(for)f(the)h
(b)r(o)r(ot)f(pro)r(cessor)f(the)h(one)515 1943 y(starting)26
b(OS)i(mo)r(dules.)37 b(Hence,)28 b(w)n(e)f(should)g(nev)n(er)g(return)
g(from)g Fx(srvstart)p Fz(.)515 2076 y Fk(h)p Fj(Bring)g(OS)h(mo)l
(dules)g(up)g(into)f(op)l(er)l(ation.)i Fk(i)p Fq(\021)598
2167 y Fi(panic\("srvstart)42 b(returned?"\);)598 2258
y(nd.halt\(\);)515 2433 y Fk(h)p Fj(O\013)27 b(main)g(entry)i(p)l(oint)
f(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
2524 y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40
b(for)g(panic)g(et)g(al.)515 2798 y Fn(3.5.1)112 b(Main)38
b(en)m(try)f(p)s(oin)m(t)g Fd(C)8 b FC(++)37 b Fn(\014les)515
2951 y Fz(The)27 b Fx(main)f Fz(en)n(try)h(p)r(oin)n(t)h(is)g(k)n(ept)f
(in)h Fx(node/main.C)p Fz(.)23 b(It)28 b(has)f(\\C")g(link)-5
b(age.)515 3067 y Fk(h)p Fj(main.C*)11 b Fk(i)o Fq(\021)598
3159 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3341 y(h)p Fj(O\013)f(main)g(entry)i
(p)l(oint)f(implementation)g(dep)l(endencies.)h Fk(i)598
3524 y Fi(extern)40 b("C")g({)676 3615 y Fk(h)p Fj(O\013)27
b(main)g(entry)i(p)l(oint)f(implementation.)g Fk(i)598
3707 y Fi(})39 b(//)h("C")g(linkage)515 4055 y Fn(3.5.2)112
b(System)37 b(options)515 4208 y Fz(System)d(options)f(are)h(pro)r
(cessed)e(b)n(y)i Fx(Options)p Fz(.)54 b(A)n(t)34 b(creation)f(time,)j
(ev)n(ery)d(argumen)n(t)515 4308 y(giv)n(en)j(b)n(y)g(the)i(user)e
(will)h(b)r(e)g(tak)n(en)g(in)n(to)f(accoun)n(t.)64 b(Later)36
b(on)h(w)n(e)g(can)f(use)h Fx(Options)515 4408 y Fz(metho)r(ds)28
b(to)f(insp)r(ect)h(option)f(setting.)639 4507 y(The)j(main)f(user)g
(of)h Fx(Options)d Fz(is)i(the)h Fx(node)p Fz(.)41 b(It)30
b(accepts)f(option)g(settings)h(with)g(this)515 4607
y(metho)r(d.)515 4723 y Fk(h)p Fj(Other)e(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4723 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 4814 y Fi(//)39 b(Sets)i(user)f(options.)598
4906 y(void)g(set_options\(const)j(off_Options)f(&opts\);)1885
5255 y Fz(169)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
170 171 bop 639 523 a Fz(The)38 b(implemen)n(tation)f(will)h(merely)e
(record)g(the)i(giv)n(en)f(v)-5 b(alue)37 b(and)g(pro)r(cess)f(no)r(de)
515 623 y(sp)r(eci\014c)27 b(options.)515 739 y Fk(h)p
Fj(Implementation)h(of)f(other)i(metho)l(ds)g(of)e Fi(off)p
1893 739 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fq(\021)598
830 y Fi(//)39 b(Sets)i(user)f(options.)598 922 y(void)g
(off_Node::set_options\(const)45 b(off_Options)d(&opts\))598
1013 y({)676 1104 y(assert\(valid\(\)\);)676 1196 y(n_opts=)f(new)f
(off_Options\(opts\);)676 1287 y Fk(h)p Fj(Pr)l(o)l(c)l(ess)30
b(no)l(de)e(sp)l(e)l(ci\014c)h(options)f(fr)l(om)g Fi(n)p
1916 1287 V 28 w(opts)p Fj(.)g Fk(i)676 1378 y(h)p Fj(De)l(clar)l(e)h
(we)e(ar)l(e)i(initialize)l(d.)d Fk(i)598 1469 y Fi(})515
1719 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1719 V 29 w(Node)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 1810 y Fi(off_Options)41 b(*n_opts;)512 b(//)40
b(user)g(options)515 1968 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2059 y Fi(#include)41
b(<node/Options.h>)278 b(//)40 b(for)g(off_Options)639
2183 y Fz(When)30 b(options)f(ha)n(v)n(e)f(b)r(een)i(set,)g(a)f(\015ag)
f(is)h(set)h(to)f(sho)n(w)f(that)i(at)f(least)g(ev)n(ery)f(static)515
2283 y(constructor)21 b(has)g(b)r(een)i(called)f(and)g(the)h(basic)f
(no)r(de)g(mem)n(b)r(ers)g(are)g(initialized.)35 b(Console)515
2383 y(output)28 b(can)f(b)r(e)h(done)f(safely)g(at)h(this)g(p)r(oin)n
(t.)515 2499 y Fk(h)p Fj(De)l(clar)l(e)g(we)g(ar)l(e)g(initialize)l(d.)
f Fk(i)o Fq(\021)598 2590 y Fi(n_initialized=TRUE;)515
2748 y Fk(h)p Fj(O\013)g(no)l(de)h(exp)l(orte)l(d)i(variables.)e
Fk(i)p Fz(+)p Fq(\021)598 2839 y Fi(extern)40 b(boolean_t)i
(n_initialized;)515 3014 y Fk(h)p Fj(O\013)27 b(no)l(de)h(glob)l(al)g
(variables.)g Fk(i)p Fz(+)o Fq(\021)598 3105 y Fi(boolean_t)41
b(n_initialized;)160 b(//)40 b(set)g(to)f(0)h(by)g(the)f(loader.)515
3279 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3279 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3371 y Fi(static)40 b(inline)h(boolean_t)g
(initialized\(void\);)515 3545 y Fk(h)p Fi(off)p 667
3545 V 29 w(Node::initialized)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 3636 y Fi(extern)40 b(inline)h(boolean_t)g
(off_Node::initialized\(void\))85 b({)39 b(return)i(n_initialized;)h(})
515 3811 y Fk(h)p Fj(O\013)27 b(options.)h Fk(i)p Fq(\021)598
3902 y Fi(class)40 b(off_Options)i({)598 3993 y(private:)676
4085 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4085 V 29 w(Options)p Fj(.)i Fk(i)598 4176
y Fi(protected:)676 4267 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 4267 V 29 w(Options)p
Fj(.)i Fk(i)598 4359 y Fi(public:)676 4450 y(off_Options\()42
b(int)e(argc,)g(char)h(*argv[]\);)676 4633 y Fk(h)p Fj(No)l(de)28
b(management)h(public)f(metho)l(ds)h(in)e Fi(off)p 2083
4633 V 29 w(Options)p Fj(.)h Fk(i)676 4724 y(h)p Fj(Memory)g
(management)h(public)f(metho)l(ds)h(in)e Fi(off)p 2192
4724 V 29 w(Options)p Fj(.)h Fk(i)598 4815 y Fi(};)1885
5255 y Fz(170)p eop
PStoPSsaved restore
%%Page: (172,173) 87
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
171 172 bop 639 523 a Fz(As)31 b(w)n(e)f(ha)n(v)n(e)f(seen)h(in)h(the)g
(co)r(de)f(for)g Fx(Options)p Fz(,)e(there)j(are)e(sev)n(eral)g(kind)h
(of)h(options)515 623 y(recognized)26 b(b)n(y)h(the)h(system.)37
b(W)-7 b(e)28 b(describ)r(e)f(them)h(b)r(elo)n(w.)639
722 y(Option)35 b(pro)r(cessing)e(is)h(done)g(almost)g(en)n(tirely)g(b)
n(y)h(the)g Fx(Options)c Fz(constructor.)57 b(It)515
822 y(calls)27 b(a)g(p)r(er-option)g(static)g(metho)r(d)h(used)g(to)f
(\014nd)h(and)g(record)e(the)i(option)f(v)-5 b(alue.)515
955 y Fk(h)p Fi(off)p 667 955 24 4 v 29 w(Options::off)p
1164 955 V 30 w(Options)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 1046 y Fi(off_Options::off_Options\()45 b(int)40
b(argc,)g(char)g(*argv[]\))598 1137 y({)676 1229 y Fk(h)p
Fj(Extr)l(act)30 b(option)e(settings.)h Fk(i)598 1320
y Fi(})515 1669 y FA(No)s(de)h(options)515 1822 y Fz(The)24
b Fx(ndid)e Fz(option)h(ma)n(y)g(b)r(e)h(used)g(to)g(explicitly)g(set)f
(the)h(no)r(de)g(iden)n(ti\014er;)h Fx(useserial)20 b
Fz(to)515 1922 y(enable)29 b(the)i(serial)e(console)g(\(as)g(w)n(e)h
(will)g(see)g(in)g(section)g(3.10.1,)f(basic)g(system)h(console)515
2021 y(output)40 b(can)f(b)r(e)h(redirected)f(to)h(a)f(serial)g(line)g
(for)h(debugging)e(purp)r(oses\);)46 b Fx(owner)37 b
Fz(to)515 2121 y(establish)31 b(the)g(o)n(wner)f(email;)j
Fx(url)d Fz(to)h(establish)g(the)g(base)g(URL)g(for)g(the)g(source)f
(co)r(de;)515 2220 y(and)d Fx(name)f Fz(to)i(name)f(the)h(no)r(de.)515
2353 y Fk(h)p Fj(No)l(de)g(management)h(public)e(metho)l(ds)i(in)e
Fi(off)p 1921 2353 V 29 w(Options)p Fj(.)i Fk(i)p Fq(\021)598
2445 y Fi(//)39 b(Returns)i(the)f(user)g(specified)i(node)e
(identifier.)598 2536 y(inline)g(off_id_t)h(get_ndid\(void\))i(const)d
({return)h(o_ndid;})598 2627 y(//)e(Returns)i(the)f(user)g(specified)i
(useserial)f(value.)598 2719 y(inline)f(boolean_t)i
(get_useserial\(void\))h(const)e({return)f(o_useserial;})598
2810 y(//)f(Returns)i(the)f(user)g(specified)i(owner)e(value.)598
2901 y(inline)g(char)g(*)g(get_owner\(void\))j(const)d({return)h
(o_owner;})598 2993 y(//)e(Returns)i(the)f(user)g(specified)i(url)d
(value.)598 3084 y(inline)h(char)g(*)g(get_url\(void\))i(const)e
({return)h(o_url;})598 3175 y(//)e(Returns)i(the)f(user)g(specified)i
(node)e(value.)598 3267 y(inline)g(char)g(*)g(get_name\(void\))i(const)
f({return)g(o_name;})515 3441 y Fk(h)p Fj(Other)28 b(private)h(memb)l
(ers)f(of)g Fi(off)p 1552 3441 V 29 w(Options)p Fj(.)g
Fk(i)p Fq(\021)598 3532 y Fi(off_id_t)80 b(o_ndid;)590
b(//)40 b(Node)g(identifier.)598 3624 y(boolean_t)h(o_useserial;)395
b(//)40 b(Use)g(serial)g(console?)598 3715 y(char)197
b(*o_owner;)551 b(//)40 b(Owner's)h(email)598 3806 y(char)197
b(*o_url;)629 b(//)40 b(Source)g(code)g(URL.)598 3897
y(char)197 b(*o_name;)590 b(//)40 b(Node)g(name)515 4072
y Fk(h)p Fj(O\013)27 b(options)h(dep)l(endencies.)i Fk(i)p
Fq(\021)598 4163 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(off_id_t)h(et)e(al.)598 4254 y(#include)i
(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)639 4396 y Fz(Option)28 b(v)-5 b(alues)27 b(are)f(obtained)i(b)n
(y)f Fx(scan)p 1944 4396 27 4 v 30 w(ndid)p Fz(.)515
4512 y Fk(h)p Fj(Extr)l(act)i(option)g(settings.)f Fk(i)p
Fq(\021)598 4603 y Fi(o_ndid=scan_ndid\(argc,argv\);)598
4694 y(o_useserial=scan_useserial\(arg)q(c,arg)q(v\);)598
4786 y(o_owner=scan_owner\(argc,argv\);)598 4877 y
(o_url=scan_url\(argc,argv\);)598 4968 y
(o_name=scan_name\(argc,argv\);)1885 5255 y Fz(171)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
172 173 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(Options)p Fj(.)h
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Extracts)i(ndid)g(option)f(value.)
598 706 y(static)g(off_id_t)h(scan_ndid\(int)i(argc,)d(char)g
(*argv[]\);)598 797 y(//)f(Extracts)i(useserial)h(option)e(value.)598
888 y(static)g(boolean_t)i(scan_useserial\(int)h(argc,)d(char)g
(*argv[]\);)598 980 y(//)f(Extracts)i(owner)g(option)f(value.)598
1071 y(static)g(char)g(*scan_owner\(int)j(argc,)d(char)h(*argv[]\);)598
1162 y(//)e(Extracts)i(url)f(option)h(value.)598 1254
y(static)f(char)g(*scan_url\(int)j(argc,)d(char)g(*argv[]\);)598
1345 y(//)f(Extracts)i(name)g(option)f(value.)598 1436
y(static)g(char)g(*scan_name\(int)j(argc,)d(char)g(*argv[]\);)515
1611 y Fk(h)p Fi(off)p 667 1611 V 29 w(Options::scan)p
1203 1611 V 31 w(ndid)28 b Fj(implementation.)g Fk(i)o
Fq(\021)598 1702 y Fi(//)39 b(Extracts)i(ndid)g(option)f(value.)598
1793 y(off_id_t)h(off_Options::scan_ndid\(int)k(argc,)40
b(char)g(*argv[]\))598 1885 y({)676 1976 y(char)g(*idval)h(=)e
(getenv\("ndid"\);)676 2067 y(\(void\)argc;)j(\(void\)argv;)676
2159 y(off_id_t)f(id=)f(OFF_ID_NULL;)676 2250 y(if)g(\(idval!=NULL\){)
755 2341 y(id.i_node=\(off_node_t\)atoi\(idva)q(l\);)676
2433 y(})676 2524 y(else)755 2615 y(id.i_node=1;)676
2707 y(return)h(id;)598 2798 y(})515 3064 y Fk(h)p Fj(O\013)27
b(options)h(implementation)g(dep)l(endencies.)i Fk(i)p
Fq(\021)598 3155 y Fi(#include)41 b(<stdlib.h>)512 b(//)40
b(for)g(getenv)g(and)g(atoi)515 3329 y Fk(h)p Fi(off)p
667 3329 V 29 w(Options::scan)p 1203 3329 V 31 w(useserial)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 3421 y Fi(//)39
b(Extracts)i(ndid)g(option)f(value.)598 3512 y(boolean_t)h
(off_Options::scan_useserial\(i)q(nt)k(argc,)c(char)f(*argv[]\))598
3603 y({)676 3694 y(char)g(*val)g(=)g(getenv\("useserial"\);)676
3786 y(\(void\)argc;)i(\(void\)argv;)676 3877 y(return)f(\(val)f(&&)g
(*val)g(==)f('y')h(||)g(*val)g(==)g('Y'\);)598 3968 y(})515
4234 y Fk(h)p Fi(off)p 667 4234 V 29 w(Options::scan)p
1203 4234 V 31 w(owner)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 4325 y Fi(//)39 b(Extracts)i(owner)g(option)f(value.)598
4417 y(char)g(*off_Options::scan_owner\(int)45 b(argc,)c(char)f
(*argv[]\))598 4508 y({)676 4599 y(char)g(*val)g(=)g
(getenv\("owner"\);)676 4691 y(\(void\)argc;)i(\(void\)argv;)676
4782 y(return)f(val;)598 4873 y(})1885 5255 y Fz(172)p
eop
PStoPSsaved restore
%%Page: (174,175) 88
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
173 174 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Options::scan)p 1203 523 V 31 w(url)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Extracts)i(url)f(option)h(value.)
598 706 y(char)f(*off_Options::scan_url\(int)45 b(argc,)40
b(char)h(*argv[]\))598 797 y({)676 888 y(char)f(*val)g(=)g
(getenv\("url"\);)676 980 y(\(void\)argc;)i(\(void\)argv;)676
1071 y(return)f(val;)598 1162 y(})515 1420 y Fk(h)p Fi(off)p
667 1420 V 29 w(Options::scan)p 1203 1420 V 31 w(name)28
b Fj(implementation.)g Fk(i)o Fq(\021)598 1511 y Fi(//)39
b(Extracts)i(url)f(option)h(value.)598 1602 y(char)f
(*off_Options::scan_name\(int)45 b(argc,)c(char)f(*argv[]\))598
1694 y({)676 1785 y(char)g(*val)g(=)g(getenv\("name"\);)676
1876 y(\(void\)argc;)i(\(void\)argv;)676 1968 y(return)f(val;)598
2059 y(})639 2287 y Fz(The)27 b(no)r(de)f(instance)g(will)h(pro)r(cess)
e(these)h(option)g(b)n(y)g(adjusting)g(the)h(no)r(de)f(iden)n(ti\014er)
515 2387 y(to)18 b(that)h(sp)r(eci\014ed)f(b)n(y)g(the)h(user)f(and)g
(activ)-5 b(ating)18 b(the)h(serial)e(console)g(\(with)i
Fx(use)p 3006 2387 27 4 v 30 w(serial)p 3300 2387 V 29
w(console)p Fz(\))515 2487 y(if)31 b(appropriate.)46
b(The)31 b(con)n(v)n(en)n(tion)f(is)h(that)g(the)h(no)r(de)f(domain)g
(is)g(alw)n(a)n(ys)e(the)j(same)e(of)515 2586 y(the)h(no)r(de)h(iden)n
(ti\014er.)47 b(Suc)n(h)31 b(domain)g(will)h(b)r(e)f(used)h(to)f(allo)r
(cate)f(k)n(ernel-wide)g(ph)n(ysical)515 2686 y(resources.)515
2814 y Fk(h)p Fj(Pr)l(o)l(c)l(ess)f(no)l(de)g(sp)l(e)l(ci\014c)f
(options)h(fr)l(om)e Fi(n)p 1754 2814 24 4 v 29 w(opts)p
Fj(.)g Fk(i)p Fq(\021)598 2997 y Fi(set_id\(off_id_t\(n_opts->get_nd)q
(id\(\),)q(1,0\))q(\);)598 3088 y(set_domain\(get_id\(\)\);)598
3180 y(use_serial_console\(n_opts->get)q(_uses)q(eria)q(l\(\)\))q(;)598
3271 y(if)39 b(\(using_serial_console\(\)\))676 3362
y(n_mdep.start_dbserial\(\);)598 3454 y(n_owner="nemo";)598
3545 y(n_name="titanic";)598 3636 y(n_url="http://www.gsyc.inf.uc3)q
(m.es/)q(~nem)q(o/of)q(f";)598 3819 y(#if)h(0)1059 b(//)40
b(XXX)g(fix)g(it.)598 3910 y(n_owner=n_opts->get_owner\(\);)598
4002 y(if)f(\(!n_owner\))676 4093 y(n_owner="whoever";)598
4184 y(n_owner=strdup\(n_owner\);)598 4276 y
(n_url=strdup\(n_opts->get_url\(\))q(\);)598 4367 y(if)g(\(!n_url\))676
4458 y(n_url=strdup\(off_Version::ur)q(l\);)598 4550
y(n_name=strdup\(n_opts->get_name)q(\(\)\);)598 4641
y(if)g(\(!n_name\))676 4732 y(n_name)i(=)e("whereever";)598
4824 y(n_name=strdup\(n_name\);)598 4915 y(#endif)1885
5255 y Fz(173)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
174 175 bop 639 523 a Fz(The)40 b(mac)n(hine)g(dep)r(enden)n(t)h(metho)
r(d)f Fx(n)p 1937 523 27 4 v 31 w(mdep.start)p 2408 523
V 27 w(dbserial)d Fz(will)j(initialize)g(a)515 623 y(debug-purp)r(ose)
17 b(serial)g(console.)33 b(A)19 b(mac)n(hine)f(dep)r(enden)n(t)h(no)r
(de)f(instance)g(named)g Fx(n)p 3187 623 V 31 w(mdep)515
722 y Fz(is)27 b(aggregated)e(in)n(to)j(the)g(no)r(de)f(as)g(w)n(e)g
(ha)n(v)n(e)g(seen.)515 855 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(memb)l(ers)d(of)f Fi(off)p 1616 855 24 4 v 29 w(Node)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 946 y Fi(off_mdepNode)42
b(n_mdep;)550 b(//)40 b(Machine)h(dependent)g(node)515
1121 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1212 y Fi(#include)41 b(<node/mdep/mNode.h>)
200 b(//)40 b(for)g(off_mdepNode)515 1469 y FA(Memory)30
b(managemen)m(t)g(options)515 1623 y Fz(The)35 b Fx(usedmm)d
Fz(option)j(is)f(a)h(switc)n(h)g(for)f Ft(dtlb)h Fz(supp)r(ort.)58
b(Its)35 b(v)-5 b(alue)35 b(can)f(b)r(e)i(insp)r(ected)515
1722 y(with)28 b Fx(get)p 841 1722 27 4 v 30 w(usedmm)p
Fz(.)515 1855 y Fk(h)p Fj(Memory)g(management)h(public)e(metho)l(ds)i
(in)e Fi(off)p 2030 1855 24 4 v 29 w(Options)p Fj(.)i
Fk(i)o Fq(\021)598 1946 y Fi(//)39 b(Activate)i(DMM?)598
2038 y(inline)f(boolean_t)i(usedmm\(void\))g(const)e({return)h
(o_usedmm;})515 2212 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2212 V 29 w(Options)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2303 y Fi(boolean_t)41 b(o_usedmm;)512 b(//)40
b(Should)g(we)g(support)h(dtlbs?)515 2478 y Fk(h)p Fj(O\013)27
b(options)h(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
2569 y Fi(#include)41 b(<klib/mdep/types.h>)161 b(//)40
b(for)g(boolean_t)h(natural_t)g(et)f(al.)639 2710 y Fz(The)28
b(option)f(v)-5 b(alue)28 b(is)f(obtained)g(b)n(y)h Fx(scan)p
2004 2710 27 4 v 30 w(usedmm)p Fz(.)515 2826 y Fk(h)p
Fj(Extr)l(act)h(option)g(settings.)f Fk(i)p Fz(+)p Fq(\021)598
2918 y Fi(//o_usedmm=scan_usedmm\(argc,ar)q(gv\);)46
b(XXX)598 3009 y(o_usedmm=TRUE;)515 3167 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
3167 24 4 v 29 w(Options)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3258 y Fi(//)39 b(Extracts)i(ndid)g(option)f(value.)598
3350 y(static)g(boolean_t)i(scan_usedmm\(int)g(argc,)f(char)f
(*argv[]\);)515 3524 y Fk(h)p Fi(off)p 667 3524 V 29
w(Options::scan)p 1203 3524 V 31 w(usedmm)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 3615 y Fi(//)39 b(Extracts)i(ndid)g(option)f(value.)
598 3707 y(extern)g(boolean_t)i(off_Options::scan_usedmm\(int)j(argc,)c
(char)f(*argv[]\))598 3798 y({)676 3889 y(char)g(*val)g(=)g
(getenv\("usedmm"\);)676 3981 y(\(void\)argc;)i(\(void\)argv;)676
4072 y(return)f(!\(val)f(&&)g(\(*val)g(==)g('N')g(||)f(*val)i(==)e
('n'\)\);)598 4163 y(})1885 5255 y Fz(174)p eop
PStoPSsaved restore
%%Page: (176,177) 89
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
175 176 bop 515 523 a FA(No)s(de)30 b(options)h Fg(C)7
b Fx(++)31 b FA(source)h(\014les)515 676 y Fz(Option)27
b(pro)r(cessing)f(co)r(de)i(is)f(k)n(ept)h(in)f Fx(node/Options.h)22
b Fz(and)28 b Fx(node/Options.C)p Fz(.)515 809 y Fk(h)p
Fj(Options.h*)11 b Fk(i)p Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_OPTIONS_H)598 1083
y(#define)g(__OFF_OPTIONS_H)h(1)598 1266 y Fk(h)p Fj(O\013)27
b(options)h(dep)l(endencies.)i Fk(i)598 1448 y Fi(#ifdef)40
b(__KERNEL__)598 1540 y Fk(h)p Fj(O\013)27 b(options.)h
Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598 1814
y(#endif)g(//)g(__OFF_OPTIONS_H)515 1988 y Fk(h)p Fj(Options.C*)11
b Fk(i)p Fq(\021)598 2079 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2262 y Fi(#include)41 b(<node/Options.h>)278 b(//)40
b(Exported)h(interface.)598 2353 y Fk(h)p Fj(O\013)27
b(options)h(implementation)g(dep)l(endencies.)i Fk(i)598
2536 y(h)p Fi(off)p 750 2536 24 4 v 29 w(Options::scan)p
1286 2536 V 31 w(usedmm)f Fj(implementation.)e Fk(i)598
2627 y(h)p Fi(off)p 750 2627 V 29 w(Options::scan)p 1286
2627 V 31 w(ndid)h Fj(implementation.)g Fk(i)598 2719
y(h)p Fi(off)p 750 2719 V 29 w(Options::scan)p 1286 2719
V 31 w(useserial)h Fj(implementation.)f Fk(i)598 2810
y(h)p Fi(off)p 750 2810 V 29 w(Options::off)p 1247 2810
V 31 w(Options)h Fj(implementation.)e Fk(i)598 2901 y(h)p
Fi(off)p 750 2901 V 29 w(Options::scan)p 1286 2901 V
31 w(owner)h Fj(implementation.)g Fk(i)598 2993 y(h)p
Fi(off)p 750 2993 V 29 w(Options::scan)p 1286 2993 V
31 w(url)g Fj(implementation.)f Fk(i)598 3084 y(h)p Fi(off)p
750 3084 V 29 w(Options::scan)p 1286 3084 V 31 w(name)h
Fj(implementation.)g Fk(i)1885 5255 y Fz(175)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
176 177 bop 515 523 a FA(Complete)29 b(option)i(listing)515
676 y Fz(F)-7 b(or)21 b(eac)n(h)g(option)h(w)n(e)f(state)h(its)g(name)g
(\(the)h(string)e(supplied)h(b)n(y)g(the)g(user)f(to)h(iden)n(tify)h
(the)515 776 y(option)29 b(b)r(eing)g(set\),)i(the)f(v)-5
b(alues)29 b(the)h(option)f(ma)n(y)f(tak)n(e)h(\(Bo)r(olean,)g
(including)h(\\y")e(and)515 876 y(\\n";)j(In)n(teger\),)f(a)g(brief)g
(description,)h(and)f(the)g(default)h(v)-5 b(alue)30
b(when)h(no)f(user-supplied)515 975 y(setting)d(is)h(a)n(v)-5
b(ailable.)35 b(Options)28 b(app)r(ear)e(in)i(alphab)r(etical)f(order.)
515 1140 y FA(Name)40 b Fx(usedmm)515 1299 y FA(V)-8
b(alues)41 b Fz(Bo)r(olean.)515 1458 y FA(Description)g
Fz(When)34 b(set,)i Fy(O\013)17 b Fx(++)34 b Fz(will)g(activ)-5
b(ate)34 b(the)h(supp)r(ort)f(for)g(m)n(ultiple)g(address)722
1557 y(spaces.)40 b(No)29 b(virtual)g(memory)f(facilities)h(will)g(b)r
(e)g(a)n(v)-5 b(ailable)28 b(when)h(this)h(option)e(is)722
1657 y(not)g(set.)515 1816 y FA(Default)42 b Fx(y)p Fz(.)515
1980 y FA(Name)e Fx(ndid)515 2139 y FA(V)-8 b(alues)41
b Fz(In)n(teger.)515 2298 y FA(Description)g Fz(When)19
b(set,)i(its)f(v)-5 b(alue)19 b(will)h(sp)r(ecify)f(the)h
Fx(node)d Fz(\014eld)j(of)f(the)h(no)r(de)f(iden)n(ti\014er)722
2398 y(\(remaining)27 b(\014elds)h(in)g(no)r(de)f(iden)n(ti\014ers)h
(are)e(alw)n(a)n(ys)g(zero\).)515 2557 y FA(Default)42
b Fx(0)p Fz(.)722 2721 y FA(NOTE:)27 b Fz(Add)h(remaining)f(option)g
(descriptions.)515 2951 y Fn(3.5.3)112 b(Starting)37
b(system)g(serv)m(ers)515 3104 y Fz(The)k(hard)g(part)g(of)h(system)f
(b)r(o)r(otstrap)g(is)g(done)g(b)n(y)h(the)f Fx(node)f
Fz(singleton)h(itself,)46 b(in)515 3204 y Fx(srvstart)p
Fz(.)639 3303 y(First,)40 b(w)n(e)d(initialize)g(the)g(memory)g(bank)g
(for)f(the)i(no)r(de)f(core)f(to)h(allo)n(w)f(dynamic)515
3403 y(memory)g(allo)r(cation)h(inside)g(the)h(k)n(ernel)e(and)h(then)h
(w)n(e)f(create)g(the)g(p)r(ortal)g(serv)n(er)f(so)515
3502 y(that)25 b(other)f(serv)n(ers)f(could)i(create)f(their)h(p)r
(ortals.)35 b(After)25 b(doing)g(so,)g(w)n(e)f(start)h(the)g(k)n(ernel)
515 3602 y(virtual)i(memory)g(service)f(and)i(remaining)e(hardw)n(are)g
(serv)n(ers)f(and)j(system)f(serv)n(ers.)515 3728 y Fk(h)p
Fi(off)p 667 3728 24 4 v 29 w(Node::srvstart)j Fj(implementation.)e
Fk(i)o Fq(\021)598 3819 y Fi(//)39 b(Creates)i(an)f(Off)g(Node.)598
3910 y(void)g(off_Node::srvstart\(const)45 b(off_Protection)d(&prot\))
598 4002 y({)676 4093 y(assert\(valid\(\)\);)676 4184
y Fk(h)p Fj(Cr)l(e)l(ate)29 b(memory)f(b)l(anks)h(for)e(no)l(de)i(c)l
(or)l(e)g(pr)l(ote)l(cte)l(d)h(with)e Fi(prot)p Fj(.)f
Fk(i)676 4276 y(h)p Fj(Cr)l(e)l(ate)i(DMM)e(pr)l(ote)l(cte)l(d)k(with)c
Fi(prot)p Fj(.)h Fk(i)676 4367 y(h)p Fj(Cr)l(e)l(ate)h(KVM.)e
Fk(i)676 4458 y(h)p Fj(Start)i(r)l(elo)l(c)l(ation)g(table)f(op)l(er)l
(ation.)h Fk(i)676 4550 y(h)p Fj(Cr)l(e)l(ate)g(the)g(p)l(ortal)f
(server)i(pr)l(ote)l(cte)l(d)g(with)e Fi(prot)p Fj(.)f
Fk(i)676 4641 y(h)p Fj(Cr)l(e)l(ate)i(har)l(dwar)l(e)h(system)e
(servers)i(pr)l(ote)l(cte)l(d)h(with)c Fi(prot)p Fj(.)h
Fk(i)676 4732 y(h)p Fj(Cr)l(e)l(ate)h(abstr)l(act)h(system)f(servers)h
(pr)l(ote)l(cte)l(d)g(with)e Fi(prot)p Fj(.)g Fk(i)676
4824 y(h)p Fj(Start)h(pr)l(o)l(c)l(essors.)h Fk(i)598
4915 y Fi(})1885 5255 y Fz(176)p eop
PStoPSsaved restore
%%Page: (178,179) 90
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
177 178 bop 639 523 a Fz(T)-7 b(o)38 b(kno)n(w)f(ho)n(w)h(man)n(y)g
(memory)f(banks)h(m)n(ust)g(b)r(e)h(created)e(w)n(e)h(use)g(the)g(mac)n
(hine)515 623 y(dep)r(enden)n(t)25 b(no)r(de)f(information,)g
Fx(n)p 1629 623 27 4 v 31 w(mdep)p Fz(,)f(whic)n(h)h(already)f(kno)n
(ws)g(ab)r(out)h(existing)g(hard-)515 722 y(w)n(are.)34
b(The)22 b(mac)n(hine)g(dep)r(enden)n(t)i(metho)r(d)f
Fx(get)p 2058 722 V 30 w(mbank)d Fz(will)j(return)f(information)g(ab)r
(out)515 822 y(ev)n(ery)37 b(memory)g(banks.)67 b(Besides)38
b(w)n(e)g(call)f(to)h Fx(set)p 2227 822 V 30 w(core)f
Fz(to)h(giv)n(e)f(memory)g(banks)g(a)515 922 y(c)n(hance)30
b(to)g(do)h(an)n(y)f(static)g(initialization)h(whic)n(h)f(dep)r(ends)i
(on)e(the)h(memory)f(banks)g(in-)515 1021 y(stalled)d(in)h(the)g
(system.)515 1154 y Fk(h)p Fj(Cr)l(e)l(ate)h(memory)f(b)l(anks)g(for)g
(no)l(de)g(c)l(or)l(e)h(pr)l(ote)l(cte)l(d)i(with)c Fi(prot)p
Fj(.)h Fk(i)p Fq(\021)598 1245 y Fi(off_MBank::set_core\(n_mdep.get)q
(_minf)q(o\(0\))q(\);)598 1337 y(n_nmbanks=n_mdep.get_num_mbank)q
(s\(\);)598 1428 y(\(void\)get_server_id\(\);)83 b(//)40
b(0)f(is)h(for)g(the)g(portal)g(server)598 1519 y
(\(void\)get_server_id\(\);)83 b(//)40 b(1)f(is)h(for)g(me)598
1611 y(for)g(\(natural_t)h(i=0;)f(i<n_nmbanks;)i(i++\){)676
1702 y(n_mbank[i].protect\(prot\);)676 1793 y
(n_mbank[i].start\(n_mdep.get_)q(minfo)q(\(i\),)q(get_)q(serve)q(r_id)q
(\(\)\);)598 1885 y(})639 2117 y Fz(Iden)n(ti\014ers)e(for)g(con)n
(tainers)f(b)r(eing)i(created)f(are)f(obtained)i(with)g
Fx(get)p 2974 2117 V 30 w(server)p 3268 2117 V 29 w(id)515
2217 y Fz(as)29 b(w)n(e)h(will)h(see)f(later.)44 b(Dep)r(ending)31
b(on)f(the)h(exact)e(n)n(um)n(b)r(er)h(of)h(system)f(serv)n(ers,)f(p)r
(ortal)515 2316 y(iden)n(ti\014ers)21 b(for)h(a)f(giv)n(en)g(serv)n(er)
f(ma)n(y)h(di\013er)h(from)g(no)r(de)g(to)g(no)r(de.)35
b(This)21 b(is)h(not)g(a)g(problem)515 2416 y(b)r(ecause)33
b(na)n(vigators)e(and)i(insp)r(ectors)g(can)g(b)r(e)g(used)h(to)f
(obtain)g(their)h(iden)n(ti\014ers)f(in)g(a)515 2516
y(p)r(ortable)27 b(w)n(a)n(y)-7 b(.)639 2615 y(T)g(o)26
b(initialize)h(the)g(k)n(ernel)f(virtual)g(memory)g(serv)n(er)e(w)n(e)j
(tell)g(it)g(whether)f(supp)r(ort)h(for)515 2715 y Ft(dtlb)g
Fz(is)h(included)g(and)f(also)g(the)h(\014rst)f(a)n(v)-5
b(ailable)26 b(address)h(after)g(k)n(ernel)g(memory)-7
b(.)515 2848 y Fk(h)p Fj(Cr)l(e)l(ate)29 b(KVM.)d Fk(i)p
Fq(\021)598 2939 y Fi(kvm.start\(n_mbank[n_nmbanks-1])q(.get_)q(kend)q
(\(\),n)q(_opts)q(->us)q(edmm\()q(\)\);)515 3113 y Fk(h)p
Fj(O\013)h(no)l(de)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 3205 y Fi(#include)41 b(<dmm/KVM.h>)473
b(//)40 b(for)g(kvm)639 3346 y Fz(When)f(the)f Fx(KVM)e
Fz(has)h(b)r(een)h(started,)i(w)n(e)e(can)f(start)g(relo)r(cation)f
(table)i(op)r(eration.)515 3445 y(W)-7 b(e)28 b(simply)f(need)h(a)f
(region)f(of)h(k)n(ernel)g(virtual)g(memory)f(to)i(main)n(tain)f(relo)r
(cation)f(table)515 3545 y(en)n(tries.)515 3661 y Fk(h)p
Fj(Start)j(r)l(elo)l(c)l(ation)g(table)f(op)l(er)l(ation.)h
Fk(i)p Fq(\021)598 3753 y Fi(off_RelocTbl::start\(kvm.create)q(_regi)q
(on\(")q(relo)q(c"\)\);)1885 5255 y Fz(177)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
178 179 bop 639 523 a Fz(W)-7 b(e)26 b(do)e(the)i(same)e(with)i
(remaining)e(hardw)n(are)f(serv)n(ers.)34 b(Pro)r(cessors)22
b(are)i(a)h(little)h(bit)515 623 y(sp)r(ecial.)50 b(They)32
b(m)n(ust)g(w)n(ait)g(un)n(til)g(the)h(sh)n(uttle)f(serv)n(er)f(has)g
(b)r(een)i(started)e(to)h(get)g(their)515 722 y(initial)c(idle)f(sh)n
(uttles.)515 839 y Fk(h)p Fj(Cr)l(e)l(ate)i(har)l(dwar)l(e)g(system)g
(servers)h(pr)l(ote)l(cte)l(d)g(with)e Fi(prot)p Fj(.)g
Fk(i)p Fq(\021)598 930 y Fi(n_niobanks=n_mdep.get_num_ioba)q(nks\(\))q
(;)598 1021 y(for)40 b(\(natural_t)h(i=0;)f(i<n_niobanks;)i(i++\){)676
1112 y(n_iobank[i].protect\(prot\);)676 1204 y
(n_iobank[i].start\(n_mdep.get)q(_ioin)q(fo\(i)q(\),ge)q(t_ser)q(ver_)q
(id\(\)\))q(;)598 1295 y(})598 1478 y(#if)e(0)588 b(//)40
b(XXX)g(fix)g(this)598 1569 y(n_ndmas=n_mdep.get_num_dmas\(\);)598
1660 y(for)g(\(natural_t)h(i=0;)f(i<n_ndmas;)i(i++\){)676
1752 y(n_dma[i].protect\(prot\);)676 1843 y
(n_dma[i].start\(n_mdep.get_dm)q(ainfo)q(\(i\),)q(get_)q(serve)q(r_id)q
(\(\)\);)598 1934 y(})598 2026 y(#endif)639 2150 y Fz(The)25
b(b)r(o)r(ot)f(pro)r(cessor)e(is)i(the)h(last)f(started)f(one)h(so)g(w)
n(e)g(still)g(could)g(use)g(it)h(to)f(initialize)515
2250 y(all)j(secondary)f(pro)r(cessors.)515 2383 y Fk(h)p
Fj(Start)j(pr)l(o)l(c)l(essors.)h Fk(i)p Fq(\021)598
2474 y Fi(n_nprocs=n_mdep.get_num_procs\()q(\);)598 2565
y(for)40 b(\(natural_t)h(i=1;)f(i<n_nprocs;)i(i++\){)676
2657 y(n_proc[i].protect\(prot\);)676 2748 y
(n_proc[i].start\(n_mdep.get_p)q(rocin)q(fo\(i)q(\),ge)q(t_ser)q(ver_)q
(id\(\)\))q(;)598 2839 y(})598 2931 y(n_proc[0].protect\(prot\);)598
3022 y(n_proc[0].start\(n_mdep.get_pro)q(cinfo)q(\(0\),)q(get_)q(serve)
q(r_id)q(\(\)\);)639 3163 y Fz(Starting)27 b(\(abstract\))g(system)h
(serv)n(ers)d(is)j(almost)f(the)h(same.)515 3279 y Fk(h)p
Fj(Cr)l(e)l(ate)h(the)f(p)l(ortal)h(server)g(pr)l(ote)l(cte)l(d)h(with)
e Fi(prot)p Fj(.)g Fk(i)p Fq(\021)598 3371 y Fi
(n_prtl->protect\(prot\);)598 3462 y(n_prtl->start\(n_mdep.get_prtli)q
(nfo\(\))q(,off)q(_id_)q(t\(get)q(_id\()q(\).get)q(_nd\()q(\),0,)q
(0\)\);)515 3620 y Fk(h)p Fj(Cr)l(e)l(ate)h(DMM)e(pr)l(ote)l(cte)l(d)j
(with)e Fi(prot)p Fj(.)g Fk(i)o Fq(\021)598 3711 y Fi
(n_dmm->protect\(prot\);)598 3802 y(if)39 b(\(n_opts->usedmm\(\)\){)676
3894 y(n_dmm->start\(n_mdep.get_dmmi)q(nfo\(\))q(,)45
b(get_server_id\(\)\);)598 3985 y(})515 4159 y Fk(h)p
Fj(Cr)l(e)l(ate)29 b(abstr)l(act)h(system)f(servers)h(pr)l(ote)l(cte)l
(d)g(with)e Fi(prot)p Fj(.)f Fk(i)p Fq(\021)598 4251
y Fi(n_shtl->protect\(prot\);)598 4342 y
(n_shtl->start\(n_mdep.get_shtli)q(nfo\(\))q(,get)q(_ser)q(ver_i)q
(d\(\)\))q(;)639 4483 y Fz(W)-7 b(e)28 b(start)f(the)h
Ft(dmm)g Fz(only)f(when)h Ft(dtlb)f Fz(supp)r(ort)g(is)h(required.)639
4583 y(The)g Fx(srvstart)c Fz(implemen)n(tation)k(is)f(also)g(k)n(ept)g
(in)h Fx(node/Node.C)p Fz(.)515 4699 y Fk(h)p Fj(Implementation)g(of)f
(other)i(metho)l(ds)g(of)e Fi(off)p 1893 4699 24 4 v
29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 4790 y Fk(h)p
Fi(off)p 750 4790 V 29 w(Node::srvstart)i Fj(implementation.)e
Fk(i)1885 5255 y Fz(178)p eop
PStoPSsaved restore
%%Page: (180,181) 91
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
179 180 bop 639 523 a Fz(T)-7 b(o)27 b(assign)g(iden)n(ti\014ers)g(for)
g(system)h(serv)n(ers,)d(w)n(e)i(used)h Fx(get)p 2536
523 27 4 v 30 w(server)p 2830 523 V 29 w(id)p Fz(.)515
639 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 639 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
731 y Fi(//)39 b(Obtain)i(the)f(indentifier)i(for)e(a)f(new)h(system)h
(server.)598 822 y(off_id_t)g(get_server_id\(void\);)639
946 y Fz(Its)25 b(implemen)n(tation)g(uses)g(the)g(sequence)g(n)n(um)n
(b)r(er)g(stored)f(in)h(the)g(no)r(de)g(instance)g(to)515
1046 y(generate)h(iden)n(ti\014ers)h(taking)g(as)g(a)g(template)h(the)g
(no)r(de)g(iden)n(ti\014er.)515 1162 y Fk(h)p Fi(off)p
667 1162 V 29 w(Node::get)p 1047 1162 V 30 w(server)p
1311 1162 V 29 w(id)g Fj(implementation.)g Fk(i)p Fq(\021)598
1254 y Fi(//)39 b(Obtain)i(the)f(indentifier)i(for)e(a)f(new)h(system)h
(server.)598 1345 y(off_id_t)g(off_Node::get_server_id\(void\))598
1436 y({)676 1528 y(//off_id_t)h(id)d(=)h(get_id\(\);)676
1619 y(//assert\(valid\(\)\);)676 1710 y(//id.i_offset)160
b(=)40 b(get_seq\(\);)676 1802 y(assert\(valid\(\)\);)676
1893 y(return)h(off_id_t\(get_id\(\).get_nd\(\),get)q(_seq)q(\(\),0\))q
(;)598 1984 y(})515 2142 y Fk(h)p Fj(Implementation)28
b(of)f(other)i(metho)l(ds)g(of)e Fi(off)p 1893 2142 V
29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 2233 y Fk(h)p
Fi(off)p 750 2233 V 29 w(Node::get)p 1130 2233 V 30 w(server)p
1394 2233 V 29 w(id)g Fj(implementation.)g Fk(i)1885
5255 y Fz(179)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
180 181 bop 639 523 a Fz(W)-7 b(e)32 b(set)f(the)h Fx(slot)e
Fz(\014eld)i(with)f(the)h(same)f(v)-5 b(alue)31 b(of)g(the)h
Fx(seq)e Fz(\014eld)i(b)r(ecause)f(p)r(ortals)515 623
y(will)23 b(b)r(e)h(created)e(\(to)i(exp)r(ort)f(system)g(serv)n(ers)e
(services\))h(to)h(matc)n(h)g(this)h(iden)n(ti\014ers.)35
b(The)515 722 y(p)r(ortal)f(serv)n(er)e(will)j(assign)e(slots)h(in)h
(its)f(in)n(ternal)g(allo)r(cator)f(matc)n(hing)h(the)g
Fx(seq)g Fz(\014eld.)515 822 y(Therefore,)26 b(w)n(e)h(a)n(v)n(oid)f
(fak)n(e)h(relo)r(cations)g(b)n(y)g(initializing)g(the)h
Fx(slot)e Fz(\014eld.)639 922 y(Note)31 b(also)f(ho)n(w)h(lo)r(c)n
(king)f(is)h(missing.)47 b(When)31 b(this)h(metho)r(d)f(is)g(used)g
(the)h(no)r(de)f(will)515 1021 y(b)r(e)d(b)r(o)r(oting)f(and)h(it)g
(will)f(b)r(e)h(no)g(longer)e(used)i(b)r(efore)f(an)n(y)g(sh)n(uttle)h
(is)f(ev)n(er)g(created.)515 1254 y Fn(3.5.4)112 b(OS)38
b(mo)s(dules)f(startup)515 1407 y Fz(The)18 b(ob)5 b(ject)18
b(resp)r(onsible)g(for)g(bringing)f(OS)h(mo)r(dules)h(in)n(to)f(op)r
(eration)f(is)h(named)h Fx(ModLoader)p Fz(.)515 1506
y Fx(Node::modstart)24 b Fz(will)30 b(simply)g(call)g(a)f(mac)n(hine)g
(dep)r(enden)n(t)i Fx(load)p 2720 1506 27 4 v 30 w(mods)d
Fz(whic)n(h)i(scans)515 1606 y(through)k(the)i(list)g(of)f(mo)r(dules)g
(found)h(at)f(the)h(b)r(o)r(ot)f(time)h(\(using)f Fx(ModLoader::load)
515 1706 y Fz(to)g(load)g(them)g(in)h(turn\).)61 b(Finally)-7
b(,)37 b Fx(ModLoader::start)29 b Fz(will)35 b(start)g(the)h(just)g
(loaded)515 1805 y(mo)r(dules.)44 b(If)31 b(no)e(mo)r(dule)i(could)f(b)
r(e)g(loaded)g(w)n(e)f(will)i(panic)f(\(there)g(will)g(b)r(e)h(no)e
(system)515 1905 y(to)e(run\).)515 2038 y Fk(h)p Fi(off)p
667 2038 24 4 v 29 w(Node::modstart)j Fj(implementation.)e
Fk(i)o Fq(\021)598 2129 y Fi(//Start)41 b(OS)e(modules.)598
2220 y(void)h(off_Node::modstart\(void\))598 2312 y({)676
2403 y(static)h(off_ModLoader)h(loader;)676 2494 y
(assert\(valid\(\)\);)676 2677 y(knd.start\(&nd,off_kNode::han)q
(dler\))q(;)676 2768 y(for)e(\(natural_t)i(i=0;)e(i)f(<)h
(get_num_mbanks\(\);)j(i++\))755 2860 y
(kmbanks[i].start\(&get_mbank\(i\),)q(kmha)q(ndle)q(rs[i])q(\);)676
2951 y(if)d(\(off_DMM::is_active\(\)\))755 3042 y
(kdmm.start\(&dmm,off_kDMM::handl)q(er\);)676 3134 y
(kprtl.start\(&prtl,off_kPrtlS)q(rv::h)q(andl)q(er\);)676
3225 y(kiobank.start\(&n_iobank[0],o)q(ff_kI)q(OBan)q(k::h)q(andle)q
(r\);)676 3316 y(kshtl.start\(&shtl,off_kShtlS)q(rv::h)q(andl)q(er\);)
676 3408 y(kproc.start\(&nd.get_proc\(0\),)q(off_k)q(Proc)q(esso)q
(r::ha)q(ndle)q(r\);)676 3499 y(n_mdep.load_mods\(loader\);)676
3590 y(loader.exec_mods\(\);)676 3682 y(loader.start\(off_Processor::)q
(self\()q(\)\);)46 b(//Run)40 b(any)g(OS)g(modules)g(at)g(boot)g
(processor.)676 3773 y(panic\("ModLoader::start)45 b(returned."\);)598
3864 y(})515 4130 y Fk(h)p Fj(O\013)27 b(no)l(de)h(implementation)g
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4221 y
Fi(#include)41 b(<hw/kMBank.h>)598 4313 y(#include)g(<hw/kProcessor.h>)
598 4404 y(#include)g(<shtl/kShtlSrv.h>)598 4495 y(#include)g
(<prtl/kPrtlSrv.h>)598 4587 y(#include)g(<dmm/kDMM.h>)598
4678 y(#include)g(<hw/kIOBank.h>)1885 5255 y Fz(180)p
eop
PStoPSsaved restore
%%Page: (182,183) 92
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
181 182 bop 639 523 a Fz(It)25 b(is)e(mostly)h(a)g(mac)n(hine)f(dep)r
(enden)n(t)i(op)r(eration)e(b)r(ecause)g(the)h(mo)r(dule)h(information)
515 623 y(is)i(stored)g(in)h(a)f(mac)n(hine)g(dep)r(enden)n(t)h(w)n(a)n
(y)-7 b(.)515 739 y Fk(h)p Fj(O\013)27 b(no)l(de)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 830 y Fi(#include)41 b(<klib/mdep/debug.h>)
161 b(//)40 b(for)g(panic\(\))598 922 y(#include)h(<node/mod.h>)434
b(//)40 b(for)g(off_ModLoader)639 1046 y Fz(The)28 b
Fx(modstart)c Fz(implemen)n(tation)k(is)f(also)g(k)n(ept)g(in)h
Fx(node/Node.C)p Fz(.)515 1162 y Fk(h)p Fj(Implementation)g(of)f(other)
i(metho)l(ds)g(of)e Fi(off)p 1893 1162 24 4 v 29 w(Node)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1254 y Fk(h)p Fi(off)p
750 1254 V 29 w(Node::modstart)i Fj(implementation.)e
Fk(i)515 1494 y FA(The)k(mo)s(dule)d(loader)515 1648
y Fz(The)c Fx(ModLoader)c Fz(ob)5 b(ject)24 b(pro)n(vides)g(some)g
(metho)r(ds)h(needed)g(b)n(y)g Fx(modstart)p Fz(.)32
b(Namely)-7 b(,)26 b(it)515 1747 y(kno)n(ws)g(ho)n(w)h(to)h(load)f(an)g
(OS)g(mo)r(dule)h(and)g(ho)n(w)f(to)g(start)g(an)g(OS)h(mo)r(dule.)515
1880 y Fk(h)p Fj(O\013)f(mo)l(dule)h(lo)l(ader.)g Fk(i)o
Fq(\021)598 1971 y Fi(//)39 b(An)h(OS)g(module)g(loader.)598
2063 y(//)598 2154 y(class)g(off_ModLoader)i({)598 2245
y(protected:)676 2337 y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(memb)
l(ers)f(of)e Fi(off)p 1778 2337 V 29 w(ModLoader)p Fj(.)i
Fk(i)598 2428 y Fi(public:)676 2519 y(off_ModLoader\(\);)676
2611 y(//)40 b(Loads)g(the)g(module)h(m.)676 2702 y(err_t)g
(load\(off_mdepModule)i(&m\);)676 2793 y(//)d(Converts)h(loaded)g
(modules)f(into)g(runnable)i(images.)676 2885 y(err_t)f
(exec_mods\(void\);)676 2976 y(//)f(Arranges)h(for)f(the)g(modules)h
(to)e(start)i(running)f(at)g(proc.)676 3067 y(void)g
(start\(off_Processor)k(*proc\);)598 3159 y(};)515 3424
y Fk(h)p Fj(O\013)27 b(mo)l(dule)h(lo)l(ader)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3516 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(off_id_t)h(et)e(al.)598 3607 y(#include)i(<klib/err.h>)
434 b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)598
3698 y(#include)h(<node/mdep/mmod.h>)200 b(//)40 b(for)g
(off_mdepModule)i(et)e(al.)598 3790 y(#include)h(<hw/Processor.h>)278
b(//)40 b(for)g(off_Processor.)1885 5255 y Fz(181)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
182 183 bop 639 523 a Fz(The)33 b Fx(ModLoader)c Fz(starts)j(with)i(an)
e(empt)n(y)h(list)g(of)g(loaded)f(mo)r(dules.)52 b(Eac)n(h)32
b(call)g(to)515 623 y Fx(load)g Fz(will)i(load)f(a)h(giv)n(en)f(mo)r
(dule)h(in)n(to)g(memory)f(and)h(create)f(a)g(p)r(ortal,)i(a)f
Ft(dtlb)f Fz(and)515 722 y(a)g(sh)n(uttle)h(for)f(that)h(mo)r(dule)g
(to)f(run.)55 b(Finally)-7 b(,)36 b(when)d Fx(start)f
Fz(is)i(called,)g(a)g(run)f(queue)515 822 y(will)28 b(b)r(e)g
(installed)g(in)h(the)f(b)r(o)r(ot)g(pro)r(cessor)e(so)h(that)i(ev)n
(ery)d(sh)n(uttle)j(created)e(could)h(start)515 922 y(running.)639
1021 y(The)19 b(information)e(k)n(ept)i(for)f(eac)n(h)f(mo)r(dule)i(b)r
(eing)f(loaded)g(is)g(de\014ned)h(b)n(y)f Fx(off)p 3058
1021 27 4 v 30 w(module)p 3352 1021 V 29 w(t)p Fz(.)515
1137 y Fk(h)p Fj(O\013)27 b(mo)l(dule)h(data)g(typ)l(e.)g
Fk(i)p Fq(\021)598 1229 y Fi(//)39 b(Information)j(kept)e(for)g(each)g
(OS)g(module.)598 1320 y(//)598 1411 y(struct)g(off_module_t)i({)676
1503 y(off_mdepModule)h(m_mdep;)676 1594 y(boolean_t)238
b(m_ready;)676 1685 y(off_prtl_id_t)42 b(*m_p;)676 1777
y(off_shtl_id_t)g(*m_s;)676 1868 y(off_dtlb_id_t)g(*m_d;)676
1959 y(off_prtl_id_t)g(*m_n;)676 2051 y(off_Rights)159
b(*m_caps;)676 2142 y(off_Rights)g(**m_capp;)676 2233
y(char)393 b(*m_args;)676 2325 y(char)g(**m_argp;)676
2416 y(off_shtl_id_t)42 b(m_shtl;)676 2507 y(off_Shtl)198
b(*m_shtlp;)676 2599 y(off_prtl_id_t)42 b(m_prtl;)676
2690 y(off_Prtl)198 b(*m_prtlp;)676 2781 y(off_dtlb_id_t)42
b(m_dtlb;)676 2873 y(off_DTLB)198 b(*m_dtlbp;)598 2964
y(};)515 3213 y Fk(h)p Fj(O\013)27 b(mo)l(dule)h(lo)l(ader)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3304 y Fi(#include)41
b(<dmm/DTLB.h>)598 3396 y(#include)g(<shtl/Shtl.h>)598
3487 y(#include)g(<prtl/Prtl.h>)639 3628 y Fz(The)35
b Fx(ModLoader)c Fz(k)n(eeps)j(a)g(list)h(of)g(mo)r(dules)g(to)f(b)r(e)
i(\014lled)f(up)g(during)f(the)h(loading)515 3728 y(pro)r(cess.)515
3844 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 3844 24 4 v 29 w(ModLoader)p Fj(.)i Fk(i)p
Fq(\021)598 3935 y Fi(off_module_t)42 b(mods[OFF_NMODS_MAX];)598
4027 y(int)275 b(nmods;)639 4151 y Fz(The)28 b(maxim)n(um)f(n)n(um)n(b)
r(er)h(of)f(mo)r(dules)h Fx(OFF)p 2057 4151 27 4 v 30
w(NMODS)p 2307 4151 V 29 w(MAX)f Fz(is)g(a)g(system)h(limit.)515
4267 y Fk(h)p Fj(O\013)f(limits.)f Fk(i)p Fz(+)p Fq(\021)598
4359 y Fi(const)40 b(int)g(OFF_NMODS_MAX)i(=)e(8;)157
b(//)40 b(Max.)g(number)g(of)g(OS)g(modules.)1885 5255
y Fz(182)p eop
PStoPSsaved restore
%%Page: (184,185) 93
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
183 184 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ModLoader::ModLoader)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Initializes)j(the)e(module)h
(loader.)598 706 y(off_ModLoader::off_ModLoader)k(\(void\):)676
797 y(nmods\(0\))598 888 y({)676 980 y(do_debug\(putchar\('m'\)\);)598
1071 y(})639 1303 y Fz(The)22 b(task)f(of)h Fx(load)e
Fz(is)i(to)f(setup)h(an)g(image)f(for)g(eac)n(h)g(mo)r(dule)h(and)g(to)
f(create)g(a)h(p)r(ortal,)515 1403 y(a)27 b Ft(dtlb)g
Fz(and)h(a)f(sh)n(uttle)h(for)f(that)h(mo)r(dule.)515
1536 y Fk(h)p Fi(off)p 667 1536 V 29 w(ModLoader::load)i
Fj(implementation.)e Fk(i)p Fq(\021)598 1627 y Fi(//)39
b(Loads)i(module)f(m.)598 1719 y(//)f(returns)i(error)g(code)f(or)f
(zero)i(if)e(no)h(error.)598 1810 y(err_t)g
(off_ModLoader::load\(off_mdepM)q(odul)q(e)45 b(&m\))598
1901 y({)676 1993 y(off_module_t)d(*mod)e(=)g(mods+nmods;)120
b(//)40 b(module)g(being)h(loaded)676 2084 y(off_mdepStck)h(sp;)550
b(//)40 b(user)g(stack)g(as)g(seen)g(by)g(the)g(user)676
2175 y(off_mdepStck)i(ksp;)511 b(//)40 b(user)g(stack)g(as)g(seen)g(by)
g(the)g(kernel)676 2358 y(mod->m_mdep=m;)676 2449 y
(mod->m_ready=FALSE;)676 2540 y Fk(h)p Fj(Cr)l(e)l(ate)29
b(p)l(ortal)g(for)e Fi(mod)h Fj(or)g(r)l(eturn)i(err)l(or.)e
Fk(i)676 2632 y(h)p Fj(Cr)l(e)l(ate)h(dtlb)f(for)g Fi(mod)g
Fj(if)e(dtlb)i(supp)l(ort)i(is)d(activate)l(d)j(or)e(r)l(eturn)h(err)l
(or.)f Fk(i)676 2723 y(h)p Fj(A)n(l)t(lo)l(c)l(ate)g(stack)h
Fi(sp/ksp)g Fj(for)f Fi(mod)g Fj(or)g(r)l(eturn)h(err)l(or.)g
Fk(i)676 2814 y(h)p Fj(Cr)l(e)l(ate)g(shuttle)g(for)f
Fi(mod)g Fj(using)g Fi(m)f Fj(or)h(r)l(eturn)i(err)l(or.)e
Fk(i)676 2906 y(h)p Fj(Setup)h(ar)l(guments)g(for)f(the)g(user)h(entry)
g(p)l(oint)f(in)f Fi(sp/ksp)p Fj(.)h Fk(i)676 2997 y
Fi(mod->m_ready=TRUE;)676 3180 y(do_debug\(printf\("mod)44
b(\045s)c(ready\\n",m.argl\(\)\)\);)676 3362 y(nmods++;)676
3454 y(return)h(EOK;)598 3545 y(})639 3778 y Fz(T)-7
b(o)35 b(create)f(a)g(p)r(ortal)g(w)n(e)h(set)f(a)h(n)n(ull)g(en)n(try)
f(p)r(oin)n(t)h(as)f(the)h(handler.)58 b(It)35 b(should)g(b)r(e)515
3877 y(reset)28 b(b)n(y)g(the)h(mo)r(dule)g(later)f(on.)39
b(This)29 b(p)r(ortal)f(will)h(b)r(e)g(used)f(as)g(the)h(domain)f(iden)
n(ti\014er)515 3977 y(for)f(OS)g(b)r(o)r(ot)h(mo)r(dules.)515
4093 y Fk(h)p Fj(Cr)l(e)l(ate)h(p)l(ortal)f(for)g Fi(mod)g
Fj(or)g(r)l(eturn)h(err)l(or.)g Fk(i)p Fq(\021)598 4184
y Fi(mod->m_prtlp=)42 b(new)e(off_Prtl\(nd.get_protection\(\),n)q(d.ge)
q(t_dom)q(ain\()q(\),)1657 4276 y(0,0,OFF_ID_NULL\);)598
4367 y(mod->m_prtl=mod->m_prtlp->get_)q(id\(\);)1885
5255 y Fz(183)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
184 185 bop 639 523 a Fz(T)-7 b(o)27 b(create)g(a)g Ft(dtlb)h
Fz(w)n(e)f(simply)h(call)f(the)h Ft(dmm)p Fz(.)515 656
y Fk(h)p Fj(Cr)l(e)l(ate)h(dtlb)f(for)f Fi(mod)h Fj(if)f(dtlb)h(supp)l
(ort)h(is)f(activate)l(d)h(or)f(r)l(eturn)h(err)l(or.)g
Fk(i)p Fq(\021)598 747 y Fi(if)39 b(\(off_DMM::is_active\(\)\){)676
839 y(mod->m_dtlbp=)j(new)e(off_DTLB\(nd.get_protection\(\))q(,mod)q
(->m_p)q(rtl\))q(;)676 930 y(if)g(\(!mod->m_dtlbp\))755
1021 y(return)g(ENOSPC;)676 1112 y(mod->m_dtlb=mod->m_dtlbp->ge)q
(t_id\()q(\);)598 1204 y(})598 1295 y(else{)589 b(//)40
b(!dmm)676 1386 y(mod->m_dtlbp=NULL;)676 1478 y
(mod->m_dtlb=OFF_DTLB_NULL;)598 1569 y(})1885 5255 y
Fz(184)p eop
PStoPSsaved restore
%%Page: (186,187) 94
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
185 186 bop 639 523 a Fz(T)-7 b(o)27 b(create)f(a)h(sh)n(uttle)g(w)n(e)
g(need)g(to)g(sp)r(ecify)h(b)r(oth)f(the)h(initial)f(program)e(coun)n
(ter)h(and)515 623 y(the)38 b(initial)g(stac)n(k)e(p)r(oin)n(ter.)67
b(Also,)40 b(w)n(e)d(ha)n(v)n(e)f(to)i(pro)n(vide)e(initial)i(argumen)n
(ts)f(for)g(the)515 722 y(sh)n(uttle)28 b(en)n(try)f(p)r(oin)n(t.)37
b(Those)27 b(argumen)n(ts)f(are:)639 855 y Fq(\017)41
b Fz(The)24 b(iden)n(ti\014er)f(of)h(the)g(p)r(ortal)f(created)f(to)i
(serv)n(e)e(as)h(the)h(exception)f(p)r(ortal)g(for)g(the)722
955 y Ft(dtlb)28 b Fz(b)r(eing)f(used)h(\(or)f Fx(PRTL)p
1670 955 27 4 v 30 w(NULL)f Fz(if)34 b Ft(dtlb)28 b Fz(supp)r(ort)f(is)
g(not)h(enabled\).)639 1104 y Fq(\017)41 b Fz(The)28
b(iden)n(ti\014er)f(of)h(the)g(sh)n(uttle)g(b)r(eing)g(used.)639
1254 y Fq(\017)41 b Fz(The)28 b(iden)n(ti\014er)f(of)h(the)g
Ft(dtlb)f Fz(b)r(eing)h(used)g(or)e Fx(DTLB)p 2394 1254
V 30 w(NULL)g Fz(if)35 b Ft(dmm)27 b Fz(is)h(not)f(activ)n(e.)639
1403 y Fq(\017)41 b Fz(The)28 b Fx(Rights)e Fz(ob)5 b(ject)28
b(used)g(to)g(gain)f(access)g(righ)n(ts)g(for)g(\(already\))g
(protected)h(sys-)722 1503 y(tem)g(resources.)639 1652
y Fq(\017)41 b Fz(The)31 b(argumen)n(t)f(list)h(pro)n(vided)f(b)n(y)h
(the)h(secondary)d(b)r(o)r(ot)i(loader)f(to)g(the)i(mo)r(dule)722
1752 y(executed)c(b)n(y)f(this)h(sh)n(uttle.)639 1885
y(T)-7 b(o)32 b(obtain)g(the)h(initial)f(stac)n(k)g(p)r(oin)n(ter)g(v)
-5 b(alue)32 b(w)n(e)g(create)f(an)h Fx(mdepStck)d Fz(ob)5
b(ject.)51 b(If)515 1984 y Ft(dmm)30 b Fz(is)g(activ)n(e)g(w)n(e)g
(place)g(it)h(at)f Fx(MDEP)p 1761 1984 V 30 w(USRSTK)p
Fz(,)e(otherwise)h(w)n(e)h(use)h(a)f(k)n(ernel)f(stac)n(k)h(for)515
2084 y(the)e(user)f(to)r(o.)515 2200 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ate)h
(stack)h Fi(sp/ksp)g Fj(for)e Fi(mod)h Fj(or)g(r)l(eturn)i(err)l(or.)e
Fk(i)p Fq(\021)598 2291 y Fi(if)39 b(\(off_DMM::is_active\(\)\){)241
b(//)40 b(Map)g(user)g(stack)g(at)g(USRSTK)676 2383 y(vm_offset_t)i
(pg;)676 2474 y(sp=OFF_MDEP_USRSTK;)676 2565 y
(pg=kvm.raw_pg_alloc\(\);)676 2657 y(if)e(\(!pg\))755
2748 y(return)g(ENOMEM;)676 2839 y(assert\(mod->m_dtlbp\);)676
2931 y(mod->m_dtlbp->map\(off_MBank:)q(:ptru)q(nc\(s)q(p\),p)q(g,off)q
(_MBa)q(nk::g)q(et_p)q(gsiz)q(e\(\),)1382 3022 y
(OFF_MOD_RW|OFF_MOD_U\);)676 3113 y(ksp=mod->m_dtlbp->uv2kv\(\(vm_)q
(offse)q(t_t\))q(sp\);)598 3205 y(})598 3296 y(else)g({)1020
b(//)40 b(Allocate)h(a)e(phys)h(mem)g(stack)676 3387
y(off_GrowingRegion)j(*r=kvm.create_kstack\("ustk"\))q(;)676
3479 y(if)d(\(!r\))755 3570 y(return)g(ENOMEM;)676 3661
y(assert\(r\);)676 3753 y(ksp=sp=r->get_start\(\);)598
3844 y(})639 4060 y Fz(Then)34 b(use)g(reserv)n(e)d(space)i(to)h(store)
e(argumen)n(ts)h(for)g(the)h(user)f(en)n(try)g(p)r(oin)n(t)h(in)g(the)
515 4159 y(user)27 b(stac)n(k.)515 4276 y Fk(h)p Fj(A)n(l)t(lo)l(c)l
(ate)h(stack)h Fi(sp/ksp)g Fj(for)e Fi(mod)h Fj(or)g(r)l(eturn)i(err)l
(or.)e Fk(i)p Fz(+)p Fq(\021)598 4367 y Fi
(mod->m_caps=\(off_Rights*\)sp.al)q(loca\()q(size)q(of\(o)q(ff_Ri)q
(ghts)q(\)*OFF)q(_NOP)q(S\);)598 4458 y(mod->m_args)41
b(=\(char*\)sp.alloca\(strlen\(m.)q(argl)q(\(\)\)+1)q(\);)k(//)40
b(+1)g(for)g(the)g('\\0')598 4550 y(mod->m_p)h(=)e
(\(off_prtl_id_t*\)sp.alloca\(si)q(zeof)q(\(off_)q(prtl)q(_id_t)q
(\)\);)598 4641 y(mod->m_s)i(=)e(\(off_shtl_id_t*\)sp.alloca\(si)q
(zeof)q(\(off_)q(shtl)q(_id_t)q(\)\);)598 4732 y(mod->m_d)i(=)e
(\(off_dtlb_id_t*\)sp.alloca\(si)q(zeof)q(\(off_)q(dtlb)q(_id_t)q
(\)\);)598 4824 y(mod->m_n)i(=)e(\(off_prtl_id_t*\)sp.alloca\(si)q
(zeof)q(\(off_)q(prtl)q(_id_t)q(\)\);)598 4915 y(mod->m_capp)i(=)f
(\(off_Rights**\)sp.alloca\(sizeo)q(f\(off)q(_Rig)q(hts*\))q(\);)598
5006 y(mod->m_argp)h(=)f(\(char**\)sp.alloca\(sizeof\(char)q(*\)\);)
1885 5255 y Fz(185)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
186 187 bop 515 523 a Fk(h)p Fj(Setup)28 b(ar)l(guments)i(for)d(the)i
(user)f(entry)h(p)l(oint)f(in)f Fi(sp/ksp)p Fj(.)i Fk(i)p
Fq(\021)598 614 y Fi(if)39 b(\(off_DMM::is_active\(\)\))45
b({)598 706 y(*\(off_prtl_id_t*\)\(mod->m_dtlbp)q(->uv2)q(kv\(\()q
(vm_o)q(ffset)q(_t\)m)q(od->m)q(_p\)\))h(=)39 b(mod->m_prtl;)598
797 y(*\(off_prtl_id_t*\)\(mod->m_dtlbp)q(->uv2)q(kv\(\()q(vm_o)q
(ffset)q(_t\)m)q(od->m)q(_s\)\))46 b(=)39 b(mod->m_shtl;)598
888 y(*\(off_prtl_id_t*\)\(mod->m_dtlbp)q(->uv2)q(kv\(\()q(vm_o)q
(ffset)q(_t\)m)q(od->m)q(_d\)\))46 b(=)39 b(mod->m_dtlb;)598
980 y(*\(off_prtl_id_t*\)\(mod->m_dtlbp)q(->uv2)q(kv\(\()q(vm_o)q
(ffset)q(_t\)m)q(od->m)q(_n\)\))46 b(=)39 b(nd.get_id\(\);)598
1071 y(for)h(\(int)g(mode=OFF_NOPS-1,i=0;)k(mode>=0;)d(i++,mode--\))676
1162 y(nd.get_protection\(\).mk_right)q(s\()1147 1254
y(\(off_Rights*\)\(mod->m_dtlbp->u)q(v2kv\()q(\(vm_)q(offse)q(t_t\))
2481 1345 y(\(mod->m_caps+i\)\)\),)1147 1436 y(mode\);)598
1528 y(strcpy\(\(char*\)\(mod->m_dtlbp->u)q(v2kv\()q(\(vm_)q(offs)q
(et_t\))q(mod-)q(>m_ar)q(gs\)\))q(,m.a)q(rgl\(\))q(\);)676
1619 y(*\(off_Rights**\)\(mod->m_dtlbp)q(->uv2)q(kv\(\()q(vm_o)q(ffset)
q(_t\)m)q(od->m)q(_cap)q(p\)\)=)755 1710 y(mod->m_caps;)676
1802 y(*\(char**\)\(mod->m_dtlbp->uv2k)q(v\(\(vm)q(_off)q(set_)q
(t\)mod)q(->m_)q(argp\))q(\)=)755 1893 y(mod->m_args;)598
1984 y(})598 2076 y(else)f({)676 2167 y(*mod->m_p)h(=)f(mod->m_prtl;)
676 2258 y(*mod->m_s)h(=)f(mod->m_shtl;)676 2350 y(*mod->m_d)h(=)f
(mod->m_dtlb;)676 2441 y(for)g(\(int)g(mode=OFF_NOPS-1,i=0;)k(mode>=0;)
d(i++,mode--\))755 2532 y(nd.get_protection\(\).mk_rights\(m)q(od->)q
(m_ca)q(ps+i,)q(mode)q(\);)676 2623 y(strcpy\(mod->m_args,m.argl\(\)\))
q(;)676 2715 y(*mod->m_capp=mod->m_caps;)676 2806 y
(*mod->m_argp=mod->m_args;)598 2897 y(})515 3072 y Fk(h)p
Fj(O\013)27 b(mo)l(dule)h(lo)l(ader)g(implementation)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 3163 y Fi(#include)41
b(<dmm/DMM.h>)598 3254 y(#include)g(<node/Node.h>)598
3346 y(#include)g(<dmm/KVM.h>)598 3437 y(#include)g(<hw/MBank.h>)598
3528 y(#include)g(<klib/prot.h>)395 b(//)40 b(for)g(off_Rights)598
3620 y(#include)h(<klib/mdep/mStck.h>)161 b(//)40 b(for)g(off_Stck)1885
5255 y Fz(186)p eop
PStoPSsaved restore
%%Page: (188,189) 95
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
187 188 bop 639 523 a Fz(The)28 b(metho)r(d)g Fx(m.argl)d
Fz(has)i(b)r(een)h(used)g(to)f(obtain)h(the)g(mo)r(dule)g(argumen)n(t)e
(list.)515 656 y Fk(h)p Fj(Cr)l(e)l(ate)j(shuttle)g(for)e
Fi(mod)h Fj(using)g Fi(m)g Fj(or)g(r)l(eturn)h(err)l(or.)g
Fk(i)p Fq(\021)598 747 y Fi({)676 839 y(off_GrowingRegion)43
b(*kstck=kvm.create_kstack\("mo)q(dk"\))q(;)676 930 y(if)d(\(!kstck\))h
(return)g(ENOMEM;)676 1021 y(mod->m_shtlp=new)i
(off_Shtl\(nd.get_protection\(\),)q(mod-)q(>m_pr)q(tl,)1696
1112 y(\(register_t\)OFF_UENTRY,)i(sp,)39 b(kstck->get_start\(\),)1696
1204 y(off_Shtl::self\(\)\);)676 1295 y(if)h(\(!mod->m_shtlp\))755
1386 y(return)g(ENOSPC;)676 1478 y(mod->m_shtl=mod->m_shtlp->ge)q
(t_id\()q(\);)676 1569 y(if)g(\(mod->m_dtlbp\))755 1660
y(mod->m_shtlp->set_dtlb\(mod->m_d)q(tlb\))q(;)598 1843
y(})639 1984 y Fz(where)515 2100 y Fk(h)p Fj(O\013)27
b(limits.)f Fk(i)p Fz(+)p Fq(\021)598 2192 y Fi(const)40
b(unsigned)h(int)f(OFF_UENTRY=OFF_MDEP_USROFF;)45 b(//)40
b(entry)g(point)h(for)f(OS)f(modules)639 2316 y Fz(Once)27
b(ev)n(erything)g(has)g(b)r(een)h(setup,)g(w)n(e)f(load)g(the)h(mo)r
(dule)f(image)g(in)n(to)h(its)f(address)515 2416 y(space.)36
b(Suc)n(h)27 b(task)f(is)h(p)r(erformed)g(b)n(y)f(a)h(mac)n(hine)f(dep)
r(enden)n(t)i(loader)e(when)h Fx(exec)p 3180 2416 27
4 v 30 w(mods)515 2516 y Fz(is)g(called.)515 2648 y Fk(h)p
Fi(off)p 667 2648 24 4 v 29 w(ModLoader::exec)p 1281
2648 V 31 w(mods)i Fj(implementation.)e Fk(i)p Fq(\021)598
2740 y Fi(//)39 b(Converts)i(loaded)g(modules)g(into)f(runnable)h
(images.)598 2831 y(err_t)f(off_ModLoader::exec_mods\(void)q(\))598
2922 y({)676 3014 y(err_t)h(err=EOK;)676 3105 y(for)f(\(int)g(i=0;)g
(!err)h(&&)e(i<nmods;)i(i++\))755 3196 y(if)e(\(mods[i].m_ready\))833
3288 y(err)h(=)f(\(err\)?err:mods[i].m_mdep.se)q(t_im)q(age\(m)q(ods[)q
(i].m_)q(dtlb)q(p\);)676 3379 y(return)80 b(err;)598
3470 y(})1885 5255 y Fz(187)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
188 189 bop 639 523 a Fz(Finally)-7 b(,)29 b Fx(start)e
Fz(will)i(giv)n(e)f(the)h(sh)n(uttles)g(of)g(the)g(mo)r(dules)g(a)f(c)n
(hance)g(to)h(run.)40 b(T)-7 b(o)28 b(do)515 623 y(so,)f(it)h(installs)
f(the)h(run)f(queue)h(in)g(the)g(sp)r(eci\014ed)g(pro)r(cessor.)515
739 y Fk(h)p Fi(off)p 667 739 24 4 v 29 w(ModLoader::start)j
Fj(implementation.)c Fk(i)p Fq(\021)598 830 y Fi(//)39
b(Arranges)i(for)f(the)g(modules)h(to)f(start)g(running)h(at)f(proc.)
598 922 y(void)g(off_ModLoader::start\(off_Proce)q(ssor)46
b(*proc\))598 1013 y({)676 1104 y(int)40 b(i;)676 1196
y(\(void\)proc;)676 1287 y(assert\(proc)i(&&)e(proc->valid\(\)\);)676
1378 y(for)g(\(i=0;)g(i<nmods;)i(i++\))755 1469 y(if)d
(\(mods[i].m_ready\))833 1561 y(new\(off_Processor::self\(\)\))45
b(off_RunqSlot\(nd.get_protecti)q(on\(\))q(,)1618 1652
y(mods[i].m_prtl,)1618 1743 y(mods[i].m_shtl\);)676 1835
y(kcout)c(<<)e(fmt\("\045d",nmods\))k(<<)d(")f(modules)i(installed.")h
(<<)d(nl;)676 1926 y(for\(i=0;i<20;i++\){)755 2017 y
(off_Processor::self\(\)->new_quan)q(tum\()q(\);)755
2109 y(do_debug\(putchar\(','\)\);)676 2200 y(})676 2291
y(nd.halt\(\);)676 2383 y(otsan\(\);)598 2474 y(})1885
5255 y Fz(188)p eop
PStoPSsaved restore
%%Page: (190,191) 96
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
189 190 bop 515 523 a FA(The)32 b(mo)s(dule)d(loader)j
Fg(C)7 b Fx(++)30 b FA(source)i(\014les)515 676 y Fz(Mo)r(dule)c
(loader)e(co)r(de)h(is)h(k)n(ept)f(in)h Fx(node/mod.h)c
Fz(and)j Fx(node/mod.C)p Fz(.)515 809 y Fk(h)p Fj(mo)l(d.h*)11
b Fk(i)p Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y
Fi(#ifndef)41 b(__OFF_MOD_H)598 1083 y(#define)g(__OFF_MOD_H)g(1)598
1266 y Fk(h)p Fj(O\013)27 b(mo)l(dule)h(lo)l(ader)g(dep)l(endencies.)h
Fk(i)598 1448 y Fi(#ifdef)40 b(__KERNEL__)598 1540 y
Fk(h)p Fj(O\013)27 b(mo)l(dule)h(data)g(typ)l(e.)g Fk(i)598
1631 y(h)p Fj(O\013)f(mo)l(dule)h(lo)l(ader.)g Fk(i)598
1814 y Fi(#endif)40 b(//)g(__KERNEL__)598 1996 y(#ifndef)h(__KERNEL__)
598 2088 y(extern)f(int)g(errno;)598 2179 y(extern)g(off_uDTLB)i
(__dtlb;)158 b(//)40 b(the)g(dtlb)g(being)g(used.)598
2270 y(extern)g(off_uPrtl)i(__prtl;)158 b(//)40 b(our)g(exception)h
(portal)598 2362 y(extern)f(off_uShtl)i(__shtl;)158 b(//)40
b(the)g(portal)g(we're)h(running)f(on.)598 2453 y(extern)g(off_Rights)i
(__ndr;)158 b(//)40 b(node)g(access)h(rights.)598 2636
y(#endif)f(//)g(!__KERNEL__)598 2818 y(#endif)g(//)g(__OFF_MOD)515
2993 y Fk(h)p Fj(mo)l(d.C*)11 b Fk(i)o Fq(\021)598 3084
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 3267 y Fi(#include)41 b(<node/mod.h>)434
b(//)40 b(Exported)h(interface.)598 3358 y Fk(h)p Fj(O\013)27
b(mo)l(dule)h(lo)l(ader)g(implementation)g(dep)l(endencies.)h
Fk(i)598 3541 y(h)p Fi(off)p 750 3541 24 4 v 29 w(ModLoader::ModLoader)
j Fj(implementation.)27 b Fk(i)598 3632 y(h)p Fi(off)p
750 3632 V 29 w(ModLoader::load)j Fj(implementation.)e
Fk(i)598 3723 y(h)p Fi(off)p 750 3723 V 29 w(ModLoader::start)j
Fj(implementation.)c Fk(i)598 3815 y(h)p Fi(off)p 750
3815 V 29 w(ModLoader::exec)p 1364 3815 V 31 w(mods)i
Fj(implementation.)e Fk(i)1885 5255 y Fz(189)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
190 191 bop 515 523 a Fr(3.6)135 b(System)45 b(halt,)h(reb)t(o)t(ot)g
(and)e(susp)t(end)515 705 y Fz(System)26 b(halt)g(and)f(reb)r(o)r(ot)h
(are)f(done)g(b)n(y)h(mac)n(hine)f(dep)r(enden)n(t)i(routines.)36
b(The)25 b(mac)n(hine)515 805 y(indep)r(enden)n(t)41
b(part)g(m)n(ust)g(deal)f(just)i(with)f(kind)g(messages)f(and)g(serial)
g(line)h(console)515 904 y(termination.)515 1037 y Fk(h)p
Fi(off)p 667 1037 24 4 v 29 w(Node::halt)29 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1128 y Fi(//)39 b(Halts)i(this)f(node)598
1220 y(void)g(off_Node::halt\(const)k(char)c(*msg)g(\))598
1311 y({)676 1402 y(w_lock\(\);)676 1494 y(kcout)h(<<)e(msg)h(<<)g(nl;)
676 1585 y(if)g(\(using_serial_console\(\)\){)755 1676
y(n_mdep.db_break\(\);)755 1768 y(n_mdep.stop_dbserial\(0\);)676
1859 y(})676 1950 y(n_mdep.halt\(\);)676 2042 y(panic\("halt)i
(returned"\);)598 2133 y(})515 2399 y Fk(h)p Fi(off)p
667 2399 V 29 w(Node::reboot)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 2490 y Fi(void)40 b(off_Node::reboot\()j(void)d(\))
598 2581 y({)676 2673 y(assert\(valid\(\)\);)676 2764
y(w_lock\(\);)676 2855 y(if)g(\(using_serial_console\(\)\))755
2946 y(n_mdep.stop_dbserial\(0\);)676 3038 y(n_mdep.reboot\(\);)676
3129 y(halt\("node:)i(Reboot)f(failed,)f(halting."\);)598
3220 y(})515 3486 y Fk(h)p Fj(O\013)27 b(no)l(de)h(implementation)g
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3577 y
Fi(#include)41 b(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
3669 y(#include)h(<klib/mdep/debug.h>)639 3810 y Fz(Susp)r(end)29
b(is)e(not)h(implemen)n(ted.)515 3926 y Fk(h)p Fi(off)p
667 3926 V 29 w(Node::suspend)i Fj(implementation.)d
Fk(i)p Fq(\021)598 4017 y Fi(err_t)40 b(off_Node::suspend\()j(void)e
(\))598 4109 y({)676 4200 y(assert\(valid\(\)\);)676
4291 y(return)g(ENOSYS;)598 4383 y(})1885 5255 y Fz(190)p
eop
PStoPSsaved restore
%%Page: (192,193) 97
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
191 192 bop 515 523 a Fr(3.7)135 b(F)-11 b(rozen)44 b(no)t(des)515
705 y Fz(T)-7 b(o)18 b(supp)r(ort)g Fx(freeze)e Fz(and)i
Fx(melt)f Fz(no)r(des)h(m)n(ust)h(implemen)n(t)g Fx(freeze)p
2640 705 27 4 v 28 w(state)e Fz(and)h Fx(copy)p 3233
705 V 30 w(state)p Fz(.)515 838 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
838 24 4 v 29 w(Node)p Fj(.)h Fk(i)o Fq(\021)598 929
y Fi(//)39 b(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 1020 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
1112 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 1203
y(const)f(off_prtl_id_t)82 b(&frozen_domain)f(\);)598
1386 y(//)39 b(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f
(toavail)h(bytes.)598 1477 y(virtual)g(err_t)f(copy_state\(char)j
(*&curto,)e(size_t)f(&toavail\))h(const;)639 1618 y Fz(The)23
b(\014rst)f(one)g(is)g(more)f(delicate.)35 b(T)-7 b(o)22
b(freeze)g(a)g(the)h(state)f(of)g(a)g(whole)g(no)r(de)h(w)n(e)f(freeze)
515 1718 y(ev)n(ery)e(system)h(serv)n(er)f(and)h(then)h(the)g(no)r(de)g
(itself.)35 b(A)22 b(no)r(de)f(freeze)g(op)r(eration)g(reminds)g(of)515
1817 y(a)27 b(susp)r(end)g(op)r(eration,)g(b)r(ecause)g(once)g(the)h
(no)r(de)f(is)g(frozen)g(man)n(y)g(system)g(services)f(are)515
1917 y(no)i(longer)g(a)n(v)-5 b(ailable.)39 b(But)30
b(ev)n(en)e(when)h(frozen,)g(basic)f(system)h(serv)n(ers)d(should)j
(lea)n(v)n(e)e(a)515 2017 y(small)e(amoun)n(t)f(of)i(non-freezeable)d
(resources)h(a)n(v)-5 b(ailable)23 b(so)i(that)h(the)f(whole)g(no)r(de)
g(state)515 2116 y(could)i(b)r(e)h(transferred)e(to)h(a)h(di\013eren)n
(t)f(hardw)n(are-no)r(de)e(and)j(melted)g(there.)36 b(Read)27
b(only)515 2216 y(\()p Fx(const)p Fz(\))i(op)r(erations)f(are)i(still)g
(feasible.)45 b(Besides,)30 b(as)f(devices)h(cannot)g(b)r(e)h(frozen,)f
(an)n(y)515 2316 y(OS)d(device)g(driv)n(er)g(should)g(b)r(e)h
(restarted.)515 2448 y Fk(h)p Fi(off)p 667 2448 V 29
w(Node::freeze)p 1164 2448 V 30 w(state)h Fj(implementation.)f
Fk(i)o Fq(\021)598 2540 y Fi(//)39 b(Freeze)i(dynamic)g(resource)g
(state)f(at)g(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598
2631 y(err_t)f(off_Node::freeze_state\(char)45 b(*buf,)c(char)f
(*&curbuf,)h(size_t)g(&avail,)1735 2722 y(char)f(*&curto,)i(size_t)e
(&toavail,)1735 2814 y(const)h(off_prtl_id_t)81 b(&frozen_domain)h(\))
598 2905 y({)676 2996 y Fk(h)p Fi(off)p 828 2996 V 29
w(Node::freeze)p 1325 2996 V 31 w(state)29 b Fj(lo)l(c)l(al)e
(variables.)h Fk(i)676 3179 y Fi(assert\(valid\(\)\);)676
3270 y(assert\(buf)42 b(&&)d(curbuf\);)676 3362 y Fk(h)p
Fj(F)-6 b(r)l(e)l(eze)29 b(no)l(de)g(memb)l(ers)f(in)f
Fi(buf)i Fj(at)f Fi(curbuf)g Fj(in)g Fi(avail)g Fj(bytes.)h
Fk(i)676 3453 y(h)p Fj(F)-6 b(r)l(e)l(eze)29 b(system)g(servers)h(in)d
Fi(buf)h Fj(at)g Fi(curbuf)h Fj(in)e Fi(avail)i Fj(bytes.)g
Fk(i)676 3544 y Fi(return)41 b(EOK;)598 3636 y(})639
3868 y Fz(No)r(de)d(mem)n(b)r(ers)f Fx(n)p 1276 3868
27 4 v 30 w(name)p Fz(,)i Fx(n)p 1588 3868 V 31 w(url)p
Fz(,)f(and)f Fx(n)p 2027 3868 V 31 w(owner)e Fz(use)i(dynamic)g(memory)
-7 b(.)65 b(Their)515 3968 y(v)-5 b(alue)24 b(is)g(stored)g(in)h
Fx(curbuf)d Fz(and)i(they)h(are)e(adjusted)i(to)f(con)n(tain)g(relativ)
n(e)f(p)r(oin)n(ters)h(in)n(to)515 4067 y Fx(buf)p Fz(.)515
4200 y Fk(h)p Fj(F)-6 b(r)l(e)l(eze)29 b(no)l(de)f(memb)l(ers)h(in)e
Fi(buf)h Fj(at)g Fi(curbuf)h Fj(in)e Fi(avail)i Fj(bytes.)f
Fk(i)p Fq(\021)598 4291 y Fi(if)39 b(\(!::freeze\(n_name,buf,curbu)q
(f,ava)q(il\))85 b(||)755 4383 y(!::freeze\(n_owner,buf,curbuf,av)q
(ail\))46 b(||)755 4474 y(!::freeze\(n_url,buf,curbuf,avai)q(l\))202
b(\))676 4565 y(return)41 b(ENOSPC;)1885 5255 y Fz(191)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
192 193 bop 639 523 a Fz(W)-7 b(e)27 b(ha)n(v)n(e)f(used)h
Fx(freeze)p Fz(.)34 b(It)27 b(is)g(a)f(generic)g(utilit)n(y)h(function)
g(whic)n(h)g(stores)f(the)h(giv)n(en)515 623 y(argumen)n(t)k(in)n(to)h
(the)h(bu\013er,)g(adv)-5 b(ancing)32 b(the)g(bu\013er)h(p)r(oin)n
(ter,)g(subtracting)e(the)i(newly)515 722 y(stored)19
b(size)h(and)f(adjusting)h(the)h(p)r(oin)n(ter)e(to)h(the)h(argumen)n
(t)e(giv)n(en)g(so)g(that)h(it)h(is)f(a)f(relativ)n(e)515
822 y(v)-5 b(alue)27 b(in)n(to)h(buf.)515 938 y Fk(h)p
Fj(O\013)f(no)l(de)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1029 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 1121 y(#include)h(<string.h>)512
b(//)40 b(for)g(strcpy)g(et)g(al.)598 1212 y(#include)h
(<klib/freeze.h>)317 b(//)40 b(for)g(freeze)639 1337
y Fz(Systems)31 b(serv)n(ers)d(m)n(ust)i(b)r(e)h(frozen)f(on)g(their)h
(o)n(wn.)44 b(W)-7 b(e)31 b(freeze)f(them)h(in)g(the)f(order)515
1436 y(sho)n(wn)20 b(b)r(elo)n(w.)34 b(Ev)n(en)20 b(though)h(w)n(e)g
(are)f(freezing)g(the)h(sh)n(uttle)h(serv)n(er,)e(the)i(curren)n(t)e
(sh)n(uttle)515 1536 y(will)35 b(con)n(tin)n(ue)g(its)g(execution)g
(una\013ected)g(b)n(y)g(the)h Fx(freeze)c Fz(op)r(eration.)59
b(Suc)n(h)35 b(sh)n(uttle)515 1636 y(can)26 b(b)r(e)h(used)g(later)f
(on)h(to)g(susp)r(end)g(the)g(no)r(de,)g(halt)g(it)g(or)f(to)h
(transfer)f(the)h(frozen)f(no)r(de)515 1735 y(con)n(ten)n(ts)31
b(to)g(a)g(di\013eren)n(t)h(lo)r(cation.)47 b(\(Note)32
b(that)g(read-only)e(op)r(erations)g(ma)n(y)h(pro)r(ceed)515
1835 y(while)d(the)f(system)h(is)f(frozen.)37 b(Only)27
b(read-write)f(op)r(erations)g(will)i(b)r(e)g(a\013ected\).)515
1951 y Fk(h)p Fj(F)-6 b(r)l(e)l(eze)29 b(system)g(servers)h(in)d
Fi(buf)h Fj(at)g Fi(curbuf)h Fj(in)e Fi(avail)h Fj(bytes.)h
Fk(i)p Fq(\021)598 2042 y Fi(if)39 b(\(\(err=n_shtl->freeze\(curbuf)q
(,avai)q(l,cu)q(rto,)q(toava)q(il,f)q(rozen)q(_dom)q(ain\))q(\))45
b(||)755 2134 y(\(err=n_dmm->freeze\(curbuf,avail)q(,cur)q(to,t)q
(oavai)q(l,fr)q(ozen_)q(doma)q(in\)\))85 b(||)755 2225
y(//)39 b(Only)h(runs)h(this)f(shtl)g(beyond)g(this)h(point)755
2316 y(\(err=n_prtl->freeze\(curbuf,avai)q(l,cu)q(rto,)q(toava)q(il,f)q
(rozen)q(_dom)q(ain\))q(\))k(\))676 2408 y(return)c(err;)598
2499 y(for)f(\(natural_t)h(i=0;)f(i<n_nprocs;)i(i++\))676
2590 y(if)e(\(\(err=n_proc[i].freeze\(curbuf,)q(avai)q(l,cu)q(rto,t)q
(oava)q(il,fr)q(ozen)q(_dom)q(ain\)\))q(\))755 2682 y(return)g(err;)598
2773 y(#if)g(0)598 2864 y(for)g(\(natural_t)h(i=0;)f(i<n_ndmas;)i
(i++\))676 2956 y(if)e(\(\(err=n_dma[i].freeze\(curbuf,a)q(vail)q(,cur)
q(to,to)q(avai)q(l,fro)q(zen_)q(doma)q(in\)\)\))755 3047
y(return)g(err;)598 3138 y(#endif)598 3230 y(for)g(\(natural_t)h(i=0;)f
(i<n_niobanks;)i(i++\))676 3321 y(if)e
(\(\(err=n_iobank[i].freeze\(curbu)q(f,av)q(ail,)q(curto)q(,toa)q
(vail,)q(froz)q(en_d)q(omain)q(\)\)\))755 3412 y(return)g(err;)598
3504 y(for)g(\(natural_t)h(i=0;)f(i<n_nmbanks;)i(i++\))676
3595 y(if)e(\(\(err=n_mbank[i].freeze\(curbuf)q(,ava)q(il,c)q(urto,)q
(toav)q(ail,f)q(roze)q(n_do)q(main\))q(\)\))755 3686
y(return)g(err;)639 3902 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(in)n(tro)r
(duced)g(a)g(new)h(lo)r(cal)f(v)-5 b(ariable.)515 4018
y Fk(h)p Fi(off)p 667 4018 24 4 v 29 w(Node::freeze)p
1164 4018 V 30 w(state)29 b Fj(lo)l(c)l(al)f(variables.)g
Fk(i)p Fq(\021)598 4110 y Fi(err_t)40 b(err;)864 b(//)40
b(Error)g(code)1885 5255 y Fz(192)p eop
PStoPSsaved restore
%%Page: (194,195) 98
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
193 194 bop 639 523 a Fz(Ev)n(en)31 b(though)h(ev)n(ery)f(system)g
(service)g(is)h(frozen)f(no)n(w,)i(hardw)n(are)d(system)h(services)515
623 y(will)21 b(b)r(e)h(still)g(a)n(v)-5 b(ailable)20
b(but)i(for)f(resource)f(allo)r(cation.)34 b(With)22
b(resp)r(ect)f(to)h(system)f(serv)n(ers,)515 722 y(p)r(ortals)g(will)h
(still)g(deliv)n(er)g(ev)n(en)n(ts)f(\(no)h(allo)r(cation)f(nor)g(c)n
(hange)g(allo)n(w)n(ed)f(though\),)k Ft(dtlb)p Fz(s)515
822 y(will)36 b(still)g(w)n(ork)f(\(no)h(translations)f(c)n(hanged)g
(nor)g(status)h(bits)g(up)r(dated)h(though\))f(and)515
922 y(\(only\))27 b(the)h(curren)n(t)f(sh)n(uttle)h(will)g(remain)f
(running.)639 1021 y(T)-7 b(o)19 b(cop)n(y)g(the)h(no)r(de)g(static)f
(state)h(to)f(a)g(user)g(bu\013er)h(w)n(e)f(cop)n(y)g(the)h(no)r(de)f
(itself.)35 b(There)19 b(is)515 1121 y(no)24 b(need)i(to)f(cop)n(y)f
(the)h(state)g(of)g(ev)n(ery)f(system)h(serv)n(er)e(con)n(tained)h(in)h
(the)h(no)r(de,)f(b)r(ecause)515 1220 y(when)j Fx(freeze)p
1001 1220 27 4 v 28 w(state)e Fz(is)i(called)f(it)h(en)n(tirely)f
(freezes)g(ev)n(ery)f(system)h(serv)n(er.)515 1337 y
Fk(h)p Fi(off)p 667 1337 24 4 v 29 w(Node::copy)p 1086
1337 V 30 w(state)i Fj(implementation.)e Fk(i)p Fq(\021)598
1428 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i
(with)f(toavail)h(bytes.)598 1519 y(err_t)f(off_Node::copy_state\(char)
45 b(*&curto,)c(size_t)g(&toavail\))g(const)598 1611
y({)676 1702 y(assert\(valid\(\)\);)676 1793 y(if)f(\(curto\){)755
1885 y(if)f(\(toavail<sizeof\(off_Node\)\))833 1976 y(return)i(ENOSPC;)
755 2067 y(//)e(*\(off_Node*\)curto)k(=)d(*this;)g(XXX)755
2159 y(curto)g(+=)g(sizeof\(off_Node\);)755 2250 y
(toavail-=sizeof\(*this\);)676 2341 y(})676 2433 y(return)h(EOK;)598
2524 y(})639 2740 y Fz(Once)36 b(a)g(no)r(de)g(is)g(frozen,)i(it)e(can)
g(b)r(e)h(melted.)63 b(T)-7 b(o)35 b(melt)i(a)f(no)r(de)g(w)n(e)g(m)n
(ust)g(assist)515 2839 y(the)27 b(generic)g Fx(melt)e
Fz(implemen)n(tation)j(pro)n(vided)e(b)n(y)h Fx(Resource)d
Fz(b)n(y)j(implemen)n(ting)h(some)515 2939 y(metho)r(ds.)515
3072 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3072 V 29 w(Node)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 3163 y Fi(//)39 b(Does)i(resource)g(cleanup.)g(No)e
(external)i(resource)g(should)g(be)f(used)g(after)598
3254 y(//)f(return.)598 3346 y(virtual)i(err_t)f(cleanup\(void\);)598
3528 y(//)f(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 3620 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 3802 y(//)f(Restores)i(dynamic)g
(resource)g(state.)598 3894 y(virtual)g(err_t)f(melt_state\(char)j
(*&buf,)d(size_t)h(&bsize,)g(char)f(*&from,)h(size_t)f(&size,)1578
3985 y(const)h(off_prtl_id_t)h(&melted_domain\);)1885
5255 y Fz(193)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
194 195 bop 639 523 a Fz(First,)22 b(to)e(clean)f(up)i(no)r(de)f(state)
g(w)n(e)g(simply)g(clean)f(up)i(ev)n(ery)e(con)n(tained)g(resource)f
(and)515 623 y(release)24 b(memory)h(hold)h(b)n(y)g(the)g(no)r(de)g
(name,)g(o)n(wner)e(and)i(URL)g(are)f(\(the)i(only)e(dynamic)515
722 y(mem)n(b)r(ers)i(of)h(a)f(no)r(de\).)515 855 y Fk(h)p
Fi(off)p 667 855 24 4 v 29 w(Node::cleanup)j Fj(implementation.)d
Fk(i)p Fq(\021)598 946 y Fi(//)39 b(Does)i(resource)g(cleanup.)g(No)e
(external)i(resource)g(should)g(be)f(used)g(after)598
1038 y(//)f(return.)598 1129 y(err_t)h(off_Node::cleanup\(void\))598
1220 y({)676 1312 y(assert\(valid\(\)\);)676 1403 y(assert\(n_name)i
(&&)e(n_url)g(&&)g(n_owner\);)676 1494 y(free\(\(char*\)n_name\);)397
b(//)40 b(created)h(w/)e(strdup.)i(Must)f(use)g(free.)676
1586 y(free\(\(char*\)n_url\);)436 b(//)40 b(and)g(thus)g(discard)h
(`const'.)676 1677 y(free\(\(char*\)n_owner\);)676 1768
y(return)g(EOK;)598 1860 y(})639 2092 y Fz(The)27 b(static)g(state)g
(restore)e(function)i(is)g(also)f(simple.)37 b(The)27
b(most)f(pic)n(ky)h(part)f(is)h(that)515 2192 y(w)n(e)c(m)n(ust)g(c)n
(hec)n(k)g(\(using)h Fx(can)p 1437 2192 27 4 v 30 w(melt)p
Fz(\))e(that)i(the)g(no)r(de)f(image)g(can)g(indeed)h(b)r(e)g(melted.)
36 b(F)-7 b(or)515 2291 y(example,)37 b(w)n(e)e(can)h(not)g(melt)g(a)f
(no)r(de)h(with)g(lots)f(of)h(memory)f(in)n(to)g(a)h(no)r(de)g(with)g
(few)515 2391 y(memory)-7 b(,)25 b(or)f(a)h(no)r(de)g(with)h(three)f
(di\013eren)n(t)h(memory)e(banks)h(in)n(to)g(a)g(no)r(de)g(with)h(a)f
(single)515 2491 y(one.)36 b(This)28 b(no)r(de)f(should)h(b)r(e)g(at)f
(least)g(as)g(p)r(o)n(w)n(erful)g(as)g(the)h(no)r(de)g(image)f(b)r
(eing)g(melted.)515 2623 y Fk(h)p Fi(off)p 667 2623 24
4 v 29 w(Node::restore)p 1203 2623 V 31 w(state)h Fj(implementation.)g
Fk(i)p Fq(\021)598 2715 y Fi(//)39 b(Restores)i(the)f(static)h(state)f
(from)g(a)g(user)g(supplied)h(buffer.)598 2806 y(err_t)f
(off_Node::restore_state\(char)46 b(*&buf,)40 b(size_t)h(&bsize\))598
2897 y({)676 2989 y(off_Node)g(*other=\(off_Node*\)buf;)676
3080 y(assert\(valid\(\)\);)676 3171 y(if)f(\(buf\){)755
3263 y(if)f(\(bsize)i(<)e(sizeof\(*this\))k(||)c(!can_melt\(other\)\){)
833 3354 y(return)i(EINVAL;)755 3445 y(})755 3537 y(//*this=*other;)h
(XXX)755 3628 y(buf+=sizeof\(*this\);)755 3719 y
(bsize-=sizeof\(*this\);)676 3811 y(})676 3902 y(return)f(EOK;)598
3993 y(})1885 5255 y Fz(194)p eop
PStoPSsaved restore
%%Page: (196,197) 99
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
195 196 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Node::melt)p 1086 523 V 30 w(state)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Restores)i(dynamic)g(resource)g
(state.)598 706 y(err_t)f(off_Node::melt_state\(char)45
b(*&buf,size_t)d(&bsize,)1657 797 y(char)e(*&from,)h(size_t)f(&size,)
1657 888 y(const)g(off_prtl_id_t)i(&melted_domain\))598
980 y({)676 1071 y(assert\(valid\(\)\);)676 1162 y(assert\(buf\);)676
1254 y Fk(h)p Fj(Melt)28 b(dynamic)f(memb)l(ers)i(fr)l(om)e
Fi(buf)h Fj(of)g(length)g Fi(bsize)p Fj(.)g Fk(i)676
1345 y(h)p Fj(Melt)g(system)h(servers)g(at)f Fi(buf)h
Fj(\(len)e Fi(bsize)p Fj(\))i(and)f Fi(from)h Fj(\()p
Fi(size)p Fj(\).)f Fk(i)676 1436 y Fi(return)41 b(EOK;)598
1528 y(})639 1760 y Fz(T)-7 b(o)23 b(melt)i(dynamic)e(no)r(de)h(mem)n
(b)r(ers)f(from)g(its)h(frozen)f(state)g(w)n(e)g(use)h(the)g
Fx(melt)e Fz(utilit)n(y)515 1860 y(function.)41 b(Note)29
b(ho)n(w)f Fx(n)p 1301 1860 27 4 v 31 w(opts)g Fz(is)g(missing)h(\(as)f
(it)i(w)n(as)e(in)h(the)g(cop)n(y)f(op)r(erator\))f(b)r(ecause)515
1959 y(suc)n(h)g(options)g(ha)n(v)n(e)f(b)r(een)i(already)f(pro)r
(cessed)f(b)n(y)h(the)h(frozen)f(no)r(de.)515 2092 y
Fk(h)p Fj(Melt)g(dynamic)h(memb)l(ers)g(fr)l(om)g Fi(buf)g
Fj(of)f(length)i Fi(bsize)p Fj(.)f Fk(i)p Fq(\021)598
2183 y Fi(n_name=::melt\(n_name,buf,bsize)q(\);)598 2275
y(n_owner=::melt\(n_owner,buf,bsi)q(ze\);)598 2366 y
(n_url=::melt\(n_url,buf,bsize\);)639 2507 y Fz(If)e(ev)n(erything)d
(lo)r(oks)h(\014ne,)i(w)n(e)f(pro)r(ceed)f(melting)h(system)g(serv)n
(ers)d(dynamic)j(state)g(in)515 2607 y(the)j(order)e(they)i(w)n(ere)e
(frozen.)37 b(They)27 b(will)h(pic)n(k)f(their)h(dynamic)f(frozen)g
(state)h(in)f(turn.)515 2723 y Fk(h)p Fj(Melt)g(system)i(servers)h(at)e
Fi(buf)g Fj(\(len)g Fi(bsize)p Fj(\))h(and)f Fi(from)g
Fj(\()p Fi(size)p Fj(\).)h Fk(i)p Fq(\021)598 2814 y
Fi(//)39 b(Melt)i(system)f(servers.)598 2906 y(//)f(NB:)h(This)g(code)h
(is)e(too)h(silly.)h(When)f(source)h(and)e(target)i(nodes)f(differ)598
2997 y(//)f(we)h(should)h(check)f(which)g(local)h(hardware)g
(containers)g(match)g(best)f(with)598 3088 y(//)f(remote)i(ones.)f(XXX)
598 3271 y(n_shtl->melt\(buf,bsize,from,si)q(ze,me)q(lted)q(_dom)q
(ain\);)598 3362 y(n_prtl->melt\(buf,bsize,from,si)q(ze,me)q(lted)q
(_dom)q(ain\);)598 3454 y(n_dmm->melt\(buf,bsize,from,siz)q(e,mel)q
(ted_)q(doma)q(in\);)598 3545 y(for)g(\(natural_t)h(i=0;)f(i<n_nprocs;)
i(i++\))676 3636 y(n_proc[i].melt\(buf,bsize,fro)q(m,siz)q(e,me)q(lted)
q(_doma)q(in\);)598 3728 y(#if)e(0)598 3819 y(for)g(\(natural_t)h(i=0;)
f(i<n_ndmas;)i(i++\))676 3910 y(n_dma[i].melt\(buf,bsize,from)q(,size)q
(,mel)q(ted_)q(domai)q(n\);)598 4002 y(#endif)598 4093
y(for)e(\(natural_t)h(i=0;)f(i<n_niobanks;)i(i++\))676
4184 y(n_iobank[i].melt\(buf,bsize,f)q(rom,s)q(ize,)q(melt)q(ed_do)q
(main)q(\);)598 4276 y(for)e(\(natural_t)h(i=0;)f(i<n_nmbanks;)i(i++\))
676 4367 y(n_mbank[i].melt\(buf,)i(bsize,from,size,melted_domain)q(\);)
1885 5255 y Fz(195)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
196 197 bop 639 523 a Fz(W)-7 b(e)23 b(are)e(not)g(c)n(hec)n(king)g
(error)f(co)r(des)i(b)r(ecause,)g(an)n(yw)n(a)n(y)-7
b(,)21 b(the)i(user)e(is)h(trying)f(to)h(melt)g(a)515
623 y(whole)k(no)r(de.)36 b(If)27 b(melting)g(fails)f(the)h(no)r(de)f
(is)g(lik)n(ely)g(to)g(b)r(ecome)h(un)n(useful)f(\(the)h(user)f(w)n(as)
515 722 y(trying)i(to)h(replace)f(the)h(curren)n(t)f(one\).)41
b(W)-7 b(e)30 b(simply)f(hop)r(e)g(for)f(the)i(b)r(est.)41
b(Nev)n(ertheless,)515 822 y(w)n(e)27 b Fy(should)37
b Fz(c)n(hec)n(k)27 b(error)f(co)r(des.)639 922 y(W)-7
b(e)30 b(still)f(ha)n(v)n(e)e(to)i(answ)n(er)e(the)j(question,)f(what)f
(no)r(des)h(are)f(can)g(b)r(e)i(melted)f(at)g(this)515
1021 y(one?)36 b(The)28 b(answ)n(er)e(is)i(giv)n(en)e(b)n(y)i
Fx(can)p 1714 1021 27 4 v 30 w(melt)p Fz(.)515 1154 y
Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1154 24 4 v 29 w(Node)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 1245 y Fi(//)39 b(Is)h(the)g(other)g(node)h(meltable)g(at)e
(this)h(one?)598 1337 y(boolean_t)h(can_melt\(const)h(off_Node)f
(*other\))g(const;)639 1478 y Fz(W)-7 b(e)40 b(simply)f(c)n(hec)n(k)f
(that)i(there)f(are)f(enough)g(hardw)n(are)f(con)n(tainers)h(to)h(melt)
h(the)515 1577 y(remote)27 b(no)r(de.)515 1710 y Fk(h)p
Fi(off)p 667 1710 V 29 w(Node::can)p 1047 1710 V 30 w(melt)h
Fj(implementation.)g Fk(i)p Fq(\021)598 1802 y Fi(//)39
b(Is)h(the)g(other)g(node)h(meltable)g(at)e(this)h(one?)598
1893 y(boolean_t)h(off_Node::can_melt\(const)k(off_Node)c(*other\))g
(const)598 1984 y({)676 2076 y(assert\(valid\(\))i(&&)c(other)i(&&)e
(other->valid\(\)\);)676 2167 y(return)i(\(n_nmbanks)g(>=)f
(other->n_nmbanks)j(&&)990 2258 y(n_niobanks>=)f(other->n_niobanks//&&)
240 b(XXX)40 b(fix)g(this)990 2350 y(//n_ndmas>=)i(other->n_ndmas)598
2441 y(\);)598 2623 y(})639 2856 y Fz(Co)r(de)27 b(for)f(freeze)g(and)g
(melt)i(is)e(included)h(with)g(the)g(implemen)n(tation)g(of)g(other)f
Fx(Node)515 2956 y Fz(metho)r(ds.)515 3072 y Fk(h)p Fj(Implementation)i
(of)f(other)i(metho)l(ds)g(of)e Fi(off)p 1893 3072 V
29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3163 y Fk(h)p
Fi(off)p 750 3163 V 29 w(Node::freeze)p 1247 3163 V 31
w(state)g Fj(implementation.)g Fk(i)598 3254 y(h)p Fi(off)p
750 3254 V 29 w(Node::copy)p 1169 3254 V 30 w(state)h
Fj(implementation.)e Fk(i)598 3346 y(h)p Fi(off)p 750
3346 V 29 w(Node::cleanup)j Fj(implementation.)d Fk(i)598
3437 y(h)p Fi(off)p 750 3437 V 29 w(Node::restore)p 1286
3437 V 31 w(state)h Fj(implementation.)g Fk(i)598 3528
y(h)p Fi(off)p 750 3528 V 29 w(Node::melt)p 1169 3528
V 30 w(state)h Fj(implementation.)e Fk(i)598 3620 y(h)p
Fi(off)p 750 3620 V 29 w(Node::can)p 1130 3620 V 30 w(melt)h
Fj(implementation.)g Fk(i)515 3919 y Fr(3.8)135 b(T)-11
b(ranslating)42 b(alien)g(resources)g(to)f(nativ)l(e)i(format)515
4101 y Fz(Whenev)n(er)30 b(an)h(alien)g(resource)e(is)i(detected)g(and)
g(con)n(v)n(ersion)e(to)h(nativ)n(e)h(format)f(is)h(de-)515
4201 y(sired,)c Fx(assimilate)c Fz(is)28 b(called.)515
4317 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4317 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
4408 y Fi(//)39 b(Tries)i(to)e(assimilate)j(the)e(resource)h(in)f(buf)g
(to)f(the)h(specified)h(kind)598 4500 y(//)e(of)h(resource)h(for)f(the)
g(given)g(architecture.)598 4591 y(err_t)g(assimilate\(const)j(char)d
(*kind,)h(const)f(char)g(*arch,)h(char)f(*&buf,)h(size_t)f(&size\);)
1885 5255 y Fz(196)p eop
PStoPSsaved restore
%%Page: (198,199) 100
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
197 198 bop 639 523 a Fz(The)28 b(implemen)n(tation)g(issues)f(an)g(up)
r(call)h(to)f(a)g(trusted)h(external)f(data)g(translator.)515
639 y Fk(h)p Fi(off)p 667 639 24 4 v 29 w(Node::assimilate)k
Fj(implementation.)c Fk(i)p Fq(\021)598 731 y Fi(//)39
b(Tries)i(to)e(assimilate)j(the)e(resource)h(in)f(buf)g(to)f(the)h
(specified)h(kind)598 822 y(//)e(of)h(resource)h(for)f(the)g(given)g
(architecture.)598 913 y(err_t)g(off_Node::assimilate\(const)45
b(char)40 b(*kind,)h(const)f(char)g(*arch,)1657 1005
y(char)g(*&buf,)h(size_t)f(&size\))598 1096 y({)676 1187
y(err_t)h(r=EOK;)676 1279 y(\(void\)kind;)h(\(void\)arch;)g
(\(void\)buf;)f(\(void\)size;)598 1370 y(#if)f(0)588
b(//)40 b(XXX)g(fix)g(this)676 1461 y(off_XDTReq)i(m\(kindof,)f(buf,)f
(size\);)676 1553 y(off_XDTRep)i(r\(buf,size\);)676 1644
y(assert\(valid\(\)\);)676 1735 y(assert\(arch)g(&&)e(buf)g(&&)f
(size>0\);)676 1826 y(if)h(\(nd.get_xdt\(\))i(==)e(OFF_PRTL_NULL\))755
1918 y(return)g(ENOPRTL;)676 2009 y(if)g
(\(\(r=prtl.kpct\(nd.get_xdt\(\),off)q(_Sht)q(l::s)q(elf\(\))q(,)1343
2100 y(sizeof\(m\),sizeof\(r\),&m,&r,0\)\))q(\))755 2192
y(return)g(r;)676 2283 y(else)g({)755 2374 y(buf=r.m_kbuf;)755
2466 y(size=r.m_len;)755 2557 y(return)g(r.m_err;)676
2648 y(})598 2740 y(#endif)676 2831 y(return)h(r;)598
2922 y(})639 3047 y Fz(The)30 b(data)g(translator)e(in)n(v)n(ok)n(ed)h
(m)n(ust)h(b)r(e)g(trusted)g(and)g(it)h(is)f(a)f(go)r(o)r(d)h(idea)f
(to)h(let)h(it)515 3147 y(write)c Fx(buf)g Fz(so)f(w)n(e)i(a)n(v)n(oid)
e(unnecessary)g(cop)n(ying.)639 3246 y(Messages)37 b(exc)n(hanged)h(b)n
(y)g(the)h(k)n(ernel)f(and)g(the)h(translator)e(are)h(as)g(follo)n(w:)
58 b(The)515 3346 y(k)n(ernel)26 b(sends)i(the)g(exp)r(ected)g(ob)5
b(ject)27 b(kind)h(as)f(w)n(ell)g(as)g(the)h(user)f(bu\013er.)515
3462 y Fk(h)p Fj(O\013)g(user-kernel)j(messages.)f Fk(i)p
Fq(\021)598 3553 y Fi(//)39 b(XDT)h(request)598 3645
y(struct)g(off_XDTReq)i(:public)f(off_MsgReq)g({)676
3736 y(off_Magic)g(m_kind;)512 b(//)40 b(kind)g(of)g(object)g(needed.)
676 3827 y(char)197 b(*m_kbuf;)512 b(//)40 b(Addres)g(in)g(kernel)h
(for)e(the)h(user)h(buffer.)676 3919 y(size_t)158 b(m_size;)512
b(//)40 b(Size)g(of)g(the)f(buffer.)676 4101 y(//Creates)i(an)f(XDT)g
(request.)676 4193 y(off_XDTReq\(const)j(off_Magic)e(&kind,)g(char)f
(*buf,)g(size_t)h(len\))f(:)755 4284 y(off_MsgReq\(OFF_EX_XDT\),)755
4375 y(m_kind\(kind\),)i(m_kbuf\(buf\),)g(m_size\(len\))g({;})598
4467 y(};)515 4716 y Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f(dep)
l(endencies.)g Fk(i)p Fq(\021)598 4807 y Fi(#include)41
b(<klib/Magic.h>)356 b(//)40 b(for)g(off_Magic)1885 5255
y Fz(197)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
198 199 bop 639 523 a Fz(The)25 b(user)g(is)g(exp)r(ected)g(to)g
(return)g(the)g(\(k)n(ernel\))g(address)f(of)h(a)f(bu\013er)i(with)f
(the)h(data)515 623 y(already)g(translated.)515 739 y
Fk(h)p Fj(O\013)h(user-kernel)j(messages.)f Fk(i)p Fz(+)o
Fq(\021)598 830 y Fi(struct)40 b(off_XDTRep)i(:)d(public)i(off_MsgRep)g
({)676 922 y(char)119 b(*m_kbuf;)590 b(//)40 b(Buffer)g(with)g
(translation.)676 1013 y(size_t)80 b(m_len;)629 b(//)40
b(Translated)h(data)f(length.)676 1104 y(off_XDTRep\(void\){;})676
1196 y(off_XDTRep\(const)j(err_t)d(err,)h(char)f(*buf,)g(size_t)h
(len\))f(:)755 1287 y(m_kbuf\(buf\),)i(m_len\(len\),)f
(off_MsgRep\(err\))i({;})598 1378 y(};)639 1594 y Fz(These)28
b(message)e(t)n(yp)r(es)h(are)g(de\014ned)h(in)g Fx(prtl/ex.h)p
Fz(.)515 1710 y Fk(h)p Fj(O\013)f(no)l(de)h(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 1802 y Fi(#include)41
b(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})515 1959
y Fk(h)p Fj(Implementation)28 b(of)f(other)i(metho)l(ds)g(of)e
Fi(off)p 1893 1959 24 4 v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2051 y Fk(h)p Fi(off)p 750 2051 V 29 w(Node::assimilate)j
Fj(implementation.)c Fk(i)515 2367 y Fr(3.9)135 b(Dumping)45
b(no)t(de)f(con)l(ten)l(ts)515 2549 y Fz(T)-7 b(o)24
b(dump)h(some)g(summary)e(information)h(ab)r(out)h(no)r(de)g(con)n(ten)
n(ts,)g(this)g(op)r(erator)e(is)h(pro-)515 2648 y(vided.)515
2764 y Fk(h)p Fj(Other)k(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2764 V 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2856 y Fi(friend)40 b(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_Node)42 b(&n\);)515 3013 y Fk(h)p Fi(off)p 667
3013 V 29 w(Node::operator<<)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 3105 y Fi(//)39 b(Dumps)i(node)f(summary)h
(information.)598 3196 y(OStr)f(&operator<<\(OStr)j(&s,)79
b(off_Node)41 b(&n\))598 3287 y({)676 3379 y(assert\(n.valid\(\)\);)676
3470 y(s)f(<<)f(\(off_Resource\)n)k(<<)d(nl;)676 3561
y(s)g(<<)f(")h(name=\\"")h(<<n.n_name)g(<<"\\"")g(<<)f(nl;)676
3653 y(s)g(<<)f(")h(url=\\"")h(<<n.n_url)g(<<"\\"")f(<<)g(nl;)676
3744 y(s)g(<<)f("auth=")i(<<)f(n.n_auth<<)h(")f(xdt=")g(<<n.n_xdt)h
(<<")f(cout=")h(<<n.n_cout)g(<<)f(nl;)676 3835 y(s)g(<<)f
(n.get_arch\(\))j(<<)e(")f(")h(<<)755 3927 y(n.n_niobanks)i(<<)d(")h
(iobanks,")h(<<)f(//)f(n.n_ndmas)j(<<)d(")h(dmas,")g(<<)79
b(XXX)40 b(fix)g(this)755 4018 y(n.n_nmbanks)h(<<)f(")g(mbanks.")h(<<)e
(nl;)676 4109 y(return)i(s;)598 4201 y(})639 4433 y Fz(Its)28
b(implemen)n(tation)g(is)f(k)n(ept)h(along)e(with)i(remaining)f(no)r
(de)g(co)r(de.)515 4566 y Fk(h)p Fj(Implementation)h(of)f(other)i
(metho)l(ds)g(of)e Fi(off)p 1893 4566 V 29 w(Node)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 4657 y Fk(h)p Fi(off)p 750
4657 V 29 w(Node::operator<<)j Fj(implementation.)c Fk(i)1885
5255 y Fz(198)p eop
PStoPSsaved restore
%%Page: (200,201) 101
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
199 200 bop 515 523 a Fr(3.10)135 b(Miscellaneous)47
b(no)t(de)d(op)t(erations)515 705 y Fz(There)29 b(are)f(some)h(global)f
(op)r(erations)g(that)i(do)f(not)h(\014t)f(w)n(ell)h(an)n(ywhere)e
(else.)42 b(They)29 b(are)515 805 y(included)f(in)g Fx(Node)e
Fz(to)r(o.)36 b(This)28 b(section)f(will)h(describ)r(e)f(them)h(all.)
515 1031 y Fn(3.10.1)112 b(Basic)37 b(console)g(output)515
1185 y Fz(The)32 b(follo)n(wing)f(ones,)i(for)f(example,)h(redirects)f
(system)g(output)h(within)g(the)g(k)n(ernel)e(to)515
1284 y(sev)n(eral)37 b(places.)69 b(Output)39 b(can)f(b)r(e)i
(redirected)d(at)i(an)n(y)f(time)h(to)g(either)f(a)g(serial)g(line)515
1384 y(console)d(or)h(to)g(a)h(user-lev)n(el)e(OS)h(pro)n(vided)g
(console)f(\(iden)n(ti\014ed)j(b)n(y)e(a)g(p)r(ortal)g(named)515
1484 y Fx(cout)p Fz(\).)515 1604 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1604 24 4
v 29 w(Node)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1695 y
Fi(//)39 b(Use)h(the)g(serial)h(console?)598 1786 y(err_t)f
(use_serial_console\(boolean_t)46 b(doit)40 b(=)f(TRUE)h(\);)598
1878 y(boolean_t)h(using_serial_console\(void\))k
({assert\(valid\(\)\);)e(return)e(n_comredirect;)h(})598
2060 y(//)d(User)i(OS)e(provided)i(output)g(services?)598
2152 y(err_t)f(set_cout\(const)j(off_prtl_id_t)f(&cout)e(\);)598
2243 y(boolean_t)h(using_cout\(void\))i(const)d({assert\(valid\(\)\);)j
(return)e(n_coutredirect;)i(})515 2483 y Fk(h)p Fi(off)p
667 2483 V 29 w(Node::use)p 1047 2483 V 30 w(serial)p
1311 2483 V 29 w(console)29 b Fj(and)f Fi(set)p 1908
2483 V 29 w(cout)h Fj(implementation.)e Fk(i)p Fq(\021)598
2574 y Fi(//)39 b(Use)h(the)g(serial)h(console?)598 2666
y(err_t)f(off_Node::use_serial_console\()q(bool)q(ean_)q(t)45
b(doit)40 b(=)g(TRUE)g(\))598 2757 y({)676 2848 y(assert\(valid\(\)\);)
676 2940 y(if)g(\(is_frozen\(\)\))755 3031 y(return)g(EFROZEN;)676
3122 y(n_comredirect=doit;)676 3214 y(if)g(\(doit\))g({)755
3305 y(kcout)g(<<)g("node:)g(using)h(serial)f(line)g(console")h(<<)f
(nl;)676 3396 y(})676 3488 y(return)h(EOK;)598 3579 y(})598
3762 y(//)e(User)i(OS)e(provided)i(output)g(services?)598
3853 y(err_t)f(off_Node::set_cout\(const)45 b(off_prtl_id_t)d(&cout)e
(\))598 3944 y({)676 4036 y(assert\(valid\(\)\);)676
4127 y(w_lock\(\);)676 4218 y(n_cout)h(=)e(cout;)676
4309 y(if)h(\(cout)g(!=)g(OFF_PRTL_NULL\))755 4401 y(n_coutredirect)i
(=)e(TRUE;)676 4492 y(w_unlock\(\);)676 4583 y(return)h(EOK;)598
4675 y(})515 4915 y Fk(h)p Fj(Implementation)28 b(of)f(other)i(metho)l
(ds)g(of)e Fi(off)p 1893 4915 V 29 w(Node)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 5006 y Fk(h)p Fi(off)p 750 5006 V
29 w(Node::use)p 1130 5006 V 30 w(serial)p 1394 5006
V 29 w(console)h Fj(and)f Fi(set)p 1991 5006 V 29 w(cout)h
Fj(implementation.)e Fk(i)1885 5255 y Fz(199)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
200 201 bop 639 523 a Fz(These)28 b(metho)r(ds)f(are)g(exp)r(orted)g
(to)h(system)f(users.)515 635 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 635 24 4 v 29 w(uNode)p Fj(.)h Fk(i)p
Fq(\021)598 726 y Fi(//)39 b(Use)h(the)g(serial)h(console?)598
817 y(err_t)f(use_serial_console\(boolean_t)46 b(doit)40
b(=)f(TRUE,)i(const)f(off_Rights)i(&r\))d(;)598 908 y(boolean_t)i
(using_serial_console\(const)k(off_Rights)d(&r\))e(const)g(;)598
1000 y(//)f(User)i(OS)e(provided)i(output)g(services?)598
1091 y(err_t)f(set_cout\()h(const)g(off_prtl_id_t)h(&cout,)f(const)f
(off_Rights)h(&r\))f(;)598 1182 y(boolean_t)h(using_cout\(const)i
(off_Rights)e(&r\))f(const;)639 1394 y Fz(The)34 b(implemen)n(tation)g
(sets)g(\015ags)f(whic)n(h)h(is)g(in)g(turn)g(consulted)g(b)n(y)g
(basic)f(console)515 1493 y(output)28 b(routines.)515
1605 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1605 V 29 w(Node)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 1696 y Fi(boolean_t)198 b(n_comredirect;)160
b(//)40 b(Using)g(serial)h(console?)598 1787 y(boolean_t)198
b(n_coutredirect;)121 b(//)40 b(Using)g(OS)g(provided)h(console?)598
1879 y(off_prtl_id_t)h(n_cout;)433 b(//)40 b(portal)g(for)g(OS)g
(output)g(services.)515 2022 y Fk(h)p Fj(Initialize)26
b(other)j(private)g(memb)l(ers)g(of)e Fi(off)p 1854 2022
V 29 w(Node)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598 2114 y
Fi(n_comredirect)42 b(=)d(n_coutredirect)k(=)c(FALSE;)598
2205 y(n_cout)h(=)g(OFF_PRTL_NULL;)639 2336 y Fz(Basic)33
b(system)h(output)g(pro)r(ceeds)f(through)g(the)h(OSKit)f
Fu(C)h Fz(library)e(whic)n(h)i(in)g(turn)515 2436 y(calls)k
Fx(putchar)p Fz(.)67 b(It)40 b(is)e Fx(putchar)e Fz(that)j(redirects)f
(c)n(haracter)f(output)i(to)g(appropriate)515 2536 y(places.)515
2659 y Fk(h)p Fi(putchar)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2750 y Fi(//)39 b(Same)i(of)e(stdio/putchar)598
2842 y(//)598 2933 y(int)79 b(putchar\(int)42 b(c\))598
3024 y({)715 3116 y(if)e(\(!c\))g(return)h(0;)676 3207
y(#if)f(0)589 b(//)39 b(XXX)h(fix)g(this)755 3298 y(if)f
(\(off_Node::initialized\(\))45 b(&&)40 b(nd.using_cout\(\)\){)833
3390 y(char)g(m[2];)833 3481 y(m[0]=\(char\)c;)833 3572
y(m[1]='\\0';)833 3664 y(nd.puts\(m\);)755 3755 y(})755
3846 y(else)g({)676 3938 y(#endif)755 4029 y(direct_cons_putchar\(c\);)
755 4120 y(if)f(\(off_Node::initialized\(\))45 b(&&)40
b(nd.using_serial_console\(\)\))833 4212 y
(off_mdepNode::db_putchar\(c\);)755 4394 y(return)g(c;)598
4577 y(})515 4824 y Fk(h)p Fj(O\013)27 b(b)l(asic)h(c)l(onsole)h
(output)g(dep)l(endencies.)g Fk(i)p Fq(\021)598 4915
y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40 b(for)g
(direct_cons_putchar)598 5006 y(#include)h(<node/Node.h>)395
b(//)40 b(for)g(nd)f(et)h(al.)1885 5255 y Fz(200)p eop
PStoPSsaved restore
%%Page: (202,203) 102
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
201 202 bop 639 523 a Fz(The)35 b(routine)g Fx(direct)p
1380 523 27 4 v 29 w(cons)p 1585 523 V 29 w(putchar)d
Fz(is)j(pro)n(vided)f(b)n(y)h(the)g(OSKit)o(.)59 b(It)35
b(ec)n(ho)r(es)f(a)515 623 y(c)n(haracter)26 b(to)j(the)g(system)f
(console.)38 b Fx(db)p 1815 623 V 31 w(putchar)26 b Fz(the)j(same)f
(job)g(using)g(the)h(serial)f(line)515 722 y(instead.)639
822 y(Besides,)f(more)g(routines)g(\(called)h(b)n(y)f(the)h(OSKit)o(\))
g(need)g(to)g(b)r(e)g(pro)n(vided.)515 938 y Fk(h)p Fi(direct)p
784 938 24 4 v 29 w(cons)p 969 938 V 29 w(puts)h Fj(implementation.)e
Fk(i)p Fq(\021)598 1029 y Fi(int)40 b(puts\(const)h(char)f(*s\))598
1121 y({)676 1212 y(direct_cons_puts\(s\);)676 1303 y(if)g
(\(off_Node::initialized\(\))45 b(&&)39 b
(nd.using_serial_console\(\)\))755 1395 y(off_mdepNode::db_puts\(s\);)
676 1486 y(return)i(0;)598 1577 y(})598 1851 y(//)e(same)i(of)e
(stdio/puts)598 1943 y(//)598 2034 y(int)h(direct_cons_puts\(const)k
(char)c(*s\))598 2125 y({)912 2217 y(assert\(s\);)912
2308 y(while)g(\(*s\))912 2399 y({)1225 2491 y
(direct_cons_putchar\(*s\);)1225 2582 y(s++;)912 2673
y(})912 2765 y(direct_cons_putchar\('\\n'\);)912 2856
y(return)g(0;)598 2947 y(})515 3196 y Fk(h)p Fj(O\013)27
b(b)l(asic)h(c)l(onsole)h(output)g(dep)l(endencies.)g
Fk(i)p Fz(+)o Fq(\021)598 3288 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)639 3429 y Fz(W)-7 b(e)32 b(ha)n(v)n(e)e(use)i
(a)f(new)g(metho)r(d)h Fx(puts)e Fz(pro)n(vided)h(b)n(y)g
Fx(nd)p Fz(.)48 b(It)31 b(simply)h(up)r(calls)f(to)h(the)515
3528 y(user-established)37 b Fx(cout)g Fz(so)h(that)h(it)g(could)g
(prin)n(t)f(the)h(string)f(using)h(the)g(OS)f(console)515
3628 y(driv)n(er.)515 3761 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3761 V 29 w(Node)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 3852 y Fi(//)39 b(Print)i(the)f(string)g(using)h
(the)f(user-provided)i(cout)e(device.)598 3944 y(err_t)g(puts\(const)i
(char)e(*s\);)639 4085 y Fz(This)28 b(metho)r(d)g(is)f(exp)r(orted)h
(to)f(system)g(users.)515 4201 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 4201 V 29 w(uNode)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 4292 y Fi(err_t)40 b(puts\(const)i(char)e(*s,)g
(const)g(off_Rights)i(&r\);)1885 5255 y Fz(201)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
202 203 bop 515 523 a Fk(h)p Fj(Implementation)28 b(of)f(other)i(metho)
l(ds)g(of)e Fi(off)p 1893 523 24 4 v 29 w(Node)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(//)39 b(Prints)i(the)f(string)h
(using)f(the)g(user-provided)i(cout)e(device.)598 706
y(err_t)g(off_Node::puts\(const)k(char)c(*s\))598 797
y({)676 888 y(assert\(valid\(\)\);)676 980 y(assert\(s\);)676
1162 y(if)g(\(n_cout)h(==)e(OFF_PRTL_NULL\){)755 1254
y(w_unlock\(\);)755 1345 y(return)h(ENOPRTL;)676 1436
y(})676 1528 y(else)g({)755 1619 y(static)g(off_PutsReq)i(m;)755
1710 y(err_t)e(r=EOK;)755 1893 y(w_lock\(\);)755 1984
y(m.fill\(s\);)755 2076 y(//)157 b(r=prtl.kdeliver\(n_cout,OFF_SH)q
(TL_N)q(ULL,)46 b(m.size\(\),)41 b(&m,)f(0\);)g(XXX)g(fix)g(it)755
2167 y(w_unlock\(\);)755 2258 y(return)g(r;)676 2350
y(})598 2441 y(})639 2673 y Fz(The)d(message)f(sen)n(t)h(to)g(the)h
(user)e(OS)h Fx(cout)f Fz(handler)g(con)n(tains)h(the)g(string)g(to)g
(b)r(e)515 2773 y(prin)n(ted.)53 b(The)34 b(whole)e(string)h(is)g(send)
g(as)g(a)g(message)e(so)i(that)g(w)n(e)g(do)g(not)g(dep)r(end)h(on)515
2873 y(an)n(y)c(additional)g(user-lev)n(el)f(message)h(serv)n(ers)e
(\(whic)n(h)j(could)g(ha)n(v)n(e)e(b)r(een)i(used)g(to)g(pass)515
2972 y(the)d(message)e(b)n(y)h(reference\).)515 3105
y Fk(h)p Fj(O\013)g(user-kernel)j(messages.)f Fk(i)p
Fz(+)o Fq(\021)598 3196 y Fi(//)39 b(Puts)i(request.)598
3288 y(struct)f(off_PutsReq)i(:)e(off_MsgReq)h({)676
3379 y(natural_t)g(p_nbytes;)676 3470 y(char)f(p_str[OFF_NPUTS_MAX];)
676 3653 y(//)g(Creates)h(a)e(puts)h(request.)676 3744
y(off_PutsReq\(void\))j(:)d(off_MsgReq\(OFF_EX_PUTS\),)k(p_nbytes\(0\))
e({;})676 3927 y(//)e(Fills)g(the)g(message)h(with)f(the)g(given)g
(string.)676 4018 y(err_t)h(fill\(const)g(char)f(*s\);)676
4201 y(//)g(Returns)h(the)f(size)g(of)f(this)i(message.)676
4292 y(vm_size_t)g(size\(void\))h({)755 4384 y(return)e
(sizeof\(off_MsgReq\))k(+)39 b(//)h(for)g(the)g(base)g(class)1029
4475 y(sizeof\(p_nbytes\))122 b(+)39 b(//)h(for)g(p_bytes)1029
4566 y(p_nbytes+p_nbytes\045sizeof\(nat)q(ural)q(_t\);)46
b(//)39 b(for)h(the)g(bytes)h(in)e(p_str)2481 4658 y(//)g(\(rounted)i
(to)f(word)g(size\))676 4749 y(})598 4840 y(};)1885 5255
y Fz(202)p eop
PStoPSsaved restore
%%Page: (204,205) 103
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
203 204 bop 515 523 a Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f
(implementation.)f Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Fills)i(the)f(message)h(with)f(the)g(given)g(string.)598
706 y(err_t)g(off_PutsReq::fill\(const)45 b(char)40 b(*s\))598
797 y({)755 888 y(assert\(s\);)755 980 y(size_t)g(len=strlen\(s\);)755
1071 y(err_t)g(res)g(=)f(EOK;)755 1162 y(if)g(\(len>=OFF_NPUTS_MAX\){)
833 1254 y(len=OFF_NPUTS_MAX-1;)833 1345 y(res=E2BIG;)755
1436 y(})755 1528 y(strncpy\(p_str,s,len\);)755 1619
y(p_str[OFF_NPUTS_MAX-1]='\\0';)755 1710 y(p_nbytes=len+1;)755
1802 y(return)h(res;)598 1893 y(})639 2125 y Fz(There)35
b(is)h(a)f(new)h(system)f(limit:)54 b(the)36 b(maxim)n(um)g(n)n(um)n(b)
r(er)f(of)h(c)n(haracters)d(sen)n(t)j(in)515 2225 y Fx(PutsReq)p
Fz(s.)515 2358 y Fk(h)p Fj(O\013)27 b(limits.)f Fk(i)p
Fz(+)p Fq(\021)598 2449 y Fi(const)40 b(int)g(OFF_NPUTS_MAX)i(=)e(255;)
157 b(//)40 b(Max.)g(number)h(of)f(characters)h(in)f(PutsReq)639
2590 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(in)n(tro)r(duced)g(new)h(dep)r
(endencies)g(whic)n(h)f(m)n(ust)h(b)r(e)g(resolv)n(ed)e(no)n(w.)515
2707 y Fk(h)p Fj(O\013)h(user-kernel)j(messages)f(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 2798 y Fi(#include)41 b(<klib/limits.h>)317
b(//)40 b(for)g(OFF_NPUTS_MAX)598 2889 y(#include)h(<assert.h>)512
b(//)40 b(for)g(assert)598 2980 y(#include)h(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
3072 y(#include)h(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)
g(numbers.)515 3230 y Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f
(implementation)f(dep)l(endencies.)h Fk(i)p Fq(\021)598
3321 y Fi(#include)41 b(<string.h>)512 b(//)40 b(for)g(strncpy.)515
3578 y FA(Basic)32 b(console)e(output)i Fg(C)7 b Fx(++)31
b FA(source)h(\014les)515 3731 y Fz(The)27 b(co)r(de)h(sho)n(wn)f(ab)r
(o)n(v)n(e)f(is)h(k)n(ept)h(in)g Fx(bconio.C)c Fz(with)k
Fu(C)g Fz(link)-5 b(age.)515 3864 y Fk(h)p Fj(b)l(c)l(onio.C*)11
b Fk(i)p Fq(\021)598 3956 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4138 y(h)p Fj(O\013)f(b)l(asic)h(c)l(onsole)h(output)g(dep)l
(endencies.)g Fk(i)598 4321 y Fi(extern)40 b("C")g({)676
4412 y Fk(h)p Fi(putchar)29 b Fj(implementation.)f Fk(i)676
4504 y(h)p Fi(direct)p 945 4504 24 4 v 30 w(cons)p 1131
4504 V 29 w(puts)g Fj(implementation.)g Fk(i)598 4595
y Fi(};)1177 b(//)40 b("C")g(linkage)1885 5255 y Fz(203)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
204 205 bop 515 523 a Fr(3.11)135 b(The)45 b(no)t(de)f(for)i(ix86)f
(based)g(arc)l(hitectures)515 705 y Fz(In)28 b(this)g(section)f(w)n(e)g
(will)h(describ)r(e)f(the)h(implemen)n(tation)g(of)g(mac)n(hine)f(dep)r
(enden)n(t)h(co)r(de)515 805 y(in)g(the)g(no)r(de)f(system)h(serv)n
(er.)639 904 y(A)k(mac)n(hine)f(dep)r(enden)n(t)h(no)r(de,)g
Fx(mdepNode)c Fz(deals)j(arc)n(hitecture)f(sp)r(eci\014cs)h(for)g(no)r
(de)515 1004 y(op)r(eration.)515 1120 y Fk(h)p Fj(O\013)c(machine)h
(dep)l(endent)h(no)l(de.)f Fk(i)p Fq(\021)598 1211 y
Fi(class)40 b(off_mdepNode)i({)598 1303 y(private:)598
1394 y(public:)676 1485 y(//)e(Loads)g(OS)g(modules)h(using)f(loader.)
676 1577 y(void)g(load_mods\(off_ModLoader)45 b(&loader\);)676
1759 y(//)40 b(Halts)g(this)g(node.)676 1851 y(void)g(halt\(void\);)676
2033 y(//)g(Reboots)h(this)f(node.)676 2125 y(void)g(reboot\(void\);)
676 2307 y(//)g(Returns)h(the)f(number)g(of)g(memory/IO/DMA/...)j
(banks.)e(\(for)f(intel/PCs\))676 2399 y(natural_t)h
(get_num_mbanks\(void\))j(const)d({)e(return)i
(off_mdepMBank::how_many\(\);})676 2490 y(natural_t)g
(get_num_iobanks\(void\))j(const)d({)e(return)i
(off_mdepIOBank::how_many\(\);})676 2581 y(natural_t)g
(get_num_procs\(void\))j(const)c({)g(return)g
(off_mdepProcessor::how_many)q(\(\);})676 2764 y(//)g(XXX)g(fix)g(this)
676 2855 y(//)79 b(natural_t)41 b(get_num_dmas\(void\))j(const)c({)g
(return)g(off_mdepDMA::how_many\(\);})676 3038 y(//)g(Returns)h
(machine)g(dependent)g(information)h(about)e(the)g(memory/IO/DMA/...)j
(bank)d(#n)676 3129 y(off_mdepMBank)199 b(get_minfo\(natural_t)44
b(n\))c(const;)676 3220 y(off_mdepIOBank)160 b(get_ioinfo\(natural_t)44
b(n\))c(const;)676 3312 y(off_mdepProcessor)j(get_procinfo\(natural_t)i
(n\))39 b(const;)676 3403 y(off_mdepShtlSrv)121 b(get_shtlinfo\(void\))
44 b(const;)676 3494 y(off_mdepDMM)277 b(get_dmminfo\(void\))43
b(const;)676 3586 y(off_mdepPrtlSrv)g(get_prtlinfo\(void\))g(const;)676
3677 y(//)d(off_mdepDMA)159 b(get_dmainfo\(natural_t)44
b(n\))c(const;)80 b(XXX)40 b(fix)g(it)676 3860 y(//)g(Starts)g
(serial-line)i(debugging.)676 3951 y(void)e(start_dbserial\(void\);)676
4042 y(//)g(Terminates)h(debugging.)676 4134 y(void)f
(stop_dbserial\(int)j(rc\);)676 4225 y(//)d(Sets)g(a)f(breakpoint)j
(for)e(serial-line)i(debugging.)676 4316 y(static)f(void)f
(db_break\(void\);)676 4408 y(//)g(Sends)g(a)g(character)h(to)f(the)g
(debugger)676 4499 y(static)h(void)f(db_putchar\()i(int)e(ch\);)676
4590 y(//)g(Sends)g(a)g(string)g(to)g(the)g(debugger)676
4682 y(static)h(void)f(db_puts\(const)i(char)e(*s\);)598
4773 y(};)1885 5255 y Fz(204)p eop
PStoPSsaved restore
%%Page: (206,207) 104
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
205 206 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(no)
l(de)g(dep)l(endencies.)g Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<node/mod.h>)434 b(//)40 b(for)g(off_ModLoader)598
706 y(#include)h(<hw/mdep/mMBank.h>)200 b(//)40 b(for)g(off_mdepMBank)
598 797 y(#include)h(<hw/mdep/mIOBank.h>)161 b(//)40
b(for)g(off_mdepIOBank)598 888 y(#include)h(<hw/mdep/mProcessor.h>)j
(//)c(for)g(off_mdepProcessor)598 980 y(#include)h
(<shtl/mdep/mShtlSrv.h>)j(//)c(for)g(off_mdepShtlSrv)598
1071 y(#include)h(<prtl/mdep/mPrtlSrv.h>)j(//)c(for)g(off_mdepPrtlSrv)
598 1162 y(#include)h(<dmm/mdep/mDMM.h>)239 b(//)40 b(for)g
(off_mdepDMM)515 1436 y Fn(3.11.1)112 b(Mac)m(hine)38
b(dep)s(enden)m(t)h(no)s(de)f Fd(C)8 b FC(++)38 b Fn(source)f(\014les)
515 1589 y Fz(Mac)n(hine)18 b(dep)r(enden)n(t)h(no)r(de)f(co)r(de)g(is)
h(k)n(ept)f(in)g Fx(node/mdep/mNode.h)12 b Fz(and)18
b Fx(node/mdep/mNode.)o(C)p Fz(.)515 1722 y Fk(h)p Fj(mdep)27
b(mNo)l(de.h*)11 b Fk(i)q Fq(\021)598 1814 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 1905 y Fi(#ifndef)41 b(__OFF_MDEP_NODE_H)598
1996 y(#define)g(__OFF_MDEP_NODE_H)i(1)598 2179 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(no)l(de)g(dep)l(endencies.)g
Fk(i)598 2362 y Fi(#ifdef)40 b(__KERNEL__)598 2453 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(no)l(de.)f
Fk(i)598 2544 y(h)p Fj(O\013)f(pr)l(e-)p Fi(main)j Fj(initialization)c
(r)l(outine.)j Fk(i)598 2636 y Fi(#endif)40 b(//)g(__KERNEL__)598
2818 y(#endif)g(//)g(__OFF_MDEP_NODE_H)515 2993 y Fk(h)p
Fj(mdep)27 b(mNo)l(de.C*)11 b Fk(i)q Fq(\021)598 3084
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 3267 y Fi(#include)41 b(<node/mdep/mNode.h>)
200 b(//)40 b(Exported)h(interface.)598 3358 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(no)l(de)g(implementation)f(dep)l
(endencies.)h Fk(i)598 3540 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(no)l(de)g(glob)l(al)f(variables.)g Fk(i)598 3723 y(h)p
Fi(off)p 750 3723 24 4 v 29 w(mdepNode::load)p 1325 3723
V 31 w(mods)g Fj(implementation.)g Fk(i)598 3814 y(h)p
Fi(off)p 750 3814 V 29 w(mdepNode::halt)i Fj(implementation.)e
Fk(i)598 3906 y(h)p Fi(off)p 750 3906 V 29 w(mdepNode::reboot)j
Fj(implementation.)c Fk(i)598 3997 y(h)p Fi(off)p 750
3997 V 29 w(mdepNode::get)p 1286 3997 V 31 w(minfo)h
Fj(implementation.)g Fk(i)598 4088 y(h)p Fi(off)p 750
4088 V 29 w(mdepNode::get)p 1286 4088 V 31 w(ioinfo)h
Fj(implementation.)e Fk(i)598 4180 y(h)p Fi(off)p 750
4180 V 29 w(mdepNode::get)p 1286 4180 V 31 w(dmainfo)i
Fj(implementation.)e Fk(i)598 4271 y(h)p Fi(off)p 750
4271 V 29 w(mdepNode::get)p 1286 4271 V 31 w(procinfo)i
Fj(implementation.)e Fk(i)598 4362 y(h)p Fi(off)p 750
4362 V 29 w(mdepNode::get)p 1286 4362 V 31 w(shtlinfo)i
Fj(implementation.)e Fk(i)598 4454 y(h)p Fi(off)p 750
4454 V 29 w(mdepNode::get)p 1286 4454 V 31 w(prtlinfo)i
Fj(implementation.)e Fk(i)598 4545 y(h)p Fi(off)p 750
4545 V 29 w(mdepNode::start)p 1364 4545 V 31 w(dbserial)i
Fj(implementation.)f Fk(i)598 4636 y(h)p Fi(off)p 750
4636 V 29 w(mdepNode::stop)p 1325 4636 V 31 w(dbserial)h
Fj(implementation.)f Fk(i)598 4728 y(h)p Fi(off)p 750
4728 V 29 w(mdepNode::db)p 1247 4728 V 31 w(break)g(db)p
1579 4728 V 29 w(putchar)h Fj(and)f Fi(db)p 2137 4728
V 29 w(puts)g Fj(implementation.)f Fk(i)598 4819 y(h)p
Fi(off)p 750 4819 V 29 w(mdepNode::get)p 1286 4819 V
31 w(dmminfo)i Fj(implementation.)e Fk(i)598 4910 y(h)p
Fj(O\013)g(pr)l(e-)p Fi(main)j Fj(initialization)c(r)l(outine)j
(implementation.)f Fk(i)1885 5255 y Fz(205)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
206 207 bop 515 523 a Fn(3.11.2)112 b(System)37 b(halt)g(and)i(reb)s(o)
s(ot)515 676 y Fz(W)-7 b(e)28 b(m)n(ust)f(implemen)n(t)i(the)f(mac)n
(hine)f(dep)r(enden)n(t)h(routine)f(used)h(to)f(halt)h(the)g(system.)
515 793 y Fk(h)p Fi(off)p 667 793 24 4 v 29 w(mdepNode::halt)i
Fj(implementation.)e Fk(i)o Fq(\021)598 884 y Fi(//)39
b(Halts)i(this)f(node.)598 975 y(void)g(off_mdepNode::halt\(void\))598
1066 y({)715 1158 y Fk(h)p Fj(O\013)28 b(machine)f(dep)l(endent)j(no)l
(de)e(halt.)g Fk(i)598 1249 y Fi(})639 1465 y Fz(It)g(tries)f(to)h
(halt)g(the)g(pro)r(cessor)d(and)i(\(when)h(unable)g(to)f(do)h(so\))f
(lo)r(ops)g(forev)n(er.)515 1581 y Fk(h)p Fj(O\013)g(machine)h(dep)l
(endent)h(no)l(de)g(halt.)e Fk(i)p Fq(\021)598 1673 y
Fi(off_Processor::halt\(\);)598 1764 y(off_Processor::clri\(\);)598
1855 y(for\(;;\))676 1947 y(off_Processor::clri\(\);)598
2038 y(panic\("halt)41 b(failed"\);)515 2196 y Fk(h)p
Fi(off)p 667 2196 V 29 w(mdepNode::reboot)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 2287 y Fi(//)39 b(Reboots)i(this)f(node.)598
2378 y(void)g(off_mdepNode::reboot\(void\))598 2470 y({)676
2561 y(pc_reset\(\);)598 2652 y(})515 2918 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(no)l(de)g(implementation)f(dep)l(endencies.)
h Fk(i)p Fq(\021)598 3009 y Fi(#include)41 b(<flux/debug.h>)199
b(//)40 b(for)g(panic)598 3101 y(#include)h(<hw/Processor.h>)121
b(//)40 b(for)g(clri,seti,has_clri)j(et)d(al.)598 3192
y(#include)h(<flux/machine/pc/reset.h>)84 b(//)40 b(for)g(pc_reset)639
3333 y Fz(A)21 b(default)p 1000 3333 27 4 v 53 w Fx(exit)e
Fz(routine)h(m)n(ust)h(b)r(e)g(also)e(implemen)n(ted)j(for)e(the)h
(in-k)n(ernel)f Fu(C)g Fz(library)-7 b(.)515 3433 y(It)28
b(m)n(ust)f(ha)n(v)n(e)g(\\)p Fu(C)o Fz(")g(link)-5 b(age.)515
3565 y Fk(h)p 550 3565 24 4 v 28 w Fi(exit)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 3657 y Fi(//)39 b(Terminates)j(the)e(kernel.)598
3748 y(//)598 3839 y(extern)g(void)g(_exit\(int)i(rc\))598
3931 y({)676 4022 y(off_Processor::clri\(\);)676 4113
y(printf\("exit)g(with)e(code)g(\045d)g(--)g(System)g
(halted.\\n",rc\);)676 4296 y(gdb_serial_exit\(0\);)676
4387 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)i(no)l(de)e(halt.)g
Fk(i)598 4479 y Fi(})1885 5255 y Fz(206)p eop
PStoPSsaved restore
%%Page: (208,209) 105
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
207 208 bop 639 523 a Fz(It)28 b(is)g(included)g(on)f(its)h(o)n(wn)f
(in)h Fx(exit.C)p Fz(.)515 639 y Fk(h)p Fj(mdep)f(exit.C*)11
b Fk(i)q Fq(\021)598 731 y Fi(#include)41 b(<stdio.h>)598
822 y(#include)g(<klib/str.h>)434 b(//)40 b(for)g(kcout)598
913 y(#include)h(<flux/gdb_serial.h>)161 b(//)40 b(OSKit)g(gdb)g
(support)598 1005 y(#include)h(<flux/gdb.h>)434 b(//)40
b(OSKit)g(gdb)g(support)598 1096 y(#include)h(<flux/debug.h>)356
b(//)40 b(for)g(panic)598 1187 y(#include)h(<hw/Processor.h>)121
b(//)40 b(for)g(clri,)g(seti,)g(halt)h(et)e(al.)598 1370
y(extern)h("C")g({)676 1644 y Fk(h)p 711 1644 24 4 v
28 w Fi(exit)29 b Fj(implementation.)e Fk(i)598 1735
y Fi(};)1177 b(//)40 b(C)f(linkage)515 1992 y Fn(3.11.3)112
b(OS)38 b(mo)s(dules)f(startup)515 2146 y Fz(The)43 b(mo)r(dule)g
(information)f(is)g(k)n(ept)h(in)g(the)g Fx(boot)p 2223
2146 27 4 v 30 w(info)e Fz(structure)i(b)n(y)f(the)h(OSKit.)515
2245 y(Among)28 b(other)g(things,)h(suc)n(h)f(structure)g(con)n(tains)f
(the)i(ph)n(ysical)f(address)f(the)i(informa-)515 2345
y(tion)e(for)g(eac)n(h)g(mo)r(dule)g(can)g(b)r(e)h(found)g(at)f(\()p
Fx(mods)p 2103 2345 V 30 w(addr)p Fz(\),)g(a)g(\015ag)f(set)i(when)f
(an)n(y)g(mo)r(dule)515 2445 y(has)33 b(b)r(een)i(loaded)f(\()p
Fx(MULTIBOOT)p 1575 2445 V 27 w(MODS)p Fz(,)f(set)h(in)h
Fx(flags)p Fz(\))d(and)i(the)h(n)n(um)n(b)r(er)f(of)g(mo)r(dules)515
2544 y(\()p Fx(mods)p 728 2544 V 30 w(count)p Fz(\).)515
2677 y Fk(h)p Fi(off)p 667 2677 24 4 v 29 w(mdepNode::load)p
1242 2677 V 31 w(mods)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 2768 y Fi(//)39 b(Loads)i(OS)e(modules)i(using)g(loader.)
598 2860 y(void)f(off_mdepNode::load_mods\(off_Mo)q(dLoa)q(der)46
b(&loader\))598 2951 y({)715 3042 y(natural_t)c(i;)715
3134 y(struct)f(multiboot_module)i(*m)d(=)f(\(struct)i
(multiboot_module*\))1892 3225 y(phystokv\(boot_info.mods_addr)q(\);)
715 3408 y(if)f(\(!\(boot_info.flags)j(&)d(MULTIBOOT_MODS\)\))794
3499 y(panic\("node:)i(no)e(OS)f(boot)h(modules)h(to)f(run.)g(Is)g
(this)g(a)f(demo?"\);)715 3682 y(for)h(\(i)g(=)f(0;)h(i)g(<)f
(boot_info.mods_count;)44 b(i++\){)794 3773 y(off_mdepModule)e
(mod\(m+i\);)794 3864 y(if)e(\(loader.load\(mod\)\))j({)872
3956 y(kcout)e(<<)e("node:)i(boot)f(module)h(could)f(not)g(be)g
(started.")h(<<)f(nl;)794 4047 y(})715 4138 y(})598 4230
y(})639 4462 y Fz(W)-7 b(e)28 b(dep)r(end)h(no)n(w)d(in)i(the)g(OSKit)g
(m)n(ultib)r(o)r(ot)g(implemen)n(tation.)515 4578 y Fk(h)p
Fj(O\013)f(machine)h(dep)l(endent)h(no)l(de)g(implementation)f(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 4670 y Fi(#include)41
b(<flux/machine/multiboot.h>)280 b(//)40 b(for)79 b(multiboot_info)598
4761 y(#include)41 b(<flux/machine/pc/base_multiboo)q(t.h>)85
b(//)40 b(for)79 b(boot_info)1885 5255 y Fz(207)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
208 209 bop 639 523 a Fz(W)-7 b(e)43 b(ha)n(v)n(e)f(also)f(used)i
Fx(phystokv)c Fz(to)j(translate)g(the)h(ph)n(ysical)f(address)f(found)i
(in)515 623 y Fx(mods)p 696 623 27 4 v 29 w(addr)26 b
Fz(to)i(a)f(k)n(ernel)g(virtual)g(address.)515 739 y
Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(no)l(de)g(implementation)f
(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 830 y Fi(#include)41
b(<flux/machine/base_vm.h>)84 b(//)39 b(for)h(phystokv)515
1071 y FA(The)32 b(mo)s(dule)d(loader)515 1224 y Fz(The)24
b(mac)n(hine)g(dep)r(enden)n(t)g(mo)r(dule)h(loader)d(de\014nes)j(a)e
(data)h(t)n(yp)r(e)g(to)g(k)n(eep)g(b)r(o)r(ot)g(mo)r(dule)515
1324 y(information.)515 1440 y Fk(h)p Fj(O\013)j(machine)h(dep)l
(endent)h(mo)l(dule.)f Fk(i)p Fq(\021)598 1531 y Fi(//)39
b(OS)h(module)h(info.)598 1623 y(//)598 1714 y(class)f(off_mdepModule)j
({)598 1805 y(public:)676 1897 y(struct)e(multiboot_module)i(*m_minfo;)
e(//)f(Multiboot)h(module)f(information.)676 1988 y(off_DTLB)630
b(*m_dtlbp;)676 2079 y(//)40 b(Creates)h(an)e(off_mdepModule)676
2171 y(off_mdepModule\(struct)44 b(multiboot_module)f(*minfo=NULL\))f
(:)d(m_minfo\(minfo\))k({})676 2353 y(//)d(Returns)h(the)f(argument)h
(string)f(for)g(this)g(module.)676 2445 y(char)g(*argl\(void\))i(const)
e({)g(return)g(\(char*\)m_minfo->string;)45 b(})676 2627
y(//)40 b(Converts)h(the)f(module)g(into)h(a)e(runnable)i(image)f(in)g
(the)g(given)g(domain.)676 2719 y(err_t)h(set_image\(off_DTLB)i
(*dtlb\);)598 2810 y(};)639 3026 y Fz(As)28 b(w)n(e)f(can)g(see,)h(it)g
(dep)r(ends)g(on)f(the)h(m)n(ultib)r(o)r(ot)g(mo)r(dule)g(information.)
515 3142 y Fk(h)p Fj(O\013)f(machine)h(dep)l(endent)h(mo)l(dule)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 3233 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 3325 y(#include)h(<klib/err.h>)598 3416 y(#include)g
(<flux/machine/multiboot.h>)k(//)40 b(For)g(multiboot_module)i(et)e
(al.)598 3507 y(class)g(off_DTLB;)1885 5255 y Fz(208)p
eop
PStoPSsaved restore
%%Page: (210,211) 106
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
209 210 bop 639 523 a Fz(It)42 b(also)e(kno)n(ws)g(ho)n(w)g(to)h(load)g
(the)g(mo)r(dule)h(image)e(in)n(to)h(a)f(sp)r(eci\014ed)i(protection)
515 623 y(domain)27 b(to)g(set)h(it)g(up)g(for)f(execution.)37
b(W)-7 b(e)28 b(use)f(the)h(OSKit)f(for)g(that.)515 746
y Fk(h)p Fi(off)p 667 746 24 4 v 29 w(mdepModule::set)p
1281 746 V 31 w(image)i Fj(implementation.)e Fk(i)p Fq(\021)598
838 y Fi(//)39 b(Converts)i(the)f(module)h(into)f(a)g(runnable)h(image)
f(in)g(the)g(given)g(domain.)598 929 y(err_t)g
(off_mdepModule::set_image\(off)q(_DTL)q(B)45 b(*dtlb\))598
1020 y({)676 1112 y(err_t)c(err;)676 1203 y(exec_info_t)h(ei;)676
1386 y(m_dtlbp=dtlb;)676 1477 y(if)e(\(\(err=exec_load\(off_mdep_mread)
q(CB,o)q(ff_m)q(dep_m)q(exec)q(CB,\(v)q(oid*)q(\)thi)q(s,&ei)q(\)\)!=)q
(0\){)755 1568 y(kcout)g(<<)g("Failed)h(to)e(load)h(module)h(")e(<<)h
(fmt\("\(0x\045x\)",err\))j(<<)d(nl;)755 1660 y(return)g(err;)676
1751 y(})598 2025 y(})515 2181 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l
(endent)h(mo)l(dule)f(implementation)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2272 y Fi(#include)41 b(<flux/exec/exec.h>)200
b(//)40 b(for)g(exec_*_t,)h(and)f(exec_load)598 2363
y(#include)h(<dmm/DMM.h>)598 2455 y(#include)g(<dmm/DTLB.h>)277
b(//)40 b(for)g(off_DTLB)598 2546 y(#include)h(<klib/str.h>)598
2637 y(#include)g(<hw/MBank.h>)598 2729 y(#include)g
(<klib/mdep/debug.h>)161 b(//)40 b(for)g(otsan)g(et)g(al.)639
2861 y Fz(There)26 b(are)f(t)n(w)n(o)h(functions)h(used)f(as)g(callbac)
n(ks)e(b)n(y)j Fx(exec)p 2462 2861 27 4 v 29 w(load)p
Fz(.)35 b(They)26 b(are)g(called)g(as)515 2960 y(the)i(OSKit)f(deco)r
(des)g(ELF:)h Fx(off)p 1574 2960 V 30 w(mdep)p 1780 2960
V 29 w(mreadCB)d Fz(and)j Fx(off)p 2436 2960 V 30 w(mdep)p
2642 2960 V 29 w(mexecCB)p Fz(.)639 3060 y(The)42 b(\014rst)g(one)g
(acts)g(as)f(a)h(\014le)g(reader,)j(supplying)d(b)n(ytes)f(from)h(the)h
(mo)r(dule)f(to)515 3159 y Fx(exec)p 696 3159 V 29 w(load)p
Fz(.)515 3271 y Fk(h)p Fi(exec)p 706 3271 24 4 v 29 w(load)28
b Fj(help)l(er)h(functions.)e Fk(i)p Fq(\021)598 3362
y Fi(static)40 b(int)g(off_mdep_mreadCB\(void)k(*handle,)d(vm_offset_t)
h(file_ofs,)1696 3454 y(void)e(*buf,)h(vm_size_t)g(size,)f(vm_size_t)i
(*out_actual\))598 3545 y({)676 3636 y(off_mdepModule)h
(*m=\(off_mdepModule*\)handle;)676 3728 y(char)d(*base)h(=)e
(\(char*\)phystokv\(m->m_minfo->)q(mod_s)q(tart)q(\);)676
3819 y(char)h(*max)80 b(=)39 b(\(char*\)phystokv\(m->m_minfo->)q(mod_e)
q(nd\);)676 3910 y(vm_size_t)i(limit=)g(max-base;)676
4093 y(assert\(out_actual\);)676 4184 y(*out_actual=size;)676
4276 y(if)f(\(file_ofs>limit\))755 4367 y(*out_actual=0;)676
4458 y(else)g(if)g(\(file_ofs+size>limit+1\))755 4550
y(*out_actual=limit-file_ofs+1;)676 4641 y(if)g(\(*out_actual\))755
4732 y(memcpy\(buf,base+file_ofs,*out_a)q(ctua)q(l\);)676
4824 y(return)h(0;)598 4915 y(})1885 5255 y Fz(209)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
210 211 bop 639 523 a Fz(The)26 b(second)e(one)h(acts)g(as)g(a)f
(virtual)h(memory)g(loader,)f(\014lling)h(the)h(domain)f(with)h(the)515
623 y(b)n(ytes)h(giv)n(en)g(b)n(y)g Fx(exec)p 1245 623
27 4 v 30 w(load)p Fz(.)515 739 y Fk(h)p Fi(exec)p 706
739 24 4 v 29 w(load)h Fj(help)l(er)h(functions.)e Fk(i)p
Fz(+)p Fq(\021)598 830 y Fi(static)40 b(int)g(off_mdep_mexecCB\(void)k
(*handle,)1696 922 y(vm_offset_t)e(file_ofs,)f(vm_size_t)g(file_size,)
1696 1013 y(vm_offset_t)h(mem_addr,)f(vm_size_t)g(mem_size,)1696
1104 y(exec_sectype_t)82 b(section_type\))598 1196 y({)676
1287 y(off_mdepModule)43 b(*m=\(off_mdepModule*\)handle;)676
1378 y(vm_offset_t)f(pg;)676 1469 y(off_mod_t)f(mode;)676
1743 y(if)f(\()f(\(section_type&\(EXEC_SECTYPE_)q(ALLO)q(C|EX)q(EC_SE)q
(CTYP)q(E_LOA)q(D\)\))46 b(!=)872 1835 y(\(EXEC_SECTYPE_ALLOC|EXEC_SEC)
q(TYPE)q(_LOA)q(D\)\))755 1926 y(return)40 b(ENOSYS;)676
2017 y(mode=OFF_MOD_R)j(|)c(OFF_MOD_U)i(|\(\(section_type&EXEC_SECTYPE)
q(_WRI)q(TE\)?)q(OFF_M)q(OD_W)q(:0\);)676 2200 y(if)f
(\(!\(pg=map_zrange\(m->m_dtlbp,me)q(m_ad)q(dr,m)q(em_si)q(ze,m)q
(ode\)\))q(\))755 2291 y(return)g(ENOMEM;)676 2474 y(//)g(Note:)g(this)
g(depends)h(on)f(map_zrange)h(allocating)h(contiguous)f(memory)676
2565 y(//)275 b(and)40 b(also)g(on)g(that)g(memory)h(being)f(zero)g
(filled.)676 2657 y(//)676 2839 y(memcpy\(\(char*\)pg,)951
2931 y(\(\(char*\)phystokv\(m->m_minfo->m)q(od_s)q(tart\))q(\)+fi)q
(le_of)q(s,)45 b(file_size\);)676 3022 y(return)c(0;)598
3113 y(})1885 5255 y Fz(210)p eop
PStoPSsaved restore
%%Page: (212,213) 107
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
211 212 bop 639 523 a Fz(W)-7 b(e)28 b(m)n(ust)g(still)g(implemen)n(t)g
Fx(map)p 1695 523 27 4 v 30 w(zrange)p Fz(.)515 656 y
Fk(h)p Fi(exec)p 706 656 24 4 v 29 w(load)g Fj(auxiliary)g(help)l(er)g
(functions.)g Fk(i)p Fq(\021)598 747 y Fi(static)40 b(vm_offset_t)i
(map_zrange\(off_DTLB)i(*dtlb,)1775 839 y(vm_offset_t)d(uva,)f
(vm_size_t)i(size,)e(off_mod_t)h(mode\))598 930 y({)676
1021 y(natural_t)g(np,saved_np;)676 1112 y(vm_offset_t)h
(pg,last_pg,pg0=0;)676 1204 y(vm_offset_t)g
(off=uva&off_MBank::pmask\(\);)676 1386 y(size+=)f
(\(uva&off_MBank::pmask\(\)\);)k(//)39 b(count)i(also)f(any)g(unused)g
(initial)h(bytes)676 1478 y(uva=)f(trunc_page\(uva\);)514
b(//)40 b(shift)g(down)g(uva)g(to)g(page)g(boundary)676
1660 y(saved_np=np=off_MBank::a2p\(o)q(ff_MB)q(ank:)q(:pro)q(und\(s)q
(ize\))q(\);)676 1843 y(pg0=pg=last_pg=kvm.raw_pg_al)q(loc\(\))q(;)676
1934 y(if)g(\(!pg0\))755 2026 y(return)g(0;)676 2117
y(while\(--np>0\){)755 2208 y(last_pg=pg;)755 2300 y(if)f
(\(!\(pg=kvm.raw_pg_alloc\(\)\)\))833 2391 y(return)i(0;)755
2482 y(assert\(pg=last_pg+off_MBank::ge)q(t_pg)q(size)q(\(\)\);)676
2574 y(})676 2665 y(memset\(\(void*\)off_DMM::phys2)q(kv\(pg)q(0\),0)q
(,sav)q(ed_np)q(*off)q(_MBan)q(k::g)q(et_p)q(gsize)q(\(\)\);)676
2756 y(dtlb->map\(uva,pg0,saved_np*o)q(ff_MB)q(ank:)q(:get)q(_pgsi)q
(ze\(\))q(,mode)q(\);)676 2848 y(return)g(pg0+off;)598
2939 y(})515 3205 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(mo)l
(dule)f(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p
Fq(\021)598 3296 y Fi(#include)41 b(<klib/ids.h>)598
3387 y(#include)g(<assert.h>)598 3479 y(#include)g(<dmm/KVM.h>)598
3570 y(#include)g(<stdio.h>)598 3661 y(#include)g(<string.h>)1885
5255 y Fz(211)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
212 213 bop 515 523 a FA(OS)31 b(mo)s(dules)e(startup)k
Fg(C)7 b Fx(++)30 b FA(source)i(\014les)515 676 y Fz(The)27
b(mac)n(hine)h(dep)r(enden)n(t)g(mo)r(dule)g(loader)e(co)r(de)h(is)h(k)
n(ept)f(in)h Fx(node/mdep/mmod.h)p Fz(.)515 809 y Fk(h)p
Fj(mdep)f(mmo)l(d.h*)11 b Fk(i)p Fq(\021)598 900 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_MDEP_MOD_H)598
1083 y(#define)g(__OFF_MDEP_MOD_H)h(1)598 1266 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(mo)l(dule)f(dep)l(endencies.)h
Fk(i)598 1448 y Fi(#ifdef)40 b(__KERNEL__)598 1540 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(mo)l(dule.)f
Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598 1814
y(#endif)g(//)g(__OFF_MDEP_MOD_H)515 1988 y Fk(h)p Fj(mdep)27
b(mmo)l(d.C*)11 b Fk(i)p Fq(\021)598 2079 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2262 y Fi(#include)41 b(<node/mdep/mmod.h>)200
b(//)40 b(exported)h(interface.)598 2353 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(mo)l(dule)f(implementation)g(dep)l
(endencies.)h Fk(i)598 2536 y(h)p Fi(exec)p 789 2536
24 4 v 29 w(load)f Fj(auxiliary)g(help)l(er)g(functions.)g
Fk(i)598 2627 y(h)p Fi(exec)p 789 2627 V 29 w(load)g
Fj(help)l(er)h(functions.)e Fk(i)598 2719 y(h)p Fi(off)p
750 2719 V 29 w(mdepModule::set)p 1364 2719 V 31 w(image)i
Fj(implementation.)e Fk(i)515 3084 y Fn(3.11.4)112 b(Getting)36
b(ph)m(ysical)h(resources)h(b)s(o)s(ot)f(time)f(information)515
3237 y FA(Memory)30 b(banks)515 3390 y Fz(T)-7 b(o)24
b(get)g(installed)g(memory)g(bank)g(information)f(w)n(e)h(rely)g(on)g
(mac)n(hine)g(dep)r(enden)n(t)h(mem-)515 3490 y(ory)h(banks.)515
3623 y Fk(h)p Fi(off)p 667 3623 V 29 w(mdepNode::get)p
1203 3623 V 31 w(minfo)i Fj(implementation.)g Fk(i)p
Fq(\021)598 3714 y Fi(//)39 b(Returns)i(machine)g(dependent)g
(information)h(about)e(the)g(memory)h(bank)f(#n)598 3805
y(off_mdepMBank)i(off_mdepNode::get_minfo\(natur)q(al_t)k(n\))39
b(const)598 3897 y({)676 3988 y(return)i(off_mdepMBank\(n\);)598
4079 y(})1885 5255 y Fz(212)p eop
PStoPSsaved restore
%%Page: (214,215) 108
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
213 214 bop 515 523 a FA(IO)31 b(banks)515 676 y Fz(On)c(In)n(tels)h(w)
n(e)f(will)h(pro)n(vide)e(an)h(unique)h(IO)f(bank.)515
809 y Fk(h)p Fi(off)p 667 809 24 4 v 29 w(mdepNode::get)p
1203 809 V 31 w(ioinfo)i Fj(implementation.)e Fk(i)p
Fq(\021)598 900 y Fi(off_mdepIOBank)42 b(off_mdepNode::get_ioinfo\(nat)
q(ural_)q(t)j(n\))40 b(const)598 992 y({)676 1083 y(return)h
(off_mdepIOBank\(n\);)598 1174 y(})515 1523 y FA(Pro)s(cessors)515
1676 y Fz(W)-7 b(e)24 b(ask)f(to)g(the)i(mac)n(hine)e(dep)r(enden)n(t)h
(pro)r(cessor)e(implemen)n(tation)i(for)f(pro)r(cessor)f(infor-)515
1776 y(mation.)515 1909 y Fk(h)p Fi(off)p 667 1909 V
29 w(mdepNode::get)p 1203 1909 V 31 w(procinfo)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 2000 y Fi(//)39 b(Returns)i(machine)g(dependent)g
(information)h(about)e(the)g(memory)h(bank)f(#n)598 2091
y(off_mdepProcessor)j(off_mdepNode::get_procinfo\(nat)q(ural)q(_t)i
(n\))40 b(const)598 2183 y({)676 2274 y(return)h
(off_mdepProcessor\(n\);)598 2365 y(})515 2714 y FA(DMAs)722
2867 y(NOTE:)27 b Fz(mo)n(v)n(e)g(this)g(to)h(dma.n)n(w)639
3050 y(On)g(In)n(tels)f(w)n(e)g(include)h(a)f(single)h(DMA)g(table)g
(with)g(sev)n(eral)e(DMA)i(lines.)515 3183 y Fk(h)p Fi(off)p
667 3183 V 29 w(mdepNode::get)p 1203 3183 V 31 w(dmainfo)h
Fj(implementation.)e Fk(i)p Fq(\021)598 3365 y Fi(#if)40
b(0)588 b(//)40 b(XXX)g(fix)g(it)598 3548 y(//)f(Returns)i(machine)g
(dependent)g(information)h(about)e(the)g(DMA)g(bank)g(#n)598
3639 y(off_mdepDMA)159 b(off_mdepNode::get_dmainfo\(na)q(tural)q(_t)45
b(n\))40 b(const)598 3731 y({)676 3822 y(static)h(off_mdepDMA)h(d;)676
3913 y(switch\(n\){)676 4005 y(case)e(0:)755 4096 y(d.d_first=0;)755
4187 y(d.d_last=32;)755 4279 y(d.d_mat=128;)755 4370
y(break;)676 4461 y(default:)755 4553 y(d.d_first=d.d_last=0;)676
4644 y(})676 4735 y(return)h(d;)598 4827 y(})598 4918
y(#endif)1885 5255 y Fz(213)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
214 215 bop 515 523 a FA(Sh)m(uttles)515 668 y Fk(h)p
Fi(off)p 667 668 24 4 v 29 w(mdepNode::get)p 1203 668
V 31 w(shtlinfo)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
759 y Fi(//)39 b(Returns)i(machine)g(dependent)g(information)h(about)e
(the)g(shuttle)h(server.)598 851 y(off_mdepShtlSrv)82
b(off_mdepNode::get_shtlinfo\(void)q(\))45 b(const)598
942 y({)676 1033 y(return)c(off_mdepShtlSrv\(\);)598
1125 y(})515 1473 y FA(P)m(ortals)515 1618 y Fk(h)p Fi(off)p
667 1618 V 29 w(mdepNode::get)p 1203 1618 V 31 w(prtlinfo)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 1710 y Fi(//)39
b(Returns)i(machine)g(dependent)g(information)h(about)e(the)g(portal)h
(server.)598 1801 y(off_mdepPrtlSrv)82 b
(off_mdepNode::get_prtlinfo\(void)q(\))45 b(const)598
1892 y({)676 1983 y(return)c(off_mdepPrtlSrv\(\);)598
2075 y(})515 2423 y FA(DMM)515 2568 y Fk(h)p Fi(off)p
667 2568 V 29 w(mdepNode::get)p 1203 2568 V 31 w(dmminfo)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 2660 y Fi(//)39
b(Returns)i(machine)g(dependent)g(information)h(about)e(the)g(DMM.)598
2751 y(off_mdepDMM)81 b(off_mdepNode::get_dmminfo\(void)q(\))45
b(const)598 2842 y({)676 2934 y(return)c(off_mdepDMM\(\);)598
3025 y(})515 3390 y Fn(3.11.5)112 b(Serial)37 b(line)f(debugging)515
3543 y Fz(W)-7 b(e)39 b(pro)n(vide)e Fx(start)p 1200
3543 27 4 v 29 w(dbserial)f Fz(whic)n(h)i(starts)g(a)g(serial)g(line)g
(debugger)g(and)g(sets)g(an)515 3643 y(immediate)28 b(breakp)r(oin)n
(t.)515 3759 y Fk(h)p Fi(off)p 667 3759 24 4 v 29 w(mdepNode::start)p
1281 3759 V 31 w(dbserial)h Fj(implementation.)f Fk(i)p
Fq(\021)598 3851 y Fi(//)39 b(Starts)i(serial-line)h(debugging.)598
3942 y(void)e(off_mdepNode::start_dbserial\(v)q(oid\))598
4033 y({)676 4125 y(gdb_pc_com_init\(1,0\);)676 4216
y(n_debugging=TRUE;)676 4307 y(gdb_breakpoint\(\);)598
4490 y(})1885 5255 y Fz(214)p eop
PStoPSsaved restore
%%Page: (216,217) 109
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
215 216 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepNode::stop)p 1242 523 V 31 w(dbserial)29 b Fj(implementation.)
f Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Terminates)j(debugging.)598
706 y(void)e(off_mdepNode::stop_dbserial\(in)q(t)45 b(rc\))598
797 y({)833 888 y(gdb_serial_exit\(rc\);)598 980 y(})639
1212 y Fz(Breakp)r(oin)n(ts)29 b(are)g(only)h(allo)n(w)n(ed)f(when)i
(debugging)e(and)h(after)g(the)h(no)r(de)f(has)g(b)r(een)515
1312 y(initialized.)37 b(W)-7 b(e)28 b(use)f Fx(n)p 1265
1312 27 4 v 31 w(debugging)d Fz(for)j(that.)515 1428
y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(no)l(de)g(glob)l(al)e
(variables.)i Fk(i)o Fq(\021)598 1519 y Fi(boolean_t)41
b(n_debugging=FALSE;)515 1677 y Fk(h)p Fi(off)p 667 1677
24 4 v 29 w(mdepNode::db)p 1164 1677 V 30 w(break)29
b(db)p 1496 1677 V 29 w(putchar)g Fj(and)f Fi(db)p 2054
1677 V 28 w(puts)h Fj(implementation.)e Fk(i)p Fq(\021)598
1768 y Fi(//)39 b(Sets)i(a)e(breakpoint)j(for)d(serial-line)j
(debugging.)598 1860 y(void)e(off_mdepNode::db_break\(void\))598
1951 y({)676 2042 y(extern)h(boolean_t)g(n_initialized;)676
2134 y(if)f(\(n_initialized)i(&&)e(n_debugging\))755
2225 y(gdb_breakpoint\(\);)598 2316 y(})598 2408 y(//)f(Sends)i(a)e
(character)j(to)d(the)h(debugger)598 2499 y(void)g
(off_mdepNode::db_putchar\()45 b(int)40 b(ch\))598 2590
y({)676 2682 y(gdb_serial_putchar\(ch\);)598 2773 y(})598
2864 y(//)f(Sends)i(a)e(string)i(to)f(the)f(debugger)598
2956 y(void)h(off_mdepNode::db_puts\(const)45 b(char)40
b(*s\))598 3047 y({)676 3138 y(gdb_serial_puts\(s\);)598
3230 y(})515 3495 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(no)l
(de)g(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)o
Fq(\021)598 3587 y Fi(#include)41 b(<flux/gdb_serial.h>)161
b(//)40 b(OSKit)g(gdb)g(support)598 3678 y(#include)h(<flux/gdb.h>)434
b(//)40 b(OSKit)g(gdb)g(support)515 3935 y FA(Misc)31
b(stu\013)515 4088 y Fz(T)-7 b(o)27 b(initialize)h(static)f
(constructors,)f(this)i(routine)f(m)n(ust)h(b)r(e)g(called)f(b)n(y)g
Fx(main)p Fz(.)515 4221 y Fk(h)p Fj(O\013)g(pr)l(e-)p
Fi(main)j Fj(initialization)c(r)l(outine.)j Fk(i)p Fq(\021)598
4313 y Fi(extern)40 b("C")g({)676 4404 y(extern)h(void)f
(off_mdep_init\(void\);)598 4495 y(};)1885 5255 y Fz(215)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
216 217 bop 639 523 a Fz(As)28 b(of)g(to)r(da)n(y)-7
b(,)27 b(it)h(simply)f(calls)g(ev)n(ery)g(static)g(constructor.)515
656 y Fk(h)p Fj(O\013)g(pr)l(e-)p Fi(main)j Fj(initialization)c(r)l
(outine)j(implementation.)f Fk(i)o Fq(\021)598 747 y
Fi(extern)40 b("C")g({)676 839 y(void)g(off_mdep_init\(void\))83
b({)833 930 y(extern)41 b(void)f(___call_global_constructors\(vo)q
(id\);)833 1021 y(___call_global_constructors\(\))q(;)676
1204 y(})598 1295 y(};)1885 5255 y Fz(216)p eop
PStoPSsaved restore
%%Page: (218,219) 110
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
217 218 bop 515 1146 a Fs(Chapter)64 b(4)515 1561 y Fv(Exp)6
b(orting)77 b(the)h(hardw)-6 b(are)515 2042 y Fr(4.1)135
b(Ph)l(ysical)46 b(memory)515 2241 y Fn(4.1.1)112 b(Memory)37
b(banks)515 2394 y Fz(Ph)n(ysical)17 b(memory)g(is)h(distributed)h
(among)f(di\013eren)n(t)g Fy(memory)k(c)l(ontainers)k
Fz(named)18 b Fx(MBank)p Fz(s.)515 2494 y(Eac)n(h)24
b(memory)h(bank)h(con)n(tains)f(a)g(page)g(allo)r(cator)f(and)i(supp)r
(orts)f(allo)r(cation)g(and)h(deal-)515 2593 y(lo)r(cation)33
b(of)g(page)g(frames,)h Fx(PFrame)p Fz(s,)f(con)n(tained)g(in)h(it.)55
b(Also,)35 b(it)f(pro)n(vides)e(means)h(to)515 2693 y(lo)r(cate)27
b(a)g(page)g(frame)g(either)g(b)n(y)h(distributed)g(address)e(or)h(ph)n
(ysical)f(address.)515 2825 y Fk(h)p Fj(O\013)h(memory)h(b)l(ank.)g
Fk(i)p Fq(\021)598 2916 y Fi(//)39 b(A)h(bank)g(of)g(memory)598
3007 y(class)g(off_MBank)h(:)f(public)g(off_HWCompResource)k({)598
3099 y(private:)676 3190 y(off_PgAllocator)f(m_alloc;)315
b(//)40 b(A)g(page)g(allocator.)676 3281 y Fk(h)p Fj(Other)29
b(private)f(memb)l(ers)h(of)e Fi(off)p 1713 3281 24 4
v 29 w(MBank)p Fj(.)h Fk(i)676 3373 y(h)p Fj(Other)h(private)f(metho)l
(ds)h(of)f Fi(off)p 1691 3373 V 29 w(MBank)p Fj(.)g Fk(i)598
3464 y Fi(protected:)676 3555 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 3555 V 29 w(MBank)p
Fj(.)h Fk(i)598 3647 y Fi(public:)676 3829 y(//)40 b(Returns)h(a)e
(pointer)i(to)f(the)g(memory)g(bank)g(page)g(allocator.)676
3921 y(virtual)h(off_PgAllocator)i(*get_allocator\(void\))83
b({)755 4012 y(assert\(valid\(\)\);)43 b(return)d(&m_alloc;)676
4103 y(})676 4286 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4286 V 29 w(MBank)p Fj(.)h Fk(i)598 4377
y Fi(};)515 4550 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)g(dep)l
(endencies.)i Fk(i)o Fq(\021)598 4641 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 4732 y(#include)h(<klib/ids.h>)473 b(//)40 b(for)g
(off_pg_id_t)i(et)d(al.)598 4824 y(#include)i(<klib/HWCompResource.h>)j
(//)c(for)g(off_HWCompResource)598 4915 y(#include)h(<hw/PFrame.h>)434
b(//)40 b(for)g(off_PFrame)598 5006 y(#include)h(<hw/PgAllocator.h>)239
b(//)40 b(for)g(off_PgAllocator)1885 5255 y Fz(217)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
218 219 bop 639 523 a Fz(Being)18 b(a)g(concrete)g(sub)r(class)f(of)i
Fx(CompResource)p Fz(,)c(w)n(e)j(m)n(ust)g(implemen)n(t)h
Fx(make)p 3096 523 27 4 v 30 w(available)p Fz(.)515 639
y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 639 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fq(\021)598
731 y Fk(h)p Fj(Implementation)g(of)f Fi(off)p 1391 731
V 29 w(CompResource::make)p 2122 731 V 32 w(available)p
Fj(.)i Fk(i)639 855 y Fz(Suc)n(h)f(implemen)n(tation)g(uses)f
Fx(is)p 1702 855 27 4 v 30 w(local)p Fz(.)515 971 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 971
24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1063 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i(one?)598
1154 y(boolean_t)g(is_local\(const)h(off_pg_id_t)g(&pg\))80
b({)676 1245 y(return)41 b(\()e(\(vm_offset_t\)pg)k(<)c(m_coresize)j
(&&)1029 1337 y(\(m_alloc+off_mdepMBank::a2p\()q(pg\)\))q(->l_p)q(f.ge)
q(t_id\()q(\))j(==)40 b(pg)g(\);)598 1428 y(})639 1553
y Fz(Note)27 b(ho)n(w)f(for)g(memory)g(banks)g(the)h(implemen)n(tation)
g(of)g Fx(is)p 2615 1553 27 4 v 30 w(local)e Fz(considers)g(also)515
1652 y(page)h(frames)h(from)h(other)f(\(lo)r(cal\))g(con)n(tainers.)639
1752 y(Initially)h(memory)f(banks)g(are)f(created)h(with)h(default)g(v)
-5 b(alues)27 b(for)h(its)f(mem)n(b)r(ers.)515 1868 y
Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1868 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1959 y Fi(//)39 b(Creates)i(a)f(memory)g(bank.)598 2051
y(off_MBank\(void\))i(:)676 2142 y(off_HWCompResource\(off_Prote)q
(ction)q(\(\),O)q(FF_P)q(RTL_N)q(ULL,)1422 2233 y(OFF_ID_NULL,)f
(OFF_MAGIC_MBANK\),)676 2325 y Fk(h)p Fj(Initialize)27
b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g Fi(off)p
2090 2325 V 29 w(MBank)p Fj(.)g Fk(i)676 2416 y Fi({;})515
2574 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)g(dep)l(endencies.)i
Fk(i)o Fz(+)p Fq(\021)598 2665 y Fi(#include)41 b(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 2756 y(#include)h(<klib/Magic.h>)356
b(//)40 b(for)g(magic)g(numbers)639 2897 y Fz(W)-7 b(e)28
b(m)n(ust)g(de\014ne)g(the)g(new)f(magic)g(n)n(um)n(b)r(er)h(used)f(b)r
(efore.)515 3014 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)i
Fk(i)p Fq(\021)598 3105 y Fi(OFF_MAGIC_MBANK,)43 b(//)c(Memory)i(bank)f
(magic)g(nb.)639 3230 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e
(case)h(to)h(the)g(implemen)n(tation)f(of)h Fx(Magic::nameof)p
Fz(.)515 3346 y Fk(h)p Fi(off)p 667 3346 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 3346 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 3437 y Fi(case)40 b(OFF_MAGIC_MBANK:)676
3528 y(return)h("off_MBank";)639 3653 y Fz(Memory)30
b(bank)g(users)f(can)h(c)n(hec)n(k)g(their)g(references)f(to)h(memory)g
(banks)g(using)g(this)515 3753 y(metho)r(d.)515 3869
y Fk(h)p Fj(Other)e(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3869 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3960 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(MBank?)598
4051 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_MBANK;)i(})1885 5255 y Fz(218)p eop
PStoPSsaved restore
%%Page: (220,221) 111
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
219 220 bop 639 523 a Fz(As)33 b(not)f(ev)n(ery)f(memory)h(is)g(of)h
(the)f(same)g(kind,)i(memory)e(banks)f(exp)r(ort)h(some)g(in-)515
623 y(formation)e(to)h(let)g(users)f(kno)n(w)h(ab)r(out)g(the)g(c)n
(haracteristics)e(of)i(the)g(supplied)h(memory)-7 b(.)515
722 y(Namely)g(,)38 b(there)e(are)e(three)i(b)r(o)r(olean)g(attributes)
g(to)f(record)g(whether)h(the)g(memory)f(is)515 822 y(DMA)24
b(capable,)g(IO-map)e(capable,)i(and)f(p)r(ersisten)n(t)g(or)f(not.)36
b(W)-7 b(e)24 b(store)e(these)i(three)f(bits)515 922
y(in)28 b(the)g(un)n(used)f(part)g(of)h(the)g(resource)e(\015ag)g
(bits.)515 1054 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1054 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 1146 y Fi(//)39 b(Supports)i(DMA?)598
1237 y(boolean_t)g(is_dmable\(void\))160 b(const)41 b({)676
1328 y(assert\(valid\(\)\);)i(return)e(r_flags&OFF_MF_DMA;)598
1420 y(})598 1511 y(//)e(Supports)i(IO)f(port)g(maps.)598
1602 y(boolean_t)h(is_iomapable\(void\))i(const)e({)755
1694 y(assert\(valid\(\)\);)i(return)d(r_flags&OFF_MF_IOM;)598
1785 y(})598 1876 y(//)f(Persists?)598 1968 y(boolean_t)i
(is_persistent\(void\)const)k({)755 2059 y(assert\(valid\(\)\);)e
(return)d(r_flags&OFF_MF_PER;)598 2150 y(})639 2291 y
Fz(After)28 b(instan)n(tiation,)f Fx(start)f Fz(should)h(b)r(e)h(used)g
(to)f(start)g(memory)g(bank)g(op)r(eration.)515 2408
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2408 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2499 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)g(memory)h
(bank.)598 2590 y(err_t)f(start\()h(const)f(off_mdepMBank)i(&mdep,)f
(const)f(off_id_t)h(&id)f(\);)515 2748 y Fk(h)p Fj(O\013)27
b(memory)h(b)l(ank)g(dep)l(endencies.)i Fk(i)o Fz(+)p
Fq(\021)598 2839 y Fi(#include)41 b(<hw/mdep/mMBank.h>)239
b(//)40 b(for)g(off_mdepMBank)598 2931 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)1885 5255
y Fz(219)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
220 221 bop 639 523 a Fz(Suc)n(h)30 b(metho)r(d)g(receiv)n(es)e(the)j
(b)r(o)r(ot-time)f(information)f(ab)r(out)g(the)h(features)f(for)h(the)
515 623 y(memory)39 b(bank)g(b)r(eing)h(started)f(and)g(sets)h(it)g(up)
g(accordingly)-7 b(.)71 b(It)40 b(will)g(also)f(set)h(the)515
722 y(memory)27 b(bank)g(iden)n(ti\014er)g(as)g(dictated)h(b)n(y)f(the)
h(caller)2267 692 y Fp(1)2304 722 y Fz(.)639 822 y(The)21
b(information)f(con)n(tained)g(in)h Fx(mdep)e Fz(is)h(the)h(\014rst)f
(v)-5 b(alid)21 b(address,)g(the)g(last)f(v)-5 b(alid)21
b(ad-)515 922 y(dress,)h(the)f(capabilities)g(for)g(the)h(memory)e(b)r
(eing)i(con)n(tained)f(\(with)h(bits)g Fx(MF)p 2930 922
27 4 v 30 w(DMA)e Fz(if)i(DMA)515 1021 y(is)i(sup)r(orted,)h
Fx(MF)p 1053 1021 V 30 w(IOM)e Fz(if)i(IO-map)f(is)g(supp)r(orted,)h
Fx(MF)p 2194 1021 V 30 w(PER)e Fz(is)i(the)f(memory)g(p)r(ersists\),)h
(the)515 1121 y(preferred)h(page)h(sizes,)g(and)h(the)f(mean)h(access)e
(time.)515 1253 y Fk(h)p Fi(off)p 667 1253 24 4 v 29
w(MBank::start)k Fj(implementation.)d Fk(i)p Fq(\021)598
1344 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)g(memory)h
(bank.)598 1435 y(err_t)f(off_MBank::start\()j(const)e(off_mdepMBank)h
(&mdep,)e(const)h(off_id_t)g(&id)f(\))598 1527 y({)676
1618 y(assert\(valid\(\)\);)676 1709 y(set_id\(id\);)676
1801 y(r_flags)h(|=)f(mdep.get_flags\(\);)676 1983 y
Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)g(of)e Fi(off)p
1629 1983 V 29 w(MBank)h Fj(ac)l(c)l(or)l(ding)i(to)e
Fi(mdep)p Fj(.)g Fk(i)676 2166 y Fi(kcout<<)41 b("Mbank)80
b(#"<<)40 b(id)g(<<)f(fmt\(")i(\(\045d)f(pages\))g(",get_npgs\(\)\)<<)j
("started.")e(<<)f(nl;)676 2257 y(return)h(EOK;)598 2349
y(})639 2489 y Fz(A)22 b(new)g(mem)n(b)r(er,)h Fx(m)p
1274 2489 27 4 v 31 w(mdep)d Fz(will)i(store)e(the)j(b)r(o)r(ot)e(time)
i(information,)f(whic)n(h)f(is)h(needed)515 2589 y(b)r(ecause)27
b(it)h(pro)n(vides)e(common)h(information)g(useful)h(to)g(memory)e
(bank)i(users.)515 2704 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2704 24 4 v 29 w(MBank)p Fj(.)g Fk(i)p
Fq(\021)598 2796 y Fi(off_mdepMBank)120 b(m_mdep;)355
b(//)40 b(Mach.)g(dep.)g(information)515 2952 y Fk(h)p
Fj(Start)29 b(other)g(memb)l(ers)f(of)f Fi(off)p 1467
2952 V 29 w(MBank)i Fj(ac)l(c)l(or)l(ding)g(to)f Fi(mdep)p
Fj(.)g Fk(i)p Fq(\021)598 3043 y Fi(m_mdep=mdep;)639
3184 y Fz(Initially)-7 b(,)26 b(b)r(efore)f(the)h(memory)e(bank)h(is)g
(started)g(it)g(is)g(initialized)h(with)f(silly)g(v)-5
b(alues.)515 3300 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h
(memb)l(ers)f(of)e Fi(off)p 1928 3300 V 29 w(MBank)p
Fj(.)h Fk(i)p Fq(\021)598 3391 y Fi(m_mdep\(0\),)639
3515 y Fz(Most)19 b(of)g(the)h(mac)n(hine)e(dep)r(enden)n(t)i
(information)e(is)h(exp)r(orted)g(b)n(y)g(the)g(memory)f(bank.)515
3631 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3631 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3722 y Fi(//)39 b(Returns)i(the)f(first)h(valid)f(address.)
598 3813 y(vm_offset_t)h(get_first\(void\)const{assert)q(\(val)q
(id\(\)\))q(;)k(return)c(m_mdep.get_first\(\);)i(})598
3905 y(//)c(Returns)i(the)f(last)g(valid)h(address.)598
3996 y(vm_offset_t)g(get_last\(void\)const{)j
(assert\(valid\(\)\);return)g(m_mdep.get_last\(\);)g(})598
4087 y(//)39 b(Returns)i(the)f(number)h(of)e(page)i(frames.)598
4179 y(vm_size_t)119 b(get_npgs\(void\))43 b(const)d({)118
b(assert\(valid\(\)\);return)44 b(m_mdep.get_npgs\(\);})598
4270 y(//)39 b(Returns)i(the)f(mean)g(access)h(time.)598
4361 y(//)e(\(0)h(means)g(damn)h(slow;)f(255)g(means)g(damn)g(fast\))
598 4453 y(unsigned8_t)h(get_mat\(void\))160 b(const)41
b({assert\(valid\(\)\);)i(return)d(m_mdep.get_mat\(\);)j(})515
4700 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(dep)l(endencies.)i
Fk(i)o Fz(+)p Fq(\021)598 4792 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)p 515 4850 1146 4 v 607 4904 a
Fm(1)642 4927 y Fl(Remem)n(b)r(er)32 b(that)k(when)f(the)g(memory)d
(bank)j(wrapp)r(er)f(used)h(to)g(exp)r(ort)g(memory)d(services)i(b)r(e)
515 5006 y(created,)24 b(the)h(p)r(ortal)f(used)g(m)n(ust)f(matc)n(h)g
(the)i(iden)n(ti\014er)f(k)n(ept)h(in)e(the)i(memory)c(bank.)1885
5255 y Fz(220)p eop
PStoPSsaved restore
%%Page: (222,223) 112
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
221 222 bop 639 523 a Fz(The)24 b Fx(get)p 943 523 27
4 v 30 w(pgsize)d Fz(metho)r(d)i(just)h(returns)f(the)h(appropriate)d
(v)-5 b(alue)23 b(found)h(in)g Fx(m)p 3156 523 V 31 w(pgsz)p
Fz(.)515 639 y Fk(h)p Fj(Other)k(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 639 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 731 y Fi(//)39 b(Gets)i(the)e(preferred)j(page)e(sizes)598
822 y(//)f(above)i(llimit)f(bytes)h(\(or)f(0)f(if)h(none\))598
913 y(vm_size_t)h(get_pgsize\(vm_size_t)j(llimit\))d(const;)639
1038 y Fz(Its)28 b(implemen)n(tation)g(is)f(somewhat)g(slo)n(w.)515
1154 y Fk(h)p Fi(off)p 667 1154 V 29 w(MBank::get)p 1086
1154 V 30 w(pgsize)i Fj(implementation.)e Fk(i)p Fq(\021)598
1245 y Fi(//)39 b(Gets)i(the)e(preferred)j(page)e(sizes)598
1337 y(//)f(above)i(llimit)f(bytes)h(\(or)f(0)f(if)h(none\))598
1428 y(vm_size_t)h(off_MBank::get_pgsize\(vm_size)q(_t)k(llimit\))c
(const)598 1519 y({)676 1611 y(assert\(valid\(\)\);)676
1702 y(for)f(\(int)g(i=0;)g(i<OFF_NPGSZ_MAX;)j(i++\))755
1793 y(if)c(\(m_mdep.get_pgsz\(i\)>llimit\))833 1885
y(return)i(m_mdep.get_pgsz\(i\);)676 1976 y(return)g(0;)598
2067 y(})639 2283 y Fz(And)33 b(a)f(more)f(e\016cien)n(t)i
Fx(get)p 1561 2283 27 4 v 30 w(pgsize)d Fz(routine)i(is)g(pro)n(vided)f
(to)h(b)r(e)h(used)f(inside)h(the)515 2383 y(k)n(ernel.)j(It)28
b(alw)n(a)n(ys)d(returns)i(the)h(minim)n(um)g(preferred)f(page)g(size.)
515 2499 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2499 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2590 y Fi(//)39 b(Returns)i(the)f(minimum)h
(preferred)g(page)f(size.)598 2682 y(static)g(vm_size_t)i
(get_pgsize\(void\))82 b({)39 b(return)i(off_mdepMBank::get_pgsz\(\);})
515 2839 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(implementation)g
(dep)l(endencies.)h Fk(i)p Fq(\021)598 2931 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(for)g(OFF_NPGSZ_MAX)i(and)e(other)g
(limits.)639 3072 y Fz(The)28 b(maxim)n(um)f(n)n(um)n(b)r(er)h(of)f
(preferred)g(page)g(sizes)g(is)g(a)g(system)h(limit.)515
3188 y Fk(h)p Fj(O\013)f(limits.)f Fk(i)p Fq(\021)598
3279 y Fi(const)40 b(int)g(OFF_NPGSZ_MAX)i(=)e(4;)157
b(//)40 b(Max.)g(number)g(of)g(pages)g(sizes.)1885 5255
y Fz(221)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
222 223 bop 515 523 a Fn(4.1.2)112 b(P)m(age)38 b(frames)515
676 y Fz(Eac)n(h)22 b Fx(PFrame)g Fz(main)n(tains)h(the)h(information)f
(needed)h(ab)r(out)g(eac)n(h)f(page)g(frame)g(installed)515
776 y(in)30 b(the)g(system:)41 b(some)29 b(bits)h(stating)g(whether)f
(the)i(page)e(has)g(b)r(een)h(referenced)f(or)g(not,)515
876 y(is)34 b(clean)f(or)g(dirt)n(y)-7 b(,)35 b(and)f(also)f(that)h
(state)f(k)n(ept)h(b)n(y)g(ev)n(ery)e(system)i(hardw)n(are)e(resource)
515 975 y(unit,)i(including)e(the)g(magic)g(n)n(um)n(b)r(er,)h(a)f
(reference)f(to)h(the)g(con)n(tainer)f(the)i(page)e(is)h(in,)515
1075 y(the)c(reference)e(coun)n(ter,)h(protection,)g(domain,)g(and)h
(resource)e(id.)515 1208 y Fk(h)p Fj(O\013)h(p)l(age)h(fr)l(ame.)g
Fk(i)o Fq(\021)598 1299 y Fi(//)39 b(A)h(page)g(frame.)598
1390 y(//)598 1482 y(class)g(off_PFrame)i(:)d(public)i(off_HWResUnit)h
({)598 1573 y(private:)676 1664 y(off_pgf_t)81 b(p_bits;)354
b(//)40 b(Status)h(bits.)676 1756 y Fk(h)p Fj(Other)29
b(private)f(memb)l(ers)h(of)e Fi(off)p 1713 1756 24 4
v 29 w(PFrame)p Fj(.)h Fk(i)598 1847 y Fi(protected:)676
1938 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 1938 V 29 w(PFrame)p Fj(.)i Fk(i)598 2030
y Fi(public:)676 2121 y(//)40 b(Gets)g(the)g(page)g(frame)g(bits.)676
2212 y(off_pgf_t)h(get_bits\(void\))i(const)d({)79 b
(assert\(valid\(\)\);)43 b(return)d(p_bits;)h(})676 2395
y(//)f(Sets)g(the)g(page)g(frame)g(bits.)676 2486 y(void)g
(set_bits\(const)j(off_pgf_t)e(b\))f({)118 b(assert\(valid\(\)\);)42
b(p_bits=b;})676 2669 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2669 V 29 w(PFrame)p Fj(.)i Fk(i)598 2760
y Fi(};)515 2993 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)e(used)i
Fx(valid)p Fz(,)d(whic)n(h)j(will)g(b)r(e)g(de\014ned)g(later.)515
3109 y Fk(h)p Fj(O\013)f(p)l(age)h(fr)l(ame)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3200 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 3291 y(#include)h(<klib/HWResUnit.h>)200
b(//)40 b(for)g(off_HWResUnit)598 3383 y(class)g(off_MBank;)630
b(//)40 b(to)f(break)i(the)f(circular)h(dependency)639
3507 y Fz(where)26 b Fx(p)p 927 3507 27 4 v 31 w(bits)e
Fz(corresp)r(onds)g(to)h(the)h(bits)h(main)n(tained)e(b)n(y)h(the)g
(address)e(translation)515 3607 y(mac)n(hinery)i(and)i(de\014ned)g(in)f
(a)h(mac)n(hine)f(dep)r(enden)n(t)h(w)n(a)n(y)-7 b(.)515
3723 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(mo)l(de)g(bits.)g
Fk(i)o Fq(\021)598 3815 y Fi(typedef)41 b(off_mdep_pgf_t)h(off_pgf_t;)
515 4064 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 4155 y Fi(#include)41 b(<hw/mdep/mPFrame.h>)
161 b(//)40 b(for)g(off_mdep_pgf_t)639 4296 y Fz(P)n(age)26
b(frames)h(are)g(created)f(with)i(this)g(constructor,)515
4412 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4412 24 4 v 29 w(PFrame)p Fj(.)h Fk(i)p Fq(\021)598
4504 y Fi(//)39 b(Creates)i(a)f(pre-initialized)i(page)e(frame.)598
4595 y(off_PFrame\(const)j(off_Protection)f(&p,)e(const)g
(off_prtl_id_t)i(domain\);)1885 5255 y Fz(222)p eop
PStoPSsaved restore
%%Page: (224,225) 113
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
223 224 bop 639 523 a Fz(although)23 b(a)g(trivial)g(constructor)f(is)i
(pro)n(vided)e(so)h(that)h(uninitialized)g Fx(PFrame)d
Fz(struc-)515 623 y(tures)27 b(b)r(e)h(allo)n(w)n(ed.)515
739 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(PFrame)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
830 y Fi(off_PFrame\(void\))43 b(:)676 922 y
(off_HWResUnit\(off_Protection)q(\(\),)1225 1013 y(OFF_PRTL_NULL,)1225
1104 y(OFF_ID_NULL,)1225 1196 y(OFF_MAGIC_PFRAME,NULL\))637
1287 y({;})515 1445 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 1536 y Fi(#include)41
b(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
1627 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d
(al.)598 1719 y(#include)i(<klib/Magic.h>)356 b(//)40
b(for)g(magic)g(numbers.)639 1860 y Fz(The)31 b(real)f(constructor)g
(only)h(receiv)n(es)e(the)i(protection)g(and)g(domain)f(to)h(b)r(e)h
(set)f(for)515 1959 y(the)d(page)e(frame)i(b)r(eing)f(allo)r(cated.)515
2076 y Fk(h)p Fi(off)p 667 2076 V 29 w(PFrame::off)p
1125 2076 V 30 w(PFrame)i Fj(implementation.)f Fk(i)o
Fq(\021)598 2167 y Fi(off_PFrame::off_PFrame\(const)45
b(off_Protection)e(&p,)d(const)g(off_prtl_id_t)i(domain\))f(:)676
2258 y(off_HWResUnit\(p,domain\),)676 2350 y(p_bits\(0\))598
2441 y({;})639 2565 y Fz(This)35 b(means)g(that)g(page)f(frames)g(are)g
(pre-initialized.)59 b(The)35 b(iden)n(ti\014er,)h(con)n(tainer)515
2665 y(reference)k(and)i(magic)e(n)n(um)n(b)r(er)i(is)f(set)g(at)h
(initialization)f(time)h(b)n(y)f(the)h(page)f(frame)515
2765 y(con)n(tainer.)639 2864 y(W)-7 b(e)28 b(still)g(ha)n(v)n(e)f(to)g
(de\014ne)h(no)n(w)f(the)h(magic)f(n)n(um)n(b)r(er)g(for)g(page)g
(frames.)515 2980 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)i
Fk(i)p Fz(+)o Fq(\021)598 3072 y Fi(OFF_MAGIC_PFRAME,)278
b(//)40 b(Off)g(page)g(frame)g(magic)h(number)639 3196
y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)g
(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
3313 y Fk(h)p Fi(off)p 667 3313 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 3313 V 29 w(number)p Fj(s.)h
Fk(i)p Fz(+)p Fq(\021)598 3404 y Fi(case)40 b(OFF_MAGIC_PFRAME:)676
3495 y(return)h("off_PFrame";)639 3620 y Fz(P)n(age)26
b(frame)h(users)g(can)g(c)n(hec)n(k)g(their)g(references)g(using)g
(this)h(metho)r(d.)515 3736 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3736 V 29 w(PFrame)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 3827 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f
(PFrame?)598 3919 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g
(get_magic\(\))i(==)e(OFF_MAGIC_PFRAME;)j(})639 4043
y Fz(The)28 b(new)g(con)n(tainer)e(can)h(also)g(implemen)n(t)h(its)g
Fx(get)p 2323 4043 27 4 v 30 w(umagic)d Fz(metho)r(d.)515
4176 y Fk(h)p Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 4176 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p
Fq(\021)598 4267 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i
({)d(return)g(OFF_MAGIC_PFRAME;)j(})1885 5255 y Fz(223)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
224 225 bop 515 523 a Fn(4.1.3)112 b(Memory)37 b(allo)s(cation)515
676 y Fz(P)n(age)20 b(frames)i(are)f(allo)r(cated)h(from)g
Fx(PgAllocator)p Fz(s.)30 b(A)23 b(sub)r(class)f(of)g(a)g
Fx(FixedAllocator)515 776 y Fz(instan)n(tiated)27 b(to)h(allo)r(cate)e
Fx(PFrame)p Fz(s.)515 909 y Fk(h)p Fj(O\013)h(p)l(age)h(fr)l(ame)g(al)t
(lo)l(c)l(ator.)g Fk(i)p Fq(\021)598 1000 y Fi(//)39
b(A)h(page)g(frame)g(allocator.)598 1091 y(//)598 1183
y(class)g(off_PgAllocator)j(:)c(public)i
(off_TFixedAllocator<off_LPFram)q(e>)k({)598 1274 y(private:)676
1365 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 1365 24 4 v 29 w(PgAllocator)p Fj(.)j Fk(i)598
1457 y Fi(public:)676 1548 y(//)40 b(Allows)g(declarations)i(of)e
(uninitialized)i(page)e(allocators)676 1639 y
(off_PgAllocator\(void\){;})676 2005 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2005 V 29
w(PgAllocator)p Fj(.)j Fk(i)598 2096 y Fi(};)639 2328
y Fz(As)k(the)g(\014xed)f(allo)r(cator)f(uses)h(a)g(lik)n(ed)g
(free-list,)h(the)g(arra)n(y)d(no)r(des)i(m)n(ust)h(sub)r(class)515
2428 y Fx(DLinkedNode)p Fz(.)515 2544 y Fk(h)p Fj(O\013)27
b(linkable)g(p)l(age)i(fr)l(ame.)e Fk(i)p Fq(\021)598
2636 y Fi(//)39 b(A)h(linkable)h(off_PFrame)598 2727
y(//)598 2818 y(class)f(off_LPFrame)i(:)d(public)i(DLinkedNode)h({)598
2910 y(public:)676 3001 y(off_PFrame)g(l_pf;)550 b(//)40
b(The)g(page)g(frame.)676 3184 y(//)g(To)g(allow)g(uninitilized)i
(LPFrames.)676 3275 y(off_LPFrame\(void\))h({;})676 3458
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 3458 V 29 w(LPFrame)p Fj(.)i Fk(i)598 3549 y Fi(};)515
3707 y Fk(h)p Fj(O\013)e(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l(ator)h(dep)
l(endencies.)g Fk(i)p Fq(\021)598 3798 y Fi(#include)41
b(<klib/FixedAllocator.h>)j(//)c(for)g(off_FixedAllocator)598
3889 y(#include)h(<hw/PFrame.h>)395 b(//)40 b(for)g(off_PFrame)639
4030 y Fz(P)n(age)29 b(frame)h(allo)r(cators)f(\(there)i(is)f(one)h(p)r
(er)f(memory)g(bank\))h(share)e(a)h(single)g(arra)n(y)515
4130 y(holding)i Fx(PFrame)p Fz(s)e(for)h(the)i(en)n(tire)f(ph)n
(ysical)g(memory)-7 b(.)50 b(This)33 b(is)f(con)n(v)n(enien)n(t)f(to)i
(ensure)515 4230 y(that)26 b(memory)g(banks)f(sharing)g(a)h(single)g
(no)r(de)g(will)h(share)e(the)h(ph)n(ysical)g(address)f(space,)515
4329 y(whic)n(h)30 b(is)f(the)i(common)e(case.)43 b(F)-7
b(or)29 b(that)i(reason,)e(a)g(page)g(allo)r(cator)f(is)i(able)g
(accept)f(an)515 4429 y(initial)h(page)e(frame)h(n)n(um)n(b)r(er)h
(whic)n(h)f(will)h(adjust)g(ev)n(ery)e(page)g(frame)i(n)n(um)n(b)r(er)f
(used)g(on)515 4529 y(it.)515 4661 y Fk(h)p Fj(Other)f(private)h(memb)l
(ers)f(of)g Fi(off)p 1552 4661 V 29 w(PgAllocator)p Fj(.)h
Fk(i)p Fq(\021)598 4753 y Fi(natural_t)41 b(p_start;)551
b(//)40 b(first)g(PFN)1885 5255 y Fz(224)p eop
PStoPSsaved restore
%%Page: (226,227) 114
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
225 226 bop 639 523 a Fz(An)24 b(arra)n(y)c(of)j(link)n(ed)g(page)f
(frames,)i(as)e(w)n(ell)h(as)f(an)h(indexer)f(for)h(it)g(are)f(shared)g
(among)515 623 y Fx(PgAllocator)p Fz(s.)515 739 y Fk(h)p
Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p 1552
739 24 4 v 29 w(PgAllocator)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
830 y Fi(static)40 b(off_Indexer<off_LPFrame>)45 b(p_idx;)c(//)e
(linked)i(page)f(frame)g(indexer.)598 922 y(static)g(off_LPFrame)513
b(*p_pg;)80 b(//)39 b(Linked)i(Page)f(array.)639 1046
y Fz(Suc)n(h)28 b(arra)n(y)d(is)j(staticly)f(set)h(to)f(b)r(e)h(n)n
(ull.)515 1162 y Fk(h)p Fj(O\013)f(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l
(ator)h(static)f(memb)l(ers.)h Fk(i)o Fq(\021)598 1254
y Fi(off_LPFrame)512 b(*off_PgAllocator::p_pg=NULL;)46
b(//)39 b(Linked)i(page)f(arry.)598 1345 y(off_Indexer<off_LPFrame>)k
(off_PgAllocator::p_idx;)202 b(//)39 b(Linked)i(page)f(indexer.)515
1503 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l(ator)h
(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 1594 y
Fi(#include)41 b(<klib/dlist.h>)356 b(//)40 b(for)g(DLinkedNode)h(et)f
(al)598 1685 y(#include)h(<klib/Indexer.h>)278 b(//)40
b(for)g(off_Indexer)639 1826 y Fz(It)30 b(is)g(later)f(initialized)h
(\(just)g(once!\))43 b(b)n(y)29 b(the)h Fx(set)p 2255
1826 27 4 v 30 w(core)f Fz(metho)r(d)h(whic)n(h)f(should)h(b)r(e)515
1926 y(called)d(b)r(efore)g(an)n(y)g Fx(off)p 1293 1926
V 30 w(PgAllocator)c Fz(instance)28 b(b)r(e)g(created.)515
2042 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2042 24 4 v 29 w(PgAllocator)p Fj(.)i Fk(i)p Fq(\021)598
2134 y Fi(//)39 b(Sets)i(the)e(off_PgAllocator)k(idea)d(of)g(core)g(to)
g(#npgs)g(page)g(frames.)598 2225 y(static)g(err_t)h
(set_core\(natural_t)i(npgs\);)515 2383 y Fk(h)p Fi(off)p
667 2383 V 29 w(PgAllocator::set)p 1320 2383 V 31 w(core)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 2474 y Fi(err_t)40
b(off_PgAllocator::set_core\(nat)q(ural)q(_t)45 b(npgs\))598
2565 y({)676 2657 y(if)40 b(\(!p_pg\))755 2748 y(p_pg)g(=)f(new)h
(off_LPFrame[npgs];)676 2839 y(return)h(\(p_pg\))f(?)g(EOK)g(:)f
(ENOMEM;)598 3022 y(})515 3196 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l
(ame)g(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g Fk(i)p
Fz(+)o Fq(\021)598 3288 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
3379 y(#include)h(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)
g(numbers)639 3520 y Fz(This)28 b(metho)r(d)g(is)f(re-exp)r(orted)g(b)n
(y)g Fx(MBank)p Fz(.)515 3636 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3636 V 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 3728 y Fi(//)39 b(Sets)i(the)e(idea)i(of)e(core)h
(to)g(#npgs)g(page)h(frames.)598 3819 y(static)f(err_t)h
(set_core\(const)h(off_mdepMBank)g(&mdep\);)515 3977
y Fk(h)p Fi(off)p 667 3977 V 29 w(MBank::set)p 1086 3977
V 30 w(core)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
4068 y Fi(//)39 b(Sets)i(the)e(idea)i(of)e(core)h(to)g(#npgs)g(page)h
(frames.)598 4159 y(err_t)f(off_MBank::set_core\(const)45
b(off_mdepMBank)d(&mdep\))598 4251 y({)676 4342 y
(m_coresize=off_mdepMBank::p2)q(a\(mde)q(p.ge)q(t_co)q(re_np)q(gs\(\))q
(\);)676 4433 y(return)f(off_PgAllocator::set_core\(mdep)q(.get)q
(_core)q(_npg)q(s\(\)\);)598 4525 y(})1885 5255 y Fz(225)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
226 227 bop 639 523 a Fz(Some)21 b(allo)r(cator)f(metho)r(ds)h(are)f
(rede\014ned)h(to)g(tak)n(e)f(in)n(to)h(accoun)n(t)f(that)i(the)f
(\014rst)g(PFN)515 623 y(migh)n(t)27 b(b)r(e)h(non-zero)e(and)i(also)e
(to)i(impro)n(v)n(e)e(e\016ciency)-7 b(.)515 739 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
739 24 4 v 29 w(PgAllocator)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
830 y Fi(off_LPFrame)41 b(*allocate\(boolean_t)j
(use_revocation=FALSE\))g({)676 922 y(return)d
(off_TFixedAllocator<off_LPFram)q(e>::)q(alloc)q(ate\()q(use_r)q(evoc)q
(atio)q(n\);)598 1013 y(})598 1104 y(off_LPFrame)g
(*allocate\(natural_t)j(at,)c(boolean_t)h(use_revocation=FALSE\))j({)
676 1196 y(return)d(off_TFixedAllocator<off_LPFram)q(e>::)q(alloc)q
(ate\()q(at-p_)q(star)q(t,)1696 1287 y(use_revocation\);)598
1378 y(})598 1469 y(inline)f(off_LPFrame)i(*operator)f(+\(natural_t)h
(at\))e({)676 1561 y(return)h(p_pg+at;)598 1652 y(})598
1743 y(inline)f(natural_t)i(pos\(off_LPFrame)g(*p\))e({)676
1835 y(return)h(p-p_pg;)598 1926 y(})639 2142 y Fz(The)28
b(size)g(of)g(the)g(core)f(is)g(k)n(ept)h(in)g(a)g(lo)r(cal)f(mem)n(b)r
(er)h(whic)n(h)f(is)h(exp)r(orted)g(to)f(the)i(rest)515
2242 y(of)e(the)h(k)n(ernel.)515 2358 y Fk(h)p Fj(Other)g(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 2358 V 29 w(MBank)p
Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 2449 y Fi(static)40
b(vm_size_t)i(m_coresize;)159 b(//)40 b(Size)g(of)g(core)g(memory.)515
2607 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(static)h(memb)l(ers.)f
Fk(i)p Fq(\021)598 2698 y Fi(vm_size_t)41 b(off_MBank::m_coresize=0;)
162 b(//)40 b(Size)g(of)g(core)g(memory.)515 2873 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
2873 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2964 y Fi(//)39 b(Return)i(the)f(core)g(size.)598 3055
y(static)g(inline)h(vm_size_t)g(get_coresize\(void\))83
b({)39 b(return)i(m_coresize;)h(})639 3196 y Fz(When)25
b(the)f(page)g(allo)r(cator)e(is)i(created)f(w)n(e)h(sp)r(ecify)g(the)h
(starting)e(page,)h(the)g(n)n(um)n(b)r(er)515 3296 y(of)k(page)g
(frames)g(and)h(the)g(base)f(address)g(for)g(the)h(v)n(ery)e(\014rst)i
(page)f(frame.)40 b(W)-7 b(e)29 b(then)g(\014x)515 3396
y(the)f(allo)r(cator)e(ra)n(w)g(store)h(as)f(an)i(o\013set)f(in)n(to)h
(the)g(shared)e Fx(n)p 2425 3396 27 4 v 31 w(pg)h Fz(arra)n(y)-7
b(.)515 3512 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3512 24 4 v 29 w(PgAllocator)p Fj(.)i Fk(i)p
Fz(+)p Fq(\021)598 3603 y Fi(//)39 b(Creates)i(a)f(page)g(allocator.)
598 3694 y(off_PgAllocator\(off_Exhausted)46 b(*r,vm_offset_t)c
(start,vm_size_t)h(size\);)515 3852 y Fk(h)p Fi(off)p
667 3852 V 29 w(PgAllocator::off)p 1320 3852 V 31 w(PgAllocator)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 3944 y Fi(//)39
b(Creates)i(a)f(page)g(allocator.)598 4035 y
(off_PgAllocator::off_PgAllocat)q(or\(of)q(f_Ex)q(haus)q(ted)45
b(*r,)1892 4126 y(vm_offset_t)d(start,vm_size_t)h(size\):)676
4218 y(off_TFixedAllocator<off_LPFr)q(ame>\()q(r,)1971
4309 y(\(const)d(off_Indexable*\)&p_idx,)1971 4400 y
(p_pg+start,size\),)676 4491 y(p_start\(start\))598 4583
y({;})515 4757 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)
l(ator)h(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
4848 y Fi(#include)41 b(<klib/Allocator.h>)1885 5255
y Fz(226)p eop
PStoPSsaved restore
%%Page: (228,229) 115
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
227 228 bop 515 523 a Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(al)t
(lo)l(c)l(ator)h(implementation)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 614 y Fi(#include)41 b(<hw/MBank.h>)639
756 y Fz(The)33 b(page)f(allo)r(cator)g(is)g(initialized)i(when)f(the)g
(memory)f(bank)h(is)g(started)f(and)h(its)515 855 y(size)23
b(is)h(kno)n(wn.)35 b(As)24 b(addresses)e(con)n(tained)h(in)h
Fx(mdep)f Fz(refer)g(to)g(b)n(ytes,)i(w)n(e)e(ha)n(v)n(e)g(to)h(con)n
(v)n(ert)515 955 y(them)h(to)g(page)f(n)n(um)n(b)r(ers)1322
925 y Fp(2)1383 955 y Fz(using)h(the)g(mac)n(hine)f(dep)r(enden)n(t)i
(metho)r(d)f Fx(a2p)p Fz(.)35 b(Besides,)25 b(the)515
1054 y(memory)i(bank)g(itself)h(is)f(giv)n(en)g(to)h(the)g(allo)r
(cator)d(as)i(a)h(resource)d(rev)n(o)r(cation)h(noti\014er.)515
1187 y Fk(h)p Fj(Start)j(other)g(memb)l(ers)f(of)f Fi(off)p
1467 1187 24 4 v 29 w(MBank)i Fj(ac)l(c)l(or)l(ding)g(to)f
Fi(mdep)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)676 1279 y Fi(\(void\))41
b(new\(\(void*\)&m_alloc\))1186 1370 y(off_PgAllocator\(\(off_Exhaust)q
(ed*\)t)q(his,)1814 1461 y(mdep.a2p\(mdep.get_first\(\)\),)1814
1553 y(mdep.a2p\(mdep.get_last\(\)-mdep.)q(get_)q(first)q(\(\)\)\))q(;)
639 1694 y Fz(where)27 b(w)n(e)h(used)f(a)g(sp)r(ecial)h
Fx(new)e Fz(op)r(erator)g(of)h Fx(PgAllocator)d Fz(to)j(do)g
(initialization.)515 1826 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 1826 V 29 w(PgAllocator)p Fj(.)i Fk(i)p
Fz(+)p Fq(\021)598 1918 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d
(void)h(*p\))g({)g(\(void\)s;)h(return)f(p;)g(})639 2059
y Fz(The)30 b(allo)r(cator)f(is)h(alw)n(a)n(ys)e(indexed)i(b)n(y)g
(page)f(frame)h(n)n(um)n(b)r(ers,)g(the)g(memory)f(bank)515
2159 y(b)n(y)e(page)g(frame)g(ph)n(ysical)g(addresses)f(instead.)515
2275 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2275 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2366 y Fi(//Gets)40 b(a)g(page)g(frame)g(from)g(its)g(distributed)i(or)
e(physical)h(address)598 2457 y(off_PFrame)g(*operator+\(vm_offset_t)j
(ma\))80 b({)676 2549 y(assert\(valid\(\)\);)676 2640
y(return)41 b(&\(m_alloc+off_mdepMBank::a2p\(m)q(a\)\)-)q(>l_pf)q(;)598
2731 y(})639 2947 y Fz(The)30 b Fx(notify)c Fz(metho)r(d)k(m)n(ust)g(b)
r(e)f(pro)n(vided)g(b)n(y)g(memory)f(banks)h(to)g(implemen)n(t)h(the)
515 3047 y(resource)f(rev)n(o)r(cator)g(signature)h(\(note)i(ho)n(w)f
Fx(this)e Fz(w)n(as)i(passed)f(b)n(y)h(the)h(memory)e(bank)515
3147 y(to)d(the)h(page)f(allo)r(cator)f(constructor\).)515
3263 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3263 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3354 y Fi(//)39 b(Notifies)i(that)g(memory)f(is)g(exhausted.)598
3445 y(void)g(notify\(void\);)639 3570 y Fz(Using)28
b(suc)n(h)f(allo)r(cator,)f(a)h(memory)g(bank)g(can)g(allo)r(cate)g
(memory)g(for)g Fx(PFrame)p Fz(s.)515 3703 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3703 V 29 w(MBank)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3794 y Fi(//)39 b(Allocates)j(a)d
(page)h(frame.)598 3885 y(off_PFrame)h(*alloc\(boolean_t)i
(use_revocation=FALSE\);)598 3977 y(off_PFrame)e(*alloc\(const)h
(off_pg_id_t)g(&at,)e(boolean_t)h(use_revocation=FALSE\);)598
4159 y(//)e(Deallocates)j(a)e(page)g(frame.)598 4251
y(void)g(free\(const)h(off_PFrame)h(*pf\);)p 515 4929
1146 4 v 607 4983 a Fm(2)642 5006 y Fl(W)-6 b(e)24 b(use)g(the)h(minim)
n(um)19 b(preferred)k(page)i(size)f(of)f(the)i(memory)c(bank.)1885
5255 y Fz(227)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
228 229 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(MBank::alloc)30 b Fj(and)e Fi(free)g Fj(implementation.)g
Fk(i)o Fq(\021)598 614 y Fi(//)39 b(Allocates)j(a)d(page)h(frame.)598
706 y(off_PFrame)h(*off_MBank::alloc\(boolean_t)46 b(use_revocation\))
598 797 y({)676 888 y(off_LPFrame)c(*lpf;)676 980 y
(assert\(valid\(\)\);)676 1071 y(w_lock\(\);)676 1162
y(lpf=m_alloc.allocate\(use_rev)q(ocati)q(on\);)676 1254
y(w_unlock\(\);)676 1345 y(return)f
(\(lpf\)?\(&lpf->l_pf\):\(off_PFrame)q(*\)NU)q(LL;)598
1436 y(})598 1528 y(off_PFrame)g(*off_MBank::alloc\(const)k
(off_pg_id_t)c(&at,)g(boolean_t)g(use_revocation\))598
1619 y({)676 1710 y(off_LPFrame)h(*lpf;)676 1802 y
(assert\(valid\(\)\);)676 1893 y(w_lock\(\);)676 1984
y(lpf=m_alloc.allocate\(a2p\(at\))q(,use_)q(revo)q(cati)q(on\);)676
2076 y(w_unlock\(\);)676 2167 y(return)f
(\(lpf\)?\(&lpf->l_pf\):\(off_PFrame)q(*\)NU)q(LL;)598
2258 y(})598 2441 y(//)e(Deallocates)j(a)e(page)g(frame.)598
2532 y(void)g(off_MBank::free\(const)k(off_PFrame)d(*pf\))598
2623 y({)676 2715 y(off_LPFrame)h(*lpf=\(off_LPFrame*\)\(\(\(char*\)p)q
(f\)-\(i)q(nt\)&)q(off_L)q(PFra)q(me::)q(l_pf\))q(;)676
2806 y(assert\(valid\(\))h(&&)c(pf\);)676 2897 y(w_lock\(\);)676
2989 y(m_alloc.deallocate\(lpf\);)676 3080 y(w_unlock\(\);)598
3171 y(})639 3404 y Fz(P)n(age)26 b(frames)h(are)g(allo)r(cated)f(and)i
(deallo)r(cated)f(with)h Fx(new)e Fz(and)i Fx(delete)d
Fz(op)r(erators.)639 3504 y(The)33 b(op)r(erator)e Fx(new)g
Fz(receiv)n(es)h(the)h(memory)f(bank)g(where)g(the)h(page)f(frame)g
(should)515 3603 y(b)r(e)c(allo)r(cated.)36 b(It)28 b(uses)f(its)h
Fx(alloc)d Fz(metho)r(d)j(to)g(\014nd)g(an)f(a)n(v)-5
b(ailable)27 b(page)f(frame.)515 3736 y Fk(h)p Fj(Other)i(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3736 V 29 w(PFrame)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 3827 y Fi(//)39 b(Allocate)i(a)f(page)
g(frame.)598 3919 y(void)g(*operator)h(new\(size_t)h(s,)d(off_MBank)j
(*mbank,)1343 4010 y(boolean_t)f(use_revocation=FALSE\);)598
4101 y(void)f(*operator)h(new\(size_t)h(s,)d(off_MBank)j(*mbank,)1343
4193 y(const)e(off_pg_id_t)i(&at,)1343 4284 y(boolean_t)f
(use_revocation=FALSE\);)1885 5255 y Fz(228)p eop
PStoPSsaved restore
%%Page: (230,231) 116
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
229 230 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PFrame::operator)42 b(new)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(void)40 b(*off_PFrame::operator)k
(new\(size_t)d(s,)f(off_MBank)h(*mbank,)1814 706 y(boolean_t)g
(use_revocation=FALSE\))598 797 y({)676 888 y(off_PFrame)h
(*pf=mbank->alloc\(use_revocatio)q(n\);)676 980 y(\(void\)s;)676
1071 y(assert\(s)f(&&)f(mbank)g(&&)g(mbank->valid\(\)\);)676
1162 y(assert\(!pf)i(||)d(pf->valid\(\)\);)676 1254 y(return)i
(\(void*\)pf;)598 1345 y(})598 1436 y(void)f(*off_PFrame::operator)k
(new\(size_t)d(s,)f(off_MBank)h(*mbank,)1814 1528 y(const)f
(off_pg_id_t)i(&at,)1814 1619 y(boolean_t)f(use_revocation=FALSE\))598
1710 y({)676 1802 y(off_PFrame)h(*pf=mbank->alloc\(at,use_revoca)q
(tion\))q(;)676 1893 y(\(void\)s;)676 1984 y(assert\(s)f(&&)f(mbank)g
(&&)g(mbank->valid\(\)\);)676 2076 y(assert\(!pf)i(||)d
(pf->valid\(\)\);)676 2167 y(return)i(\(void*\)pf;)598
2258 y(})639 2491 y Fz(The)28 b(op)r(erator)e Fx(delete)f
Fz(is)i(also)g(pro)n(vided.)515 2607 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2607 V 29 w(PFrame)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 2698 y Fi(//)39 b(Deallocates)j(this)e
(page)g(frame.)598 2790 y(void)g(operator)h(delete\(void)h(*p\);)515
2947 y Fk(h)p Fi(off)p 667 2947 V 29 w(PFrame::operator)g(delete)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 3039 y Fi(//)39
b(Deallocates)j(this)e(page)g(frame.)598 3130 y(void)g
(off_PFrame::operator)k(delete\(void)d(*p\))598 3221
y({)676 3313 y(off_PFrame)h(*pf=\(off_PFrame*\)p;)676
3404 y(assert\(pf)f(&&)f(pf->valid\(\)\);)676 3495 y
(\(\(off_MBank*\)\(pf->get_contai)q(ner\(\))q(\)\)->)q(free)q(\(pf\);)
598 3587 y(})639 3728 y Fz(W)-7 b(e)32 b(said)f(that)g(page)g(frames)g
(are)f(preinitialized,)i(but)g(w)n(e)f(ha)n(v)n(e)f(not)h
(preinitialized)515 3827 y(them)38 b(y)n(et.)67 b(W)-7
b(e)38 b(only)g(ha)n(v)n(e)e(to)i(iterate)f(on)h(the)g(page)f(arra)n(y)
e(and)i(set)h(the)g(con)n(tainer)515 3927 y(reference)21
b(and)g(the)h(page)f(iden)n(ti\014er.)35 b(The)21 b(magic)g(n)n(um)n(b)
r(er)h(is)f(set)h(b)n(y)g(the)g(zero-argumen)n(t)515
4027 y(page)k(constructor.)515 4159 y Fk(h)p Fj(Start)j(other)g(memb)l
(ers)f(of)f Fi(off)p 1467 4159 V 29 w(MBank)i Fj(ac)l(c)l(or)l(ding)g
(to)f Fi(mdep)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 4251
y Fi(for)40 b(\(natural_t)h(pg=mdep.a2p\(mdep.get_first\(\))q(\);)794
4342 y(pg<mdep.a2p\(mdep.get_last\(\)\);)794 4433 y(pg++\))f({)676
4525 y(off_pg_id_t)i(pid\(get_id\(\),mdep.p2a\(pg\)\);)676
4616 y(\(void\))f(new\(m_alloc+pg\))h(off_LPFrame\(pid,this\);)598
4707 y(})1885 5255 y Fz(229)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
230 231 bop 639 523 a Fz(Note)34 b(the)g(tric)n(k,)h(a)e
Fx(new)g Fz(op)r(erator)f(for)h Fx(LPFrame)e Fz(returning)i(its)h(o)n
(wn)f(argumen)n(t)g(is)515 623 y(used,)515 739 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
739 24 4 v 29 w(LPFrame)p Fj(.)h Fk(i)p Fq(\021)598 830
y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LPFrame)j(*p\))e({)f
(\(void\)s;)i(return)g(\(void*\))g(p;)f(})639 955 y Fz(then)28
b(a)g(constructor)e(will)h(initialize)h(those)f(\014elds)h(whic)n(h)g
(can)f(b)r(e)h(pre-initialized.)515 1071 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1071 V 29 w(LPFrame)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 1162 y Fi(off_LPFrame\(const)43
b(off_pg_id_t)f(&id,off_MBank)g(*c\))e(:)f(l_pf\(id,c\))j({;})639
1287 y Fz(It)28 b(calls)f(in)h(turn)g(another)e(pre-initialization)h
(constructor)f(for)h Fx(PFrame)p Fz(s.)515 1403 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1403
V 29 w(PFrame)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 1494
y Fi(off_PFrame\(const)43 b(off_pg_id_t)e(&id,off_MBank)i(*c\))c(:)676
1586 y(off_HWResUnit\(id,OFF_MAGIC_P)q(FRAME)q(,\(of)q(f_HW)q(CompR)q
(esou)q(rce*\))q(c\))598 1677 y({;})515 1934 y Fn(4.1.4)112
b(Memory)37 b(rev)m(o)s(cation)515 2088 y Fz(Eac)n(h)17
b(memory)g(bank)i(deliv)n(ers)e(rev)n(o)r(cation)f(ev)n(en)n(ts)i(to)g
(its)h(exception)f(p)r(ortal)g(or)f Fx(r)p 3088 2088
27 4 v 31 w(domain)p Fz(,)515 2187 y(in)24 b(case)e(that)i(p)r(ortal)f
(has)g(b)r(een)h(set.)36 b(The)24 b(o)n(wner)e(of)i(that)g(p)r(ortal)f
(is)g(the)h(referee)f(for)g(page)515 2287 y(rev)n(o)r(cation)j(inside)h
(the)h(memory)f(bank.)515 2420 y Fk(h)p Fi(off)p 667
2420 24 4 v 29 w(MBank::notify)j Fj(implementation.)d
Fk(i)p Fq(\021)598 2511 y Fi(//)39 b(Notifies)i(that)g(memory)f(is)g
(exhausted.)598 2602 y(void)g(off_MBank::notify\(void\))598
2694 y({)676 2785 y(assert\(valid\(\)\);)676 2876 y(if)g
(\(get_domain\(\)==OFF_PRTL_NULL\))755 2968 y(return;)676
3059 y(else)g({)755 3150 y(;)598 3242 y(#if)g(0)1059
b(//)40 b(XXX)g(fix)g(this)755 3333 y(off_ExhaustReq)i
(m\(OFF_MAGIC_MBANK,get_id\(\)\);)755 3424 y
(prtl.kpct\(get_domain\(\),off_Shtl)q(::se)q(lf\(\))q(,size)q(of\(m)q
(\),0,&)q(m,NU)q(LL,0)q(\);)598 3516 y(#endif)676 3607
y(})598 3698 y(})515 3964 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
4055 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_ExhaustReq)
598 4147 y(#include)h(<prtl/PrtlSrv.h>)278 b(//)40 b(for)g(prtl.)471
b(XXX)40 b(fix)g(this)598 4238 y(#include)h(<hw/Processor.h>)278
b(//)40 b(for)g(Processor)h(and)f(self.)1885 5255 y Fz(230)p
eop
PStoPSsaved restore
%%Page: (232,233) 117
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
231 232 bop 639 523 a Fz(As)41 b(y)n(ou)f(can)g(see,)k(no)c(reply)h(is)
f(actually)g(exp)r(ected.)77 b(But)41 b(w)n(e)f(will)h(not)g(reco)n(v)n
(er)515 623 y(con)n(trol)27 b(un)n(til)i(the)g(referee)f(decided)h(to)f
(return)h(from)f(the)h(PCT.)f(In)h(that)g(w)n(a)n(y)f(the)h(user)515
722 y(allo)r(cation)c(whic)n(h)h(triggered)f(resource)f(rev)n(o)r
(cation)h(is)h(lik)n(ely)g(to)g(b)r(e)g(satis\014ed)g(and)g(there)515
822 y(is)h(no)h(necessit)n(y)e(of)i Fx(EAGAIN)d Fz(error)h(co)r(des.)
639 922 y(The)g(rev)n(o)r(cation)e(message)h(con)n(tains)g(the)h(magic)
f(n)n(um)n(b)r(er)h(of)g(the)g(kind)g(of)g(con)n(tainer)515
1021 y(b)r(eing)34 b(exhausted)f(\(so)h(that)g(the)g(referee)f(could)h
(kno)n(w)f(whic)n(h)h(resource)e(has)h(b)r(een)i(ex-)515
1121 y(hausted\))28 b(and)f(the)h(iden)n(ti\014er)f(of)h(the)g(con)n
(tainer.)515 1254 y Fk(h)p Fj(O\013)f(user-kernel)j(messages.)f
Fk(i)p Fq(\021)598 1345 y Fi(//)39 b(Exhausted)j(message.)598
1436 y(struct)e(off_ExhaustReq)j(:)c(public)i(off_MsgReq)g({)676
1528 y(off_magic_t)81 b(m_kind;)394 b(//)40 b(Resource)h(kind)676
1619 y(off_id_t)198 b(m_id;)472 b(//)40 b(Container)h(exhausted.)676
1802 y(//)f(Creates)h(an)e(exhausted)j(request.)676 1893
y(off_ExhaustReq\(const)i(off_magic_t)e(kind,)e(const)g(off_id_t)h
(&id\))g(:)755 1984 y(off_MsgReq\(OFF_EX_UNAVAILABLE\),)46
b(m_kind\(kind\),)c(m_id\(id\))f({;})598 2076 y(};)515
2341 y Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f(dep)l(endencies.)g
Fk(i)p Fq(\021)598 2433 y Fi(#include)41 b(<klib/Magic.h>)356
b(//)40 b(for)g(off_magic_t)h(and)f(magic)h(numbers.)1885
5255 y Fz(231)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
232 233 bop 515 523 a Fn(4.1.5)112 b(Memory)37 b(na)m(vigation)g(and)i
(insp)s(ection)515 676 y FA(Memory)30 b(na)m(vigation)515
830 y Fz(The)25 b(memory)g(bank)g(na)n(vigator)e(giv)n(es)h(uniform)h
(access)f(to)h(memory)g(banks.)35 b(W)-7 b(e)26 b(imple-)515
929 y(men)n(t)i(a)f(generic)f(na)n(vigator)g(for)h(resource)e(\\banks")
h(b)r(ecause)i(all)f(of)h(them)g(are)e(similar.)515 1062
y Fk(h)p Fj(O\013)h(b)l(anks)i(navigator.)f Fk(i)p Fq(\021)598
1153 y Fi(//)39 b(A)h(B)f(bank)h(\(containing)i(Ts\))e(navigator)598
1245 y(//)598 1336 y(template)h(<class)f(B,)g(class)g(T>)598
1427 y(class)g(off_BankNav)i(:)d(public)i(off_Navigator)h({)598
1519 y(private:)676 1610 y(B)e(&n_bank;)676 1701 y Fk(h)p
Fj(Other)29 b(private)f(memb)l(ers)h(of)e Fi(off)p 1713
1701 24 4 v 29 w(BankNav)p Fj(.)i Fk(i)598 1793 y Fi(public:)676
1884 y(//)40 b(Creates)h(a)e(bank)h(navigator.)676 1975
y(off_BankNav\(B)i(&bank\))f(:)755 2067 y(n_bank\(bank\),)755
2158 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 2168 2158 V 29 w(BankNav)p Fj(.)i Fk(i)676
2249 y Fi({)79 b(assert\(bank.valid\(\)\);)44 b(})676
2432 y(//)c(Returns)h(a)e(reference)i(to)f(the)g(resource)h(being)f
(navigated)676 2523 y(virtual)h(off_Resource)h(*get_current\(void\))h
({return)e(&n_bank;})676 2706 y(//)f(Advances)h(the)f(iteration)h(and)f
(returns)h(the)f(next)g(element.)676 2797 y(virtual)h(off_Resource)h
(*get_next\(void\);)676 2888 y(//)e(Resets)g(the)g(iteration)i(so)d
(that)h(get_next)i(will)e(return)g(the)g(1st)g(element.)676
2980 y(virtual)h(void)f(reset\(void\);)676 3162 y(//)g(Selects)h(a)e
(component)i(by)f(name.)676 3254 y(virtual)h(off_Resource)h
(*operator[]\(const)h(char)d(*name\);)676 3345 y(virtual)h
(off_Resource)h(*operator[]\(const)h(off_id_t)e(&id\);)598
3619 y(};)515 3885 y Fk(h)p Fj(O\013)27 b(b)l(anks)i(navigator)g(dep)l
(endencies.)g Fk(i)p Fq(\021)598 3976 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 4067 y(#include)h
(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)h(et)e(al.)598
4159 y(#include)i(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator.)639
4300 y Fz(Memory)31 b(bank)g(na)n(vigators)d(are)i(created)h
(dynamically)-7 b(.)47 b(No)n(w)31 b(w)n(e)g(can)f(implemen)n(t)515
4399 y(this)e(metho)r(d:)515 4516 y Fk(h)p Fj(Other)g(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 4516 V 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 4607 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f
(memory)g(banks.)598 4698 y(off_Navigator)i(*get_navigator\(void\);)
1885 5255 y Fz(232)p eop
PStoPSsaved restore
%%Page: (234,235) 118
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
233 234 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(MBank::get)p 1086 523 V 30 w(navigator)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f
(memory)g(banks.)598 706 y(off_Navigator)i
(*off_MBank::get_navigator\(voi)q(d\))598 797 y({)676
888 y(return)f(new)f(off_BankNav<off_MBank,off_PFra)q(me>\(*)q(this)q
(\);)598 980 y(})515 1245 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g
(navigator)h(dep)l(endencies.)h Fk(i)p Fq(\021)598 1337
y Fi(#include)41 b(<hw/MBank.h>)434 b(//)40 b(for)g(off_MBank)598
1428 y(#include)h(<hw/PFrame.h>)395 b(//)40 b(for)g(off_PFrame)598
1519 y(#include)h(<hw/bnav.h>)473 b(//)40 b(for)g(off_BankNav)h(et)f
(al.)515 1694 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(dep)l
(endencies.)i Fk(i)o Fz(+)p Fq(\021)598 1785 y Fi(#include)41
b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)639
1926 y Fz(The)25 b(k)n(ey)e(metho)r(ds)i(are)e Fx(reset)f
Fz(and)i Fx(get)p 1957 1926 27 4 v 30 w(next)p Fz(.)35
b(They)24 b(use)g(some)g(mem)n(b)r(ers)f(to)i(k)n(eep)515
2026 y(the)j(iteration)f(state.)515 2142 y Fk(h)p Fj(Other)h(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 2142 24 4 v 29 w(BankNav)p
Fj(.)g Fk(i)p Fq(\021)598 2233 y Fi(natural_t)41 b(n_pos;)629
b(//)40 b(Resource)h(unit)f(the)g(navigator)h(is)f(pointing)h(to.)515
2391 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 2391 V 29 w(BankNav)p Fj(.)i Fk(i)p
Fq(\021)676 2482 y Fi(n_pos\(n_bank.get_first\(\)\))639
2623 y Fz(The)f(initial)g(state)f(is)h(reco)n(v)n(ered)d(b)n(y)i
Fx(reset)p Fz(.)515 2756 y Fk(h)p Fi(off)p 667 2756 V
29 w(BankNav::reset)j Fj(implementation.)e Fk(i)o Fq(\021)598
2848 y Fi(//)39 b(Resets)i(the)f(iteration)h(so)f(that)g(get_next)h
(will)f(return)h(the)f(1st)g(element.)598 2939 y(template)h(<class)f
(B,)g(class)g(T>)598 3030 y(void)g(off_BankNav<B,T>::reset\(void\))598
3122 y({)676 3213 y(n_pos=n_bank.get_first\(\);)598 3304
y(})639 3537 y Fz(Iteration)27 b(is)h(adv)-5 b(anced)27
b(b)n(y)g Fx(get)p 1681 3537 27 4 v 30 w(next)p Fz(.)515
3670 y Fk(h)p Fi(off)p 667 3670 24 4 v 29 w(BankNav::get)p
1164 3670 V 30 w(next)i Fj(implementation.)e Fk(i)p Fq(\021)598
3761 y Fi(//)39 b(Advances)i(the)f(iteration)i(and)e(returns)g(the)g
(next)g(element.)598 3852 y(template)h(<class)f(B,)g(class)g(T>)598
3944 y(off_Resource)i(*off_BankNav<B,T>::get_next\(vo)q(id\))598
4035 y({)676 4126 y(T)e(*pf=NULL;)676 4218 y(if)g
(\(n_pos<n_bank.get_last\(\)\))755 4309 y(pf=n_bank+n_pos++;)676
4400 y(return)h(pf;)598 4583 y(})1885 5255 y Fz(233)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
234 235 bop 639 523 a Fz(The)41 b(last)f(couple)g(of)g(iteration)f
(metho)r(ds)i(are)e(implemen)n(ted)i(with)g(those)f(sho)n(wn)515
623 y(ab)r(o)n(v)n(e.)515 739 y Fk(h)p Fi(off)p 667 739
24 4 v 29 w(BankNav::operator[])71 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 830 y Fi(//)39 b(Selects)i(a)f(component)h(by)f
(name.)598 922 y(template)h(<class)f(B,)g(class)g(T>)598
1013 y(off_Resource)i(*off_BankNav<B,T>::operator[]\()q(const)k(char)40
b(*name\))598 1104 y({)676 1196 y(\(void\)name;)676 1287
y(return)h(NULL;)707 b(//)40 b(Bank's)g(resource)h(units)g(have)f(no)g
(name.)598 1378 y(})515 1627 y Fk(h)p Fi(off)p 667 1627
V 29 w(BankNav::operator[])71 b Fj(implementation.)27
b Fk(i)p Fz(+)o Fq(\021)598 1719 y Fi(//)39 b(Selects)i(a)f(component)h
(by)f(id.)598 1810 y(template)h(<class)f(B,)g(class)g(T>)598
1901 y(off_Resource)i(*off_BankNav<B,T>::operator[]\()q(const)k
(off_id_t)41 b(&id\))598 1993 y({)676 2084 y(if)f
(\(id.i_node==n_bank.get_id\(\).i_)q(node)46 b(&&)833
2175 y(id)40 b(>=)f(n_bank.get_first\(\))44 b(&&)39 b(id)h(<)g
(n_bank.get_last\(\)\){)755 2267 y(return)g(n_bank+id;)676
2358 y(})676 2449 y(else)755 2540 y(return)g(NULL;)598
2723 y(})1885 5255 y Fz(234)p eop
PStoPSsaved restore
%%Page: (236,237) 119
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
235 236 bop 515 523 a FA(Memory)30 b(bank)j(insp)s(ection)515
676 y Fz(The)27 b(memory)g(bank)g(insp)r(ector's)g(attribute)h(arra)n
(y)d(lo)r(oks)i(lik)n(e)g(this:)515 793 y Fk(h)p Fj(O\013)g
Fi(mbank)h Fj(insp)l(e)l(ctor)i(attribute)g(arr)l(ay)e(initializer.)f
Fk(i)p Fq(\021)598 884 y Fi({{)39 b(OFF_STR_ATTR)j(,)e("name",)198
b(&off_MBank::nameof)43 b(},)637 975 y({)c(OFF_STR_ATTR,)82
b("class",)159 b(&off_MBank::kindof)43 b(},)637 1066
y({)c(OFF_ID_ATTR,)121 b("dom",)237 b(&off_MBank::get_domain)44
b(},)637 1158 y({)39 b(OFF_ID_ATTR,)121 b("id",)276 b
(&off_MBank::get_id)43 b(},)637 1249 y({)c(OFF_STR_ATTR,)82
b("url",)237 b(&off_MBank::get_url)43 b(},)637 1340 y({)c
(OFF_STR_ATTR,)82 b("provides",)42 b(&off_MBank::nameof)h(},)637
1432 y({)c(OFF_STR_ATTR,)82 b(NULL,)276 b(NULL)157 b(},)h(//)39
b(no)h(requeriments.)637 1523 y(//)g(Memory)g(bank)g(specific)h
(attributes.)637 1614 y({)e(OFF_BOOL_ATTR,)k("doesdma",)198
b(&off_MBank::is_dmable)44 b(},)637 1706 y({)39 b(OFF_BOOL_ATTR,)k
("doesiomap",)120 b(&off_MBank::is_iomapable)45 b(},)637
1797 y({)39 b(OFF_BOOL_ATTR,)k("doespersist",)f
(&off_MBank::is_persistent},)637 1888 y({)d(OFF_NAT_ATTR,)82
b("npgs",)315 b(&off_MBank::get_npgs},)598 2071 y(//)39
b(If)h(this)g(is)g(not)g(commented)h(out)f(I)f(get)h(a)g(g++)g
(internal)h(compiler)g(error)f(40.)598 2162 y(//)196
b(In)40 b(function)h(`\(static)g(initializers)h(for)e
(../Src/mmnav.C\)')j(:-\()d(Sic!)598 2254 y(//)f({)h(OFF_NAT_ATTR,)81
b("first",)277 b(&off_MBank::get_first},)598 2345 y(//)39
b({)h(OFF_NAT_ATTR,)81 b("last",)276 b(&off_MBank::get_last},)598
2436 y(//)39 b({)h(OFF_NAT_ATTR,)81 b("mat",)315 b
(&off_MBank::get_mat},)598 2528 y(//)39 b({)h(OFF_NAT_ATTR,)81
b("pgsize",)198 b(&off_MBank::get_pgsize},)637 2710 y({)39
b(OFF_NULL_ATTR,)k(NULL,)276 b(NULL)40 b(})f(})h(//)f(End)h(of)g
(attribute)h(list.)515 2868 y Fk(h)p Fj(O\013)27 b Fi(mbank)h
Fj(insp)l(e)l(ctor)i(attribute)g(arr)l(ay)e(length.)g
Fk(i)p Fq(\021)598 2959 y Fi(const)40 b(int)g(OFF_MINSP_NATTR=11;)122
b(//)40 b(not)g(counting)h(final)f(NULL)g(attr.)639 3101
y Fz(Giv)n(en)28 b(this)g(attribute)f(list,)h(the)g(memory)f(bank)g
(insp)r(ector)g(is)h(de\014ned)g(as)f(follo)n(ws)515
3217 y Fk(h)p Fj(O\013)g(memory)h(b)l(ank)g(insp)l(e)l(ctor.)h
Fk(i)p Fq(\021)598 3308 y Fi(//)39 b(A)h(memory)g(bank)h(inspector.)598
3399 y(//)598 3491 y(class)f(off_MBankInsp)i(:)e(public)g
(off_Inspector)j({)598 3582 y(private:)676 3673 y(static)e(off_attr_t)g
(m_attrs[OFF_MINSP_NATTR+1];)46 b(//)39 b(for)h(final)h(NULL)f(attr.)
598 3765 y(public:)676 3856 y(off_MBankInsp\(off_MBank)45
b(*mbank\))40 b(:)794 3947 y(off_Inspector\(mbank,\(const)45
b(off_attr_t)d(*\)m_attrs,)f(OFF_MINSP_NATTR\))676 4039
y({assert\(mbank)h(&&)e(mbank->valid\(\)\);})598 4130
y(};)515 4346 y Fz(Where)27 b(the)h(attribute)g(arra)n(y)d(is)j
(shared.)515 4462 y Fk(h)p Fj(O\013)f(mb)l(ank)h(insp)l(e)l(ctor)h
(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 4553 y Fi(//)39
b(inspector)j(attributes)f(for)f(mbanks.)598 4645 y(off_attr_t)h
(off_MBankInsp::m_attrs[OFF_M)q(INSP)q(_NATT)q(R+1])46
b(=)1186 4736 y Fk(h)p Fj(O\013)27 b Fi(mbank)i Fj(insp)l(e)l(ctor)g
(attribute)h(arr)l(ay)f(initializer.)d Fk(i)598 4827
y Fi(;)1885 5255 y Fz(235)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
236 237 bop 639 523 a Fz(Ev)n(ery)31 b(time)i Fx(get)p
1214 523 27 4 v 30 w(inspector)c Fz(is)j(called,)i(a)e(new)g(insp)r
(ector)g(is)h(created.)50 b(The)33 b(user)515 623 y(should)27
b Fx(delete)e Fz(it)j(whenev)n(er)f(it)h(is)f(no)h(longer)e(needed.)515
739 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
830 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(memory)h(banks)598
922 y(off_Inspector)h(*get_inspector\(void\);)515 1079
y Fk(h)p Fi(off)p 667 1079 V 29 w(MBank::get)p 1086 1079
V 30 w(inspector)30 b Fj(implementation.)d Fk(i)p Fq(\021)598
1171 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(memory)h(banks)598
1262 y(off_Inspector)h(*off_MBank::get_inspector\(voi)q(d\))637
1353 y({)676 1445 y(assert\(valid\(\)\);)676 1536 y(return)f(new)f
(off_MBankInsp\(this\);)598 1627 y(})515 1802 y Fk(h)p
Fj(O\013)27 b(memory)h(b)l(ank)g(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1893 y Fi(#include)41 b(<hw/mmnav.h>)434
b(//)40 b(for)g(off_MBankInsp)i(et)d(al)639 2034 y Fz(W)-7
b(e)28 b(ha)n(v)n(e)f(implemen)n(ted)h(neither)f Fx(get)p
1883 2034 27 4 v 31 w(url)f Fz(nor)h Fx(nameof)e Fz(y)n(et.)515
2150 y Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2150 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2242 y Fi(//)39 b(Get)h(the)g(memory)h(bank)f(URL.)598
2333 y(const)g(char)g(*get_url\(void\);)598 2424 y(//)f(Returns)i(the)f
(memory)h(bank)f(name.)598 2516 y(const)g(char)g(*nameof\(void\);)639
2640 y Fz(The)22 b(URL)g(for)g(a)f(memory)g(bank)h(is)g(that)g(of)g
(its)g(no)r(de)g(with)g Fx(mm.html)d Fz(app)r(ended.)36
b(W)-7 b(e)515 2740 y(use)26 b(a)g(new)g(mem)n(b)r(er,)h(a)f(c)n
(haracter)e(arra)n(y)g(initialized)j(the)g(v)n(ery)e(\014rst)h(time)h
(it)g(is)f(needed.)515 2856 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 2856 V 29 w(MBank)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 2947 y Fi(static)40 b(char)g(*m_url;)512
b(//)40 b(URL)g(for)g(this)g(memory)g(bank.)639 3072
y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7 b(.)515 3188
y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(static)h(memb)l(ers.)f
Fk(i)p Fz(+)p Fq(\021)598 3279 y Fi(char)40 b(*off_MBank::m_url=NULL;)
162 b(//)40 b(URL)g(for)g(memory)g(banks.)515 3437 y
Fk(h)p Fi(off)p 667 3437 V 29 w(MBank::get)p 1086 3437
V 30 w(url)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3528 y Fi(//)39 b(Get)h(the)g(memory)h(bank)f(URL.)598
3620 y(const)g(char)g(*off_MBank::get_url\(void\))598
3711 y({)676 3802 y(assert\(valid\(\)\);)676 3894 y(if)g(\(!m_url\){)
755 3985 y(m_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_M)q(BANK_)q(URL\))q(+1];)46 b(//)39 b(+1)h(for)g(\\0)755
4076 y(if)f(\(m_url\))833 4168 y(sprintf\(m_url,"\045s\045s",nd.get_u)q
(rl\(\))q(,OFF)q(_MBAN)q(K_UR)q(L\);)676 4259 y(})676
4350 y(return)i(m_url;)598 4442 y(})639 4674 y Fz(Where)28
b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n(e)f(URL)g(for)h
(memory)e(banks.)515 4790 y Fk(h)p Fj(O\013)h(sour)l(c)l(e)i(c)l(o)l
(de)g(urls.)e Fk(i)p Fq(\021)598 4882 y Fi(const)40 b(char)g
(OFF_MBANK_URL[]="/mm.html";)1885 5255 y Fz(236)p eop
PStoPSsaved restore
%%Page: (238,239) 120
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
237 238 bop 515 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(dep)l
(endencies.)i Fk(i)o Fz(+)p Fq(\021)598 614 y Fi(#include)41
b(<klib/url.h>)434 b(//)40 b(for)g(OFF_MBANK_URL)515
789 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 880 y Fi(#include)41
b(<stdio.h>)551 b(//)40 b(for)g(sprintf)g(et)g(al)598
971 y(#include)h(<node/Node.h>)395 b(//)40 b(for)g(nd)639
1112 y Fz(The)26 b(name)g(for)f(a)h(memory)f(bank)g(is)h(that)g(of)g
(its)g(no)r(de)g(complemen)n(ted)g(with)g(a)f(little)515
1212 y(su\016x.)43 b(The)30 b(implemen)n(tation)g(is)g(almost)f(the)h
(same)f(of)h Fx(get)p 2486 1212 27 4 v 30 w(url)p Fz(,)g(ho)n(w)n(ev)n
(er,)e(the)i(name)515 1312 y(is)d(not)h(shared)e(among)h(memory)g
(banks)g(in)h(the)g(same)f(no)r(de)g(\(i.e.)37 b(it)28
b(is)g(not)g Fx(static)p Fz(\).)515 1445 y Fk(h)p Fi(off)p
667 1445 24 4 v 29 w(MBank::nameof)i Fj(implementation.)d
Fk(i)p Fq(\021)598 1536 y Fi(//)39 b(Returns)i(the)f(memory)h(bank)f
(name.)598 1627 y(const)g(char)g(*off_MBank::nameof\(void\))598
1719 y({)676 1810 y(assert\(valid\(\)\);)676 1901 y(if)g(\(!m_name\){)
755 1993 y(m_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q
(\("/m)q(bank")q(\)+10)q(];)45 b(//)40 b(for)g(N...N\\0)755
2084 y(if)f(\(m_name\))833 2175 y(sprintf\(m_name,"\045s/mbank\04508x")
q(,nd.)q(name)q(of\(\),)q(get_)q(first)q(\(\)\);)676
2267 y(})676 2358 y(return)i(m_name;)598 2449 y(})515
2715 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2715 V 29 w(MBank)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 2806 y Fi(char)40 b(*m_name;)747 b(//)40
b(name)g(for)g(this)g(memory)g(bank.)515 2980 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 2980 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3072 y Fi(m_name\(NULL\))515 3329 y FA(P)m(age)k(frame)f
(insp)s(ection)515 3482 y Fz(P)n(age)26 b(frames)h(can)h(b)r(e)g(insp)r
(ected)h(to)r(o.)38 b(The)28 b(attribute)g(arra)n(y)e(of)i(their)g
(insp)r(ectors)f(is)h(as)515 3582 y(follo)n(ws.)515 3698
y Fk(h)p Fj(O\013)f Fi(pframe)i Fj(insp)l(e)l(ctor)g(attribute)h(arr)l
(ay)f(initializer.)d Fk(i)p Fq(\021)598 3790 y Fi({{)39
b(OFF_STR_ATTR)j(,)e("name",)198 b(&off_PFrame::nameof)43
b(},)637 3881 y({)c(OFF_STR_ATTR,)82 b("class",)159 b
(&off_PFrame::kindof)43 b(},)637 3972 y({)c(OFF_ID_ATTR,)121
b("dom",)237 b(&off_PFrame::get_domain)44 b(},)637 4064
y({)39 b(OFF_ID_ATTR,)121 b("id",)276 b(&off_PFrame::get_id)43
b(},)637 4155 y({)c(OFF_STR_ATTR,)82 b("url",)237 b
(&off_PFrame::get_url)43 b(},)637 4246 y({)c(OFF_STR_ATTR,)82
b("provides",)42 b(&off_PFrame::nameof)h(},)637 4337
y({)c(OFF_STR_ATTR,)82 b(NULL,)276 b(NULL)157 b(},)h(//)39
b(no)h(requeriments.)637 4429 y(//)g(Page)g(frame)g(specific)h
(attributes.)637 4520 y({)e(OFF_ID_ATTR,)121 b("container",)f
(&off_PFrame::get_container)45 b(},)637 4611 y({)39 b(OFF_NAT_ATTR,)82
b("bits",)315 b(&off_PFrame::get_bits)44 b(},)637 4703
y({)39 b(OFF_NULL_ATTR,)k(NULL,)276 b(NULL)40 b(})f(})h(//)f(End)h(of)g
(attribute)h(list.)515 4861 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g
(insp)l(e)l(ctor)h(attribute)h(arr)l(ay)f(length.)f Fk(i)p
Fq(\021)598 4952 y Fi(const)40 b(int)g(OFF_PFINSP_NATTR=9;)122
b(//)40 b(not)g(counting)h(final)f(NULL)g(attr.)1885
5255 y Fz(237)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
238 239 bop 639 523 a Fz(W)-7 b(e)19 b(need)g Fx(get)p
1095 523 27 4 v 30 w(rurl)d Fz(and)j Fx(get)p 1602 523
V 30 w(url)p 1764 523 V 30 w(holder)d Fz(for)i(page)f(frames)h(to)g
(supp)r(ort)g Fx(ResUnit::get)p 3551 523 V 27 w(url)p
Fz(.)515 656 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e
(of)e Fi(off)p 1594 656 24 4 v 29 w(PFrame)p Fj(.)h Fk(i)p
Fq(\021)598 747 y Fi(//)39 b(Get)h(the)g(page)g(URL.)598
839 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)g
(OFF_PFRAME_URL;)j(})598 930 y(//)c(Returns)i(the)f(page)g(name.)598
1021 y(virtual)h(char)f(*&get_url_holder\(void\);)639
1162 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(page)e(frames.)515 1279 y Fk(h)p Fj(O\013)h(sour)l(c)l
(e)i(c)l(o)l(de)g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 1370
y Fi(const)40 b(char)g(OFF_PFRAME_URL[]="#PFrame";)515
1528 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1619 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_PFRAME_URL)515 1793 y Fk(h)p Fj(O\013)27
b(p)l(age)h(fr)l(ame)g(implementation)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 1885 y Fi(#include)41 b(<stdio.h>)551
b(//)40 b(for)g(sprintf)g(et)g(al)639 2026 y Fz(URLs)28
b(are)f(the)h(same)f(for)g(all)g(page)g(frames.)515 2142
y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 2142 V 29 w(PFrame)p Fj(.)g Fk(i)p Fq(\021)598 2233
y Fi(static)40 b(char)g(*p_url;)512 b(//)40 b(URL)g(for)g(this)g(page)g
(frame.)515 2391 y Fk(h)p Fi(off)p 667 2391 V 29 w(PFrame::get)p
1125 2391 V 30 w(url)p 1272 2391 V 29 w(holder)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 2482 y Fi(char)40 b
(*&off_PFrame::get_url_holder\(v)q(oid\))46 b({)79 b(return)40
b(p_url;)h(})639 2623 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 2740 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(static)h(memb)
l(ers.)f Fk(i)p Fq(\021)598 2831 y Fi(char)40 b
(*off_PFrame::p_url=NULL;)123 b(//)40 b(URL)g(for)g(page)g(frames.)639
2956 y Fz(Giv)n(en)32 b(the)h(attribute)g(list)f(sho)n(wn)g(ab)r(o)n(v)
n(e,)g(a)g(page)g(frame)g(insp)r(ector)g(is)g(de\014ned)h(as)515
3055 y(follo)n(ws.)515 3171 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g
(insp)l(e)l(ctor.)h Fk(i)p Fq(\021)598 3263 y Fi(//)39
b(A)h(page)g(frame)g(inspector.)598 3354 y(//)598 3445
y(class)g(off_PFrameInsp)j(:)c(public)i(off_Inspector)h({)598
3537 y(private:)676 3628 y(static)f(off_attr_t)g
(p_attrs[OFF_PFINSP_NATTR+1];)46 b(//)40 b(for)f(final)i(NULL)f(attr.)
598 3719 y(public:)676 3811 y(off_PFrameInsp\(off_PFrame)45
b(*pf\))40 b(:)794 3902 y(off_Inspector\(pf,)j(p_attrs,)e
(OFF_PFINSP_NATTR\))676 3993 y({assert\(pf)h(&&)d(pf->valid\(\)\);})598
4085 y(};)639 4301 y Fz(Where)28 b(the)g(attribute)f(arra)n(y)f(is)h
(shared.)515 4417 y Fk(h)p Fj(O\013)g(p)l(age)h(fr)l(ame)g(insp)l(e)l
(ctor)h(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 4508
y Fi(//)39 b(inspector)j(attributes)f(for)f(page)g(frames.)598
4599 y(off_attr_t)h(off_PFrameInsp::p_attrs[OFF_)q(PFIN)q(SP_NA)q(TTR+)
q(1])k(=)1186 4691 y Fk(h)p Fj(O\013)27 b Fi(pframe)i
Fj(insp)l(e)l(ctor)h(attribute)f(arr)l(ay)g(initializer.)e
Fk(i)598 4782 y Fi(;)1885 5255 y Fz(238)p eop
PStoPSsaved restore
%%Page: (240,241) 121
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
239 240 bop 639 523 a Fz(Ev)n(ery)31 b(time)i Fx(get)p
1214 523 27 4 v 30 w(inspector)c Fz(is)j(called,)i(a)e(new)g(insp)r
(ector)g(is)h(created.)50 b(The)33 b(user)515 623 y(should)27
b Fx(delete)e Fz(it)j(whenev)n(er)f(it)h(is)f(no)h(longer)e(needed.)515
756 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 756 24 4 v 29 w(PFrame)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
847 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(page)g(frames.)598
938 y(off_Inspector)i(*get_inspector\(void\);)515 1112
y Fk(h)p Fi(off)p 667 1112 V 29 w(PFrame::get)p 1125
1112 V 30 w(inspector)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 1204 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(page)g
(frames.)598 1295 y(off_Inspector)i(*off_PFrame::get_inspector\(vo)q
(id\))598 1386 y({)676 1478 y(assert\(valid\(\)\);)676
1569 y(return)f(new)f(off_PFrameInsp\(this\);)598 1660
y(})515 1835 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
1926 y Fi(#include)41 b(<hw/mmnav.h>)434 b(//)40 b(for)g
(off_PFrameInsp)i(et)e(al)515 2183 y FA(Memory)30 b(bank)j(na)m
(vigation)f(and)g(insp)s(ection)e Fg(C)7 b Fx(++)31 b
FA(source)h(\014les)515 2337 y Fz(The)e(na)n(vigation)f(and)h(insp)r
(ection)h(co)r(de)f(for)g(memory)f(banks)h(is)g(k)n(ept)g(in)h
Fx(hw/mmnav.h)p Fz(.)515 2436 y(Generic)c(bank)g(na)n(vigation)f(co)r
(de)i(is)f(k)n(ept)g(in)h Fx(hw/bnav.h)p Fz(.)515 2569
y Fk(h)p Fj(bnav.h*)11 b Fk(i)p Fq(\021)598 2660 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 2752 y Fi(#ifndef)41 b(__OFF_BANK_NAV_H)598
2843 y(#define)g(__OFF_BANK_NAV_H)h(1)598 3026 y Fk(h)p
Fj(O\013)27 b(b)l(anks)i(navigator)g(dep)l(endencies.)g
Fk(i)598 3208 y(h)p Fj(O\013)e(b)l(anks)i(navigator.)f
Fk(i)598 3482 y Fi(#endif)40 b(//)g(__OFF_BANK_NAV_H)598
3665 y(#ifndef)h(__OFF_BANK_NAV_C)598 3756 y(#define)g
(__OFF_BANK_NAV_C)h(1)598 3939 y Fk(h)p Fi(off)p 750
3939 V 29 w(BankNav::reset)30 b Fj(implementation.)e
Fk(i)598 4030 y(h)p Fi(off)p 750 4030 V 29 w(BankNav::get)p
1247 4030 V 31 w(next)g Fj(implementation.)f Fk(i)598
4122 y(h)p Fi(off)p 750 4122 V 29 w(BankNav::operator[])71
b Fj(implementation.)27 b Fk(i)598 4304 y Fi(#endif)40
b(//)g(__OFF_BANK_NAV_C)1885 5255 y Fz(239)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
240 241 bop 515 523 a Fk(h)p Fj(mmnav.h*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y Fi(#ifndef)41
b(__OFF_MBANK_NAV_H)598 797 y(#define)g(__OFF_MBANK_NAV_H)i(1)598
980 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(navigator)h(dep)l
(endencies.)h Fk(i)598 1162 y(h)p Fj(O\013)d Fi(mbank)i
Fj(insp)l(e)l(ctor)g(attribute)h(arr)l(ay)e(length.)g
Fk(i)598 1254 y(h)p Fj(O\013)f(p)l(age)h(fr)l(ame)g(insp)l(e)l(ctor)h
(attribute)h(arr)l(ay)f(length.)f Fk(i)598 1436 y Fi(#ifdef)40
b(__KERNEL__)598 1528 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(insp)l
(e)l(ctor.)h Fk(i)598 1619 y(h)p Fj(O\013)e(p)l(age)h(fr)l(ame)g(insp)l
(e)l(ctor.)h Fk(i)598 1710 y Fi(#endif)40 b(//)g(__KERNEL__)598
1984 y(#endif)g(//)g(__OFF_MBANK_NAV_H)515 2159 y Fk(h)p
Fj(mmnav.C*)11 b Fk(i)o Fq(\021)598 2250 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2433 y Fi(#include)41 b(<hw/mmnav.h>)434 b(//)40
b(Exported)h(interface.)598 2615 y Fk(h)p Fj(O\013)27
b(mb)l(ank)h(insp)l(e)l(ctor)h(static)g(memb)l(ers.)f
Fk(i)598 2707 y(h)p Fj(O\013)f(p)l(age)h(fr)l(ame)g(insp)l(e)l(ctor)h
(static)g(memb)l(ers.)f Fk(i)1885 5255 y Fz(240)p eop
PStoPSsaved restore
%%Page: (242,243) 122
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
241 242 bop 515 523 a Fn(4.1.6)112 b(F)-9 b(rozen)38
b(memory)515 676 y FA(F)-8 b(reezing)31 b(memory)e(banks)515
830 y Fz(Memory)d(banks)h(implemen)n(t)i(metho)r(ds)e(used)h(b)n(y)f
Fx(freeze)f Fz(and)h Fx(melt)p Fz(.)639 929 y(There)g(are)g(t)n(w)n(o)g
(w)n(a)n(ys)f(to)h(freeze)g(a)h(memory)e(bank:)616 1095
y(1.)41 b(Eagerly)-7 b(,)21 b(b)n(y)h(freezing)g(ev)n(ery)e(page)h
(frame)h(\(i.e.)35 b(forbidding)22 b(write)g(access)e(to)i(ev)n(ery)722
1195 y(page)27 b(frame\))g(and)h(the)g(memory)f(bank)g(itself.)616
1361 y(2.)41 b(Lazily)-7 b(,)37 b(b)n(y)f(still)f(allo)n(wing)g(write)g
(access)f(to)i(ev)n(ery)e(page)h(frame)g(un)n(til)h(the)g(user)722
1460 y(freezes)f(ev)n(ery)f(page)g(page)h(on)g(his)g(o)n(wn)g(and)g
(freezing)f(just)i(the)g(memory)e(bank)722 1560 y(state)28
b(\(this)g(forbids)f(b)r(oth)h(memory)f(allo)r(cation)f(and)i(rev)n(o)r
(cation\).)639 1726 y(W)-7 b(e)29 b(implemen)n(t)g(the)f(second)g(one)g
(b)r(ecause)g(the)g(\014rst)g(one)g(can)g(b)r(e)h(implemen)n(ted)f(b)n
(y)515 1826 y(system)c(users)f(whic)n(h)h(prefer)f(it)i(that)f(w)n(a)n
(y)-7 b(.)34 b(Besides,)25 b(b)n(y)e(implemen)n(ting)i(the)f(second)f
(one)515 1925 y(applications)g(can)h(still)g(run)g(un)n(til)h(they)f
(pro)r(duce)g(further)g(ph)n(ysical)f(memory)g(allo)r(cation)515
2025 y(requests.)639 2125 y(W)-7 b(e)28 b(m)n(ust)g(implemen)n(t)g
(these)g(metho)r(ds)g(to)f(supp)r(ort)h Fx(freeze)p Fz(:)515
2258 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2258 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2349 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
2440 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 2531 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2623 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2714
y(const)f(off_prtl_id_t)i(&frozen_domain\);)598 2897
y(//)d(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f(toavail)
h(bytes.)598 2988 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e
(size_t)f(&toavail\))h(const;)639 3129 y Fz(as)27 b(w)n(ell)h(as)e
(these)i(others)f(to)g(supp)r(ort)h Fx(melt)p Fz(:)515
3245 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3245 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3337 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
3428 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 3519 y(//)f(return.)598
3611 y(virtual)i(err_t)f(cleanup\(void\);)598 3702 y(//)f(Restores)i
(the)f(static)h(state)f(from)g(a)g(user)g(supplied)h(buffer.)598
3793 y(virtual)g(err_t)f(restore_state\(char)j(*&buf,)e(size_t)f
(&bsize\);)598 3885 y(//)f(Restores)i(dynamic)g(resource)g(state.)598
3976 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 4067 y(const)h(off_prtl_id_t)h
(&melted_domain\);)1885 5255 y Fz(241)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
242 243 bop 639 523 a Fz(The)29 b(most)f(simple)g(are)f
Fx(cleanup)f Fz(and)i Fx(copy)p 2090 523 27 4 v 29 w(state)p
Fz(.)37 b(An)n(y)28 b(existing)g(memory)f(bank)515 623
y(insp)r(ector)g(is)g(also)g(deleted.)515 739 y Fk(h)p
Fi(off)p 667 739 24 4 v 29 w(MBank::cleanup)j Fj(implementation.)e
Fk(i)o Fq(\021)598 830 y Fi(//)39 b(Does)i(resource)g(cleanup.)g(No)e
(external)i(resource)g(should)g(be)f(used)g(after)598
922 y(//)f(return.)598 1013 y(err_t)h(off_MBank::cleanup\(void\))598
1104 y({)676 1196 y(assert\(valid\(\))j(&&)c(m_name)i(&&)f(m_url\);)676
1287 y(delete[])h(m_name;)676 1378 y(delete[])g(m_url;)676
1469 y(return)g(EOK;)598 1561 y(})515 1810 y Fk(h)p Fi(off)p
667 1810 V 29 w(MBank::copy)p 1125 1810 V 30 w(state)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 1901 y Fi(//)39
b(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h
(bytes.)598 1993 y(err_t)f(off_MBank::copy_state\(char)45
b(*&curto,)c(size_t)g(&toavail\))g(const)598 2084 y({)676
2175 y(assert\(valid\(\)\);)676 2267 y(if)f(\(curto\){)755
2358 y(if)f(\(toavail<sizeof\(*this\)\))833 2449 y(return)i(ENOSPC;)755
2540 y(//*\(off_MBank*\)curto)i(=)d(*this;)g(XXX)755
2632 y(curto)g(+=)g(sizeof\(*this\);)755 2723 y
(toavail-=sizeof\(*this\);)676 2814 y(})676 2906 y(return)h(EOK;)598
2997 y(})639 3230 y Fz(The)24 b(coun)n(terpart,)f Fx(restore)p
1589 3230 27 4 v 29 w(state)p Fz(,)f(uses)i Fx(can)p
2188 3230 V 30 w(melt)e Fz(to)i(kno)n(w)f(if)h(the)g(frozen)f(mem-)515
3329 y(ory)j(bank)i(can)f(b)r(e)h(melted)g(on)f(this)h(one.)515
3445 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3445 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 3537 y Fi(//)39 b(Is)h(the)g(other)g(bank)h
(meltable)g(at)e(this)h(one?)598 3628 y(boolean_t)h(can_melt\(const)h
(off_MBank)g(*other\))f(const;)1885 5255 y Fz(242)p eop
PStoPSsaved restore
%%Page: (244,245) 123
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
243 244 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(MBank::restore)p 1242 523 V 31 w(state)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Restores)i(the)f(static)h(state)f
(from)g(a)g(user)g(supplied)h(buffer.)598 706 y(err_t)f
(off_MBank::restore_state\(char)46 b(*&buf,)41 b(size_t)f(&bsize\))598
797 y({)676 888 y(off_MBank)h(*other=\(off_MBank*\)buf;)676
980 y(assert\(valid\(\)\);)676 1071 y(if)f(\(buf\){)755
1162 y(if)f(\(bsize)i(<)e(sizeof\(*this\))k(||)c(!can_melt\(other\)\){)
833 1254 y(return)i(EINVAL;)755 1345 y(})755 1436 y
(assert\(other->valid\(\)\);)755 1528 y(//*this=*other;)h(XXX)755
1619 y(bsize-=sizeof\(*this\);)755 1710 y(buf+=sizeof\(*this\);)676
1802 y(})676 1893 y(return)f(EOK;)598 1984 y(})639 2217
y Fz(The)32 b(frozen)f(memory)f(bank)h(can)g(b)r(e)h(melted)g(only)f
(if)h(addresses)e(con)n(tained)h(in)h(the)515 2316 y(frozen)38
b(bank)h(are)g(v)-5 b(alid)39 b(for)g(us.)72 b(Otherwise)38
b(a)h(\\bigger")e(memory)h(bank)h(migh)n(t)h(b)r(e)515
2416 y(needed.)d(Besides,)27 b(w)n(e)g(should)g(c)n(hec)n(k)g(that)h(w)
n(e)f(do)g(not)h(lo)r(ose)f(memory)g(features.)515 2532
y Fk(h)p Fi(off)p 667 2532 V 29 w(MBank::can)p 1086 2532
V 30 w(melt)h Fj(implementation.)g Fk(i)p Fq(\021)598
2623 y Fi(//)39 b(Is)h(the)g(other)g(bank)h(meltable)g(at)e(this)h
(one?)598 2715 y(boolean_t)h(off_MBank::can_melt\(const)k(off_MBank)c
(*other\))g(const)598 2806 y({)676 2897 y(//)f(NB:)g(Perhaps)h(we)e
(should)i(relax)f(and)g(allow)h(`degraded')g(melts)676
2989 y(//)197 b(where)40 b(some)g(features)h(are)f(missing.)h(XXX)676
3080 y(//)197 b(Besides,)41 b(only)f(addresses)h(for)f(allocated)h
(pages)g(need)f(to)g(be)676 3171 y(//)197 b(taken)40
b(into)g(account,)h(not)f(every)h(address.)676 3263 y
(assert\(valid\(\))i(&&)c(other)i(&&)e(other->valid\(\)\);)676
3354 y(return)i(\()e(!)79 b(\(\(other->is_dmable\(\))201
b(&&)39 b(!is_dmable\(\)\))160 b(||)1186 3445 y
(\(other->is_iomapable\(\))84 b(&&)39 b(!is_iomapable\(\)\))k(||)1186
3537 y(\(other->is_persistent\(\))i(&&)39 b(!is_persistent\(\)\))k(\))
1029 3628 y(&&)d(\(other->get_first\(\))j(>=)d(get_first\(\))i(&&)1186
3719 y(other->get_last\(\))82 b(<=)40 b(get_last\(\))81
b(&&)1186 3811 y(other->get_mat\(\))121 b(>=)40 b(get_mat\(\))120
b(&&)1186 3902 y(other->get_pgsize\(0\))44 b(>=)c(get_pgsize\(0\))i(&&)
1186 3993 y(other->get_pgsize\(0\))i(\045)39 b(get_pgsize\(0\))k(==)c
(0\)\);)598 4085 y(})1885 5255 y Fz(243)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
244 245 bop 639 523 a Fz(Note)24 b(ho)n(w,)f(with)h(resp)r(ect)f(to)g
(page)g(sizes,)h(w)n(e)f(admit)g(melts)h(whenev)n(er)e(the)i(page)e
(size)515 623 y(in)i(the)h(frozen)f(bank)g(is)g(an)g(in)n(tegral)f(m)n
(ultiple)i(of)f(the)g(page)g(size)g(in)g(this)h(bank)f(\(this)h(ma)n(y)
515 722 y(require)h(some)h(adjustmen)n(t)1408 692 y Fp(3)1474
722 y Fz(when)g(melting)h(frozen)f(pages\).)639 822 y(T)-7
b(o)35 b(freeze)g(\(or)f(melt\))i(the)f(state)g(of)g(a)g(memory)f(bank)
g(w)n(e)h(m)n(ust)g(freeze)g(\(or)f(melt\))515 922 y(dynamic)h(mem)n(b)
r(ers)f(of)h(the)h(bank)e(and)h(also)f(the)i(page)e(allo)r(cator)f(b)r
(eing)i(used.)59 b(Only)515 1021 y(the)38 b(allo)r(cator)d(itself)j(is)
g(a\013ected,)i(page)d(frames)f(will)i(remain)f(melted.)67
b(That)38 b(means)515 1121 y(that)c(ev)n(ery)f(page)g(service)f(\(but)j
(for)f(allo)r(cation)e(and)i(deallo)r(cation\))f(is)h(still)g(a)n(v)-5
b(ailable.)515 1220 y(Applications)28 b(can)f(k)n(eep)h(on)f(running)h
(while)g(the)h(memory)e(bank)g(is)h(b)r(eing)g(transferred.)515
1320 y(The)38 b(application)g(issuing)f(the)i Fx(freeze)d
Fz(is)i(exp)r(ected)g(to)g(ev)n(en)n(tually)g(freeze)g(its)g(page)515
1420 y(frames)27 b(to)r(o.)515 1553 y Fk(h)p Fi(off)p
667 1553 24 4 v 29 w(MBank::freeze)p 1203 1553 V 31 w(state)h
Fj(implementation.)g Fk(i)p Fq(\021)598 1644 y Fi(//)39
b(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e(buf)h(with)g
(avail)h(bytes.)598 1735 y(err_t)f(off_MBank::freeze_state\(char)46
b(*buf,)40 b(char)g(*&curbuf,)h(size_t)g(&avail,)1775
1826 y(char)f(*&curto,)h(size_t)f(&toavail,)1775 1918
y(const)g(off_prtl_id_t)i(&frozen_domain\))598 2009 y({)676
2100 y(assert\(valid\(\))h(&&)c(buf)h(&&)g(curbuf\);)676
2192 y(if)g(\(!::freeze\(m_name,buf,curbuf,a)q(vail)q(\))45
b(||)833 2283 y(!::freeze\(m_url,buf,curbuf,av)q(ail\))q(\))755
2374 y(return)40 b(ENOSPC;)676 2466 y(set_domain\(frozen_domain\);)676
2557 y(return)h(m_alloc.freeze_state\(buf,curbu)q(f,av)q(ail,c)q(urto)q
(,toav)q(ail\))q(;)598 2648 y(})515 2914 y Fk(h)p Fj(O\013)27
b(memory)h(b)l(ank)g(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 3005 y Fi(#include)41 b(<klib/freeze.h>)317
b(//)40 b(for)g(::freeze,)h(::melt)f(et)g(al.)515 3180
y Fk(h)p Fi(off)p 667 3180 V 29 w(MBank::melt)p 1125
3180 V 30 w(state)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
3271 y Fi(//)39 b(Restores)i(dynamic)g(resource)g(state.)598
3362 y(err_t)f(off_MBank::melt_state\(char)45 b(*&buf,)c(size_t)f
(&bsize,)1696 3454 y(char)g(*&from,)h(size_t)g(&size,)1696
3545 y(const)f(off_prtl_id_t)j(&melted_domain\))598 3636
y({)676 3728 y(assert\(valid\(\))g(&&)c(buf)h(&&)g(bsize>0\);)676
3819 y(m_name=::melt\(m_name,buf,bsi)q(ze\);)676 3910
y(m_url=::melt\(m_url,buf,bsize)q(\);)676 4002 y
(set_domain\(melted_domain\);)676 4093 y(return)h
(m_alloc.melt_state\(buf,bsize,f)q(rom,)q(size\))q(;)598
4184 y(})p 515 4929 1146 4 v 607 4983 a Fm(3)642 5006
y Fl(grouping)24 b(some)f(pages)h(to)g(\\em)n(ulate")h(a)e(single)h
(page)h(of)e(the)h(melted)g(bank.)1885 5255 y Fz(244)p
eop
PStoPSsaved restore
%%Page: (246,247) 124
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
245 246 bop 515 523 a FA(F)-8 b(reezing)31 b(page)h(frames)515
676 y Fz(W)-7 b(e)28 b(need)f(to)h(implemen)n(t)g(only)f(these)h(metho)
r(ds:)515 791 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)
e Fi(off)p 1594 791 24 4 v 29 w(PFrame)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 883 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 974 y(virtual)g(err_t)f
(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h(const;)598
1157 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1248 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 1339 y(//)f(Restores)i(dynamic)g
(resource)g(state.)515 1493 y Fk(h)p Fi(off)p 667 1493
V 29 w(PFrame::copy)p 1164 1493 V 30 w(state)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 1585 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 1676 y(err_t)f
(off_PFrame::copy_state\(char)45 b(*&curto,)d(size_t)e(&toavail\))h
(const)598 1767 y({)676 1859 y(assert\(valid\(\)\);)676
1950 y(if)f(\(curto\){)755 2041 y(if)f(\(toavail<sizeof\(*this\)\))833
2133 y(return)i(ENOSPC;)755 2224 y(*\(off_PFrame*\)curto)i(=)d(*this;)
755 2315 y(assert\(\(\(off_PFrame*\)curto\)->va)q(lid\()q(\)\);)755
2407 y(curto)g(+=)g(sizeof\(*this\);)755 2498 y
(toavail-=sizeof\(*this\);)676 2589 y(})676 2681 y(return)h(EOK;)598
2772 y(})639 3002 y Fz(Note)28 b(ho)n(w)e(in)i(this)g(one)e(w)n(e)h
(tak)n(e)g(care)f(that)i(the)g(reference)e(to)h(the)h(con)n(tainer)e
(is)h(not)515 3102 y(a\013ected)g(b)n(y)h(the)g(state)f(restore.)515
3232 y Fk(h)p Fi(off)p 667 3232 V 29 w(PFrame::restore)p
1281 3232 V 31 w(state)i Fj(implementation.)e Fk(i)p
Fq(\021)598 3323 y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g
(a)g(user)g(supplied)h(buffer.)598 3415 y(err_t)f
(off_PFrame::restore_state\(cha)q(r)45 b(*&buf,)c(size_t)f(&bsize\))598
3506 y({)676 3597 y(off_PFrame)i(*other=\(off_PFrame*\)buf;)676
3689 y(assert\(valid\(\)\);)676 3780 y(if)e(\(buf\){)755
3871 y(off_MBank)h(*bank=\(off_MBank*\)get_contain)q(er\(\);)755
3963 y(if)e(\(bsize)i(<)e(sizeof\(*this\)\){)833 4054
y(return)i(EINVAL;)755 4145 y(})755 4237 y(assert\(other->valid\(\)\);)
755 4328 y(*this=*other;)755 4419 y(set_container\(bank\);)755
4511 y(buf+=sizeof\(*this\);)755 4602 y(bsize-=sizeof\(*this\);)676
4693 y(})676 4784 y(return)g(EOK;)598 4876 y(})1885 5255
y Fz(245)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
246 247 bop 515 523 a Fn(4.1.7)112 b(Dumping)37 b(memory)515
676 y Fz(T)-7 b(o)27 b(dump)h(a)f(memory)g(bank)g(w)n(e)h(use)f(this)h
(op)r(erator.)515 793 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 793 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 884 y Fi(//)39 b(Dumps)i(mbank)f(state.)598
975 y(friend)g(OStr)g(&operator<<\(OStr)j(&s,)d(off_MBank)i(&m\);)515
1133 y Fk(h)p Fi(off)p 667 1133 V 29 w(MBank::operator<<)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 1224 y Fi(//)39
b(Dumps)i(mbank)f(state.)598 1316 y(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_MBank)41 b(&m\))598 1407 y({)676 1498 y(s)f(<<)f
(*\(off_HWCompResource*\)&m)45 b(<<)40 b(nl;)676 1681
y(s)g(<<)f("name=")i(<<)f(m.nameof\(\))h(<<)f(")f(url=")i(<<)f
(m.get_url\(\))h(<<)f(nl;)676 1772 y(s)g(<<)f("first=")i(<<)f
(fmt\("\04508x",m.get_first\(\)\))45 b(<<)872 1863 y(")40
b(last=")80 b(<<)39 b(fmt\("\04508x",m.get_last\(\)\))84
b(<<)872 1955 y(fmt\(")41 b(\(\045d)f(pages\)",m.get_npgs\(\)\))k(<<)39
b(":";)676 2137 y(for)h(\(vm_size_t)i(sz=0;\(sz=m.get_pgsize\(sz\)\))j
(!=)39 b(0;)h(\){)755 2229 y(if)f(\(sz\))833 2320 y(s)h(<<)f(")h(";)755
2411 y(s)f(<<)h(fmt\("\045d",sz\);)676 2503 y(})676 2594
y(s)g(<<)f(")h(sizes.")h(<<)e(nl;)676 2777 y(for)h(\(vm_offset_t)i
(p=m.get_first\(\),old=p;)i(p)c(<)f(m.get_last\(\))j(;)872
2868 y(old=p,p+=m.get_pgsize\(\)\){)755 2959 y(if)d
(\(p==m.get_first\(\))k(||)755 3051 y(\(m+old\)->get_domain\(\))h(!=)39
b(\(m+p\)->get_domain\(\)\){)833 3142 y(if)h(\(p>m.get_first\(\)\))912
3233 y(s<<")g(-)f("<<fmt\("\04505x",m.a2p\(p-m.get_)q(pgsiz)q(e\(\)\))q
(\))45 b(<<"]")40 b(<<nl;)833 3325 y(if)g(\(\(m+p\)->get_domain\(\))k
(==)39 b(OFF_PRTL_NULL\))912 3416 y(s)g(<<)h("available)747
b([")40 b(<<)g(fmt\("\04505x",m.a2p\(p\)\);)833 3507
y(else)g(if)g(\(\(m+p\)->get_domain\(\))k(==)39 b(nd.get_domain\(\)\))
912 3599 y(s)g(<<)h("kernel)864 b([")40 b(<<)g
(fmt\("\04505x",m.a2p\(p\)\);)833 3690 y(else)912 3781
y(s)f(<<)h(\(m+p\)->get_domain\(\))j(<<)d("[")g(<<)g
(fmt\("\04505x",m.a2p\(p\)\);)755 3873 y(})676 3964 y(})676
4055 y(s)g(<<)f(")h(-)f(")h(<<)f(fmt\("\04505x",m.a2p\(m.get_last)q
(\(\)\)\))46 b(<<)39 b("]")h(<<)g(nl;)676 4329 y(return)h(s;)598
4512 y(})515 4778 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
4869 y Fi(#include)41 b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f
(al.)1885 5255 y Fz(246)p eop
PStoPSsaved restore
%%Page: (248,249) 125
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
247 248 bop 639 523 a Fz(A)28 b(similar)f(op)r(erator)f(is)h(pro)n
(vided)g(for)g(page)g(frames.)515 639 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 639 24 4 v 29 w(PFrame)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 731 y Fi(//)39 b(Dumps)i(pframe)f
(state.)598 822 y(friend)g(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_PFrame)42 b(&p\);)639 1038 y Fz(Its)28 b(implemen)n(tation)g
(dumps)g(more)e(than)i(a)f(full)i(memory)d(bank)i(dump)g(w)n(ould)f
(do.)515 1154 y Fk(h)p Fi(off)p 667 1154 V 29 w(PFrame::operator<<)k
Fj(implementation.)d Fk(i)o Fq(\021)598 1245 y Fi(//)39
b(Dumps)i(pframe)f(state.)598 1337 y(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_PFrame)41 b(&p\))598 1428 y({)715 1519 y(s)f(<<)g
(\(off_HWResUnit\)p)i(<<)e(fmt\("bits=\04502x",p.p_bits\))45
b(<<)40 b(nl;)715 1611 y(return)h(s;)598 1702 y(})515
1951 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2042 y Fi(#include)41
b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f(al.)515
2316 y Fn(4.1.8)112 b(Kernel)37 b(pages,)h(reserv)m(ed)g(pages,)h(and)f
(mallo)s(c)e(pages)515 2470 y Fz(A)n(t)i(b)r(o)r(ot)g(time)h(w)n(e)e
(ha)n(v)n(e)g(un)n(used)h(pages,)i(pages)c(used)i(b)n(y)g(the)h(k)n
(ernel,)g(pages)e(whic)n(h)515 2569 y(should)d(not)g(b)r(e)g(used)g
(\(e.g.)56 b(those)34 b(corresp)r(onding)e(to)i(R)n(OM)g(devices,)h(or)
e(whatev)n(er\).)515 2669 y(The)27 b(free)h(pages)e(can)h(b)r(e)h(used)
g(for)f(users)g(or)f(for)i(k)n(ernel)e(dynamic)i(memory)-7
b(.)639 2768 y(Kernel)29 b(dynamic)f(memory)h(is)g(supp)r(orted)g(with)
g(the)h(OSKit)f Fx(malloc)d Fz(implemen)n(ta-)515 2868
y(tion,)e(whic)n(h)f(relies)f(on)h(an)g(OSKit)g(list)g(memory)g
(manager)e(named)i Fx(malloc)p 2937 2868 27 4 v 29 w(lmm)p
Fz(.)35 b(In)23 b(an)n(y)515 2968 y(case,)32 b(w)n(e)g(ha)n(v)n(e)f(to)
h(re\015ect)g(the)g(curren)n(t)f(state)h(of)g(core)f(in)n(to)h(an)n(y)f
(core)g(memory)h(banks)515 3067 y(b)r(eing)27 b(created.)37
b(That)27 b(is)h(done)f(with)h Fx(allocate)p 2097 3067
V 28 w(kmem)p Fz(.)515 3200 y Fk(h)p Fj(Start)h(other)g(memb)l(ers)f
(of)f Fi(off)p 1467 3200 24 4 v 29 w(MBank)i Fj(ac)l(c)l(or)l(ding)g
(to)f Fi(mdep)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 3291
y Fi(allocate_kmem\(mdep\);)639 3433 y Fz(It)g(is)g(a)f(priv)-5
b(ate)27 b(metho)r(d)h(to)g(b)r(e)g(used)f(at)h(memory)f(bank)g
(startup)g(time.)515 3549 y Fk(h)p Fj(Other)h(private)h(metho)l(ds)g
(of)e Fi(off)p 1529 3549 V 29 w(MBank)p Fj(.)h Fk(i)p
Fq(\021)598 3640 y Fi(//)39 b(Allocates)j(kernel)e(memory)h(and)f
(exhausts)h(any)f(malloc)g(free)g(memory)598 3731 y(void)g
(allocate_kmem\(const)j(off_mdepMBank)g(&mdep\);)1885
5255 y Fz(247)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
248 249 bop 639 523 a Fz(The)26 b(implemen)n(tation)g(simply)f(scans)g
(through)g(the)h(memory)e(allo)r(cated)h(to)g(the)h(k)n(er-)515
623 y(nel)36 b(b)n(y)f(the)h(mac)n(hine)g(dep)r(enden)n(t)g(part)g(at)f
(b)r(o)r(ot)h(time)g(and)g(re\015ects)f(suc)n(h)h(state)f(in)n(to)515
722 y(the)d(allo)r(cator.)48 b(Only)31 b(memory)g(in)h(the)g(range)f
(handled)h(b)n(y)f(the)i(memory)e(bank)g(b)r(eing)515
822 y(created)c(is)g(considered.)515 955 y Fk(h)p Fi(off)p
667 955 24 4 v 29 w(MBank::allocate)p 1281 955 V 31 w(kmem)i
Fj(implementation.)e Fk(i)p Fq(\021)598 1046 y Fi(//)39
b(Allocates)j(kernel)e(memory)h(and)f(exhausts)h(any)f(malloc)g(free)g
(memory)598 1137 y(void)g(off_MBank::allocate_kmem\(const)46
b(off_mdepMBank)c(&mdep\))598 1229 y({)676 1411 y(vm_offset_t)g(va;)589
b(//)40 b(starting)h(address)676 1503 y(vm_offset_t)h(fva;)550
b(//)40 b(next)g(free)g(address)676 1594 y(vm_size_t)120
b(size=0;)433 b(//)40 b(size)g(of)g(free)g(area)676 1777
y(va=mdep.get_first\(\);)676 1959 y(do)g({)755 2051 y(fva=va;)755
2142 y(mdep.find_free\(fva,size\);)755 2233 y(if)f(\(size\){)833
2325 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ate)28 b(p)l(ages)h(fr)l(om)e
Fi(va)h Fj(to)g Fi(fva)p Fj(.)g Fk(i)755 2416 y Fi(})755
2507 y(m_kend=fva;)755 2599 y(va)39 b(=)h(fva+size;)676
2690 y(})g(while)g(\(va)g(<)f(mdep.get_last\(\)\);)598
2781 y(})639 3014 y Fz(T)-7 b(o)30 b(let)g(the)h(k)n(ernel)e(kno)n(w)g
(where)g(its)h(used)g(memory)f(ends,)i(a)f(new)g Fx(MBank)d
Fz(metho)r(d,)515 3113 y Fx(get)p 652 3113 27 4 v 30
w(kend)p Fz(,)f(is)h(pro)n(vided)g(for)g(in-k)n(ernel)g(use.)515
3230 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3230 24 4 v 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3321 y Fi(//)39 b(Where)i(is)e(the)h(page)h(past)f(the)g(last)g(one)g
(allocated)h(for)f(the)g(kernel)598 3412 y(//)f(by)h(allocate_kmem?)598
3504 y(vm_offset_t)h(get_kend\(void\))i(const;)639 3628
y Fz(Its)28 b(implemen)n(tation)g(returns)f(a)g(v)-5
b(alue)27 b(stored)g(b)n(y)g Fx(allocate)p 2647 3628
27 4 v 28 w(kend)p Fz(.)515 3744 y Fk(h)p Fi(off)p 667
3744 24 4 v 29 w(MBank::get)p 1086 3744 V 30 w(kend)h
Fj(implementation.)g Fk(i)p Fq(\021)598 3836 y Fi(//)39
b(Where)i(is)e(the)h(page)h(past)f(the)g(last)g(one)g(allocated)h(for)f
(the)g(kernel)598 3927 y(//)f(by)h(allocate_kmem?)598
4018 y(vm_offset_t)h(off_MBank::get_kend\(void\))k(const)598
4110 y({)676 4201 y(return)c(m_kend;)598 4292 y(})515
4450 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4450 V 29 w(MBank)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 4541 y Fi(vm_offset_t)41 b(m_kend;)g(//)f(page)g(past)g
(the)g(last)g(one)g(allocated)h(for)f(the)g(kernel.)1885
5255 y Fz(248)p eop
PStoPSsaved restore
%%Page: (250,251) 126
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
249 250 bop 639 523 a Fz(T)-7 b(o)32 b(allo)r(cate)f(memory)g(already)f
(b)r(eing)i(used)g(w)n(e)f(register)f(it)i(for)g(k)n(ernel)f(usage)f
(and)515 623 y(up)r(date)j Fx(m)p 848 623 27 4 v 31 w(kend)p
Fz(.)50 b(The)33 b(con)n(v)n(en)n(tion)e(is)h(that)h(k)n(ernel)f(pages)
f(are)h(assigned)f(to)i(the)g Fx(node)515 722 y Fz(domain.)515
855 y Fk(h)p Fj(A)n(l)t(lo)l(c)l(ate)28 b(p)l(ages)h(fr)l(om)e
Fi(va)h Fj(to)g Fi(fva)p Fj(.)g Fk(i)p Fq(\021)598 946
y Fi(off_pg_id_t)41 b(pg\(get_id\(\),va\);)598 1038 y(off_PFrame)g
(*pf;)598 1129 y(for)f(\()f(;)h(pg)f(<)h(fva;)g(pg)g(+=)f
(mdep.get_pgsz\(\))82 b(\){)676 1220 y(pf=)40 b(new\(this,pg\))i
(off_PFrame\(get_protection\(\),n)q(d.ge)q(t_dom)q(ain\()q(\)\);)676
1312 y(assert\(pf\);)598 1403 y(})598 1494 y(do_debug\(printf\("\045x)h
(to)d(\045x)g(kallocated\\n",va,fva\)\);)515 1768 y Fn(4.1.9)112
b(Memory)37 b(banks)i(and)g(page)f(frames)f(for)h(plain)e(users)515
1922 y Fz(These)27 b(are)g(the)h(wrapp)r(ers)e(for)h(memory)g(banks)g
(and)g(page)g(frames:)515 2054 y Fk(h)p Fj(O\013)g(memory)h(b)l(ank)g
(for)g(users.)g Fk(i)p Fq(\021)598 2146 y Fi(class)40
b(off_uMBank)i(:)d(public)i(off_uHWCompResource)i({)598
2237 y(public:)598 2328 y(#ifdef)d(__KERNEL__)676 2420
y(off_uMBank\(off_MBank)k(*r\):)c(off_uHWCompResource\(r\))k({;})676
2511 y(off_uMBank\(off_MBank)g(&r\):)c(off_uHWCompResource\(&r\))45
b({;})598 2602 y(#endif)676 2694 y(off_uMBank\(void\))e({;})676
2785 y(off_uMBank\(const)g(off_id_t)e(&id\):)f
(off_uHWCompResource\(id\))45 b({;})598 2968 y(#ifndef)c(__KERNEL__)676
3059 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h(for)e(users)i(metho)l
(ds.)g Fk(i)598 3333 y Fi(#endif)598 3516 y(};)515 3740
y FA(isiomappable)38 b Fz(Supp)r(orts)28 b(IO)f(mapping?)37
b(Receiv)n(es:)822 3906 y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f
(for)h(the)h(bank)g Fx(r)p Fz(.)722 4039 y Fk(h)p Fj(O\013)f(memory)h
(b)l(ank)h(for)e(users)i(metho)l(ds.)g Fk(i)p Fq(\021)805
4130 y Fi(//)40 b(Supports)h(IO)f(port)g(maps.)805 4221
y(boolean_t)i(is_iomapable\(off_Rights)i(r\))79 b({)884
4313 y(off_mb_isiomapable_req)44 b(req\(r\);)884 4404
y(off_mb_isiomapable_rep)g(rep;)884 4495 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 4587 y(if)f(\(err)i(||)e
(rep.m_err\))962 4678 y(errno=\(err\)?err:rep.m_err;)884
4769 y(return)h(rep.res;)805 4861 y(})1885 5255 y Fz(249)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
250 251 bop 722 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h
(messages.)g Fk(i)p Fq(\021)805 614 y Fi(#define)41 b
(OFF_MSG_MB_ISIOMAPABLE)j(0x01f)884 706 y(struct)c
(off_mb_isiomapable_req:)45 b(public)40 b(off_KernReq)i({)962
797 y(off_mb_isiomapable_req\(off_R)q(ight)q(s)j(r\))40
b(:)1041 888 y(off_KernReq\(OFF_MSG_MB_ISIOMAP)q(ABLE,)q(r\))45
b({;})884 980 y(};)884 1071 y(struct)40 b(off_mb_isiomapable_rep:)45
b(public)40 b(off_KernRep)i({)962 1162 y(boolean_t)f(res;)962
1254 y(off_mb_isiomapable_rep\(err_t)46 b(r=0\))40 b(:)f
(off_KernRep\(r\))k({;})884 1345 y(};)515 1566 y FA(isp)s(ersisten)m(t)
c Fz(P)n(ersists?)d(Receiv)n(es:)822 1724 y Fq(\017)41
b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)g
Fx(r)p Fz(.)722 1849 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e
(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 1940
y Fi(//)40 b(Persists?)805 2032 y(boolean_t)i
(is_persistent\(off_Rights)i(r\))c({)884 2123 y
(off_mb_ispersistent_req)k(req\(r\);)884 2214 y
(off_mb_ispersistent_rep)g(rep;)884 2305 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2397 y(if)f(\(err)i(||)e
(rep.m_err\))962 2488 y(errno=\(err\)?err:rep.m_err;)884
2579 y(return)h(rep.res;)805 2671 y(})722 2858 y Fk(h)p
Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g Fk(i)p Fz(+)o
Fq(\021)805 2950 y Fi(#define)41 b(OFF_MSG_MB_ISPERSISTENT)k(0x02f)884
3041 y(struct)40 b(off_mb_ispersistent_req:)45 b(public)c(off_KernReq)g
({)962 3132 y(off_mb_ispersistent_req\(off_)q(Righ)q(ts)k(r\))40
b(:)1041 3224 y(off_KernReq\(OFF_MSG_MB_ISPERSI)q(STENT)q(,r\))46
b({;})884 3315 y(};)884 3406 y(struct)40 b(off_mb_ispersistent_rep:)45
b(public)c(off_KernRep)g({)962 3498 y(boolean_t)g(res;)962
3589 y(off_mb_ispersistent_rep\(err_)q(t)k(r=0\))40 b(:)g
(off_KernRep\(r\))i({;})884 3680 y(};)515 3901 y FA(get\014rst)f
Fz(Returns)28 b(the)f(\014rst)h(address.)35 b(Receiv)n(es:)822
4059 y Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)
g Fx(r)p Fz(.)722 4184 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e
(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 4276
y Fi(//)40 b(Returns)h(the)f(first)g(valid)g(address.)805
4367 y(vm_offset_t)i(get_first\(off_Rights)i(r\){)884
4458 y(off_mb_getfirst_req)f(req\(r\);)884 4550 y(off_mb_getfirst_rep)g
(rep;)884 4641 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
4732 y(if)f(\(err)i(||)e(rep.m_err\))962 4824 y
(errno=\(err\)?err:rep.m_err;)884 4915 y(return)h(rep.res;)805
5006 y(})1885 5255 y Fz(250)p eop
PStoPSsaved restore
%%Page: (252,253) 127
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
251 252 bop 722 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h
(messages.)g Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_MB_GETFIRST)j(0x03f)884 706 y(struct)c(off_mb_getfirst_req:)k
(public)d(off_KernReq)g({)962 797 y(off_mb_getfirst_req\(off_Righ)q(ts)
k(r\))40 b(:)1041 888 y(off_KernReq\(OFF_MSG_MB_GETFIRS)q(T,r\))46
b({;})884 980 y(};)884 1071 y(struct)40 b(off_mb_getfirst_rep:)k
(public)d(off_KernRep)g({)962 1162 y(vm_offset_t)h(res;)962
1254 y(off_mb_getfirst_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i
({;})884 1345 y(};)515 1586 y FA(getlast)f Fz(Returns)27
b(the)h(last)f(address.)36 b(Receiv)n(es:)822 1752 y
Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)g
Fx(r)p Fz(.)722 1885 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e
(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 1976
y Fi(//)40 b(Returns)h(the)f(last)g(valid)g(address.)805
2067 y(vm_offset_t)i(get_last\(off_Rights)i(r\))39 b({)884
2159 y(off_mb_getlast_req)k(req\(r\);)884 2250 y(off_mb_getlast_rep)g
(rep;)884 2341 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
2433 y(if)f(\(err)i(||)e(rep.m_err\))962 2524 y
(errno=\(err\)?err:rep.m_err;)884 2615 y(return)h(rep.res;)805
2707 y(})722 3005 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 3097 y Fi(#define)41 b(OFF_MSG_MB_GETLAST)i
(0x04f)884 3188 y(struct)d(off_mb_getlast_req:)k(public)d(off_KernReq)g
({)962 3279 y(off_mb_getlast_req\(off_Right)q(s)k(r\))40
b(:)1041 3371 y(off_KernReq\(OFF_MSG_MB_GETLAST)q(,r\))45
b({;})884 3462 y(};)884 3553 y(struct)40 b(off_mb_getlast_rep:)k
(public)d(off_KernRep)g({)962 3645 y(vm_offset_t)h(res;)962
3736 y(off_mb_getlast_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i
({;})884 3827 y(};)1885 5255 y Fz(251)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
252 253 bop 515 523 a FA(getnpgs)40 b Fz(Returns)28 b(the)g(n)n(um)n(b)
r(er)f(of)h(pages.)35 b(Receiv)n(es:)822 689 y Fq(\017)41
b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)g
Fx(r)p Fz(.)722 822 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e(users)
i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 913 y Fi(//)40
b(Returns)h(the)f(number)g(of)g(page)g(frames.)805 1005
y(vm_size_t)120 b(get_npgs\(off_Rights)44 b(r\))39 b({)884
1096 y(off_mb_getnpgs_req)k(req\(r\);)884 1187 y(off_mb_getnpgs_rep)g
(rep;)884 1279 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
1370 y(if)f(\(err)i(||)e(rep.m_err\))962 1461 y
(errno=\(err\)?err:rep.m_err;)884 1553 y(return)h(rep.res;)805
1735 y(})722 1943 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 2034 y Fi(#define)41 b(OFF_MSG_MB_GETNPGS)i
(0x05f)884 2125 y(struct)d(off_mb_getnpgs_req:)k(public)d(off_KernReq)g
({)962 2217 y(off_mb_getnpgs_req\(off_Right)q(s)k(r\))40
b(:)1041 2308 y(off_KernReq\(OFF_MSG_MB_GETNPGS)q(,r\))45
b({;})884 2399 y(};)884 2491 y(struct)40 b(off_mb_getnpgs_rep:)k
(public)d(off_KernRep)g({)962 2582 y(natural_t)g(res;)962
2673 y(off_mb_getnpgs_rep\(err_t)k(r=0\))40 b(:)g(off_KernRep\(r\))i
({;})884 2765 y(};)515 3005 y FA(getmat)e Fz(Returns)27
b(the)h(exp)r(ected)g(access)f(time.)37 b(Receiv)n(es:)822
3171 y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)g
Fx(r)p Fz(.)722 3304 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e
(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 3396
y Fi(//)40 b(Returns)h(the)f(mean)g(access)g(time.)805
3487 y(//)g(\(0)g(means)g(damn)g(slow;)h(255)e(means)i(damn)f(fast\))
805 3578 y(unsigned8_t)i(get_mat\(off_Rights)h(r\))79
b({)884 3670 y(off_mb_getmat_req)43 b(req\(r\);)884 3761
y(off_mb_getmat_rep)g(rep;)884 3852 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 3944 y(if)f(\(err)i(||)e
(rep.m_err\))962 4035 y(errno=\(err\)?err:rep.m_err;)884
4126 y(return)h(rep.res;)805 4309 y(})1885 5255 y Fz(252)p
eop
PStoPSsaved restore
%%Page: (254,255) 128
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
253 254 bop 722 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h
(messages.)g Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_MB_GETMAT)i(0x06f)884 706 y(struct)d(off_mb_getmat_req:)k
(public)c(off_KernReq)i({)962 797 y(off_mb_getmat_req\(off_Rights)k
(r\))40 b(:)1041 888 y(off_KernReq\(OFF_MSG_MB_GETMAT,)q(r\))45
b({;})884 980 y(};)884 1071 y(struct)40 b(off_mb_getmat_rep:)k(public)c
(off_KernRep)i({)962 1162 y(unsigned8_t)g(res;)962 1254
y(off_mb_getmat_rep\(err_t)j(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884
1345 y(};)515 1586 y FA(getpgsize)d Fz(Return)28 b(supp)r(orted)f(page)
g(sizes.)36 b(Receiv)n(es:)822 1752 y Fq(\017)41 b Fz(A)28
b(lo)n(w)n(er)e(limit)i(for)f(the)h(page)f(size)g Fx(llimit)p
Fz(.)822 1885 y Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)f(for)h
(the)h(bank)g Fx(r)p Fz(.)722 2017 y Fk(h)p Fj(O\013)f(memory)h(b)l
(ank)h(for)e(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805
2109 y Fi(//)40 b(Gets)g(the)g(preferred)h(page)f(sizes)805
2200 y(//)g(above)g(llimit)h(bytes)f(\(or)g(0)g(if)f(none\))805
2291 y(vm_size_t)j(get_pgsize\(vm_size_t)h(llimit,off_Rights)g(r\))d({)
884 2383 y(off_mb_getpgsize_req)k(req\(llimit,r\);)884
2474 y(off_mb_getpgsize_rep)g(rep;)884 2565 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2657 y(if)f(\(err)i(||)e
(rep.m_err\))962 2748 y(errno=\(err\)?err:rep.m_err;)884
2839 y(return)h(rep.res;)805 3022 y(})722 3230 y Fk(h)p
Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g Fk(i)p Fz(+)o
Fq(\021)805 3321 y Fi(#define)41 b(OFF_MSG_MB_GETPGSIZE)j(0x07f)805
3412 y(struct)d(off_mb_getpgsize_req:)j(public)d(off_KernReq)g({)884
3504 y(unsigned32_t)h(lim;)884 3595 y(off_mb_getpgsize_req\(natural_t)k
(l,)40 b(off_Rights)h(r\))f(:)f(lim\(l\),)962 3686 y
(off_KernReq\(OFF_MSG_MB_GETPG)q(SIZE)q(,r\))45 b({;})805
3778 y(};)805 3869 y(struct)c(off_mb_getpgsize_rep:)j(public)d
(off_KernRep)g({)884 3960 y(unsigned32_t)h(res;)884 4051
y(off_mb_getpgsize_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i({;})
805 4143 y(};)1885 5255 y Fz(253)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
254 255 bop 515 523 a FA(getcoresize)40 b Fz(Returns)28
b(installed)g(core)e(size.)37 b(Receiv)n(es:)822 689
y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(bank)g
Fx(r)p Fz(.)722 822 y Fk(h)p Fj(O\013)f(memory)h(b)l(ank)h(for)e(users)
i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 913 y Fi(//)40
b(Return)h(the)e(core)i(size.)805 1005 y(vm_size_t)h
(get_coresize\(off_Rights)i(r\))79 b({)884 1096 y
(off_mb_getcoresize_req)44 b(req\(r\);)884 1187 y
(off_mb_getcoresize_rep)g(rep;)884 1279 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 1370 y(if)f(\(err)i(||)e
(rep.m_err\))962 1461 y(errno=\(err\)?err:rep.m_err;)884
1553 y(return)h(rep.res;)805 1735 y(})722 2034 y Fk(h)p
Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g Fk(i)p Fz(+)o
Fq(\021)805 2125 y Fi(#define)41 b(OFF_MSG_MB_GETCORESIZE)j(0x08f)884
2217 y(struct)c(off_mb_getcoresize_req:)45 b(public)40
b(off_KernReq)i({)962 2308 y(off_mb_getcoresize_req\(off_R)q(ight)q(s)j
(r\))40 b(:)1041 2399 y(off_KernReq\(OFF_MSG_MB_GETCORE)q(SIZE,)q(r\))
45 b({;})884 2491 y(};)884 2582 y(struct)40 b(off_mb_getcoresize_rep:)
45 b(public)40 b(off_KernRep)i({)962 2673 y(unsigned32_t)g(res;)962
2765 y(off_mb_getcoresize_rep\(err_t)k(r=0\))40 b(:)f(off_KernRep\(r\))
k({;})884 2856 y(};)515 3097 y FA(allo)s(c)e Fz(Allo)r(cates)27
b(a)g(page)g(frame)g(at)g(a)g(giv)n(en)g(p)r(osition.)37
b(Receiv)n(es:)822 3263 y Fq(\017)k Fz(The)28 b(desired)f(resource)e
(id)j Fx(at)p Fz(.)822 3396 y Fq(\017)41 b Fz(The)28
b(protection)e Fx(p)i Fz(and)f Fx(domain)e Fz(for)i(the)h(page.)822
3528 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)
h(domain)f Fx(dr)p Fz(.)822 3661 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(bank)f Fx(r)p
Fz(.)722 3794 y Fk(h)p Fj(O\013)g(memory)h(b)l(ank)h(for)e(users)i
(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 3885 y Fi(//)40
b(Allocates)h(a)f(pframe)805 3977 y(off_uPFrame)i(alloc\(const)g
(off_pg_id_t)g(&at,)1511 4068 y(off_Protection)h(p,)1511
4159 y(off_prtl_id_t)82 b(domain,)1511 4251 y(off_Rights)42
b(dr,)e(off_Rights)h(r\){)884 4342 y(off_mb_allocat_req)i
(req\(at,p,domain,dr,r\);)884 4433 y(off_mb_allocat_rep)g(rep;)884
4525 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
4616 y(if)f(\(err)i(||)e(rep.m_err\))962 4707 y
(errno=\(err\)?err:rep.m_err;)884 4799 y(return)h(rep.res;)805
4890 y(})1885 5255 y Fz(254)p eop
PStoPSsaved restore
%%Page: (256,257) 129
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
255 256 bop 722 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h
(messages.)g Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_MB_ALLOCAT)i(0x09f)884 706 y(struct)d(off_mb_allocat_req:)k
(public)d(off_KernReq)g({)962 797 y(off_pg_id_t)81 b(id;)962
888 y(off_Protection)43 b(prot;)962 980 y(off_prtl_id_t)82
b(dom;)962 1071 y(off_Rights)199 b(drights;)962 1162
y(off_mb_allocat_req\(const)45 b(off_pg_id_t)d(&at,)1904
1254 y(off_Protection)g(p,)1904 1345 y(off_prtl_id_t)81
b(domain,)1904 1436 y(off_Rights)41 b(dr,)1904 1528 y(off_Rights)g
(r\):)1041 1619 y(id\(at\),prot\(p\),dom\(domain\),dri)q(ghts\()q
(dr\),)1041 1710 y(off_KernReq\(OFF_MSG_MB_ALLOCAT)q(,r\))k({;})884
1802 y(};)884 1893 y(struct)40 b(off_mb_allocat_rep:)k(public)d
(off_KernRep)g({)962 1984 y(off_pg_id_t)h(res;)962 2076
y(off_mb_allocat_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i({;})884
2167 y(};)515 2499 y FA(allo)s(c)f Fz(Allo)r(cates)27
b(a)g(page)g(frame.)36 b(Receiv)n(es:)822 2665 y Fq(\017)41
b Fz(The)28 b(protection)e Fx(p)i Fz(and)f Fx(domain)e
Fz(for)i(the)h(page.)822 2798 y Fq(\017)41 b Fz(Read)27
b(access)g(righ)n(ts)f(for)h(the)h(domain)f Fx(dr)p Fz(.)722
2931 y Fk(h)p Fj(O\013)g(memory)h(b)l(ank)h(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)805 3022 y Fi(off_uPFrame)42 b
(alloc\(off_Protection)i(p,)1511 3113 y(off_prtl_id_t)82
b(domain,)1511 3205 y(off_Rights)42 b(dr,)e(off_Rights)h(r\){)884
3296 y(off_mb_alloc_req)i(req\(p,domain,dr,r\);)884 3387
y(off_mb_alloc_rep)g(rep;)884 3479 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 3570 y(if)f(\(err)i(||)e
(rep.m_err\))962 3661 y(errno=\(err\)?err:rep.m_err;)884
3753 y(return)h(rep.res;)805 3844 y(})1885 5255 y Fz(255)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
256 257 bop 722 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h
(messages.)g Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_MB_ALLOC)i(0x0af)884 706 y(struct)d(off_mb_alloc_req:)j
(public)e(off_KernReq)h({)962 797 y(off_Protection)h(prot;)962
888 y(off_prtl_id_t)82 b(dom;)962 980 y(off_Rights)199
b(drights;)962 1071 y(off_mb_alloc_req\()h(off_Protection)43
b(p,)1904 1162 y(off_prtl_id_t)81 b(domain,)1904 1254
y(off_Rights)41 b(dr,)f(off_Rights)i(r\):)1041 1345 y
(prot\(p\),dom\(domain\),drights\(dr)q(\),)1041 1436
y(off_KernReq\(OFF_MSG_MB_ALLOC,r)q(\))j({;})884 1528
y(};)884 1619 y(struct)40 b(off_mb_alloc_rep:)j(public)e(off_KernRep)h
({)962 1710 y(off_pg_id_t)g(res;)962 1802 y(off_mb_alloc_rep\(err_t)i
(r=0\))d(:)e(off_KernRep\(r\))j({;})884 1893 y(};)515
2134 y FA(free)f Fz(Deallo)r(cates)27 b(a)g(page.)36
b(Receiv)n(es:)822 2300 y Fq(\017)41 b Fz(The)28 b(iden)n(ti\014er)f
(of)h(the)g(page)e Fx(s)p Fz(.)822 2433 y Fq(\017)41
b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h(page)f
Fx(r)p Fz(.)722 2565 y Fk(h)p Fj(O\013)g(memory)h(b)l(ank)h(for)e
(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 2657
y Fi(//)40 b(Deallocates)i(a)d(pframe)805 2748 y(void)h(free\()h
(off_uPFrame)h(s,)d(off_Rights)j(r\){)884 2839 y(off_mb_free_req)g
(req\(s.get_id\(\),r\);)884 2931 y(off_mb_free_rep)g(rep;)884
3022 y(err_t)e(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
3113 y(if)f(\(err)i(||)e(rep.m_err\))962 3205 y
(errno=\(err\)?err:rep.m_err;)805 3296 y(})722 3504 y
Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)h(messages.)g Fk(i)p
Fz(+)o Fq(\021)805 3595 y Fi(#define)41 b(OFF_MSG_MB_FREE)i(0x0bf)884
3686 y(struct)d(off_mb_free_req:)j(public)e(off_KernReq)h({)962
3778 y(off_pg_id_t)81 b(id;)962 3869 y(off_mb_free_req\(off_pg_id_t)46
b(s,)39 b(off_Rights)j(r\):)e(id\(s\),)1041 3960 y
(off_KernReq\(OFF_MSG_MB_FREE,r\))46 b({;})884 4051 y(};)884
4143 y(struct)40 b(off_mb_free_rep:)j(public)e(off_KernRep)h({)962
4234 y(off_mb_free_rep\(err_t)i(r=0\))c(:)g(off_KernRep\(r\))i({;})884
4325 y(};)1885 5255 y Fz(256)p eop
PStoPSsaved restore
%%Page: (258,259) 130
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
257 258 bop 639 523 a Fz(Some)28 b Fx(MBank)d Fz(metho)r(ds)j(are)f
(exp)r(orted)g(v)n(erbatim.)515 656 y Fk(h)p Fj(O\013)g(memory)h(b)l
(ank)g(for)g(users)h(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)598
839 y Fi(//)39 b(Returns)i(the)f(minimum)h(preferred)g(page)f(size.)598
930 y(static)g(vm_size_t)i(get_pgsize\(void\))82 b({)39
b(return)i(off_mdepMBank::get_pgsz\(\);})598 1112 y(//)e(Address)i(to)f
(PFN.)598 1204 y(static)g(vm_offset_t)i(a2p\(vm_offset_t)h(va\){)d
(return)g(off_mdepMBank::a2p\(va\);)45 b(})598 1295 y(//)39
b(PFN)h(to)g(address.)598 1386 y(static)g(vm_offset_t)i
(p2a\(vm_offset_t)h(va\){)d(return)g(off_mdepMBank::p2a\(va\);)45
b(})598 1569 y(//)39 b(Returns)i(the)f(mask)g(for)g(page)g(offsets.)598
1660 y(static)g(vm_offset_t)i(pmask\(void\))g({)d(return)i
(off_mdepMBank::pmask\(\);)j(})598 1752 y(//)39 b(Truncate)i(or)f
(round)h(to)e(the)h(next)g(page)g(boundary.)598 1843
y(static)g(vm_offset_t)i(ptrunc\(vm_offset_t)h(va\))d({)676
1934 y(return)h(va)e(&)h(~)f(off_mdepMBank::pmask\(\);)598
2026 y(})598 2117 y(static)h(vm_offset_t)i(pround\(vm_offset_t)h(va\))d
({)676 2208 y(return)h(\(va)f(+)f(off_mdepMBank::pmask\(\)\))45
b(&)39 b(~)h(off_mdepMBank::pmask\(\);)598 2300 y(})1885
5255 y Fz(257)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
258 259 bop 515 523 a Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(for)g
(users)h(in-kernel.)f Fk(i)p Fq(\021)598 614 y Fi(class)40
b(off_kMBank)i(:)d(public)i(off_kHWCompResource)i({)598
706 y(public:)676 980 y(static)e(err_t)f(handler\(const)i
(off_shtl_id_t)h(&sender,)1500 1071 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 1162 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676
1345 y(virtual)g(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1186
1436 y(vm_size_t)e(msz,)g(vm_size_t)g(rsz,)1186 1528
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\);)637 1802 y(void)e
(is_iomapable\(off_mb_isiomapab)q(le_r)q(eq)45 b
(*m,off_mb_isiomapable_rep)84 b(*r\))676 1893 y({)755
1984 y(\(void\)m;)755 2076 y(r->res=\(\(off_MBank*\)w_r\)->is_io)q
(mapa)q(ble\()q(\);)676 2167 y(})637 2258 y(void)40 b
(is_persistent\(off_mb_ispersis)q(tent)q(_req)46 b
(*m,off_mb_ispersistent_rep)84 b(*r\))676 2350 y({)755
2441 y(\(void\)m;)755 2532 y(r->res=\(\(off_MBank*\)w_r\)->is_pe)q
(rsis)q(tent)q(\(\);)676 2623 y(})637 2715 y(void)40
b(get_first\(off_mb_getfirst_req)46 b(*m,off_mb_getfirst_rep)83
b(*r\))676 2806 y({)755 2897 y(\(void\)m;)755 2989 y
(r->res=\(\(off_MBank*\)w_r\)->get_f)q(irst)q(\(\);)676
3080 y(})637 3171 y(void)40 b(get_last\(off_mb_getlast_req)45
b(*m,off_mb_getlast_rep)84 b(*r\))676 3263 y({)755 3354
y(\(void\)m;)755 3445 y(r->res=\(\(off_MBank*\)w_r\)->get_l)q(ast\()q
(\);)676 3537 y(})637 3628 y(void)40 b(get_npgs\(off_mb_getnpgs_req)45
b(*m,off_mb_getnpgs_rep)84 b(*r\))676 3719 y({)755 3811
y(\(void\)m;)755 3902 y(r->res=\(\(off_MBank*\)w_r\)->get_n)q(pgs\()q
(\);)676 3993 y(})637 4085 y(void)40 b(get_mat\(off_mb_getmat_req)45
b(*m,off_mb_getmat_rep)83 b(*r\))676 4176 y({)755 4267
y(\(void\)m;)755 4359 y(r->res=\(\(off_MBank*\)w_r\)->get_m)q(at\(\))q
(;)676 4450 y(})637 4541 y(void)40 b(get_pgsize\(off_mb_getpgsize_r)q
(eq)45 b(*m,off_mb_getpgsize_rep)84 b(*r\))676 4633 y({)755
4724 y(r->res=\(\(off_MBank*\)w_r\)->get_p)q(gsiz)q(e\(m-)q(>lim\))q(;)
676 4815 y(})637 4907 y(void)40 b(get_coresize\(off_mb_getcoresi)q
(ze_r)q(eq)45 b(*m,off_mb_getcoresize_rep)84 b(*r\))676
4998 y({)1885 5255 y Fz(258)p eop
PStoPSsaved restore
%%Page: (260,261) 131
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
259 260 bop 755 523 a Fi(\(void\)m;)755 614 y
(r->res=\(\(off_MBank*\)w_r\)->get_c)q(ores)q(ize\()q(\);)676
706 y(})676 797 y(void)40 b(allocat\(off_mb_allocat_req)45
b(*m,off_mb_allocat_rep)84 b(*r\))676 888 y({)755 980
y(off_PFrame)41 b(*s;)755 1071 y(\(void\)m;)755 1162
y(//)e(XXX)h(check)h(domain)f(rights.)755 1254 y(s)196
b(=new\(\(off_MBank*\)w_r,m->id\))45 b(off_PFrame\(m->prot,m->dom\);)
755 1345 y(if)39 b(\(!s\))833 1436 y(r->m_err=EAGAIN;)755
1528 y(r->res=\(s\)?s->get_id\(\):OFF_ID_N)q(ULL;)676
1619 y(})676 1710 y(void)h(alloc\(off_mb_alloc_req)45
b(*m,off_mb_alloc_rep)82 b(*r\))676 1802 y({)755 1893
y(off_PFrame)41 b(*s;)755 1984 y(\(void\)m;)755 2076
y(//)e(XXX)h(check)h(domain)f(rights.)755 2167 y(s)196
b(=new\(\(off_MBank*\)w_r\))44 b(off_PFrame\(m->prot,m->dom\);)755
2258 y(if)39 b(\(!s\))833 2350 y(r->m_err=EAGAIN;)755
2441 y(r->res=\(s\)?s->get_id\(\):OFF_ID_N)q(ULL;)676
2623 y(})676 2715 y(void)h(free\(off_mb_free_req)k(*m,off_mb_free_rep)
83 b(*r\))676 2806 y({)755 2897 y(\(void\)r;)755 2989
y(if)39 b(\(!\(\(off_MBank*\)w_r\)->is_loca)q(l\(m-)q(>id\))q(\))833
3080 y(panic\("mbank:)j(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)755 3171 y(\(\(*\(off_MBank*\)w_r\)+m->id\)->unr)q
(efer)q(ence)q(\(\);)676 3263 y(})598 3445 y(};)1885
5255 y Fz(259)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
260 261 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kMBank::handle)30 b Fj(implementation.)e Fk(i)o
Fq(\021)598 614 y Fi(err_t)40 b(off_kMBank::handle\(const)45
b(off_shtl_id_t)d(&sender,)1578 706 y(vm_size_t)g(msz,)e(vm_size_t)h
(rsz,)1578 797 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
888 y({)676 980 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y(r->m_err=EOK;)676
1345 y(do_debug\(printf\("mbank[\045x]",)q(m->m_)q(type)q(\)\);)676
1436 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)755 1528
y(off_pg_id_t)h(s=\(\(off_ObjKernReq*\)m\)->obj)q(;)755
1619 y(if)e(\(!\(\(off_MBank*\)w_r\)->is_loca)q(l\(s\))q(\))833
1710 y(panic\("mbank:)j(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)755 1802 y(else)g({)833 1893 y(off_kPFrame)i
(ks\(\(*\(\(off_MBank*\)w_r\)\)+s\);)833 1984 y(return)f
(ks.handle\(sender,msz,rsz,\(off_)q(ObjKe)q(rnRe)q(q*\)m,)q(r\);)755
2076 y(})676 2167 y(})676 2258 y(switch\(m->m_type\){)676
2350 y(case)f(OFF_MSG_R_INIT:)755 2441 y(return)g(EOK;)676
2532 y(case)g(OFF_MSG_MB_ALLOCAT:)755 2623 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_W,)q
(m->m_)q(righ)q(ts\)\))833 2715 y(r->m_err=)i(EPERM;)755
2806 y(else)f(if)f(\(msz!=sizeof\(off_mb_allocat)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_mb_allocat_rep\))q(\))833
2897 y(r->m_err=)h(EINVAL;)755 2989 y(else)f({)833 3080
y(allocat\(\(off_mb_allocat_req*\))q(m,\(o)q(ff_m)q(b_all)q(ocat)q
(_rep*)q(\)r\);)755 3171 y(})755 3263 y(return)g(EOK;)676
3354 y(case)g(OFF_MSG_MB_ALLOC:)755 3445 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_W,)q
(m->m_)q(righ)q(ts\)\))833 3537 y(r->m_err=)i(EPERM;)755
3628 y(else)f(if)f(\(msz!=sizeof\(off_mb_alloc_r)q(eq\))46
b(||)39 b(rsz!=sizeof\(off_mb_alloc_rep)q(\)\))833 3719
y(r->m_err)i(=EINVAL;)755 3811 y(else)f({)833 3902 y
(alloc\(\(off_mb_alloc_req*\)m,\(o)q(ff_m)q(b_al)q(loc_r)q(ep*\))q
(r\);)755 3993 y(})755 4085 y(return)g(EOK;)676 4176
y(case)g(OFF_MSG_MB_FREE:)755 4267 y(if)f
(\(msz!=sizeof\(off_mb_free_req)q(\))45 b(||)40 b
(rsz!=sizeof\(off_mb_free_rep\)\))833 4359 y(r->m_err=)h(EINVAL;)755
4450 y(else)f({)833 4541 y(free\(\(off_mb_free_req*\)m,\(off)q(_mb_)q
(free)q(_rep*)q(\)r\);)755 4633 y(})755 4724 y(return)g(EOK;)676
4815 y(case)g(OFF_MSG_MB_ISIOMAPABLE:)755 4907 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 4998 y(r->m_err=)i(EPERM;)1885
5255 y Fz(260)p eop
PStoPSsaved restore
%%Page: (262,263) 132
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
261 262 bop 755 523 a Fi(else)40 b(if)f(\(msz!=sizeof\(off_mb_isiomap)q
(able)q(_req\))46 b(||)40 b(rsz!=sizeof\(off_mb_isiomapable_)q(rep\))q
(\))833 614 y(r->m_err=)h(EINVAL;)755 706 y(else)f({)833
797 y(is_iomapable\(\(off_mb_isiomapa)q(ble_)q(req*)q(\)m,\(o)q(ff_m)q
(b_isi)q(omap)q(able)q(_rep*)q(\)r\);)755 888 y(})755
980 y(return)g(EOK;)676 1071 y(case)g(OFF_MSG_MB_ISPERSISTENT:)755
1162 y(if)f(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q
(P_R,)q(m->m_)q(righ)q(ts\)\))833 1254 y(r->m_err=)i(EPERM;)755
1345 y(else)f(if)f(\(msz!=sizeof\(off_mb_ispersi)q(sten)q(t_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_mb_ispersisten)q(t_re)q(p\)\))833
1436 y(r->m_err=)h(EINVAL;)755 1528 y(else)f({)833 1619
y(is_persistent\(\(off_mb_ispersi)q(sten)q(t_re)q(q*\)m,)q(\(off)q
(_mb_i)q(sper)q(sist)q(ent_r)q(ep*\))q(r\);)755 1710
y(})755 1802 y(return)g(EOK;)676 1893 y(case)g(OFF_MSG_MB_GETFIRST:)755
1984 y(if)f(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q
(P_R,)q(m->m_)q(righ)q(ts\)\))833 2076 y(r->m_err=)i(EPERM;)755
2167 y(else)f(if)f(\(msz!=sizeof\(off_mb_getfirs)q(t_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_mb_getfirst_re)q(p\)\))833
2258 y(r->m_err=)h(EINVAL;)755 2350 y(else)f({)833 2441
y(get_first\(\(off_mb_getfirst_re)q(q*\)m)q(,\(of)q(f_mb_)q(getf)q
(irst_)q(rep*)q(\)r\);)755 2532 y(})755 2623 y(return)g(EOK;)676
2715 y(case)g(OFF_MSG_MB_GETLAST:)755 2806 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 2897 y(r->m_err=)i(EPERM;)755
2989 y(else)f(if)f(\(msz!=sizeof\(off_mb_getlast)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_mb_getlast_rep\))q(\))833
3080 y(r->m_err=)h(EINVAL;)755 3171 y(else)f({)833 3263
y(get_last\(\(off_mb_getlast_req*)q(\)m,\()q(off_)q(mb_ge)q(tlas)q
(t_rep)q(*\)r\))q(;)755 3354 y(})755 3445 y(return)g(EOK;)676
3537 y(case)g(OFF_MSG_MB_GETNPGS:)755 3628 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 3719 y(r->m_err=)i(EPERM;)755
3811 y(else)f(if)f(\(msz!=sizeof\(off_mb_getnpgs)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_mb_getnpgs_rep\))q(\))833
3902 y(r->m_err=)h(EINVAL;)755 3993 y(else)f({)833 4085
y(get_npgs\(\(off_mb_getnpgs_req*)q(\)m,\()q(off_)q(mb_ge)q(tnpg)q
(s_rep)q(*\)r\))q(;)755 4176 y(})755 4267 y(return)g(EOK;)676
4359 y(case)g(OFF_MSG_MB_GETMAT:)755 4450 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 4541 y(r->m_err=)i(EPERM;)755
4633 y(else)f(if)f(\(msz!=sizeof\(off_mb_getmat_)q(req\))46
b(||)39 b(rsz!=sizeof\(off_mb_getmat_r)q(ep\)\))833 4724
y(r->m_err=)i(EINVAL;)755 4815 y(else)f({)833 4907 y
(get_mat\(\(off_mb_getmat_req*\)m)q(,\(of)q(f_mb)q(_getm)q(at_r)q
(ep*\)r)q(\);)755 4998 y(})1885 5255 y Fz(261)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
262 263 bop 755 523 a Fi(return)40 b(EOK;)676 614 y(case)g
(OFF_MSG_MB_GETPGSIZE:)755 706 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 797 y(r->m_err=)i(EPERM;)755
888 y(else)f(if)f(\(msz!=sizeof\(off_mb_getpgsi)q(ze_r)q(eq\))45
b(||)40 b(rsz!=sizeof\(off_mb_getpgsize_)q(rep\))q(\))833
980 y(r->m_err=)h(EINVAL;)755 1071 y(else)f({)833 1162
y(get_pgsize\(\(off_mb_getpgsize_)q(req*)q(\)m,\()q(off_m)q(b_ge)q
(tpgsi)q(ze_r)q(ep*\))q(r\);)755 1254 y(})755 1345 y(return)g(EOK;)676
1436 y(case)g(OFF_MSG_MB_GETCORESIZE:)755 1528 y(if)f
(\(!\(\(off_MBank*\)w_r\)->access_)q(gran)q(ted\()q(OFF_O)q(P_R,)q
(m->m_)q(righ)q(ts\)\))833 1619 y(r->m_err=)i(EPERM;)755
1710 y(else)f(if)f(\(msz!=sizeof\(off_mb_getcore)q(size)q(_req\))46
b(||)40 b(rsz!=sizeof\(off_mb_getcoresize_)q(rep\))q(\))833
1802 y(r->m_err=)h(EINVAL;)755 1893 y(else)f({)833 1984
y(get_coresize\(\(off_mb_getcores)q(ize_)q(req*)q(\)m,\(o)q(ff_m)q
(b_get)q(core)q(size)q(_rep*)q(\)r\);)755 2076 y(})755
2167 y(return)g(EOK;)676 2258 y(default:)755 2350 y(return)g
(off_kHWCompResource::handle\()q(send)q(er,ms)q(z,rs)q(z,m,r)q(\);)676
2441 y(})598 2532 y(})515 2798 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l
(ame)g(for)g(users.)g Fk(i)p Fq(\021)598 2889 y Fi(class)40
b(off_uPFrame:)i(public)f(off_uHWResUnit)h({)598 2980
y(public:)598 3072 y(#ifdef)e(__KERNEL__)676 3163 y
(off_uPFrame\(off_PFrame)k(*r\):)d(off_uHWResUnit\(r\))i({;})676
3254 y(off_uPFrame\(off_PFrame)h(&r\):)d(off_uHWResUnit\(&r\))i({;})598
3346 y(#endif)676 3437 y(off_uPFrame\(void\))g({;})676
3528 y(off_uPFrame\(const)g(off_id_t)e(&id\):)g(off_uHWResUnit\(id\))i
({;})598 3711 y(#ifndef)e(__KERNEL__)598 3894 y(#endif)598
4076 y(};)515 4251 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(for)g
(users)g(in-kernel.)g Fk(i)p Fq(\021)598 4342 y Fi(class)40
b(off_kPFrame)i(:)d(public)i(off_kHWResUnit)h({)598 4433
y(public:)676 4525 y(off_kPFrame\(off_PFrame)i(*r=NULL\))d(:)f
(off_kHWResUnit\(r\))j({};)676 4616 y(virtual)e(err_t)f(handle\(const)i
(off_shtl_id_t)h(&sender,)1500 4707 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 4799 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)598
4890 y(};)1885 5255 y Fz(262)p eop
PStoPSsaved restore
%%Page: (264,265) 133
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
263 264 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kPFrame::handle)30 b Fj(implementation.)e Fk(i)p
Fq(\021)598 614 y Fi(err_t)40 b(off_kPFrame::handle\(const)45
b(off_shtl_id_t)d(&sender,)1539 706 y(vm_size_t)f(msz,)g(vm_size_t)g
(rsz,)1539 797 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
888 y({)676 980 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(switch\(m->m_type\){)676 1345 y(case)h(OFF_MSG_R_INIT:)755
1436 y(return)g(EOK;)676 1528 y(default:)755 1619 y(return)g
(off_kHWResUnit::handle\(sende)q(r,ms)q(z,rsz)q(,m,r)q(\);)676
1710 y(})598 1802 y(})515 1976 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l
(ame)g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2067
y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(ENTRY)515
2341 y Fn(4.1.10)112 b(Memory)37 b(banks)i Fd(C)8 b FC(++)38
b Fn(source)g(\014les)515 2494 y Fz(Memory)26 b(bank)i(co)r(de)f(is)h
(k)n(ept)f(in)h Fx(hw/MBank.h)23 b Fz(and)28 b Fx(hw/MBank.c)p
Fz(.)515 2627 y Fk(h)p Fj(MBank.h*)11 b Fk(i)p Fq(\021)598
2719 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2810 y Fi(#ifndef)41
b(__OFF_MBANK_H)598 2901 y(#define)g(__OFF_MBANK_H)h(1)598
3084 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(dep)l(endencies.)i
Fk(i)598 3358 y Fi(#ifdef)40 b(__KERNEL__)598 3449 y
Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank.)g Fk(i)598 3540
y Fi(#endif)40 b(//)g(__KERNEL__)598 3723 y(#include)h(<prtl/ex.h>)598
3814 y(#include)g(<hw/uMBank.h>)598 4180 y(#endif)f(//)g(__OFF_MBANK_H)
1885 5255 y Fz(263)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
264 265 bop 515 523 a Fk(h)p Fj(MBank.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/MBank.h>)434 b(//)40 b(Exported)h(interface)598
888 y Fk(h)p Fj(O\013)27 b(memory)h(b)l(ank)g(implementation)g(dep)l
(endencies.)i Fk(i)598 1071 y(h)p Fj(O\013)d(memory)h(b)l(ank)g(static)
h(memb)l(ers.)f Fk(i)598 1254 y(h)p Fi(off)p 750 1254
24 4 v 29 w(MBank::alloc)i Fj(and)e Fi(free)g Fj(implementation.)g
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(MBank::start)i
Fj(implementation.)d Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(MBank::get)p 1169 1436 V 30 w(pgsize)i Fj(implementation.)e
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(MBank::notify)j
Fj(implementation.)d Fk(i)598 1619 y(h)p Fi(off)p 750
1619 V 29 w(MBank::allocate)p 1364 1619 V 31 w(kmem)i
Fj(implementation.)e Fk(i)598 1710 y(h)p Fi(off)p 750
1710 V 29 w(MBank::get)p 1169 1710 V 30 w(url)h Fj(implementation.)g
Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(MBank::nameof)i
Fj(implementation.)d Fk(i)598 1893 y(h)p Fi(off)p 750
1893 V 29 w(MBank::operator<<)k Fj(implementation.)c
Fk(i)598 1984 y(h)p Fi(off)p 750 1984 V 29 w(MBank::cleanup)j
Fj(implementation.)e Fk(i)598 2076 y(h)p Fi(off)p 750
2076 V 29 w(MBank::copy)p 1208 2076 V 30 w(state)h Fj(implementation.)e
Fk(i)598 2167 y(h)p Fi(off)p 750 2167 V 29 w(MBank::restore)p
1325 2167 V 31 w(state)i Fj(implementation.)e Fk(i)598
2258 y(h)p Fi(off)p 750 2258 V 29 w(MBank::can)p 1169
2258 V 30 w(melt)h Fj(implementation.)g Fk(i)598 2350
y(h)p Fi(off)p 750 2350 V 29 w(MBank::freeze)p 1286 2350
V 31 w(state)g Fj(implementation.)g Fk(i)598 2441 y(h)p
Fi(off)p 750 2441 V 29 w(MBank::melt)p 1208 2441 V 30
w(state)h Fj(implementation.)e Fk(i)598 2532 y(h)p Fi(off)p
750 2532 V 29 w(MBank::get)p 1169 2532 V 30 w(inspector)j
Fj(implementation.)d Fk(i)598 2623 y(h)p Fi(off)p 750
2623 V 29 w(MBank::get)p 1169 2623 V 30 w(navigator)j
Fj(implementation.)d Fk(i)598 2715 y(h)p Fi(off)p 750
2715 V 29 w(MBank::set)p 1169 2715 V 30 w(core)h Fj(implementation.)g
Fk(i)598 2806 y(h)p Fi(off)p 750 2806 V 29 w(MBank::get)p
1169 2806 V 30 w(kend)g Fj(implementation.)g Fk(i)639
2947 y Fz(P)n(age)e(frame)h(co)r(de)h(is)f(k)n(ept)h(in)f
Fx(hw/PFrame.h)d Fz(and)j Fx(hw/PFrame.C)p Fz(.)515 3080
y Fk(h)p Fj(PF)-6 b(r)l(ame.h*)11 b Fk(i)p Fq(\021)598
3171 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3263 y Fi(#ifndef)41
b(__OFF_PFRAME_H)598 3354 y(#define)g(__OFF_PFRAME_H)h(1)598
3537 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(dep)l(endencies.)h
Fk(i)598 3628 y(h)p Fj(O\013)e(p)l(age)h(fr)l(ame)g(mo)l(de)g(bits.)g
Fk(i)598 3719 y Fi(#ifdef)40 b(__KERNEL__)598 3811 y
Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame.)g Fk(i)598 3902
y Fi(#endif)40 b(//)g(__KERNEL__)598 4176 y(#include)h(<prtl/ex.h>)598
4267 y(#include)g(<hw/uPFrame.h>)598 4541 y(#endif)f(//)g
(__OFF_PFRAME_H)1885 5255 y Fz(264)p eop
PStoPSsaved restore
%%Page: (266,267) 134
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
265 266 bop 515 523 a Fk(h)p Fj(PF)-6 b(r)l(ame.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<hw/PFrame.h>)395 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(implementation)g(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(p)l(age)h(fr)l(ame)g
(static)h(memb)l(ers.)f Fk(i)598 1254 y(h)p Fi(off)p
750 1254 24 4 v 29 w(PFrame::off)p 1208 1254 V 30 w(PFrame)h
Fj(implementation.)f Fk(i)598 1345 y(h)p Fi(off)p 750
1345 V 29 w(PFrame::operator<<)j Fj(implementation.)d
Fk(i)598 1436 y(h)p Fi(off)p 750 1436 V 29 w(PFrame::get)p
1208 1436 V 30 w(url)p 1355 1436 V 29 w(holder)h Fj(implementation.)f
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(PFrame::copy)p
1247 1528 V 31 w(state)g Fj(implementation.)g Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(PFrame::restore)p
1364 1619 V 31 w(state)h Fj(implementation.)e Fk(i)598
1710 y(h)p Fi(off)p 750 1710 V 29 w(PFrame::operator)42
b(new)29 b Fj(implementation.)e Fk(i)598 1802 y(h)p Fi(off)p
750 1802 V 29 w(PFrame::operator)42 b(delete)29 b Fj(implementation.)f
Fk(i)598 1893 y(h)p Fi(off)p 750 1893 V 29 w(PFrame::get)p
1208 1893 V 30 w(inspector)i Fj(implementation.)d Fk(i)639
2027 y Fz(The)19 b(page)e(allo)r(cator)g(can)h(b)r(e)h(found)f(in)h
Fx(hw/PgAllocator.h)12 b Fz(and)18 b Fx(hw/PgAllocator.C)o
Fz(.)515 2140 y Fk(h)p Fj(PgA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 2232 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2323 y Fi(#ifndef)41 b(__OFF_PG_ALLOCATOR_H)598 2414
y(#define)g(__OFF_PG_ALLOCATOR_H)i(1)598 2597 y Fk(h)p
Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l(ator)h(dep)l
(endencies.)g Fk(i)598 2780 y Fi(#ifdef)40 b(__KERNEL__)598
2871 y Fk(h)p Fj(O\013)27 b(linkable)g(p)l(age)i(fr)l(ame.)e
Fk(i)598 2962 y(h)p Fj(O\013)g(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l
(ator.)g Fk(i)598 3054 y Fi(#endif)40 b(//)g(__KERNEL__)598
3236 y(#endif)g(//)g(__OFF_PG_ALLOCATOR_H)515 3384 y
Fk(h)p Fj(PgA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q Fq(\021)598
3475 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3658 y Fi(#include)41
b(<hw/PgAllocator.h>)200 b(//)40 b(exported)h(interface)598
3749 y Fk(h)p Fj(O\013)27 b(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l(ator)h
(implementation)f(dep)l(endencies.)h Fk(i)598 3932 y(h)p
Fj(O\013)e(p)l(age)h(fr)l(ame)g(al)t(lo)l(c)l(ator)h(static)f(memb)l
(ers.)h Fk(i)598 4115 y(h)p Fi(off)p 750 4115 V 29 w(PgAllocator::off)p
1403 4115 V 31 w(PgAllocator)h Fj(implementation.)e Fk(i)598
4206 y(h)p Fi(off)p 750 4206 V 29 w(PgAllocator::set)p
1403 4206 V 31 w(core)h Fj(implementation.)e Fk(i)515
4458 y(h)p Fj(uMBank.h*)11 b Fk(i)p Fq(\021)598 4550
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 4732 y(h)p Fj(O\013)f(memory)h(b)l(ank)g
(messages.)h Fk(i)598 4915 y(h)p Fj(O\013)e(memory)h(b)l(ank)g(for)g
(users.)g Fk(i)1885 5255 y Fz(265)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
266 267 bop 515 523 a Fk(h)p Fj(kMBank.h*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/MBank.h>)238 b(//)40 b(Exported)h(interface.)598
888 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
980 y(#include)h(<klib/kResource.h>)598 1071 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 1162 y(#include)h(<string.h>)598
1345 y(#ifndef)g(__OFF_KMBANK_H)598 1436 y(#define)g(__OFF_KBMANK_H)h
(1)598 1528 y(#ifdef)e(__KERNEL__)598 1710 y Fk(h)p Fj(O\013)27
b(memory)h(b)l(ank)g(for)g(users)h(in-kernel.)f Fk(i)598
1893 y Fi(extern)40 b(off_kMBank)i(kmbanks[];)598 1984
y(extern)e(off_KernPrtlHandlerFn)k(*kmhandlers[];)598
2167 y(#endif)c(//)g(__KERNEL__)598 2258 y(#endif)g(//)g(__OFF_KNODE_H)
1885 5255 y Fz(266)p eop
PStoPSsaved restore
%%Page: (268,269) 135
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
267 268 bop 515 523 a Fk(h)p Fj(kMBank.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<node/Node.h>)238 b(//)40 b(Exported)h(interface.)598
888 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
980 y(#include)h(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1071 y(#include)h(<string.h>)598 1254 y(#include)g(<hw/kMBank.h>)598
1345 y(#include)g(<hw/kPFrame.h>)598 1619 y(off_kMBank)g
(kmbanks[OFF_NMBANKS_MAX];)598 1802 y(static)598 1893
y(err_t)f(off_kMBank_handler0\(const)45 b(off_shtl_id_t)d(&sender,)1892
1984 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1892 2076
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 2167 y({)676
2258 y(return)f(kmbanks[0].handle\(sender,msz,r)q(sz,m)q(,r\);)598
2350 y(})598 2441 y(static)598 2532 y(err_t)f
(off_kMBank_handler1\(const)45 b(off_shtl_id_t)d(&sender,)1892
2623 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1892 2715
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 2806 y({)676
2897 y(return)f(kmbanks[1].handle\(sender,msz,r)q(sz,m)q(,r\);)598
2989 y(})598 3080 y(static)598 3171 y(err_t)f
(off_kMBank_handler2\(const)45 b(off_shtl_id_t)d(&sender,)1892
3263 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1892 3354
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 3445 y({)676
3537 y(return)f(kmbanks[2].handle\(sender,msz,r)q(sz,m)q(,r\);)598
3628 y(})598 3719 y(static)598 3811 y(err_t)f
(off_kMBank_handler3\(const)45 b(off_shtl_id_t)d(&sender,)1892
3902 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1892 3993
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 4085 y({)676
4176 y(return)f(kmbanks[3].handle\(sender,msz,r)q(sz,m)q(,r\);)598
4267 y(})598 4359 y(off_KernPrtlHandlerFn)j
(*kmhandlers[OFF_NMBANKS_MAX])h(=)40 b({)676 4450 y
(off_kMBank_handler0,)676 4541 y(off_kMBank_handler1,)676
4633 y(off_kMBank_handler2,)676 4724 y(off_kMBank_handler3)598
4815 y(};)1885 5255 y Fz(267)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
268 269 bop 598 523 a Fk(h)p Fi(off)p 750 523 24 4 v
29 w(kMBank::handle)30 b Fj(implementation.)e Fk(i)515
789 y(h)p Fj(uPF)-6 b(r)l(ame.h*)11 b Fk(i)p Fq(\021)598
880 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 971 y(h)p Fj(O\013)f(p)l(age)h(fr)l(ame)g
(for)g(users.)g Fk(i)515 1146 y(h)p Fj(kPF)-6 b(r)l(ame.h*)11
b Fk(i)q Fq(\021)598 1237 y Fi(//)598 1328 y(//)39 b(===)h(DO)g(NOT)g
(READ)g(OR)g(MODIFY)g(THIS)g(FILE)h(===)598 1420 y(//)598
1511 y(//)e(This)i(is)e(a)h(source)g(file)g(generated)i(by)d(the)h
(noweb)h(literate)598 1602 y(//)e(programming)j(tool.)598
1694 y(//)598 1785 y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g
(literate)h(source)f(code)g(instead.)598 1876 y(//)598
2059 y(#include)h(<hw/PFrame.h>)238 b(//)40 b(Exported)h(interface.)598
2150 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
2242 y(#include)h(<klib/kResource.h>)598 2333 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 2424 y(#include)h(<string.h>)598
2607 y(#ifndef)g(__OFF_KPFRAME_H)598 2698 y(#define)g(__OFF_KPFRAME_H)h
(1)598 2790 y(#ifdef)e(__KERNEL__)598 2972 y Fk(h)p Fj(O\013)27
b(p)l(age)h(fr)l(ame)g(for)g(users)h(in-kernel.)f Fk(i)598
3155 y Fi(#endif)40 b(//)g(__KERNEL__)598 3246 y(#endif)g(//)g
(__OFF_KPFRAME_H)1885 5255 y Fz(268)p eop
PStoPSsaved restore
%%Page: (270,271) 136
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
269 270 bop 515 523 a Fk(h)p Fj(kPF)-6 b(r)l(ame.C*)11
b Fk(i)p Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g
(READ)g(OR)g(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598
888 y(//)e(This)i(is)e(a)h(source)g(file)g(generated)i(by)d(the)h
(noweb)h(literate)598 980 y(//)e(programming)j(tool.)598
1071 y(//)598 1162 y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g
(literate)h(source)f(code)g(instead.)598 1254 y(//)598
1436 y(#include)h(<hw/PFrame.h>)238 b(//)40 b(Exported)h(interface.)598
1528 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
1619 y(#include)h(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1710 y(#include)h(<string.h>)598 1893 y(#include)g(<hw/kPFrame.h>)598
2076 y Fk(h)p Fi(off)p 750 2076 24 4 v 29 w(kPFrame::handle)30
b Fj(implementation.)e Fk(i)515 2441 y Fn(4.1.11)112
b(Con)m(v)m(ersion)37 b(routines)515 2594 y Fz(W)-7 b(e)34
b(pro)n(vide)e(a)h(couple)h(of)f(metho)r(ds)h(to)g(con)n(v)n(ert)e
(addresses)g(to)i(page)e(frame)i(n)n(um)n(b)r(ers)515
2694 y(and)40 b(vice-v)n(ersa.)74 b(They)41 b(op)r(erate)f(on)g(the)h
(minim)n(um)h(preferred)d(page)h(size)h(and)f(are)515
2793 y(implemen)n(ted)28 b(using)f(mac)n(hine)g(dep)r(enden)n(t)i
(routines.)515 2926 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2926 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3017 y Fi(//)39 b(Address)i(to)f(PFN.)598
3109 y(static)g(vm_offset_t)i(a2p\(vm_offset_t)h(va\){)d(return)g
(off_mdepMBank::a2p\(va\);)45 b(})598 3200 y(//)39 b(PFN)h(to)g
(address.)598 3291 y(static)g(vm_offset_t)i(p2a\(vm_offset_t)h(va\){)d
(return)g(off_mdepMBank::p2a\(va\);)45 b(})639 3524 y
Fz(Besides,)27 b(a)g(mask)g(to)h(get)f(page)g(o\013sets)g(is)h(exp)r
(orted)f(to)r(o.)515 3640 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 3640 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3731 y Fi(//)39 b(Returns)i(the)f(mask)g(for)g(page)g
(offsets.)598 3823 y(static)g(vm_offset_t)i(pmask\(void\))g({)d(return)
i(off_mdepMBank::pmask\(\);)j(})639 3947 y Fz(Some)28
b(other)f(utilities)h(are)f(implemen)n(ted)h(using)f(the)h(previous)e
(ones.)515 4080 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4080 V 29 w(MBank)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 4171 y Fi(//)39 b(Truncate)i(or)f(round)h(to)e(the)h(next)g
(page)g(boundary.)598 4263 y(static)g(vm_offset_t)i
(ptrunc\(vm_offset_t)h(va\))d({)676 4354 y(return)h(va)e(&)h(~)f
(off_mdepMBank::pmask\(\);)598 4445 y(})598 4537 y(static)h
(vm_offset_t)i(pround\(vm_offset_t)h(va\))d({)676 4628
y(return)h(\(va)f(+)f(off_mdepMBank::pmask\(\)\))45 b(&)39
b(~)h(off_mdepMBank::pmask\(\);)598 4719 y(})1885 5255
y Fz(269)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
270 271 bop 515 523 a Fn(4.1.12)112 b(Multiple)36 b(page)i(size)f(supp)
s(ort)515 676 y Fz(T)-7 b(o)39 b(supp)r(ort)h(m)n(ultiple)g(page)f
(sizes)h(w)n(e)f(use)h(m)n(ultiple)h(memory)e(banks)g(co)n(v)n(ering)f
(the)515 776 y(same)30 b(regions)g(of)h(memory)-7 b(.)47
b(P)n(age)29 b(sizes)i(are)f(a)h(m)n(ultiple)h(of)f(the)g(minim)n(um)h
(page)e(size,)515 876 y(th)n(us)j(w)n(e)f(main)n(tain)g(a)h
Fy(primary)42 b Fz(memory)32 b(bank)g(with)h(page)f(frames)g(of)h(the)g
(minim)n(um)515 975 y(\(primary\))f(size.)51 b(F)-7 b(or)31
b(eac)n(h)h(m)n(ultiple)h(page)f(size)g(w)n(e)g(main)n(tain)g(a)g
Fy(se)l(c)l(ondary)41 b Fz(memory)515 1075 y(bank)22
b(aggregating)d(as)i(man)n(y)h(primary)f(pages)g(as)h(necessary)e(in)n
(to)i(eac)n(h)f(secondary)g(page.)515 1174 y(These)30
b(secondary)f(memory)g(banks)h(are)g(not)g(real)g(ones,)g(they)h(only)f
(translate)g(a)g(single)515 1274 y(op)r(eration)c(in)n(to)i(m)n
(ultiple)g(op)r(erations)e(on)h(primary)g(pages.)515
1407 y Fk(h)p Fj(O\013)g(se)l(c)l(ondary)j(memory)e(b)l(ank.)g
Fk(i)p Fq(\021)598 1498 y Fi(class)40 b(off_SMBank)i(:)d(public)i
(off_MBank)g({)598 1590 y(public:)676 1681 y(//)f(Creates)h(a)e
(secondary)i(memory)g(bank)f(for)g(the)g(given)g(primary)h(one.)676
1772 y(inline)g(off_SMBank\(off_MBank)j(*primary,)d(natural_t)g
(shift_factor\);)676 1955 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 1955 24 4 v 29 w(SMBank)p Fj(.)i
Fk(i)598 2046 y Fi(protected:)676 2137 y(off_MBank)41
b(*m_primary;)h(//)e(Primary)h(memory)f(bank.)676 2229
y(natural_t)h(m_shift;)159 b(//)40 b(sizeof\(primary_g\)<<m_shift==si)q
(zeof)q(\(sec)q(ondar)q(y_pg)q(\).)598 2320 y(};)639
2461 y Fz(When)32 b(a)e(secondary)g(bank)g(is)h(created)f(it)i
(initializes)e(itself)i(as)e(an)n(y)g(other)h(memory)515
2561 y(bank)c(and)g(records)f(the)i(address)f(of)g(the)h(primary)f
(bank.)515 2694 y Fk(h)p Fi(off)p 667 2694 V 29 w(SMBank::off)p
1125 2694 V 30 w(SMBank)i Fj(implementation.)f Fk(i)o
Fq(\021)598 2785 y Fi(//)39 b(Creates)i(a)f(secondary)h(memory)g(bank)f
(for)g(the)g(given)g(primary)h(one.)598 2876 y(inline)f
(off_SMBank::off_SMBank\(off_M)q(Bank)46 b(*primary,)41
b(natural_t)g(shift_factor\))i(:)676 2968 y(off_MBank\(\),)676
3059 y(m_primary\(primary\),)676 3150 y(m_shift\(shift_factor\))598
3242 y({;})639 3474 y Fz(As)24 b(secondary)e(banks)i(do)f(not)h(ha)n(v)
n(e)f(the)h(minim)n(um)h(preferred)d(page)h(size)h(they)g(m)n(ust)515
3574 y(rede\014ne)34 b Fx(get)p 968 3574 27 4 v 31 w(pgsize)e
Fz(to)j(return)f(the)i(minim)n(um)g(preferred)d(size)i(for)g
Fy(this)42 b Fz(secondary)515 3673 y(bank)27 b(\(whic)n(h)i(is)f(a)f(m)
n(ultiple)i(of)f(that)g(in)g(the)h(primary)e(bank\).)38
b(Note)28 b(that)g Fx(get)p 3092 3673 V 30 w(pgsize)515
3773 y Fz(is)f(for)g(in-k)n(ernel)g(use)g(only)-7 b(.)515
3906 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3906 24 4 v 29 w(SMBank)p Fj(.)h Fk(i)p
Fq(\021)598 3997 y Fi(//)39 b(Returns)i(the)f(minimum)h(preferred)g
(page)f(size.)598 4088 y(vm_size_t)h(get_pgsize\(void\);)515
4263 y Fk(h)p Fi(off)p 667 4263 V 29 w(SMBank::get)p
1125 4263 V 30 w(pgsize)29 b Fj(implementation.)f Fk(i)o
Fq(\021)598 4354 y Fi(//)39 b(Returns)i(the)f(minimum)h(preferred)g
(page)f(size.)598 4445 y(vm_size_t)h(get_pgsize\(void\))598
4537 y({)637 4628 y(return)g(m_mdep.get_pgsz\(0\);)598
4719 y(})1885 5255 y Fz(270)p eop
PStoPSsaved restore
%%Page: (272,273) 137
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
271 272 bop 639 523 a Fz(P)n(age)24 b(frame)h(n)n(um)n(b)r(ers)g(ha)n
(v)n(e)f(no)n(w)h(a)g(di\013eren)n(t)g(meaning,)g(th)n(us)h(w)n(e)f(ha)
n(v)n(e)f(to)h(rede\014ne)515 623 y(more)i(metho)r(ds.)515
739 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(SMBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
830 y Fi(//Gets)40 b(a)g(page)g(frame)g(from)g(its)g(distributed)i(or)e
(physical)h(address)598 922 y(off_PFrame)g(*operator+\(vm_offset_t)j
(ma\);)598 1013 y(//)39 b(Address)i(to)f(PFN.)598 1104
y(vm_offset_t)h(a2p\(vm_offset_t)i(va\);)598 1196 y(//)c(PFN)h(to)g
(address.)598 1287 y(vm_offset_t)h(p2a\(vm_offset_t)i(va\);)598
1378 y(//)c(Returns)i(the)f(mask)g(for)g(page)g(offsets.)598
1469 y(vm_offset_t)h(pmask\(void\);)515 1627 y Fk(h)p
Fi(off)p 667 1627 V 29 w(SMBank::operator+)p Fj(,)p Fi(a2p)p
Fj(,)p Fi(p2a)31 b Fj(and)d Fi(pmask)h Fj(implementation.)e
Fk(i)p Fq(\021)598 1719 y Fi(//Gets)40 b(a)g(page)g(frame)g(from)g(its)
g(distributed)i(or)e(physical)h(address)598 1810 y(off_PFrame)g
(*off_SMBank::operator+\(vm_of)q(fset)q(_t)k(ma\))40
b({)755 1901 y(assert\(valid\(\)\);)755 1993 y(return)g
(&\(m_alloc+a2p\(ma\)\)->l_pf;)598 2084 y(})598 2267
y(//)f(Address)i(to)f(PFN.)598 2358 y(vm_offset_t)h
(off_SMBank::a2p\(const)j(vm_offset_t)e(va\))598 2449
y({)676 2540 y(return)f(m_mdep.a2p\(va\);)598 2632 y(})598
2814 y(//)e(PFN)h(to)g(address.)598 2906 y(vm_offset_t)h
(off_SMBank::p2a\(vm_offset_t)46 b(va\))598 2997 y({)676
3088 y(return)41 b(m_mdep::p2a\(va\);)598 3180 y(})598
3362 y(//)e(Returns)i(the)f(mask)g(for)g(page)g(offsets.)598
3454 y(vm_offset_t)h(off_SMBank::pmask\(void\))598 3545
y({)676 3636 y(return)g(m_mdep::pmask\(\);)598 3728 y(})1885
5255 y Fz(271)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
272 273 bop 639 523 a Fz(Besides,)27 b(w)n(e)g(m)n(ust)h(main)n(tain)f
(the)h(coherency)e(b)r(et)n(w)n(een)h(the)h(primary)f(and)g(the)h(sec-)
515 623 y(ondary)34 b(banks.)60 b(That)36 b(means)f(that)h(a)f
(secondary)f(page)h(m)n(ust)h(b)r(e)g(considered)e(to)i(b)r(e)515
722 y(allo)r(cated)26 b(when)h(an)n(y)f(of)h(its)g(primary)f(pages)f
(are)h(allo)r(cated,)h(and)f(the)i(same)e(for)g(deallo-)515
822 y(cation,)h(protection,)g(etc.)37 b(W)-7 b(e)28 b(do)f(suc)n(h)g
(sync)n(hronization)f(lazily)-7 b(.)639 922 y(When)35
b(a)f(secondary)f(page)g(is)i(allo)r(cated,)g(w)n(e)f(double-c)n(hec)n
(k)f(that)i(all)f(its)g(primary)515 1021 y(pages)27 b(are)h(a)n(v)-5
b(ailable)27 b(and)i(allo)r(cate)f(them.)41 b(Should)29
b(allo)r(cation)e(of)i(primary)e(pages)h(fail,)515 1121
y(w)n(e)c(consider)f(the)h(secondary)f(page)g(to)h(b)r(e)h(allo)r
(cated)f(and)g(retry)f(the)i(op)r(eration.)34 b(In)25
b(that)515 1220 y(case,)g(the)i(secondary)d(page)h(is)h(protected)g
(with)h(the)f(k)n(ernel)f(domain)h(and)g(access)f(righ)n(ts.)515
1353 y Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1353 24 4 v 29 w(SMBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
1445 y Fi(//)39 b(Allocates)j(a)d(page)h(frame.)598 1536
y(off_PFrame)h(*alloc\(boolean_t)i(use_revocation\);)598
1627 y(off_PFrame)e(*alloc\(const)h(off_pg_id_t)g(&at,)e(boolean_t)h
(use_revocation\);)598 1719 y(//)e(Deallocates)j(a)e(page)g(frame.)598
1810 y(void)g(free\(const)h(off_PFrame)h(*pf\);)639 1951
y Fz(When)25 b(a)e(secondary)f(page)h(is)g(deallo)r(cated)g(w)n(e)h
(deallo)r(cate)f(all)g(of)h(its)g(primary)e(pages.)515
2084 y Fk(h)p Fi(off)p 667 2084 V 29 w(SMBank::alloc)30
b Fj(implementation.)d Fk(i)p Fq(\021)598 2175 y Fi(//)39
b(Allocates)j(a)d(page)h(frame.)598 2267 y(off_PFrame)h
(*off_SMBank::alloc\(boolean_t)46 b(use_revocation\))598
2358 y({)676 2449 y(off_PFrame)c(*attempt;)676 2540 y(vm_offset_t)g(m;)
676 2632 y(natural_t)f(count;)676 2814 y(while)g
(\(\(attempt=off_MBank::alloc\(use_)q(revo)q(catio)q(n\)\)!)q(=)k
(NULL\))755 2906 y(if)39 b(\(attempt->alloc_primaries\(\)\))833
2997 y(return)i(attempt;)676 3180 y(//)f(This)g(is)g(what)g
(alloc_primaries)i(should)f(do.)755 3271 y
(for\(count=1<<m_shift,m=*attempt)q(;)912 3362 y(count)f(&&)g
(m_primary->alloc\(m,use_revocati)q(on\);)912 3454 y
(count--,m+=m_primary->get_pgsiz)q(e\(\)\))833 3545 y(;)755
3636 y(if)f(\(count\))833 3728 y(while\(count--\){)912
3819 y(m_primary->free\(*m_primary+m\);)912 3910 y
(m-=m_primary->get_pgsize\(\);)833 4002 y(})755 4093
y(else)833 4184 y(return)i(attempt;)676 4276 y(})676
4367 y(return)g(NULL;)598 4458 y(})598 4641 y(off_PFrame)g
(*off_SMBank::alloc\(const)k(off_pg_id_t)d(&at,)e(boolean_t)h
(use_revocation\);)598 4732 y(//)e(Deallocates)j(a)e(page)g(frame.)598
4824 y(void)g(off_SMBank::free\(const)k(off_PFrame)e(*pf\);)1885
5255 y Fz(272)p eop
PStoPSsaved restore
%%Page: (274,275) 138
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
273 274 bop 639 523 a Fz(Secondary)22 b(page)g(op)r(erations)g(b)r(eha)
n(v)n(e)h(as)f(exp)r(ected;)j(b)r(esides,)f(eac)n(h)f(page)f(op)r
(eration)515 623 y(is)27 b(forw)n(arded)f(to)i(all)f(in)n(v)n(olv)n(ed)
f(primary)g(pages.)722 805 y FA(NOTE:)j Fz(Will)h(need)g(to)g
(rede\014ned)f(free)h(to)f(free)h(the)g(primary)f(pages,)g(and)722
905 y(also)36 b(rede\014ne)g(ev)n(ery)f(page)h(op)r(eration)g(to)g
(forw)n(ard)f(it)i(to)f(ev)n(ery)g(primary)722 1005 y(page)27
b(frame.)36 b(A)28 b(priv)-5 b(ate)28 b(iterator)e(o)n(v)n(er)g
(primary)g(pages)h(will)g(b)r(e)h(handy)-7 b(.)515 1237
y Fn(4.1.13)112 b(Memory)37 b(banks)i(for)f(ix86)e(based)j(arc)m
(hitectures)515 1390 y Fz(Mac)n(hine)21 b(dep)r(enden)n(t)h(memory)f
(banks)g(are)g(structures)g(used)g(to)h(kno)n(w)f(ho)n(w)g(man)n(y)g
(mem-)515 1490 y(ory)29 b(banks)g(are)g(installed,)i(and)e(also)g(to)h
(carry)e(out)i(some)g(simple)g(mac)n(hine)f(dep)r(enden)n(t)515
1589 y(tasks.)515 1722 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(memory)f(b)l(ank.)g Fk(i)p Fq(\021)598 1814 y Fi(//)39
b(A)h(machine)h(dependent)g(memory)g(bank.)598 1905 y(//)598
1996 y(class)f(off_mdepMBank)i({)598 2088 y(private:)676
2179 y(//)e(Things)g(known)h(by)f(the)f(boot)i(procedure)g(about)f
(this)g(memory)h(bank)676 2270 y(//)676 2362 y(static)g(vm_offset_t)h
(m_base;)158 b(//)40 b(first)g(valid)g(address)h(in)f(this)g(node)676
2453 y(static)h(vm_offset_t)h(m_end;)197 b(//)40 b(last)g(valid)g
(address)h(in)f(this)g(node.)676 2544 y(vm_offset_t)i(m_first;)394
b(//)40 b(first)g(valid)g(address)h(in)f(this)g(memory)h(bank.)676
2636 y(vm_offset_t)h(m_last;)433 b(//)40 b(last)g(valid)g(address)h(in)
f(this)g(memory)g(bank.)676 2727 y(unsigned8_t)i(m_flags;)394
b(//)40 b(capabilities)i(\(MF_DMA,MF_IOM,MF_PER\))676
2818 y(vm_size_t)120 b(m_pgsz[OFF_NPGSZ_MAX];)44 b(//)c(Preferred)h
(page)f(sizes)h(for)f(this)g(m.bank.)676 2910 y(vm_size_t)120
b(m_npgs;)433 b(//)40 b(#)f(of)h(page)g(frames)h(installed.)676
3001 y(unsigned8_t)h(m_mat;)472 b(//)40 b(mean)g(access)g(time.)598
3092 y(public:)676 3183 y(//)g(Accessors)h(to)f(tell)g(users...)676
3275 y(vm_offset_t)i(get_base\(void\))g(const)f({)e(return)i(m_base;)g
(})676 3366 y(vm_offset_t)h(get_end\(void\))81 b(const)41
b({)e(return)i(m_end;)f(})676 3457 y(vm_offset_t)i
(get_first\(void\)const)i({)39 b(return)i(m_first;)g(})676
3549 y(vm_offset_t)h(get_last\(void\))g(const)f({)e(return)i(m_last;)g
(})676 3640 y(unsigned8_t)h(get_flags\(void\)const)i({)39
b(return)i(m_flags;)g(})676 3731 y(vm_size_t)120 b(get_pgsz\(int)42
b(i\)const)f({)e(return)i(m_pgsz[i];)g(})676 3823 y(vm_size_t)120
b(get_npgs\(void\))42 b(const)f({)e(return)i(m_npgs;)g(})676
3914 y(unsigned8_t)h(get_mat\(void\))81 b(const)41 b({)e(return)i
(m_mat;)f(})676 4097 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4097 24 4 v 29 w(mdepMBank)p Fj(.)i Fk(i)598
4188 y Fi(};)515 4454 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(memory)f(b)l(ank)h(dep)l(endencies.)g Fk(i)p Fq(\021)598
4545 y Fi(#include)41 b(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 4636 y(#include)h(<klib/limits.h>)317
b(//)40 b(for)g(OFF_NPGSZ_MAX)i(et)d(al.)515 4811 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(memory)f(b)l(ank)h(static)g
(memb)l(ers.)f Fk(i)p Fq(\021)598 4902 y Fi(vm_offset_t)41
b(off_mdepMBank::m_base;)k(//)39 b(first)i(valid)f(address)h(in)f(this)
g(node)598 4993 y(vm_offset_t)h(off_mdepMBank::m_end;)84
b(//)39 b(last)i(valid)f(address)h(in)e(this)i(node.)1885
5255 y Fz(273)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
274 275 bop 639 523 a Fz(Mac)n(hine)18 b(dep)r(enden)n(t)i(memory)e
(banks)g(are)f(created)h(from)g(their)h(memory)f(bank)g(n)n(um-)515
623 y(b)r(er.)515 739 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 739 24 4 v 29 w(mdepMBank)p Fj(.)i Fk(i)p
Fq(\021)598 830 y Fi(//)39 b(Creates)i(the)f(i-th)g(mdepMBank)598
922 y(off_mdepMBank\(natural_t)k(i\);)639 1046 y Fz(T)-7
b(o)27 b(kno)n(w)g(ho)n(w)g(man)n(y)g(memory)g(banks)g(are)g(installed)
g(this)h(metho)r(d)g(is)g(pro)n(vided.)515 1162 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1162
V 29 w(mdepMBank)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 1254
y Fi(//)39 b(#)h(of)g(memory)g(banks)h(on)e(intels.)598
1345 y(static)h(natural_t)i(how_many\(void\);)639 1469
y Fz(The)f(n)n(um)n(b)r(er)g(of)g(memory)f(banks)h(is)g(determined)g
(according)e(to)i(the)g(last)g(v)-5 b(alid)515 1569 y(memory)27
b(address,)g(kno)n(wn)h(b)n(y)g(lo)r(oking)f(in)n(to)h(the)h(OSKit)e(m)
n(ultib)r(o)r(ot)i(information.)38 b(On)515 1669 y(in)n(tels,)44
b(w)n(e)c(de\014ne)h(three)f(memory)g(banks:)62 b(the)41
b(IO)f(map)h(and)f(DMA)i(capable)d(\014rst)515 1768 y(Mb)n(yte,)27
b(the)h(DMA)h(capable)d(region)h(up)h(to)f(the)h(\014rst)f(16)g(Mb)n
(ytes,)g(and)h(remaining)e(core)515 1868 y(memory)-7
b(.)515 2001 y Fk(h)p Fi(off)p 667 2001 V 29 w(mdepMBank::how)p
1242 2001 V 31 w(many)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 2092 y Fi(//)39 b(#)h(of)g(memory)g(banks)h(on)e(intels.)
598 2183 y(natural_t)i(off_mdepMBank::how_many\(void\))598
2275 y({)676 2366 y(extern)g(struct)f(multiboot_info)j(*boot_info;)676
2457 y(extern)e(vm_offset_t)473 b(phys_mem_max;)676 2640
y Fk(h)p Fj(Ensur)l(e)29 b(multib)l(o)l(ot)f(information)g(is)f
(available.)g Fk(i)676 2731 y Fi(boot_info->mem_upper=phys_me)q(m_max)q
(;)676 2823 y(if)40 b(\(boot_info->mem_upper)k(<)39 b(1*MBYTE\))755
2914 y(return)h(1;)676 3005 y(else)g(if)g(\(boot_info->mem_upper)k(<)39
b(16*MBYTE\))755 3097 y(return)h(2;)676 3188 y(else)755
3279 y(return)g(3;)598 3371 y(})515 3636 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(memory)f(b)l(ank)h(implementation)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 3728 y Fi(#include)41
b(<flux/machine/multiboot.h>)k(//)40 b(for)g(multiboot_{info,module})k
(et)c(al.)598 3819 y(#include)h(<flux/magnitudes.h>)161
b(//)40 b(for)g(KBYTE)g(et)g(al.)515 4076 y FA(Bo)s(ot)31
b(time)f(memory)f(information)515 4230 y Fz(T)-7 b(o)28
b(create)f(a)h(mac)n(hine)g(dep)r(enden)n(t)h(memory)e(bank)h(w)n(e)g
(ask)f(for)h(an)n(y)f(b)r(o)r(ot)i(information)515 4329
y(and)e(\014ll)h(it)g(up.)37 b(W)-7 b(e)28 b(\014rst)g(c)n(hec)n(k)e
(that)i(m)n(ultib)r(o)r(ot)g(memory)f(information)g(is)h(a)n(v)-5
b(ailable.)515 4462 y Fk(h)p Fj(Ensur)l(e)28 b(multib)l(o)l(ot)h
(information)e(is)g(available.)h Fk(i)p Fq(\021)598 4553
y Fi(if)39 b(\(boot_info->flags)44 b(&)39 b(MULTIBOOT_MEMORY)k(==0\))
676 4645 y(panic\("Unable)f(to)e(determine)h(installed)h(memory."\);)
515 4819 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(memory)f(b)l
(ank)h(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)o
Fq(\021)598 4910 y Fi(#include)41 b(<flux/debug.h>)356
b(//)40 b(for)g(panic)g(et)g(al.)1885 5255 y Fz(274)p
eop
PStoPSsaved restore
%%Page: (276,277) 139
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
275 276 bop 639 523 a Fz(As)28 b(w)n(e)f(can)g(see,)h(it)g(dep)r(ends)g
(on)f(the)h(m)n(ultib)r(o)r(ot)g(mo)r(dule)g(information.)639
623 y(After)38 b(that)f(w)n(e)g(set)g(prede\014ned)g(settings)f(dep)r
(ending)i(on)f(the)g(memory)f(bank)h(re-)515 722 y(quested.)g(Finally)
27 b(suc)n(h)g(settings)h(are)e(adjusted)i(according)e(to)h(the)h
(installed)g(memory)-7 b(.)515 855 y Fk(h)p Fi(off)p
667 855 24 4 v 29 w(mdepMBank::off)p 1242 855 V 31 w(mdepMBank)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 946 y Fi
(off_mdepMBank::off_mdepMBank\(n)q(atura)q(l_t)46 b(i\))598
1038 y({)676 1129 y(extern)41 b(struct)f(multiboot_info)j(*boot_info;)
676 1312 y Fk(h)p Fj(Ensur)l(e)29 b(multib)l(o)l(ot)f(information)g(is)
f(available.)g Fk(i)676 1403 y(h)p Fj(Set)h(pr)l(e)l(de\014ne)l(d)i
(values)f(for)e Fi(i)p Fj(th)h(b)l(ank.)g Fk(i)676 1494
y(h)p Fj(A)l(djust)g(memory)g(limits)f(ac)l(c)l(or)l(ding)i(to)f
(instal)t(le)l(d)g(memory.)g Fk(i)598 1586 y Fi(})1885
5255 y Fz(275)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
276 277 bop 639 523 a Fz(On)34 b(in)n(tels,)h(w)n(e)e(de\014ne)h(three)
g(memory)e(banks:)49 b(the)34 b(IO)f(map)h(and)f(DMA)i(capable)515
623 y(\014rst)27 b(Mb)n(yte,)h(the)h(DMA)f(capable)f(region)g(up)h(to)g
(the)g(\014rst)g(16)f(Mb)n(ytes,)g(and)h(remaining)515
722 y(core)22 b(memory)-7 b(.)35 b(F)-7 b(or)23 b(eac)n(h)g(memory)f
(bank)i(w)n(e)f(de\014ne)h(its)f(\014rst)h(v)-5 b(alid)23
b(address)f(\()p Fx(m)p 3079 722 27 4 v 32 w(first)p
Fz(\),)515 822 y(its)27 b(last)f(v)-5 b(alid)27 b(address)e(\()p
Fx(m)p 1362 822 V 31 w(last)p Fz(\),)h(the)h(capabilities)f(for)g(the)h
(memory)f(b)r(eing)h(con)n(tained)515 922 y(\()p Fx(m)p
596 922 V 31 w(flags)c Fz(with)i(bits)g Fx(MF)p 1303
922 V 30 w(DMA)f Fz(if)h(DMA)h(is)e(sup)r(orted,)h Fx(MF)p
2322 922 V 31 w(IOM)e Fz(if)j(IO-map)d(is)i(supp)r(orted\),)515
1021 y(the)31 b(preferred)e(page)h(sizes)g(\()p Fx(m)p
1488 1021 V 31 w(pgsz)p Fz(\),)g(and)g(the)h(mean)f(access)g(time)h(\()
p Fx(m)p 2831 1021 V 31 w(mat)p Fz(\).)45 b(Besides,)515
1121 y(w)n(e)27 b(set)h(in)f Fx(m)p 912 1121 V 31 w(base)f
Fz(and)i Fx(m)p 1351 1121 V 31 w(end)e Fz(the)i(\014rst)g(and)f(last)g
(v)-5 b(alid)28 b(ph)n(ysical)f(addresses.)639 1220 y(Note)j(ho)n(w)f
(w)n(e)g(forbid)g(4)g(Mb)n(yte)h(sup)r(er-pages)e(on)h(the)h(\014rst)f
(16)g(Mb)n(ytes.)43 b(They)29 b(are)515 1320 y(to)r(o)c(precious)f(to)i
(allo)n(w)e(in)n(ternal)h(fragmen)n(tation)f(\(i.e.)36
b(a)25 b(single)g(application)g(allo)r(cating)515 1420
y(a)i(sup)r(er-page)f(and)h(using)h(simply)f(a)h(few)f(pages\).)515
1553 y Fk(h)p Fj(Set)h(pr)l(e)l(de\014ne)l(d)i(values)e(for)g
Fi(i)p Fj(th)g(b)l(ank.)g Fk(i)p Fq(\021)598 1644 y Fi
(m_base=0x00000000;)598 1735 y(m_end)40 b(=0xfeffffff;)598
1826 y(switch\(i\){)598 1918 y(case)g(0:)676 2009 y
(m_first=0x00000000;)676 2100 y(m_last=)h(1*MBYTE;)676
2192 y(m_flags=)g(OFF_MF_DMA|OFF_MF_IOM;)676 2283 y(m_pgsz[0]=)h
(PAGE_SIZE;)676 2374 y(m_pgsz[1]=)g(m_pgsz[2]=m_pgsz[3]=0;)676
2466 y(m_mat=128;)676 2557 y(break;)598 2648 y(case)e(1:)676
2740 y(m_first=1*MBYTE;)676 2831 y(m_last=)h(16*MBYTE;)676
2922 y(m_flags=)g(OFF_MF_DMA;)676 3014 y(m_pgsz[0]=)h(PAGE_SIZE;)676
3105 y(m_pgsz[1]=)g(m_pgsz[2]=m_pgsz[3]=0;)676 3196 y(m_mat=128;)676
3288 y(break;)598 3379 y(case)e(2:)676 3470 y(m_first=16*MBYTE;)676
3562 y(m_last=)h(20*MBYTE;)676 3653 y(m_flags=)g(0;)676
3744 y(m_pgsz[0]=)h(PAGE_SIZE;)676 3836 y(m_pgsz[1]=)g(4*MBYTE;)676
3927 y(m_pgsz[2]=m_pgsz[3]=0;)676 4018 y(m_mat=128;)676
4110 y(break;)598 4201 y(default:)676 4292 y(m_first=m_last=0;)598
4384 y(})515 4649 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(memory)f(b)l(ank)h(implementation)f(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 4741 y Fi(#include)41 b(<flux/page.h>)395
b(//)40 b(for)g(PAGE_SIZE)1885 5255 y Fz(276)p eop
PStoPSsaved restore
%%Page: (278,279) 140
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
277 278 bop 639 523 a Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ne)h
(the)g(\015ags)f(used)g(b)r(efore.)515 639 y Fk(h)p Fj(O\013)g(machine)
h(dep)l(endent)h(memory)f(b)l(ank)h(\015ag)f(bits.)f
Fk(i)p Fq(\021)598 731 y Fi(//)39 b(flag)i(bits)f(for)g
(off_mdepMBanks.)598 822 y(//)f(They)i(are)e(compatible)j(with)e
(resource)h(flag)f(bits.)598 913 y(const)g(unsigned8_t)i(OFF_MF_DMA)159
b(=)39 b(0x10;)i(//)f(Supports)h(DMA?)598 1005 y(const)f(unsigned8_t)i
(OFF_MF_IOM)159 b(=)39 b(0x20;)i(//)f(Supports)h(IO)e(mapping?)598
1096 y(const)h(unsigned8_t)i(OFF_MF_PER)159 b(=)39 b(0x40;)i(//)f
(Persists?)639 1411 y Fz(Finally)h(w)n(e)g(ensure)f(that)i
Fx(m)p 1586 1411 27 4 v 30 w(first)d Fz(and)i Fx(m)p
2094 1411 V 31 w(last)f Fz(lie)h(in)g(the)h(range)d(of)i(installed)515
1511 y(memory)27 b(can)g(compute)g(the)h(n)n(um)n(b)r(er)g(of)f(page)g
(frames)g(installed.)515 1627 y Fk(h)p Fj(A)l(djust)h(memory)g(limits)f
(ac)l(c)l(or)l(ding)i(to)f(instal)t(le)l(d)g(memory.)f
Fk(i)p Fq(\021)598 1719 y Fi(if)39 b(\(boot_info->mem_upper)44
b(<)c(m_first\))676 1810 y(m_first=m_last=0;)598 1901
y(else)g(if)g(\(boot_info->mem_upper)k(<)39 b(m_last\))676
1993 y(m_last=boot_info->mem_upper;)598 2084 y(if)g
(\(boot_info->mem_upper)44 b(<)c(m_end\))676 2175 y
(m_end=boot_info->mem_upper;)598 2358 y(m_npgs=)h(a2p\(m_last\))g(-)f
(a2p\(m_first\);)i(//)e(#)f(of)h(pages)g(of)g(the)g(min.)g(page)g
(size.)639 2482 y Fz(The)26 b(routine)f Fx(a2p)g Fz(con)n(v)n(erts)f
(an)h(address)f(\(or)h(o\013set\))h(in)n(to)g(a)f(PFN)g(\(or)g(PFN)h
(range\).)639 2582 y(A)n(t)35 b(an)n(y)f(time,)j(the)e(static)g(metho)r
(d)g Fx(get)p 1981 2582 V 30 w(core)p 2187 2582 V 30
w(npgs)e Fz(\(used)i(b)r(efore)f(in)h Fx(set)p 3147 2582
V 30 w(core)p Fz(\))515 2682 y(can)30 b(b)r(e)g(used)g(to)g(determine)h
(the)f(size)g(of)g(the)h(installed)f(ph)n(ysical)f(memory)-7
b(,)30 b(no)g(matter)515 2781 y(ho)n(w)d(man)n(y)g(memory)f(banks)h
(there)h(are.)515 2914 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2914 24 4 v 29 w(mdepMBank)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 3005 y Fi(//)39 b(Returns)i(number)g(of)f(physical)h
(page)f(frames)g(installed.)598 3097 y(//)598 3188 y(static)g
(vm_size_t)120 b(get_core_npgs\(void\);)639 3329 y Fz(Its)28
b(implemen)n(tation)g(simply)f(returns)g(the)h(information)f(found)h
(in)g Fx(boot)p 3011 3329 27 4 v 30 w(info)p Fz(.)515
3445 y Fk(h)p Fi(off)p 667 3445 24 4 v 29 w(mdepMBank::get)p
1242 3445 V 31 w(core)p 1429 3445 V 29 w(npgs)g Fj(implementation.)g
Fk(i)p Fq(\021)598 3537 y Fi(//)39 b(Returns)i(number)g(of)f(physical)h
(page)f(frames)g(installed.)598 3628 y(//)598 3719 y(vm_size_t)119
b(off_mdepMBank::get_core_npg)q(s\(vo)q(id\))598 3811
y({)676 3902 y(extern)41 b(struct)f(multiboot_info)j(*boot_info;)676
4085 y(return)e(a2p\(phys_mem_max\);)598 4176 y(})515
4334 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(memory)f(b)l(ank)h
(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 4425 y
Fi(#include)41 b(<flux/x86/pc/phys_lmm.h>)j(//)c(for)g(phys_mem_max)
1885 5255 y Fz(277)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
278 279 bop 515 523 a FA(Con)m(v)m(ersion)31 b(routines)515
676 y Fz(Mac)n(hine)d(dep)r(enden)n(t)i(memory)e(banks)g(pro)n(vide)g
(these)h(routines)f(to)h(con)n(v)n(ert)f(addresses)515
776 y(to)i(page)f(frame)h(n)n(um)n(b)r(ers)g(and)g(vice-v)n(ersa.)42
b(They)30 b(use)g(the)h(minim)n(um)g(preferred)e(page)515
876 y(size.)36 b(A)28 b(function)g(returning)f(a)g(mask)g(to)h(extract)
f(page)f(o\013sets)i(is)f(pro)n(vided)g(to)r(o.)515 1008
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1008 24 4 v 29 w(mdepMBank)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 1100 y Fi(//)39 b(Address)i(to)f(PFN.)598
1191 y(static)g(vm_offset_t)i(a2p\(vm_offset_t)h(va\){)d(return)g
(atop\(va\);)i(})598 1282 y(//)d(PFN)h(to)g(address.)598
1374 y(static)g(vm_offset_t)i(p2a\(vm_offset_t)h(va\){)d(return)g
(ptoa\(va\);)i(})598 1465 y(//)d(Returns)i(the)f(mask)g(for)g(page)g
(offsets.)598 1556 y(static)g(vm_offset_t)i(pmask\(void\))g({)d(return)
i(PAGE_MASK;)g(})598 1648 y(//)e(Returns)i(the)f(minimum)h(preferred)g
(page)f(size.)598 1739 y(static)g(vm_size_t)i(get_pgsz\(void\))g({)d
(return)i(PAGE_SIZE;})639 1971 y Fz(They)28 b(rely)f(on)g(OSKit)g
(routines)g Fx(atop)f Fz(and)i Fx(ptoa)p Fz(.)515 2088
y Fk(h)p Fj(O\013)f(machine)h(dep)l(endent)h(memory)f(b)l(ank)h(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 2179 y Fi(#include)41
b(<flux/page.h>)395 b(//)40 b(for)g(atop)g(and)g(ptoa)515
2420 y FA(Mac)m(hine)32 b(dep)s(enden)m(t)f(mo)s(de)f(bits)515
2573 y Fz(Ev)n(ery)21 b(page)i(frame)g(has)g(a)g(set)g(of)h(bits)f
(represen)n(ting)f(v)-5 b(alid)24 b(access)e(mo)r(des)h(supp)r(orted)g
(b)n(y)515 2673 y(the)32 b(hardw)n(are.)49 b(Actually)-7
b(,)33 b(those)f(bits)g(are)f(b)r(orro)n(w)n(ed)f(from)i(the)h(mac)n
(hine)e(dep)r(enden)n(t)515 2772 y(address)26 b(translation)g(mac)n
(hinery)-7 b(.)515 2905 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(mo)l(de)f(bits.)g Fk(i)p Fq(\021)598 2996 y Fi(//)39
b(Mode)i(bits)f(for)g(page)g(frames)598 3088 y(typedef)h
(off_mdep_mod_t)h(off_mdep_pgf_t;)515 3262 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(p)l(age)g(fr)l(ame)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3353 y Fi(#include)41 b(<dmm/mdep/mAddrTr.h>)122
b(//)40 b(for)g(off_mdep_mod_t)598 3445 y(//typedef)h(int)f
(off_mdep_mod_t;)515 3702 y FA(Kernel)31 b(pages,)g(reserv)m(ed)h
(pages,)f(and)h Fx(malloc)e FA(pages)515 3855 y Fz(W)-7
b(e)24 b(m)n(ust)f(pro)n(vide)g(t)n(w)n(o)g(metho)r(ds)g(to)h(detect)g
(memory)f(allo)r(cation)f(status)h(at)h(b)r(o)r(ot)g(time.)515
3955 y(The)j(\014rst)h(one)f(detects)h(a)n(v)-5 b(ailable)26
b(memory)-7 b(.)515 4088 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 4088 V 29 w(mdepMBank)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 4179 y Fi(//)39 b(Finds)i(the)f(next)g(contiguous)h
(set)f(of)g(free)g(pages)g(at)g(or)g(after)g(va.)598
4270 y(//)f(If)h(no)g(such)g(block)g(is)g(found)g(in)g(this)g
(container)598 4362 y(//)f(va)h(is)g(set)g(to)f(the)h(last)g(valid)h
(address)g(and)f(size)g(to)f(zero.)598 4453 y(void)h
(find_free\(vm_offset_t)k(&va,)c(vm_size_t)h(&size\))g(const;)1885
5255 y Fz(278)p eop
PStoPSsaved restore
%%Page: (280,281) 141
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
279 280 bop 639 523 a Fz(W)-7 b(e)34 b(searc)n(h)d(the)j
Fx(malloc)p 1463 523 27 4 v 28 w(lmm)e Fz(\(already)g(initialized)h(b)n
(y)g(the)g(OSKit)g(to)g(re\015ect)g(the)515 623 y(state)27
b(of)h(core)e(memory\))h(for)g(an)n(y)g(free)h(pages.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(mdepMBank::find)p
1281 756 V 31 w(free)h Fj(implementation.)e Fk(i)p Fq(\021)598
847 y Fi(//)39 b(Finds)i(the)f(next)g(contiguous)h(set)f(of)g(free)g
(pages)g(at)g(or)g(after)g(va.)598 938 y(//)f(If)h(no)g(such)g(block)g
(is)g(found)g(in)g(this)g(container)598 1029 y(//)f(va)h(is)g(set)g(to)
f(the)h(last)g(valid)h(address)g(and)f(size)g(to)f(zero.)598
1121 y(void)h(off_mdepMBank::find_free\(vm_of)q(fset)q(_t)45
b(&va,)40 b(vm_size_t)i(&size\))e(const)598 1212 y({)676
1303 y(lmm_flags_t)i(flags;)472 b(//)40 b(flags)g(for)g(free)g(area)676
1486 y(do)g({)755 1577 y(lmm_find_free\(&malloc_lmm,&va,&)q(size)q
(,&fl)q(ags\);)46 b(//)40 b(size==0)g(when)h(not)e(found)755
1669 y(if)g(\(size\))833 1760 y(if)h(\(size)g(>)g(PAGE_SIZE)h(\){)951
1851 y Fk(h)p Fj(R)l(emove)28 b(any)g(p)l(artial)g(fr)l(e)l(e)g(p)l
(age)h(fr)l(om)e(chunk)h(at)h Fi(va)e Fj(size)l(d)i Fi(size)p
Fj(.)f Fk(i)833 1943 y Fi(})833 2034 y(else)755 2125
y(va)39 b(+=)h(size;)676 2217 y(})g(while)g(\(size)g(&&)g(size)g(<)g
(PAGE_SIZE)h(&&)f(va)f(<)h(m_last\);)676 2399 y(if)g(\(!size)g(||)g(va)
g(>=)g(m_last\){)755 2491 y(va=m_last;)755 2582 y(size=0;)676
2673 y(})676 2765 y(else)g({)755 2856 y Fk(h)p Fj(R)l(emove)28
b(fr)l(e)l(e)g(sp)l(ac)l(e)h(at)f Fi(va)g Fj(size)l(d)g
Fi(size)g Fj(fr)l(om)g(the)g Fi(malloc)p 2532 2856 V
30 w(lmm)p Fj(.)f Fk(i)676 2947 y Fi(})598 3130 y(})515
3396 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(memory)f(b)l(ank)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
3487 y Fi(#include)41 b(<flux/lmm.h>)434 b(//)40 b(for)g(lmm_find_free)
i(et)d(al.)598 3578 y(#include)i(<malloc.h>)512 b(//)40
b(for)g(malloc_lmm)639 3719 y Fz(The)27 b(tric)n(ky)g(part)f(is)h(to)h
(remo)n(v)n(e)d(an)n(y)h(partial)h(free)g(page)f(at)h(the)g(start)g(or)
f(end)i(of)f(the)515 3819 y(free)f(memory)g(detected)h(b)n(y)g
Fx(lmm)p 1576 3819 27 4 v 30 w(find)p 1782 3819 V 30
w(free)p Fz(.)35 b(First)26 b(w)n(e)h(tak)n(e)f(the)h(page)f(o\013set)g
(from)h Fx(va)515 3919 y Fz(and)g(subtract)g(remaining)g(b)n(ytes)g
(\(past)h(that)g(o\013set\))g(from)f(the)h Fx(size)p
Fz(.)36 b(Then)27 b(w)n(e)h(round)515 4018 y Fx(va)k
Fz(to)h(the)h(next)g(page)e(b)r(oundary)h(if)g(the)h(o\013set)f(w)n(as)
g(non-n)n(ull.)53 b(Finally)33 b(w)n(e)g(truncate)515
4118 y(size)27 b(to)g(a)h(m)n(ultiple)g(of)f(the)h(page)f(size)g(to)h
(ignore)e(an)n(y)h(trailing)g(partial)g(free)g(page.)515
4251 y Fk(h)p Fj(R)l(emove)h(any)g(p)l(artial)g(fr)l(e)l(e)g(p)l(age)h
(fr)l(om)e(chunk)h(at)g Fi(va)g Fj(size)l(d)h Fi(size)p
Fj(.)f Fk(i)o Fq(\021)598 4342 y Fi(if)39 b(\(!page_aligned\(va\)\){)
676 4433 y(size)h(-=)g(\(PAGE_SIZE-\(va&PAGE_MASK\)\);)676
4525 y(va=trunc_page\(va\)+ptoa\(\(va&P)q(AGE_M)q(ASK\))q(?1:0)q(\);)
598 4616 y(})598 4707 y(size=trunc_page\(size\);)1885
5255 y Fz(279)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
280 281 bop 639 523 a Fz(Besides,)30 b(w)n(e)g(will)g(allo)r(cate)g(an)
n(y)f(free)h(page)f(frame)g(in)i(the)f(OSKit)g Fx(malloc)p
3081 523 27 4 v 29 w(lmm)p Fz(.)43 b(In)515 623 y(that)24
b(w)n(a)n(y)e(the)i(OSKit)f(implemen)n(tation)h(of)f
Fx(malloc)e Fz(will)j(not)g(ha)n(v)n(e)e(free)i(memory)-7
b(.)34 b(Th)n(us)515 722 y(it)28 b(will)g(not)f(mess)g(up)h(page)f
(allo)r(cation.)515 855 y Fk(h)p Fj(R)l(emove)h(fr)l(e)l(e)g(sp)l(ac)l
(e)h(at)f Fi(va)g Fj(size)l(d)g Fi(size)g Fj(fr)l(om)g(the)g
Fi(malloc)p 2292 855 24 4 v 30 w(lmm)p Fj(.)f Fk(i)p
Fq(\021)598 946 y Fi(lmm_remove_free\(&malloc_lmm,)45
b(\(void*\)va,)d(size\);)515 1204 y FA(Mac)m(hine)32
b(dep)s(enden)m(t)f(memory)e(banks)k Fg(C)7 b Fx(++)31
b FA(source)g(\014les)515 1357 y Fz(W)-7 b(e)28 b(main)n(tain)f(it)h
(all)f(in)h Fx(hw/mdep/mMBank.h)21 b Fz(and)28 b Fx(hw/mdep/mMBank.)o
(C)p Fz(.)515 1490 y Fk(h)p Fj(mdep)f(mMBank.h*)11 b
Fk(i)p Fq(\021)598 1581 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 1672 y
Fi(#ifndef)41 b(__OFF_MDEP_MBANK_H)598 1764 y(#define)g
(__OFF_MDEP_MBANK_H)i(1)598 1946 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(memory)f(b)l(ank)h(dep)l(endencies.)g
Fk(i)598 2129 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h(memory)f(b)l
(ank)h(\015ag)f(bits.)f Fk(i)598 2312 y(h)p Fj(O\013)g(machine)h(dep)l
(endent)h(memory)f(b)l(ank.)g Fk(i)598 2586 y Fi(#endif)40
b(//)g(__OFF_MDEP_MBANK_H)515 2760 y Fk(h)p Fj(mdep)27
b(mMBank.C*)11 b Fk(i)p Fq(\021)598 2851 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 3034 y Fi(#include)41 b(<hw/mdep/mMBank.h>)239
b(//)40 b(Exported)h(interface.)598 3125 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(memory)f(b)l(ank)h(implementation)f(dep)l
(endencies.)h Fk(i)598 3308 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(memory)f(b)l(ank)h(static)g(memb)l(ers.)f Fk(i)598 3491
y(h)p Fi(off)p 750 3491 V 29 w(mdepMBank::off)p 1325
3491 V 31 w(mdepMBank)h Fj(implementation.)f Fk(i)598
3582 y(h)p Fi(off)p 750 3582 V 29 w(mdepMBank::how)p
1325 3582 V 31 w(many)g Fj(implementation.)g Fk(i)598
3673 y(h)p Fi(off)p 750 3673 V 29 w(mdepMBank::find)p
1364 3673 V 31 w(free)h Fj(implementation.)e Fk(i)598
3765 y(h)p Fi(off)p 750 3765 V 29 w(mdepMBank::get)p
1325 3765 V 31 w(core)p 1512 3765 V 29 w(npgs)h Fj(implementation.)g
Fk(i)639 3906 y Fz(Mac)n(hine)f(dep)r(enden)n(t)i(page)d(frame)i(data)f
(t)n(yp)r(es)g(are)g(k)n(ept)g(in)h Fx(mdep/mPFrame.h)p
Fz(.)515 4039 y Fk(h)p Fj(mdep)f(mPF)-6 b(r)l(ame.h*)11
b Fk(i)q Fq(\021)598 4130 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4221 y Fi(#ifndef)41 b(__OFF_MDEP_PFRAME_H)598 4313 y(#define)g
(__OFF_MDEP_PFRAME_H)i(1)598 4495 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(p)l(age)g(fr)l(ame)f(dep)l(endencies.)h
Fk(i)598 4587 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h(mo)l(de)f
(bits.)g Fk(i)598 4769 y Fi(#endif)40 b(//)g(!__OFF_MDEP_PFRAME_H)1885
5255 y Fz(280)p eop
PStoPSsaved restore
%%Page: (282,283) 142
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
281 282 bop 515 530 a Fr(4.2)135 b(Input/Output)515 728
y Fn(4.2.1)112 b(IO)37 b(banks)515 881 y Fz(IO)e(bank)h(ob)5
b(jects)35 b(are)g(merely)g(used)h(to)f(allo)r(cate)g(p)r(orts,)j(as)d
(I/O)g(should)h(b)r(e)g(able)f(to)515 981 y(op)r(erate)26
b(\(when)i(p)r(ermitted\))g(from)f(user)g(lev)n(el.)36
b(Eac)n(h)26 b(I/O)h(bank)g(con)n(tains)f(a)h(p)r(ort)g(allo-)515
1081 y(cator.)515 1213 y Fk(h)p Fj(O\013)g(IO)g(b)l(ank.)h
Fk(i)p Fq(\021)598 1305 y Fi(//An)40 b(IO)g(bank)598
1396 y(//)598 1487 y(class)g(off_IOBank)i(:)d(public)i
(off_HWCompResource)i({)598 1579 y(private:)676 1670
y(off_IOAllocator)g(io_alloc;)198 b(//)40 b(Port)g(allocator)676
1761 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 1761 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)598
1944 y Fi(protected:)676 2035 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 2035 V 29 w(IOBank)p
Fj(.)i Fk(i)598 2127 y Fi(public:)676 2309 y(//)40 b(Returns)h(a)e
(pointer)i(to)f(the)g(port)g(allocator.)676 2401 y(virtual)h
(off_IOAllocator)i(*get_allocator\(void\))g({return)e(&io_alloc;})676
2583 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2583 V 29 w(IOBank)p Fj(.)i Fk(i)598 2766
y Fi(};)639 2907 y Fz(Being)e(a)h(sub)r(class)e(of)i
Fx(CompResource)p Fz(,)23 b(w)n(e)k(m)n(ust)h(implemen)n(t)g
Fx(make)p 2850 2907 27 4 v 30 w(available)p Fz(.)515
3023 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3023 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p Fq(\021)598
3115 y Fk(h)p Fj(Implementation)g(of)f Fi(off)p 1391
3115 V 29 w(CompResource::make)p 2122 3115 V 32 w(available)p
Fj(.)i Fk(i)639 3239 y Fz(Suc)n(h)f(implemen)n(tation)g(uses)f
Fx(is)p 1702 3239 27 4 v 30 w(local)515 3355 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3355
24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3447 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i(one?)598
3538 y(boolean_t)g(is_local\(const)h(off_io_id_t)g(&io\))e({)676
3629 y(return)h(\()e(io)h(<=)g(io_alloc.get_length\(\))k(&&)1029
3721 y(\(io_alloc+io\)->l_io.get_id\(\))i(==)40 b(io)f(\);)598
3812 y(})639 3937 y Fz(Initially)28 b(IO)f(banks)g(are)g(created)g
(with)h(default)g(v)-5 b(alues)27 b(for)g(its)h(mem)n(b)r(ers.)515
4053 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4053 V 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4144 y Fi(//)39 b(Creates)i(an)f(IO)g(bank.)598 4235
y(off_IOBank\(void\))j(:)676 4327 y(off_HWCompResource\(off_Prote)q
(ction)q(\(\),O)q(FF_P)q(RTL_N)q(ULL,)j(OFF_ID_NULL,)1422
4418 y(OFF_MAGIC_IOBANK\),)676 4509 y Fk(h)p Fj(Initialize)27
b Fi(io)p 1111 4509 V 28 w(alloc)p Fj(.)i Fk(i)o Fi(,)676
4601 y Fk(h)p Fj(Initialize)e(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 4601 V 29 w(IOBank)p Fj(.)g Fk(i)598
4692 y Fi({;})1885 5255 y Fz(281)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
282 283 bop 515 523 a Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(dep)l
(endencies.)h Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
706 y(#include)h(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)g
(numbers.)598 797 y(#include)h(<klib/Magic.h>)356 b(//)40
b(for)g(magic)g(numbers)598 888 y(#include)h(<klib/HWCompResource.h>)j
(//)c(for)g(off_HWCompResource)598 980 y(#include)h(<hw/IOAllocator.h>)
200 b(//)40 b(for)g(off_IOAllocator)i(et)e(al.)598 1071
y(#include)h(<hw/IOPort.h>)395 b(//)40 b(for)g(off_IOPort)h(et)f(al.)
639 1212 y Fz(W)-7 b(e)28 b(m)n(ust)g(de\014ne)g(the)g(new)f(magic)g(n)
n(um)n(b)r(er)h(used)f(b)r(efore.)515 1328 y Fk(h)p Fj(O\013)g(magic)g
(numb)l(ers.)i Fk(i)p Fq(\021)598 1420 y Fi(OFF_MAGIC_IOBANK,)43
b(//)d(IO)f(bank)h(magic)h(nb.)639 1544 y Fz(W)-7 b(e)28
b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)g(implemen)n(tation)f
(of)h Fx(Magic::nameof)p Fz(.)515 1660 y Fk(h)p Fi(off)p
667 1660 24 4 v 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e
Fi(m)p 1559 1660 V 29 w(number)p Fj(s.)h Fk(i)p Fq(\021)598
1752 y Fi(case)40 b(OFF_MAGIC_IOBANK:)676 1843 y(return)h
("off_IOBank";)639 1968 y Fz(IO)27 b(bank)h(users)e(can)i(c)n(hec)n(k)e
(their)i(references)e(to)i(IO)f(banks)g(using)g(this)h(metho)r(d.)515
2084 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2084 V 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2175 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(IOBank?)598
2267 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_IOBANK;)j(})639 2391 y Fz(The)28 b(new)g(con)n(tainer)e
(can)h(also)g(implemen)n(t)h(its)g Fx(get)p 2323 2391
27 4 v 30 w(umagic)d Fz(metho)r(d.)515 2524 y Fk(h)p
Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 2524 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p Fq(\021)598
2615 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i({)d(return)g
(OFF_MAGIC_IOPORT;)j(})639 2848 y Fz(After)28 b(instan)n(tiation,)f
Fx(start)f Fz(should)h(b)r(e)h(used)g(to)f(start)g(IO)h(bank)f(op)r
(eration.)515 2964 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2964 V 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3055 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)
g(IO)g(bank.)598 3147 y(err_t)g(start\()h(const)f(off_mdepIOBank)i
(&mdep,)f(const)f(off_id_t)h(&id)f(\);)515 3304 y Fk(h)p
Fj(O\013)27 b(IO)g(b)l(ank)h(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 3396 y Fi(#include)41 b(<hw/mdep/mIOBank.h>)239
b(//)40 b(for)g(off_mdepIOBank)1885 5255 y Fz(282)p eop
PStoPSsaved restore
%%Page: (284,285) 143
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
283 284 bop 639 523 a Fz(Suc)n(h)30 b(metho)r(d)g(receiv)n(es)e(the)j
(b)r(o)r(ot-time)f(information)f(ab)r(out)g(the)h(features)f(for)h(the)
515 623 y(IO)g(bank)g(b)r(eing)h(started)f(and)h(sets)f(it)h(up)g
(accordingly)-7 b(.)45 b(It)31 b(will)g(also)e(set)i(the)g(IO)f(bank)
515 722 y(iden)n(ti\014er)d(as)g(dictated)h(b)n(y)f(the)h(caller)1741
692 y Fp(4)1777 722 y Fz(.)639 822 y(The)23 b(information)e(con)n
(tained)h(in)g Fx(mdep)f Fz(is)h(the)g(\014rst)g(v)-5
b(alid)23 b(IO)e(address,)i(the)f(last)g(v)-5 b(alid)515
922 y(IO)29 b(address,)h(the)g(capabilities)f(for)h(the)g(IO)g(p)r
(orts)f(con)n(tained)h(\(with)g(bits)h Fx(MF)p 3020 922
27 4 v 30 w(IOM)e Fz(if)h(IO)515 1021 y(mapping)25 b(is)h(sup)r(orted,)
g Fx(MF)p 1395 1021 V 30 w(USR)f Fz(if)h(users)f(can)h(do)f(I/O)g(righ)
n(t)g(from)h(user\))f(and)h(the)g(mean)515 1121 y(IO)h(time.)37
b(As)27 b(of)g(to)r(da)n(y)-7 b(,)27 b(w)n(e)g(assume)f(that)i(IO)e
(banks)h(alw)n(a)n(ys)e(start)i(with)g(p)r(ort)g(n)n(um)n(b)r(er)515
1220 y Fx(0)22 b Fz(and)h(ha)n(v)n(e)f(a)g(pre-sp)r(eci\014ed)h(n)n(um)
n(b)r(er)f(of)h(IO)f(p)r(orts)h(kno)n(wn)f(b)n(y)h(the)g(mac)n(hine)f
(dep)r(enden)n(t)515 1320 y(part.)515 1453 y Fk(h)p Fi(off)p
667 1453 24 4 v 29 w(IOBank::start)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 1544 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)
f(this)g(IO)g(bank.)598 1636 y(err_t)g(off_IOBank::start\()j(const)e
(off_mdepIOBank)h(&mdep,)f(const)f(off_id_t)h(&id)f(\))598
1727 y({)676 1818 y(assert\(valid\(\)\);)676 1910 y(set_id\(id\);)676
2001 y(r_flags)h(|=)f(mdep.get_flags\(\);)676 2092 y
Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)g(of)e Fi(off)p
1629 2092 V 29 w(IOBank)i Fj(ac)l(c)l(or)l(ding)g(to)f
Fi(mdep)p Fj(.)g Fk(i)676 2275 y Fi(kcout<<)41 b("IObank)g(#")f(<<)f
(id)h(<<)g(fmt\(")g(\(\045d)g(8-bit)g(ports\))h(",)e
(OFF_MDEP_NAIOP_MAX)44 b(\);)676 2366 y(kcout)d(<<)e("started.")j(<<)d
(nl;)676 2457 y(return)i(EOK;)598 2549 y(})515 2814 y
Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2906 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)639 3047 y Fz(The)27 b(\015ag)f(bits)h(are)f
(de\014ned)h(so)g(that)g(they)g(are)f(compatible)g(with)i(resource)d
(\015ag)h(bits)515 3147 y(and)h(can)g(b)r(e)h(c)n(hec)n(k)n(ed)f(with)h
(these)g(metho)r(ds)515 3263 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3263 V 29 w(IOBank)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 3354 y Fi(//)39 b(Supports)i(IO)f(port)g(maps.)598
3445 y(boolean_t)h(is_iomapable\(void\))i(const)e({)676
3537 y(assert\(valid\(\)\);)i(return)e(r_flags&OFF_IF_IOM;)598
3628 y(})598 3719 y(//)e(Supports)i(user)g(IO?)598 3811
y(boolean_t)g(is_usrio\(void\))160 b(const)40 b({)676
3902 y(assert\(valid\(\)\);)j(return)e(r_flags&OFF_IF_USR;)598
3993 y(})639 4118 y Fz(A)h(new)g(mem)n(b)r(er,)k Fx(io)p
1381 4118 27 4 v 30 w(mdep)41 b Fz(will)h(store)f(the)h(b)r(o)r(ot)g
(time)g(information,)j(whic)n(h)d(is)515 4218 y(needed)27
b(b)r(ecause)h(it)g(pro)n(vides)e(common)h(information)g(useful)h(to)f
(IO)h(bank)f(users.)515 4334 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 4334 24 4 v 29 w(IOBank)p Fj(.)g
Fk(i)p Fq(\021)598 4425 y Fi(off_mdepIOBank)42 b(io_mdep;)355
b(//)40 b(Mach.)g(dep.)g(information)515 4583 y Fk(h)p
Fj(Start)29 b(other)g(memb)l(ers)f(of)f Fi(off)p 1467
4583 V 29 w(IOBank)i Fj(ac)l(c)l(or)l(ding)g(to)f Fi(mdep)p
Fj(.)g Fk(i)p Fq(\021)598 4674 y Fi(io_mdep=mdep;)p 515
4744 1146 4 v 607 4798 a Fm(4)642 4821 y Fl(Remem)n(b)r(er)f(that)j
(when)g(the)g(IO)f(bank)h(wrapp)r(er)f(used)g(to)h(exp)r(ort)g(IO)f
(services)g(b)r(e)h(created,)h(the)515 4900 y(p)r(ortal)24
b(used)g(m)n(ust)f(matc)n(h)g(the)i(iden)n(ti\014er)f(k)n(ept)h(in)e
(the)h(IO)g(bank.)1885 5255 y Fz(283)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
284 285 bop 639 523 a Fz(Initially)-7 b(,)28 b(b)r(efore)f(the)h(IO)g
(bank)f(is)g(started)g(it)h(is)g(initialized)g(with)g(silly)f(v)-5
b(alues.)515 639 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h
(memb)l(ers)f(of)e Fi(off)p 1928 639 24 4 v 29 w(IOBank)p
Fj(.)h Fk(i)p Fq(\021)598 731 y Fi(io_mdep\(0\),)639
855 y Fz(Most)g(of)f(the)h(mac)n(hine)f(dep)r(enden)n(t)i(information)e
(is)g(exp)r(orted)g(b)n(y)g(the)h(IO)g(bank.)515 971
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 971 V 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
1063 y Fi(//)39 b(Returns)i(the)f(first)h(valid)f(IO)g(address.)598
1154 y(vm_offset_t)h(get_first\(void\)const{)676 1245
y(assert\(valid\(\)\);)i(return)e(io_mdep.get_first\(\);)598
1337 y(})598 1428 y(//)e(Returns)i(the)f(last)g(valid)h(IO)e(address.)
598 1519 y(vm_offset_t)i(get_last\(void\)const{)676 1611
y(assert\(valid\(\)\);)i(return)e(io_mdep.get_last\(\);)598
1702 y(})598 1793 y(//)e(Returns)i(the)f(number)h(of)e(IO)h(addresses.)
598 1885 y(vm_size_t)119 b(get_nports\(void\))43 b(const{)676
1976 y(assert\(valid\(\)\);)g(return)e(io_mdep.get_nports\(\);)598
2067 y(})598 2159 y(//)e(Returns)i(the)f(mean)g(IO)g(time.)598
2250 y(//)f(\(0)h(means)g(damn)h(slow;)f(255)g(means)g(damn)g(fast\))
598 2341 y(unsigned8_t)h(get_mat\(void\))i(const)d({)676
2433 y(assert\(valid\(\)\);)j(return)e(io_mdep.get_mat\(\);)598
2524 y(})639 2740 y Fz(The)19 b Fx(get)p 938 2740 27
4 v 30 w(iosize)e Fz(metho)r(d)i(just)h(returns)e(the)i(appropriate)d
(v)-5 b(alue)19 b(found)g(in)g Fx(io)p 3156 2740 V 31
w(iosz)p Fz(.)515 2839 y(It)26 b(sa)n(ys)e(ho)n(w)g(man)n(y)h(b)n(ytes)
g(an)g(IO)h(p)r(ort)f(has.)35 b(There)25 b(ma)n(y)g(b)r(e)h(more)f
(than)g(one)g(preferred)515 2939 y(IO)i(p)r(ort)g(size.)515
3055 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3055 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3147 y Fi(//)39 b(Gets)i(the)e(preferred)j(IO)d(sizes)598
3238 y(//)g(above)i(llimit)f(bytes)h(\(or)f(0)f(if)h(none\))598
3329 y(vm_size_t)h(get_iosize\(const)i(vm_size_t)e(llimit\))g(const;)
639 3454 y Fz(W)-7 b(e)28 b(rely)f(on)h(mac)n(hine)f(dep)r(enden)n(t)h
(information)f(to)g(pro)n(vide)g(that)h(information.)515
3570 y Fk(h)p Fi(off)p 667 3570 V 29 w(IOBank::get)p
1125 3570 V 30 w(iosize)h Fj(implementation.)f Fk(i)o
Fq(\021)598 3661 y Fi(//)39 b(Gets)i(the)e(preferred)j(IO)d(port)i
(sizes)598 3753 y(//)e(above)i(llimit)f(bytes)h(\(or)f(0)f(if)h(none\))
598 3844 y(vm_size_t)h(off_IOBank::get_iosize\(const)46
b(vm_size_t)41 b(llimit\))g(const)598 3935 y({)676 4027
y(assert\(valid\(\)\);)676 4118 y(for)f(\(int)g(i=0;)g
(i<OFF_NIOSZ_MAX;)j(i++\))755 4209 y(if)c
(\(io_mdep.get_iosz\(i\)>llimit\))833 4301 y(return)i
(io_mdep.get_iosz\(i\);)676 4392 y(return)g(0;)598 4483
y(})1885 5255 y Fz(284)p eop
PStoPSsaved restore
%%Page: (286,287) 144
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
285 286 bop 639 523 a Fz(And)30 b(a)f(more)f(e\016cien)n(t)i
Fx(get)p 1549 523 27 4 v 30 w(iosize)d Fz(routine)h(is)i(pro)n(vided.)
40 b(It)30 b(alw)n(a)n(ys)d(returns)i(the)515 623 y(minim)n(um)f
(preferred)f(IO)g(size.)515 732 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 732 24 4 v 29 w(IOBank)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 823 y Fi(//)39 b(Returns)i(the)f(minimum)h
(preferred)g(page)f(size.)598 915 y(static)g(vm_size_t)i
(get_iosize\(void\))g({)e(return)h(off_mdepIOBank::get_iosz\(\);})515
1052 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(implementation)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 1143 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(for)g(OFF_NIOSZ_MAX)i(and)e(other)g
(limits.)639 1270 y Fz(The)28 b(maxim)n(um)f(n)n(um)n(b)r(er)h(of)f
(preferred)g(IO)g(sizes)g(is)h(a)f(system)g(limit.)515
1380 y Fk(h)p Fj(O\013)g(limits.)f Fk(i)p Fq(\021)598
1471 y Fi(const)40 b(int)g(OFF_NIOSZ_MAX)i(=)e(4;)157
b(//)40 b(Max.)g(number)g(of)g(IO)g(port)g(sizes.)515
1716 y Fn(4.2.2)112 b(IO)37 b(p)s(orts)515 1869 y Fz(Eac)n(h)29
b Fx(IOPort)f Fz(main)n(tains)i(the)h(information)e(needed)i(ab)r(out)f
(eac)n(h)g(IO)g(p)r(ort)g(presen)n(t)g(in)515 1969 y(the)19
b(system:)33 b(a)18 b(reference)g(to)h(the)h(con)n(tainer)e(the)h(IO)g
(p)r(ort)g(is)g(in,)i(and)e(also)f(that)h(state)g(k)n(ept)515
2068 y(b)n(y)25 b(ev)n(ery)f(system)i(hardw)n(are)d(resource)h(unit,)j
(including)e(the)h(magic)f(n)n(um)n(b)r(er,)h(reference)515
2168 y(coun)n(ter,)h(protection,)f(domain,)i(and)f(resource)f(id.)515
2287 y Fk(h)p Fj(O\013)h(IO)g(p)l(ort.)h Fk(i)p Fq(\021)598
2378 y Fi(//)39 b(An)h(IO)g(port)598 2470 y(//)598 2561
y(class)g(off_IOPort)i(:)d(public)i(off_HWResUnit)h({)598
2652 y(private:)676 2744 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h
(of)e Fi(off)p 1713 2744 V 29 w(IOPort)p Fj(.)h Fk(i)598
2835 y Fi(protected:)676 2926 y(off_IOBank)42 b(*io_bank;)433
b(//)40 b(Container)676 3017 y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)
h(metho)l(ds)f(of)e Fi(off)p 1755 3017 V 29 w(IOPort)p
Fj(.)i Fk(i)598 3109 y Fi(public:)676 3200 y(//)40 b(Returns)h(the)f
(container)h(this)f(io)g(port)g(is)g(it.)676 3291 y(off_IOBank)i
(*get_iobank\(void\))h(const)d({)g(return)g(io_bank;)h(})676
3474 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3474 V 29 w(IOPort)p Fj(.)i Fk(i)598 3565
y Fi(};)515 3712 y Fk(h)p Fj(O\013)e(IO)g(p)l(ort)h(dep)l(endencies.)i
Fk(i)p Fq(\021)598 3804 y Fi(#include)41 b(<klib/HWResUnit.h>)200
b(//)40 b(for)g(off_HWResUnit)598 3895 y(class)g(off_IOBank;)630
b(//)40 b(to)g(break)g(the)g(circular)h(dependency)639
4022 y Fz(IO)27 b(p)r(orts)h(are)e(created)h(with)h(this)g
(constructor,)515 4132 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4132 V 29 w(IOPort)p Fj(.)h Fk(i)p Fq(\021)598
4223 y Fi(off_IOPort\(const)43 b(off_Protection)f(&p,)e(const)g
(off_prtl_id_t)i(&domain\);)639 4341 y Fz(although)23
b(a)g(trivial)g(constructor)f(is)i(pro)n(vided)e(so)h(that)h
(uninitialized)g Fx(IOPort)d Fz(struc-)515 4440 y(tures)27
b(b)r(e)h(allo)n(w)n(ed.)515 4550 y Fk(h)p Fj(Other)g(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 4550 V 29 w(IOPort)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 4641 y Fi(off_IOPort\(void\))43
b(:)c(off_HWResUnit\(off_Protection\()q(\),)1892 4732
y(OFF_PRTL_NULL,)1892 4824 y(OFF_EU_ID_NULL,)1892 4915
y(OFF_MAGIC_IOPORT,)k(NULL\))598 5006 y({})1885 5255
y Fz(285)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
286 287 bop 515 523 a Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(#include)41
b(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
706 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d
(al.)598 797 y(#include)i(<klib/Magic.h>)356 b(//)40
b(for)g(magic)g(numbers.)639 938 y Fz(The)31 b(real)f(constructor)g
(only)h(receiv)n(es)e(the)i(protection)g(and)g(domain)f(to)h(b)r(e)h
(set)f(for)515 1038 y(the)g(IO)g(p)r(ort)h(b)r(eing)f(allo)r(cated.)47
b(The)32 b(magic)e(n)n(um)n(b)r(er)h(will)h(alw)n(a)n(ys)d(b)r(e)j
Fx(MAGIC)p 3093 1038 27 4 v 29 w(IOPORT)515 1137 y Fz(and)27
b(the)h(iden)n(ti\014er)g(is)f(generated)g(b)n(y)g Fx(get)p
1882 1137 V 30 w(ioid)p Fz(.)515 1270 y Fk(h)p Fi(off)p
667 1270 24 4 v 29 w(IOPort::off)p 1125 1270 V 30 w(IOPort)i
Fj(implementation.)f Fk(i)o Fq(\021)598 1362 y Fi
(off_IOPort::off_IOPort\(const)45 b(off_Protection)e(&p,)d(const)g
(off_prtl_id_t)i(&domain\))f(:)676 1453 y(off_HWResUnit\(p,domain\))598
1544 y({;})639 1685 y Fz(As)28 b(happ)r(ened)g(to)f(page)g(frames,)g
(IO)g(p)r(orts)g(are)g(pre-initialized)g(to)r(o.)639
1785 y(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(no)n(w)f(the)h(magic)
f(n)n(um)n(b)r(er)g(for)g(IO)g(p)r(orts.)515 1901 y Fk(h)p
Fj(O\013)g(magic)g(numb)l(ers.)i Fk(i)p Fz(+)o Fq(\021)598
1993 y Fi(OFF_MAGIC_IOPORT,)278 b(//)40 b(Off)g(IO)f(port)i(magic)f
(number)639 2117 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e
(case)h(to)h(the)g(implemen)n(tation)f(of)h Fx(Magic::nameof)p
Fz(.)515 2233 y Fk(h)p Fi(off)p 667 2233 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 2233 V 29 w(number)p Fj(s.)h
Fk(i)p Fz(+)p Fq(\021)598 2325 y Fi(case)40 b(OFF_MAGIC_IOPORT:)676
2416 y(return)h("off_IOPort";)639 2540 y Fz(IO)27 b(p)r(ort)h(users)f
(can)g(c)n(hec)n(k)g(their)g(references)g(using)g(this)h(metho)r(d.)515
2657 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2657 V 29 w(IOPort)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2748 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(IOPort?)598
2839 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_IOPORT;)j(})639 2964 y Fz(Although)24
b(IO)f(p)r(orts)g(can)g(ha)n(v)n(e)f(di\013eren)n(t)i(sizes,)g(w)n(e)f
(op)r(erate)f(only)h(with)h(8-bit)f(p)r(orts.)515 3064
y(When)28 b(t)n(w)n(o)e(con)n(tiguous)g(8-bits)h(p)r(orts)g(are)f(o)n
(wned,)h Fx(in16)e Fz(can)i(b)r(e)h(used)f(in)h(the)f(\014rst)g(one)515
3163 y(to)g(do)h(16-bit)e(I/O.)h(The)h(same)f(happ)r(ens)g(to)h(32-bit)
f(and)g(64-bit)g(I/O.)515 3296 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 3296 V 29 w(IOPort)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 3387 y Fk(h)p Fj(IO)e(op)l(er)l(ations.)k
Fk(i)1885 5255 y Fz(286)p eop
PStoPSsaved restore
%%Page: (288,289) 145
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
287 288 bop 515 523 a Fk(h)p Fj(IO)26 b(op)l(er)l(ations.)j
Fk(i)p Fq(\021)598 614 y Fi(unsigned8_t)41 b(in\(void\))h(const)e({)676
706 y(return)h(off_mdepIOBank::in_b\(get_id\(\).)q(i_of)q(fset\))q(;)
598 797 y(})598 888 y(void)79 b(out\(const)41 b(unsigned8_t)h(b\))e
(const)g({)676 980 y(off_mdepIOBank::out_b\(get_id)q(\(\).i_)q(offs)q
(et,b)q(\);)598 1071 y(})598 1162 y(unsigned16_t)i(in16\(void\))f
(const)80 b({)676 1254 y(return)41 b(off_mdepIOBank::in_w\(get_id\(\).)
q(i_of)q(fset\))q(;)598 1345 y(})598 1436 y(void)79 b(out16\(const)42
b(unsigned16_t)g(b\))d(const)i({)676 1528 y
(off_mdepIOBank::out_w\(get_id)q(\(\).i_)q(offs)q(et,b)q(\);)598
1619 y(})598 1710 y(unsigned32_t)h(in32\(void\))f(const)g({)676
1802 y(return)g(off_mdepIOBank::in_l\(get_id\(\).)q(i_of)q(fset\))q(;)
598 1893 y(})598 1984 y(void)f(out32\(const)i(unsigned32_t)g(b\))d
(const)i({)676 2076 y(off_mdepIOBank::out_l\(get_id)q(\(\).i_)q(offs)q
(et,b)q(\);)598 2167 y(})598 2258 y(unsigned64_t)h(in64\(void\))f
(const)g({)676 2350 y(return)g(off_mdepIOBank::in_q\(get_id\(\).)q
(i_of)q(fset\))q(;)598 2441 y(})598 2532 y(void)f(out64\(const)i
(unsigned64_t)g(b\))d({)676 2623 y(off_mdepIOBank::out_q\(get_id)q
(\(\).i_)q(offs)q(et,b)q(\);)598 2715 y(})515 2980 y
Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 3072 y Fi(#include)41 b(<hw/mdep/mIOBank.h>)
161 b(//)40 b(for)g(in_b)g(et)f(al)515 3346 y Fn(4.2.3)112
b(IO)37 b(p)s(ort)h(allo)s(cation)515 3499 y Fz(IO)18
b(p)r(orts)g(are)f(allo)r(cated)h(from)g(an)g Fx(IOAllocator)c
Fz(whic)n(h)k(is)g(a)g(sub)r(class)g(of)g(a)g Fx(SparseAllocator)515
3599 y Fz(instan)n(tiated)27 b(to)h(allo)r(cate)e Fx(IOPort)p
Fz(s.)515 3731 y Fk(h)p Fj(O\013)h(IO)g(p)l(ort)h(al)t(lo)l(c)l(ator.)h
Fk(i)p Fq(\021)598 3823 y Fi(//)39 b(A)h(IO)g(port)g(allocator.)598
3914 y(//)598 4005 y(class)g(off_IOAllocator)j(:)c(public)i
(off_TSparseAllocator<off_LIOPo)q(rt>)46 b({)598 4097
y(private:)598 4188 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)g(of)e
Fi(off)p 1635 4188 24 4 v 29 w(IOAllocator)p Fj(.)i Fk(i)598
4279 y Fi(public:)676 4462 y Fk(h)p Fj(Other)g(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 4462 V 29 w(IOAllocator)p Fj(.)j
Fk(i)598 4736 y Fi(};)1885 5255 y Fz(287)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
288 289 bop 639 523 a Fz(As)30 b(the)f(sparse)f(allo)r(cator)g(uses)h
(a)g(lik)n(ed)g(free-list,)g(the)h(arra)n(y)d(no)r(des)i(m)n(ust)h(sub)
r(class)515 623 y Fx(DLinkedNode)p Fz(.)515 739 y Fk(h)p
Fj(O\013)d(linkable)g(IO)g(p)l(ort.)h Fk(i)p Fq(\021)598
830 y Fi(class)40 b(off_LIOPort)i(:)d(public)i(DLinkedNode)h({)598
922 y(public:)676 1013 y(off_IOPort)g(l_io;)550 b(//)40
b(The)g(IO)f(port.)676 1196 y(//)h(To)g(allow)g(uninitialized)i
(LIOPorts)676 1287 y(off_LIOPort\(void\))h({;})676 1378
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 1378 24 4 v 29 w(LIOPort)p Fj(.)i Fk(i)598 1469
y Fi(};)639 1594 y Fz(An)k(arra)n(y)c(and)j(an)g(indexer)f(for)h
Fx(LIOPort)p Fz(s)d(is)j(main)n(tained)f(b)n(y)h(the)g
Fx(IOAllocator)p Fz(.)515 1694 y(An)c(IO)g(allo)r(cator)e(has)h(a)h
(\014xed)g(n)n(um)n(b)r(er)f(of)h Fx(IOPort)p Fz(s)d(dep)r(ending)k(on)
e(the)h(mac)n(hine)g(it)g(is)515 1793 y(running)f(on.)515
1926 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1926 V 29 w(IOAllocator)p Fj(.)h Fk(i)p
Fq(\021)598 2017 y Fi(static)40 b(off_Indexer<off_LIOPort>)45
b(i_idx;)598 2109 y(static)40 b(off_LIOPort)552 b
(i_io[OFF_MDEP_NAIOP_MAX];)515 2283 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort)h(al)t(lo)l(c)l(ator)h(static)g(memb)l(ers.)f
Fk(i)p Fq(\021)598 2374 y Fi(off_Indexer<off_LIOPort>)44
b(off_IOAllocator::i_idx;)598 2466 y(off_LIOPort)551
b(off_IOAllocator::i_io[OFF_M)q(DEP_N)q(AIOP)q(_MAX)q(];)515
2731 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(al)t(lo)l(c)l(ator)h(dep)l
(endencies.)g Fk(i)p Fq(\021)598 2823 y Fi(#include)41
b(<klib/SparseAllocator.h>)123 b(//)40 b(for)g(off_SparseAllocator)598
2914 y(#include)h(<hw/mdep/mIOBank.h>)161 b(//)40 b(for)g
(OFF_MDEP_NIOP_MAX)j(and)d(OFF_MDEP_NAIOP_MAX)598 3005
y(#include)h(<hw/IOPort.h>)395 b(//)40 b(for)g(off_IOPort)h(et)f(al.)
639 3147 y Fz(The)28 b(allo)r(cator)e(is)h(initialized)h(as)f(follo)n
(ws.)515 3279 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3279 V 29 w(IOAllocator)p Fj(.)i Fk(i)p
Fq(\021)598 3371 y Fi(//)39 b(Creates)i(an)f(off_IOAllocator)598
3462 y(off_IOAllocator\(off_Exhausted)46 b(*r\))39 b(:)676
3553 y(off_TSparseAllocator<off_LIO)q(Port>)q(\(r,\()q(cons)q(t)45
b(off_Indexable*\)&i_idx,i_io,)2010 3645 y
(OFF_MDEP_NAIOP_MAX,OFF_MDEP_N)q(IOP_M)q(AX\))637 3736
y({;})639 3968 y Fz(The)28 b(rev)n(o)r(cator)d(will)j(b)r(e)g(the)g(IO)
f(bank)g(itself,)i(as)d(set)i(at)g(construction)e(time.)515
4085 y Fk(h)p Fj(Initialize)g Fi(io)p 949 4085 V 29 w(alloc)p
Fj(.)i Fk(i)p Fq(\021)598 4176 y Fi(io_alloc\(\(off_Exhausted*\)this\))
639 4301 y Fz(The)j Fx(notify)d Fz(metho)r(d)j(m)n(ust)f(th)n(us)h(b)r
(e)g(pro)n(vided)e(b)n(y)h(IO)g(banks)g(to)h(implemen)n(t)g(the)515
4400 y(resource)26 b(rev)n(o)r(cator)f(signature.)35
b(Ho)n(w)n(ev)n(er,)26 b(suc)n(h)h(ev)n(en)n(ts)g(are)g(silen)n(tly)g
(discarded.)515 4516 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4516 V 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4608 y Fi(//)39 b(Notifies)i(that)g(IO)e(ports)i(are)f
(exhausted.)598 4699 y(void)g(notify\(void\))i({;})1885
5255 y Fz(288)p eop
PStoPSsaved restore
%%Page: (290,291) 146
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
289 290 bop 639 523 a Fz(Once)21 b(the)g(allo)r(cator)f(has)g(b)r(een)i
(initialized,)g(the)g(IO)e(bank)h(can)g(b)r(e)g(indexed)g(to)g(obtain)
515 623 y(references)26 b(to)i(IO)f(p)r(orts)g(and)g(IO)h(p)r(orts)f
(can)g(b)r(e)h(allo)r(cated)f(and)g(deallo)r(cated.)515
756 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 756 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
847 y Fi(//Gets)40 b(an)g(IO)g(port)g(from)g(its)g(distributed)i(or)d
(physical)i(address)598 938 y(off_IOPort)g(*operator+\(vm_offset_t)j
(io\))80 b({)676 1029 y(assert\(valid\(\)\);)676 1121
y(return)41 b(&\(io_alloc+io\)->l_io;)598 1212 y(})598
1395 y(//)e(Allocates)j(an)d(IO)h(port.)598 1486 y(off_IOPort)h
(*alloc\(const)h(off_io_id_t)g(&at,)e(boolean_t)h
(use_revocation=FALSE\);)598 1577 y(//)e(Deallocates)j(an)e(IO)g(port.)
598 1669 y(void)g(free\()g(const)h(off_IOPort)g(*iop)f(\);)515
1934 y Fk(h)p Fi(off)p 667 1934 V 29 w(IOBank::alloc)30
b Fj(and)e Fi(free)g Fj(implementation.)g Fk(i)p Fq(\021)598
2026 y Fi(//)39 b(Allocates)j(an)d(IO)h(port.)598 2117
y(off_IOPort)h(*off_IOBank::alloc\(const)k(off_io_id_t)d(&at,)e
(boolean_t)h(use_revocation\))598 2208 y({)676 2300 y(off_LIOPort)h
(*lio;)676 2391 y(assert\(valid\(\)\);)676 2482 y(w_lock\(\);)676
2574 y(lio=io_alloc.allocate\(at,use)q(_revo)q(cati)q(on\);)676
2665 y(w_unlock\(\);)676 2756 y(return)f
(\(lio\)?\(&lio->l_io\):\(off_IOPort)q(*\)NU)q(LL;)598
2848 y(})598 2939 y(//)e(Deallocates)j(an)e(IO)g(port.)598
3030 y(void)g(off_IOBank::free\()j(const)d(off_IOPort)i(*iop)e(\))598
3122 y({)676 3213 y(off_LIOPort)i(*lio=\(off_LIOPort*\)\(\(\(char*\)i)q
(op\)-\()q(int\))q(&off_)q(LIOP)q(ort:)q(:l_io)q(\);)676
3304 y(assert\(valid\(\)\);)676 3396 y(w_lock\(\);)676
3487 y(io_alloc.deallocate\(lio\);)676 3578 y(w_unlock\(\);)598
3670 y(})515 3935 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 4027 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)639 4168 y Fz(I/O)20
b(p)r(orts)h(are)f(allo)r(cated)g(and)h(deallo)r(cated)f(with)h
Fx(new)f Fz(and)h Fx(delete)d Fz(op)r(erators.)33 b(The)515
4267 y(op)r(erator)25 b Fx(new)g Fz(receiv)n(es)g(the)i(I/O)f(bank)g
(where)h(the)g(p)r(ort)f(should)h(b)r(e)g(allo)r(cated.)35
b(It)27 b(uses)515 4367 y(in)h(turn)f(its)h Fx(alloc)e
Fz(metho)r(d.)515 4500 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4500 V 29 w(IOPort)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4591 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d
(off_IOBank)j(*iobank,)f(const)f(off_io_id_t)i(&at,)1343
4682 y(boolean_t)f(use_revocation=FALSE\);)598 4774 y(void)f(operator)h
(delete\(void)h(*p\);)1885 5255 y Fz(289)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
290 291 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IOPort::operator)42 b(new/delete)30 b Fj(implementation.)e
Fk(i)o Fq(\021)598 614 y Fi(void)40 b(*off_IOPort::operator)k
(new\(size_t)d(s,)f(off_IOBank)i(*iobank,)1814 706 y(const)e
(off_io_id_t)i(&at,)1814 797 y(boolean_t)f(use_revocation\))598
888 y({)676 980 y(off_IOPort)h(*io=iobank->alloc\(at,use_revoc)q(ation)
q(\);)676 1071 y(\(void\)s;)676 1162 y(assert\(iobank\);)676
1254 y(if)e(\(io\))g(io->set_id\(at\);)676 1345 y(return)h
(\(void*\)io;)598 1436 y(})598 1619 y(void)f(off_IOPort::operator)k
(delete\(void)d(*p\))598 1710 y({)676 1802 y(off_IOPort)h
(*io=\(off_IOPort*\)p;)676 1893 y(assert\(io)f(&&)f(io->valid\(\)\);)
676 1984 y(\(\(off_IOBank*\)\(io->get_conta)q(iner\()q(\)\)\)-)q(>fre)q
(e\(io\))q(;)598 2076 y(})639 2202 y Fz(As)33 b(w)n(e)g(ha)n(v)n(e)f
(seen,)i(the)f(reference)g(to)f(the)i(con)n(tainer)e(and)g(the)i(IO)e
(p)r(ort)h(iden)n(ti\014er)515 2302 y(remain)27 b(to)g(b)r(e)h(set.)37
b(They)28 b(are)e(pre-initialized)h(when)h(the)g(IO)f(bank)g(is)h
(\014rst)f(started.)515 2420 y Fk(h)p Fj(Start)i(other)g(memb)l(ers)f
(of)f Fi(off)p 1467 2420 V 29 w(IOBank)i Fj(ac)l(c)l(or)l(ding)g(to)f
Fi(mdep)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 2511 y Fi(for)40
b(\(natural_t)h(io=0;)g(io)e(<)h(OFF_MDEP_NAIOP_MAX;)j(io++\))e({)676
2602 y(off_io_id_t)h(ioid\(get_id\(\),io\);)676 2694
y(\(void\))f(new\(io_alloc.real_add\(io\)\))k
(off_LIOPort\(ioid,this\);)598 2785 y(})515 2930 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
2930 V 29 w(LIOPort)p Fj(.)h Fk(i)p Fq(\021)598 3021
y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LIOPort)j(*io\))e({)g
(\(void\)s;)h(return)f(\(void*\)io;})639 3147 y Fz(W)-7
b(e)27 b(used)g(again)e(a)h Fx(new)f Fz(op)r(erator)g(and)h(a)g
(pre-initialization)g(constructor)f(as)h(w)n(e)g(did)515
3247 y(with)i(page)f(frames.)515 3356 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3356 V 29 w(LIOPort)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 3447 y Fi(off_LIOPort\(const)43
b(off_io_id_t)f(&id,)e(off_IOBank)h(*c\))f(:)g(l_io\(id,c\))h({;})515
3583 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3583 V 29 w(IOPort)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3674 y Fi(off_IOPort\(const)43 b(off_io_id_t)e(&id,)f
(off_IOBank)i(*c\))e(:)676 3765 y(off_HWResUnit\(id,OFF_MAGIC_I)q
(OPORT)q(,\(of)q(f_HW)q(CompR)q(esou)q(rce*\))q(c\))598
3857 y({;})515 4109 y Fn(4.2.4)112 b(IO)37 b(Bank)h(na)m(vigation)f
(and)i(insp)s(ection)515 4263 y FA(IO)31 b(Bank)i(na)m(vigation)515
4416 y Fz(The)i(IO)g(bank)f(na)n(vigator)f(giv)n(es)h(uniform)h(access)
f(to)h(IO)g(banks.)59 b(It)35 b(is)g(implemen)n(ted)515
4515 y(with)28 b(the)g(generic)e(bank)i(na)n(vigator)d(de\014ned)j(in)g
(section)f FA(??)p Fz(.)639 4615 y(IO)34 b(bank)h(na)n(vigators)d(are)h
(created)h(dynamically)-7 b(.)57 b(No)n(w)34 b(w)n(e)g(can)h(implemen)n
(t)g(this)515 4715 y(metho)r(d:)515 4824 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4824 V 29
w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 4915 y Fi(//)39
b(Returns)i(a)f(navigator)h(for)f(IOBanks.)598 5006 y(off_Navigator)i
(*get_navigator\(void\);)1885 5255 y Fz(290)p eop
PStoPSsaved restore
%%Page: (292,293) 147
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
291 292 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IOBank::get)p 1125 523 V 30 w(navigator)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f
(IOBanks.)598 706 y(off_Navigator)i(*off_IOBank::get_navigator\(vo)q
(id\))598 797 y({)715 888 y(assert\(valid\(\)\);)715
980 y(return)f(new)f(off_BankNav<off_IOBank,off_IO)q(Port>)q(\(*th)q
(is\);)598 1071 y(})515 1229 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h
(navigator)h(dep)l(endencies.)g Fk(i)p Fq(\021)598 1321
y Fi(#include)41 b(<hw/IOBank.h>)395 b(//)40 b(for)g(IOBank.)598
1412 y(#include)h(<hw/IOPort.h>)395 b(//)40 b(for)g(IOPort.)598
1503 y(#include)h(<hw/bnav.h>)473 b(//)40 b(for)g(off_BankNav)h(et)f
(al.)515 1662 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1753 y Fi(#include)41 b(<klib/nav.h>)434
b(//)40 b(for)g(off_Navigator)i(et)d(al.)515 1912 y Fk(h)p
Fj(O\013)27 b(IO)g(b)l(ank)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2003 y Fi(#include)41 b(<hw/ionav.h>)515
2249 y FA(IO)31 b(bank)i(insp)s(ection)515 2402 y Fz(The)27
b(IO)h(bank)f(insp)r(ector's)g(attribute)h(arra)n(y)d(lo)r(oks)h(lik)n
(e)i(this:)515 2514 y Fk(h)p Fj(O\013)f(IO)g(b)l(ank)h(insp)l(e)l(ctor)
i(attribute)f(arr)l(ay)g(initializer.)e Fk(i)o Fq(\021)598
2606 y Fi({{)39 b(OFF_STR_ATTR)j(,)e("name",)198 b(&off_IOBank::nameof)
43 b(},)637 2697 y({)c(OFF_STR_ATTR,)82 b("class",)159
b(&off_IOBank::kindof)43 b(},)637 2788 y({)c(OFF_ID_ATTR,)121
b("dom",)237 b(&off_IOBank::get_domain)44 b(},)637 2880
y({)39 b(OFF_ID_ATTR,)121 b("id",)276 b(&off_IOBank::get_id)43
b(},)637 2971 y({)c(OFF_STR_ATTR,)82 b("url",)237 b
(&off_IOBank::get_url)43 b(},)637 3062 y({)c(OFF_STR_ATTR,)82
b("provides",)42 b(&off_IOBank::nameof)h(},)637 3154
y({)c(OFF_STR_ATTR,)82 b(NULL,)276 b(NULL)157 b(},)h(//)39
b(no)h(requeriments.)637 3245 y(//)g(IO)f(bank)h(specific)i
(attributes.)637 3336 y({)d(OFF_BOOL_ATTR,)k("doesiomap",)81
b(&off_IOBank::is_iomapable)45 b(},)637 3428 y({)39 b(OFF_BOOL_ATTR,)k
("doesuserio",)f(&off_IOBank::is_usrio},)598 3610 y(//)d(If)h(this)g
(is)g(not)g(commented)h(out)f(it)g(gets)g(an)g(internal)h(gcc)e
(compiler)j(error)e(#40)598 3702 y(//)f({)h(OFF_NAT_ATTR,)81
b("nports",)198 b(&off_IOBank::get_nports},)598 3793
y(//)39 b({)h(OFF_NAT_ATTR,)81 b("first",)237 b
(&off_IOBank::get_first},)598 3884 y(//)39 b({)h(OFF_NAT_ATTR,)81
b("last",)276 b(&off_IOBank::get_last},)598 3976 y(//)39
b({)h(OFF_NAT_ATTR,)81 b("mat",)315 b(&off_IOBank::get_mat},)598
4067 y(//)39 b({)h(OFF_NAT_ATTR,)81 b("iosize",)198 b
(&off_IOBank::get_iosize},)637 4158 y({)39 b(OFF_NULL_ATTR,)k(NULL,)276
b(NULL)40 b(})f(})h(//)f(End)h(of)g(attribute)h(list.)515
4304 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(insp)l(e)l(ctor)i(attribute)
f(arr)l(ay)g(length.)f Fk(i)p Fq(\021)598 4395 y Fi(const)40
b(int)g(OFF_IOINSP_NATTR=9;)122 b(//)40 b(not)g(counting)h(final)f
(NULL)g(attr.)639 4529 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(implemen)n(ted)h
(neither)f Fx(get)p 1883 4529 27 4 v 31 w(url)f Fz(nor)h
Fx(nameof)e Fz(y)n(et.)515 4641 y Fk(h)p Fj(Other)j(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 4641 24 4 v 29 w(IOBank)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 4732 y Fi(//)39 b(Get)h(the)g(IO)g(bank)g
(URL.)598 4824 y(const)g(char)g(*get_url\(void\);)598
4915 y(//)f(Returns)i(the)f(IO)g(bank)g(name.)598 5006
y(const)g(char)g(*nameof\(void\);)1885 5255 y Fz(291)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
292 293 bop 639 523 a Fz(Giv)n(en)28 b(this)g(attribute)f(list,)h(the)g
(IO)f(bank)h(insp)r(ector)f(is)g(de\014ned)h(as)f(follo)n(ws)515
639 y Fk(h)p Fj(O\013)g(IO)g(b)l(ank)h(insp)l(e)l(ctor.)h
Fk(i)p Fq(\021)598 731 y Fi(//)39 b(An)h(IO)g(bank)g(inspector.)598
822 y(//)598 913 y(class)g(off_IOBankInsp)j(:)c(public)i(off_Inspector)
h({)598 1005 y(private:)676 1096 y(static)f(off_attr_t)g
(io_attrs[OFF_IOINSP_NATTR+1])q(;)k(//)40 b(for)g(final)g(NULL)g(attr.)
598 1187 y(public:)676 1279 y(off_IOBankInsp\(off_IOBank)45
b(*iobank\))c(:)794 1370 y(off_Inspector)h(\(iobank,)f(io_attrs,)g
(OFF_IOINSP_NATTR\))676 1461 y({)f(assert\(iobank)i(&&)e
(iobank->valid\(\)\);)j(})598 1553 y(};)515 1768 y Fz(Where)27
b(the)h(attribute)g(arra)n(y)d(is)j(shared.)515 1885
y Fk(h)p Fj(O\013)f(IO)g(b)l(ank)h(insp)l(e)l(ctor)i(static)e(memb)l
(ers.)g Fk(i)p Fq(\021)598 1976 y Fi(//)39 b(inspector)j(attributes)f
(for)f(iobanks.)598 2067 y(off_attr_t)h(off_IOBankInsp::io_attrs[OFF)q
(_IOI)q(NSP_N)q(ATTR)q(+1])k(=)1186 2159 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)i(insp)l(e)l(ctor)g(attribute)h(arr)l(ay)f(initializer.)
d Fk(i)598 2250 y Fi(;)639 2374 y Fz(Ev)n(ery)31 b(time)i
Fx(get)p 1214 2374 27 4 v 30 w(inspector)c Fz(is)j(called,)i(a)e(new)g
(insp)r(ector)g(is)h(created.)50 b(The)33 b(user)515
2474 y(should)27 b Fx(delete)e Fz(it)j(whenev)n(er)f(it)h(is)f(no)h
(longer)e(needed.)515 2590 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2590 24 4 v 29 w(IOBank)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 2682 y Fi(//)39 b(Returns)i(an)f(inspector)h
(for)f(IOBanks.)598 2773 y(off_Inspector)i(*get_inspector\(void\);)515
2931 y Fk(h)p Fi(off)p 667 2931 V 29 w(IOBank::get)p
1125 2931 V 30 w(inspector)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 3022 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f
(IOBanks.)598 3113 y(off_Inspector)i(*off_IOBank::get_inspector\(vo)q
(id\))598 3205 y({)676 3296 y(assert\(valid\(\)\);)676
3387 y(return)f(new)f(off_IOBankInsp\(this\);)598 3479
y(})639 3620 y Fz(The)33 b(URL)f(for)g(an)g(IO)g(bank)g(is)h(that)f(of)
h(its)f(no)r(de)h(with)g Fx(io.html)c Fz(app)r(ended.)52
b(W)-7 b(e)515 3719 y(use)26 b(a)g(new)g(mem)n(b)r(er,)h(a)f(c)n
(haracter)e(arra)n(y)g(initialized)j(the)g(v)n(ery)e(\014rst)h(time)h
(it)g(is)f(needed.)515 3836 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 3836 V 29 w(IOBank)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 3927 y Fi(static)40 b(char)g(*io_url;)512
b(//)40 b(URL)g(for)g(this)g(IO)g(bank.)639 4051 y Fz(Initially)28
b(it)g(is)f(empt)n(y)-7 b(.)515 4168 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)h(static)h(memb)l(ers.)f Fk(i)p Fq(\021)598
4259 y Fi(char)40 b(*off_IOBank::io_url=NULL;)84 b(//)40
b(URL)g(for)g(this)g(IO)f(bank.)1885 5255 y Fz(292)p
eop
PStoPSsaved restore
%%Page: (294,295) 148
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
293 294 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IOBank::get)p 1125 523 V 30 w(url)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Get)h(the)g(IO)g(bank)g(URL.)598
706 y(const)g(char)g(*off_IOBank::get_url\(void\))598
797 y({)676 888 y(assert\(valid\(\)\);)676 980 y(if)g(\(!io_url\){)755
1071 y(io_url=new)h(char[strlen\(nd.get_url\(\)\)+st)q(rlen\()q(OFF_)q
(IOBAN)q(K_UR)q(L\)+1)q(];)k(//+1)40 b(for)g(\\0)755
1162 y(if)f(\(io_url\){)833 1254 y(strcpy\(io_url,nd.get_url\(\)\);)833
1345 y(strcat\(io_url,OFF_IOBANK_URL\))q(;)755 1436 y(})676
1528 y(})676 1619 y(return)i(io_url;)598 1710 y(})639
1938 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(IO)f(banks.)515 2052 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)
i(c)l(o)l(de)g(urls.)e Fk(i)p Fq(\021)598 2143 y Fi(const)40
b(char)g(OFF_IOBANK_URL[]="/io.html";)515 2294 y Fk(h)p
Fj(O\013)27 b(IO)g(b)l(ank)h(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 2385 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_IOBANK_URL)515 2551 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2642 y Fi(#include)41 b(<string.h>)512
b(//)40 b(for)g(strcat)g(strdup)h(et)e(al)598 2733 y(#include)i
(<node/Node.h>)395 b(//)40 b(for)g(nd)639 2870 y Fz(The)d(name)g(for)f
(an)g(IO)h(bank)f(is)h(that)g(of)f(its)h(no)r(de)g(complemen)n(ted)g
(with)g(a)f(little)515 2969 y(su\016x.)43 b(The)30 b(implemen)n(tation)
g(is)g(almost)f(the)h(same)f(of)h Fx(get)p 2486 2969
27 4 v 30 w(url)p Fz(,)g(ho)n(w)n(ev)n(er,)e(the)i(name)515
3069 y(is)d(not)h(shared)e(among)h(IO)g(banks)g(in)h(the)g(same)f(no)r
(de)h(\(i.e.)37 b(it)28 b(is)f(not)h Fx(static)p Fz(\).)515
3197 y Fk(h)p Fi(off)p 667 3197 24 4 v 29 w(IOBank::nameof)i
Fj(implementation.)e Fk(i)o Fq(\021)598 3289 y Fi(//)39
b(Returns)i(the)f(IO)g(bank)g(name.)598 3380 y(const)g(char)g
(*off_IOBank::nameof\(void\))598 3471 y({)676 3563 y
(assert\(valid\(\)\);)676 3654 y(if)g(\(!io_name\){)755
3745 y(io_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strle)q(n\("/)q
(ioban)q(k"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755
3837 y(if)f(\(io_name\){)833 3928 y(char)h(number[9];)833
4019 y(strcpy\(io_name,nd.nameof\(\)\);)833 4111 y
(strcat\(io_name,"/iobank"\);)833 4202 y
(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q(id\(\)\))q(;)833
4293 y(strcat\(io_name,number\);)755 4384 y(})676 4476
y(})676 4567 y(return)h(io_name;)598 4658 y(})515 4915
y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p
1552 4915 V 29 w(IOBank)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598
5006 y Fi(char)40 b(*io_name;)708 b(//)40 b(name)g(for)g(this)g(IO)g
(bank.)1885 5255 y Fz(293)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
294 295 bop 515 523 a Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l
(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 523 24 4 v 29
w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(io_name\(NULL\))
515 872 y FA(IO)j(p)s(ort)h(insp)s(ection)515 1025 y
Fz(IO)g(p)r(orts)g(cannot)h(b)r(e)g(na)n(vigated.)51
b(They)32 b(can)h(b)r(e)g(insp)r(ected)g(though.)52 b(The)33
b(attribute)515 1125 y(arra)n(y)25 b(of)j(their)f(insp)r(ectors)g(is)g
(as)g(follo)n(ws.)515 1241 y Fk(h)p Fj(O\013)g(IO)g(p)l(ort)h(insp)l(e)
l(ctor)i(attribute)g(arr)l(ay)e(initializer.)f Fk(i)p
Fq(\021)598 1332 y Fi({{)39 b(OFF_STR_ATTR)j(,)e("name",)198
b(&off_IOPort::nameof)43 b(},)637 1423 y({)c(OFF_STR_ATTR,)82
b("class",)159 b(&off_IOPort::kindof)43 b(},)637 1515
y({)c(OFF_ID_ATTR,)121 b("dom",)237 b(&off_IOPort::get_domain)44
b(},)637 1606 y({)39 b(OFF_ID_ATTR,)121 b("id",)276 b
(&off_IOPort::get_id)43 b(},)637 1697 y({)c(OFF_STR_ATTR,)82
b("url",)237 b(&off_IOPort::get_url)43 b(},)637 1789
y({)c(OFF_STR_ATTR,)82 b("provides",)42 b(&off_IOPort::nameof)h(},)637
1880 y({)c(OFF_STR_ATTR,)82 b(NULL,)276 b(NULL)157 b(},)h(//)39
b(no)h(requeriments.)637 1971 y(//)g(Page)g(frame)g(specific)h
(attributes.)637 2063 y({)e(OFF_ID_ATTR,)121 b("container",)f
(&off_IOPort::get_iobank)45 b(},)637 2154 y({)39 b(OFF_NULL_ATTR,)k
(NULL,)276 b(NULL)40 b(})f(})h(//)f(End)h(of)g(attribute)h(list.)515
2312 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(insp)l(e)l(ctor)i(attribute)
g(arr)l(ay)e(length.)g Fk(i)p Fq(\021)598 2403 y Fi(const)40
b(int)g(OFF_IOPINSP_NATTR=8;)122 b(//)40 b(not)g(counting)h(final)f
(NULL)g(attr.)639 2544 y Fz(W)-7 b(e)19 b(need)g Fx(get)p
1095 2544 27 4 v 30 w(rurl)d Fz(and)j Fx(get)p 1602 2544
V 30 w(url)p 1764 2544 V 30 w(holder)d Fz(for)i(p)r(orts)g(to)g(supp)r
(ort)g Fx(ResUnit::get)p 3316 2544 V 27 w(url)p Fz(.)515
2660 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2660 24 4 v 29 w(IOPort)p Fj(.)h Fk(i)p
Fq(\021)598 2752 y Fi(//)39 b(Get)h(the)g(port)g(URL.)598
2843 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)
g(OFF_IOPORT_URL;)j(})598 2934 y(//)c(Returns)i(the)f(port)g(name.)598
3026 y(virtual)h(char)f(*&get_url_holder\(void\);)639
3242 y Fz(Where)28 b(w)n(e)f(m)n(ust)h(de\014ne)f(the)h(relativ)n(e)f
(URL)h(for)f(p)r(orts.)515 3358 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l
(o)l(de)g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 3449 y Fi(const)40
b(char)g(OFF_IOPORT_URL[]="#IOPort";)515 3607 y Fk(h)p
Fj(O\013)27 b(IO)g(p)l(ort)h(dep)l(endencies.)i Fk(i)p
Fz(+)o Fq(\021)598 3698 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_IOPORT_URL)515 3873 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort)h(implementation)g(dep)l(endencies.)i
Fk(i)p Fq(\021)598 3964 y Fi(#include)41 b(<stdio.h>)551
b(//)40 b(for)g(sprintf)g(et)g(al)639 4105 y Fz(URLs)28
b(are)f(the)h(same)f(for)g(all)g(p)r(orts.)515 4221 y
Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 4221 V 29 w(IOPort)p Fj(.)g Fk(i)p Fq(\021)598 4313
y Fi(static)40 b(char)g(*io_url;)512 b(//)40 b(URL)g(for)g(this)g(page)
g(frame.)515 4470 y Fk(h)p Fi(off)p 667 4470 V 29 w(IOPort::get)p
1125 4470 V 30 w(url)p 1272 4470 V 29 w(holder)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 4562 y Fi(char)40 b
(*&off_IOPort::get_url_holder\(v)q(oid\))46 b({)79 b(return)40
b(io_url;)h(})639 4703 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 4819 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(static)h(memb)l
(ers.)f Fk(i)p Fq(\021)598 4910 y Fi(char)40 b
(*off_IOPort::io_url=NULL;)84 b(//)40 b(URL)g(for)g(IO)f(ports.)1885
5255 y Fz(294)p eop
PStoPSsaved restore
%%Page: (296,297) 149
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
295 296 bop 639 523 a Fz(Giv)n(en)19 b(the)g(attribute)g(list)f(sho)n
(wn)g(ab)r(o)n(v)n(e,)h(a)g(IO)f(p)r(ort)g(insp)r(ector)h(is)f
(de\014ned)h(as)f(follo)n(ws.)515 639 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort)h(insp)l(e)l(ctor.)h Fk(i)p Fq(\021)598
731 y Fi(//)39 b(A)h(IO)g(port)g(inspector.)598 822 y(//)598
913 y(class)g(off_IOPortInsp)j(:)c(public)i(off_Inspector)h({)598
1005 y(private:)676 1096 y(static)f(off_attr_t)g
(io_attrs[OFF_IOPINSP_NATTR+1)q(];)k(//)40 b(for)g(final)g(NULL)g
(attr.)598 1187 y(public:)676 1279 y(off_IOPortInsp\(off_IOPort)45
b(*iop\))40 b(:)794 1370 y(off_Inspector\(iop,)j(io_attrs,)e
(OFF_IOPINSP_NATTR\))676 1461 y({})598 1553 y(};)639
1768 y Fz(Where)28 b(the)g(attribute)f(arra)n(y)f(is)h(shared.)515
1885 y Fk(h)p Fj(O\013)g(IO)g(p)l(ort)h(insp)l(e)l(ctor)i(static)f
(memb)l(ers.)f Fk(i)p Fq(\021)598 1976 y Fi(//)39 b(inspector)j
(attributes)f(for)f(IO)g(ports.)598 2067 y(off_attr_t)h
(off_IOPortInsp::io_attrs[OFF)q(_IOP)q(INSP_)q(NATT)q(R+1])46
b(=)1186 2159 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)i(insp)l(e)l(ctor)g
(attribute)h(arr)l(ay)f(initializer.)d Fk(i)598 2250
y Fi(;)639 2374 y Fz(Ev)n(ery)31 b(time)i Fx(get)p 1214
2374 27 4 v 30 w(inspector)c Fz(is)j(called,)i(a)e(new)g(insp)r(ector)g
(is)h(created.)50 b(The)33 b(user)515 2474 y(should)27
b Fx(delete)e Fz(it)j(whenev)n(er)f(it)h(is)f(no)h(longer)e(needed.)515
2590 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2590 24 4 v 29 w(IOPort)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2682 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(IOPorts.)598
2773 y(off_Inspector)i(*get_inspector\(void\);)515 2931
y Fk(h)p Fi(off)p 667 2931 V 29 w(IOPort::get)p 1125
2931 V 30 w(inspector)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 3022 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f
(IOPorts.)598 3113 y(off_Inspector)i(*off_IOPort::get_inspector\(vo)q
(id\))598 3205 y({)637 3296 y(return)f(new)e(off_IOPortInsp\(this\);)
598 3387 y(})515 3562 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h
(implementation)g(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
3653 y Fi(#include)41 b(<hw/ionav.h>)434 b(//)40 b(for)g
(off_IOPortInsp)i(et)e(al)1885 5255 y Fz(295)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
296 297 bop 515 523 a FA(IO)31 b(bank)i(na)m(vigation)f(and)h(insp)s
(ection)d Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
676 y Fz(The)27 b(na)n(vigation)f(and)i(insp)r(ection)g(co)r(de)f(for)g
(IO)g(banks)g(is)h(k)n(ept)f(in)h Fx(hw/ionav.h)p Fz(.)515
809 y Fk(h)p Fj(ionav.h*)11 b Fk(i)p Fq(\021)598 900
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_IOBANK_NAV_H)598
1083 y(#define)g(__OFF_IOBANK_NAV_H)i(1)598 1266 y Fk(h)p
Fj(O\013)27 b(IO)g(b)l(ank)h(navigator)h(dep)l(endencies.)g
Fk(i)598 1448 y(h)p Fj(O\013)e(IO)g(b)l(ank)h(insp)l(e)l(ctor)i
(attribute)f(arr)l(ay)g(length.)f Fk(i)598 1540 y(h)p
Fj(O\013)f(IO)g(p)l(ort)i(insp)l(e)l(ctor)g(attribute)h(arr)l(ay)e
(length.)g Fk(i)598 1631 y Fi(#ifdef)40 b(__KERNEL__)598
1722 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(insp)l(e)l(ctor.)h
Fk(i)598 1814 y(h)p Fj(O\013)e(IO)g(p)l(ort)i(insp)l(e)l(ctor.)f
Fk(i)598 1905 y Fi(#endif)598 2088 y(#endif)40 b(//)g
(__OFF_IOBANK_NAV_H)515 2262 y Fk(h)p Fj(ionav.C*)11
b Fk(i)o Fq(\021)598 2353 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2536 y Fi(#include)41 b(<hw/ionav.h>)434 b(//)40 b(Exported)h
(interface.)598 2719 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(insp)l(e)l
(ctor)i(static)e(memb)l(ers.)g Fk(i)598 2810 y(h)p Fj(O\013)f(IO)g(p)l
(ort)i(insp)l(e)l(ctor)g(static)g(memb)l(ers.)f Fk(i)515
3175 y Fn(4.2.5)112 b(F)-9 b(rozen)38 b(IO)515 3328 y
FA(F)-8 b(reezing)31 b(IO)h(banks)515 3482 y Fz(As)22
b(they)g(should)g(b)r(e)h(rather)e(small,)i(IO)f(banks)g(are)f(frozen)g
(eagerly)g(and)h(not)g(on)g(demand.)515 3581 y(W)-7 b(e)28
b(m)n(ust)f(implemen)n(t)i(these)e(metho)r(ds)h(so)f(that)h
Fx(freeze)d Fz(could)j(w)n(ork:)515 3714 y Fk(h)p Fj(Other)g(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 3714 24 4
v 29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 3805
y Fi(//)39 b(These)i(are)f(for)g(freeze:)598 3897 y(//)f(Freeze)i
(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e(buf)h(with)g(avail)h
(bytes.)598 3988 y(virtual)g(err_t)f(freeze_state\(char)j(*buf,)d(char)
h(*&curbuf,)g(size_t)f(&avail,)1657 4079 y(char)g(*&curto,)h(size_t)g
(&toavail,)1657 4171 y(const)f(off_prtl_id_t)i(&frozen_domain\);)598
4353 y(//)d(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f
(toavail)h(bytes.)598 4445 y(virtual)g(err_t)f(copy_state\(char)j
(*&curto,)e(size_t)f(&toavail\))h(const;)1885 5255 y
Fz(296)p eop
PStoPSsaved restore
%%Page: (298,299) 150
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
297 298 bop 639 523 a Fz(as)27 b(w)n(ell)h(as)e(these)i(others)f(to)g
(supp)r(ort)h Fx(melt)p Fz(:)515 639 y Fk(h)p Fj(Other)g(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 639 24 4 v
29 w(IOBank)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 731 y
Fi(//)39 b(These)i(are)f(for)g(melt:)598 822 y(//)f(Does)i(resource)g
(cleanup.)g(No)e(external)i(resource)g(should)g(be)f(used)g(after)598
913 y(//)f(return.)598 1005 y(virtual)i(err_t)f(cleanup\(void\);)598
1096 y(//)f(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1187 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 1279 y(//)f(Restores)i(dynamic)g
(resource)g(state.)598 1370 y(virtual)g(err_t)f(melt_state\(char)j
(*&buf,)d(size_t)h(&bsize,)g(char)f(*&from,)h(size_t)f(&size,)1578
1461 y(const)h(off_prtl_id_t)h(&melted_domain\);)639
1677 y Fz(The)28 b(most)f(simple)h(are)f Fx(cleanup)d
Fz(and)k Fx(copy)p 2086 1677 27 4 v 30 w(state)p Fz(.)515
1793 y Fk(h)p Fi(off)p 667 1793 24 4 v 29 w(IOBank::cleanup)i
Fj(implementation.)e Fk(i)p Fq(\021)598 1885 y Fi(//)39
b(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g(should)g(be)f
(used)g(after)598 1976 y(//)f(return.)598 2067 y(err_t)h
(off_IOBank::cleanup\(void\))598 2159 y({)676 2250 y(assert\(valid\(\))
j(&&)c(io_name)i(&&)f(io_url\);)676 2341 y(delete[])h(io_name;)676
2433 y(delete[])g(io_url;)676 2524 y(return)g(EOK;)598
2615 y(})515 2864 y Fk(h)p Fi(off)p 667 2864 V 29 w(IOBank::copy)p
1164 2864 V 30 w(state)29 b Fj(implementation.)f Fk(i)o
Fq(\021)598 2956 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g(in)e
(curbuf)i(with)f(toavail)h(bytes.)598 3047 y(err_t)f
(off_IOBank::copy_state\(char)45 b(*&curto,)d(size_t)e(&toavail\))h
(const)598 3138 y({)676 3230 y(assert\(valid\(\)\);)676
3321 y(if)f(\(curto\){)755 3412 y(if)f(\(toavail<sizeof\(*this\)\))833
3504 y(return)i(ENOSPC;)755 3595 y(//*\(off_IOBank*\)curto)j(=)39
b(*this;)i(XXX)755 3686 y(assert\(\(\(off_IOBank*\)curto\)->va)q(lid\()
q(\)\);)755 3778 y(curto)f(+=)g(sizeof\(*this\);)755
3869 y(toavail-=sizeof\(*this\);)676 3960 y(})676 4051
y(return)h(EOK;)598 4143 y(})639 4375 y Fz(The)35 b(coun)n(terpart,)f
Fx(restore)p 1611 4375 27 4 v 29 w(state)p Fz(,)g(uses)g
Fx(can)p 2232 4375 V 30 w(melt)f Fz(to)h(kno)n(w)g(if)h(the)g(frozen)e
(IO)515 4475 y(bank)27 b(can)g(b)r(e)h(melted)g(on)g(this)g(one.)515
4591 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 4591 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 4682 y Fi(//)39 b(Is)h(the)g(other)g(bank)h
(meltable)g(at)e(this)h(one?)598 4774 y(boolean_t)h(can_melt\(const)h
(off_IOBank)g(*other\))f(const;)1885 5255 y Fz(297)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
298 299 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IOBank::restore)p 1281 523 V 31 w(state)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Restores)i(the)f(static)h(state)f
(from)g(a)g(user)g(supplied)h(buffer.)598 706 y(err_t)f
(off_IOBank::restore_state\(cha)q(r)45 b(*&buf,)c(size_t)f(&bsize\))598
797 y({)676 888 y(off_IOBank)i(*other=\(off_IOBank*\)buf;)676
980 y(assert\(valid\(\)\);)676 1071 y(if)e(\(buf\){)755
1162 y(if)f(\(bsize)i(<)e(sizeof\(*this\))k(||)c(!can_melt\(other\)\){)
833 1254 y(return)i(EINVAL;)755 1345 y(})755 1436 y
(assert\(other->valid\(\)\);)755 1528 y(//*this=*other;)h(XXX)755
1619 y(buf+=sizeof\(*this\);)755 1710 y(bsize-=sizeof\(*this\);)676
1802 y(})676 1893 y(return)f(EOK;)598 1984 y(})722 2300
y FA(NOTE:)27 b Fz(XXX)i(freeze)e(sparse)f(allo)r(cator.)639
2482 y(The)37 b(frozen)g(IO)f(bank)h(can)g(b)r(e)g(melted)h(only)e(if)i
(IO)f(addresses)e(con)n(tained)h(in)i(the)515 2582 y(frozen)31
b(bank)g(are)g(v)-5 b(alid)32 b(for)f(us.)49 b(Otherwise)31
b(a)h(\\bigger")d(IO)j(bank)f(migh)n(t)h(b)r(e)g(needed.)515
2682 y(Besides,)27 b(w)n(e)g(should)g(c)n(hec)n(k)g(that)h(w)n(e)f(do)g
(not)h(lo)r(ose)f(IO)g(features.)639 2781 y(In)d(an)n(y)f(case,)g(it)h
(only)f(mak)n(e)f(sense)h(to)h(melt)g(IO)f(banks)f(on)i(the)f
Fy(same)31 b Fz(hardw)n(are)21 b(they)515 2881 y(w)n(ere)35
b(frozen)g(at)h(b)r(ecause)f(the)h(device)g(driv)n(ers)e(using)i(their)
g(p)r(orts)f(will)h(b)r(e)g(unable)g(to)515 2980 y(op)r(erate)26
b(otherwise)h(\(they)h(can)f(b)r(e)h(melted)h(on)e(di\013eren)n(t)h(no)
r(des,)f(though\).)515 3113 y Fk(h)p Fi(off)p 667 3113
V 29 w(IOBank::can)p 1125 3113 V 30 w(melt)i Fj(implementation.)e
Fk(i)p Fq(\021)598 3205 y Fi(//)39 b(Is)h(the)g(other)g(IO)g(meltable)h
(at)f(this)g(one?)598 3296 y(boolean_t)h(off_IOBank::can_melt\(const)k
(off_IOBank)d(*other\))e(const)598 3387 y({)676 3479
y(//)g(NB:)g(Perhaps)h(we)e(should)i(relax)f(and)g(allow)h(`degraded')g
(melts)676 3570 y(//)197 b(where)40 b(some)g(features)h(are)f(missing.)
h(XXX)676 3661 y(//)197 b(Besides,)41 b(only)f(addresses)h(for)f
(allocated)h(ports)g(need)f(to)g(be)676 3753 y(//)197
b(taken)40 b(into)g(account,)h(not)f(every)h(address.)676
3844 y(assert\(valid\(\))i(&&)c(other)i(&&)e(other->valid\(\)\);)676
3935 y(return)i(\()e(!)79 b(\(\(other->is_usrio\(\))240
b(&&)39 b(!is_usrio\(\)\))160 b(||)1186 4027 y
(\(other->is_iomapable\(\))84 b(&&)39 b(!is_iomapable\(\)\))k(\))1029
4118 y(&&)d(\(other->get_first\(\))j(>=)d(get_first\(\))i(&&)1186
4209 y(other->get_last\(\))82 b(<=)40 b(get_last\(\))81
b(&&)1186 4301 y(other->get_mat\(\))121 b(>=)40 b(get_mat\(\))120
b(&&)1186 4392 y(other->get_iosize\(0\))44 b(==)c(get_iosize\(0\)\)\);)
598 4483 y(})1885 5255 y Fz(298)p eop
PStoPSsaved restore
%%Page: (300,301) 151
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
299 300 bop 639 523 a Fz(T)-7 b(o)22 b(freeze)g(\(or)g(melt\))h(the)g
(state)f(of)h(an)f(IO)g(bank)g(w)n(e)g(m)n(ust)g(freeze)g(\(or)g
(melt\))h(dynamic)515 623 y(mem)n(b)r(ers)28 b(of)h(the)g(bank)g(and)f
(also)g(the)h(bitmap)h(allo)r(cator)d(b)r(eing)i(used.)40
b(Only)29 b(the)g(allo-)515 722 y(cator)23 b(itself)i(is)f(a\013ected,)
i(IO)e(p)r(ort)g Fy(must)p Fz(,)h(and)f(will,)h(remain)f(melted)h(and)g
(op)r(erational|)515 822 y(otherwise)c(it)h(w)n(ould)f(b)r(e)h(not)g
(feasible)g(to)f(transfer)g(the)h(frozen)f(state)h(to)g(a)f(di\013eren)
n(t)h(no)r(de.)515 922 y(That)31 b(means)g(that)g(ev)n(ery)f(IO)h
(service)f(\(but)i(for)f(allo)r(cation)f(and)h(deallo)r(cation\))g(is)g
(still)515 1021 y(a)n(v)-5 b(ailable.)43 b(Applications)30
b(can)g(k)n(eep)f(on)h(running)g(while)g(the)g(IO)g(bank)g(is)g(b)r
(eing)g(trans-)515 1121 y(ferred,)c(as)f(it)i(happ)r(ened)f(with)h
(memory)e(banks.)36 b(The)26 b(application)f(issuing)h(the)g
Fx(freeze)515 1220 y Fz(is)31 b(exp)r(ected)h(to)g(ev)n(en)n(tually)e
(freeze)h(its)h(p)r(orts)f(to)r(o)g(\(ev)n(en)h(when)g(frozen,)g(IO)f
(p)r(orts)g(will)515 1320 y(remain)c(op)r(erational\).)515
1453 y Fk(h)p Fi(off)p 667 1453 24 4 v 29 w(IOBank::freeze)p
1242 1453 V 31 w(state)i Fj(implementation.)e Fk(i)p
Fq(\021)598 1544 y Fi(//)39 b(Freeze)i(dynamic)g(resource)g(state)f(at)
g(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 1636
y(err_t)f(off_IOBank::freeze_state\(char)46 b(*buf,)40
b(char)g(*&curbuf,)i(size_t)e(&avail,)2128 1727 y(char)g(*&curto,)h
(size_t)f(&toavail,)2128 1818 y(const)g(off_prtl_id_t)i
(&frozen_domain\))598 1910 y({)676 2001 y(\(void\)curto;)g
(\(void\)toavail;)676 2092 y(assert\(valid\(\))h(&&)c(buf)h(&&)g
(curbuf\);)676 2183 y(set_domain\(frozen_domain\);)676
2275 y(if)g(\(!::freeze\(io_name,buf,curbuf,)q(avai)q(l\))45
b(||)833 2366 y(!::freeze\(io_url,buf,curbuf,a)q(vail)q(\)\))755
2457 y(return)40 b(ENOSPC;)676 2549 y(return)h(EOK;)598
2640 y(})515 2906 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(implementation)
g(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2997 y
Fi(#include)41 b(<klib/freeze.h>)317 b(//)40 b(for)g(::freeze,)h
(::melt)f(et)g(al.)515 3171 y Fk(h)p Fi(off)p 667 3171
V 29 w(IOBank::melt)p 1164 3171 V 30 w(state)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 3263 y Fi(//)39 b(Restores)i(dynamic)g(resource)g
(state.)598 3354 y(err_t)f(off_IOBank::melt_state\(char)45
b(*&buf,)c(size_t)g(&bsize,)1735 3445 y(char)f(*&from,)h(size_t)g
(&size,)1735 3537 y(const)g(off_prtl_id_t)h(&melted_domain\))598
3628 y({)676 3719 y(assert\(valid\(\))h(&&)c(buf\);)676
3811 y(\(void\)from;)j(\(void\)size;)676 3902 y
(io_name=::melt\(io_name,buf,b)q(size\))q(;)676 3993
y(io_url=::melt\(io_url,buf,bsi)q(ze\);)676 4085 y
(set_domain\(melted_domain\);)676 4176 y(return)f(EOK;)598
4267 y(})1885 5255 y Fz(299)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
300 301 bop 515 523 a FA(F)-8 b(reezing)31 b(IO)h(p)s(orts)515
676 y Fz(IO)27 b(p)r(orts)g(can)g(also)g(b)r(e)h(frozen.)36
b(W)-7 b(e)28 b(need)g(to)f(implemen)n(t)h(only)g(these)f(metho)r(ds:)
515 786 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 786 24 4 v 29 w(IOPort)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 877 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 969 y(virtual)g(err_t)f
(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h(const;)598
1243 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1334 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 1425 y(//)f(Restores)i(dynamic)g
(resource)g(state.)515 1564 y Fk(h)p Fi(off)p 667 1564
V 29 w(IOPort::copy)p 1164 1564 V 30 w(state)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 1655 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 1746 y(err_t)f
(off_IOPort::copy_state\(char)45 b(*&curto,)d(size_t)e(&toavail\))h
(const)598 1838 y({)676 1929 y(assert\(valid\(\)\);)676
2020 y(if)f(\(curto\){)755 2112 y(if)f(\(toavail<sizeof\(*this\)\))833
2203 y(return)i(ENOSPC;)755 2294 y
(assert\(\(\(off_IOPort*\)curto\)->va)q(lid\()q(\)\);)755
2386 y(*\(off_IOPort*\)curto)i(=)d(*this;)755 2477 y(curto)g(+=)g
(sizeof\(*this\);)755 2568 y(toavail-=sizeof\(*this\);)676
2660 y(})676 2751 y(return)h(EOK;)598 2842 y(})639 3062
y Fz(Note)28 b(ho)n(w)g(in)g(this)g(one)g(w)n(e)f(tak)n(e)g(care)g
(that)h Fx(io)p 2177 3062 27 4 v 31 w(bank)e Fz(is)i(not)g(a\013ected)g
(b)n(y)g(the)g(state)515 3161 y(restore.)515 3271 y Fk(h)p
Fi(off)p 667 3271 24 4 v 29 w(IOPort::restore)p 1281
3271 V 31 w(state)h Fj(implementation.)e Fk(i)p Fq(\021)598
3362 y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 3454 y(err_t)f(off_IOPort::restore_state\(cha)q
(r)45 b(*&buf,)c(size_t)f(&bsize\))598 3545 y({)676 3636
y(off_IOPort)i(*other=\(off_IOPort*\)buf;)676 3728 y
(assert\(valid\(\)\);)676 3819 y(if)e(\(buf\){)755 3910
y(off_IOBank)h(*bank=io_bank;)755 4002 y(if)e(\(bsize)i(<)e
(sizeof\(*this\)\){)833 4093 y(return)i(EINVAL;)755 4184
y(})755 4276 y(assert\(other->valid\(\)\);)755 4367 y(*this=*other;)755
4458 y(io_bank=bank;)755 4550 y(buf+=sizeof\(*this\);)755
4641 y(bsize-=sizeof\(*this\);)676 4732 y(})676 4824
y(return)g(EOK;)598 4915 y(})1885 5255 y Fz(300)p eop
PStoPSsaved restore
%%Page: (302,303) 152
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
301 302 bop 515 523 a Fn(4.2.6)112 b(Dumping)37 b(IO)g(p)s(orts)515
676 y Fz(T)-7 b(o)27 b(dump)h(an)g(IO)f(bank)g(w)n(e)g(use)h(this)g(op)
r(erator.)515 793 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 793 24 4 v 29 w(IOBank)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 884 y Fi(//)39 b(Dumps)i(iobank)f(state.)598
975 y(friend)g(OStr)g(&operator<<\(OStr)j(&s,)79 b(off_IOBank)42
b(&io\);)515 1133 y Fk(h)p Fi(off)p 667 1133 V 29 w(IOBank::operator<<)
31 b Fj(implementation.)d Fk(i)o Fq(\021)598 1224 y Fi(//)39
b(Dumps)i(iobank)f(state.)598 1316 y(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_IOBank)41 b(&io\))598 1407 y({)676 1498 y(s)f(<<)f
(*\(off_HWCompResource*\)&io;)676 1590 y(s)h(<<)f("name=")i(<<)f
(io.nameof\(\))i(<<)d(")h(url=")g(<<)g(io.get_url\(\))i(<<)d(nl;)676
1681 y(s)h(<<)f("first=")i(<<)f(fmt\("\04508x",io.get_first\(\)\))45
b(<<)872 1772 y("last=")80 b(<<)40 b(fmt\("\04508x",io.get_last\(\)\))
84 b(<<)872 1863 y("\045d)40 b(")157 b(<<)40 b(io.get_nports\(\))j(<<)c
(nl;)676 1955 y(for)h(\(vm_offset_t)i(p=io.get_first\(\);)h(p)d(<)f
(io.get_last\(\);)j(p++\))755 2046 y(if)d
(\(\(io+p\)->get_domain\(\)!=OFF_P)q(RTL_)q(NULL)q(\))833
2137 y(s)h(<<)f(fmt\("\04505x)j(",p\))e(<<)f(\(io+p\)->get_domain\(\))
44 b(<<)c(nl;)676 2320 y(return)h(s;)598 2411 y(})515
2677 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2768 y Fi(#include)41
b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f(al.)639
2910 y Fz(There)18 b(is)g(no)g(IO)g(p)r(ort)h(sp)r(eci\014c)f(stu\013)h
(to)f(b)r(e)h(dump)r(ed,)i(th)n(us)e(w)n(e)f(rely)g(on)g(the)g
Fx(HWResUnit)515 3009 y Fz(\\)p Fx(<<)p Fz(")26 b(op)r(erator)f(to)j
(dump)g(IO)f(p)r(orts.)515 3242 y Fn(4.2.7)112 b(Input/Output)38
b(for)f(plain)g(users)515 3395 y Fz(Users)27 b(ma)n(y)f(access)h(IO)g
(p)r(orts)g(using)g(these)h(wrapp)r(ers.)515 3528 y Fk(h)p
Fj(O\013)f(IO)g(b)l(ank)h(for)g(users.)g Fk(i)p Fq(\021)598
3619 y Fi(class)40 b(off_uIOBank)i(:)d(public)i(off_uHWCompResource)i
({)598 3710 y(public:)598 3802 y(#ifdef)d(__KERNEL__)676
3893 y(off_uIOBank\(off_IOBank)k(*r\):)d(off_uHWCompResource\(r\))j
({;})676 3984 y(off_uIOBank\(off_IOBank)g(&r\):)d
(off_uHWCompResource\(&r\))j({;})598 4076 y(#endif)676
4167 y(off_uIOBank\(void\))f({;})676 4258 y(off_uIOBank\(const)g
(off_id_t)e(&id\):)g(off_uHWCompResource\(id\))j({;})598
4441 y(#ifndef)d(__KERNEL__)676 4532 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)i(for)e(users)i(metho)l(ds.)g Fk(i)598
4715 y Fi(#endif)598 4898 y(};)1885 5255 y Fz(301)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
302 303 bop 639 523 a Fz(IO)27 b(banks)g(pro)n(vide:)515
689 y FA(allo)s(c)41 b Fz(Allo)r(cates)27 b(an)g(IO)g(p)r(ort.)37
b(Receiv)n(es:)822 855 y Fq(\017)k Fz(The)28 b(iden)n(ti\014er)f(for)g
(the)h(IO)f(p)r(ort)h Fx(at)p Fz(.)822 988 y Fq(\017)41
b Fz(Protection)26 b(for)h(the)h(p)r(ort)g(b)r(eing)f(allo)r(cated)g
Fx(p)p Fz(.)822 1121 y Fq(\017)41 b Fz(Domain)27 b(for)g(the)h(p)r(ort)
g(b)r(eing)g(allo)r(cated)e Fx(domain)p Fz(.)822 1254
y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h
(domain)f Fx(dr)p Fz(.)822 1386 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(write)i(for)f(the)h(IO)f(bank)g
Fx(r)p Fz(.)722 1519 y Fk(h)p Fj(O\013)g(IO)g(b)l(ank)i(for)e(users)i
(metho)l(ds.)g Fk(i)p Fq(\021)805 1611 y Fi(//)40 b(Allocates)h(an)f
(IO)g(port)805 1702 y(off_uIOPort)i(allocat\(off_io_id_t)i(at,)1511
1793 y(off_Protection)f(p,)1511 1885 y(off_prtl_id_t)82
b(domain,)1511 1976 y(off_Rights)42 b(dr,)1511 2067 y(off_Rights)g
(r\){)884 2159 y(off_iobank_alloc_req)i(req\(at,p,domain,dr,r\);)884
2250 y(off_iobank_alloc_rep)g(rep;)884 2341 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2433 y(if)f(\(err)i(||)e
(rep.m_err\))962 2524 y(errno=\(err\)?err:rep.m_err;)884
2615 y(return)h(rep.res;)805 2707 y(})722 2914 y Fk(h)p
Fj(O\013)27 b(IO)g(b)l(ank)i(messages.)g Fk(i)o Fq(\021)805
3005 y Fi(#define)41 b(OFF_MSG_IOBANK_ALLOC)j(0x01f)884
3097 y(struct)c(off_iobank_alloc_req:)k(public)d(off_KernReq)h({)962
3188 y(off_io_id_t)160 b(iid;)962 3279 y(off_Protection)43
b(prot;)962 3371 y(off_prtl_id_t)82 b(dom;)962 3462 y(off_Rights)199
b(dright;)962 3553 y(off_iobank_alloc_req\(off_io_)q(id_t)46
b(at,)1786 3645 y(off_Protection)c(p,)1825 3736 y(off_prtl_id_t)82
b(domain,)1825 3827 y(off_Rights)42 b(dr,)1825 3919 y(off_Rights)g
(r\):)1041 4010 y(iid\(at\),prot\(p\),dom\(domain\),dr)q(ight\()q
(dr\),)1041 4101 y(off_KernReq\(OFF_MSG_IOBANK_ALL)q(OC,r\))k({;})884
4193 y(};)884 4284 y(struct)40 b(off_iobank_alloc_rep:)k(public)d
(off_KernRep)h({)962 4375 y(off_io_id_t)g(res;)962 4467
y(off_iobank_alloc_rep\(err_t)j(r=0\))c(:)e(off_KernRep\(r\))j({;})884
4558 y(};)1885 5255 y Fz(302)p eop
PStoPSsaved restore
%%Page: (304,305) 153
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
303 304 bop 722 523 a Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)i(for)e(users)i
(in-kernel)g(metho)l(ds.)f Fk(i)p Fq(\021)884 614 y Fi(void)40
b(allocat\(off_iobank_alloc_req)46 b(*m,off_iobank_alloc_rep)83
b(*r\))884 706 y({)962 797 y(off_IOPort)42 b(*s;)962
888 y(s=new\(\(off_IOBank*\)w_r,m->ii)q(d\))j
(off_IOPort\(m->prot,m->dom\);)962 980 y(if)40 b(\(!s\))1041
1071 y(r->m_err=EAGAIN;)962 1162 y(r->res=\(s\)?s->get_id\(\):OFF_I)q
(D_NU)q(LL;)884 1254 y(})515 1494 y FA(free)h Fz(Deallo)r(cates)27
b(an)g(IO)h(p)r(ort.)36 b(Receiv)n(es:)822 1660 y Fq(\017)41
b Fz(The)28 b(iden)n(ti\014er)f(of)h(the)g(p)r(ort)f(b)r(eing)h
(released)e Fx(s)p Fz(.)822 1793 y Fq(\017)41 b Fz(Delete)28
b(access)e(righ)n(ts)h(for)g(the)h(p)r(ort)g Fx(r)p Fz(.)722
1926 y Fk(h)p Fj(O\013)f(IO)g(b)l(ank)i(for)e(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)805 2017 y Fi(//)40 b(Deallocates)i(a)d(port)805
2109 y(void)h(free\()h(off_uIOPort)h(s,)d(off_Rights)j(r\){)884
2200 y(off_iobank_free_req)h(req\(s.get_id\(\),r\);)884
2291 y(off_iobank_free_rep)g(rep;)884 2383 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2474 y(if)f(\(err)i(||)e
(rep.m_err\))962 2565 y(errno=\(err\)?err:rep.m_err;)805
2657 y(})722 2864 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)i(messages.)g
Fk(i)o Fz(+)p Fq(\021)805 2956 y Fi(#define)41 b(OFF_MSG_IOBANK_FREE)j
(0x03f)884 3047 y(struct)c(off_iobank_free_req:)k(public)d(off_KernReq)
g({)962 3138 y(off_io_id_t)81 b(id;)962 3230 y
(off_iobank_free_req\(off_io_i)q(d_t)46 b(s,)39 b(off_Rights)j(r\):)e
(id\(s\),)1041 3321 y(off_KernReq\(OFF_MSG_IOBANK_FRE)q(E,r\))46
b({;})884 3412 y(};)884 3504 y(struct)40 b(off_iobank_free_rep:)k
(public)d(off_KernRep)g({)962 3595 y(off_iobank_free_rep\(err_t)k
(r=0\))40 b(:)g(off_KernRep\(r\))i({;})884 3686 y(};)722
3894 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)i(for)e(users)i(in-kernel)g
(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)884 3985 y Fi(void)40
b(free\(off_iobank_free_req)45 b(*m,off_iobank_free_rep)83
b(*r\))884 4076 y({)962 4168 y(\(void\)r;)962 4259 y(if)40
b(\(!\(\(off_IOBank*\)w_r\)->is_loca)q(l\(m->)q(id\)\))1041
4350 y(panic\("iobank:)i(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)962 4442 y(delete)h
(\(\(*\(off_IOBank*\)w_r\)+m->id\);)884 4533 y(})1885
5255 y Fz(303)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
304 305 bop 515 523 a Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(for)g(users)h
(in-kernel.)f Fk(i)o Fq(\021)598 614 y Fi(class)40 b(off_kIOBank)i(:)d
(public)i(off_kHWCompResource)i({)598 706 y(public:)676
797 y(static)e(err_t)f(handler\(const)i(off_shtl_id_t)h(&sender,)1500
888 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 980 y(off_KernReq)g(*m,)
e(off_KernRep)h(*r\);)676 1162 y(virtual)g(err_t)f(handle\(const)i
(off_shtl_id_t)h(&sender,)1500 1254 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 1345 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))f({)755
1436 y(return)g(off_kHWCompResource::handle\()q(send)q(er,ms)q(z,rs)q
(z,m,r)q(\);)676 1528 y(})676 1710 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)i(for)e(users)i(in-kernel)g(metho)l(ds.)f
Fk(i)598 1802 y Fi(};)1885 5255 y Fz(304)p eop
PStoPSsaved restore
%%Page: (306,307) 154
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
305 306 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kIOBank::handler)31 b Fj(implementation.)c Fk(i)p
Fq(\021)598 614 y Fi(err_t)40 b(off_kIOBank::handler\(const)45
b(off_shtl_id_t)d(&sender,)1657 706 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)1657 797 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598
888 y({)676 980 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(do_debug\(printf\("iobank[\045x]")q(,m->m)q(_typ)q(e\)\);)676
1345 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)755 1436
y(off_io_id_t)h(s=\(\(off_ObjKernReq*\)m\)->obj)q(;)755
1528 y(if)e(\(!nd.get_iobank\(0\).is_local\()q(s\)\))833
1619 y(panic\("iobank:)k(should)d(raise)g(missing,)i(but)d(not)h(yet)g
(implemented."\);)755 1710 y(else)g({)833 1802 y(panic\("io:)i(not)e
(wrapped."\);)755 1893 y(})676 1984 y(})676 2076 y(r->m_err=EOK;)676
2167 y(switch\(m->m_type\){)676 2258 y(case)g(OFF_MSG_R_INIT:)755
2350 y(return)g(EOK;)676 2441 y(case)g(OFF_MSG_IOBANK_ALLOC:)755
2532 y(if)f(\(!nd.get_iobank\(0\).access_gr)q(ante)q(d\(OF)q(F_OP_)q
(W,m-)q(>m_ri)q(ghts)q(\)\))833 2623 y(r->m_err=)i(EPERM;)755
2715 y(else)f(if)f(\(msz!=sizeof\(off_iobank_all)q(oc_r)q(eq\))45
b(||)40 b(rsz!=sizeof\(off_iobank_alloc_)q(rep\))q(\))833
2806 y(r->m_err=)h(EINVAL;)755 2897 y(else)f({)833 2989
y(kiobank.allocat\(\(off_iobank_a)q(lloc)q(_req)q(*\)m,\()q(off_)q
(ioban)q(k_al)q(loc_)q(rep*\))q(r\);)755 3080 y(})755
3171 y(return)g(EOK;)637 3263 y(case)g(OFF_MSG_IOBANK_FREE:)755
3354 y(if)f(\(msz!=sizeof\(off_iobank_free)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_iobank_free_re)q(p\)\))833
3445 y(r->m_err=EINVAL;)755 3537 y(else)g({)833 3628
y(kiobank.free\(\(off_iobank_free)q(_req)q(*\)m,)q(\(off_)q(ioba)q
(nk_fr)q(ee_r)q(ep*\))q(r\);)755 3719 y(})755 3811 y(return)g(EOK;)676
3902 y(default:)755 3993 y(return)g(\(\(off_kHWCompResource*\)&kiob)q
(ank\))q(->han)q(dle\()q(sende)q(r,ms)q(z,rs)q(z,m,r)q(\);)676
4085 y(})598 4176 y(})515 4442 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4533 y
Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(ENTRY)515
4707 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 4799 y Fi(#include)41 b(<prtl/ex.h>)473
b(//)40 b(for)g(ENTRY)1885 5255 y Fz(305)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
306 307 bop 515 523 a Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)h(for)g(users.)
g Fk(i)p Fq(\021)598 614 y Fi(class)40 b(off_uIOPort:)i(public)f
(off_uHWResUnit)h({)598 706 y(public:)598 797 y(#ifdef)e(__KERNEL__)676
888 y(off_uIOPort\(off_IOPort)k(*r\):)d(off_uHWResUnit\(r\))i({;})676
980 y(off_uIOPort\(off_IOPort)h(&r\):)d(off_uHWResUnit\(&r\))i({;})598
1071 y(#endif)676 1162 y(off_uIOPort\(void\))g({;})676
1254 y(off_uIOPort\(const)g(off_id_t)e(&id\):)g(off_uHWResUnit\(id\))i
({;})598 1436 y(#ifndef)e(__KERNEL__)676 1528 y Fk(h)p
Fj(IO)27 b(op)l(er)l(ations.)i Fk(i)598 1619 y Fi(#endif)598
1802 y(};)515 1976 y Fk(h)p Fj(O\013)e(IO)g(p)l(ort)h(for)g(users)h
(in-kernel.)f Fk(i)p Fq(\021)598 2067 y Fi(class)40 b(off_kIOPort)i(:)d
(public)i(off_kHWResUnit)h({)598 2159 y(public:)676 2250
y(off_kIOPort\(off_IOPort)i(*r=NULL\))d(:)f(off_kHWResUnit\(r\))j({};)
676 2341 y(virtual)e(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)
1500 2433 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500
2524 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)598 2615
y(};)515 2881 y Fk(h)p Fi(off)p 667 2881 24 4 v 29 w(kIOPort::handle)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 2972 y Fi(err_t)40
b(off_kIOPort::handle\(const)45 b(off_shtl_id_t)d(&sender,)1539
3064 y(vm_size_t)f(msz,)g(vm_size_t)g(rsz,)1539 3155
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 3246 y({)676
3337 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i(<<)f(")f
(";)676 3429 y(//kcout)i(<<fmt\("msg@\04508x)i(",\(vm_offset_t\)m\))g
(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)676 3520
y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 3611 y
(switch\(m->m_type\){)676 3703 y(case)h(OFF_MSG_R_INIT:)755
3794 y(return)g(EOK;)676 3885 y(default:)755 3977 y(return)g
(off_kHWResUnit::handle\(sende)q(r,ms)q(z,rsz)q(,m,r)q(\);)676
4068 y(})598 4159 y(})1885 5255 y Fz(306)p eop
PStoPSsaved restore
%%Page: (308,309) 155
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
307 308 bop 515 523 a Fn(4.2.8)112 b(Input/Output)38
b Fd(C)8 b FC(++)38 b Fn(source)f(\014les)515 676 y Fz(I/O)26
b(bank)i(co)r(de)f(is)h(k)n(ept)f(in)h Fx(hw/IOBank.h)23
b Fz(and)28 b Fx(hw/IOBank.C)p Fz(.)515 809 y Fk(h)p
Fj(IOBank.h*)11 b Fk(i)o Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_IOBANK_H)598 1083
y(#define)g(__OFF_IOBANK_H)h(1)598 1266 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)h(dep)l(endencies.)h Fk(i)598 1540 y Fi(#ifdef)40
b(__KERNEL__)598 1631 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank.)h
Fk(i)598 1722 y Fi(#endif)40 b(//)g(__KERNEL__)598 1905
y(#include)h(<prtl/ex.h>)598 1996 y(#include)g(<hw/uIOBank.h>)598
2270 y(#endif)f(//)g(__OFF_IOBANK_H)515 2445 y Fk(h)p
Fj(IOBank.C*)11 b Fk(i)o Fq(\021)598 2536 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2719 y Fi(#include)41 b(<hw/IOBank.h>)434 b(//)40
b(Exported)h(interface)598 2810 y Fk(h)p Fj(O\013)27
b(IO)g(b)l(ank)h(implementation)g(dep)l(endencies.)h
Fk(i)598 2993 y(h)p Fj(O\013)e(IO)g(b)l(ank)h(static)h(memb)l(ers.)f
Fk(i)598 3175 y(h)p Fi(off)p 750 3175 24 4 v 29 w(IOBank::alloc)i
Fj(and)e Fi(free)g Fj(implementation.)g Fk(i)598 3267
y(h)p Fi(off)p 750 3267 V 29 w(IOBank::start)i Fj(implementation.)d
Fk(i)598 3358 y(h)p Fi(off)p 750 3358 V 29 w(IOBank::get)p
1208 3358 V 30 w(iosize)i Fj(implementation.)f Fk(i)598
3449 y(h)p Fi(off)p 750 3449 V 29 w(IOBank::get)p 1208
3449 V 30 w(url)g Fj(implementation.)g Fk(i)598 3541
y(h)p Fi(off)p 750 3541 V 29 w(IOBank::nameof)i Fj(implementation.)e
Fk(i)598 3632 y(h)p Fi(off)p 750 3632 V 29 w(IOBank::cleanup)i
Fj(implementation.)e Fk(i)598 3723 y(h)p Fi(off)p 750
3723 V 29 w(IOBank::copy)p 1247 3723 V 31 w(state)g Fj(implementation.)
g Fk(i)598 3815 y(h)p Fi(off)p 750 3815 V 29 w(IOBank::restore)p
1364 3815 V 31 w(state)h Fj(implementation.)e Fk(i)598
3906 y(h)p Fi(off)p 750 3906 V 29 w(IOBank::can)p 1208
3906 V 30 w(melt)i Fj(implementation.)e Fk(i)598 3997
y(h)p Fi(off)p 750 3997 V 29 w(IOBank::freeze)p 1325
3997 V 31 w(state)i Fj(implementation.)e Fk(i)598 4088
y(h)p Fi(off)p 750 4088 V 29 w(IOBank::melt)p 1247 4088
V 31 w(state)h Fj(implementation.)g Fk(i)598 4180 y(h)p
Fi(off)p 750 4180 V 29 w(IOBank::get)p 1208 4180 V 30
w(navigator)i Fj(implementation.)d Fk(i)598 4271 y(h)p
Fi(off)p 750 4271 V 29 w(IOBank::get)p 1208 4271 V 30
w(inspector)j Fj(implementation.)d Fk(i)598 4362 y(h)p
Fi(off)p 750 4362 V 29 w(IOBank::operator<<)k Fj(implementation.)d
Fk(i)1885 5255 y Fz(307)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
308 309 bop 639 523 a Fz(I/O)27 b(p)r(ort)g(co)r(de)h(is)f(found)h(at)g
Fx(hw/IOPort.h)23 b Fz(and)k Fx(hw/IOPort.C)515 656 y
Fk(h)p Fj(IOPort.h*)11 b Fk(i)p Fq(\021)598 747 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 839 y Fi(#ifndef)41 b(__OFF_IOPORT_H)598
930 y(#define)g(__OFF_IOPORT_H)h(1)598 1112 y Fk(h)p
Fj(O\013)27 b(IO)g(p)l(ort)i(dep)l(endencies.)g Fk(i)598
1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort.)h Fk(i)598 1478 y Fi(#endif)40 b(//)g(__KERNEL__)598
1660 y(#include)h(<prtl/ex.h>)598 1752 y(#include)g(<hw/uIOPort.h>)598
2026 y(#endif)f(//)g(__OFF_IOPORT_H)515 2200 y Fk(h)p
Fj(IOPort.C*)11 b Fk(i)p Fq(\021)598 2291 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2474 y Fi(#include)41 b(<hw/IOPort.h>)395 b(//)40
b(Exported)h(interface.)598 2565 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort)i(implementation)e(dep)l(endencies.)j
Fk(i)598 2748 y(h)p Fj(O\013)d(IO)g(p)l(ort)i(static)f(memb)l(ers.)g
Fk(i)598 2931 y(h)p Fi(off)p 750 2931 24 4 v 29 w(IOPort::off)p
1208 2931 V 30 w(IOPort)h Fj(implementation.)f Fk(i)598
3022 y(h)p Fi(off)p 750 3022 V 29 w(IOPort::operator)42
b(new/delete)30 b Fj(implementation.)e Fk(i)598 3113
y(h)p Fi(off)p 750 3113 V 29 w(IOPort::copy)p 1247 3113
V 31 w(state)g Fj(implementation.)g Fk(i)598 3205 y(h)p
Fi(off)p 750 3205 V 29 w(IOPort::restore)p 1364 3205
V 31 w(state)h Fj(implementation.)e Fk(i)598 3296 y(h)p
Fi(off)p 750 3296 V 29 w(IOPort::get)p 1208 3296 V 30
w(url)p 1355 3296 V 29 w(holder)i Fj(implementation.)f
Fk(i)598 3387 y(h)p Fi(off)p 750 3387 V 29 w(IOPort::get)p
1208 3387 V 30 w(inspector)i Fj(implementation.)d Fk(i)639
3620 y Fz(The)19 b(IO)f(p)r(ort)g(allo)r(cator)f(can)g(b)r(e)i(found)g
(in)g Fx(hw/IOAllocator.)o(h)12 b Fz(and)19 b Fx(hw/IOAllocator.)o(C)p
Fz(.)515 3753 y Fk(h)p Fj(IO)n(A)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)p Fq(\021)598 3844 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3935 y Fi(#ifndef)41 b(__OFF_IO_ALLOCATOR_H)598 4027
y(#define)g(__OFF_IO_ALLOCATOR_H)i(1)598 4209 y Fk(h)p
Fj(O\013)27 b(IO)g(p)l(ort)i(al)t(lo)l(c)l(ator)f(dep)l(endencies.)h
Fk(i)598 4392 y Fi(#ifdef)40 b(__KERNEL__)598 4575 y
Fk(h)p Fj(O\013)27 b(linkable)g(IO)g(p)l(ort.)h Fk(i)598
4666 y(h)p Fj(O\013)f(IO)g(p)l(ort)i(al)t(lo)l(c)l(ator.)f
Fk(i)598 4757 y Fi(#endif)40 b(//)g(__KERNEL__)598 4940
y(#endif)g(//)g(__OFF_IO_ALLOCATOR_H)1885 5255 y Fz(308)p
eop
PStoPSsaved restore
%%Page: (310,311) 156
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
309 310 bop 515 523 a Fk(h)p Fj(IO)n(A)n(l)t(lo)l(c)l(ator.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<hw/IOAllocator.h>)200 b(//)40 b(exported)h(interface)
598 980 y Fk(h)p Fj(O\013)27 b(IO)g(p)l(ort)i(al)t(lo)l(c)l(ator)f
(static)h(memb)l(ers.)f Fk(i)515 1245 y(h)p Fj(uIOBank.h*)11
b Fk(i)p Fq(\021)598 1337 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1519 y(h)p Fj(O\013)f(IO)g(b)l(ank)h(messages.)h Fk(i)598
1611 y(h)p Fj(O\013)e(IO)g(b)l(ank)h(for)g(users.)g Fk(i)515
1785 y(h)p Fj(kIOBank.h*)11 b Fk(i)p Fq(\021)598 1876
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2059 y Fi(#include)41 b(<hw/IOBank.h>)238
b(//)40 b(Exported)h(interface.)598 2150 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 2242 y(#include)h(<klib/kResource.h>)598
2333 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
2424 y(#include)h(<string.h>)598 2607 y(#ifndef)g(__OFF_KIO_BANK_H)598
2698 y(#define)g(__OFF_KIO_BANK_H)h(1)598 2790 y(#ifdef)e(__KERNEL__)
598 2972 y Fk(h)p Fj(O\013)27 b(IO)g(b)l(ank)h(for)g(users)h
(in-kernel.)f Fk(i)598 3155 y Fi(extern)40 b(off_kIOBank)i(kiobank;)598
3337 y(#endif)e(//)g(__KERNEL__)598 3429 y(#endif)g(//)g
(__OFF_KIO_BANK_H)515 3603 y Fk(h)p Fj(kIOBank.C*)11
b Fk(i)o Fq(\021)598 3694 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3877 y Fi(#include)41 b(<hw/IOBank.h>)238 b(//)40 b(Exported)h
(interface.)598 3968 y(#include)g(<klib/str.h>)277 b(//)40
b(for)g(kcout)598 4060 y(#include)h(<prtl/ex.h>)473 b(//)40
b(for)g(XDT{Req|Rep})598 4151 y(#include)h(<string.h>)598
4242 y(#include)g(<node/Node.h>)598 4425 y(#include)g(<hw/kIOBank.h>)
598 4516 y(#include)g(<klib/mdep/debug.h>)598 4699 y(off_kIOBank)g
(kiobank;)598 4882 y Fk(h)p Fi(off)p 750 4882 24 4 v
29 w(kIOBank::handler)31 b Fj(implementation.)c Fk(i)1885
5255 y Fz(309)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
310 311 bop 515 523 a Fk(h)p Fj(uIOPort.h*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y(h)p Fj(O\013)f(IO)g(p)l
(ort)i(for)e(users.)i Fk(i)515 847 y(h)p Fj(kIOPort.h*)11
b Fk(i)p Fq(\021)598 938 y Fi(//)598 1029 y(//)39 b(===)h(DO)g(NOT)g
(READ)g(OR)g(MODIFY)g(THIS)g(FILE)h(===)598 1121 y(//)598
1212 y(//)e(This)i(is)e(a)h(source)g(file)g(generated)i(by)d(the)h
(noweb)h(literate)598 1303 y(//)e(programming)j(tool.)598
1395 y(//)598 1486 y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g
(literate)h(source)f(code)g(instead.)598 1577 y(//)598
1760 y(#include)h(<hw/IOPort.h>)238 b(//)40 b(Exported)h(interface.)598
1851 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
1943 y(#include)h(<klib/kResource.h>)598 2034 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 2125 y(#include)h(<string.h>)598
2308 y(#ifndef)g(__OFF_KIOPORT_H)598 2399 y(#define)g(__OFF_KIOPORT_H)h
(1)598 2491 y(#ifdef)e(__KERNEL__)598 2673 y Fk(h)p Fj(O\013)27
b(IO)g(p)l(ort)i(for)e(users)i(in-kernel.)f Fk(i)598
2856 y Fi(#endif)40 b(//)g(__KERNEL__)598 2947 y(#endif)g(//)g
(__OFF_KIOPORT_H)515 3362 y Fk(h)p Fj(kIOPort.C*)11 b
Fk(i)p Fq(\021)598 3454 y Fi(//)598 3545 y(//)39 b(===)h(DO)g(NOT)g
(READ)g(OR)g(MODIFY)g(THIS)g(FILE)h(===)598 3636 y(//)598
3728 y(//)e(This)i(is)e(a)h(source)g(file)g(generated)i(by)d(the)h
(noweb)h(literate)598 3819 y(//)e(programming)j(tool.)598
3910 y(//)598 4002 y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g
(literate)h(source)f(code)g(instead.)598 4093 y(//)598
4276 y(#include)h(<hw/IOPort.h>)238 b(//)40 b(Exported)h(interface.)598
4367 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
4458 y(#include)h(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
4550 y(#include)h(<string.h>)598 4732 y(#include)g(<hw/kIOPort.h>)598
4915 y Fk(h)p Fi(off)p 750 4915 24 4 v 29 w(kIOPort::handle)30
b Fj(implementation.)e Fk(i)1885 5255 y Fz(310)p eop
PStoPSsaved restore
%%Page: (312,313) 157
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
311 312 bop 515 523 a Fn(4.2.9)112 b(IO)37 b(banks)i(for)f(ix86)e
(based)j(arc)m(hitectures)515 676 y Fz(Mac)n(hine)c(dep)r(enden)n(t)h
(IO)f(banks)g(are)g(simpler)g(than,)i(although)e(similar)g(to,)i(mac)n
(hine)515 776 y(dep)r(enden)n(t)28 b(memory)f(banks.)515
909 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(IO)e(b)l(ank.)h
Fk(i)p Fq(\021)598 1000 y Fi(class)40 b(off_mdepIOBank)j({)598
1091 y(private:)676 1183 y(//)d(Things)g(known)h(by)f(the)f(boot)i
(procedure)g(about)f(this)g(IO)g(bank)676 1274 y(//)676
1365 y(unsigned8_t)81 b(io_flags;)316 b(//)40 b(capabilities)i
(\(IF_IOM,IF_USR\))676 1457 y(unsigned8_t)81 b(io_mat;)394
b(//)40 b(Mean)g(IO)g(time.)g(\(not)g(very)g(useful\).)676
1548 y(vm_size_t)159 b(io_iosz[OFF_NIOSZ_MAX];)45 b(//)39
b(IO)h(port)g(sizes.)598 1639 y(public:)676 1731 y(unsigned8_t)i
(get_flags\(void\))h(const)d({)f(return)i(io_flags;)g(})676
1822 y(vm_offset_t)h(get_first\(void\))h(const)d({)f(return)i(0;)f(})
676 1913 y(vm_offset_t)i(get_last\(void\))82 b(const)40
b({)f(return)i(OFF_MDEP_NIOP_MAX;)i(})676 2005 y(vm_offset_t)f
(get_nports\(void\)const)i({)39 b(return)i(OFF_MDEP_NIOP_MAX;)i(})676
2096 y(vm_offset_t)f(get_mat\(void\))121 b(const)40 b({)f(return)i
(io_mat;)g(})676 2187 y(vm_size_t)120 b(get_iosz\(natural_t)43
b(llimit\))e(const)f({return)h(io_iosz[llimit];)i(})676
2279 y(static)e(vm_size_t)g(get_iosz\(void\))356 b({)40
b(return)g(1;)g(})676 2461 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 2461 24 4 v 29 w(mdepIOBank)p Fj(.)i
Fk(i)637 2553 y Fi(};)515 2727 y Fk(h)p Fj(O\013)e(machine)h(dep)l
(endent)h(IO)e(b)l(ank)i(dep)l(endencies.)g Fk(i)p Fq(\021)598
2818 y Fi(#include)41 b(<klib/limits.h>)317 b(//)40 b(for)g
(OFF_NIOSZ_MAX)598 2910 y(#include)h(<flux/types.h>)356
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)639
3051 y Fz(On)28 b(In)n(tels,)f(w)n(e)g(ha)n(v)n(e)g(supp)r(ort)g(for)g
(just)h(a)g(single)f(IO)g(bank.)515 3167 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3167 V 29 w(mdepIOBank)p
Fj(.)i Fk(i)p Fq(\021)598 3258 y Fi(static)40 b(natural_t)i
(how_many\(void\))356 b({)39 b(return)i(1;)f(})639 3383
y Fz(The)d(n)n(um)n(b)r(er)g(of)f(IO)h(p)r(orts)f(and)h(allo)r(catable)
f(IO)g(p)r(orts)g(are)g(also)g(\014xed)h(for)f(In)n(tel)515
3482 y(mac)n(hines.)515 3599 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l
(endent)h(IO)e(b)l(ank)i(size.)e Fk(i)p Fq(\021)598 3690
y Fi(const)40 b(vm_offset_t)i(OFF_MDEP_NIOP_MAX=65535;)598
3781 y(const)e(vm_offset_t)i(OFF_MDEP_NAIOP_MAX=32;)639
3906 y Fz(No)n(w)n(ada)n(ys,)26 b(the)i(constructor)e(of)i
Fx(off)p 1867 3906 27 4 v 30 w(mdepIOBank)c Fz(will)k(set)f
(prede\014ned)h(v)-5 b(alues)27 b(no)515 4005 y(matter)g(the)h(bank)f
(n)n(um)n(b)r(er.)515 4122 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 4122 24 4 v 29 w(mdepIOBank)p Fj(.)i
Fk(i)p Fz(+)o Fq(\021)598 4213 y Fi(off_mdepIOBank\(natural_t)44
b(number\);)1885 5255 y Fz(311)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
312 313 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepIOBank::off)p 1281 523 V 31 w(mdepIOBank)30
b Fj(implementation.)d Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Returns)i(machine)g(dependent)g(information)h(about)e(the)g(IO)g
(bank)g(#n)598 706 y(off_mdepIOBank::off_mdepIOBank)q(\(natu)q(ral_)q
(t)45 b(number\))598 797 y({)676 888 y(\(void\)number;)676
980 y(io_flags=OFF_IF_IOM|OFF_IF_U)q(SR;)676 1071 y(io_mat=128;)676
1162 y(io_iosz[0]=1;)676 1254 y(io_iosz[1]=2;)676 1345
y(io_iosz[2]=4;)676 1436 y(io_iosz[3]=0;)598 1528 y(})639
1760 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(\015ags)f
(used)g(b)r(efore.)515 1876 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)
h(IO)e(b)l(ank)i(\015ag)f(bits.)f Fk(i)p Fq(\021)598
1968 y Fi(//)39 b(flag)i(bits)f(for)g(off_mdepIOBanks.)598
2059 y(//)f(They)i(are)e(compatible)j(with)e(resource)h(flag)f(bits.)
598 2150 y(const)g(unsigned8_t)i(OFF_IF_USR)159 b(=)39
b(0x10;)i(//)f(User-level)h(io?)598 2242 y(const)f(unsigned8_t)i
(OFF_IF_IOM)159 b(=)39 b(0x20;)i(//)f(Supports)h(IO)e(mapping?)639
2457 y Fz(There)28 b(are)f(a)g(couple)h(of)g(static)g(routine)f(whic)n
(h)h(m)n(ust)g(still)g(b)r(e)h(implemen)n(ted,)f(those)515
2557 y(doing)f(actual)g(I/O.)515 2673 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2673 V 29 w(mdepIOBank)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 2765 y Fi(static)40
b(unsigned8_t)81 b(in_b\(const)42 b(vm_size_t)f(p\))157
b({)40 b(return)g(inb\(p\);)h(})598 2856 y(static)f(void)354
b(out_b\(const)42 b(vm_size_t)f(p,)1618 2947 y(const)f(unsigned8_t)i
(b\))d({)h(outb\(p,b\);)h(})598 3039 y(static)f(unsigned16_t)i
(in_w\(const)g(vm_size_t)f(p\))157 b({)40 b(return)g(inw\(p\);)h(})598
3130 y(static)f(void)354 b(out_w\(const)42 b(vm_size_t)f(p,)1618
3221 y(const)f(unsigned16_t)i(b\){)e(outw\(p,b\);)h(})598
3313 y(static)f(unsigned32_t)i(in_l\(const)g(vm_size_t)f(p\))157
b({)40 b(return)g(inl\(p\);)h(})598 3404 y(static)f(void)354
b(out_l\(const)42 b(vm_size_t)f(p,)1618 3495 y(const)f(unsigned32_t)i
(b\){)e(outl\(p,b\);)h(})598 3587 y(static)f(unsigned64_t)i
(in_q\(const)g(vm_size_t)f(p\))157 b({)40 b(return)g(inq\(p\);)h(})598
3678 y(static)f(void)354 b(out_q\(const)42 b(vm_size_t)f(p,)1618
3769 y(const)f(unsigned64_t)i(b\){)e(outq\(p,b\);)h(})515
4018 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(IO)e(b)l(ank)i
(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 4110 y
Fi(#include)41 b(<flux/machine/pio.h>)122 b(//)40 b(for)g(inb,)g(outb,)
g(et)g(al.)1885 5255 y Fz(312)p eop
PStoPSsaved restore
%%Page: (314,315) 158
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
313 314 bop 515 523 a FA(Mac)m(hine)32 b(dep)s(enden)m(t)f(IO)h(banks)g
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 676 y Fz(Mac)n(hine)18
b(dep)r(enden)n(t)h(IO)f(banks)f(are)h(k)n(ept)g(in)h
Fx(hw/mdep/mIOBank)o(.h)12 b Fz(and)18 b Fx(hw/mdep/mIOBank.C)o
Fz(.)515 809 y Fk(h)p Fj(mdep)27 b(mIOBank.h*)11 b Fk(i)p
Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y Fi(#ifndef)41
b(__OFF_MDEP_IOBANK_H)598 1083 y(#define)g(__OFF_MDEP_IOBANK_H)i(1)598
1266 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(IO)e(b)l(ank)i
(dep)l(endencies.)g Fk(i)598 1448 y(h)p Fj(O\013)e(machine)h(dep)l
(endent)h(IO)e(b)l(ank)i(\015ag)f(bits.)f Fk(i)598 1540
y(h)p Fj(O\013)g(machine)h(dep)l(endent)h(IO)e(b)l(ank)i(size.)e
Fk(i)598 1722 y(h)p Fj(O\013)g(machine)h(dep)l(endent)h(IO)e(b)l(ank.)h
Fk(i)598 1996 y Fi(#endif)40 b(//)g(__OFF_MDEP_IOBANK_H)515
2171 y Fk(h)p Fj(mdep)27 b(mIOBank.C*)11 b Fk(i)p Fq(\021)598
2262 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2445 y Fi(#include)41
b(<hw/mdep/mIOBank.h>)239 b(//)40 b(Exported)h(interface.)598
2536 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(IO)e(b)l(ank)i
(dep)l(endencies.)g Fk(i)598 2719 y(h)p Fi(off)p 750
2719 24 4 v 29 w(mdepIOBank::off)p 1364 2719 V 31 w(mdepIOBank)h
Fj(implementation.)d Fk(i)515 3035 y Fr(4.3)135 b(T)-11
b(raps)44 b(and)h(in)l(terrupts)515 3233 y Fn(4.3.1)112
b(Ev)m(en)m(t)37 b(tables)515 3386 y Fz(Both)28 b(traps)g(and)g(in)n
(terrupts)g(are)f(allo)r(cated)h(using)g(p)r(er-pro)r(cessor)d(ev)n(en)
n(t)j(tables.)39 b(Eac)n(h)515 3486 y(pro)r(cessor)28
b(has)i(asso)r(ciated)f(a)h(trap)g(and)g(in)n(terrupt)g(tables.)45
b(T)-7 b(raps)29 b(ma)n(y)h(b)r(e)h(caused)e(b)n(y)515
3586 y(the)f(hardw)n(are)d(or)i(b)n(y)g(the)h Fw(\026)p
Fz(k)n(ernel)f(itself.)37 b(Soft)n(w)n(are)27 b(in)n(terrupts)g(are)f
(also)h(a)n(v)-5 b(ailable.)515 3718 y Fk(h)p Fj(O\013)27
b(event)i(table.)f Fk(i)o Fq(\021)598 3810 y Fi(//)39
b(An)h(event)g(table)598 3901 y(//)598 3992 y(class)g(off_EventTbl)i(:)
e(public)g(off_HWCompResource)j({)598 4084 y(public:)676
4175 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4175 V 29 w(EventTbl)p Fj(.)i Fk(i)598
4266 y Fi(protected:)676 4358 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 4358 V 29 w(EventTbl)p
Fj(.)i Fk(i)598 4449 y Fi(};)1885 5255 y Fz(313)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
314 315 bop 639 523 a Fz(Ev)n(en)n(t)27 b(tables)g(cannot)g(b)r(e)h
(instan)n(tiated,)f(the)h(only)f(ha)n(v)n(e)f(a)h(pass-b)n(y)f
(constructor)g(to)515 623 y(initialize)h Fx(HWCompResource)22
b Fz(state.)515 751 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 751 24 4 v 29 w(EventTbl)p Fj(.)i
Fk(i)o Fq(\021)598 843 y Fi(//)39 b(Creates)i(an)f(event)g(table.)598
934 y(off_EventTbl\(const)j(off_Protection)f(&p,)1108
1025 y(const)e(off_prtl_id_t)i(&domain,)1108 1117 y(const)e
(off_prtl_id_t)i(&id,)1108 1208 y(const)e(off_magic_t)i(magic)e(\):)676
1299 y(off_HWCompResource\(p,domain,)q(id,ma)q(gic\))598
1391 y({;})639 1619 y Fz(By)28 b(no)n(w)f(w)n(e)g(ha)n(v)n(e)f(these)i
(dep)r(endencies.)515 1733 y Fk(h)p Fj(O\013)f(event)i(table)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 1824 y Fi(#include)41
b(<klib/ids.h>)473 b(//)40 b(for)g(off_ev_id_t)598 1916
y(#include)h(<klib/HWCompResource.h>)j(//)c(for)g(off_HWCompResource)
598 2007 y(#include)h(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)
598 2098 y(#include)h(<klib/Magic.h>)356 b(//)40 b(for)g(magic)g
(numbers)639 2221 y Fz(There)24 b(are)g(t)n(w)n(o)g(concrete)f(sub)r
(classes)h(of)g(ev)n(en)n(t)g(tables:)36 b(trap)24 b(and)g(in)n
(terrupt)g(tables.)515 2320 y(These)j(ones)h(can)f(b)r(e)i(instan)n
(tiated)f(to)f(op)r(erate)h(on)f(a)h(giv)n(en)f(pro)r(cessor)f(or)h(sh)
n(uttle)h(\(just)515 2420 y(for)g(trap)g(tables\).)41
b(Suc)n(h)29 b(tables)f(use)h(trap)f(and)h(in)n(terrupt)g(allo)r
(cators)d(to)j(allo)r(cate)f(their)515 2520 y(ev)n(en)n(ts.)515
2648 y Fk(h)p Fj(O\013)f(tr)l(ap)i(table.)e Fk(i)p Fq(\021)598
2740 y Fi(//)39 b(Definition)j(of)e(traps)g(for)g(the)g(current)h
(processor)598 2831 y(//)598 2922 y(class)f(off_TrapTbl:)i(public)f
(off_EventTbl)h({)598 3014 y(public:)676 3105 y(//)e(Creates)h(an)e
(unitialized)j(trap)e(table.)676 3196 y(off_TrapTbl\(void\);)676
3288 y(//)g(Creates)h(a)e(trap)h(table.)676 3379 y
(off_TrapTbl\(off_Processor)45 b(*proc\);)676 3470 y(//)79
b(off_TrapTbl\(const)43 b(off_Shtl)237 b(&shtl\);)355
b(XXX)40 b(fix)g(this)676 3744 y(//)g(Returns)h(the)f(allocator)h
(being)f(used.)676 3836 y(off_TrapAllocator)j(*get_allocator\(void\);)
676 4018 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4018 V 29 w(TrapTbl)p Fj(.)i Fk(i)598 4110
y Fi(protected:)676 4201 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 4201 V 29 w(TrapTbl)p
Fj(.)i Fk(i)598 4292 y Fi(private:)676 4384 y(off_TrapAllocator)43
b(t_alloc;)159 b(//)40 b(allocator)h(for)f(traps.)676
4475 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4475 V 29 w(TrapTbl)p Fj(.)i Fk(i)598 4658
y Fi(};)515 4915 y Fk(h)p Fj(O\013)e(event)i(table)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 5006 y Fi(#include)41 b(<hw/Event.h>)434
b(//)40 b(for)g(off_Trap,)h(off_Irq,)g(off_Event)g(et)f(al.)1885
5255 y Fz(314)p eop
PStoPSsaved restore
%%Page: (316,317) 159
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
315 316 bop 515 523 a Fk(h)p Fj(O\013)27 b(interrupt)i(table.)f
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Definition)j(of)e(interrupts)h(for)
f(the)g(current)h(processor.)598 706 y(//)598 797 y(class)f
(off_IntTbl:)i(public)e(off_EventTbl)i({)598 888 y(public:)676
980 y(//)e(Creates)h(an)e(unitialized)j(interrupt)f(table.)676
1071 y(off_IntTbl\(void\);)676 1162 y(//)f(Creates)h(an)e(interrupt)j
(table.)676 1254 y(off_IntTbl\(off_Processor)j(*proc\);)676
1528 y(//)40 b(Returns)h(the)f(allocator)h(being)f(used.)676
1619 y(off_IntAllocator)j(*get_allocator\(void\);)676
1802 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 1802 24 4 v 29 w(IntTbl)p Fj(.)i Fk(i)598
1893 y Fi(protected:)676 1984 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 1984 V 29 w(IntTbl)p
Fj(.)i Fk(i)598 2076 y Fi(private:)676 2167 y(off_IntAllocator)43
b(i_alloc;)159 b(//)39 b(allocator)j(for)e(interrupts.)676
2258 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2258 V 29 w(IntTbl)p Fj(.)h Fk(i)598 2350
y Fi(};)639 2491 y Fz(Initially)-7 b(,)28 b(uninitialized)g(trap)f(and)
h(in)n(terrupt)f(tables)g(ma)n(y)g(b)r(e)h(declared.)515
2607 y Fk(h)p Fi(off)p 667 2607 V 29 w(TrapTbl::off)p
1164 2607 V 30 w(TrapTbl)i Fj(implementation.)d Fk(i)p
Fq(\021)598 2698 y Fi(off_TrapTbl::off_TrapTbl\(void\))46
b(:)676 2790 y(off_EventTbl\(off_Protection\()q(\),OFF)q(_PRT)q(L_NU)q
(LL,OF)q(F_ID)q(_NULL)q(,OFF)q(_MAG)q(IC_TR)q(PTBL)q(\),)715
2881 y Fk(h)p Fj(Initialize)27 b Fi(t)p 1111 2881 V 28
w(alloc)p Fj(.)i Fk(i)o Fi(,)715 2972 y Fk(h)p Fj(Initialize)e(other)i
(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p 2129 2972
V 29 w(TrapTbl)p Fj(.)h Fk(i)598 3064 y Fi({)676 3155
y Fk(h)p Fj(Initialize)f(other)i(private)f(memb)l(ers)h(of)e
Fi(off)p 2015 3155 V 29 w(TrapTbl)p Fj(.)i Fk(i)598 3246
y Fi(})515 3495 y Fk(h)p Fi(off)p 667 3495 V 29 w(IntTbl::off)p
1125 3495 V 30 w(IntTbl)g Fj(implementation.)f Fk(i)o
Fq(\021)598 3587 y Fi(//)39 b(Creates)i(an)f(interrupt)h(table.)598
3678 y(off_IntTbl::off_IntTbl\(void\))k(:)676 3769 y
(off_EventTbl\(off_Protection\()q(\),)g(OFF_PRTL_NULL,)1186
3861 y(OFF_ID_NULL,)d(OFF_MAGIC_INTTBL\),)676 3952 y
Fk(h)p Fj(Initialize)27 b Fi(i)p 1072 3952 V 28 w(alloc)p
Fj(.)h Fk(i)p Fi(,)676 4043 y(i_proc\(NULL\),)676 4134
y Fk(h)p Fj(Initialize)f(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 4134 V 29 w(IntTbl)p Fj(.)g Fk(i)598 4226
y Fi({)676 4317 y Fk(h)p Fj(Initialize)f(other)i(private)f(memb)l(ers)h
(of)e Fi(off)p 2015 4317 V 29 w(IntTbl)p Fj(.)h Fk(i)598
4408 y Fi(})1885 5255 y Fz(315)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
316 317 bop 639 523 a Fz(T)-7 b(rap)39 b(and)g(in)n(terrupt)g(tables)g
(are)f(created)g(using)h(the)h(protection,)h(domain,)h(and)515
623 y(iden)n(ti\014er)27 b(of)h(the)g(pro)r(cessor)d(\(or)i(sh)n
(uttle\))h(b)r(eing)g(used.)515 734 y Fk(h)p Fi(off)p
667 734 24 4 v 29 w(TrapTbl::off)p 1164 734 V 30 w(TrapTbl)i
Fj(implementation.)d Fk(i)p Fz(+)o Fq(\021)598 825 y
Fi(//)39 b(Creates)i(a)f(trap)g(table.)598 916 y
(off_TrapTbl::off_TrapTbl\(off_P)q(roces)q(sor)46 b(*proc\))40
b(:)715 1008 y(off_EventTbl\(proc->get_prot)q(ectio)q(n\(\),)46
b(proc->get_domain\(\),)1225 1099 y(proc->get_id\(\),)d
(OFF_MAGIC_TRPTBL\),)715 1190 y Fk(h)p Fj(Initialize)27
b Fi(t)p 1111 1190 V 28 w(alloc)p Fj(.)i Fk(i)o Fi(,)715
1282 y Fk(h)p Fj(Initialize)e(other)i(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 2129 1282 V 29 w(TrapTbl)p Fj(.)h Fk(i)598
1373 y Fi({)676 1464 y Fk(h)p Fj(Initialize)f(other)i(private)f(memb)l
(ers)h(of)e Fi(off)p 2015 1464 V 29 w(TrapTbl)p Fj(.)i
Fk(i)598 1556 y Fi(})598 1738 y(#if)40 b(0)1059 b(//)40
b(XXX)g(fix)g(this)598 1830 y(//)f(Creates)i(a)f(trap)g(table.)598
1921 y(off_TrapTbl::off_TrapTbl\(const)46 b(off_Shtl)41
b(&s\))f(:)715 2012 y(off_EventTbl\(s.get_protecti)q(on\(\),)46
b(s.get_domain\(\),)1225 2104 y(s.get_id\(\),)c(OFF_MAGIC_TRPTBL\),)715
2195 y Fk(h)p Fj(Initialize)27 b Fi(t)p 1111 2195 V 28
w(alloc)p Fj(.)i Fk(i)o Fi(,)715 2286 y Fk(h)p Fj(Initialize)e(other)i
(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p 2129 2286
V 29 w(TrapTbl)p Fj(.)h Fk(i)598 2378 y Fi({)676 2469
y Fk(h)p Fj(Initialize)f(other)i(private)f(memb)l(ers)h(of)e
Fi(off)p 2015 2469 V 29 w(TrapTbl)p Fj(.)i Fk(i)598 2652
y Fi(})598 2743 y(#endif)639 2954 y Fz(In)n(terrupt)f(tables)f(can)h(b)
r(e)g(only)f(attac)n(hed)h(to)f(pro)r(cessors,)f(as)h(a)g(sh)n(uttle)h
(should)g(not)515 3053 y(ha)n(v)n(e)e(con)n(trol)g(on)i(ho)n(w)f(in)n
(terrupts)g(happ)r(ening)g(in)h(its)g(quan)n(ta)f(are)f(handled.)515
3164 y Fk(h)p Fi(off)p 667 3164 V 29 w(IntTbl::off)p
1125 3164 V 30 w(IntTbl)j Fj(implementation.)f Fk(i)o
Fz(+)p Fq(\021)598 3256 y Fi(//)39 b(Creates)i(an)f(interrupt)h(table.)
598 3347 y(off_IntTbl::off_IntTbl\(off_Pro)q(cesso)q(r)k(*proc\))c(:)
676 3438 y(off_EventTbl\(proc->get_prote)q(ction)q(\(\),)46
b(proc->get_domain\(\),)1186 3529 y(proc->get_id\(\),)d
(OFF_MAGIC_INTTBL\),)676 3621 y Fk(h)p Fj(Initialize)27
b Fi(i)p 1072 3621 V 28 w(alloc)p Fj(.)h Fk(i)p Fi(,)676
3712 y(i_proc\(proc\),)676 3803 y Fk(h)p Fj(Initialize)f(other)i(aggr)l
(e)l(gate)h(memb)l(ers)e(of)g Fi(off)p 2090 3803 V 29
w(IntTbl)p Fj(.)g Fk(i)598 3895 y Fi({)676 3986 y Fk(h)p
Fj(Initialize)f(other)i(private)f(memb)l(ers)h(of)e Fi(off)p
2015 3986 V 29 w(IntTbl)p Fj(.)h Fk(i)598 4169 y Fi(})639
4288 y Fz(The)d(in)n(terrupt)g(table)g(main)n(tains)f(a)h(reference)f
(to)h(the)g(pro)r(cessor)e(b)r(eing)i(used,)g(as)f(w)n(e)515
4388 y(ha)n(v)n(e)i(seen.)515 4499 y Fk(h)p Fj(Other)i(private)h(memb)l
(ers)f(of)g Fi(off)p 1552 4499 V 29 w(IntTbl)p Fj(.)g
Fk(i)p Fq(\021)598 4590 y Fi(off_Processor)42 b(*i_proc;)394
b(//)40 b(processor)515 4732 y Fk(h)p Fj(O\013)27 b(event)i(table)f
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4824 y
Fi(#include)41 b(<hw/EvAllocator.h>)200 b(//)40 b(for)g
(off_{Trap,Int}Allocator)598 4915 y(class)g(off_Processor;)598
5006 y(//class)h(off_Shtl;)159 b(XXX)39 b(fix)h(this)1885
5255 y Fz(316)p eop
PStoPSsaved restore
%%Page: (318,319) 160
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
317 318 bop 515 523 a Fk(h)p Fj(O\013)27 b(event)i(table)f(late)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<hw/Processor.h>)278 b(//)40 b(for)g(off_Processor)598
706 y(/*)f(#)h(include)h(<shtl/Shtl.h>)395 b(//)40 b(for)g(off_Shtl)h
(XXX)e(fix)h(this)h(*/)639 847 y Fz(W)-7 b(e)28 b(m)n(ust)g(de\014ne)g
(the)g(new)f(magic)g(n)n(um)n(b)r(ers)g(used)h(b)r(efore.)515
963 y Fk(h)p Fj(O\013)f(magic)g(numb)l(ers.)i Fk(i)p
Fq(\021)598 1054 y Fi(OFF_MAGIC_INTTBL,)592 b(//)40 b(Interrupt)h
(table)f(magic)h(nb.)598 1146 y(OFF_MAGIC_TRPTBL,)592
b(//)40 b(Trap)g(table)g(magic)h(nb.)639 1270 y Fz(W)-7
b(e)19 b(can)f(no)n(w)g(add)g(another)f(couple)h(of)h(cases)e(to)h(the)
h(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
1386 y Fk(h)p Fi(off)p 667 1386 24 4 v 29 w(Magic::nameof)30
b Fj(c)l(ase)f(for)e Fi(m)p 1559 1386 V 29 w(number)p
Fj(s.)h Fk(i)p Fq(\021)598 1478 y Fi(case)40 b(OFF_MAGIC_INTTBL:)676
1569 y(return)h("off_IntTbl";)598 1660 y(case)f(OFF_MAGIC_TRPTBL:)676
1752 y(return)h("off_TrapTbl";)639 1876 y Fz(Ev)n(en)n(t)27
b(table)h(users)e(can)h(c)n(hec)n(k)g(their)h(references)e(using)h
(these)h(metho)r(ds.)515 1993 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 1993 V 29 w(TrapTbl)p Fj(.)h Fk(i)p
Fq(\021)598 2084 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(TrapTbl?)
598 2175 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g
(get_magic\(\))i(==)e(OFF_MAGIC_TRPTBL;)j(})515 2333
y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2333 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fq(\021)598 2424
y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(IntTbl?)598
2516 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_INTTBL;)j(})515 2690 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2690 V 29
w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 2781 y Fi(//)39
b(Is)h(this)g(identifier)i(a)d(local)i(one?)598 2873
y(inline)f(boolean_t)i(is_local\(const)g(off_ev_id_t)g(&ev\);)515
3047 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3047 V 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3138 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i
(one?)598 3230 y(inline)f(boolean_t)i(is_local\(const)g(off_ev_id_t)g
(&ev\);)639 3371 y Fz(As)19 b(an)n(y)e(other)h Fx(CompResource)p
Fz(,)e(trap)h(and)i(in)n(terrupt)f(tables)g(implemen)n(t)h
Fx(make)p 3153 3371 27 4 v 29 w(available)515 3470 y
Fz(and)27 b Fx(is)p 769 3470 V 31 w(local)p Fz(.)515
3587 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3587 24 4 v 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3678 y Fk(h)p Fj(Implementation)g(of)f Fi(off)p 1391
3678 V 29 w(CompResource::make)p 2122 3678 V 32 w(available)p
Fj(.)i Fk(i)515 3836 y(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3836 V 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3927 y Fk(h)p Fj(Implementation)g(of)f Fi(off)p
1391 3927 V 29 w(CompResource::make)p 2122 3927 V 32
w(available)p Fj(.)i Fk(i)515 4101 y(h)p Fi(off)p 667
4101 V 29 w(IntTbl::is)p 1086 4101 V 30 w(local)g Fj(implementation.)e
Fk(i)p Fq(\021)598 4193 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d
(local)i(one?)598 4284 y(inline)f(boolean_t)i
(off_IntTbl::is_local\(const)j(off_ev_id_t)c(&ev\))598
4375 y({)676 4467 y(assert\(valid\(\)\);)676 4558 y(return)g(\()e(ev)h
(<=)g(i_alloc.get_length\(\))j(&&)872 4649 y
(\(i_alloc+ev\)->get_id\(\))i(==)39 b(ev)h(\);)598 4832
y(})1885 5255 y Fz(317)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
318 319 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(TrapTbl::is)p 1125 523 V 30 w(local)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)
i(one?)598 706 y(inline)f(boolean_t)i(off_TrapTbl::is_local\(const)j
(off_ev_id_t)d(&ev\))598 797 y({)676 888 y(assert\(valid\(\)\);)676
980 y(return)f(\()e(ev)h(<=)g(t_alloc.get_length\(\))j(&&)872
1071 y(\(t_alloc+ev\)->get_id\(\))i(==)39 b(ev)h(\);)598
1254 y(})515 1428 y Fk(h)p Fj(O\013)27 b(event)i(table)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 1519 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)639 1660 y Fz(Finally)-7 b(,)22 b(a)e(couple)h(of)f
Fx(new)g Fz(op)r(erators)e(are)i(included)h(to)f(initialize)h(trap)f
(and)g(in)n(terrupt)515 1760 y(tables.)515 1876 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
1876 V 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
1968 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_TrapTbl)j(*t\))e
({)f(\(void\)s;)i(return)g(\(void*\)t;)g(})515 2125 y
Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2125 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2217 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_IntTbl)j(*t\))e
({)f(\(void\)s;)i(return)g(\(void*\)t;)g(})639 2358 y
Fz(W)-7 b(e)28 b(will)g(b)r(e)g(seeing)f(other)g(features)g(of)h(ev)n
(en)n(t)f(tables)g(while)h(w)n(e)f(discuss)g(ev)n(en)n(ts.)515
2590 y Fn(4.3.2)112 b(Ev)m(en)m(ts)515 2743 y Fz(Ev)n(en)n(t)20
b(tables)h(con)n(tain)g Fx(Event)p Fz(s.)33 b(Eac)n(h)20
b(ev)n(en)n(t)h(represen)n(ts)f(ev)n(en)n(t)h(instances)g(whic)n(h)g
(migh)n(t)515 2843 y(happ)r(en)28 b(and)f(could)g(b)r(e)h(handled.)515
2976 y Fk(h)p Fj(O\013)f(event.)h Fk(i)p Fq(\021)598
3067 y Fi(//)39 b(An)h(event,)h(it)e(could)i(be)e(a)h(trap,)g(an)g
(interrupt,)h(...)598 3159 y(class)f(off_Event:)i(public)e
(off_HWResUnit)i({)598 3250 y(public:)676 3341 y(//)e(Sets)g(h)f(as)h
(the)g(handler)h(for)f(this)g(event)676 3433 y(void)g
(set_handler\(off_EventHandler)46 b(*h\);)676 3524 y(//)40
b(Gets)g(the)g(handler.)676 3615 y(off_EventHandler)j
(*get_handler\(void\))g(const;)676 3798 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 3798 V 29
w(Event)p Fj(.)h Fk(i)598 3889 y Fi(protected:)676 3981
y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 3981 V 29 w(Event)p Fj(.)h Fk(i)598 4072
y Fi(private:)676 4163 y Fk(h)p Fj(Other)h(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4163 V 29 w(Event)p Fj(.)h Fk(i)598 4254
y Fi(};)515 4429 y Fk(h)p Fj(O\013)f(event)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 4520 y Fi(#include)41 b(<klib/HWResUnit.h>)200
b(//)40 b(for)g(off_HWResUnit)639 4661 y Fz(A)28 b(reference)f(to)g
(the)h(handler)f(is)h(k)n(ept)f(in)h(a)f(mem)n(b)r(er.)515
4778 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4778 V 29 w(Event)p Fj(.)g Fk(i)p Fq(\021)598
4869 y Fi(off_EventHandler)43 b(*ev_hndlr;)198 b(//)40
b(Event)g(handler.)1885 5255 y Fz(318)p eop
PStoPSsaved restore
%%Page: (320,321) 161
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
319 320 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Event::set)p 1086 523 V 30 w(handler)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 614 y Fi(//)39 b(Sets)i(h)e(as)h(the)g(handler)g
(for)g(this)g(event)598 706 y(void)g(off_Event::set_handler\(off_Eve)q
(ntHa)q(ndle)q(r)45 b(*h\))598 797 y({)676 888 y(ev_hndlr=h;)598
980 y(})515 1154 y Fk(h)p Fi(off)p 667 1154 V 29 w(Event::get)p
1086 1154 V 30 w(handler)29 b Fj(implementation.)f Fk(i)o
Fq(\021)598 1245 y Fi(//)39 b(Gets)i(the)e(handler.)598
1337 y(off_EventHandler)k(*off_Event::get_handler\(void\))i(const)598
1428 y({)676 1519 y(return)c(ev_hndlr;)598 1611 y(})639
1752 y Fz(In)28 b(turn,)g(ev)n(en)n(ts)f(ma)n(y)g(b)r(e)h(either)f
Fx(Trap)p Fz(s)f(or)g Fx(Irq)p Fz(s)h(\(in)n(terrupts\).)515
1885 y Fk(h)p Fj(O\013)g(T)-6 b(r)l(ap.)28 b Fk(i)p Fq(\021)598
1976 y Fi(class)40 b(off_Trap:)h(public)g(off_Event)g({)598
2067 y(public:)676 2159 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 2159 V 29 w(Trap)p Fj(.)h Fk(i)598
2250 y Fi(protected:)676 2341 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 2341 V 29 w(Trap)p Fj(.)h
Fk(i)598 2433 y Fi(private:)676 2524 y Fk(h)p Fj(Other)h(private)f
(memb)l(ers)h(of)e Fi(off)p 1713 2524 V 29 w(Trap)p Fj(.)h
Fk(i)598 2615 y Fi(};)515 2790 y Fk(h)p Fj(O\013)f(Ir)l(q.)g
Fk(i)p Fq(\021)598 2881 y Fi(class)40 b(off_Irq:)h(public)g(off_Event)g
({)598 2972 y(public:)676 3064 y Fk(h)p Fj(Other)29 b(public)e(metho)l
(ds)i(of)e Fi(off)p 1654 3064 V 29 w(Irq)p Fj(.)h Fk(i)598
3155 y Fi(protected:)676 3246 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 3246 V 29 w(Irq)p Fj(.)h
Fk(i)598 3337 y Fi(private:)676 3429 y Fk(h)p Fj(Other)h(private)f
(memb)l(ers)h(of)e Fi(off)p 1713 3429 V 29 w(Irq)p Fj(.)h
Fk(i)598 3520 y Fi(};)515 3694 y Fk(h)p Fj(O\013)f(event)i(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 3786 y Fi(class)40
b(off_EventTbl;)598 3877 y(class)g(off_IntTbl;)598 3968
y(class)g(off_TrapTbl;)515 4143 y Fk(h)p Fj(O\013)27
b(event)i(implementation)f(dep)l(endencies.)h Fk(i)p
Fq(\021)598 4234 y Fi(#include)41 b(<hw/EventTbl.h>)317
b(//)40 b(for)g(off_IntTbl)h(and)f(off_TrapTbl)1885 5255
y Fz(319)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
320 321 bop 639 523 a Fz(An)29 b(ev)n(en)n(t)e(is)h(created)f(with)i(a)
e(presp)r(eci\014ed)h(protection)f(and)h(domain)g(iden)n(ti\014er.)38
b(A)515 623 y(handler)22 b(can)g(b)r(e)h(sp)r(eci\014ed.)36
b(The)22 b(ev)n(en)n(t)g(itself)h(cannot)g(b)r(e)g(instan)n(tiated,)g
(only)f(traps)g(and)515 722 y(in)n(terrupts)27 b(can.)515
855 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 855 24 4 v 29 w(Event)p Fj(.)h Fk(i)p Fq(\021)598
946 y Fi(//)39 b(Creates)i(an)f(event.)598 1038 y(off_Event\(const)i
(off_Protection)h(&p,)990 1129 y(const)d(off_prtl_id_t)j(&domain,)990
1220 y(const)d(off_ev_id_t)i(&id,)990 1312 y(const)e(off_magic_t)i
(&magic,)990 1403 y(off_EventTbl)199 b(*evtbl,)990 1494
y(const)40 b(off_EventHandler)j(*h)d(\);)515 1669 y Fk(h)p
Fi(off)p 667 1669 V 29 w(Event::off)p 1086 1669 V 30
w(Event)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
1760 y Fi(//)39 b(Creates)i(an)f(event.)598 1851 y
(off_Event::off_Event\(const)45 b(off_Protection)d(&p,)1422
1943 y(const)e(off_prtl_id_t)i(&domain,)1422 2034 y(const)e
(off_ev_id_t)i(&id,)1422 2125 y(const)e(off_magic_t)i(&magic,)1422
2217 y(off_EventTbl)198 b(*evtbl,)1422 2308 y(const)40
b(off_EventHandler)j(*h)c(\))h(:)676 2399 y
(off_HWResUnit\(p,domain,id,ma)q(gic,\()q(off_)q(HWCo)q(mpRes)q(ourc)q
(e*\)ev)q(tbl\))q(,)676 2491 y(ev_hndlr\(h\),)676 2582
y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 2582 V 29 w(Event)p Fj(.)g Fk(i)598 2673
y Fi({;})515 2848 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2848 V 29 w(Trap)p Fj(.)h Fk(i)p Fq(\021)598
2939 y Fi(//)39 b(Creates)i(a)f(trap.)598 3030 y(off_Trap\(const)i
(off_Protection)h(&p,)951 3122 y(const)d(off_prtl_id_t)i(&domain,)951
3213 y(const)e(off_ev_id_t)i(&id,)951 3304 y(off_TrapTbl)198
b(*evtbl,)951 3396 y(const)40 b(off_EventHandler)j(*h)d(\))f(:)676
3487 y(off_Event\(p,domain,id,OFF_MA)q(GIC_T)q(RAP,)q(\(off)q(_Even)q
(tTbl)q(*\)evt)q(bl,h)q(\))598 3578 y({;})515 3753 y
Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3753 V 29 w(Irq)p Fj(.)g Fk(i)p Fq(\021)598 3844
y Fi(//)39 b(Creates)i(an)f(interrupt.)598 3935 y(off_Irq\(const)i
(off_Protection)g(&p,)912 4027 y(const)e(off_prtl_id_t)i(&domain,)912
4118 y(const)e(off_ev_id_t)i(&id,)912 4209 y(off_IntTbl)198
b(*evtbl,)912 4301 y(const)40 b(off_EventHandler)j(*h)c(\))h(:)676
4392 y(off_Event\(p,domain,id,OFF_MA)q(GIC_I)q(RQ,\()q(off_)q(Event)q
(Tbl*)q(\)evtb)q(l,h\))598 4483 y({;})1885 5255 y Fz(320)p
eop
PStoPSsaved restore
%%Page: (322,323) 162
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
321 322 bop 639 523 a Fz(Users)30 b(use)g(a)g(constructor)f(receiving)g
(only)h(the)h(protection,)f(the)h(domain,)g(and)f(the)515
623 y(handler)d(to)g(b)r(e)h(set)g(for)f(the)h(ev)n(en)n(t)f(b)r(eing)h
(allo)r(cated.)515 756 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 756 24 4 v 29 w(Event)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 847 y Fi(//)39 b(Creates)i(an)f(event.)598
938 y(off_Event\(const)i(off_Protection)h(&p,)951 1029
y(const)d(off_prtl_id_t)82 b(&domain,)951 1121 y(const)40
b(off_EventHandler)j(*h)157 b(\);)515 1295 y Fk(h)p Fi(off)p
667 1295 V 29 w(Event::off)p 1086 1295 V 30 w(Event)29
b Fj(implementation.)e Fk(i)p Fz(+)p Fq(\021)598 1386
y Fi(//)39 b(Creates)i(an)f(Event.)598 1478 y
(off_Event::off_Event\(const)45 b(off_Protection)d(&p,)1422
1569 y(const)e(off_prtl_id_t)81 b(&domain,)1422 1660
y(const)40 b(off_EventHandler)j(*h)157 b(\))40 b(:)676
1752 y(off_HWResUnit\(p,domain\),)676 1843 y(ev_hndlr\(h\),)676
1934 y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 1934 V 29 w(Event)p Fj(.)g Fk(i)598
2026 y Fi({;})515 2200 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2200 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2291 y Fi(//)39 b(Creates)i(a)f(trap.)598
2383 y(off_Trap\(const)i(off_Protection)h(&p,)951 2474
y(const)d(off_prtl_id_t)82 b(&domain,)951 2565 y(const)40
b(off_EventHandler)j(*h)157 b(\))40 b(:)676 2657 y
(off_Event\(p,domain,h\))598 2748 y({;})515 2922 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
2922 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 3014
y Fi(//)39 b(Creates)i(an)f(interrupt.)598 3105 y(off_Irq\(const)i
(off_Protection)g(&p,)912 3196 y(const)e(off_prtl_id_t)81
b(&domain,)912 3288 y(const)40 b(off_EventHandler)j(*h)157
b(\);)639 3429 y Fz(When)40 b(in)n(terrupts)e(are)g(created)h(they)g
(are)f(also)g(enabled)h(so)f(that)i(the)f(hardw)n(are)515
3528 y(could)27 b(deliv)n(er)g(them.)515 3661 y Fk(h)p
Fi(off)p 667 3661 V 29 w(Irq::off)p 1008 3661 V 30 w(Irq)h
Fj(implementation.)f Fk(i)p Fq(\021)598 3753 y Fi(//)39
b(Creates)i(an)f(interrupt.)598 3844 y(off_Irq::off_Irq\(const)k
(off_Protection)e(&p,)1265 3935 y(const)e(off_prtl_id_t)81
b(&domain,)1265 4027 y(const)40 b(off_EventHandler)j(*h)157
b(\))40 b(:)676 4118 y(off_Event\(p,domain,h\),)676 4209
y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 4209 V 29 w(Irq)p Fj(.)f Fk(i)598 4301
y Fi({)676 4392 y(unmask\(\);)598 4483 y(})639 4624 y
Fz(An)h(in)n(terrupt)g(destructor)e(will)i(disable)f(it.)515
4757 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4757 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
4848 y Fi(//)39 b(Destroyes)j(an)d(interrupt.)598 4940
y(virtual)i(~off_Irq\(void\);)1885 5255 y Fz(321)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
322 323 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Irq::~off)p 1047 523 V 30 w(Irq)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Destroyes)j(an)d(interrupt.)598
706 y(off_Irq::~off_Irq\(void\))598 797 y({)676 888 y
(assert\(valid\(\)\);)676 980 y(set_domain\(OFF_PRTL_NULL\);)163
b(//)40 b(Just)g(to)g(be)f(sure.)676 1071 y
(protect\(off_Protection\(\)\);)676 1162 y(mask\(\);)598
1254 y(})639 1385 y Fz(Remaining)c(ev)n(en)n(t)g(data)g(is)g
(pre-initialized.)59 b(First,)37 b(a)e(zero-argumen)n(t)d(\(trap)j(and)
515 1484 y(in)n(terrupt\))27 b(constructor)f(p)r(ermits)i(declaration)e
(of)i(uninitialized)g(ev)n(en)n(ts.)515 1607 y Fk(h)p
Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 1607 V 29 w(Event)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1698 y Fi(//)39 b(Allows)i(uninitialized)h(events.)598
1789 y(off_Event\(off_magic_t)i(m\);)639 1920 y Fz(It)28
b(sets)g(default)g(v)-5 b(alues)27 b(\(the)i(magic)e(n)n(um)n(b)r(er)g
(m)n(ust)h(b)r(e)g(supplied)g(b)n(y)g(concrete)e(sub-)515
2020 y(classes\).)515 2131 y Fk(h)p Fi(off)p 667 2131
V 29 w(Event::off)p 1086 2131 V 30 w(Event)j Fj(implementation.)e
Fk(i)p Fz(+)p Fq(\021)598 2222 y Fi(//)39 b(Allows)i(uninitialized)h
(events.)598 2314 y(off_Event::off_Event\(off_magic)q(_t)j(m\))40
b(:)676 2405 y(off_HWResUnit\(off_Protection)q(\(\),)45
b(OFF_PRTL_NULL,)e(OFF_EU_ID_NULL,)82 b(m,)39 b(NULL\),)676
2496 y(ev_hndlr\(&off_Event::default)q(_hand)q(ler\))q(,)676
2588 y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 2588 V 29 w(Event)p Fj(.)g Fk(i)598
2679 y Fi({;})515 2913 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2913 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3004 y Fi(//)39 b(Allows)i(uninitialized)h(traps.)598
3095 y(off_Trap\(void\))g(:)e(off_Event\(OFF_MAGIC_TRAP\))45
b({;})515 3249 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3249 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3341 y Fi(//)39 b(Allows)i(uninitialized)h(interrupts.)598
3432 y(off_Irq\(void\))g(:)d(off_Event\(OFF_MAGIC_IRQ\))45
b({;})639 3563 y Fz(Note)27 b(ho)n(w)f(initially)g(ev)n(ery)f(ev)n(en)n
(t)h(has)g(a)g(n)n(ull)h(handler.)36 b(Suc)n(h)26 b(handler)g(is)g
(also)g(reset)515 3663 y(to)h(b)r(e)h(a)f(default)h(on)g(ev)n(en)n(t)f
(destruction.)515 3785 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3785 V 29 w(Event)p Fj(.)h Fk(i)p Fq(\021)598
3876 y Fi(virtual)41 b(~off_Event\(void\);)515 4030 y
Fk(h)p Fi(off)p 667 4030 V 29 w(Event::~off)p 1125 4030
V 30 w(Event)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4122 y Fi(off_Event::~off_Event\(void\))598 4213 y({)676
4304 y(ev_hndlr=&off_Event::default)q(_hand)q(ler;)598
4396 y(})515 4550 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4550 V 29 w(Event)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 4641 y Fi(static)40 b(err_t)h
(default_event_handler\(off_shtl)q(_id_t)46 b(&s,)1971
4732 y(vm_size_t)41 b(msz,)f(vm_size_t)h(rsz,)1971 4824
y(off_MsgReq)g(*m,)f(off_MsgRep)i(*r\);)598 5006 y(static)e
(off_KrnEventHandler)k(default_handler;)1885 5255 y Fz(322)p
eop
PStoPSsaved restore
%%Page: (324,325) 163
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
323 324 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Event::default)p 1242 523 V 31 w(event)p 1468 523
V 29 w(handler)29 b Fj(implementation.)f Fk(i)p Fq(\021)598
614 y Fi(off_KrnEventHandler)43 b(off_Event::default_handler\(d)q(efau)
q(lt_ev)q(ent_)q(hand)q(ler\);)598 797 y(err_t)d
(off_Event::default_event_hand)q(ler\()q(off_)q(shtl_)q(id_t)46
b(&s,)2128 888 y(vm_size_t)41 b(msz,)f(vm_size_t)h(rsz,)2128
980 y(off_MsgReq)g(*m,)f(off_MsgRep)i(*r\))598 1071 y({)676
1162 y(\(void\)msz;\(void\)rsz;\(void\)r;)676 1254 y(kcout)f(<<)e
("unhandled)j(event)e(";)676 1345 y(kcout)h(<<)e
(fmt\("\045x",\(\(m\)?m->m_type:0\)\))46 b(<<")40 b(from)g(")f(<<)h(s)f
(<<)h(nl;)676 1436 y(return)h(ENOSYS;)598 1528 y(})639
1760 y Fz(When)c(ev)n(en)n(t)f(tables)h(are)e(b)r(eing)i(created,)h
(another)d(constructor)g(is)i(used)f(to)h(pre-)515 1860
y(initialize)27 b(those)h(ev)n(en)n(t)f(\014elds)g(whic)n(h)h(are)f
(unlik)n(ely)g(to)g(c)n(hange.)515 1993 y Fk(h)p Fj(Other)h(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 1993 V 29
w(Event)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 2084 y Fi(//)39
b(Pre-initializes)k(an)d(event.)598 2175 y(off_Event\(const)i
(off_ev_id_t)g(&id,)e(const)h(off_magic_t)g(&m,)990 2267
y(off_EventTbl)h(*c,)e(off_EventHandler)j(*h\);)639 2408
y Fz(Note)c(ho)n(w)f(in)g(this)h(case)f(\(unlik)n(e)g(other)g(hardw)n
(are)f(resource)f(units\))k(w)n(e)e(mak)n(e)f(a)515 2507
y(pro)n(vision)24 b(for)h(a)g(default)h(handler)f(to)g(b)r(e)h
(installed.)36 b(Suc)n(h)26 b(handler)f(will)h(notify)g(than)f(an)515
2607 y(stra)n(y)h(ev)n(en)n(t)h(has)g(app)r(eared)g(and)g(do)h(nothing)
f(else.)515 2723 y Fk(h)p Fi(off)p 667 2723 V 29 w(Event::off)p
1086 2723 V 30 w(Event)i Fj(implementation.)e Fk(i)p
Fz(+)p Fq(\021)598 2814 y Fi(//)39 b(Pre-initializes)k(an)d(event.)598
2906 y(off_Event::off_Event\(const)45 b(off_ev_id_t)d(&id,)1422
2997 y(const)e(off_magic_t)i(&m,)1422 3088 y(off_EventTbl)f(*c,)f
(off_EventHandler)j(*h\))d(:)676 3180 y(off_HWResUnit\(id,m,\(off_HWCo)
q(mpRes)q(ourc)q(e*\)c)q(\),)676 3271 y(ev_hndlr\(h\),)676
3362 y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 3362 V 29 w(Event)p Fj(.)g Fk(i)598
3454 y Fi({;})515 3611 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3611 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3703 y Fi(//)39 b(Pre-initializes)k(an)d(interrupt.)598
3794 y(off_Irq\(const)i(off_ev_id_t)g(&id,)e(off_IntTbl)h(*c,)f
(off_EventHandler)j(*h\))d(:)676 3885 y(off_Event\(id,OFF_MAGIC_IRQ,\()
q(off_E)q(vent)q(Tbl*)q(\)c,h\))598 3977 y({;})515 4151
y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4151 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
4242 y Fi(//)39 b(Pre-initializes)k(a)d(trap.)598 4334
y(off_Trap\(const)i(off_ev_id_t)g(&id,)e(off_TrapTbl)i(*c,)e
(off_EventHandler)j(*h\))c(:)676 4425 y(off_Event\(id,OFF_MAGIC_TRAP,)q
(\(off_)q(Even)q(tTbl)q(*\)c,h)q(\))598 4516 y({;})1885
5255 y Fz(323)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
324 325 bop 515 523 a Fk(h)p Fj(Initialize)26 b(other)j(private)g(memb)
l(ers)g(of)e Fi(off)p 1854 523 24 4 v 29 w(TrapTbl)p
Fj(.)h Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Preinitialize)k(traps)598
706 y(for)d(\(natural_t)h(t=0;)f(t)g(<)f(OFF_MDEP_NTRP_MAX;)44
b(t++\){)676 797 y(off_ev_id_t)e(id\(get_id\(\),t\);)676
888 y(new\(t_alloc+t\))h(off_Trap\(id,this,&OFF_NULL_HAND)q(LER\))q(;)
598 980 y(})515 1245 y Fk(h)p Fj(Initialize)26 b(other)j(private)g
(memb)l(ers)g(of)e Fi(off)p 1854 1245 V 29 w(IntTbl)p
Fj(.)h Fk(i)p Fq(\021)598 1337 y Fi(//)39 b(Preinitialize)k(interrupts)
598 1428 y(for)d(\(natural_t)h(i=0;)f(i)g(<)f(OFF_MDEP_NINT_MAX;)44
b(i++\){)676 1519 y(off_ev_id_t)e(id\(get_id\(\),i\);)676
1611 y(new\(i_alloc+i\))h(off_Irq\(id,this,&OFF_NULL_HANDL)q(ER\);)598
1702 y(})639 1843 y Fz(Again,)27 b(a)h Fx(new)e Fz(op)r(erator)g(has)h
(b)r(een)h(used.)515 1976 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 1976 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2067 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d
(off_Trap)i(*t\))f({)g(\(void\)s;)h(return)f(\(void*\)t;)i(})515
2242 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2242 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2333 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_Irq)
i(*i\))f({)g(\(void\)s;)h(return)f(\(void*\)i;)h(})639
2474 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(magic)f(n)n
(um)n(b)r(ers)g(used.)515 2590 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)
i Fk(i)p Fz(+)o Fq(\021)598 2682 y Fi(OFF_MAGIC_TRAP,)670
b(//)40 b(Interrupt)h(table)f(magic)h(nb.)598 2773 y(OFF_MAGIC_IRQ,)709
b(//)40 b(Trap)g(table)g(magic)h(nb.)639 2897 y Fz(W)-7
b(e)19 b(can)f(no)n(w)g(add)g(another)f(couple)h(of)h(cases)e(to)h(the)
h(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
3014 y Fk(h)p Fi(off)p 667 3014 V 29 w(Magic::nameof)30
b Fj(c)l(ase)f(for)e Fi(m)p 1559 3014 V 29 w(number)p
Fj(s.)h Fk(i)p Fz(+)p Fq(\021)598 3105 y Fi(case)40 b(OFF_MAGIC_TRAP:)
676 3196 y(return)h("off_Trap";)598 3288 y(case)f(OFF_MAGIC_IRQ:)676
3379 y(return)h("off_Irq";)639 3504 y Fz(Ev)n(en)n(t)27
b(users)g(can)g(c)n(hec)n(k)g(their)g(references)g(using)g(these)g
(metho)r(ds.)515 3620 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3620 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3711 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(Trap?)598
3802 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_TRAP;)i(})515 3960 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3960 V 29
w(Irq)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 4051 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(Irq?)598 4143 y(boolean_t)i
(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i(==)e
(OFF_MAGIC_IRQ;)i(})639 4284 y Fz(And)28 b(con)n(tainers)f(can)g(no)n
(w)g(implemen)n(t)h(their)f Fx(get)p 2285 4284 27 4 v
31 w(umagic)e Fz(metho)r(ds.)515 4417 y Fk(h)p Fj(Other)j(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 4417 24 4
v 29 w(TrapTbl)p Fj(.)h Fk(i)p Fq(\021)598 4508 y Fi(virtual)41
b(off_magic_t)g(get_umagic\(void\))i({)d(return)g(OFF_MAGIC_TRAP;)j(})
515 4774 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 4774 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fq(\021)598
4865 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i({)d(return)g
(OFF_MAGIC_IRQ;)j(})1885 5255 y Fz(324)p eop
PStoPSsaved restore
%%Page: (326,327) 164
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
325 326 bop 515 523 a Fk(h)p Fj(O\013)27 b(event)i(dep)l(endencies.)g
Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(#include)41 b(<klib/Magic.h>)199
b(//)598 706 y(#include)41 b(<assert.h>)512 b(//)40 b(for)g(assert)515
980 y Fn(4.3.3)112 b(Ev)m(en)m(t)37 b(allo)s(cation)515
1133 y Fz(An)22 b(ev)n(en)n(t)f(allo)r(cator)f(is)i(a)f(sub)r(class)g
(a)h Fx(TBmAllocator)p Fz(.)30 b(It)22 b(is)f(not)h(sub)5
b(ject)22 b(to)g(rev)n(o)r(cation.)515 1232 y(Actually)35
b(w)n(e)f(ha)n(v)n(e)g(t)n(w)n(o)g(kinds)g(of)h(ev)n(en)n(t)g(allo)r
(cators,)f(whic)n(h)h(can)f(b)r(e)i(instan)n(tiated)e(to)515
1332 y(allo)r(cate)20 b(traps)g(and)h(in)n(terrupts.)34
b(The)21 b(n)n(um)n(b)r(er)g(of)g(traps)f(and)h(the)g(n)n(um)n(b)r(er)g
(of)g(in)n(terrupts)515 1432 y(is)27 b(a)g(mac)n(hine)h(dep)r(enden)n
(t)g(constan)n(t.)639 1531 y(Eac)n(h)j(allo)r(cator)g(main)n(tains)g
(an)h(indexer)f(and)h(also)f(an)h(arra)n(y)e(where)i(allo)r(cated)f
(re-)515 1631 y(sources)26 b(are)g(k)n(ept.)515 1764
y Fk(h)p Fj(O\013)h(tr)l(ap)i(al)t(lo)l(c)l(ator.)f Fk(i)p
Fq(\021)598 1855 y Fi(//)39 b(A)h(trap)g(allocator.)598
1946 y(//)598 2038 y(class)g(off_TrapAllocator)j(:)d(public)g
(off_TBmAllocator<off_Trap>)45 b({)598 2129 y(private:)676
2220 y(static)c(off_Indexer<off_Trap>)j(t_idx;)676 2312
y(off_Trap)d(t_traps[OFF_MDEP_NTRP_MAX];)598 2403 y(public:)676
2494 y(//)f(Creates)h(a)e(trap)h(allocator.)676 2586
y(off_TrapAllocator\(off_Exhaus)q(ted)45 b(*r\))40 b(:)755
2677 y(off_TBmAllocator<off_Trap>\(r,\(c)q(onst)46 b(off_Indexable)c
(*\)&t_idx,)1814 2768 y(&t_traps[0],OFF_MDEP_NTRP_MAX)k(\))676
2860 y({;})676 3042 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3042 24 4 v 29 w(TrapAllocator)p Fj(.)j
Fk(i)598 3134 y Fi(};)515 3399 y Fk(h)p Fj(O\013)d(event)i(al)t(lo)l(c)
l(ator)f(dep)l(endencies.)i Fk(i)p Fq(\021)598 3491 y
Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40 b(for)g(do_debug)515
3665 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(al)t(lo)l(c)l(ator)f(static)h
(memb)l(ers.)f Fk(i)p Fq(\021)598 3756 y Fi(off_Indexer<off_Trap>)44
b(off_TrapAllocator::t_idx;)1885 5255 y Fz(325)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
326 327 bop 515 523 a Fk(h)p Fj(O\013)27 b(interrupt)i(al)t(lo)l(c)l
(ator.)f Fk(i)p Fq(\021)598 614 y Fi(//)39 b(An)h(interrupt)h
(allocator.)598 706 y(//)598 797 y(class)f(off_IntAllocator)j(:)c
(public)i(off_TBmAllocator<off_Irq>)k({)676 888 y(static)c
(off_Indexer<off_Irq>)j(i_idx;)676 980 y(off_Irq)d
(i_irqs[OFF_MDEP_NINT_MAX];)598 1071 y(public:)676 1162
y(//)f(Creates)h(an)e(interrupt)j(allocator.)676 1254
y(off_IntAllocator\(off_Exhaust)q(ed)j(*r\))40 b(:)755
1345 y(off_TBmAllocator<off_Irq>\(r,\(co)q(nst)46 b(off_Indexable)c
(*\)&i_idx,)1775 1436 y(&i_irqs[0],OFF_MDEP_NINT_MAX\))676
1528 y({;})676 1710 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 1710 24 4 v 29 w(IntAllocator)p Fj(.)j
Fk(i)598 1893 y Fi(};)515 2067 y Fk(h)p Fj(O\013)d(interrupt)i(al)t(lo)
l(c)l(ator)g(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598
2159 y Fi(off_Indexer<off_Irq>)44 b(off_IntAllocator::i_idx;)515
2333 y Fk(h)p Fj(O\013)27 b(event)i(al)t(lo)l(c)l(ator)f(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 2424 y Fi(#include)41
b(<klib/BmAllocator.h>)122 b(//)40 b(for)g(off_TBmAllocator)598
2516 y(#include)h(<hw/mdep/mEventTbl.h>)83 b(//)40 b(for)g
(OFF_MDEP_N{INT,TRP}_MAX)598 2607 y(#include)h(<hw/Event.h>)434
b(//)40 b(for)g(off_Trap,)h(off_Irq)g(et)e(al.)639 2748
y Fz(These)28 b(allo)r(cators)d(are)i(created)g(at)g(trap)g(and)h(in)n
(terrupt)f(table)g(instan)n(tiation)h(time.)515 2864
y Fk(h)p Fj(Initialize)e Fi(t)p 910 2864 V 29 w(alloc)p
Fj(.)i Fk(i)p Fq(\021)598 2956 y Fi(t_alloc\(\(off_Exhausted*\)this\))
515 3113 y Fk(h)p Fj(Initialize)e Fi(i)p 910 3113 V 29
w(alloc)p Fj(.)i Fk(i)p Fq(\021)598 3205 y Fi
(i_alloc\(\(off_Exhausted*\)this\))639 3346 y Fz(Note)22
b(ho)n(w)f(in)h(ev)n(ery)f(case)g(the)h(rev)n(o)r(cator)d(is)j(the)g
(ev)n(en)n(t)f(table.)35 b(As)22 b(it)g(do)r(es)f(not)h(mak)n(es)515
3445 y(sense)27 b(to)g(p)r(erform)g(ev)n(en)n(t)g(rev)n(o)r(cation)f
(it)i(b)r(eha)n(v)n(es)f(as)g(a)g(n)n(ull)h(rev)n(o)r(cator.)515
3562 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3562 V 29 w(EventTbl)p Fj(.)i Fk(i)o Fq(\021)598
3653 y Fi(//)39 b(Notifies)i(that)g(events)f(are)g(exhausted.)598
3744 y(void)g(notify\(void\){;})639 3869 y Fz(Once)25
b(allo)r(cators)e(ha)n(v)n(e)g(b)r(een)i(created,)g(trap)f(and)h(in)n
(terrupt)g(tables)f(can)h(b)r(e)g(indexed)515 3968 y(to)i(gain)g
(references)g(to)g(traps)g(and)g(in)n(terrupts.)515 4101
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4101 V 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4193 y Fi(inline)40 b(off_Trap)h(*operator)h(+\(vm_offset_t)g(t\);)515
4367 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4367 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4458 y Fi(inline)40 b(off_Irq)h(*operator)g(+\(vm_offset_t)
i(i\);)515 4633 y Fk(h)p Fi(off)p 667 4633 V 29 w(TrapTbl::operator)g
(+)27 b Fj(implementation.)h Fk(i)p Fq(\021)598 4724
y Fi(inline)40 b(off_Trap)h(*off_TrapTbl::operator)k(+\(vm_offset_t)d
(t\){)676 4815 y(assert\(valid\(\)\);)676 4907 y(return)f(t_alloc+t;)
598 4998 y(})1885 5255 y Fz(326)p eop
PStoPSsaved restore
%%Page: (328,329) 165
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
327 328 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IntTbl::operator)42 b(+)28 b Fj(implementation.)g
Fk(i)o Fq(\021)598 614 y Fi(inline)40 b(off_Irq)h
(*off_IntTbl::operator)j(+\(vm_offset_t)e(i\){)676 706
y(assert\(valid\(\)\);)676 797 y(return)f(i_alloc+i;)598
888 y(})639 1029 y Fz(F)-7 b(or)31 b(e\016ciency)g(purp)r(oses,)h(w)n
(e)f(also)g(de\014ne)g(this)h(op)r(erator)e(for)h(ev)n(en)n(t)g(allo)r
(cators)e(to)515 1129 y(b)n(ypass)d(allo)r(cator)g(indexers.)515
1245 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1245 V 29 w(IntAllocator)p Fj(.)i Fk(i)p Fq(\021)598
1337 y Fi(inline)40 b(off_Irq)h(*operator)g(+\(vm_offset_t)i(i\);)515
1494 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1494 V 29 w(TrapAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 1586 y Fi(inline)40 b(off_Trap)h(*operator)h
(+\(vm_offset_t)g(t\);)515 1760 y Fk(h)p Fi(off)p 667
1760 V 29 w(IntAllocator::operator)i(+)27 b Fj(implementation.)h
Fk(i)p Fq(\021)598 1851 y Fi(inline)40 b(off_Irq)h
(*off_IntAllocator::operator)46 b(+\(vm_offset_t)c(i\))d({)676
1943 y(return)i(i_irqs+i;)598 2034 y(})515 2208 y Fk(h)p
Fi(off)p 667 2208 V 29 w(TrapAllocator::operator)j(+)28
b Fj(implementation.)f Fk(i)p Fq(\021)598 2300 y Fi(inline)40
b(off_Trap)h(*off_TrapAllocator::operato)q(r)k(+\(vm_offset_t)d(t\))e
({)676 2391 y(return)h(t_traps+t;)598 2482 y(})639 2623
y Fz(These)33 b(allo)r(cators)f(can)h(b)r(e)g(obtained)g(with)h(the)g
Fx(get)p 2372 2623 27 4 v 30 w(allocator)c Fz(metho)r(ds)j(of)h(the)515
2723 y Fx(Event)p Fz(s)25 b(using)i(it.)515 2839 y Fk(h)p
Fi(off)p 667 2839 24 4 v 29 w(TrapTbl::get)p 1164 2839
V 30 w(allocator)j Fj(implementation.)d Fk(i)p Fq(\021)598
2931 y Fi(//)39 b(Returns)i(a)f(pointer)h(to)e(the)h(trap)g(allocator.)
598 3022 y(inline)g(off_TrapAllocator)j(*off_TrapTbl::get_allocator)q
(\(void)q(\))598 3113 y({)637 3205 y(return)e(&t_alloc;)598
3296 y(})515 3454 y Fk(h)p Fi(off)p 667 3454 V 29 w(IntTbl::get)p
1125 3454 V 30 w(allocator)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 3545 y Fi(//)39 b(Returns)i(a)f(pointer)h(to)e(the)h
(trap)g(allocator.)598 3636 y(inline)g(off_IntAllocator)j
(*off_IntTbl::get_allocator\(v)q(oid\))598 3728 y({)637
3819 y(return)e(&i_alloc;)598 3910 y(})722 4134 y FA(NOTE:)28
b Fz(Rede\014ne)g([])g(to)g(gain)g(an)g(index)g(righ)n(t)f(to)h(the)h
(trap)e(structure)h(for)722 4234 y(a)f(giv)n(en)g(trap)g(n)n(um)n(b)r
(er)h(\(same)f(for)g(in)n(terrupts\).)37 b(This)27 b(m)n(ust)h(b)r(e)g
(fast.)639 4417 y(T)-7 b(rap)28 b(and)g(in)n(terrupt)h(tables)f(can)g
(allo)r(cate)g(trap)g(and)g(in)n(terrupts)g(using)h(these)f(allo-)515
4516 y(cators.)515 4633 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4633 V 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4724 y Fi(//)39 b(Allocates)j(a)d(trap.)598
4815 y(off_Trap)i(*alloc\(const)h(off_ev_id_t)f(at=OFF_EU_ID_NULL\);)
598 4907 y(//)e(Deallocates)j(a)e(trap.)598 4998 y(void)g(free\()79
b(off_Trap)42 b(*t)d(\);)1885 5255 y Fz(327)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
328 329 bop 515 523 a Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 523 24 4 v 29 w(IntTbl)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Allocates)j(an)d(interrupt.)598
706 y(off_Irq)i(*alloc\(const)h(off_ev_id_t)f(at=OFF_EU_ID_NULL\);)598
797 y(//)e(Deallocates)j(an)e(interrupt.)598 888 y(void)g(free\()79
b(off_Irq)41 b(*t)f(\);)639 1029 y Fz(The)34 b(implemen)n(tation)h(is)f
(the)g(same)g(seen)g(for)f(previous)g(hardw)n(are)f(resource)h(con-)515
1129 y(tainers.)515 1245 y Fk(h)p Fi(off)p 667 1245 V
29 w(TrapTbl::alloc)d Fj(implementation.)e Fk(i)o Fq(\021)598
1337 y Fi(//)39 b(Allocates)j(a)d(trap.)598 1428 y(off_Trap)i
(*off_TrapTbl::alloc\(const)k(off_ev_id_t)c(at=OFF_EU_ID_NULL\))598
1519 y({)715 1611 y(off_Trap)g(*t;)715 1702 y(assert\(valid\(\)\);)715
1793 y(w_lock\(\);)715 1885 y(t=t_alloc.allocate\(at\);)715
1976 y(w_unlock\(\);)715 2067 y(return)g(t;)598 2159
y(})515 2316 y Fk(h)p Fj(O\013)27 b(event)i(table)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2408 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)515 2582 y Fk(h)p Fi(off)p 667
2582 V 29 w(TrapTbl::free)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 2673 y Fi(//)39 b(Deallocates)j(a)e(trap.)598
2765 y(void)g(off_TrapTbl::free\()82 b(off_Trap)41 b(*t)f(\))598
2856 y({)676 2947 y(assert\(valid\(\)\);)676 3039 y(w_lock\(\);)676
3130 y(t_alloc.deallocate\(t\);)676 3221 y(w_unlock\(\);)598
3313 y(})515 3578 y Fk(h)p Fi(off)p 667 3578 V 29 w(IntTbl::alloc)30
b Fj(implementation.)d Fk(i)p Fq(\021)598 3670 y Fi(//)39
b(Allocates)j(an)d(interrupt..)598 3761 y(off_Irq)i
(*off_IntTbl::alloc\(const)j(off_ev_id_t)e(at=OFF_EU_ID_NULL\))598
3852 y({)715 3944 y(off_Irq)f(*i;)715 4035 y(assert\(valid\(\)\);)715
4126 y(w_lock\(\);)715 4218 y(i=i_alloc.allocate\(at\);)715
4309 y(w_unlock\(\);)715 4400 y(return)g(i;)598 4491
y(})1885 5255 y Fz(328)p eop
PStoPSsaved restore
%%Page: (330,331) 166
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
329 330 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IntTbl::free)30 b Fj(implementation.)d Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Deallocates)j(an)e(interrupt.)598 706
y(void)g(off_IntTbl::free\()82 b(off_Irq)41 b(*i)f(\))598
797 y({)676 888 y(assert\(valid\(\)\);)676 980 y(w_lock\(\);)676
1071 y(i_alloc.deallocate\(i\);)676 1162 y(w_unlock\(\);)598
1254 y(})639 1486 y Fz(T)-7 b(rap)20 b(and)g(in)n(terrupts)f(are)g
(allo)r(cated)h(and)f(deallo)r(cated)h(with)g Fx(new)f
Fz(and)h Fx(delete)e Fz(op)r(er-)515 1586 y(ators.)35
b(The)25 b(op)r(erator)f Fx(new)h Fz(receiv)n(es)f(the)i(table)f(where)
g(the)h(ev)n(en)n(t)f(should)h(b)r(e)g(allo)r(cated.)515
1719 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1719 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1810 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_TrapTbl)j(*tbl,)
e(off_ev_id_t)i(at\);)598 1901 y(void)e(operator)h(delete\(void)h
(*p\);)515 2076 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2076 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2167 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d
(off_IntTbl)j(*tbl,)e(off_ev_id_t)i(at\);)598 2258 y(void)e(operator)h
(delete\(void)h(*p\);)515 2433 y Fk(h)p Fi(off)p 667
2433 V 29 w(Trap::operator)g(new/delete)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 2524 y Fi(void)40 b(*off_Trap::operator)j
(new\(size_t)f(s,)e(off_TrapTbl)h(*tbl,)g(off_io_id_t)g(at\))598
2615 y({)676 2707 y(off_Trap)g(*t=tbl->alloc\(at\);)676
2798 y(\(void\)s;)676 2889 y(assert\(tbl\);)676 2980
y(return)g(\(void*\)t;)598 3072 y(})598 3254 y(void)f
(off_Trap::operator)j(delete\(void)f(*p\))598 3346 y({)676
3437 y(off_Trap)f(*t=\(off_Trap*\)p;)676 3528 y(assert\(p\);)676
3620 y(\(\(off_TrapTbl*\)\(t->get_conta)q(iner\()q(\)\)\)-)q(>fre)q
(e\(t\);)598 3711 y(})1885 5255 y Fz(329)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
330 331 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Irq::operator)42 b(new/delete)29 b Fj(implementation.)f
Fk(i)p Fq(\021)598 614 y Fi(void)40 b(*off_Irq::operator)j(new\(size_t)
f(s,)d(off_IntTbl)j(*tbl,)e(off_io_id_t)i(at\))598 706
y({)676 797 y(off_Irq)f(*i=tbl->alloc\(at\);)676 888
y(\(void\)s;)676 980 y(assert\(tbl\);)676 1071 y(return)g(\(void*\)i;)
598 1162 y(})598 1345 y(void)f(off_Irq::operator)j(delete\(void)f(*p\))
598 1436 y({)676 1528 y(off_Irq)f(*i=\(off_Irq*\)p;)676
1619 y(assert\(p\);)676 1710 y(\(\(off_IntTbl*\)\(i->get_contai)q
(ner\(\))q(\)\)->)q(free)q(\(i\);)598 1802 y(})1885 5255
y Fz(330)p eop
PStoPSsaved restore
%%Page: (332,333) 167
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
331 332 bop 515 523 a Fn(4.3.4)112 b(T)-9 b(rap)38 b(and)g(In)m
(terrupt)f(handling)515 676 y FA(Ev)m(en)m(t)32 b(handlers)515
830 y Fz(Ev)n(en)n(ts)21 b(are)h(handled)h(b)n(y)g Fx(EventHandler)p
Fz(s)17 b(whic)n(h)23 b(can)g(rely)f(either)g(on)h(p)r(ortals)f(or,)h
(when)515 929 y(deliv)n(ered)29 b(inside)h(the)h(k)n(ernel,)f(on)g
(function)h(calls.)44 b(The)30 b(default)h(handler)e(simply)h(do)r(es)
515 1029 y(nothing.)515 1151 y Fk(h)p Fj(O\013)d(event)i(hand)t(ler.)f
Fk(i)p Fq(\021)598 1243 y Fi(//)39 b(An)h(event)g(handler.)598
1334 y(class)g(off_EventHandler)j({)598 1425 y(public:)676
1517 y(//)d(Calls)g(the)g(handler)676 1608 y(virtual)h(err_t)f
(operator\(\)\(const)j(off_shtl_id_t)f(&sender,)1657
1699 y(vm_size_t)f(msz,)f(vm_size_t)i(rsz,)1657 1791
y(off_EventReq)g(*m,)e(off_EventRep)i(*r\){)755 1882
y(\(void\)sender;\(void\)msz;\(void\)rs)q(z;\(v)q(oid\))q(m;\(vo)q
(id\)r)q(;)755 1973 y(return)e(EOK;)676 2065 y(})598
2156 y(};)598 2339 y(class)g(off_KrnEventHandler)k(:)39
b(public)i(off_EventHandler)i({)598 2430 y(public:)676
2521 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2521 24 4 v 29 w(KrnEventHandler)p Fj(.)k
Fk(i)676 2704 y Fi(//)40 b(Calls)g(the)g(handler)676
2795 y(virtual)h(err_t)f(operator\(\)\(const)j(off_shtl_id_t)f
(&sender,)1657 2887 y(vm_size_t)f(msz,)f(vm_size_t)i(rsz,)1657
2978 y(off_EventReq)g(*m,)e(off_EventRep)i(*r\);)598
3069 y(private:)676 3161 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h
(of)e Fi(off)p 1713 3161 V 29 w(KrnEventHandler)p Fj(.)j
Fk(i)598 3252 y Fi(};)598 3435 y(class)40 b(off_UsrEventHandler)k(:)39
b(public)i(off_EventHandler)i({)598 3526 y(public:)676
3617 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3617 V 29 w(UsrEventHandler)p Fj(.)k Fk(i)676
3800 y Fi(//)40 b(Calls)g(the)g(handler)676 3891 y(virtual)h(err_t)f
(operator\(\)\(const)j(off_shtl_id_t)f(&sender,)1657
3982 y(vm_size_t)f(msz,)f(vm_size_t)i(rsz,)1657 4074
y(off_EventReq)g(*m,)e(off_EventRep)i(*r\);)598 4165
y(private:)676 4256 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4256 V 29 w(UsrEventHandler)p Fj(.)j Fk(i)598
4348 y Fi(};)639 4570 y Fz(There)d(is)h(a)f(n)n(ull)h(handler)f
(de\014ned)h(to)f(do)h(nothing.)515 4681 y Fk(h)p Fj(O\013)f(nul)t(l)g
(event)i(hand)t(ler.)f Fk(i)o Fq(\021)598 4772 y Fi(extern)40
b(off_EventHandler)j(OFF_NULL_HANDLER;)515 4915 y Fk(h)p
Fj(O\013)27 b(nul)t(l)g(event)i(hand)t(ler)f(implementation.)f
Fk(i)p Fq(\021)598 5006 y Fi(off_EventHandler)43 b(OFF_NULL_HANDLER;)
1885 5255 y Fz(331)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
332 333 bop 639 523 a Fz(But)41 b(usually)-7 b(,)43 b(ev)n(en)n(t)d
(handlers)f(will)i(b)r(e)g(created)e(either)h(to)h(dispatc)n(h)f(to)g
(a)g(lo)r(cal)515 623 y(function)28 b(or)f(to)g(a)g(system)h(p)r
(ortal.)515 756 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 756 24 4 v 29 w(KrnEventHandler)p Fj(.)j
Fk(i)p Fq(\021)598 847 y Fi(//)39 b(Creates)i(an)f(in-kernel)h(event)g
(handler.)598 938 y(off_KrnEventHandler\(off_PrtlHa)q(ndler)q(Fn)k
(*h\);)515 1112 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1112 V 29 w(UsrEventHandler)p Fj(.)j Fk(i)p
Fq(\021)598 1204 y Fi(//)39 b(Creates)i(an)f(in-kernel)h(event)g
(handler.)598 1295 y(off_UsrEventHandler\(const)k(off_prtl_id_t)d
(&p\);)639 1528 y Fz(Where)36 b Fx(PrtlHandlerFn)31 b
Fz(is)36 b(a)f(lo)r(cal)g(function)i(servicing)e(the)h(p)r(ortal)f(in)n
(v)n(o)r(cation.)515 1627 y(The)27 b(ev)n(en)n(t)g(handler)h
(constructor)e(simply)h(records)f(the)i(handler.)515
1760 y Fk(h)p Fi(off)p 667 1760 V 29 w(KrnEventHandler::off)p
1476 1760 V 32 w(KrnEventHandler)j Fj(implementation.)d
Fk(i)p Fq(\021)598 1851 y Fi(//)39 b(Creates)i(an)f(in-kernel)h(event)g
(handler.)598 1943 y(off_KrnEventHandler::off_KrnEv)q(entHa)q(ndle)q
(r\(of)q(f_Prt)q(lHan)q(dlerF)q(n)k(*h\))40 b(:)676 2034
y(k_hndlr\(h\))598 2125 y({;})515 2300 y Fk(h)p Fj(Other)28
b(private)h(memb)l(ers)f(of)g Fi(off)p 1552 2300 V 29
w(KrnEventHandler)p Fj(.)i Fk(i)p Fq(\021)598 2391 y
Fi(off_PrtlHandlerFn)43 b(*k_hndlr;)198 b(//)40 b(The)g(handling)h
(function.)515 2565 y Fk(h)p Fi(off)p 667 2565 V 29 w
(UsrEventHandler::off)p 1476 2565 V 32 w(UsrEventHandler)31
b Fj(implementation.)d Fk(i)p Fq(\021)598 2657 y Fi(//)39
b(Creates)i(a)f(cross-domain)i(event)e(handler.)598 2748
y(off_UsrEventHandler::off_UsrEv)q(entHa)q(ndle)q(r\(co)q(nst)45
b(off_prtl_id_t)e(&p\))d(:)676 2839 y(u_hndlr\(p\))598
2931 y({;})515 3105 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3105 V 29 w(UsrEventHandler)p Fj(.)i Fk(i)p
Fq(\021)598 3196 y Fi(off_prtl_id_t)42 b(u_hndlr;)198
b(//)40 b(The)f(handling)j(portal.)515 3371 y Fk(h)p
Fi(off)p 667 3371 V 29 w(KrnEventHandler::operator\(\))33
b Fj(implementation.)28 b Fk(i)o Fq(\021)598 3462 y Fi(err_t)40
b(off_KrnEventHandler::operator)q(\(\)\(c)q(onst)46 b(off_shtl_id_t)c
(&sender,)2088 3553 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)2088
3645 y(off_EventReq)h(*m,)e(off_EventRep)i(*r\))598 3736
y({)676 3827 y(return)f(\(*k_hndlr\)\(sender,msz,rsz,m,r\))q(;)598
4010 y(})515 4184 y Fk(h)p Fi(off)p 667 4184 V 29 w
(UsrEventHandler::operator\(\))33 b Fj(implementation.)28
b Fk(i)o Fq(\021)598 4276 y Fi(err_t)40 b
(off_UsrEventHandler::operator)q(\(\)\(c)q(onst)46 b(off_shtl_id_t)c
(&sender,)2088 4367 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)2088
4458 y(off_EventReq)h(*m,)e(off_EventRep)i(*r\))598 4550
y({)676 4641 y(\(void\)sender;\(void\)msz;\(void)q(\)rsz;)q(\(voi)q
(d\)m;)q(\(void)q(\)r;)676 4732 y(panic\("ev:)g(should)e(raise)h(an)e
(event)i(for)f(the)g(user.)g(Not)g(yet)g(implemented."\);)676
4824 y(//)g(XXX)g(just)g(a)f(call)i(to)e(kpct)h(if)g(rsz>0)g(||)g
(kdeliver)h(if)f(rsz==0)676 4915 y(return)h(ENOSYS;)598
5006 y(})1885 5255 y Fz(332)p eop
PStoPSsaved restore
%%Page: (334,335) 168
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
333 334 bop 515 523 a FA(Raising)30 b(ev)m(en)m(ts)515
676 y Fz(When)40 b(an)g(ev)n(en)n(t)g(happ)r(ens,)j(this)e(metho)r(d)g
(arranges)c(for)j(its)g(handler)g(to)g(b)r(e)g(called.)515
776 y(Although)27 b(traps)f(cannot)h(b)r(e)g(raised)f(arti\014cially)-7
b(,)26 b(in)n(terrupts)h(can)f(\(e.g.)37 b(to)27 b(notify)g(users)515
876 y(of)h(arti\014cial)f(in)n(terrupts)g(\\caused)g(b)n(y)h(the)g(k)n
(ernel",)f(and)h(not)g(b)n(y)g(the)g(hardw)n(are\).)36
b(Both)515 975 y(from)f Fx(Trap)p Fz(s)g(and)h Fx(Irq)p
Fz(s)e(can)i Fx(raise)e Fz(b)r(e)i(called)g(to)g(automatically)f(build)
h Fx(EventReq)p Fz(s.)515 1075 y(Whenev)n(er)28 b(additional)h
(information)f(should)h(b)r(e)g(deliv)n(ered)g(along)f(with)h(the)h
(trap)e(\(e.g.)515 1174 y(the)d(faulting)h(address)e(on)h(page)f
(faults,)i(etc.\))37 b(the)25 b(message)f(should)h(b)r(e)h(built)g
(explicitly)-7 b(.)515 1307 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 1307 24 4 v 29 w(Event)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 1399 y Fi(//)39 b(Artificially)j(raises)f(an)
f(instance)h(of)e(this)i(event.)598 1490 y(inline)f(err_t)h
(raise\(const)g(off_shtl_id_t)i(&sender,)1343 1581 y(vm_size_t)e(msz,)f
(vm_size_t)i(rsz,)1343 1673 y(off_EventReq)g(*m,)e(off_EventRep)i
(*r\);)639 1814 y Fz(T)-7 b(o)32 b(raise)f(an)h(ev)n(en)n(t)g(w)n(e)g
(simply)g(in)n(v)n(ok)n(e)f(its)i(handler)e(passing)g(as)h(an)g
(argumen)n(t)f(an)515 1913 y(instance)c(of)h(ev)n(en)n(t)f(b)r(eing)g
(raised.)515 2046 y Fk(h)p Fi(off)p 667 2046 V 29 w(Event::raise)j
Fj(implementation.)d Fk(i)p Fq(\021)598 2137 y Fi(//)39
b(raises)i(an)f(instance)h(for)f(this)g(event.)598 2229
y(//)f(Artificially)j(raises)f(an)f(instance)h(of)e(this)i(event.)598
2320 y(inline)f(err_t)h(off_Event::raise\(const)j(off_shtl_id_t)e
(&sender,)1775 2411 y(vm_size_t)f(msz,)f(vm_size_t)h(rsz,)1775
2503 y(off_EventReq)h(*m,)d(off_EventRep)j(*r\))598 2594
y({)676 2685 y(ev_count++;)748 b(//)40 b(We)f(might)i(loose)f(some)g
(event)h(counts)f(:-\))676 2777 y(assert\(ev_hndlr\);)514
b(//)40 b(But)g(that's)g(the)g(worse)g(that)h(might)f(happen.)676
2868 y(return)h(\(*ev_hndlr\)\(sender,msz,rsz,m,r)q(\);)598
2959 y(})639 3101 y Fz(This)30 b(metho)r(d)h(is)f(also)f(resp)r
(onsible)h(for)f(a)h(p)r(er-ev)n(en)n(t)f(coun)n(ter,)h
Fx(ev)p 2807 3101 27 4 v 31 w(count)p Fz(,)f(main)n(te-)515
3200 y(nance.)515 3316 y Fk(h)p Fj(Other)f(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3316 24 4 v 29 w(Event)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 3408 y Fi(natural_t)41 b(ev_count;)512
b(//)40 b(How)g(many)g(instances)h(up)f(to)f(now.)515
3565 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 3565 V 29 w(Event)p Fj(.)h Fk(i)p
Fq(\021)598 3657 y Fi(ev_count\(0\))639 3798 y Fz(The)23
b(ev)n(en)n(t)f Fx(raise)f Fz(metho)r(d)i(gets)f(called)h(b)n(y)f
(calling)g(to)h Fx(raise)d Fz(metho)r(ds)j(of)g(concrete)515
3898 y(ev)n(en)n(ts.)33 b(Initially)-7 b(,)23 b(there)d(are)f(generic)h
Fx(raise)p Fz(s)e(for)i(traps)g(and)g(in)n(terrupts.)34
b(Sp)r(eci\014c)21 b(traps)515 3997 y(or)33 b(in)n(terrupts)g(migh)n(t)
g(rede\014ne)h Fx(raise)e Fz(to)h(gather)g(ev)n(en)n(t)g(information)g
(from)g(mac)n(hine)515 4097 y(dep)r(enden)n(t)28 b(data.)515
4230 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4230 V 29 w(Trap)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
4321 y Fi(//)39 b(raises)i(an)f(instance)h(for)f(this)g(trap.)598
4412 y(err_t)g(raise\(off_shtl_id_t)k(&id,vm_size_t)e(msz,vm_size_t)g
(rsz,)1068 4504 y(off_TrapReq)g(*m,)e(off_TrapRep)i(*r)e(\);)1885
5255 y Fz(333)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
334 335 bop 639 523 a Fz(F)-7 b(or)27 b(hardw)n(are)e(traps,)i(w)n(e)f
(usually)h(receiv)n(e)f(the)i(trap)e(error)g(n)n(um)n(b)r(er)h(and)g(a)
f(p)r(oin)n(ter)515 623 y(to)35 b(the)g(mac)n(hine)g(dep)r(enden)n(t)h
(register)e(set.)59 b(W)-7 b(e)36 b(then)f(deliv)n(er)g(a)f(trap)h(ev)n
(en)n(t)g(request)515 722 y(message)26 b(with)i(the)g(trap)f(and)h
(error)d(n)n(um)n(b)r(ers.)515 855 y Fk(h)p Fi(off)p
667 855 24 4 v 29 w(Trap::raise)k Fj(implementation.)f
Fk(i)p Fq(\021)598 946 y Fi(//)39 b(raises)i(an)f(instance)h(for)f
(this)g(trap.)598 1038 y(err_t)g(off_Trap::raise\(off_shtl_id_t)46
b(&id,vm_size_t)c(msz,vm_size_t)g(rsz,)1461 1129 y(off_TrapReq)f(*m,)f
(off_TrapRep)i(*r)e(\))598 1220 y({)676 1312 y(err_t)h(err;)676
1403 y(assert\(valid\(\))i(&&)c(!r->m_err\);)676 1494
y(if)h(\(\(err=off_Event::raise\(id,msz,)q(rsz,)q(m,r\))q(\)\))755
1586 y(return)g(err;)676 1677 y(else)755 1768 y(return)g(r->m_err;)598
1951 y(})639 2183 y Fz(F)-7 b(or)27 b(in)n(terrupts)g(w)n(e)h(deliv)n
(er)e(just)i(the)g(in)n(terrupt)g(n)n(um)n(b)r(er.)515
2316 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2316 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
2408 y Fi(//)39 b(raises)i(an)f(instance)h(for)f(this)g(event.)598
2499 y(err_t)g(raise\(void\);)515 2673 y Fk(h)p Fi(off)p
667 2673 V 29 w(Irq::raise)29 b Fj(implementation.)f
Fk(i)p Fq(\021)598 2765 y Fi(//)39 b(raises)i(an)f(instance)h(for)f
(this)g(event.)598 2856 y(err_t)g(off_Irq::raise\(void\))598
2947 y({)676 3039 y Fk(h)p Fj(Ensur)l(e)29 b Fi(this)f
Fj(interrupt)i(c)l(an)e(b)l(e)g(r)l(aise)l(d.)g Fk(i)676
3130 y Fi({)755 3221 y(static)40 b(off_shtl_id_t)i(dummy;)755
3313 y(off_IrqReq)f(m\(get_id\(\)\);)755 3404 y(assert\(valid\(\)\);)
755 3495 y(return)f(off_Event::raise\(dummy,sizeo)q(f\(m\))q(,0,&m)q
(,NUL)q(L\);)676 3587 y(})598 3678 y(})639 3819 y Fz(Going)18
b(bac)n(k)g(to)g(accoun)n(ting,)h(the)g(ev)n(en)n(t)f(coun)n(ter)f(can)
h(b)r(e)h(obtained)f(with)h Fx(get)p 3113 3819 27 4 v
30 w(count)p Fz(.)515 3952 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3952 24 4 v 29 w(Event)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 4043 y Fi(//)39 b(How)h(many)g(instances)i(so)d
(far?)598 4134 y(natural_t)i(get_count\(void\))i(const;)515
4309 y Fk(h)p Fi(off)p 667 4309 V 29 w(Event::get)p 1086
4309 V 30 w(count)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4400 y Fi(//)39 b(How)h(many)g(instances)i(so)d(far?)598
4491 y(natural_t)i(off_Event::get_count\(void\))k(const)c({)e(return)i
(ev_count;)g(})639 4633 y Fz(The)28 b(ev)n(en)n(t)f(table)h(pro)n
(vides)e(a)h(total)g(coun)n(t.)515 4749 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 4749 V 29 w(EventTbl)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 4840 y Fi(//)39 b(How)h(many)g(event)h
(instances)g(so)f(far?)598 4932 y(virtual)h(natural_t)g
(get_count\(void\))h(=0;)1885 5255 y Fz(334)p eop
PStoPSsaved restore
%%Page: (336,337) 169
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
335 336 bop 639 523 a Fz(T)-7 b(rap)32 b(and)h(in)n(terrupt)f(tables)h
(implemen)n(t)g(it)g(b)n(y)g(computing)f(the)h(total)g(n)n(um)n(b)r(er)
f(of)515 623 y(ev)n(en)n(ts.)515 739 y Fk(h)p Fj(Other)c(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 739 24 4 v 29 w(TrapTbl)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 830 y Fi(//)39 b(How)h(many)g(trap)h
(instances)g(so)f(far?)598 922 y(virtual)h(natural_t)g
(get_count\(void\);)515 1079 y Fk(h)p Fj(Other)28 b(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 1079 V 29 w(IntTbl)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 1171 y Fi(//)39 b(How)h(many)g(interrupt)i
(instances)f(so)f(far?)598 1262 y(virtual)h(natural_t)g
(get_count\(void\);)515 1436 y Fk(h)p Fi(off)p 667 1436
V 29 w(TrapTbl::get)p 1164 1436 V 30 w(count)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 1528 y Fi(//)39 b(How)h(many)g(trap)h(instances)g
(so)f(far?)598 1619 y(natural_t)h(off_TrapTbl::get_count\(void\))598
1710 y({)676 1802 y(natural_t)g(c=0;)676 1893 y(assert\(valid\(\)\);)
676 1984 y(for)f(\(natural_t)i(e=0;)e(e<OFF_MDEP_NTRP_MAX;)k(e++\))755
2076 y(c+=)c(\(\(*this\)+e\)->get_count\(\);)676 2167
y(return)h(c;)598 2258 y(})515 2524 y Fk(h)p Fi(off)p
667 2524 V 29 w(IntTbl::get)p 1125 2524 V 30 w(count)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 2615 y Fi(//)39
b(How)h(many)g(interrupt)i(instances)f(so)f(far?)598
2707 y(natural_t)h(off_IntTbl::get_count\(void\))598
2798 y({)676 2889 y(natural_t)g(c=0;)676 2980 y(assert\(valid\(\)\);)
676 3072 y(for)f(\(natural_t)i(e=0;)e(e<OFF_MDEP_NINT_MAX;)k(e++\))755
3163 y(c+=)c(\(\(*this\)+e\)->get_count\(\);)676 3254
y(return)h(c;)598 3346 y(})1885 5255 y Fz(335)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
336 337 bop 515 523 a FA(Virtual)32 b(traps)515 676 y
Fz(There)f(are)f(some)h(\\traps")f(de\014ned)i(b)n(y)f
Fy(O\013)17 b Fx(++)31 b Fz(itself)h(and)f(not)g(b)n(y)h(the)f(arc)n
(hitecture)g(it)515 776 y(runs)c(on,)g(some)g(of)h(them)g(ha)n(v)n(e)e
(app)r(eared)h(b)r(efore)g(and)h(some)f(will)h(app)r(ear)e(later)h(on.)
515 909 y Fk(h)p Fj(O\013)g(Virtual)h(tr)l(aps.)g Fk(i)p
Fq(\021)598 1000 y Fi(//)39 b(Virtual)i(\(Off++)g(raised\))g
(exceptions)598 1091 y(enum)393 b({)39 b(OFF_EX_UNUSED=OFF_MDEP_NPTR)q
(P_MAX)q(,)45 b(//)40 b(Resource)h(no)f(longer)2559 1183
y(//referenced.)1225 1274 y(OFF_EX_MISSING,)239 b(//)40
b(Resource)h(missing)g(\(remote?\).)1225 1365 y(OFF_EX_UNAVAILABLE,)83
b(//)40 b(Resource)h(exhaust.)g(Revocation)g(needed.)1225
1457 y(OFF_EX_RELOC,)317 b(//)40 b(Resource)h(has)f(changed)h(its)f
(location.)1225 1548 y(OFF_EX_FROZEN,)278 b(//)40 b(Reference)h(to)f(a)
f(frozen)i(resource.)1225 1639 y(OFF_EX_XDT,)395 b(//)40
b(Translation)i(to)d(native)i(format)f(needed.)1225 1731
y(OFF_EX_FWD,)395 b(//)40 b(Request)h(should)f(be)g(processed)h
(remotely.)1225 1822 y(OFF_EX_SCERR,)317 b(//)40 b(System)g(call)h
(failed.)1225 1913 y(OFF_EX_PUTS,)356 b(//)40 b(Mom!,)g(--The)h(kernel)
f(cried)h(out)e(loud.)1225 2005 y Fk(h)p Fj(Other)29
b(virtual)f(tr)l(aps.)h Fk(i)1225 2096 y Fi(};)598 2187
y(typedef)41 b(natural_t)g(off_ex_t;)515 2453 y Fk(h)p
Fj(O\013)27 b(Virtual)h(tr)l(aps)h(dep)l(endencies.)g
Fk(i)p Fq(\021)598 2544 y Fi(#include)41 b(<hw/mdep/mEventTbl.h>)83
b(//)40 b(for)g(OFF_MDEP_NPTRP_MAX)639 2685 y Fz(These)i(virtual)f
(traps)f(are)h(de\014ned)h(in)g Fx(prtl/ex.h)c Fz(b)r(ecause)j(they)h
(are)e(used)i(for)515 2785 y(k)n(ernel-user)25 b(exceptions.)37
b(W)-7 b(e)28 b(simply)f(include)h(their)g(de\014nition.)515
2901 y Fk(h)p Fj(O\013)f(event)i(dep)l(endencies.)g Fk(i)p
Fz(+)o Fq(\021)598 2993 y Fi(#include)41 b(<prtl/ex.h>)473
b(//)40 b(for)g(off_ex_t)h(and)f(event)g(types.)639 3117
y Fz(In)27 b(an)n(y)e(case,)h(the)h(n)n(um)n(b)r(er)f(of)g(virtual)g
(traps)g(m)n(ust)g(not)h(exceed)f Fx(MDEP)p 2908 3117
27 4 v 29 w(NVTRAP)p 3201 3117 V 29 w(MAX)p Fz(.)515
3217 y(The)e(mac)n(hine)g(dep)r(enden)n(t)g(trap)g(table)g(implemen)n
(tation)g(reserv)n(es)e(this)j(n)n(um)n(b)r(er)e(of)i(trap)515
3316 y(en)n(tries)i(for)g(fak)n(e)g(traps)g(raised)f(b)n(y)h(the)h(k)n
(ernel.)639 3416 y(T)-7 b(o)24 b(implemen)n(t)g(virtual)f(traps,)h(the)
g(trap)f(table)h(only)f(needs)h(to)g(allo)r(cate)f(and)g(deallo-)515
3516 y(cate)j(them.)37 b(They)26 b(are)g(nev)n(er)f(raised)g(nor)h
(handled)g(b)n(y)h(the)f(hardw)n(are;)f(they)i(are)e(raised)515
3615 y(b)n(y)i(the)h(k)n(ernel.)639 3715 y(Finally)-7
b(,)35 b(there)f(are)f(a)g(bunc)n(h)h(of)f(metho)r(ds)h(returning)f
(iden)n(ti\014ers)g(for)g(virtual)g(and)515 3815 y(w)n(ell-kno)n(wn)24
b(traps)h(\(alternativ)n(ely)-7 b(,)25 b(the)g(trap)g(table)h(na)n
(vigator)d(can)i(b)r(e)h(used)f(to)h(insp)r(ect)515 3914
y(trap)h(names)g(and)g(iden)n(ti\014ers\).)515 4047 y
Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4047 24 4 v 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4138 y Fi(//)39 b(Returns)i(the)f(id)g(for)g(the)g(first)g
(virtual)h(trap)598 4230 y(off_ev_id_t)g(get_vtrap0\(void\))i(const;)
598 4321 y(//)c(Returns)i(the)f(id)g(for)g(the)g(page)g(fault)g(trap.)
598 4412 y(off_ev_id_t)h(get_pgflt\(void\))82 b(const;)598
4504 y(//)39 b(Returns)i(the)f(id)g(for)g(the)g(NOFPU)g(trap.)598
4595 y(off_ev_id_t)h(get_nofpu\(void\))82 b(const;)1885
5255 y Fz(336)p eop
PStoPSsaved restore
%%Page: (338,339) 170
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
337 338 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(TrapTbl::get)p 1164 523 V 30 w(vtrap0)29 b Fj(and)f
Fi(get)p 1723 523 V 29 w(pgflt)h Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Returns)i(the)f(id)g(for)g(the)g
(first)g(virtual)h(trap)598 706 y(off_ev_id_t)g
(off_TrapTbl::get_vtrap0\(voi)q(d\))k(const)598 797 y({)676
888 y(off_ev_id_t)d(t\(get_id\(\),OFF_MDEP_NPTRP_MAX)q(\);)676
980 y(return)f(t;)598 1071 y(})598 1162 y(//)e(Returns)i(the)f(id)g
(for)g(the)g(page)g(fault)g(trap.)598 1254 y(off_ev_id_t)h
(off_TrapTbl::get_pgflt\(void)q(\))84 b(const)598 1345
y({)676 1436 y(off_ev_id_t)42 b(t\(get_id\(\),off_mdepTrapTbl::g)q
(et_pg)q(flt\()q(\)\);)676 1528 y(return)f(t;)598 1619
y(})598 1710 y(//)e(Returns)i(the)f(id)g(for)g(the)g(NOFPU)g(trap.)598
1802 y(off_ev_id_t)h(off_TrapTbl::get_nofpu\(void)q(\))84
b(const)598 1893 y({)676 1984 y(off_ev_id_t)42 b
(t\(get_id\(\),off_mdepTrapTbl::g)q(et_no)q(fpu\()q(\)\);)676
2076 y(return)f(t;)598 2167 y(})515 2516 y FA(Virtual)32
b(in)m(terrupts)722 2669 y(NOTE:)21 b Fz(XXX)h(T)-7 b(o)21
b(detect)h(in)n(terrupts)f(\(for)g(user-lev)n(el)f(prob)r(e)h
(routines\))g(w)n(e)722 2768 y(m)n(ust)27 b(allo)n(w)e(for)h
Fx(alloc)f Fz(without)h(a)g(pre-sp)r(eci\014ed)g(n)n(um)n(b)r(er.)37
b(Suc)n(h)26 b(metho)r(d)722 2868 y(should)i(allo)r(cate)g(and)g
(return)f(the)i(next)g(unhandled)f(in)n(terrupt.)39 b(Or)27
b(do)h(w)n(e)722 2968 y(not)g(w)n(an)n(t)f(a)g(PnP)g(k)n(ernel?)639
3150 y(The)38 b(k)n(ernel)g(handles)f(itself)i(the)f(clo)r(c)n(k)g(in)n
(terrupt)f(to)h(implemen)n(t)h(run)f(queues)g(in)515
3250 y(pro)r(cessors.)c(T)-7 b(o)27 b(re-exp)r(ort)e(the)i(clo)r(c)n(k)
f(in)n(terrupt)h(to)g(system)f(users,)h(there)f(are)g(a)h(prede-)515
3350 y(\014ned)j(n)n(um)n(b)r(er)f(of)h(timers)f(whic)n(h)h(can)f(b)r
(e)h(considered)f(to)g(b)r(e)h(virtual)g(clo)r(c)n(k)f(in)n(terrupts.)
515 3449 y(These)35 b(timers)g(are)f(allo)r(cated)h(and)g(deallo)r
(cated)g(b)n(y)g(asking)f(for)h(their)g(corresp)r(onding)515
3549 y(ev)n(en)n(ts)29 b(to)i(the)g(in)n(terrupt)f(table.)45
b(The)31 b(mac)n(hine)f(dep)r(enden)n(t)h(in)n(terrupt)f(table)g
(reserv)n(es)515 3648 y(up)c(to)h Fx(MDEP)p 915 3648
27 4 v 29 w(NVINT)p 1164 3648 V 30 w(MAX)e Fz(en)n(tries)g(for)h(fak)n
(e)g(virtual)g(in)n(terrupts)f(corresp)r(onding)g(to)h(these)515
3748 y(timers.)639 3848 y(T)-7 b(o)23 b(implemen)n(t)g(timer)g(in)n
(terrupts)f(the)h(in)n(terrupt)g(table)g(only)f(needs)h(to)f(allo)r
(cate)g(and)515 3947 y(deallo)r(cate)28 b(them.)40 b(Suc)n(h)29
b(in)n(terrupts)f(are)g(raised)f(b)n(y)i(the)g(k)n(ernel)f(on)g(resp)r
(onse)g(to)g(timer)515 4047 y(requests.)639 4147 y(A)i(new)f(metho)r(d)
h(of)f(in)n(terrupt)g(tables)h(return)e(the)i(iden)n(ti\014er)f(of)h
(the)f(\014rst)g(a)n(v)-5 b(ailable)515 4246 y(virtual)27
b(in)n(terrupt.)515 4379 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4379 24 4 v 29 w(IntTbl)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 4470 y Fi(inline)40 b(off_ev_id_t)i
(get_vint0\(void\))h(const;)1885 5255 y Fz(337)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
338 339 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IntTbl::get)p 1125 523 V 30 w(vint0)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(inline)40 b(off_ev_id_t)i
(off_IntTbl::get_vint0\(void\))j(const)598 706 y({)676
797 y(off_ev_id_t)d(i\(get_id\(\),OFF_MDEP_VINT0_IRQ)q(\);)676
888 y(return)f(i;)598 980 y(})639 1212 y Fz(Where)28
b Fx(MDEP)p 1086 1212 27 4 v 29 w(VINT0)p 1335 1212 V
30 w(IRQ)e Fz(is)i(the)g(n)n(um)n(b)r(er)f(of)h(the)g(\014rst)f
(virtual)g(in)n(terrupt.)639 1312 y(The)h(same)f(is)g(done)h(for)f(the)
h(\\w)n(ell-kno)n(wn")d(timer)j(in)n(terrupt.)515 1428
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1428 24 4 v 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
1519 y Fi(inline)40 b(off_ev_id_t)i(get_clk\(void\))g(const;)515
1677 y Fk(h)p Fi(off)p 667 1677 V 29 w(IntTbl::get)p
1125 1677 V 30 w(clk)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 1768 y Fi(inline)40 b(off_ev_id_t)i
(off_IntTbl::get_clk\(void\))j(const)598 1860 y({)676
1951 y(off_ev_id_t)d(i\(get_id\(\),OFF_MDEP_CLOCK_IRQ)q(\);)676
2042 y(return)f(i;)598 2134 y(})515 2482 y FA(In)m(terrupt)33
b(masking)515 2636 y Fz(In)n(terrupts)27 b(can)g(b)r(e)h(mask)n(ed)f
(and)g(ac)n(kno)n(wledged.)515 2768 y Fk(h)p Fj(Other)h(public)g(metho)
l(ds)h(of)e Fi(off)p 1493 2768 V 29 w(Irq)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 2860 y Fi(//)39 b(Masks)i(the)f(interrupt.)598
2951 y(void)g(mask\(void\);)598 3042 y(//)f(Unmasks)i(the)f(interrupt.)
598 3134 y(void)g(unmask\(void\);)598 3225 y(//)f(Is)h(this)g
(interrupt)i(masked?)598 3316 y(boolean_t)f(is_masked\(void\))i(const;)
515 3491 y Fk(h)p Fj(O\013)27 b(event)i(dep)l(endencies.)g
Fk(i)p Fz(+)o Fq(\021)598 3582 y Fi(#include)41 b(<klib/mdep/types.h>)
161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
3673 y(#include)h(<klib/err.h>)434 b(//)40 b(for)g(err_t)639
3814 y Fz(In)n(terrupt)32 b(masks)f(are)g(handled)h(b)n(y)g(the)g(ev)n
(en)n(t)f(table,)i(where)f(they)g(can)g(b)r(e)g(imple-)515
3914 y(men)n(ted)c(more)e(e\016cien)n(tly)-7 b(.)515
4030 y Fk(h)p Fi(off)p 667 4030 V 29 w(Irq::mask)29 b
Fj(implementation.)e Fk(i)p Fq(\021)598 4122 y Fi(//)39
b(Masks)i(the)f(interrupt.)598 4213 y(void)g(off_Irq::mask\(void\))598
4304 y({)676 4396 y(\(\(off_IntTbl*\)\(get_container)q(\(\)\)\)-)q
(>mas)q(k\(th)q(is\);)598 4487 y(})1885 5255 y Fz(338)p
eop
PStoPSsaved restore
%%Page: (340,341) 171
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
339 340 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Irq::unmask)29 b Fj(implementation.)f Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Masks)i(the)f(interrupt.)598 706 y(void)g
(off_Irq::unmask\(void\))598 797 y({)676 888 y
(assert\(\(\(off_IntTbl*\)\(get_co)q(ntain)q(er\(\))q(\)\)->)q(valid)q
(\(\)\);)637 980 y(\(\(off_IntTbl*\)\(get_container\()q(\)\)\)->)q
(unma)q(sk\(t)q(his\);)598 1071 y(})515 1245 y Fk(h)p
Fi(off)p 667 1245 V 29 w(Irq::is)p 969 1245 V 29 w(masked)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 1337 y Fi(//)39
b(Is)h(this)g(interrupt)i(masked?)598 1428 y(boolean_t)f
(off_Irq::is_masked\(void\))k(const)598 1519 y({)676
1611 y(assert\(\(\(off_IntTbl*\)\(get_co)q(ntain)q(er\(\))q(\)\)->)q
(valid)q(\(\)\);)676 1702 y(return)c
(\(\(off_IntTbl*\)\(get_container\(\))q(\)\)->)q(is_ma)q(sked)q(\(this)
q(\);)598 1793 y(})639 1934 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(th)n(us)g
(new)h(metho)r(ds)g(of)f Fx(IntTbl)p Fz(.)515 2051 y
Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2051 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2142 y Fi(//)39 b(Masks)i(the)f(interrupt.)598 2233 y(void)g
(off_IntTbl::mask\(off_Irq)45 b(*i\);)598 2325 y(//)39
b(Unmasks)i(the)f(interrupt.)598 2416 y(void)g
(off_IntTbl::unmask\(off_Irq)45 b(*i\);)598 2507 y(//)39
b(Is)h(this)g(interrupt)i(masked?)598 2599 y(boolean_t)f
(off_IntTbl::is_masked\(const)k(off_Irq)c(*i\))f(const;)639
2723 y Fz(They)30 b(simply)f(forw)n(ard)f(the)i(request)f(to)g(the)h
(mac)n(hine)f(dep)r(enden)n(t)h(part,)f(where)g(an)515
2823 y(in)n(terrupt)e(mask)g(is)g(usually)h(implemen)n(ted)g(as)f(a)g
(w)n(ord-sized)f(bitmap.)515 2956 y Fk(h)p Fi(off)p 667
2956 V 29 w(IntTbl::mask)k(unmask)f Fj(and)e Fi(is)p
1683 2956 V 29 w(masked)i Fj(implementation.)e Fk(i)p
Fq(\021)598 3047 y Fi(//)39 b(Masks)i(the)f(interrupt.)598
3138 y(inline)g(void)g(off_IntTbl::mask\(off_Irq)45 b(*i\))598
3230 y({)676 3321 y(i_mdep.mask\(*i\);)598 3412 y(})598
3504 y(//)39 b(Unmasks)i(the)f(interrupt.)598 3595 y(inline)g(void)g
(off_IntTbl::unmask\(off_Irq)46 b(*i\))598 3686 y({)676
3778 y(i_mdep.unmask\(*i\);)598 3869 y(})598 3960 y(//)39
b(Is)h(this)g(interrupt)i(masked?)598 4051 y(inline)e(boolean_t)i
(off_IntTbl::is_masked\(const)j(off_Irq)c(*i\))f(const)598
4143 y({)676 4234 y(return)h(i_mdep.is_masked\(*i\);)598
4325 y(})639 4467 y Fz(As)28 b(w)n(e)f(ha)n(v)n(e)g(seen,)g(a)g(mac)n
(hine)g(dep)r(enden)n(t)i(in)n(terrupt)e(table)g(is)h(stored)f(in)h
Fx(i)p 3115 4467 27 4 v 31 w(mdep)p Fz(.)515 4599 y Fk(h)p
Fj(Other)g(private)h(memb)l(ers)f(of)g Fi(off)p 1552
4599 24 4 v 29 w(IntTbl)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598
4691 y Fi(off_mdepIntTbl)42 b(i_mdep;)237 b(//)40 b(Machine)h
(dependent)g(interrupt)g(table.)1885 5255 y Fz(339)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
340 341 bop 515 523 a FA(In)m(terrupt)33 b(priorities)515
676 y Fz(Whenev)n(er)38 b(an)g(in)n(terrupt)g(happ)r(ens,)k(w)n(e)c(m)n
(ust)h(c)n(ho)r(ose)e(either)i(to)f(evict)h(the)g(curren)n(t)515
776 y(sh)n(uttle)30 b(to)g(dispatc)n(h)g(the)h(in)n(terrupt)f(to)g(its)
g(handler)g(or)f(to)h(defer)g(in)n(terrupt)g(deliv)n(ering)515
876 y(in)f(fa)n(v)n(or)f(of)h(the)g(curren)n(t)g(sh)n(uttle.)42
b(T)-7 b(o)29 b(mak)n(e)f(a)h(c)n(hoice,)g(b)r(oth)g(sh)n(uttles)h(and)
f(in)n(terrupts)515 975 y(ha)n(v)n(e)d(priorit)n(y-lev)n(els)f(\(see)j
(section)f FA(??)37 b Fz(for)27 b(a)g(discussion)g(of)h(in)n(terrupt)f
(priorities\).)515 1108 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1108 24 4 v 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 1199 y Fi(//)39 b(Sets/Gets)j(the)e(priority)h(level)f(for)
g(this)g(interrupt.)598 1291 y(void)g(set_prty\(const)i(off_pl_t)f
(prty\);)598 1382 y(off_pl_t)g(get_prty\(void\))h(const;)639
1523 y Fz(where)515 1639 y Fk(h)p Fj(O\013)27 b(interrupt)i(priority)g
(level)e(data)i(typ)l(e.)f Fk(i)p Fq(\021)598 1731 y
Fi(typedef)41 b(unsigned8_t)g(off_pl_t;)639 1855 y Fz(Eac)n(h)27
b(in)n(terrupt)g(con)n(tains)g(its)g(curren)n(t)g(priorit)n(y)-7
b(,)515 1971 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1971 V 29 w(Irq)p Fj(.)f Fk(i)p Fq(\021)598
2063 y Fi(off_pl_t)41 b(i_pl;)707 b(//)40 b(priority)h(level.)639
2187 y Fz(whic)n(h)27 b(is)h(set)f(b)n(y)g(default)h(to)f(a)f(v)-5
b(alue)28 b(lo)n(w)n(er)d(\(i.e.)37 b(higher)27 b(priorit)n(y\))f(than)
i(that)f(used)515 2287 y(b)n(y)g(default)h(in)g(sh)n(uttles.)515
2403 y Fk(h)p Fj(Initialize)e(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 2403 V 29 w(Irq)p Fj(.)h Fk(i)p Fq(\021)598
2494 y Fi(i_pl\(OFF_NPL_IDFL\),)515 2652 y Fk(h)p Fi(off)p
667 2652 V 29 w(Irq::set)p 1008 2652 V 30 w(prty)g Fj(implementation.)f
Fk(i)p Fq(\021)598 2744 y Fi(//)39 b(Sets/Gets)j(the)e(priority)h
(level)f(for)g(this)g(interrupt.)598 2835 y(void)g
(off_Irq::set_prty\(const)k(off_pl_t)d(prty\))598 2926
y({)676 3018 y(assert\(valid\(\)\);)676 3109 y(i_pl)f(=)g(prty;)598
3200 y(})515 3374 y Fk(h)p Fi(off)p 667 3374 V 29 w(Irq::get)p
1008 3374 V 30 w(prty)28 b Fj(implementation.)f Fk(i)p
Fq(\021)598 3466 y Fi(off_pl_t)41 b(off_Irq::get_prty\(void\))j(const)
598 3557 y({)676 3648 y(assert\(valid\(\)\);)676 3740
y(return)d(i_pl;)598 3831 y(})639 4064 y Fz(On)33 b(in)n(terrupt,)g(w)n
(e)g(defer)f(raising)f(when)i(the)g(in)n(terrupt)g(priorit)n(y)e(is)h
(lo)n(w)n(er)f(\(higher)515 4163 y(v)-5 b(alue\))27 b(than)h(that)g(of)
g(the)g(curren)n(t)e(sh)n(uttle.)515 4279 y Fk(h)p Fj(Ensur)l(e)i
Fi(this)h Fj(interrupt)g(c)l(an)f(b)l(e)g(r)l(aise)l(d.)g
Fk(i)p Fq(\021)598 4371 y Fi(#if)40 b(0)1059 b(//)40
b(XXX)g(fix)g(it)598 4462 y(if)f(\(get_prty\(\))j(>=)e
(off_Shtl::self\(\).get_prty\(\)\){)676 4553 y(defer\(\);)676
4645 y(return)h(EOK;)598 4736 y(})598 4827 y(#endif)1885
5255 y Fz(340)p eop
PStoPSsaved restore
%%Page: (342,343) 172
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
341 342 bop 639 523 a Fz(Where)25 b Fx(defer)e Fz(will)j(record)e(the)h
(curren)n(t)f(in)n(terrupt)h(as)g(p)r(ending)g(and)g(return)g(imme-)515
623 y(diately)-7 b(.)515 739 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)
j(metho)l(ds)e(of)e Fi(off)p 1594 739 24 4 v 29 w(Irq)p
Fj(.)g Fk(i)p Fq(\021)598 830 y Fi(//)39 b(Deferred)i(delivering.)598
922 y(void)f(defer\(void\);)639 1046 y Fz(A)28 b(coun)n(t)g(of)f(the)h
(n)n(um)n(b)r(er)f(of)h(deferred)f(in)n(terrupts)g(is)h(used.)515
1162 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1162 V 29 w(Irq)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 1254 y Fi(natural_t)41 b(i_pending;)473 b(//)40
b(Pending)h(count)515 1411 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 1411 V 29 w(Irq)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1503 y Fi(i_pending\(0\))639 1644 y Fz(After)i(adjusting)f(it)g(w)n(e)g
(tell)g(the)h(in)n(terrupt)e(table)h(that)h(a)e(new)h(in)n(terrupt)g
(has)g(b)r(een)515 1743 y(deferred.)515 1860 y Fk(h)p
Fi(off)p 667 1860 V 29 w(Irq::defer)g Fj(implementation.)f
Fk(i)p Fq(\021)598 1951 y Fi(//)39 b(Set)h(deferred)h(delivering.)598
2042 y(void)f(off_Irq::defer\(void\))598 2134 y({)676
2225 y(assert\(valid\(\)\);)676 2408 y(if)g(\(!)g(i_pending++\))755
2499 y(\(\(off_IntTbl*\)\(get_container\(\)\))q(\)->d)q(efer)q(\(this)q
(\);)598 2590 y(})639 2806 y Fz(When)35 b(the)h(pro)r(cessor)c(priorit)
n(y)h(lev)n(el)h(gets)h(lo)n(w)f(enough)g(for)g(the)h(in)n(terrupt)f
(to)h(b)r(e)515 2906 y(deliv)n(ered,)27 b Fx(deferred)d
Fz(will)k(complete)f(deliv)n(ering.)515 3022 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3022
V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 3113 y
Fi(//)39 b(Deferred)i(delivering.)598 3205 y(void)f(deferred\(void\);)
639 3329 y Fz(The)25 b(in)n(terrupt)g(error)e(co)r(de)i(\(whic)n(h)g
(will)g(usually)f(b)r(e)i(zero\))e(is)g(set)h(to)g(the)g(n)n(um)n(b)r
(er)g(of)515 3429 y(deferred)i(in)n(terrupts.)515 3545
y Fk(h)p Fi(off)p 667 3545 V 29 w(Irq::deferred)j Fj(implementation.)d
Fk(i)p Fq(\021)598 3636 y Fi(//)39 b(Deferred)i(delivering.)598
3728 y(inline)f(void)g(off_Irq::deferred\(void\))598
3819 y({)676 3910 y(natural_t)h(count=i_pending;)676
4002 y(assert\(valid\(\)\);)676 4184 y(while\(count--\))755
4276 y(raise\(\);)598 4367 y(})1885 5255 y Fz(341)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
342 343 bop 515 523 a FA(Deferred)32 b(in)m(terrupt)g(deliv)m(ering)515
676 y Fz(In)n(terrupt)24 b(tables)g(implemen)n(t)i Fx(defer)c
Fz(to)j(set)g(a)f(deferred)g(in)n(terrupt)g(and)h(also)f
Fx(spl)f Fz(to)i(b)r(e)515 776 y(noti\014ed)j(of)f(priorit)n(y)f(lev)n
(el)h(c)n(hanges)g(at)g(the)h(pro)r(cessor)e(a\013ected.)515
892 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 892 24 4 v 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
983 y Fi(//)39 b(Sets)i(an)e(interrupt)j(for)d(deferred)i(delivering.)
598 1075 y(void)f(defer\(off_Irq)i(*i\);)598 1166 y(//)d(Priority)i
(level)g(changed.)598 1257 y(void)f(spl\(off_pl_t)i(pl\);)639
1382 y Fz(W)-7 b(e)25 b(use)f(a)f(p)r(er-priorit)n(y-lev)n(el)f(mask)h
(similar)g(to)h(the)h(mac)n(hine)f(dep)r(enden)n(t)g(in)n(terrupt)515
1482 y(mask)j(for)g(deferred)g(in)n(terrupts.)515 1614
y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 1614 V 29 w(IntTbl)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598
1706 y Fi(off_mdepIrqMask)42 b(i_pending[OFF_NPL_MAX];)515
1880 y Fk(h)p Fj(O\013)27 b(limits.)f Fk(i)p Fq(\021)598
1971 y Fi(const)40 b(int)g(OFF_NPL_MAX)i(=)d(32;)197
b(//)40 b(Max.)g(number)g(of)g(interrupt)h(priorities.)515
2146 y Fk(h)p Fj(O\013)27 b(event)i(table)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2237 y Fi(#include)41 b(<klib/limits.h>)317
b(//)40 b(for)g(OFF_NPL_MAX)639 2378 y Fz(The)21 b(default)h(priorit)n
(y)d(lev)n(el)i(used)g(in)g(sh)n(uttles)g(is)g(the)g(middle)h(one)e(so)
h(that)g(b)n(y)g(default)515 2478 y(sh)n(uttles)27 b(yield)h(to)f(in)n
(terrupts.)515 2594 y Fk(h)p Fj(O\013)g(default)h(priority)g(levels.)g
Fk(i)o Fq(\021)598 2685 y Fi(const)40 b(int)g(OFF_NPL_DFL)i(=)d(16;)197
b(//)40 b(Default)h(priority)g(level)f(for)g(shuttles.)598
2777 y(const)g(int)g(OFF_NPL_IDFL=)81 b(8;)197 b(//)40
b(Default)h(priority)g(level)f(for)g(interrupts.)639
2901 y Fz(The)28 b(implemen)n(tation)g(of)f Fx(defer)f
Fz(simply)h(marks)g(the)h(in)n(terrupt)f(as)g(p)r(ending.)515
3018 y Fk(h)p Fi(off)p 667 3018 V 29 w(IntTbl::defer)j
Fj(implementation.)d Fk(i)p Fq(\021)598 3109 y Fi(//)39
b(Sets)i(an)e(interrupt)j(for)d(deferred)i(delivering.)598
3200 y(inline)f(void)g(off_IntTbl::defer\(off_Irq)45
b(*i\))598 3291 y({)676 3383 y(assert\(valid\(\)\);)676
3565 y(i_pending[i->get_prty\(\)].mas)q(k\(*i\))q(;)598
3657 y(})1885 5255 y Fz(342)p eop
PStoPSsaved restore
%%Page: (344,345) 173
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
343 344 bop 639 523 a Fz(Those)25 b(queues)h(are)f(scanned)g(on)h
(priorit)n(y)e(c)n(hanges)h(to)g(deliv)n(er)g(p)r(ending)i(in)n
(terrupts.)515 633 y Fk(h)p Fi(off)p 667 633 24 4 v 29
w(IntTbl::spl)i Fj(implementation.)f Fk(i)p Fq(\021)598
725 y Fi(//)39 b(Priority)i(level)g(changed.)598 816
y(void)f(off_IntTbl::spl\(off_pl_t)45 b(pl\))598 907
y({)676 999 y(assert\(valid\(\)\);)676 1181 y(for)40
b(\(off_pl_t)h(p=i_pl;)g(p<pl;)g(p++\))755 1273 y(while)f
(\(!i_pending[p].is_empty\(\)\))45 b({)833 1364 y(for)40
b(\(natural_t)i(i=0;)e(i)f(<)h(OFF_MDEP_NINT_MAX;)j(i++\))912
1455 y(if)c(\(i_pending[p].is_masked\(i\)\){)990 1547
y(i_pending[p].unmask\(i\);)990 1638 y(\(*this+i\)->deferred\(\);)912
1729 y(})755 1821 y(})676 1912 y(i_pl=pl;)598 2003 y(})639
2213 y Fz(W)-7 b(e)30 b(only)e(had)h(to)g(scan)f(the)i(range)d(from)i
(the)g(old)g(priorit)n(y)f(lev)n(el)g(\(k)n(ept)h(in)h
Fx(i)p 3131 2213 27 4 v 31 w(pl)p Fz(\))e(to)515 2313
y(the)g(new)f(one.)515 2423 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 2423 24 4 v 29 w(IntTbl)p Fj(.)g
Fk(i)p Fz(+)o Fq(\021)598 2515 y Fi(off_pl_t)41 b(i_pl;)707
b(//)40 b(Current)h(pl)515 2655 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 2655 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fq(\021)598 2746
y Fi(i_pl\(0\),)515 3003 y Fn(4.3.5)112 b(Ev)m(en)m(t)37
b(na)m(vigation)g(and)h(insp)s(ection)515 3156 y FA(Ev)m(en)m(t)32
b(T)-8 b(able)32 b(na)m(vigation)515 3310 y(Ev)m(en)m(t)g(T)-8
b(able)32 b(insp)s(ection)515 3463 y Fz(W)-7 b(e)28 b(need)f
Fx(get)p 988 3463 27 4 v 31 w(url)f Fz(and)h Fx(nameof)f
Fz(for)h(b)r(oth)h(trap)f(and)g(in)n(terrupt)h(tables.)515
3584 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3584 24 4 v 29 w(TrapTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3675 y Fi(//)39 b(Get)h(the)g(trap)g(table)h(URL.)598
3766 y(const)f(char)g(*get_url\(void\);)598 3858 y(//)f(Returns)i(the)f
(trap)g(table)h(name.)598 3949 y(const)f(char)g(*nameof\(void\);)515
4100 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4100 V 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 4191 y Fi(//)39 b(Get)h(the)g(interrupt)i(table)e(URL.)598
4283 y(const)g(char)g(*get_url\(void\);)598 4374 y(//)f(Returns)i(the)f
(interrupt)h(table)g(name.)598 4465 y(const)f(char)g(*nameof\(void\);)
639 4595 y Fz(The)26 b(URL)g(for)g(a)f(trap)g(\(in)n(terrupt\))h(table)
g(is)g(that)g(of)f(its)h(no)r(de)g(with)h Fx(trap.html)22
b Fz(\(or)515 4694 y Fx(int.html)p Fz(\))27 b(app)r(ended.)44
b(W)-7 b(e)31 b(use)f(a)f(new)h(mem)n(b)r(er,)h(a)f(c)n(haracter)e
(arra)n(y)f(initialized)k(the)515 4794 y(v)n(ery)26 b(\014rst)i(time)g
(it)g(is)f(needed.)515 4915 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 4915 V 29 w(TrapTbl)p Fj(.)g Fk(i)p
Fq(\021)598 5006 y Fi(static)40 b(char)g(*t_url;)512
b(//)40 b(URL)g(for)g(this)g(trap)g(table.)1885 5255
y Fz(343)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
344 345 bop 515 523 a Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 523 24 4 v 29 w(IntTbl)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 614 y Fi(static)40 b(char)g(*i_url;)512
b(//)40 b(URL)g(for)g(this)g(interrupt)h(table.)639 756
y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7 b(.)515 872
y Fk(h)p Fj(O\013)27 b(event)i(table)f(static)h(memb)l(ers.)f
Fk(i)p Fq(\021)598 963 y Fi(char)40 b(*off_TrapTbl::t_url=NULL;)162
b(//)40 b(URL)g(for)g(trap)g(tables.)598 1054 y(char)g
(*off_IntTbl::i_url=NULL;)162 b(//)40 b(URL)g(for)g(interrupt)h
(tables.)515 1212 y Fk(h)p Fi(off)p 667 1212 V 29 w(TrapTbl::get)p
1164 1212 V 30 w(url)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 1303 y Fi(//)39 b(Get)h(the)g(trap)g(table)h(URL.)598
1395 y(const)f(char)g(*off_TrapTbl::get_url\(void\))598
1486 y({)676 1577 y(assert\(valid\(\)\);)676 1669 y(if)g(\(!t_url\){)
755 1760 y(t_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_T)q(RAPTB)q(L_UR)q(L\)+1)q(];//+)q(1)k(for)40 b(\\0)755
1851 y(if)f(\(t_url\))833 1943 y(sprintf\(t_url,"\045s\045s",nd.get_u)q
(rl\(\))q(,OFF)q(_TRAP)q(TBL_)q(URL\);)676 2034 y(})676
2125 y(return)i(t_url;)598 2217 y(})515 2391 y Fk(h)p
Fi(off)p 667 2391 V 29 w(IntTbl::get)p 1125 2391 V 30
w(url)28 b Fj(implementation.)g Fk(i)p Fq(\021)598 2482
y Fi(//)39 b(Get)h(the)g(interrupt)i(table)e(URL.)598
2574 y(const)g(char)g(*off_IntTbl::get_url\(void\))598
2665 y({)676 2756 y(assert\(valid\(\)\);)676 2848 y(if)g(\(!i_url\){)
755 2939 y(i_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_I)q(NTTBL)q(_URL)q(\)+1])q(;//+1)46 b(for)40 b(\\0)755
3030 y(if)f(\(i_url\))833 3122 y(sprintf\(i_url,"\045s\045s",nd.get_u)q
(rl\(\))q(,OFF)q(_INTT)q(BL_U)q(RL\);)676 3213 y(})676
3304 y(return)i(i_url;)598 3396 y(})639 3537 y Fz(Where)28
b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n(e)f(URLs)g(for)g
(ev)n(en)n(t)g(tables.)515 3653 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l
(o)l(de)g(urls.)e Fk(i)p Fq(\021)598 3744 y Fi(const)40
b(char)g(OFF_TRAPTBL_URL[]="/trap.htm)q(l";)598 3836
y(const)g(char)g(OFF_INTTBL_URL[]="/irq.html")q(;)515
3993 y Fk(h)p Fj(O\013)27 b(event)i(table)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 4085 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_TRAPTBL_URL)i(et)e(al.)515 4259 y
Fk(h)p Fj(O\013)27 b(event)i(table)f(implementation)g(dep)l(endencies.)
h Fk(i)p Fq(\021)598 4350 y Fi(#include)41 b(<stdio.h>)551
b(//)40 b(for)g(sprintf)g(et)g(al)598 4442 y(#include)h(<node/Node.h>)
395 b(//)40 b(for)g(nd)639 4583 y Fz(The)30 b(name)f(for)h(an)f(ev)n
(en)n(t)g(table)h(is)f(that)h(of)g(its)g(no)r(de)f(complemen)n(ted)h
(with)g(a)f(little)515 4682 y(su\016x.)43 b(The)30 b(implemen)n(tation)
g(is)g(almost)f(the)h(same)f(of)h Fx(get)p 2486 4682
27 4 v 30 w(url)p Fz(,)g(ho)n(w)n(ev)n(er,)e(the)i(name)515
4782 y(is)d(not)h(shared)e(in)i(the)g(same)f(no)r(de)h(\(i.e.)37
b(it)28 b(is)g(not)f Fx(static)p Fz(\).)515 4915 y Fk(h)p
Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p 1552
4915 24 4 v 29 w(TrapTbl)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
5006 y Fi(char)40 b(*t_name;)512 b(//)39 b(name)h(for)g(this)h(trap)f
(table.)1885 5255 y Fz(344)p eop
PStoPSsaved restore
%%Page: (346,347) 174
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
345 346 bop 515 523 a Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 523 24 4 v 29 w(IntTbl)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 614 y Fi(char)40 b(*i_name;)512 b(//)39
b(name)h(for)g(this)h(interrupt)g(table.)515 789 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 789 V 29 w(TrapTbl)p Fj(.)i Fk(i)p Fq(\021)598
880 y Fi(t_name\(NULL\),)515 1054 y Fk(h)p Fj(Initialize)d(other)j
(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 1054
V 29 w(IntTbl)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 1146
y Fi(i_name\(NULL\))515 1320 y Fk(h)p Fi(off)p 667 1320
V 29 w(TrapTbl::nameof)i Fj(implementation.)e Fk(i)p
Fq(\021)598 1411 y Fi(//)39 b(Returns)i(the)f(trap)g(table)h(name.)598
1503 y(const)f(char)g(*off_TrapTbl::nameof\(void\))598
1594 y({)676 1685 y(assert\(valid\(\)\);)676 1777 y(if)g(\(!t_name\){)
755 1868 y(t_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q
(\("/t)q(rap"\))q(+9];)46 b(//)40 b(for)f(N...N\\0)755
1959 y(if)g(\(t_name\))833 2051 y(sprintf\(t_name,"\045s/trap\04508x",)
q(nd.n)q(ameo)q(f\(\),\()q(natu)q(ral_t)q(\)get)q(_id\()q(\)\);)676
2142 y(})676 2233 y(return)i(t_name;)598 2325 y(})515
2590 y Fk(h)p Fi(off)p 667 2590 V 29 w(IntTbl::nameof)30
b Fj(implementation.)e Fk(i)o Fq(\021)598 2682 y Fi(//)39
b(Returns)i(the)f(interrupt)h(table)g(name.)598 2773
y(const)f(char)g(*off_IntTbl::nameof\(void\))598 2864
y({)676 2956 y(assert\(valid\(\)\);)676 3047 y(if)g(\(!i_name\){)755
3138 y(i_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q(\("/i)q
(nt"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755 3230 y(if)f(\(i_name\))
833 3321 y(sprintf\(i_name,"\045s/int\04508x",n)q(d.na)q(meof)q
(\(\),\(n)q(atur)q(al_t\))q(get_)q(id\(\))q(\);)676 3412
y(})676 3504 y(return)i(i_name;)598 3595 y(})515 3943
y FA(Ev)m(en)m(t)32 b(insp)s(ection)515 4097 y Fz(W)-7
b(e)24 b(need)g Fx(get)p 981 4097 27 4 v 30 w(rurl)e
Fz(and)h Fx(get)p 1498 4097 V 30 w(url)p 1660 4097 V
31 w(holder)e Fz(for)i(b)r(oth)h(trap)f(and)h(in)n(terrupts)f(to)g
(supp)r(ort)515 4196 y Fx(ResUnit::get)p 1048 4196 V
26 w(url)p Fz(.)515 4329 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 4329 24 4 v 29 w(Trap)p
Fj(.)h Fk(i)o Fq(\021)598 4421 y Fi(//)39 b(Get)h(the)g(trap)g(URL.)598
4512 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)
g(OFF_TRAP_URL;)i(})598 4603 y(//)d(Returns)i(the)f(trap)g(name.)598
4694 y(virtual)h(char)f(*&get_url_holder\(void\);)1885
5255 y Fz(345)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
346 347 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(Irq)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Get)h(the)g(irq)g(URL.)598
706 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)g
(OFF_IRQ_URL;)i(})598 797 y(//)d(Returns)i(the)f(irq)g(name.)598
888 y(virtual)h(char)f(*&get_url_holder\(void\);)639
1029 y Fz(Where)28 b(w)n(e)f(m)n(ust)h(de\014ne)f(the)h(relativ)n(e)f
(URL)h(for)f(traps)515 1146 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l
(de)g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 1237 y Fi(const)40
b(char)g(OFF_TRAP_URL[]="#Trap";)515 1395 y Fk(h)p Fj(O\013)27
b(event)i(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
1486 y Fi(#include)41 b(<klib/url.h>)434 b(//)40 b(for)g(OFF_TRAP_URL)
639 1627 y Fz(and)28 b(in)n(terrupts.)515 1743 y Fk(h)p
Fj(O\013)f(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e Fk(i)p
Fz(+)p Fq(\021)598 1835 y Fi(const)40 b(char)g(OFF_IRQ_URL[]="#Irq";)
639 1959 y Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g(traps.)515
2076 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2076 V 29 w(Trap)p Fj(.)f Fk(i)p Fq(\021)598
2167 y Fi(static)40 b(char)g(*t_url;)512 b(//)40 b(URL)g(for)g(this)g
(trap)515 2325 y Fk(h)p Fi(off)p 667 2325 V 29 w(Trap::get)p
1047 2325 V 30 w(url)p 1194 2325 V 29 w(holder)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 2416 y Fi(char)40 b
(*&off_Trap::get_url_holder\(voi)q(d\))45 b({)79 b(return)41
b(t_url;)f(})639 2557 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 2673 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(static)f(memb)l(ers.)h
Fk(i)o Fq(\021)598 2765 y Fi(char)40 b(*off_Trap::t_url=NULL;)123
b(//)39 b(URL)h(for)g(trap.)639 2889 y Fz(URLs)28 b(are)f(also)f(the)i
(same)f(for)g(all)g(in)n(terrupts.)515 3005 y Fk(h)p
Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p 1552
3005 V 29 w(Irq)p Fj(.)f Fk(i)p Fz(+)p Fq(\021)598 3097
y Fi(static)40 b(char)g(*i_url;)512 b(//)40 b(URL)g(for)g(this)g
(interrupt.)515 3254 y Fk(h)p Fi(off)p 667 3254 V 29
w(Irq::get)p 1008 3254 V 30 w(url)p 1155 3254 V 29 w(holder)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 3346 y Fi(char)40
b(*&off_Irq::get_url_holder\(void)q(\))45 b({)79 b(return)40
b(i_url;)h(})639 3487 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 3603 y Fk(h)p Fj(O\013)27 b(interrupt)i(static)g(memb)l(ers.)f
Fk(i)p Fq(\021)598 3694 y Fi(char)40 b(*off_Irq::i_url=NULL;)122
b(//)40 b(URL)g(for)g(interrupt.)1885 5255 y Fz(346)p
eop
PStoPSsaved restore
%%Page: (348,349) 175
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
347 348 bop 515 523 a FA(Ev)m(en)m(t)32 b(table)g(na)m(vigation)g(and)g
(insp)s(ection)f Fg(C)7 b Fx(++)31 b FA(source)g(\014les)515
693 y Fn(4.3.6)112 b(F)-9 b(rozen)38 b(ev)m(en)m(ts)515
846 y FA(F)-8 b(reezing)31 b(ev)m(en)m(t)i(tables)515
999 y Fz(T)-7 b(o)21 b(freeze)h(an)g(ev)n(en)n(t)g(table)g(w)n(e)f
(freeze)h(eac)n(h)f(ev)n(en)n(t)h(in)g(turn.)36 b(Unlik)n(e)22
b(in)g(other)g(con)n(tainers,)515 1099 y(resource)29
b(units)j(are)e(frozen)g(eagerly)-7 b(,)31 b(not)g(lazily)-7
b(.)47 b(The)31 b(reason)f(is)h(that)h(w)n(e)e(exp)r(ect)i(few)515
1199 y(resource)26 b(units)i(and)f(doing)g(a)g(lazy)g(freeze/melt)g(w)n
(ould)g(degrade)g(p)r(erformance.)722 1381 y FA(NOTE:)g
Fz(XXX)i(implemen)n(t)f(them)g(all.)639 1564 y(W)-7 b(e)28
b(need)g(these)g(metho)r(ds)f(to)h(supp)r(ort)f Fx(freeze)p
Fz(,)515 1680 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)
e Fi(off)p 1594 1680 24 4 v 29 w(EventTbl)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 1771 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
1863 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 1954 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2045 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2137
y(const)f(off_prtl_id_t)i(&frozen_domain\))598 2228 y({)676
2319 y(//)e(XXX)g(complete)h(this.)676 2502 y(\(void\)buf;)h
(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)g(\(void\)toavail;)
676 2593 y(\(void\)frozen_domain;)676 2685 y(return)f(ENOSYS;)598
2776 y(})598 2959 y(//)e(Copy)i(static)f(resource)h(state)g(in)e
(curbuf)i(with)f(toavail)h(bytes.)598 3050 y(virtual)g(err_t)f
(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h(const)598
3141 y({)676 3233 y(\(void\)curto;)h(\(void\)toavail;)676
3324 y(return)f(ENOSYS;)598 3415 y(})1885 5255 y Fz(347)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
348 349 bop 639 523 a Fz(as)27 b(w)n(ell)h(as)e(these)i(others)f(to)g
(supp)r(ort)h Fx(melt)p Fz(:)515 639 y Fk(h)p Fj(Other)g(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 639 24 4 v
29 w(EventTbl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 731
y Fi(//)39 b(These)i(are)f(for)g(melt:)598 822 y(//)f(Does)i(resource)g
(cleanup.)g(No)e(external)i(resource)g(should)g(be)f(used)g(after)598
913 y(//)f(return.)598 1005 y(virtual)i(err_t)f(cleanup\(void\))598
1096 y({)676 1187 y(return)h(ENOSYS;)598 1279 y(})598
1370 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1461 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))598 1553 y({)676 1644 y(\(void\)buf;)i
(\(void\)bsize;)676 1735 y(return)f(ENOSYS;)598 1826
y(})598 1918 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
2009 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 2100 y(const)h(off_prtl_id_t)h
(&melted_domain\))598 2192 y({)676 2283 y(\(void\)buf;)g
(\(void\)bsize;)g(\(void\)from;)f(\(void\)size;)h
(\(void\)melted_domain;)676 2374 y(return)f(ENOSYS;)598
2466 y(})515 2798 y FA(F)-8 b(reezing)31 b(ev)m(en)m(ts)515
2951 y Fz(W)-7 b(e)28 b(need)f(to)h(implemen)n(t)g(only)f(these)h
(metho)r(ds:)515 3067 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 3067 V 29 w(Trap)p Fj(.)h Fk(i)o
Fz(+)p Fq(\021)598 3159 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 3250 y(virtual)g(err_t)f
(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h(const;)598
3433 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 3524 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 3615 y(//)f(Restores)i(dynamic)g
(resource)g(state.)639 3740 y Fz(And)28 b(also)f(for)g(in)n(terrupts.)
515 3856 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3856 V 29 w(Irq)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3947 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g(in)e
(curbuf)i(with)f(toavail)h(bytes.)598 4039 y(virtual)g(err_t)f
(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h(const;)598
4221 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 4313 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\);)598 4404 y(//)f(Restores)i(dynamic)g
(resource)g(state.)1885 5255 y Fz(348)p eop
PStoPSsaved restore
%%Page: (350,351) 176
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
349 350 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Trap::copy)p 1086 523 V 30 w(state)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 706 y(err_t)f
(off_Trap::copy_state\(char)45 b(*&curto,)c(size_t)g(&toavail\))g
(const)598 797 y({)676 888 y(assert\(valid\(\)\);)676
980 y(if)f(\(curto\){)755 1071 y(if)f(\(toavail<sizeof\(*this\)\))833
1162 y(return)i(ENOSPC;)755 1254 y(*\(off_Trap*\)curto)i(=)c(*this;)755
1345 y(assert\(\(\(off_Trap*\)curto\)->vali)q(d\(\)\))q(;)755
1436 y(curto)h(+=)g(sizeof\(*this\);)755 1528 y
(toavail-=sizeof\(*this\);)676 1619 y(})676 1710 y(return)h(EOK;)598
1802 y(})639 2034 y Fz(Note)28 b(ho)n(w)e(in)i(this)g(one)e(w)n(e)h
(tak)n(e)g(care)f(that)i(the)g(reference)e(to)h(the)h(con)n(tainer)e
(is)h(not)515 2134 y(a\013ected)g(b)n(y)h(the)g(state)f(restore.)515
2267 y Fk(h)p Fi(off)p 667 2267 V 29 w(Trap::restore)p
1203 2267 V 31 w(state)h Fj(implementation.)g Fk(i)p
Fq(\021)598 2358 y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g
(a)g(user)g(supplied)h(buffer.)598 2449 y(err_t)f
(off_Trap::restore_state\(char)46 b(*&buf,)40 b(size_t)h(&bsize\))598
2540 y({)676 2632 y(off_Trap)g(*other=\(off_Trap*\)buf;)676
2723 y(assert\(valid\(\)\);)676 2814 y(if)f(\(buf\){)755
2906 y(off_TrapTbl)h(*bank=\(off_TrapTbl*\)get_con)q(taine)q(r\(\);)755
2997 y(if)e(\(bsize)i(<)e(sizeof\(*this\)\){)833 3088
y(return)i(EINVAL;)755 3180 y(})755 3271 y(assert\(other->valid\(\)\);)
755 3362 y(*this=*other;)755 3454 y(set_container\(bank\);)755
3545 y(buf+=sizeof\(*this\);)755 3636 y(bsize-=sizeof\(*this\);)676
3728 y(})676 3819 y(return)g(EOK;)598 3910 y(})1885 5255
y Fz(349)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
350 351 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Irq::copy)p 1047 523 V 30 w(state)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g
(in)e(curbuf)i(with)f(toavail)h(bytes.)598 706 y(err_t)f
(off_Irq::copy_state\(char)45 b(*&curto,)c(size_t)f(&toavail\))i(const)
598 797 y({)676 888 y(assert\(valid\(\)\);)676 980 y(if)e(\(curto\){)
755 1071 y(if)f(\(toavail<sizeof\(*this\)\))833 1162
y(return)i(ENOSPC;)755 1254 y(*\(off_Irq*\)curto)i(=)c(*this;)755
1345 y(assert\(\(\(off_Irq*\)curto\)->valid)q(\(\)\);)755
1436 y(curto)h(+=)g(sizeof\(*this\);)755 1528 y
(toavail-=sizeof\(*this\);)676 1619 y(})676 1710 y(return)h(EOK;)598
1802 y(})515 2067 y Fk(h)p Fi(off)p 667 2067 V 29 w(Irq::restore)p
1164 2067 V 30 w(state)29 b Fj(implementation.)f Fk(i)o
Fq(\021)598 2159 y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g
(a)g(user)g(supplied)h(buffer.)598 2250 y(err_t)f
(off_Irq::restore_state\(char)45 b(*&buf,)c(size_t)g(&bsize\))598
2341 y({)676 2433 y(off_Irq)g(*other=\(off_Irq*\)buf;)676
2524 y(assert\(valid\(\)\);)676 2615 y(if)f(\(buf\){)755
2707 y(off_IntTbl)h(*bank=\(off_IntTbl*\)get_conta)q(iner\()q(\);)755
2798 y(if)e(\(bsize)i(<)e(sizeof\(*this\)\){)833 2889
y(return)i(EINVAL;)755 2980 y(})755 3072 y(assert\(other->valid\(\)\);)
755 3163 y(*this=*other;)755 3254 y(set_container\(bank\);)755
3346 y(buf+=sizeof\(*this\);)755 3437 y(bsize-=sizeof\(*this\);)676
3528 y(})676 3620 y(return)g(EOK;)598 3711 y(})1885 5255
y Fz(350)p eop
PStoPSsaved restore
%%Page: (352,353) 177
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
351 352 bop 515 523 a Fn(4.3.7)112 b(Dumping)37 b(ev)m(en)m(t)g(tables)
515 693 y(4.3.8)112 b(T)-9 b(raps)38 b(and)g(in)m(terrupts)f(for)g
(plain)g(users)515 838 y Fk(h)p Fj(O\013)27 b(event)i(table)f(for)g
(users.)g Fk(i)p Fq(\021)598 929 y Fi(class)40 b(off_uEventTbl)i(:)e
(public)g(off_uHWCompResource)k({)598 1020 y(public:)598
1112 y(#ifdef)c(__KERNEL__)676 1203 y(off_uEventTbl\(off_EventTbl)45
b(*r\):)40 b(off_uHWCompResource\(r\))45 b({;})676 1294
y(off_uEventTbl\(off_EventTbl)g(&r\):)40 b(off_uHWCompResource\(&r\))45
b({;})598 1386 y(#endif)676 1477 y(off_uEventTbl\(void\))f({;})676
1568 y(off_uEventTbl\(const)g(off_id_t)d(&id\):)f
(off_uHWCompResource\(id\))45 b({;})598 1751 y(#ifndef)c(__KERNEL__)598
1934 y(#endif)598 2116 y(};)515 2382 y Fk(h)p Fj(O\013)27
b(tr)l(ap)i(table)f(for)f(users.)i Fk(i)p Fq(\021)598
2473 y Fi(class)40 b(off_uTrapTbl)i(:)e(public)g(off_uEventTbl)i({)598
2565 y(public:)598 2656 y(#ifdef)e(__KERNEL__)676 2747
y(off_uTrapTbl\(off_TrapTbl)45 b(*r\):)40 b(off_uEventTbl\(r\))j({;})
676 2839 y(off_uTrapTbl\(off_TrapTbl)i(&r\):)40 b(off_uEventTbl\(&r\))j
({;})598 2930 y(#endif)676 3021 y(off_uTrapTbl\(void\))h({;})676
3113 y(off_uTrapTbl\(const)g(off_id_t)d(&id\):)f(off_uEventTbl\(id\))j
({;})598 3295 y(#ifndef)e(__KERNEL__)676 3387 y Fk(h)p
Fj(O\013)27 b(tr)l(ap)i(table)f(for)g(users)h(metho)l(ds.)f
Fk(i)598 3569 y Fi(#endif)598 3752 y(};)1885 5255 y Fz(351)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
352 353 bop 515 523 a Fk(h)p Fj(O\013)27 b(interrupt)i(table)g(for)e
(users.)i Fk(i)o Fq(\021)598 614 y Fi(class)40 b(off_uIntTbl)i(:)d
(public)i(off_uEventTbl)h({)598 706 y(public:)598 797
y(#ifdef)e(__KERNEL__)676 888 y(off_uIntTbl\(off_IntTbl)k(*r\):)d
(off_uEventTbl\(r\))h({;})676 980 y(off_uIntTbl\(off_IntTbl)i(&r\):)d
(off_uEventTbl\(&r\))i({;})598 1071 y(#endif)676 1162
y(off_uIntTbl\(void\))g({;})676 1254 y(off_uIntTbl\(const)g(off_id_t)e
(&id\):)g(off_uEventTbl\(id\))i({;})598 1436 y(#ifndef)e(__KERNEL__)676
1528 y Fk(h)p Fj(O\013)27 b(interrupt)j(table)e(for)g(users)h(metho)l
(ds.)f Fk(i)598 1710 y Fi(#endif)598 1893 y(};)639 2034
y Fz(T)-7 b(rap)27 b(tables)g(pro)n(vide:)515 2200 y
FA(allo)s(c)41 b Fz(Allo)r(cates)27 b(a)g(new)h(trap)f(at)g(the)h(giv)n
(en)f(id.)37 b(Receiv)n(es:)822 2366 y Fq(\017)k Fz(The)28
b(iden)n(ti\014er)f(for)g(the)h(trap)f Fx(at)p Fz(.)822
2499 y Fq(\017)41 b Fz(Protection)26 b Fx(p)h Fz(and)h
Fx(domain)d Fz(for)i(the)h(new)g(trap.)822 2632 y Fq(\017)41
b Fz(The)28 b(p)r(ortal)f(handling)g(the)h(trap)f Fx(hndlr)p
Fz(.)822 2765 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h
(for)g(the)h(domain)f Fx(dr)p Fz(.)822 2897 y Fq(\017)41
b Fz(Execute)27 b(access)f(righ)n(ts)h(for)g(the)h(handler)f
Fx(hr)822 3030 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(t)h
(for)g(the)h(trap)f(table)h Fx(r)p Fz(.)722 3163 y Fk(h)p
Fj(O\013)f(tr)l(ap)i(table)g(for)e(users)i(metho)l(ds.)g
Fk(i)o Fq(\021)805 3254 y Fi(//)40 b(Allocates)h(a)f(trap.)805
3346 y(off_uTrap)i(alloc\(off_ev_id_t)160 b(at,)1511
3437 y(off_Protection)43 b(p,)1511 3528 y(off_prtl_id_t)82
b(domain,)1511 3620 y(off_prtl_id_t)g(hndlr,)1511 3711
y(off_Rights)199 b(dr,)1511 3802 y(off_Rights)g(hr,)1511
3894 y(off_Rights)g(r\){)884 3985 y(off_traptbl_allocat_req)44
b(req\(at,p,domain,hndlr,dr,hr,)q(r\);)884 4076 y
(off_traptbl_allocat_rep)g(rep;)884 4168 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 4259 y(if)f(\(err)i(||)e
(rep.m_err\))962 4350 y(errno=\(err\)?err:rep.m_err;)884
4442 y(return)h(rep.res;)805 4533 y(})1885 5255 y Fz(352)p
eop
PStoPSsaved restore
%%Page: (354,355) 178
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
353 354 bop 722 523 a Fk(h)p Fj(O\013)27 b(tr)l(ap)i(table)g(messages.)
f Fk(i)p Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_TRAPTBL_ALLOCAT)k
(0x06f)884 706 y(struct)40 b(off_traptbl_allocat_req:)45
b(public)c(off_KernReq)g({)962 797 y(off_ev_id_t)81 b(iid;)962
888 y(off_Protection)43 b(prot;)962 980 y(off_prtl_id_t)82
b(dom;)962 1071 y(off_prtl_id_t)g(h;)962 1162 y(off_Rights)199
b(hright;)962 1254 y(off_Rights)g(dright;)962 1345 y
(off_traptbl_allocat_req\(off_)q(ev_i)q(d_t)45 b(id,)40
b(off_Protection)j(p,)1825 1436 y(off_prtl_id_t)82 b(domain,)1825
1528 y(off_prtl_id_t)g(hu,)1825 1619 y(off_Rights)42
b(hr,)1825 1710 y(off_Rights)g(dr,)1825 1802 y(off_Rights)g(r\):)1041
1893 y(iid\(id\),prot\(p\),dom\(domain\),h\()q(hu\),h)q(righ)q(t\(hr\))
q(,dri)q(ght\()q(dr\),)1041 1984 y(off_KernReq\(OFF_MSG_TRAPTBL_AL)q
(LOCAT)q(,r\))k({;})884 2076 y(};)884 2167 y(struct)40
b(off_traptbl_allocat_rep:)45 b(public)c(off_KernRep)g({)962
2258 y(off_ev_id_t)h(res;)962 2350 y(off_traptbl_allocat_rep\(err_)q(t)
j(r=0\))40 b(:)g(off_KernRep\(r\))i({;})884 2441 y(};)722
2740 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(table)g(for)e(users)i(in-kernel)f
(metho)l(ds.)h Fk(i)p Fq(\021)805 2831 y Fi(void)40 b
(allocat\(off_traptbl_allocat)q(_req)46 b(*m,)40 b
(off_traptbl_allocat_rep)k(*r\))805 2922 y({)884 3014
y(off_Trap)d(*t;)884 3105 y(off_UsrEventHandler)i(*handler=new)f
(off_UsrEventHandler\(m->h\);)884 3196 y(//)d(XXX)h(check)h(domain)f
(rights.)884 3288 y(if)f(\(!handler\))962 3379 y(r->m_err=ENOMEM;)884
3470 y(else)962 3562 y(t=new\(\(off_TrapTbl*\)w_r,m->i)q(id\))46
b(off_Trap\(m->prot,m->dom,handler)q(\);)884 3653 y(if)39
b(\(!t\))962 3744 y(r->m_err=EAGAIN;)884 3836 y
(r->res=\(t\)?t->get_id\(\):OFF_ID_)q(NULL)q(;)805 4018
y(})1885 5255 y Fz(353)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
354 355 bop 515 523 a FA(free)41 b Fz(Deallo)r(cates)27
b(a)g(trap.)37 b(Receiv)n(es:)822 689 y Fq(\017)k Fz(The)28
b(trap)f(id)h Fx(at)p Fz(.)822 822 y Fq(\017)41 b Fz(Delete)28
b(access)e(righ)n(ts)h(for)g(the)h(trap)f Fx(r)p Fz(.)722
955 y Fk(h)p Fj(O\013)g(tr)l(ap)i(table)g(for)e(users)i(metho)l(ds.)g
Fk(i)o Fz(+)p Fq(\021)805 1046 y Fi(//)40 b(Deallocates)i(a)d(trap)805
1137 y(void)h(free\()h(off_uTrap)g(s,)f(off_Rights)h(r\){)884
1229 y(off_traptbl_free_req)j(req\(s.get_id\(\),r\);)884
1320 y(off_traptbl_free_rep)g(rep;)884 1411 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 1503 y(if)f(\(err)i(||)e
(rep.m_err\))962 1594 y(errno=\(err\)?err:rep.m_err;)805
1685 y(})722 1893 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(table)g(messages.)f
Fk(i)p Fz(+)p Fq(\021)805 1984 y Fi(#define)41 b(OFF_MSG_TRAPTBL_FREE)j
(0x07f)884 2076 y(struct)c(off_traptbl_free_req:)k(public)d
(off_KernReq)h({)962 2167 y(off_ev_id_t)81 b(id;)962
2258 y(off_traptbl_free_req\(off_ev_)q(id_t)46 b(s,)39
b(off_Rights)j(r\):)e(id\(s\),)1041 2350 y
(off_KernReq\(OFF_MSG_TRAPTBL_FR)q(EE,r\))46 b({;})884
2441 y(};)884 2532 y(struct)40 b(off_traptbl_free_rep:)k(public)d
(off_KernRep)h({)962 2623 y(off_traptbl_free_rep\(err_t)j(r=0\))c(:)e
(off_KernRep\(r\))j({;})884 2715 y(};)722 2922 y Fk(h)p
Fj(O\013)27 b(tr)l(ap)i(table)g(for)e(users)i(in-kernel)f(metho)l(ds.)h
Fk(i)p Fz(+)o Fq(\021)884 3014 y Fi(void)40 b
(free\(off_traptbl_free_req)45 b(*m,off_traptbl_free_rep)84
b(*r\))884 3105 y({)962 3196 y(\(void\)r;)962 3288 y(if)40
b(\(!\(\(off_TrapTbl*\)w_r\)->is_loc)q(al\(m-)q(>id\))q(\))1041
3379 y(panic\("proc:)i(should)e(raise)h(missing,)g(but)f(not)f(yet)h
(implemented."\);)962 3470 y(delete)h
(\(\(*\(off_TrapTbl*\)w_r\)+m->id\)->)q(get_)q(handl)q(er\(\))q(;)962
3562 y(delete)g(\(\(*\(off_TrapTbl*\)w_r\)+m->id\);)884
3653 y(})1885 5255 y Fz(354)p eop
PStoPSsaved restore
%%Page: (356,357) 179
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
355 356 bop 639 523 a Fz(In)n(terrupt)27 b(tables)h(pro)n(vide)e
(similar)h(metho)r(ds:)515 689 y FA(allo)s(c)41 b Fz(Allo)r(cates)27
b(a)g(new)h(in)n(terrupt)f(at)g(the)h(giv)n(en)f(id.)37
b(Receiv)n(es:)822 855 y Fq(\017)k Fz(The)28 b(iden)n(ti\014er)f(for)g
(the)h(in)n(terrupt)f Fx(at)p Fz(.)822 988 y Fq(\017)41
b Fz(Protection)26 b Fx(p)h Fz(and)h Fx(domain)d Fz(for)i(the)h(new)g
(in)n(terrupt.)822 1121 y Fq(\017)41 b Fz(The)28 b(p)r(ortal)f
(handling)g(the)h(in)n(terrupt)f Fx(hndlr)p Fz(.)822
1254 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)
h(domain)f Fx(dr)p Fz(.)822 1386 y Fq(\017)41 b Fz(Execute)27
b(access)f(righ)n(ts)h(for)g(the)h(handler)f Fx(hr)822
1519 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(t)h(for)g(the)h
(in)n(terrupt)f(table)h Fx(r)p Fz(.)722 1652 y Fk(h)p
Fj(O\013)f(interrupt)j(table)e(for)g(users)h(metho)l(ds.)f
Fk(i)p Fq(\021)805 1743 y Fi(//)40 b(Allocates)h(a)f(interrupt.)805
1835 y(off_uIrq)h(alloc\(off_ev_id_t)161 b(at,)1511 1926
y(off_Protection)43 b(p,)1511 2017 y(off_prtl_id_t)82
b(domain,)1511 2109 y(off_prtl_id_t)g(hndlr,)1511 2200
y(off_Rights)199 b(dr,)1511 2291 y(off_Rights)g(hr,)1511
2383 y(off_Rights)g(r\){)884 2474 y(off_inttbl_allocat_req)44
b(req\(at,p,domain,hndlr,dr,hr,r)q(\);)884 2565 y
(off_inttbl_allocat_rep)g(rep;)884 2657 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2748 y(if)f(\(err)i(||)e
(rep.m_err\))962 2839 y(errno=\(err\)?err:rep.m_err;)884
2931 y(return)h(rep.res;)805 3022 y(})1885 5255 y Fz(355)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
356 357 bop 722 523 a Fk(h)p Fj(O\013)27 b(interrupt)j(table)e
(messages.)h Fk(i)p Fq(\021)805 614 y Fi(#define)41 b
(OFF_MSG_INTTBL_ALLOCAT)j(0x08f)884 706 y(struct)c
(off_inttbl_allocat_req:)45 b(public)40 b(off_KernReq)i({)962
797 y(off_ev_id_t)160 b(iid;)962 888 y(off_Protection)43
b(prot;)962 980 y(off_prtl_id_t)82 b(dom;)962 1071 y(off_prtl_id_t)g
(h;)962 1162 y(off_Rights)199 b(hright;)962 1254 y(off_Rights)g
(dright;)962 1345 y(off_inttbl_allocat_req\(off_e)q(v_id)q(_t)45
b(id,)40 b(off_Protection)j(p,)1825 1436 y(off_prtl_id_t)82
b(domain,)1825 1528 y(off_prtl_id_t)g(hu,)1825 1619 y(off_Rights)42
b(hr,)1825 1710 y(off_Rights)g(dr,)1825 1802 y(off_Rights)g(r\):)1041
1893 y(iid\(id\),prot\(p\),dom\(domain\),h\()q(hu\),h)q(righ)q(t\(hr\))
q(,dri)q(ght\()q(dr\),)1041 1984 y(off_KernReq\(OFF_MSG_INTTBL_ALL)q
(OCAT,)q(r\))j({;})884 2076 y(};)884 2167 y(struct)40
b(off_inttbl_allocat_rep:)45 b(public)40 b(off_KernRep)i({)962
2258 y(off_ev_id_t)g(res;)962 2350 y(off_inttbl_allocat_rep\(err_t)k
(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884 2441 y(};)722
2740 y Fk(h)p Fj(O\013)27 b(interrupt)j(table)e(for)g(users)h
(in-kernel)f(metho)l(ds.)h Fk(i)p Fq(\021)805 2831 y
Fi(void)40 b(allocat\(off_inttbl_allocat_)q(req)46 b(*m,)39
b(off_inttbl_allocat_rep)45 b(*r\))805 2922 y({)884 3014
y(off_Irq)c(*t;)884 3105 y(off_UsrEventHandler)i(*handler=new)f
(off_UsrEventHandler\(m->h\);)884 3196 y(//)d(XXX)h(check)h(domain)f
(rights.)884 3288 y(if)f(\(!handler\))962 3379 y(r->m_err=ENOMEM;)884
3470 y(else)962 3562 y(t=new\(\(off_IntTbl*\)w_r,m->ii)q(d\))45
b(off_Irq\(m->prot,m->dom,handl)q(er\);)884 3653 y(if)39
b(\(!t\))962 3744 y(r->m_err=EAGAIN;)884 3836 y
(r->res=\(t\)?t->get_id\(\):OFF_ID_)q(NULL)q(;)805 4018
y(})1885 5255 y Fz(356)p eop
PStoPSsaved restore
%%Page: (358,359) 180
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
357 358 bop 515 523 a FA(free)41 b Fz(Deallo)r(cates)27
b(a)g(in)n(terrupt.)37 b(Receiv)n(es:)822 689 y Fq(\017)k
Fz(The)28 b(in)n(terrupt)f(id)h Fx(at)p Fz(.)822 822
y Fq(\017)41 b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h(in)n
(terrupt)f Fx(r)p Fz(.)722 955 y Fk(h)p Fj(O\013)g(interrupt)j(table)e
(for)g(users)h(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805
1046 y Fi(//)40 b(Deallocates)i(a)d(interrupt)805 1137
y(void)h(free\()h(off_uIrq)g(s,)f(off_Rights)h(r\){)884
1229 y(off_inttbl_free_req)i(req\(s.get_id\(\),r\);)884
1320 y(off_inttbl_free_rep)g(rep;)884 1411 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 1503 y(if)f(\(err)i(||)e
(rep.m_err\))962 1594 y(errno=\(err\)?err:rep.m_err;)805
1685 y(})722 1893 y Fk(h)p Fj(O\013)27 b(interrupt)j(table)e(messages.)
h Fk(i)p Fz(+)o Fq(\021)805 1984 y Fi(#define)41 b(OFF_MSG_INTTBL_FREE)
j(0x09f)884 2076 y(struct)c(off_inttbl_free_req:)k(public)d
(off_KernReq)g({)962 2167 y(off_ev_id_t)81 b(id;)962
2258 y(off_inttbl_free_req\(off_ev_i)q(d_t)46 b(s,)39
b(off_Rights)j(r\):)e(id\(s\),)1041 2350 y
(off_KernReq\(OFF_MSG_INTTBL_FRE)q(E,r\))46 b({;})884
2441 y(};)884 2532 y(struct)40 b(off_inttbl_free_rep:)k(public)d
(off_KernRep)g({)962 2623 y(off_inttbl_free_rep\(err_t)k(r=0\))40
b(:)g(off_KernRep\(r\))i({;})884 2715 y(};)722 2922 y
Fk(h)p Fj(O\013)27 b(interrupt)j(table)e(for)g(users)h(in-kernel)f
(metho)l(ds.)h Fk(i)p Fz(+)o Fq(\021)884 3014 y Fi(void)40
b(free\(off_inttbl_free_req)45 b(*m,off_inttbl_free_rep)83
b(*r\))884 3105 y({)962 3196 y(\(void\)r;)962 3288 y(if)40
b(\(!\(\(off_IntTbl*\)w_r\)->is_loca)q(l\(m->)q(id\)\))1041
3379 y(panic\("proc:)i(should)e(raise)h(missing,)g(but)f(not)f(yet)h
(implemented."\);)962 3470 y(delete)h
(\(\(*\(off_IntTbl*\)w_r\)+m->id\)->g)q(et_h)q(andle)q(r\(\);)962
3562 y(delete)g(\(\(*\(off_IntTbl*\)w_r\)+m->id\);)884
3653 y(})515 3885 y Fk(h)p Fj(O\013)27 b(event)i(table)f(for)g(users)h
(in-kernel.)f Fk(i)o Fq(\021)598 3977 y Fi(class)40 b(off_kEventTbl)i
(:)e(public)g(off_kHWCompResource)k({)598 4068 y(public:)676
4159 y(virtual)d(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
4251 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 4342
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\){)755 4433 y(return)f
(off_kHWCompResource::handle\()q(send)q(er,ms)q(z,rs)q(z,m,r)q(\);)676
4525 y(})598 4707 y(};)1885 5255 y Fz(357)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
358 359 bop 515 523 a Fk(h)p Fj(O\013)27 b(tr)l(ap)i(table)f(for)f
(users)i(in-kernel.)f Fk(i)p Fq(\021)598 614 y Fi(class)40
b(off_kTrapTbl)i(:)e(public)g(off_kEventTbl)i({)598 706
y(public:)676 797 y(off_kTrapTbl\(off_TrapTbl)j(*t\))40
b({)f(w_r=t;)80 b(})676 888 y(virtual)41 b(err_t)f(handle\(const)i
(off_shtl_id_t)h(&sender,)1500 980 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 1071 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676
1254 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(table)f(for)g(users)h(in-kernel)f
(metho)l(ds.)h Fk(i)598 1345 y Fi(};)515 1519 y Fk(h)p
Fj(O\013)e(interrupt)i(table)g(for)e(users)i(in-kernel.)f
Fk(i)p Fq(\021)598 1611 y Fi(class)40 b(off_kIntTbl)i(:)d(public)i
(off_kEventTbl)h({)598 1702 y(public:)676 1793 y
(off_kIntTbl\(off_IntTbl)i(*t\))c({)g(w_r=t;)80 b(})676
1885 y(virtual)41 b(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)
1500 1976 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500
2067 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676 2250
y Fk(h)p Fj(O\013)27 b(interrupt)j(table)e(for)g(users)h(in-kernel)f
(metho)l(ds.)h Fk(i)598 2341 y Fi(};)1885 5255 y Fz(358)p
eop
PStoPSsaved restore
%%Page: (360,361) 181
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
359 360 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kTrapTbl::handle)31 b Fj(implementation.)c Fk(i)p
Fq(\021)598 614 y Fi(err_t)40 b(off_kTrapTbl::handle\(const)45
b(off_shtl_id_t)d(&sender,)1657 706 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)1657 797 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598
888 y({)676 980 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(do_debug\(printf\("trap[\045x]",m)q(->m_t)q(ype\))q(\);)676
1345 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)833 1436
y(panic\("trap:)i(not)e(wrapped."\);)676 1528 y(})676
1619 y(r->m_err=EOK;)676 1710 y(switch\(m->m_type\){)676
1802 y(case)g(OFF_MSG_R_INIT:)755 1893 y(return)g(EOK;)676
1984 y(case)g(OFF_MSG_TRAPTBL_ALLOCAT:)755 2076 y(if)f
(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q(s\)\))833
2167 y(r->m_err=)i(EPERM;)755 2258 y(else)f(if)f
(\(msz!=sizeof\(off_traptbl_al)q(loca)q(t_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_traptbl_alloca)q(t_re)q(p\)\))833
2350 y(r->m_err=)h(EINVAL;)755 2441 y(else)f({)833 2532
y(allocat\(\(off_traptbl_allocat_)q(req*)q(\)m,\()q(off_t)q(rapt)q
(bl_al)q(loca)q(t_re)q(p*\)r\))q(;)755 2623 y(})755 2715
y(return)g(EOK;)637 2806 y(case)g(OFF_MSG_TRAPTBL_FREE:)755
2897 y(if)f(\(msz!=sizeof\(off_traptbl_fre)q(e_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_traptbl_free_)q(rep\)\))833
2989 y(r->m_err=EINVAL;)755 3080 y(else)g({)833 3171
y(free\(\(off_traptbl_free_req*\)m)q(,\(of)q(f_tr)q(aptbl)q(_fre)q
(e_rep)q(*\)r\))q(;)755 3263 y(})755 3354 y(return)g(EOK;)676
3537 y(default:)755 3628 y(return)g(off_kHWCompResource::handle\()q
(send)q(er,ms)q(z,rs)q(z,m,r)q(\);)676 3719 y(})598 3811
y(})1885 5255 y Fz(359)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
360 361 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kIntTbl::handle)30 b Fj(implementation.)e Fk(i)p
Fq(\021)598 614 y Fi(err_t)40 b(off_kIntTbl::handle\(const)45
b(off_shtl_id_t)d(&sender,)1657 706 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)1657 797 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598
888 y({)676 980 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(do_debug\(printf\("int[\045x]",m-)q(>m_ty)q(pe\)\))q(;)676
1345 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)833 1436
y(panic\("int:)i(not)e(wrapped."\);)676 1528 y(})676
1619 y(r->m_err=EOK;)676 1710 y(switch\(m->m_type\){)676
1802 y(case)g(OFF_MSG_R_INIT:)755 1893 y(return)g(EOK;)676
1984 y(case)g(OFF_MSG_INTTBL_ALLOCAT:)755 2076 y(if)f
(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q(s\)\))833
2167 y(r->m_err=)i(EPERM;)755 2258 y(else)f(if)f
(\(msz!=sizeof\(off_inttbl_all)q(ocat)q(_req\))46 b(||)40
b(rsz!=sizeof\(off_inttbl_allocat_)q(rep\))q(\))833 2350
y(r->m_err=)h(EINVAL;)755 2441 y(else)f({)833 2532 y
(allocat\(\(off_inttbl_allocat_r)q(eq*\))q(m,\(o)q(ff_in)q(ttbl)q
(_allo)q(cat_)q(rep*)q(\)r\);)755 2623 y(})755 2715 y(return)g(EOK;)637
2806 y(case)g(OFF_MSG_INTTBL_FREE:)755 2897 y(if)f
(\(msz!=sizeof\(off_inttbl_free)q(_req)q(\))45 b(||)40
b(rsz!=sizeof\(off_inttbl_free_re)q(p\)\))833 2989 y(r->m_err=EINVAL;)
755 3080 y(else)g({)833 3171 y(free\(\(off_inttbl_free_req*\)m,)q
(\(off)q(_int)q(tbl_f)q(ree_)q(rep*\))q(r\);)755 3263
y(})755 3354 y(return)g(EOK;)676 3537 y(default:)755
3628 y(return)g(off_kHWCompResource::handle\()q(send)q(er,ms)q(z,rs)q
(z,m,r)q(\);)676 3719 y(})598 3811 y(})1885 5255 y Fz(360)p
eop
PStoPSsaved restore
%%Page: (362,363) 182
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
361 362 bop 515 523 a Fk(h)p Fj(O\013)27 b(event)i(for)e(users.)i
Fk(i)p Fq(\021)598 614 y Fi(class)40 b(off_uEvent:)i(public)e
(off_uHWResUnit)j({)598 706 y(public:)598 797 y(#ifdef)d(__KERNEL__)676
888 y(off_uEvent\(off_Event)k(*r\):)c(off_uHWResUnit\(r\))j({;})676
980 y(off_uEvent\(off_Event)h(&r\):)c(off_uHWResUnit\(&r\))j({;})598
1071 y(#endif)676 1162 y(off_uEvent\(void\))g({;})676
1254 y(off_uEvent\(const)g(off_id_t)e(&id\):)f(off_uHWResUnit\(id\))k
({;})598 1436 y(#ifndef)d(__KERNEL__)598 1619 y(#endif)598
1802 y(};)515 2067 y Fk(h)p Fj(O\013)27 b(event)i(for)e(users)i
(in-kernel.)f Fk(i)p Fq(\021)598 2159 y Fi(class)40 b(off_kEvent)i(:)d
(public)i(off_kHWResUnit)h({)598 2250 y(public:)676 2341
y(off_kEvent\(off_Event)i(*r=NULL\))d(:)e(off_kHWResUnit\(r\))44
b({};)676 2433 y(virtual)d(err_t)f(handle\(const)i(off_shtl_id_t)h
(&sender,)1500 2524 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500
2615 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)598 2707
y(};)515 3064 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(for)e(users.)i
Fk(i)p Fq(\021)598 3155 y Fi(class)40 b(off_uTrap:)i(public)e
(off_uEvent)i({)598 3246 y(public:)598 3337 y(#ifdef)e(__KERNEL__)676
3429 y(off_uTrap\(off_Trap)k(*r\):)c(off_uEvent\(r\))i({;})676
3520 y(off_uTrap\(off_Trap)i(&r\):)c(off_uEvent\(&r\))i({;})598
3611 y(#endif)676 3703 y(off_uTrap\(void\))h({;})676
3794 y(off_uTrap\(const)g(off_id_t)e(&id\):)f(off_uEvent\(id\))j({;})
598 3977 y(#ifndef)e(__KERNEL__)598 4159 y(#endif)598
4342 y(};)1885 5255 y Fz(361)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
362 363 bop 515 523 a Fk(h)p Fj(O\013)27 b(tr)l(ap)i(for)e(users)i
(in-kernel.)f Fk(i)p Fq(\021)598 614 y Fi(class)40 b(off_kTrap)h(:)f
(public)g(off_kEvent)i({)598 706 y(public:)676 797 y
(off_kTrap\(off_Trap)i(*r=NULL\))d(:)e(off_kEvent\(r\))j({};)676
888 y(virtual)f(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
980 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 1071 y(off_KernReq)g
(*m,)e(off_KernRep)h(*r\);)598 1162 y(};)515 1519 y Fk(h)p
Fj(O\013)27 b(interrupt)i(for)f(users.)g Fk(i)p Fq(\021)598
1611 y Fi(class)40 b(off_uIrq:)h(public)g(off_uEvent)g({)598
1702 y(public:)598 1793 y(#ifdef)f(__KERNEL__)676 1885
y(off_uIrq\(off_Irq)j(*r\):)d(off_uEvent\(r\))i({;})676
1976 y(off_uIrq\(off_Irq)h(&r\):)d(off_uEvent\(&r\))j({;})598
2067 y(#endif)676 2159 y(off_uIrq\(void\))g({;})676 2250
y(off_uIrq\(const)g(off_id_t)e(&id\):)f(off_uEvent\(id\))i({;})598
2433 y(#ifndef)f(__KERNEL__)598 2615 y(#endif)598 2798
y(};)515 3064 y Fk(h)p Fj(O\013)27 b(interrupt)i(for)f(users)h
(in-kernel.)f Fk(i)p Fq(\021)598 3155 y Fi(class)40 b(off_kIrq)h(:)f
(public)g(off_kEvent)i({)598 3246 y(public:)676 3337
y(off_kIrq\(off_Irq)h(*r=NULL\))e(:)f(off_kEvent\(r\))i({};)676
3429 y(virtual)f(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
3520 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 3611
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)598 3703 y(};)1885
5255 y Fz(362)p eop
PStoPSsaved restore
%%Page: (364,365) 183
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
363 364 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kEvent::handle)30 b Fj(implementation.)e Fk(i)o
Fq(\021)598 614 y Fi(err_t)40 b(off_kEvent::handle\(const)45
b(off_shtl_id_t)d(&sender,)1539 706 y(vm_size_t)f(msz,)g(vm_size_t)g
(rsz,)1539 797 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
888 y({)676 980 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(switch\(m->m_type\){)676 1345 y(case)h(OFF_MSG_R_INIT:)755
1436 y(return)g(EOK;)676 1528 y(default:)755 1619 y(return)g
(off_kHWResUnit::handle\(sende)q(r,ms)q(z,rsz)q(,m,r)q(\);)676
1710 y(})598 1802 y(})515 1976 y Fk(h)p Fi(off)p 667
1976 V 29 w(kTrap::handle)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 2067 y Fi(err_t)40 b(off_kTrap::handle\(const)45
b(off_shtl_id_t)d(&sender,)1539 2159 y(vm_size_t)f(msz,)g(vm_size_t)g
(rsz,)1539 2250 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
2341 y({)676 2433 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f
(sender)i(<<)f(")f(";)676 2524 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 2615 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 2707 y
(switch\(m->m_type\){)676 2798 y(case)h(OFF_MSG_R_INIT:)755
2889 y(return)g(EOK;)676 2980 y(default:)755 3072 y(return)g
(off_kEvent::handle\(sender,ms)q(z,rs)q(z,m,r)q(\);)676
3163 y(})598 3254 y(})515 3429 y Fk(h)p Fi(off)p 667
3429 V 29 w(kIrq::handle)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 3520 y Fi(err_t)40 b(off_kIrq::handle\(const)k
(off_shtl_id_t)f(&sender,)1539 3611 y(vm_size_t)e(msz,)g(vm_size_t)g
(rsz,)1539 3703 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
3794 y({)676 3885 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f
(sender)i(<<)f(")f(";)676 3977 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 4068 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 4159 y
(switch\(m->m_type\){)676 4251 y(case)h(OFF_MSG_R_INIT:)755
4342 y(return)g(EOK;)676 4433 y(default:)755 4525 y(return)g
(off_kEvent::handle\(sender,ms)q(z,rs)q(z,m,r)q(\);)676
4616 y(})598 4707 y(})515 4882 y Fk(h)p Fj(O\013)27 b(event)i(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 4973 y Fi(#include)41
b(<prtl/ex.h>)1885 5255 y Fz(363)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
364 365 bop 515 523 a Fn(4.3.9)112 b(T)-9 b(rap)38 b(and)g(in)m
(terrupt)e(lo)m(w-lev)m(el)f(deliv)m(ering)515 676 y
Fz(The)20 b(mac)n(hine)f(dep)r(enden)n(t)i(trap)e(table)h(implemen)n
(ts)h(trap)e(deliv)n(ering.)33 b(It)21 b(simply)f(obtains)515
776 y(a)27 b(reference)g(to)g(the)h(curren)n(t)f(pro)r(cessor)e(and)j
(deliv)n(ers)e(the)i(trap)f(on)h(its)f(trap)g(table.)515
900 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 900 24 4 v 29 w(TrapTbl)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
991 y Fi(off_mdepTrapTbl)42 b(mdep;)433 b(//)40 b(Mach)g(dep.)g(trap)g
(table.)515 1147 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h
(memb)l(ers)f(of)e Fi(off)p 1928 1147 V 29 w(TrapTbl)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 1239 y Fi(mdep\(\))639
1371 y Fz(In)n(terrupt)18 b(deliv)n(ering)f(is)i(done)f(in)g(the)h
(same)f(w)n(a)n(y)-7 b(.)33 b(In)18 b(this)h(case,)g(it)g(is)f
Fx(off)p 2957 1371 27 4 v 31 w(mdep)p 3164 1371 V 29
w(intr)p 3369 1371 V 30 w(handler)515 1470 y Fz(the)28
b(one)f(doing)g(in)n(terrupt)g(deliv)n(ering.)639 1570
y(Suc)n(h)35 b(lo)n(w-lev)n(el)f(trap)g(and)h(in)n(terrupt)g(en)n(try)f
(p)r(oin)n(ts)h(m)n(ust)g(also)f(sa)n(v)n(e)g(and)h(restore)515
1670 y(sh)n(uttle)28 b(con)n(text.)515 1898 y Fn(4.3.10)112
b(Ev)m(en)m(t)37 b Fd(C)8 b FC(++)38 b Fn(source)g(\014les)515
2051 y Fz(Ev)n(en)n(t)26 b(table)i(co)r(de)f(is)h(k)n(ept)f(in)h
Fx(hw/EventTbl.h)23 b Fz(and)k Fx(hw/EventTbl.C)p Fz(.)515
2175 y Fk(h)p Fj(EventTbl.h*)11 b Fk(i)p Fq(\021)598
2267 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2358 y Fi(#ifndef)41
b(__OFF_EVENT_TBL_H)598 2449 y(#define)g(__OFF_EVENT_TBL_H)i(1)598
2632 y Fk(h)p Fj(O\013)27 b(event)i(table)f(dep)l(endencies.)h
Fk(i)598 2814 y Fi(#ifdef)40 b(__KERNEL__)598 2906 y
Fk(h)p Fj(O\013)27 b(event)i(table.)f Fk(i)598 2997 y(h)p
Fj(O\013)f(tr)l(ap)i(table.)f Fk(i)598 3088 y(h)p Fj(O\013)f(interrupt)
i(table.)f Fk(i)598 3180 y Fi(#endif)40 b(//)g(__KERNEL__)598
3362 y(#include)h(<prtl/ex.h>)598 3454 y(#include)g(<hw/uEventTbl.h>)
598 3636 y(#ifdef)f(__KERNEL__)598 3728 y(//)f(Event)i(table)f(inline)h
(methods)598 3819 y(//)598 3910 y Fk(h)p Fi(off)p 750
3910 24 4 v 29 w(IntTbl::mask)30 b(unmask)f Fj(and)f
Fi(is)p 1767 3910 V 28 w(masked)h Fj(implementation.)e
Fk(i)598 4002 y(h)p Fi(off)p 750 4002 V 29 w(TrapTbl::is)p
1208 4002 V 30 w(local)i Fj(implementation.)e Fk(i)598
4093 y(h)p Fi(off)p 750 4093 V 29 w(IntTbl::is)p 1169
4093 V 30 w(local)i Fj(implementation.)e Fk(i)598 4184
y(h)p Fi(off)p 750 4184 V 29 w(TrapTbl::get)p 1247 4184
V 31 w(allocator)i Fj(implementation.)e Fk(i)598 4276
y(h)p Fi(off)p 750 4276 V 29 w(IntTbl::get)p 1208 4276
V 30 w(allocator)j Fj(implementation.)d Fk(i)598 4367
y(h)p Fi(off)p 750 4367 V 29 w(IntTbl::defer)j Fj(implementation.)d
Fk(i)598 4458 y(h)p Fi(off)p 750 4458 V 29 w(TrapTbl::operator)43
b(+)27 b Fj(implementation.)h Fk(i)598 4550 y(h)p Fi(off)p
750 4550 V 29 w(IntTbl::operator)42 b(+)28 b Fj(implementation.)g
Fk(i)598 4641 y(h)p Fi(off)p 750 4641 V 29 w(IntTbl::get)p
1208 4641 V 30 w(vint0)h Fj(implementation.)e Fk(i)598
4732 y(h)p Fi(off)p 750 4732 V 29 w(IntTbl::get)p 1208
4732 V 30 w(clk)h Fj(implementation.)g Fk(i)598 4824
y Fi(#endif)40 b(//)g(__KERNEL__)598 5006 y(#endif)g(//)g
(__OFF_EVENT_TBL_H)1885 5255 y Fz(364)p eop
PStoPSsaved restore
%%Page: (366,367) 184
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
365 366 bop 515 523 a Fk(h)p Fj(EventTbl.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/EventTbl.h>)317 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(event)i(table)f(implementation)g(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(event)i(table)f(static)h
(memb)l(ers.)f Fk(i)598 1345 y(h)p Fi(off)p 750 1345
24 4 v 29 w(TrapTbl::alloc)i Fj(implementation.)e Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(TrapTbl::free)i Fj(implementation.)
d Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(IntTbl::alloc)j
Fj(implementation.)d Fk(i)598 1619 y(h)p Fi(off)p 750
1619 V 29 w(IntTbl::free)j Fj(implementation.)d Fk(i)598
1710 y(h)p Fi(off)p 750 1710 V 29 w(TrapTbl::off)p 1247
1710 V 31 w(TrapTbl)i Fj(implementation.)e Fk(i)598 1802
y(h)p Fi(off)p 750 1802 V 29 w(IntTbl::off)p 1208 1802
V 30 w(IntTbl)i Fj(implementation.)f Fk(i)598 1893 y(h)p
Fi(off)p 750 1893 V 29 w(TrapTbl::get)p 1247 1893 V 31
w(count)g Fj(implementation.)g Fk(i)598 1984 y(h)p Fi(off)p
750 1984 V 29 w(IntTbl::get)p 1208 1984 V 30 w(count)h
Fj(implementation.)e Fk(i)598 2076 y(h)p Fi(off)p 750
2076 V 29 w(IntTbl::spl)i Fj(implementation.)f Fk(i)598
2167 y(h)p Fi(off)p 750 2167 V 29 w(IntTbl::nameof)i
Fj(implementation.)e Fk(i)598 2258 y(h)p Fi(off)p 750
2258 V 29 w(TrapTbl::nameof)i Fj(implementation.)e Fk(i)598
2350 y(h)p Fi(off)p 750 2350 V 29 w(TrapTbl::get)p 1247
2350 V 31 w(url)g Fj(implementation.)f Fk(i)598 2441
y(h)p Fi(off)p 750 2441 V 29 w(IntTbl::get)p 1208 2441
V 30 w(url)h Fj(implementation.)g Fk(i)598 2532 y(h)p
Fi(off)p 750 2532 V 29 w(TrapTbl::get)p 1247 2532 V 31
w(vtrap0)g Fj(and)g Fi(get)p 1806 2532 V 29 w(pgflt)h
Fj(implementation.)e Fk(i)1885 5255 y Fz(365)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
366 367 bop 639 523 a Fz(Ev)n(en)n(ts)27 b(are)f(k)n(ept)i(in)g
Fx(Event.h)c Fz(and)k Fx(hw/Event.C)p Fz(.)515 656 y
Fk(h)p Fj(Event.h*)11 b Fk(i)q Fq(\021)598 747 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 839 y Fi(#ifndef)41 b(__OFF_EVENT_H)598
930 y(#define)g(__OFF_EVENT_H)h(1)598 1112 y Fk(h)p Fj(O\013)27
b(event)i(dep)l(endencies.)g Fk(i)598 1295 y(h)p Fj(O\013)e(interrupt)i
(priority)g(level)e(data)i(typ)l(e.)f Fk(i)598 1386 y(h)p
Fj(O\013)f(default)h(priority)g(levels.)g Fk(i)598 1569
y Fi(#ifdef)40 b(__KERNEL__)598 1660 y Fk(h)p Fj(O\013)27
b(event)i(hand)t(ler.)f Fk(i)598 1752 y(h)p Fj(O\013)f(event.)h
Fk(i)598 1843 y(h)p Fj(O\013)f(T)-6 b(r)l(ap.)28 b Fk(i)598
1934 y(h)p Fj(O\013)f(Ir)l(q.)g Fk(i)598 2117 y(h)p Fj(O\013)g(nul)t(l)
g(event)i(hand)t(ler.)f Fk(i)598 2208 y Fi(#endif)40
b(//)g(__KERNEL__)598 2482 y(#include)h(<prtl/ex.h>)598
2574 y(#include)g(<hw/uEvent.h>)598 2848 y(#endif)f(//)g(__OFF_EVENT_H)
1885 5255 y Fz(366)p eop
PStoPSsaved restore
%%Page: (368,369) 185
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
367 368 bop 515 523 a Fk(h)p Fj(Event.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/Event.h>)434 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(event)i(implementation)f(dep)l(endencies.)h
Fk(i)598 1071 y(h)p Fj(O\013)e(tr)l(ap)i(static)f(memb)l(ers.)h
Fk(i)598 1162 y(h)p Fj(O\013)e(interrupt)i(static)g(memb)l(ers.)f
Fk(i)598 1254 y(h)p Fj(O\013)f(nul)t(l)g(event)i(hand)t(ler)f
(implementation.)g Fk(i)598 1436 y(h)p Fi(off)p 750 1436
24 4 v 29 w(Event::get)p 1169 1436 V 30 w(count)h Fj(implementation.)e
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(Irq::off)p
1091 1528 V 30 w(Irq)h Fj(implementation.)f Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(Event::~off)p 1208
1619 V 30 w(Event)i Fj(implementation.)e Fk(i)598 1710
y(h)p Fi(off)p 750 1710 V 29 w(Irq::~off)p 1130 1710
V 30 w(Irq)h Fj(implementation.)f Fk(i)598 1802 y(h)p
Fi(off)p 750 1802 V 29 w(Event::get)p 1169 1802 V 30
w(handler)i Fj(implementation.)f Fk(i)598 1893 y(h)p
Fi(off)p 750 1893 V 29 w(Irq::set)p 1091 1893 V 30 w(prty)g
Fj(implementation.)f Fk(i)598 1984 y(h)p Fi(off)p 750
1984 V 29 w(Irq::get)p 1091 1984 V 30 w(prty)h Fj(implementation.)f
Fk(i)598 2076 y(h)p Fi(off)p 750 2076 V 29 w(Irq::deferred)j
Fj(implementation.)d Fk(i)598 2258 y(h)p Fi(off)p 750
2258 V 29 w(KrnEventHandler::off)p 1559 2258 V 32 w(KrnEventHandler)k
Fj(implementation.)d Fk(i)598 2350 y(h)p Fi(off)p 750
2350 V 29 w(UsrEventHandler::off)p 1559 2350 V 32 w(UsrEventHandler)j
Fj(implementation.)d Fk(i)598 2441 y(h)p Fi(off)p 750
2441 V 29 w(Event::default)p 1325 2441 V 31 w(event)p
1551 2441 V 29 w(handler)h Fj(implementation.)f Fk(i)598
2532 y(h)p Fi(off)p 750 2532 V 29 w(Event::off)p 1169
2532 V 30 w(Event)h Fj(implementation.)e Fk(i)598 2623
y(h)p Fi(off)p 750 2623 V 29 w(Event::set)p 1169 2623
V 30 w(handler)i Fj(implementation.)f Fk(i)598 2715 y(h)p
Fi(off)p 750 2715 V 29 w(Event::raise)i Fj(implementation.)d
Fk(i)598 2806 y(h)p Fi(off)p 750 2806 V 29 w(Trap::raise)i
Fj(implementation.)f Fk(i)598 2897 y(h)p Fi(off)p 750
2897 V 29 w(Irq::raise)h Fj(implementation.)f Fk(i)598
2989 y(h)p Fi(off)p 750 2989 V 29 w(Trap::operator)42
b(new/delete)30 b Fj(implementation.)d Fk(i)598 3080
y(h)p Fi(off)p 750 3080 V 29 w(Irq::operator)42 b(new/delete)29
b Fj(implementation.)f Fk(i)598 3171 y(h)p Fi(off)p 750
3171 V 29 w(UsrEventHandler::operator\(\))33 b Fj(implementation.)28
b Fk(i)598 3263 y(h)p Fi(off)p 750 3263 V 29 w
(KrnEventHandler::operator\(\))33 b Fj(implementation.)28
b Fk(i)598 3354 y(h)p Fi(off)p 750 3354 V 29 w(Irq::mask)h
Fj(implementation.)f Fk(i)598 3445 y(h)p Fi(off)p 750
3445 V 29 w(Irq::unmask)h Fj(implementation.)f Fk(i)598
3537 y(h)p Fi(off)p 750 3537 V 29 w(Irq::is)p 1052 3537
V 29 w(masked)h Fj(implementation.)f Fk(i)598 3628 y(h)p
Fi(off)p 750 3628 V 29 w(Irq::defer)h Fj(implementation.)f
Fk(i)598 3719 y(h)p Fi(off)p 750 3719 V 29 w(Trap::copy)p
1169 3719 V 30 w(state)h Fj(implementation.)e Fk(i)598
3811 y(h)p Fi(off)p 750 3811 V 29 w(Trap::restore)p 1286
3811 V 31 w(state)h Fj(implementation.)g Fk(i)598 3902
y(h)p Fi(off)p 750 3902 V 29 w(Irq::copy)p 1130 3902
V 30 w(state)g Fj(implementation.)g Fk(i)598 3993 y(h)p
Fi(off)p 750 3993 V 29 w(Irq::restore)p 1247 3993 V 31
w(state)g Fj(implementation.)g Fk(i)598 4085 y(h)p Fi(off)p
750 4085 V 29 w(Trap::get)p 1130 4085 V 30 w(url)p 1277
4085 V 29 w(holder)h Fj(implementation.)e Fk(i)598 4176
y(h)p Fi(off)p 750 4176 V 29 w(Irq::get)p 1091 4176 V
30 w(url)p 1238 4176 V 29 w(holder)h Fj(implementation.)g
Fk(i)1885 5255 y Fz(367)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
368 369 bop 639 523 a Fz(The)28 b(ev)n(en)n(t)f(allo)r(cator)f(is)h(k)n
(ept)h(in)g Fx(EvAllocator.h)22 b Fz(and)27 b Fx(EvAllocator.C)p
Fz(.)515 656 y Fk(h)p Fj(EvA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y
Fi(#ifndef)41 b(__OFF_EV_ALLOCATOR_H)598 930 y(#define)g
(__OFF_EV_ALLOCATOR_H)i(1)598 1112 y Fk(h)p Fj(O\013)27
b(event)i(al)t(lo)l(c)l(ator)f(dep)l(endencies.)i Fk(i)598
1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y Fk(h)p Fj(O\013)27
b(tr)l(ap)i(al)t(lo)l(c)l(ator.)f Fk(i)598 1478 y(h)p
Fj(O\013)f(interrupt)i(al)t(lo)l(c)l(ator.)g Fk(i)598
1569 y Fi(#endif)40 b(//)g(__KERNEL__)598 1843 y(#ifdef)g(__KERNEL__)
598 1934 y Fk(h)p Fi(off)p 750 1934 24 4 v 29 w
(TrapAllocator::operator)k(+)28 b Fj(implementation.)f
Fk(i)598 2026 y(h)p Fi(off)p 750 2026 V 29 w(IntAllocator::operator)44
b(+)27 b Fj(implementation.)h Fk(i)598 2208 y Fi(#endif)40
b(//)g(__KERNEL__)598 2391 y(#endif)g(//)g(__OFF_EV_ALLOCATOR_H)515
2748 y Fk(h)p Fj(EvA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q
Fq(\021)598 2839 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 3022 y Fi(#include)41
b(<hw/EvAllocator.h>)200 b(//)40 b(Exported)h(interface)598
3205 y Fk(h)p Fj(O\013)27 b(tr)l(ap)i(al)t(lo)l(c)l(ator)f(static)h
(memb)l(ers.)f Fk(i)598 3296 y(h)p Fj(O\013)f(interrupt)i(al)t(lo)l(c)l
(ator)g(static)g(memb)l(ers.)f Fk(i)515 3562 y(h)p Fj(uEventTbl.h*)11
b Fk(i)q Fq(\021)598 3653 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3744 y(h)p Fj(O\013)f(tr)l(ap)i(table)f(messages.)h Fk(i)598
3836 y(h)p Fj(O\013)e(interrupt)i(table)g(messages.)f
Fk(i)598 3927 y(h)p Fj(O\013)f(event)i(table)f(for)g(users.)g
Fk(i)598 4018 y(h)p Fj(O\013)f(tr)l(ap)i(table)f(for)g(users.)g
Fk(i)598 4110 y(h)p Fj(O\013)f(interrupt)i(table)g(for)e(users.)i
Fk(i)1885 5255 y Fz(368)p eop
PStoPSsaved restore
%%Page: (370,371) 186
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
369 370 bop 515 523 a Fk(h)p Fj(kEventTbl.h*)11 b Fk(i)q
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y Fi(#include)41
b(<hw/EventTbl.h>)239 b(//)39 b(Exported)i(interface.)598
797 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
888 y(#include)h(<klib/kResource.h>)598 980 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 1071 y(#include)h(<string.h>)598
1254 y(#ifndef)g(__OFF_EVENT_KTBL_H)598 1345 y(#define)g
(__OFF_EVENT_KTBL_H)i(1)598 1528 y(#ifdef)d(__KERNEL__)598
1619 y Fk(h)p Fj(O\013)27 b(event)i(table)f(for)g(users)h(in-kernel.)f
Fk(i)598 1710 y(h)p Fj(O\013)f(tr)l(ap)i(table)f(for)g(users)g
(in-kernel.)g Fk(i)598 1802 y(h)p Fj(O\013)f(interrupt)i(table)g(for)e
(users)i(in-kernel.)f Fk(i)598 1893 y Fi(#endif)40 b(//)g(__KERNEL__)
598 2076 y(#endif)g(//)g(!__OFF_EVENT_KTBL_H)515 2341
y Fk(h)p Fj(kEventTbl.C*)11 b Fk(i)p Fq(\021)598 2433
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2615 y Fi(#include)41 b(<hw/kEventTbl.h>)598
2707 y(#include)g(<klib/mdep/debug.h>)598 2798 y Fk(h)p
Fi(off)p 750 2798 24 4 v 29 w(kTrapTbl::handle)31 b Fj(implementation.)
c Fk(i)598 2889 y(h)p Fi(off)p 750 2889 V 29 w(kIntTbl::handle)j
Fj(implementation.)e Fk(i)515 3155 y(h)p Fj(uEvent.h*)11
b Fk(i)q Fq(\021)598 3246 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3337 y(h)p Fj(O\013)f(event)i(for)e(users.)i Fk(i)598
3429 y(h)p Fj(O\013)e(tr)l(ap)i(for)e(users.)i Fk(i)598
3520 y(h)p Fj(O\013)e(interrupt)i(for)f(users.)g Fk(i)1885
5255 y Fz(369)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
370 371 bop 515 523 a Fk(h)p Fj(kEvent.h*)11 b Fk(i)q
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/Event.h>)238 b(//)40 b(Exported)h(interface.)598
888 y(#include)g(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
980 y(#include)h(<klib/kResource.h>)598 1071 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 1162 y(#include)h(<string.h>)598
1345 y(#ifndef)g(__OFF_KEVENT_H)598 1436 y(#define)g(__OFF_KEVENT_H)h
(1)598 1528 y(#ifdef)e(__KERNEL__)598 1710 y Fk(h)p Fj(O\013)27
b(event)i(for)e(users)i(in-kernel.)f Fk(i)598 1802 y(h)p
Fj(O\013)f(tr)l(ap)i(for)e(users)i(in-kernel.)f Fk(i)598
1893 y(h)p Fj(O\013)f(interrupt)i(for)f(users)h(in-kernel.)f
Fk(i)598 2076 y Fi(#endif)40 b(//)g(__KERNEL__)598 2167
y(#endif)g(//)g(__OFF_KEVENT_H)515 2524 y Fk(h)p Fj(kEvent.C*)11
b Fk(i)q Fq(\021)598 2615 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2707 y Fi(#include)41 b(<hw/Event.h>)238 b(//)40 b(Exported)h
(interface.)598 2798 y(#include)g(<klib/str.h>)277 b(//)40
b(for)g(kcout)598 2889 y(#include)h(<prtl/ex.h>)473 b(//)40
b(for)g(XDT{Req|Rep})598 2980 y(#include)h(<string.h>)598
3163 y(#include)g(<hw/kEvent.h>)598 3346 y Fk(h)p Fi(off)p
750 3346 24 4 v 29 w(kEvent::handle)30 b Fj(implementation.)e
Fk(i)598 3437 y(h)p Fi(off)p 750 3437 V 29 w(kTrap::handle)i
Fj(implementation.)d Fk(i)598 3528 y(h)p Fi(off)p 750
3528 V 29 w(kIrq::handle)j Fj(implementation.)d Fk(i)515
3894 y Fn(4.3.11)112 b(Ev)m(en)m(ts)37 b(for)h(ix86)e(based)j(arc)m
(hitectures)515 4047 y FA(In)m(terrupt)33 b(tables)e(and)i(in)m
(terrupt)f(masks)515 4200 y Fz(On)22 b(In)n(tels)h(w)n(e)f(tolerate)g
(up)h(to)g(32)e(in)n(terrupts)i(and)f(up)h(to)g(255)e(traps)2687
4170 y Fp(5)2723 4200 y Fz(.)36 b(W)-7 b(e)23 b(m)n(ust)g(include)515
4300 y(also)j(some)h(space)g(for)g(virtual)g(traps)g(and)h(virtual)f
(in)n(terrupts.)515 4433 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h
(interrupt)h(table)e(size.)g Fk(i)p Fq(\021)598 4524
y Fi(const)40 b(unsigned)h(int)f(OFF_MDEP_NPINT_MAX=32;)k(//)c(32)g
(actual)g(interrupts)i(on)d(intels.)598 4615 y(const)h(unsigned)h(int)f
(OFF_MDEP_NINT_MAX=OFF_MDEP_NP)q(INT_)q(MAX+O)q(FF_M)q(DEP_)q(NVINT)q
(_MAX)q(;)p 515 4685 1146 4 v 607 4739 a Fm(5)642 4762
y Fl(Note)30 b(ho)n(w)f(w)n(e)g(consider)h Ff(synchr)l(onous)36
b Fl(in)n(terrupts|with)29 b(resp)r(ect)h(to)g(instruction)f
(execution|)515 4841 y(as)23 b(traps.)1885 5255 y Fz(370)p
eop
PStoPSsaved restore
%%Page: (372,373) 187
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
371 372 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(tr)
l(ap)g(table)f(size.)g Fk(i)p Fq(\021)598 614 y Fi(const)40
b(unsigned)h(int)f(OFF_MDEP_NPTRP_MAX=0x100;)45 b(//)40
b(256)g(trap)g(entries)h(on)e(intels.)598 706 y(const)h(unsigned)h(int)
f(OFF_MDEP_NTRP_MAX=OFF_MDEP_NP)q(TRP_)q(MAX+O)q(FF_M)q(DEP_)q(NVTRP)q
(_MAX)q(;)639 847 y Fz(The)h(maxim)n(um)g(n)n(um)n(b)r(er)f(of)h
(virtual)f(trap)g(and)g(virtual)h(in)n(terrupts)f(are)f(system)515
946 y(limits.)515 1063 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(limits.)e Fk(i)o Fq(\021)598 1154 y Fi(const)40 b(int)g
(OFF_MDEP_NVINT_MAX=8;)k(//)c(8)f(virtual)i(timers.)598
1245 y(const)f(int)g(OFF_MDEP_NVTRP_MAX=9;)k(//)c(9)f(virtual)i(traps)
598 1337 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(interrupt)h
(table)e(size.)g Fk(i)598 1428 y(h)p Fj(O\013)f(machine)h(dep)l(endent)
h(tr)l(ap)g(table)g(size.)e Fk(i)515 1586 y(h)p Fj(O\013)g(machine)h
(dep)l(endent)h(event)g(table)g(dep)l(endencies.)g Fk(i)p
Fq(\021)598 1677 y Fi(#include)41 b(<klib/limits.h>)317
b(//)40 b(for)g(OFF_MDEP_NV{INT,TRP}_MAX)598 1768 y(#include)h
(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)
639 1910 y Fz(Another)28 b(constan)n(t)f(is)g(de\014ned)h(to)f(iden)n
(tify)i(the)f(\014rst)f(virtual)g(in)n(terrupt.)515 2026
y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(interrupt)h(numb)l(ers.)e
Fk(i)p Fq(\021)598 2117 y Fi(//)39 b(Irq)h(#)g(for)g(the)g(first)g
(virtual)h(interrupt)g(line.)598 2208 y(const)f(natural_t)h
(OFF_MDEP_VINT0_IRQ=OFF_MDEP)q(_NPIN)q(T_MA)q(X;)639
2333 y Fz(W)-7 b(e)36 b(main)n(tain)f(a)f(mac)n(hine)h(dep)r(enden)n(t)
h(in)n(terrupt)f(table)g(p)r(er)g(in)n(terrupt)g(table.)60
b(It)515 2433 y(deals)27 b(with)h(in)n(terrupt)f(masks)g(and)g(also)g
(with)h Fx(IDT)e Fz(handling.)515 2565 y Fk(h)p Fj(O\013)h(machine)h
(dep)l(endent)h(interrupt)h(table.)e Fk(i)p Fq(\021)598
2657 y Fi(//)39 b(An)h(ix86)g(interrupt)i(table)598 2748
y(//)598 2839 y(class)e(off_mdepIntTbl)j({)598 2931 y(public:)676
3022 y(//)d(Creates)h(an)e(x86)h(interrupt)i(table.)676
3113 y(off_mdepIntTbl\(void\);)676 3296 y(//)e(Masks)g(the)g
(interrupt.)676 3387 y(void)g(mask\(natural_t)j(i\);)676
3479 y(//)d(Unmasks)h(the)f(interrupt.)676 3570 y(void)g
(unmask\(natural_t)j(i\);)676 3661 y(//)d(Is)g(it)f(masked?.)676
3753 y(inline)i(boolean_t)g(is_masked\(natural_t)j(i\))39
b(const;)598 3935 y(private:)676 4027 y Fk(h)p Fj(Other)29
b(private)f(memb)l(ers)h(of)e Fi(off)p 1713 4027 24 4
v 29 w(mdepIntTbl)p Fj(.)i Fk(i)598 4118 y Fi(};)1885
5255 y Fz(371)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
372 373 bop 639 523 a Fz(An)24 b(in)n(terrupt)f(mask)g(is)g(an)h(in)n
(teger)e(with)i(one)f(bit)h(set)g(p)r(er)f(enabled)g(in)n(terrupt.)35
b(Only)515 623 y(real)26 b(in)n(terrupts)h(can)h(b)r(e)g(mask)n(ed;)e
(virtual)h(in)n(terrupts)g(are)g(non)h(mask)-5 b(able.)515
756 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(interrupt)h(mask.)d
Fk(i)p Fq(\021)598 847 y Fi(class)40 b(off_mdepIrqMask)j({)598
938 y(private:)676 1029 y(unsigned64_t)f(i_mask;)394
b(//)40 b(Interrupt)h(mask)598 1121 y(public:)676 1212
y(//)f(Creates)h(a)e(mask.)i(By)e(default)i(every)f(irq)g(is)g(masked.)
676 1303 y(off_mdepIrqMask\(natural_t)45 b(val=0\))c(:)e(i_mask\(val\))
j({;})676 1486 y(void)e(mask\(natural_t)j(i\))196 b({)755
1577 y(assert\()40 b(i)g(<)f(OFF_MDEP_NINT_MAX)k(&&)d(i)g(<)f(64\);)755
1669 y(if)g(\(i)h(<)f(OFF_MDEP_NINT_MAX\))833 1760 y
(clear_bit\(i,\(void*\)&i_mask\);)676 1851 y(})676 1943
y(void)h(unmask\(natural_t)j(i)d(\))78 b({)755 2034 y(assert\()40
b(i)g(<)f(OFF_MDEP_NINT_MAX)k(&&)d(i)g(<)f(64\);)755
2125 y(if)g(\(i)h(<)f(OFF_MDEP_NINT_MAX\))833 2217 y
(set_bit\(i,\(void*\)&i_mask\);)676 2308 y(})676 2399
y(boolean_t)i(is_masked\(natural_t)j(i\))c(const)g({)755
2491 y(assert\()g(i)g(<)f(OFF_MDEP_NINT_MAX)k(&&)d(i)g(<)f(64\);)755
2582 y(if)g(\(i)h(<)f(OFF_MDEP_NINT_MAX\))833 2673 y(return)i
(!test_bit\(i,\(void*\)&i_mask\);)755 2765 y(else)833
2856 y(return)g(FALSE;)676 2947 y(})676 3039 y(boolean_t)g
(is_empty\(void\))357 b(const)40 b({)g(return)g
(i_mask==\(natural_t\)-1;)k(})598 3130 y(};)515 3396
y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 3487 y Fi(#include)41
b(<flux/machine/bitops.h>)j(//)c(for)g(set_,clear_)i(and)d(test_bit)639
3628 y Fz(Suc)n(h)28 b(mask)f(is)g(stored)g(in)h Fx(i)p
1534 3628 27 4 v 31 w(mask)p Fz(.)515 3744 y Fk(h)p Fj(Other)g(private)
h(memb)l(ers)f(of)g Fi(off)p 1552 3744 24 4 v 29 w(mdepIntTbl)p
Fj(.)h Fk(i)p Fq(\021)598 3836 y Fi(off_mdepIrqMask)42
b(i_mask;)639 3960 y Fz(It)28 b(is)g(initialized)g(at)f(instan)n
(tiation)g(time)h(with)g(ev)n(ery)f(in)n(terrupt)g(cleared.)515
4076 y Fk(h)p Fi(off)p 667 4076 V 29 w(mdepIntTbl::off)p
1281 4076 V 31 w(mdepIntTbl)j Fj(implementation.)d Fk(i)p
Fq(\021)598 4168 y Fi(//)39 b(Creates)i(an)f(x86)g(interrupt)h(table.)
598 4259 y(off_mdepIntTbl::off_mdepIntTbl)q(\(void)q(\))k(:)676
4350 y(i_mask\(0\))598 4442 y({)676 4533 y Fk(h)p Fj(Machine)28
b(dep)l(endent)i(interrupt)f(har)l(dwar)l(e)g(initialization.)e
Fk(i)598 4624 y Fi(})1885 5255 y Fz(372)p eop
PStoPSsaved restore
%%Page: (374,375) 188
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
373 374 bop 639 523 a Fz(After)23 b(that,)h(mask)e(and)g(unmask)g
(requests)g(are)g(handled)g(b)n(y)g(programming)f(the)i(PIC)515
623 y(and)k(setting)h(the)g(bit)g(in)g(the)g Fx(i)p 1510
623 27 4 v 31 w(mask)p Fz(.)515 756 y Fk(h)p Fi(off)p
667 756 24 4 v 29 w(mdepIntTbl::is)p 1242 756 V 31 w(masked)h
Fj(implementation.)e Fk(i)p Fq(\021)598 847 y Fi(//)39
b(Is)h(it)g(masked?.)598 938 y(inline)g(boolean_t)i
(off_mdepIntTbl::is_masked\(natur)q(al_t)k(i\))39 b(const)598
1029 y({)676 1121 y(assert\(i<OFF_MDEP_NINT_MAX\);)676
1212 y(return)i(i_mask.is_masked\(i\);)598 1303 y(})515
1478 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g
(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 1569 y
Fi(#include)41 b(<assert.h>)551 b(//)40 b(for)g(assert)515
1743 y Fk(h)p Fi(off)p 667 1743 V 29 w(mdepIntTbl::mask)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 1835 y Fi(//)39
b(Masks)i(the)f(interrupt.)598 1926 y(void)g
(off_mdepIntTbl::mask\(natural_t)46 b(i\))598 2017 y({)676
2109 y(assert\(i<OFF_MDEP_NINT_MAX\);)676 2200 y(if)40
b(\(is_masked\(i\)\))755 2291 y(return;)676 2383 y(i_mask.mask\(i\);)
676 2474 y(if)g(\(i)g(<)f(OFF_MDEP_NPINT_MAX\))755 2565
y(pic_disable_irq\(i\);)598 2657 y(})639 2889 y Fz(The)28
b(real)f(w)n(ork)f(is)h(done)h(b)n(y)f Fx(pic)p 1709
2889 27 4 v 30 w(disable)p 2047 2889 V 29 w(irq)p Fz(.)515
3005 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(event)g(table)g
(implementation)f(dep)l(endencies.)h Fk(i)p Fq(\021)598
3097 y Fi(#include)41 b(<flux/machine/pc/pic.h>)j(//)79
b(for)40 b(pic_disable_irq)j(et)c(al.)515 3254 y Fk(h)p
Fi(off)p 667 3254 24 4 v 29 w(mdepIntTbl::unmask)31 b
Fj(implementation.)d Fk(i)o Fq(\021)598 3346 y Fi(//)39
b(Unmasks)i(the)f(interrupt.)598 3437 y(void)g
(off_mdepIntTbl::unmask\(natural)q(_t)45 b(i\))598 3528
y({)676 3620 y(assert\()c(i<OFF_MDEP_NINT_MAX\);)676
3802 y(if)f(\(!is_masked\(i\)\))755 3894 y(return;)676
4076 y(i_mask.unmask\(i\);)676 4168 y(if)g(\(i)g(<)f
(OFF_MDEP_NPINT_MAX\))755 4259 y(pic_enable_irq\(i\);)598
4442 y(})1885 5255 y Fz(373)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
374 375 bop 515 523 a FA(In)m(terrupt)33 b(deliv)m(ering)515
676 y Fz(When)40 b(an)f(in)n(terrupt)g(o)r(ccurs,)i(this)f(routine)f
(is)g(called)g(with)h(in)n(terrupts)f(cleared.)71 b(It)515
776 y(receiv)n(es)27 b(the)h(in)n(terrupt)g(n)n(um)n(b)r(er)h(and)f(a)g
(p)r(oin)n(ter)g(to)g(the)h(sa)n(v)n(ed)e(used)h(state.)39
b(Although)515 876 y(suc)n(h)g(state)g(lo)r(oks)f(lik)n(e)h(a)f(trap)h
(frame)g(only)f(the)i(sa)n(v)n(ed)e(segmen)n(t)g(registers)g(and)h(the)
515 975 y(register)26 b(state)h(frame)g(are)g(v)-5 b(alid.)639
1075 y(Deliv)n(ering)21 b(simply)g(calls)f Fx(raise)g
Fz(in)h(the)h(in)n(terrupt)e(table)i(for)e(the)i(curren)n(t)e(pro)r
(cessor.)515 1174 y(Note)27 b(that)h(the)g(in)n(terrupt)g(has)f
(already)f(b)r(een)i(ac)n(kno)n(wledged)d(b)n(y)j(the)g(assem)n(bly)e
(stub.)639 1274 y(W)-7 b(e)24 b(alw)n(a)n(ys)e(deliv)n(er)g(an)h(in)n
(terrupt,)h(no)f(matter)h(if)g(a)f(previous)f(one)h(has)g(b)r(een)h
(already)515 1374 y(pro)r(cessed)32 b(or)g(not.)53 b(In)n(terrupt)33
b(handlers)f(should)h(protect)f(themselv)n(es)h(against)f(p)r(end-)515
1473 y(ing)f(in)n(terrupts:)44 b(p)r(ortal)31 b(serviced)g(in)n
(terrupts)g(can)g(do)h(so)e(b)n(y)i(limiting)g(the)g(n)n(um)n(b)r(er)f
(of)515 1573 y(a)n(v)-5 b(ailable)26 b(stac)n(ks)g(to)i(just)g(one;)f
(pro)r(cedure)g(serviced)f(in)n(terrupts)h(should)h(use)f(a)g(\\nested)
515 1673 y(in)n(terrupt")22 b(coun)n(ter)g(to)h(deal)g(with)h(missed)f
(in)n(terrupts.)34 b(Deliv)n(ering)23 b(co)r(de)f(o\013ers)h(a)f(small)
515 1772 y(protection)32 b(in)h(that)g(in)n(terrupts)g(will)g(b)r(e)g
(disabled)g(un)n(til)g(the)g(message)f(has)g(b)r(een)h(sen)n(t)515
1872 y(\(or)i(the)i(pro)r(cedure)e(called\).)62 b(In)n(terrupts)35
b(are)h(enabled)f(again)g(as)h(so)r(on)f(the)h(mac)n(hine)515
1971 y(dep)r(enden)n(t)28 b(in)n(terrupt)f(handler)g(returns.)639
2071 y(Clo)r(c)n(k)f(in)n(terrupt)h(handling)f(is)g(a)h(little)g(bit)g
(sp)r(ecial,)g(b)r(ecause)f(w)n(e)g(do)h(not)f(w)n(an)n(t)g(it)h(to)515
2171 y(tra)n(v)n(el)d(the)j(common)e(in)n(terrupt)h(deliv)n(ering)f
(path.)36 b(T)-7 b(o)26 b(a)n(v)n(oid)e(that,)j(the)f(timer)g(serv)n
(er)e(of)515 2270 y(the)f(curren)n(t)f(pro)r(cessor)e(is)j(directly)f
(noti\014ed.)36 b(W)-7 b(e)23 b(m)n(ust)g(reset)f(the)h(k)n(ernel)f
(stac)n(k)f(p)r(oin)n(ter)515 2370 y(for)32 b(ring)g(zero)g(to)h(b)r(e)
g(the)h(curren)n(t)e(one.)52 b(That)33 b(w)n(a)n(y)f(in)n(terrupts)g
(will)h(not)g(clobb)r(er)g(the)515 2470 y(k)n(ernel)26
b(stac)n(k.)515 2602 y Fk(h)p Fi(off)p 667 2602 24 4
v 29 w(mdep)p 852 2602 V 29 w(intr)p 1037 2602 V 29 w(handler)j
Fj(implementation.)e Fk(i)p Fq(\021)598 2694 y Fi(//)39
b(Handles)i(an)f(interrupt.)598 2785 y(//)598 2876 y(volatile)h(void)f
(off_mdep_intr_handler\(unsigne)q(d)45 b(irq,)40 b(struct)h(trap_state)
g(*ts\))598 2968 y({)676 3059 y(off_mdepProcRegs)i
(*uregs=\(off_mdepProcRegs*\)ts;)676 3150 y(off_Shtl)e
(*me=off_Shtl::self\(\);)676 3242 y Fk(h)p Fj(L)l(o)l(c)l(al)28
b(variables)h(for)e Fi(uregs)i Fj(user)f(state)i(pushing.)e
Fk(i)676 3424 y(h)p Fj(Push)g Fi(uregs)h Fj(user)f(state)i(for)d
Fi(me)p Fj(.)h Fk(i)676 3516 y Fi(off_Processor::seti\(\);)676
3607 y Fk(h)p Fj(Print)g(the)g(stack)i(ho)l(ok.)d Fk(i)676
3790 y Fi(if)40 b(\(irq)g(==)g(OFF_MDEP_CLOCK_IRQ\))j({)755
3881 y(off_Processor::self\(\)->get_tmr\()q(\).cl)q(ock_)q(handl)q
(er\(\))q(;)676 3972 y(})676 4064 y(else)d({)755 4155
y(do_debug\(kcout)i(<<)e(fmt\("i\(\045x\)",irq\))j(<<)c(nl\);)755
4246 y(off_Processor::self\(\)->get_irq\()q(irq\))q(->ra)q(ise\(\))q(;)
676 4338 y(})676 4429 y(off_Processor::clri\(\);)676
4520 y Fk(h)p Fj(Pop)28 b Fi(uregs)h Fj(user)f(state)h(for)f
Fi(me)p Fj(.)f Fk(i)598 4703 y Fi(})1885 5255 y Fz(374)p
eop
PStoPSsaved restore
%%Page: (376,377) 189
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
375 376 bop 639 523 a Fz(Where,)28 b(on)f(In)n(tels,)h
Fx(MDEP)p 1474 523 27 4 v 29 w(CLOCK)p 1723 523 V 30
w(IRQ)e Fz(is)515 636 y Fk(h)p Fj(O\013)h(machine)h(dep)l(endent)h
(interrupt)h(numb)l(ers.)e Fk(i)p Fz(+)p Fq(\021)598
727 y Fi(const)40 b(natural_t)h(OFF_MDEP_CLOCK_IRQ=0;)j(//)c(Timer)g
(interrupt.)639 848 y Fz(A)28 b(ho)r(ok)f(is)h(k)n(ept)f(for)g
(debugging.)515 960 y Fk(h)p Fj(Print)h(the)g(stack)h(ho)l(ok.)f
Fk(i)p Fq(\021)598 1052 y Fi(#if)40 b(0)637 1143 y(static)h(int)e
(last_esp=0;)637 1234 y(if)h(\(last_esp)h(!=)f(get_esp\(\)\){)715
1326 y(printf\("{esp)i(\045x}",get_esp\(\)\);)715 1417
y(last_esp=get_esp\(\);)637 1508 y(})637 1600 y(else)715
1691 y(putchar\('_'\);)598 1782 y(#endif)515 1929 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g(implementation)f
(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2020 y
Fi(#include)41 b(<flux/machine/base_tss.h>)598 2112 y(#include)g
(<hw/Processor.h>)278 b(//)40 b(for)g(off_Processor)639
2245 y Fz(That)24 b(handler)e(is)h(called)g(b)n(y)g(a)g(small)g(assem)n
(bly)f(glue)h(co)r(de.)35 b(First,)25 b(w)n(e)d(will)i(initialize)515
2345 y(in)c(the)g(base)f(IDT)h Fx(base)p 1270 2345 V
29 w(idt)f Fz(new)h(en)n(tries)f(for)g(ev)n(ery)f(PC)h(hardw)n(are)f
(in)n(terrupt.)34 b(Eac)n(h)18 b(de-)515 2445 y(scriptor)j(jumps)h(to)g
(an)g(in)n(terrupt)g(en)n(try)f(p)r(oin)n(t)h(as)g(de\014ned)g(in)g
Fx(off)p 2637 2445 V 30 w(mdep)p 2843 2445 V 30 w(intr)p
3049 2445 V 30 w(inittab)515 2544 y Fz(\(see)33 b(b)r(elo)n(w\).)56
b(After)34 b(that,)i(the)e(master)f(en)h(sla)n(v)n(e)e(PICs)h(are)g
(initialized)h(v)n(ectoring)e(to)515 2644 y(the)e(en)n(tries)e
(installed)i(in)g(the)f(IDT.)h(Th)n(us)g(w)n(e)f(are)f(able)h(no)n(w)g
(to)g(receiv)n(e)g(hardw)n(are)e(in-)515 2743 y(terrupts)f(and)g(they)h
(will)f(lead)h(to)f(our)g(in)n(terrupt)g(routine)g(b)r(eing)g(in)n(v)n
(ok)n(ed,)g(though)g(they)515 2843 y(w)n(ere)j(initially)h(disabled)f
(in)h(the)h(PIC)e(\(using)h Fx(pic)p 2153 2843 V 30 w(disable)p
2491 2843 V 28 w(all)p Fz(\))f(to)h(a)n(v)n(oid)e(undesired)515
2943 y(in)n(terrupt)f(receipts)h(b)r(efore)f(their)h(handlers)f(are)g
(actually)g(ready)g(and)h(initialized.)38 b(This)515
3042 y(is)27 b(done)h(when)f(the)h(in)n(terrupt)g(table)f(is)h(instan)n
(tiated.)639 3142 y(The)f Fx(idt)e Fz(is)i(used)f(b)r(oth)h(to)g(v)n
(ector)e(traps)h(and)g(in)n(terrupts.)36 b(First)27 b(32)e(\()p
Fx(0x0)h Fz(to)g Fx(0x1f)p Fz(\))515 3242 y(of)i(a)g(total)g(n)n(um)n
(b)r(er)g(of)g(256)f(en)n(tries)h(will)g(b)r(e)h(used)g(for)e(In)n(tel)
i(pro)r(cessor)d(traps.)38 b(Next)29 b(16)515 3341 y(en)n(tries)22
b(\()p Fx(0x20)f Fz(to)i Fx(0x2f)p Fz(\))e(en)n(tries)i(will)g(b)r(e)g
(used)f(for)h(PC)f(hardw)n(are)f(in)n(terrupts.)34 b(Remain-)515
3441 y(ing)29 b(ones)f(can)h(b)r(e)g(de\014ned)h(later)e(on)h(b)n(y)g
(the)h(user)e(|but)i(for)e(the)i(one)f(used)g(for)f(system)515
3540 y(calls,)f Fx(0x30)p Fz(,)f(and)h(returns)g(from)g(up)r(calls,)h
Fx(0x31)p Fz(.)515 3666 y Fk(h)p Fj(Machine)f(dep)l(endent)j(interrupt)
g(har)l(dwar)l(e)f(initialization.)d Fk(i)p Fq(\021)598
3757 y Fi(gate_init\(base_idt,)43 b(off_mdep_intr_inittab,)i
(KERNEL_CS\);)598 3849 y(pic_init\(PICM_VECTBASE,)f(PICS_VECTBASE\);)
598 3940 y(pic_disable_all\(\);)515 4099 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(event)g(table)g(implementation)f(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 4191 y Fi(#include)41
b(<flux/machine/base_gdt.h>)123 b(//)40 b(for)g(KERNEL_CS)598
4282 y(#include)h(<flux/machine/base_idt.h>)123 b(//)40
b(for)g(base_idt)598 4373 y(#include)h(<flux/machine/gate_init.h>)84
b(//)40 b(for)g(gate_init)598 4465 y(#include)h(<hw/mdep/intr.h>)474
b(//)40 b(for)g(off_mdep_intr_inittab)639 4598 y Fz(The)27
b(in)n(terrupt)f(table)h Fx(off)p 1505 4598 V 30 w(mdep)p
1711 4598 V 30 w(intr)p 1917 4598 V 29 w(inittab)d Fz(is)j(main)n
(tained)f(in)h(a)f(separate)f(as-)515 4698 y(sem)n(bly)i(\014le)h
(together)e(with)j(the)e(real)g(in)n(terrupt)g(en)n(try)g(p)r(oin)n(t.)
515 4824 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(interrupt)h
(inittab.)d Fk(i)p Fq(\021)598 5006 y Fi(extern)40 b(struct)h
(gate_init_entry)i(off_mdep_intr_inittab[];)1885 5255
y Fz(375)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
376 377 bop 639 523 a Fz(W)-7 b(e)28 b(will)g(need)g(some)f(includes)h
(for)f(this)g(co)r(de)h(to)f(w)n(ork.)515 639 y Fk(h)p
Fj(O\013)g(har)l(dwar)l(e)i(interrupts)h(implementation)e(dep)l
(endencies.)h Fk(i)p Fq(\021)598 731 y Fi(#include)41
b(<flux/machine/asm.h>)598 822 y(#include)g(<flux/machine/gate_init.h>)
598 913 y(#include)g(<flux/machine/seg.h>)639 1038 y
Fz(T)-7 b(o)27 b(mak)n(e)g(easy)g(the)h(task)f(of)g(in)n(terrupt)g(en)n
(try)g(p)r(oin)n(t)h(declaration,)e(a)h(macro)g(is)g(used)515
1137 y(to)j(generate)f(an)h(in)n(terrupt)g(en)n(try)f(p)r(oin)n(t.)45
b(Suc)n(h)31 b(en)n(try)e(p)r(oin)n(t)i(will)f(push)h(the)f(in)n
(terrupt)515 1237 y(n)n(um)n(b)r(er)c(and)g(pass)f(con)n(trol)g(to)i
Fx(allints)p Fz(.)33 b(In)n(terrupt)26 b(gates)f(will)i(b)r(e)g(placed)
f(on)g(the)g Fx(idt)515 1337 y Fz(at)h(o\013set)h Fx(IDT)p
973 1337 27 4 v 30 w(IRQ)p 1135 1337 V 30 w(BASE)p Fz(.)515
1453 y Fk(h)p Fj(O\013)f(har)l(dwar)l(e)i(interrupts)h(de\014nitions.)e
Fk(i)p Fq(\021)598 1544 y Fi(#define)41 b(INTERRUPT\(irq\))709
b(\\)912 1636 y(GATE_ENTRY\(\(irq\))42 b(+)e(IDT_IRQ_BASE,)i(0f,)e
(ACC_PL_K|ACC_INTR_GATE\))162 b(;\\)912 1727 y(P2ALIGN\(TEXT_ALIGN\))
514 b(;\\)598 1818 y(0:)1491 b(;\\)912 1910 y(cld)1138
b(;\\)912 2001 y(pushl)118 b($0)864 b(;\\)912 2092 y(pushl)118
b($\(irq\))708 b(;\\)912 2183 y(pushal)1021 b(;\\)912
2275 y(movl)157 b($\(irq\),\045eax)513 b(;\\)912 2366
y(jmp)196 b(allints)515 2491 y Fz(Where)515 2607 y Fk(h)p
Fj(O\013)27 b(har)l(dwar)l(e)i Fi(IRQBASE)p Fj(.)g Fk(i)p
Fq(\021)598 2698 y Fi(#define)41 b(IDT_IRQ_BASE)h(0x20)639
2823 y Fz(No)n(w)21 b(w)n(e)f(can)h(use)g(the)g(ab)r(o)n(v)n(e)e(macro)
h(and)h(OSKit)f Fx(GATE)p 2414 2823 V 30 w(INITTAB)p
2752 2823 V 50 w Fz(macros)f(to)i(de\014ne)515 2922 y(a)j(table)g(of)g
(in)n(terrupt)h(\(and)f(trap\))g(en)n(try)g(p)r(oin)n(ts.)36
b(Remem)n(b)r(er)24 b(that)h Fx(allints)c Fz(m)n(ust)k(p)r(op)515
3022 y Fx(eax)h Fz(and)i(execute)f(an)g Fx(iret)f Fz(to)i(return:)515
3138 y Fk(h)p Fj(O\013)f(har)l(dwar)l(e)i(interrupt)h(r)l(eturn.)e
Fk(i)p Fq(\021)598 3230 y Fi(popal)598 3321 y(addl)118
b($8,\045esp)598 3412 y(iret)1885 5255 y Fz(376)p eop
PStoPSsaved restore
%%Page: (378,379) 190
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
377 378 bop 639 523 a Fz(The)28 b(en)n(try)f(p)r(oin)n(t)h
(de\014nitions)f(are)g(no)n(w)g(really)g(easy)-7 b(.)515
639 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(interrupt)h(entry)f(p)l
(oints.)f Fk(i)o Fq(\021)598 731 y Fi(GATE_INITTAB_BEGIN\(off_mdep_in)q
(tr_in)q(itta)q(b\))598 913 y(INTERRUPT\(0\))598 1005
y(INTERRUPT\(1\))598 1096 y(INTERRUPT\(2\))598 1187 y(INTERRUPT\(3\))
598 1279 y(INTERRUPT\(4\))598 1370 y(INTERRUPT\(5\))598
1461 y(INTERRUPT\(6\))598 1553 y(INTERRUPT\(7\))598 1644
y(INTERRUPT\(8\))598 1735 y(INTERRUPT\(9\))598 1826 y(INTERRUPT\(10\))
598 1918 y(INTERRUPT\(11\))598 2009 y(INTERRUPT\(12\))598
2100 y(INTERRUPT\(13\))598 2192 y(INTERRUPT\(14\))598
2283 y(INTERRUPT\(15\))598 2374 y(GATE_INITTAB_END)1885
5255 y Fz(377)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
378 379 bop 639 523 a Fz(The)33 b(common)g(in)n(terrupt)f(handling)h
(routine)g(is)g Fx(allints)p Fz(.)50 b(This)33 b(routine)f(handles)515
623 y(initial)27 b(in)n(terrupt)g(hardw)n(are)e(details)i(and)g(then)g
(jumps)h(to)f(the)g Fu(C)7 b Fx(++)27 b Fz(en)n(try)f(p)r(oin)n(t)h
(\(with)515 722 y Fu(C)k Fz(link)-5 b(age\).)49 b(A)32
b(global)e(coun)n(ter)h(coun)n(ting)f(the)i(n)n(um)n(b)r(er)g(of)f
(nested)h(in)n(terrupts)f(is)g(also)515 822 y(managed)26
b(here.)37 b(W)-7 b(e)28 b(will)f(switc)n(h)h(from)f(user)g(to)h(k)n
(ernel)e(segmen)n(ts)h(on)g(in)n(terrupt.)515 955 y Fk(h)p
Fj(O\013)g(har)l(dwar)l(e)i(interrupt)h(c)l(ommon)d(hand)t(ling)h(r)l
(outine.)g Fk(i)p Fq(\021)912 1046 y Fi(cld)912 1137
y(cli)912 1229 y(pushl)118 b(\045ds)1139 b(#)39 b(save)h(segments)912
1320 y(pushl)118 b(\045es)912 1411 y(pushl)g(\045fs)912
1503 y(pushl)g(\045gs)755 1594 y(movw)157 b(\045ss,\045cx)826
b(#)39 b(set)h(kernel)h(segments)755 1685 y(movw)157
b(\045cx,\045ds)755 1777 y(movw)g(\045cx,\045es)912 1959
y(incl)g(off_mdep_intr_count)912 2051 y(movl)g($1,\045edx)983
b(#)39 b(if)h(this)g(master)h(or)e(slave?)912 2142 y(movl)157
b(\045eax,\045ecx)912 2233 y(cmpl)g($8,\045eax)912 2325
y(jge)196 b(1f)912 2416 y(movb)157 b($0x20,\045al)905
b(#)118 b(ack)39 b(int)912 2507 y(outb)157 b(\045al,$0x20)912
2599 y(jmp)196 b(2f)598 2690 y(1:)1805 b(#)39 b(slave)h(PIC)912
2781 y(movb)157 b($0x20,\045al)905 b(#)118 b(ack)39 b(irq)912
2873 y(outb)157 b(\045al,$0x20)912 2964 y(outb)g(\045al,$0xa0)912
3055 y(addl)g($8,\045ecx)983 b(#)118 b(adjust)40 b(irq)g(nb.)g(0th)g
(is)g(8th.)598 3147 y(2:)912 3238 y(incl)157 b(off_mdep_intr_nest)554
b(#)39 b(count)h(this)h(int)912 3329 y(pushl)118 b(\045esp)1100
b(#)39 b(and)h(usr)g(state)g(ptr.)912 3421 y(pushl)118
b(\045ecx)1100 b(#)39 b(push)h(int)g(#)912 3512 y(call)157
b(EXT\(off_mdep_intr_handler\))242 b(#)39 b(call)h(interrupt)i(handler)
912 3603 y(popl)157 b(\045ecx)1100 b(#)39 b(clean)h(handler)h
(arguments)912 3694 y(popl)157 b(\045esp)598 3877 y(2:)912
3968 y(cmpl)g($1,off_mdep_intr_nest)437 b(#)39 b(check)h(for)g
(software)h(intr)912 4060 y(jne)196 b(1f)912 4151 y(cmpl)157
b($0,off_mdep_intr_pending)912 4242 y(je)235 b(1f)912
4334 y(movl)157 b($0,off_mdep_intr_pending)912 4425 y(call)g
(EXT\(off_mdep_intr_handler\))598 4516 y(1:)755 4608
y(cli)912 4699 y(decl)g(off_mdep_intr_nest)912 4790 y(popl)g(\045gs)
1178 b(#)39 b(restore)i(segments)912 4882 y(popl)157
b(\045fs)912 4973 y(popl)g(\045es)1885 5255 y Fz(378)p
eop
PStoPSsaved restore
%%Page: (380,381) 191
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
379 380 bop 912 523 a Fi(popl)157 b(\045ds)912 614 y
Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(interrupt)h(r)l(eturn.)e
Fk(i)912 797 y Fi(.data)912 888 y(P2ALIGN\(DATA_ALIGN\))912
980 y(.globl)40 b(off_mdep_intr_nest)598 1071 y(off_mdep_intr_pending:)
912 1162 y(.long)118 b(0)912 1254 y(.globl)40 b(off_mdep_intr_pe)598
1345 y(off_mdep_intr_nest:)912 1436 y(.long)118 b(0)912
1528 y(.globl)40 b(off_mdep_intr_count)598 1619 y(off_mdep_intr_count:)
912 1710 y(.long)118 b(1)639 1931 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(this)
h(coun)n(ters)e(a)n(v)-5 b(ailable)515 2042 y Fk(h)p
Fj(O\013)27 b(har)l(dwar)l(e)i(interrupt)h(c)l(ounters.)f
Fk(i)p Fq(\021)598 2133 y Fi(extern)40 b(volatile)h(u_long)g
(off_mdep_intr_nest;)598 2225 y(extern)f(volatile)h(u_long)g
(off_mdep_intr_pending;)598 2316 y(//extern)g(volatile)g(u_long)f
(off_mdep_intr_count;)515 2546 y FA(T)-8 b(rap)33 b(deliv)m(ering)515
2699 y Fz(The)k(OSKit)f(deliv)n(ers)g(traps)g(to)h(the)h
Fx(base)p 1939 2699 27 4 v 29 w(trap)p 2144 2699 V 30
w(handler)c Fz(routine,)39 b(if)e(de\014ned.)66 b(W)-7
b(e)515 2799 y(pro)n(vide)27 b(suc)n(h)i(routine)g(just)g(to)g(notify)g
(the)g(trap)g(table)g(of)g(the)g(curren)n(t)f(pro)r(cessor)f(that)515
2898 y(a)g(trap)g(happ)r(ened.)639 2998 y(Suc)n(h)e(handler)g(is)g
(installed)g(b)n(y)g(the)h(mac)n(hine)e(dep)r(enden)n(t)i(trap)f(table)
g(at)g(b)r(o)r(ot)h(time.)515 3120 y Fk(h)p Fj(O\013)h(machine)h(dep)l
(endent)h(tr)l(ap)g(table.)f Fk(i)p Fq(\021)598 3211
y Fi(//)39 b(An)h(ix86)g(trap)g(table)598 3302 y(//)598
3393 y(class)g(off_mdepTrapTbl)j({)598 3485 y(public:)676
3576 y(//)d(Creates)h(an)e(x86)h(trap)g(table.)676 3667
y(off_mdepTrapTbl\(void\);)676 3850 y(//)g(Returns)h(the)f(id)f(for)h
(the)g(page)g(fault)h(trap.)676 3941 y(static)g(inline)f(int)g
(get_pgflt\(void\);)676 4033 y(//)g(Returns)h(the)f(id)f(for)h(the)g
(NOFPU)g(trap.)676 4124 y(static)h(inline)f(int)g(get_nofpu\(void\);)
676 4307 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4307 24 4 v 29 w(mdepTrapTbl)p Fj(.)j Fk(i)598
4398 y Fi(};)598 4581 y(extern)40 b(inline)h(int)f
(off_mdepTrapTbl::get_pgflt\(voi)q(d\){)46 b(return)40
b(T_PAGE_FAULT;})598 4672 y(extern)g(inline)h(int)f
(off_mdepTrapTbl::get_nofpu\(voi)q(d\){)46 b(return)40
b(T_NO_FPU;})515 4915 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(event)g(table)g(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
5006 y Fi(#include)41 b(<flux/machine/trap.h>)83 b(//)40
b(for)g(T_PAGE_FAULT)1885 5255 y Fz(379)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
380 381 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepTrapTbl::off)p 1320 523 V 31 w(mdepTrapTbl)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 614 y Fi(extern)40
b("C")g({)676 706 y(extern)h(int)f(off_mdep_trap_handler\(struct)45
b(trap_state)d(*state\);)598 797 y(};)598 888 y
(off_mdepTrapTbl::off_mdepTrapT)q(bl\(vo)q(id\))598 980
y({)676 1071 y(if)e(\(!base_trap_handler\))755 1162 y
(base_trap_handler)j(=)c(off_mdep_trap_handler;)676 1254
y(//)h(else)g(gdb)g(has)g(it!)598 1345 y(})515 1519 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
1611 y Fi(#include)41 b(<flux/machine/base_trap.h>)k(//)40
b(for)79 b(base_trap_handler)1885 5255 y Fz(380)p eop
PStoPSsaved restore
%%Page: (382,383) 192
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
381 382 bop 639 523 a Fz(The)28 b(mac)n(hine)f(dep)r(enden)n(t)h(trap)g
(handler)f(simply)g(obtains)g(a)h(reference)e(to)i(the)g(cur-)515
623 y(ren)n(t)22 b(pro)r(cessor)f(and)h(deliv)n(ers)g(the)h(trap)f(on)h
(its)f(trap)h(table.)35 b(In)23 b(those)f(cases)g(where)g(extra)515
722 y(information)i(m)n(ust)g(b)r(e)h(gathered)f(from)g(hardw)n(are)f
(to)h(determine)h(the)g(trap)f(reason)f(\(e.g.)515 822
y(on)28 b(page)h(faults\).)41 b(W)-7 b(e)30 b(m)n(ust)f(reset)f(the)i
(k)n(ernel)e(stac)n(k)g(p)r(oin)n(ter)h(for)f(ring)g(zero)g(to)h(b)r(e)
h(the)515 922 y(curren)n(t)c(one.)37 b(That)28 b(w)n(a)n(y)e(in)n
(terrupts)h(will)h(not)f(clobb)r(er)g(the)h(k)n(ernel)f(stac)n(k.)639
1021 y(There)g(is)g(an)g(exceptional)f(case:)36 b(When)28
b(traps)e(corresp)r(ond)g(to)h(actual)g(system)g(calls)515
1121 y(\(p)r(ortal)k(send)h(and)f(return\))h(the)g(trap)f(is)h(deliv)n
(ered)f(straigh)n(t)f(to)i(the)g(p)r(ortal)f(serv)n(er)f(in-)515
1220 y(stead.)515 1353 y Fk(h)p Fi(off)p 667 1353 24
4 v 29 w(mdep)p 852 1353 V 29 w(trap)p 1037 1353 V 29
w(handler)f Fj(implementation.)e Fk(i)p Fq(\021)598 1445
y Fi(//)598 1536 y(//)598 1627 y(int)40 b
(off_mdep_trap_handler\(struct)45 b(trap_state)d(*state\))598
1719 y({)676 1810 y(err_t)f(err;)676 1901 y(off_mdepProcRegs)i
(*uregs=\(off_mdepProcRegs*\)sta)q(te;)676 1993 y Fk(h)p
Fj(L)l(o)l(c)l(al)28 b(variables)h(for)e Fi(uregs)i Fj(user)f(state)i
(pushing.)e Fk(i)676 2175 y Fi(switch\(state->trapno\){)676
2267 y Fk(h)p Fj(c)l(ase)h(for)e(har)l(dwir)l(e)l(d)i(tr)l(ap)g
(delivering)f(in)f(machine)h(dep)l(endent)i(tr)l(ap)e(hand)t(ler.)g
Fk(i)676 2358 y Fi(default:)755 2449 y(do_debug\(trap_dump\(state\)\);)
755 2540 y({)833 2632 y(off_Shtl)41 b(*me=off_Shtl::self\(\);)833
2723 y(char)f(trapmsgbuf[OFF_MDEP_TRAPMSG_)q(MAX])q(;)833
2814 y(off_TrapReq)i(*req;)833 2906 y(off_TrapRep)g(rep;)833
2997 y(vm_size_t)f(tsz;)833 3088 y Fk(h)p Fj(Push)28
b Fi(uregs)h Fj(user)f(state)i(for)d Fi(me)p Fj(.)h Fk(i)833
3180 y Fi(off_Processor::seti\(\);)833 3271 y
(req=off_mdepTrapTbl::build_tr)q(ap_m)q(sg\(t)q(rapms)q(gbuf)q(,tsz,)q
(stat)q(e->t)q(rapno)q(,sta)q(te\);)833 3362 y
(err=off_Processor::self\(\)->ge)q(t_tr)q(ap\(s)q(tate-)q(>tra)q
(pno\)-)q(>rai)q(se\()1578 3454 y(me->get_id\(\),tsz,sizeof\(off)q
(_Trap)q(Rep\))q(,req)q(,&rep)q(\);)833 3636 y(if)40
b(\(\(state->cs&3\)==0)239 b(//)40 b(!from)g(kernel)1029
3728 y(&&)g(err\){)912 3819 y(panic\("double)i(faults)e(in)g(unknown)h
(state"\);)990 3910 y(err=off_Processor::self\(\)->ge)q(t_tr)q(ap\(OF)q
(F_EX)q(_UTRA)q(P\)->)q(rais)q(e\()1657 4002 y
(me->get_id\(\),tsz,sizeof\(off_Tr)q(apRe)q(p\),r)q(eq,&r)q(ep\);)912
4093 y(if)e(\(err||rep.m_err\){)990 4184 y(kcout)h(<<)g("unhandled)i
(double)e(trap.)h(killing)f(")g(<<)f(me->get_id\(\))j(<<)e(nl;)990
4276 y(delete)h(off_Shtl::self\(\);)912 4367 y(})833
4458 y(})833 4641 y(off_Processor::clri\(\);)833 4732
y Fk(h)p Fj(Pop)28 b Fi(uregs)g Fj(user)h(state)g(for)f
Fi(me)p Fj(.)f Fk(i)833 4824 y Fi(if)40 b(\(err\))g({)g
(printf\("unhandled)j(\045x)c(",state->trapno\);)k(otsan\(\);)f(})833
4915 y(return)f(err;)755 5006 y(})1885 5255 y Fz(381)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
382 383 bop 676 523 a Fi(})598 706 y(})515 971 y Fk(h)p
Fj(Other)28 b(virtual)g(tr)l(aps.)h Fk(i)p Fq(\021)598
1063 y Fi(OFF_EX_UTRAP,)515 1237 y Fk(h)p Fj(O\013)e(machine)h(dep)l
(endent)h(event)g(table)g(implementation)f(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 1328 y Fk(h)p Fj(Extr)l(a)g(dep)l(endencies)g
(adde)l(d)g(by)f(c)l(ase)h(for)e(har)l(dwir)l(e)l(d)i(tr)l(ap)g
(delivering.)e Fk(i)598 1420 y(h)p Fj(Push)h(and)g(p)l(op)g
Fi(uregs)h Fj(user)f(state)h(dep)l(endencies.)h Fk(i)639
1561 y Fz(The)22 b(metho)r(d)h Fx(build)p 1326 1561 27
4 v 29 w(trap)p 1531 1561 V 30 w(msg)e Fz(constructs)g(an)h
(appropriate)f(trap)g(message)g(for)h(the)515 1660 y(giv)n(en)27
b(trap)g(n)n(um)n(b)r(er.)515 1777 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 1777 24 4 v 29 w(mdepTrapTbl)p
Fj(.)i Fk(i)p Fq(\021)598 1868 y Fi(static)40 b(off_TrapReq)i
(*build_trap_msg\(void)i(*buf,vm_size_t)e(&sz,)e(err_t)h(trapno,)1971
1959 y(struct)f(trap_state)i(*s\);)515 2117 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g(dep)l
(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 2208 y Fi(class)40
b(off_TrapReq;)515 2383 y Fk(h)p Fi(off)p 667 2383 V
29 w(mdepTrapTbl::build)p 1398 2383 V 32 w(trap)p 1586
2383 V 29 w(msg)28 b Fj(implementation.)g Fk(i)o Fq(\021)598
2474 y Fi(off_TrapReq)41 b(*off_mdepTrapTbl::build_tra)q(p_ms)q(g\(voi)
q(d)k(*buf,vm_size_t)e(&sz,)2363 2565 y(err_t)d(trapno,)2363
2657 y(struct)h(trap_state)g(*s\))598 2748 y({)676 2839
y(switch\(trapno\){)676 2931 y(case)f(T_PAGE_FAULT:)755
3022 y(sz=sizeof\(off_PgFltReq\);)755 3113 y(return)g(new\(buf\))h
(off_PgFltReq\(get_cr2\(\),s->er)q(r\);)676 3205 y(default:)755
3296 y(sz=sizeof\(off_TrapReq\);)755 3387 y(return)f(new\(buf\))h
(off_TrapReq\(trapno,s->err\);)676 3479 y(})598 3570
y(})639 3802 y Fz(Curren)n(tly)-7 b(,)27 b(the)h(biggest)f(trap)g
(message)f(is)i(that)g(of)f(page)g(faults.)515 3919 y
Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(event)g(table)g
(implementation)f(symb)l(ols.)f Fk(i)p Fq(\021)598 4010
y Fi(const)40 b(vm_size_t)h(OFF_MDEP_TRAPMSG_MAX=sizeof)q(\(off_)q
(PgFl)q(tReq\))q(;)515 4168 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l
(endent)h(event)g(table)g(dep)l(endencies.)g Fk(i)p Fz(+)o
Fq(\021)598 4259 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40
b(for)g(trap)g(and)g(interrupt)h(messages.)1885 5255
y Fz(382)p eop
PStoPSsaved restore
%%Page: (384,385) 193
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
383 384 bop 639 523 a Fz(W)-7 b(e)28 b(still)g(ha)n(v)n(e)f(to)g
(de\014ne)h(b)r(oth)g(trap)f(and)g(in)n(terrupt)h(messages.)515
639 y Fk(h)p Fj(O\013)f(user-kernel)j(messages.)f Fk(i)p
Fq(\021)598 731 y Fi(//)39 b(Event)i(messages,)g(traps)f(and)g
(interrupts.)598 822 y(struct)g(off_EventReq)i(:)e(public)g(off_MsgReq)
i({)676 913 y(off_EventReq\(const)i(off_id_t)d(&n\))e(:)h
(off_MsgReq\(n.i_offset\))k({;})676 1005 y(off_EventReq\(off_ex_t)g
(e\))c(:)f(off_MsgReq\(e\))k({;})598 1187 y(};)598 1370
y(struct)d(off_IrqReq)i(:)d(public)i(off_EventReq)h({)676
1461 y(off_IrqReq\(const)h(off_id_t)e(&n\))f(:)f(off_EventReq\(n\))k
({;})676 1553 y(off_IrqReq\(off_ex_t)83 b(i\))40 b(:)f
(off_EventReq\(i\))k({;})598 1644 y(};)598 1826 y(struct)d
(off_TrapReq:)i(public)f(off_EventReq)h({)676 1918 y(err_t)f(t_error;)
676 2009 y(void)f(*operator)i(new\(size_t)f(s,)f(void)g(*p\))g
({\(void\)s;)h(return)g(p;})676 2100 y(off_TrapReq\(const)i(off_id_t)e
(&n,)f(err_t)h(e\))e(:)h(off_EventReq\(n\),)j(t_error\(e\))e({;})676
2192 y(off_TrapReq\(off_ex_t)j(t,)c(err_t)g(e\))g(:)f
(off_EventReq\(t\),)k(t_error\(e\))f({;})598 2283 y(};)598
2466 y(typedef)f(off_MsgRep)g(off_TrapRep;)598 2557 y(typedef)g
(off_MsgRep)g(off_EventRep;)1885 5255 y Fz(383)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
384 385 bop 639 523 a Fz(It)37 b(kno)n(ws)e(b)r(oth)h(the)h(faulting)f
(address)f(and)h(ho)n(w)f(to)h(deco)r(de)g(the)h(error)d(co)r(de)i(for)
515 623 y(page)26 b(faults.)515 756 y Fk(h)p Fj(O\013)h(user-kernel)j
(messages.)f Fk(i)p Fz(+)o Fq(\021)598 847 y Fi(//)39
b(Page)i(fault)f(message.)598 938 y(//)f(XXX)h(this)g(is)g(an)g(mdep)g
(msg)g(and)g(should)g(be)g(at)g(mdep/ex.h)h(instead.)598
1029 y(//)e(The)h(error)h(code)f(should)g(be)g(translated)i(by)d(the)h
(mdep)g(layer)598 1121 y(//)f(before)i(forwarding)h(to)d(user.)598
1212 y(//)598 1303 y(struct)h(off_PgFltReq)i(:)e(public)g(off_TrapReq)i
({)676 1395 y(vm_offset_t)g(p_vaddr;)676 1486 y(off_id_t)159
b(p_dtlb;)433 b(//)40 b(Filled)g(later)h(if)e(forwarded)j(to)d(the)h
(user.)676 1577 y(off_PgFltReq\()i(vm_offset_t)g(va,)e(err_t)g(err\):)
755 1669 y(off_TrapReq\(OFF_EX_DTLBMISS,err)q(\),)755
1760 y(p_vaddr\(va\))676 1851 y({;})676 1943 y(void)g(set_dtlb\(const)j
(off_id_t)e(&d\))f({)f(p_dtlb=d;)i(})676 2034 y(void)f(*operator)i
(new\(size_t)f(s,void)g(*p\){\(void\)s;)h(return)e(p;})676
2125 y(//)g(This)g(is)g(the)g(faulting)h(address.)676
2217 y(inline)g(vm_offset_t)h(get_vaddr\(void\))g(const)f({)e(return)i
(p_vaddr;)g(})676 2399 y(//)f(Page)g(fault)g(was)g(from)g(kernel)676
2491 y(inline)h(boolean_t)g(is_from_kernel\(void\))j(const)c({)755
2582 y(return)g(\(t_error&T_PF_USER\)==0;)676 2673 y(})676
2765 y(//)g(It)g(was)f(an)h(invalid)h(entry)676 2856
y(inline)g(boolean_t)g(is_absent\(void\))i(const)d({)755
2947 y(return)g(\(t_error&T_PF_PROT\)==0;)676 3039 y(})676
3130 y(//)g(It)g(was)f(a)h(write)g(attempt)676 3221 y(inline)h
(boolean_t)g(is_write\(void\))82 b(const)40 b({)755 3313
y(return)g(\(t_error&T_PF_WRITE\)&&!is_ab)q(sent)q(\(\);)676
3404 y(})676 3495 y(//)g(It)g(was)f(a)h(read)g(attempt)676
3587 y(inline)h(boolean_t)g(is_read\(void\))81 b(const)41
b({)755 3678 y(return)f(!is_write\(\)&&!is_absent\(\);)676
3769 y(})676 3861 y(//)g(It)g(was)f(an)h(exec)g(attempt)676
3952 y(inline)h(boolean_t)g(is_exec\(void\))81 b(const)41
b({)755 4043 y(return)f(!is_write\(\)&&!is_absent\(\);)676
4134 y(})598 4317 y(};)515 4583 y Fk(h)p Fj(O\013)27
b(user-kernel)j(messages)f(dep)l(endencies.)g Fk(i)p
Fq(\021)598 4674 y Fi(#include)41 b(<hw/mdep/mEvent.h>)82
b(//)40 b(for)g(mach.dep.)h(trap)f(error)h(codes.)1885
5255 y Fz(384)p eop
PStoPSsaved restore
%%Page: (386,387) 194
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
385 386 bop 515 523 a FA(Mac)m(hine)32 b(dep)s(enden)m(t)f(Ev)m(en)m(t)
i Fg(C)7 b Fx(++)31 b FA(source)g(\014les)515 668 y Fk(h)p
Fj(mdep)c(mEvent.h*)11 b Fk(i)q Fq(\021)598 759 y Fi(#include)41
b(<flux/machine/trap.h>)639 900 y Fz(W)-7 b(e)23 b(main)n(tain)f(mac)n
(hine)g(dep)r(enden)n(t)h(ev)n(en)n(t)f(table)g(stu\013)h(in)f
Fx(mdep/mEventTbl.h)16 b Fz(and)515 1000 y Fx(mdep/mEventTbl.C)o
Fz(.)515 1133 y Fk(h)p Fj(mdep)27 b(mEventTbl.h*)11 b
Fk(i)q Fq(\021)598 1224 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 1316 y
Fi(#ifndef)41 b(__OFF_MDEP_EV_TBL_H)598 1407 y(#define)g
(__OFF_MDEP_EV_TBL_H)i(1)598 1590 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(event)g(table)g(dep)l(endencies.)g
Fk(i)598 1772 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h(interrupt)h
(numb)l(ers.)e Fk(i)598 1955 y Fi(#ifdef)40 b(__KERNEL__)598
2046 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(interrupt)h(mask.)
d Fk(i)598 2137 y(h)p Fj(O\013)g(machine)h(dep)l(endent)h(interrupt)h
(table.)e Fk(i)598 2229 y(h)p Fj(O\013)f(machine)h(dep)l(endent)h(tr)l
(ap)g(table.)f Fk(i)598 2320 y Fi(#endif)40 b(//)g(__KERNEL__)598
2503 y(#ifdef)g(__KERNEL__)598 2594 y Fk(h)p Fi(off)p
750 2594 24 4 v 29 w(mdepIntTbl::is)p 1325 2594 V 31
w(masked)29 b Fj(implementation.)e Fk(i)598 2685 y Fi(#endif)40
b(//)g(__KERNEL__)598 2868 y(#endif)g(//)g(__OFF_MDEP_EV_TBL_H)515
3042 y Fk(h)p Fj(mdep)27 b(mEventTbl.C*)11 b Fk(i)q Fq(\021)598
3134 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3316 y Fi(#include)41
b(<hw/mdep/mEventTbl.h>)83 b(//)40 b(Exported)h(interface)598
3408 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(event)g(table)g
(implementation)f(dep)l(endencies.)h Fk(i)598 3499 y(h)p
Fj(O\013)e(machine)h(dep)l(endent)h(interrupt)h(inittab.)d
Fk(i)598 3590 y(h)p Fj(O\013)g(machine)h(dep)l(endent)h(event)g(table)g
(implementation)f(symb)l(ols.)f Fk(i)598 3773 y(h)p Fi(off)p
750 3773 V 29 w(mdepIntTbl::off)p 1364 3773 V 31 w(mdepIntTbl)j
Fj(implementation.)d Fk(i)598 3864 y(h)p Fi(off)p 750
3864 V 29 w(mdepTrapTbl::off)p 1403 3864 V 31 w(mdepTrapTbl)j
Fj(implementation.)e Fk(i)598 3956 y(h)p Fi(off)p 750
3956 V 29 w(mdepIntTbl::mask)j Fj(implementation.)c Fk(i)598
4047 y(h)p Fi(off)p 750 4047 V 29 w(mdepIntTbl::unmask)k
Fj(implementation.)d Fk(i)598 4138 y(h)p Fi(off)p 750
4138 V 29 w(mdepTrapTbl::build)p 1481 4138 V 32 w(trap)p
1669 4138 V 29 w(msg)g Fj(implementation.)g Fk(i)598
4321 y Fi(extern)40 b("C")g({)676 4412 y Fk(h)p Fi(off)p
828 4412 V 29 w(mdep)p 1013 4412 V 29 w(intr)p 1198 4412
V 29 w(handler)29 b Fj(implementation.)f Fk(i)676 4504
y(h)p Fi(off)p 828 4504 V 29 w(mdep)p 1013 4504 V 29
w(trap)p 1198 4504 V 29 w(handler)h Fj(implementation.)f
Fk(i)598 4595 y Fi(};)1885 5255 y Fz(385)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
386 387 bop 639 523 a Fz(Finally)-7 b(,)21 b(assem)n(bly)c(in)n
(terrupt)h(glue)g(co)r(de)g(is)g(k)n(ept)h(in)f Fx(mdep/intr.h)c
Fz(and)k Fx(mdep/intr.S)p Fz(.)515 656 y Fk(h)p Fj(mdep)27
b(intr.h*)11 b Fk(i)q Fq(\021)598 747 y Fi(#ifndef)41
b(__MDEP_INTR_H)598 839 y(#define)g(__MDEP_INTR_H)h(1)598
1021 y(#ifndef)f(ASSEMBLER)598 1112 y(extern)f("C")g({)598
1204 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(interrupt)h
(inittab.)d Fk(i)598 1295 y Fi(#endif)598 1386 y(#include)41
b(<flux/machine/gate_init.h>)598 1478 y(#ifndef)g(ASSEMBLER)598
1660 y Fk(h)p Fj(O\013)27 b(har)l(dwar)l(e)i(interrupt)h(c)l(ounters.)f
Fk(i)598 1752 y Fi(#endif)598 1843 y Fk(h)p Fj(O\013)e(har)l(dwar)l(e)i
Fi(IRQBASE)p Fj(.)g Fk(i)598 2026 y Fi(#ifndef)41 b(ASSEMBLER)598
2117 y(})e(//)h("C")g(linkage)598 2208 y(#endif)598 2391
y(#endif)g(//)g(__MDEP_INTR_H)639 2532 y Fz(The)31 b(in)n(terrupt)g(en)
n(try)f(p)r(oin)n(t)i(co)r(de)e(is)h(adapted)g(from)f(the)i(OSKit)e
Fx(libfdev)f Fz(utilit)n(y)515 2632 y(library)-7 b(.)35
b(The)28 b(la)n(y)n(out)e(of)i(this)g(\014le)g(is)f(as)g(follo)n(ws)515
2748 y Fk(h)p Fj(mdep)g(intr.S*)11 b Fk(i)q Fq(\021)598
2839 y Fk(h)p Fj(Oskit)28 b(c)l(opyright)h(notic)l(e.)f
Fk(i)598 2931 y Fi(#include)41 b(<hw/mdep/intr.h>)278
b(//)40 b(Exported)h(interface)598 3022 y Fk(h)p Fj(O\013)27
b(har)l(dwar)l(e)i(interrupts)h(implementation)e(dep)l(endencies.)h
Fk(i)912 3205 y Fi(.text)598 3296 y Fk(h)p Fj(O\013)e(har)l(dwar)l(e)i
(interrupts)h(de\014nitions.)e Fk(i)598 3387 y(h)p Fj(O\013)f(har)l
(dwar)l(e)i(interrupt)h(entry)f(p)l(oints.)f Fk(i)912
3570 y Fi(P2ALIGN\(TEXT_ALIGN\))598 3661 y(allints:)598
3753 y Fk(h)p Fj(O\013)f(har)l(dwar)l(e)i(interrupt)h(c)l(ommon)d(hand)
t(ling)h(r)l(outine.)g Fk(i)912 3935 y Fi(P2ALIGN\(TEXT_ALIGN\))1885
5255 y Fz(386)p eop
PStoPSsaved restore
%%Page: (388,389) 195
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
387 388 bop 639 523 a Fz(As)29 b(the)h(co)r(de)f(is)g(tak)n(en)g
(almost)f(literally)h(from)f(the)i(OSKit)f(their)g(cop)n(yrigh)n(t)e
(notice)515 623 y(is)g(included:)515 739 y Fk(h)p Fj(Oskit)h(c)l
(opyright)h(notic)l(e.)f Fk(i)p Fq(\021)598 830 y Fi(/*)637
922 y(*)39 b(Copyright)j(\(c\))e(1996)g(The)g(University)h(of)f(Utah)g
(and)637 1013 y(*)f(the)h(Computer)h(Systems)g(Laboratory)h(at)d(the)h
(University)i(of)d(Utah)i(\(CSL\).)637 1104 y(*)e(All)h(rights)h
(reserved.)637 1196 y(*)637 1287 y(*)e(Permission)j(to)e(use,)g(copy,)g
(modify)h(and)f(distribute)h(this)f(software)h(is)f(hereby)637
1378 y(*)f(granted)i(provided)g(that)f(\(1\))g(source)h(code)f(retains)
h(these)f(copyright,)i(permission,)637 1469 y(*)d(and)h(disclaimer)i
(notices,)f(and)f(\(2\))g(redistributions)i(including)g(binaries)637
1561 y(*)d(reproduce)j(the)e(notices)g(in)g(supporting)i
(documentation,)g(and)e(\(3\))g(all)g(advertising)637
1652 y(*)f(materials)j(mentioning)f(features)g(or)f(use)g(of)g(this)g
(software)h(display)g(the)e(following)637 1743 y(*)g(acknowledgement:)k
(``This)e(product)g(includes)g(software)g(developed)g(by)f(the)637
1835 y(*)f(Computer)i(Systems)g(Laboratory)h(at)d(the)h(University)i
(of)e(Utah.'')637 1926 y(*)637 2017 y(*)f(THE)h(UNIVERSITY)i(OF)e(UTAH)
g(AND)g(CSL)f(ALLOW)i(FREE)f(USE)g(OF)g(THIS)g(SOFTWARE)h(IN)e(ITS)h
("AS)637 2109 y(*)f(IS")h(CONDITION.)81 b(THE)40 b(UNIVERSITY)h(OF)f
(UTAH)g(AND)g(CSL)g(DISCLAIM)h(ANY)f(LIABILITY)h(OF)637
2200 y(*)e(ANY)h(KIND)g(FOR)g(ANY)g(DAMAGES)h(WHATSOEVER)h(RESULTING)f
(FROM)f(THE)g(USE)g(OF)g(THIS)g(SOFTWARE.)637 2291 y(*)637
2383 y(*)f(CSL)h(requests)h(users)g(of)e(this)i(software)g(to)e(return)
i(to)f(csl-dist@cs.utah.edu)j(any)637 2474 y(*)c(improvements)j(that)f
(they)f(make)g(and)g(grant)g(CSL)g(redistribution)i(rights.)637
2565 y(*/)1885 5255 y Fz(387)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
388 389 bop 515 523 a Fr(4.4)135 b(Timers)515 705 y Fz(T)-7
b(o)28 b(animate)g(the)g(system,)h(the)g(k)n(ernel)e(allo)r(cates)g
(the)i(clo)r(c)n(k)e(in)n(terrupt)i(for)e(himself.)40
b(As)515 805 y(the)31 b(real)e(clo)r(c)n(k)h(in)n(terrupt)g(is)g
(hidden)h(no)n(w,)g(a)f(timer)g(serv)n(er)f(is)h(included)h(in)g(the)g
(k)n(ernel)515 904 y(to)c(exp)r(ort)g(a)h(pseudo)f(clo)r(c)n(k)g(in)n
(terrupts.)36 b(There)27 b(is)g(a)h(single)f(timer)g(serv)n(er)f(p)r
(er)i(no)r(de.)515 1137 y Fn(4.4.1)112 b(Timer)36 b(serv)m(ers)515
1290 y Fz(The)20 b(timer)g(serv)n(er)f(includes)h(a)g(timer)g(allo)r
(cator)e(to)i(allo)r(cate)g(timers)g(and)g(deliv)n(ers)f(virtual)515
1389 y(clo)r(c)n(k)27 b(in)n(terrupts)g(as)g(timers)g(expire.)515
1522 y Fk(h)p Fj(O\013)g(timer)h(server.)h Fk(i)o Fq(\021)598
1614 y Fi(//)39 b(A)h(timer)g(server.)598 1705 y(//)598
1796 y(class)g(off_TmrSrv)i(:)d(public)i(off_HWCompResource)i({)598
1888 y(public:)676 1979 y(//)d(Returns)h(a)e(pointer)i(to)f(the)g
(timer)g(allocator.)676 2070 y(virtual)h(off_TmrAllocator)i
(*get_allocator\(void\);)676 2253 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2253 24 4
v 29 w(TmrSrv)p Fj(.)i Fk(i)598 2435 y Fi(protected:)676
2527 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 2527 V 29 w(TmrSrv)p Fj(.)i Fk(i)598 2618
y Fi(private:)676 2709 y Fk(h)p Fj(Other)g(private)f(metho)l(ds)h(of)f
Fi(off)p 1691 2709 V 29 w(TmrSrv)p Fj(.)g Fk(i)676 2801
y Fi(off_TmrAllocator)43 b(t_alloc;)676 2892 y Fk(h)p
Fj(Other)29 b(private)f(memb)l(ers)h(of)e Fi(off)p 1713
2892 V 29 w(TmrSrv)p Fj(.)h Fk(i)598 3075 y Fi(};)515
3249 y Fk(h)p Fi(off)p 667 3249 V 29 w(TmrSrv::get)p
1125 3249 V 30 w(allocator)i Fj(implementation.)d Fk(i)p
Fq(\021)598 3340 y Fi(inline)40 b(off_TmrAllocator)j
(*off_TmrSrv::get_allocator\(v)q(oid\))j({)676 3432 y
(assert\(valid\(\)\);)d(return)e(&t_alloc;)598 3523 y(})639
3756 y Fz(Being)g(a)h(sub)r(class)e(of)i Fx(CompResource)37
b Fz(w)n(e)k(m)n(ust)h(implemen)n(t)g Fx(make)p 2939
3756 27 4 v 30 w(available)p Fz(.)515 3855 y(This)c(metho)r(d)h(do)r
(es)g(not)f(ha)n(v)n(e)f(sense)h(for)g(timers)h(th)n(us)f(it)h(simply)g
(returns)f(an)g(error)515 3955 y(co)r(de)679 3925 y Fp(6)716
3955 y Fz(.)515 4088 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4088 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fq(\021)598 4179 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i
(one?)598 4270 y(inline)f(boolean_t)i(is_local\(const)g(off_tmr_id_t)g
(&tmr\);)598 4453 y Fk(h)p Fj(Implementation)28 b(of)f
Fi(off)p 1391 4453 V 29 w(CompResource::make)p 2122 4453
V 32 w(available)p Fj(.)i Fk(i)p 515 4929 1146 4 v 607
4983 a Fm(6)642 5006 y Fl(Al)23 b(alternate)i(implemen)n(tation)e
(could)h(allo)r(cate)g(an)g(idle)g(timer)e(and)i(set)g(it)g(up)g
(instead.)1885 5255 y Fz(388)p eop
PStoPSsaved restore
%%Page: (390,391) 196
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
389 390 bop 639 523 a Fz(Suc)n(h)28 b(routine)f(uses)g
Fx(is)p 1395 523 27 4 v 31 w(local)p Fz(.)515 656 y Fk(h)p
Fi(off)p 667 656 24 4 v 29 w(TmrSrv::is)p 1086 656 V
30 w(local)i Fj(implementation.)e Fk(i)p Fq(\021)598
747 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i(one?)598
839 y(inline)f(boolean_t)i(off_TmrSrv::is_local\(const)j(off_tmr_id_t)d
(&tmr\))598 930 y({)676 1021 y(assert\(valid\(\)\);)676
1112 y(return)f(\()e(tmr)h(<=)g(t_alloc.get_length\(\))k(&&)1029
1204 y(\(t_alloc+tmr\)->l_tmr.get_id\()q(\))h(==)40 b(tmr)g(\);)598
1386 y(})515 1561 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(dep)l
(endencies.)g Fk(i)p Fq(\021)598 1652 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 1743 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(natural_t)h
(et)f(al.)598 1835 y(#include)h(<klib/HWCompResource.h>)j(//)c(for)g
(off_HWCompResource)598 1926 y(#include)h(<klib/err.h>)473
b(//)40 b(for)g(err_t)598 2017 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 2109 y(#include)h(<klib/Magic.h>)395
b(//)40 b(for)g(magic)g(numbers)598 2200 y(#include)h(<hw/Tmr.h>)198
b(//)40 b(for)g(off_Tmr)598 2291 y(#include)h(<hw/TmrAllocator.h>)122
b(//)39 b(for)h(off_TmrAllocator)639 2433 y Fz(This)28
b(implemen)n(tation)g(uses)f Fx(is)p 1691 2433 27 4 v
30 w(local)p Fz(.)639 2532 y(Eac)n(h)35 b(timer)i(serv)n(er)d(is)i
(created)g(b)n(y)g(its)g(pro)r(cessor.)61 b(Initially)-7
b(,)38 b(it)f(is)f(statically)g(al-)515 2632 y(lo)r(cated)h(with)i
(default)f(parameters)f(for)g(its)h(mem)n(b)r(ers.)68
b(Besides,)40 b(the)e(desired)g Fx(hz)f Fz(is)515 2731
y(set.)515 2864 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2864 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 2956 y Fi(//)39 b(Creates)i(a)f(Timer)g(server.)598
3047 y(off_TmrSrv\(void\);)515 3221 y Fk(h)p Fi(off)p
667 3221 V 29 w(TmrSrv::off)p 1125 3221 V 30 w(TmrSrv)29
b Fj(implementation.)f Fk(i)o Fq(\021)598 3313 y Fi(//)39
b(Creates)i(a)f(Timer)g(server.)598 3404 y
(off_TmrSrv::off_TmrSrv\(void\))45 b(:)676 3495 y
(off_HWCompResource\(off_Prote)q(ction)q(\(\),O)q(FF_P)q(RTL_N)q(ULL,)
1422 3587 y(OFF_ID_NULL,OFF_MAGIC_TMRSRV\),)676 3678
y Fk(h)p Fj(Initialize)27 b Fi(t)p 1072 3678 V 28 w(alloc)p
Fj(.)h Fk(i)p Fi(,)676 3769 y(t_hz\(OFF_TMR_HZ\),)676
3861 y Fk(h)p Fj(Initialize)f(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 3861 V 29 w(TmrSrv)p Fj(.)g Fk(i)598
3952 y Fi({;})639 4184 y Fz(The)g(hertz)f(the)h(timer)g(is)f(running)h
(at)f(is)h(a)f(system)g(limit.)515 4301 y Fk(h)p Fj(O\013)g(limits.)f
Fk(i)p Fq(\021)598 4392 y Fi(const)40 b(int)g(OFF_TMR_HZ)i(=)d(1000;)h
(//)g(Hertz)g(each)h(timer)f(is)g(running)g(at.)515 4550
y Fk(h)p Fj(O\013)27 b(timer)h(server)h(implementation)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4641 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(for)g(OFF_TMR_HZ)515
4815 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4815 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fq(\021)598
4907 y Fi(natural_t)41 b(t_hz;)668 b(//)40 b(HZs)g(for)g(this)g(timer)g
(server.)1885 5255 y Fz(389)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
390 391 bop 639 523 a Fz(When)28 b(the)g(no)r(de)g(is)g(started,)f(the)
h(timer)f(serv)n(er)f(is)h(started)h(to)r(o.)515 656
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 656 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
747 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)g(timer)g
(server.)598 839 y(err_t)g(start\(const)i(off_mdepTmrSrv)g(&mdep,)f
(const)f(off_id_t)h(&id\);)515 1013 y Fk(h)p Fi(off)p
667 1013 V 29 w(TmrSrv::start)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 1104 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)
f(this)g(timer)g(server.)598 1196 y(err_t)g(off_TmrSrv::start\()j
(const)e(off_mdepTmrSrv)h(&mdep,)f(const)f(off_id_t)h(&id\))598
1287 y({)676 1378 y(assert\(valid\(\)\);)676 1469 y(set_id\(id\);)676
1652 y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)g(of)e
Fi(off)p 1629 1652 V 29 w(TmrSrv)i Fj(ac)l(c)l(or)l(ding)g(to)f
Fi(mdep)p Fj(.)g Fk(i)676 1743 y(h)p Fj(Start)h(the)g(timer)e(har)l
(dwar)l(e)j(at)e Fi(t)p 1697 1743 V 28 w(hz)p Fj(.)g
Fk(i)676 1926 y Fi(kcout<<)41 b("Tmr)119 b(#"<<id<<)41
b(fmt\(")f(\(\045d)g(timers\))h(",get_ntmrs\(\)\);)676
2017 y(kcout<<)g("started."<<)h(nl;)676 2200 y(return)f(EOK;)598
2291 y(})639 2524 y Fz(Here,)28 b Fx(get)p 996 2524 27
4 v 30 w(ntmrs)d Fz(returns)i(the)h(n)n(um)n(b)r(er)g(of)f(existing)g
(timers.)515 2640 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2640 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 2731 y Fi(natural_t)41 b(get_ntmrs\(void\))i(const)d
({)f(return)i(off_mdepTmrSrv::get_ntmrs\(\);)46 b(})515
2889 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(implementation)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2980 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 3072 y(#include)h
(<klib/str.h>)434 b(//)40 b(for)g(kcout.)515 3246 y Fk(h)p
Fj(O\013)27 b(timer)h(server)h(dep)l(endencies.)g Fk(i)p
Fz(+)p Fq(\021)598 3337 y Fi(#include)41 b(<hw/mdep/mTmrSrv.h>)i(//)d
(for)g(off_mdepTmrSrv)639 3479 y Fz(A)22 b(new)g(mem)n(b)r(er,)h
Fx(m)p 1274 3479 27 4 v 31 w(mdep)d Fz(will)i(store)e(the)j(b)r(o)r(ot)
e(time)i(information,)f(whic)n(h)f(is)h(needed)515 3578
y(b)r(ecause)27 b(it)h(pro)n(vides)e(common)h(information)g(useful)h
(to)g(timer)f(serv)n(er)f(users.)515 3694 y Fk(h)p Fj(Other)i(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 3694 24 4 v 29 w(TmrSrv)p
Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 3786 y Fi(off_mdepTmrSrv)121
b(t_mdep;)354 b(//)40 b(Mach.)g(dep.)g(information)515
3944 y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)f(of)f
Fi(off)p 1467 3944 V 29 w(TmrSrv)i Fj(ac)l(c)l(or)l(ding)g(to)f
Fi(mdep)p Fj(.)g Fk(i)p Fq(\021)598 4035 y Fi(t_mdep=mdep;)639
4176 y Fz(W)-7 b(e)28 b(m)n(ust)g(de\014ne)g(the)g(new)f(magic)g(n)n
(um)n(b)r(er)h(used)f(b)r(efore.)515 4292 y Fk(h)p Fj(O\013)g(magic)g
(numb)l(ers.)i Fk(i)p Fq(\021)598 4384 y Fi(OFF_MAGIC_TMRSRV,)43
b(//)d(TmrSrv)g(magic)g(nb.)639 4508 y Fz(W)-7 b(e)28
b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)g(implemen)n(tation)f
(of)h Fx(Magic::nameof)p Fz(.)515 4624 y Fk(h)p Fi(off)p
667 4624 V 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e Fi(m)p
1559 4624 V 29 w(number)p Fj(s.)h Fk(i)p Fq(\021)598
4716 y Fi(case)40 b(OFF_MAGIC_TMRSRV:)676 4807 y(return)h
("off_TmrSrv";)1885 5255 y Fz(390)p eop
PStoPSsaved restore
%%Page: (392,393) 197
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
391 392 bop 639 523 a Fz(Timer)19 b(serv)n(er)f(users)h(can)g(c)n(hec)n
(k)f(their)i(references)e(to)i(pro)r(cessors)d(using)i(this)g(metho)r
(d.)515 639 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 639 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 731 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f
(TmrSrv?)598 822 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g
(get_magic\(\))i(==)e(OFF_MAGIC_TMRSRV;)j(})639 946 y
Fz(The)23 b(in)n(teresting)f(part)g(of)h Fx(start)e Fz(is)h(setting)h
(the)g(hardw)n(are)e(timer.)35 b(W)-7 b(e)23 b(simply)g(start)515
1046 y(the)34 b(mac)n(hine)f(dep)r(enden)n(t)h(serv)n(er)e(and)h(then)h
(allo)r(cate)f(the)g(clo)r(c)n(k)g(in)n(terrupt)g(\(whic)n(h)h(is)515
1146 y(initially)27 b(disabled\).)515 1279 y Fk(h)p Fj(Start)i(the)f
(timer)g(har)l(dwar)l(e)h(at)f Fi(t)p 1535 1279 V 29
w(hz)p Fj(.)f Fk(i)p Fq(\021)598 1370 y Fi(mdep.start\(t_hz\);)598
1461 y(t_clkirq=new\(nd.get_proc\(0\).ge)q(t_irq)q(s\(\),)1108
1553 y(nd.get_proc\(0\).get_irqs\(\)->get)q(_clk\()q(\)\))85
b(off_Irq\(get_protection\(\),)2951 1644 y(get_domain\(\),NULL\);)639
1785 y Fz(Note)40 b(ho)n(w)g(w)n(e)f(set)i(a)e Fy(nul)t(l)49
b Fz(handler.)73 b(The)41 b(ev)n(en)n(t)e(table)h(kno)n(ws)f(that)h
(the)h(clo)r(c)n(k)515 1885 y(in)n(terrupt)22 b(is)g(part)g(of)g(the)h
(system)f(inner)h(cycle)f(and)g(deliv)n(ers)f(it)i(directly)f(to)h(the)
f(in)n(v)n(olv)n(ed)515 1984 y(timer)27 b(serv)n(er.)515
2117 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2117 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 2208 y Fi(off_Irq)41 b(*t_clkirq;)865 b(//)40
b(HW)f(clock)i(interrupt.)515 2383 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 2383 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fq(\021)598 2474
y Fi(t_clkirq\(NULL\),)515 2648 y Fk(h)p Fj(O\013)f(timer)h(server)h
(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 2740 y
Fi(#include)41 b(<hw/Event.h>)434 b(//)40 b(for)g(off_Irq)1885
5255 y Fz(391)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
392 393 bop 515 523 a Fn(4.4.2)112 b(Timers)515 676 y
Fz(A)32 b(timer)f(is)h(simply)f(a)g(hardw)n(are)f(resource)g(unit)i
(whic)n(h)f(has)g(an)g(asso)r(ciated)g(p)r(erio)r(d)g(of)515
776 y(time,)38 b(migh)n(t)d(rep)r(eat)g(\(i.e.)61 b(reinstall)34
b(itself)i(when)g(expired\),)h(and)e(has)g(an)g(asso)r(ciated)515
876 y(virtual)27 b(clo)r(c)n(k)g(in)n(terrupt)g(\(whic)n(h)h(is)f
(raised)g(when)h(the)g(timer)f(expires\).)515 999 y Fk(h)p
Fj(O\013)g(timer.)g Fk(i)p Fq(\021)598 1090 y Fi(//)39
b(A)h(timer.)598 1181 y(//)598 1273 y(class)g(off_Tmr)h(:)e(public)i
(off_HWResUnit)h({)598 1364 y(public:)676 1455 y(//)e(Is)g(this)g
(timer)g(periodic?)676 1547 y(inline)h(boolean_t)g(is_periodic\(void\))
i(const;)676 1729 y(//)d(Which)g(interrupt)i(line)e(is)f(used)h(by)g
(this)g(timer?)676 1821 y(inline)h(const)f(off_ev_id_t)i
(&get_irqline\(void\))h(const;)676 2003 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2003 24 4
v 29 w(Tmr)p Fj(.)h Fk(i)598 2095 y Fi(protected:)676
2186 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 2186 V 29 w(Tmr)p Fj(.)g Fk(i)676 2277
y(h)p Fj(Other)i(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 2277 V 29 w(Tmr)p Fj(.)h Fk(i)676 2369
y Fi(inline)41 b(natural_t)g(get_ticks\(void\);)598 2460
y(private:)676 2551 y(natural_t)120 b(t_ticks;)394 b(//)40
b(#)f(of)h(ticks)g(left)g(for)g(this)g(timer.)676 2643
y(off_ev_id_t)i(t_irq;)472 b(//)40 b(Interrupt)h(line.)676
2734 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2734 V 29 w(Tmr)p Fj(.)h Fk(i)598 2825
y Fi(};)515 3072 y Fk(h)p Fj(O\013)f(timer)h(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3163 y Fi(#include)41 b(<klib/HWResUnit.h>)200
b(//)40 b(for)g(off_HWResUnit)515 3318 y Fk(h)p Fi(off)p
667 3318 V 29 w(Tmr::get)p 1008 3318 V 30 w(ticks)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 3409 y Fi(inline)40
b(natural_t)i(off_Tmr::get_ticks\(void\))598 3501 y({)676
3592 y(assert\(valid\(\)\);)676 3683 y(return)f(t_ticks;)598
3775 y(})515 3930 y Fk(h)p Fi(off)p 667 3930 V 29 w(Tmr::get)p
1008 3930 V 30 w(irqline)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 4021 y Fi(//)39 b(Which)i(interrupt)g(line)f(is)g(used)g
(by)g(this)g(timer?)598 4112 y(inline)g(const)h(off_ev_id_t)g
(&off_Tmr::get_irqline\(void\))46 b(const)79 b({)40 b(return)g(t_irq;)h
(})639 4335 y Fz(T)-7 b(o)27 b(kno)n(w)g(if)h(a)g(timer)f(is)h(p)r
(erio)r(dic)f(w)n(e)g(use)h(a)f(resource)f(\015ag.)515
4458 y Fk(h)p Fi(off)p 667 4458 V 29 w(Tmr::is)p 969
4458 V 29 w(periodic)k Fj(implementation.)d Fk(i)p Fq(\021)598
4550 y Fi(//)39 b(Is)h(this)g(timer)h(periodic?)598 4641
y(inline)f(boolean_t)i(off_Tmr::is_periodic\(void\))j(const)598
4732 y({)676 4824 y(assert\(valid\(\)\);)676 4915 y(return)c(r_flags)g
(&)e(OFF_TF_PRD;)598 5006 y(})1885 5255 y Fz(392)p eop
PStoPSsaved restore
%%Page: (394,395) 198
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
393 394 bop 515 523 a Fk(h)p Fj(Set)28 b(timer)g Fi(periodic)h
Fj(\015ag.)f Fk(i)o Fq(\021)598 614 y Fi(if)39 b(\(periodic\))676
706 y(r_flags)i(|=)f(OFF_TF_PRD;)598 797 y(else)676 888
y(r_flags)h(&=)f(~OFF_TF_PRD;)639 1029 y Fz(Where)28
b(w)n(e)f(ha)n(v)n(e)f(to)i(de\014ne)g(the)g(\015ag)e(used.)515
1146 y Fk(h)p Fj(O\013)h(timer)h(\015ags.)g Fk(i)o Fq(\021)598
1237 y Fi(//)39 b(flag)i(bits)f(for)g(off_Tmrs.)598 1328
y(//)f(They)i(are)e(compatible)j(with)e(resource)h(flag)f(bits.)598
1420 y(const)g(unsigned8_t)i(OFF_TF_PRD)159 b(=)39 b(0x10;)i(//)f(Is)f
(it)h(a)f(periodic)i(timer?)639 1544 y Fz(A)25 b(timer)g(is)f(created)g
(with)h(a)f(presp)r(eci\014ed)g(protection)g(and)g(domain)g(iden)n
(ti\014er.)36 b(The)515 1644 y(in)n(terrupt)27 b(line,)h(n)n(um)n(b)r
(er)f(of)h(tic)n(ks,)f(and)g(the)h(p)r(erio)r(dic)g(\015ag)f(m)n(ust)g
(b)r(e)h(sp)r(eci\014ed)g(to)r(o.)515 1777 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1777 24 4 v 29 w(Tmr)p
Fj(.)g Fk(i)p Fq(\021)598 1868 y Fi(//)39 b(Creates)i(a)f(timer.)598
1959 y(off_Tmr\(const)i(off_Protection)g(&p,)912 2051
y(const)e(off_prtl_id_t)i(&domain,)912 2142 y(const)e(off_tmr_id_t)i
(&id,)912 2233 y(off_TmrSrv)120 b(*srv,)912 2325 y(natural_t)159
b(nticks,)912 2416 y(const)40 b(off_ev_id_t)i(&irqline,)912
2507 y(boolean_t)f(periodic)g(\);)639 2648 y Fz(Users)35
b(use)g(a)g(constructor)f(receiving)g(only)h(the)h(protection,)h
(domain,)g(n)n(um)n(b)r(er)e(of)515 2748 y(tic)n(ks,)27
b(and)g(the)h(p)r(erio)r(dic)g(\015ag.)515 2881 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2881
V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 2972 y
Fi(//)39 b(Creates)i(a)f(timer.)598 3064 y(off_Tmr\(const)i
(off_Protection)g(&p,)912 3155 y(const)e(off_prtl_id_t)i(&domain,)912
3246 y(natural_t)159 b(nticks,)912 3337 y(boolean_t)41
b(periodic)g(\);)515 3512 y Fk(h)p Fi(off)p 667 3512
V 29 w(Tmr::off)p 1008 3512 V 30 w(Tmr)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 3603 y Fi(//)39 b(Creates)i(a)f(timer.)598
3694 y(off_Tmr::off_Tmr\(const)k(off_Protection)e(&p,)1265
3786 y(const)e(off_prtl_id_t)i(&domain,)1265 3877 y(natural_t)159
b(nticks,)1265 3968 y(boolean_t)41 b(periodic)g(\))e(:)676
4060 y(off_HWResUnit\(p,domain\),)676 4151 y(t_ticks\(nticks\),)676
4242 y(t_irq\(OFF_EU_ID_NULL\))598 4334 y({)676 4425
y Fk(h)p Fj(Set)28 b(timer)g Fi(periodic)h Fj(\015ag.)f
Fk(i)676 4516 y(h)p Fj(Initialize)f(other)i(private)f(memb)l(ers)h(of)e
Fi(off)p 2015 4516 V 29 w(Tmr)p Fj(.)h Fk(i)598 4608
y Fi(})1885 5255 y Fz(393)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
394 395 bop 639 523 a Fz(As)21 b(y)n(ou)f(ma)n(y)g(susp)r(ect,)i(eac)n
(h)e(timer)g(deliv)n(ers)g(a)g(\014xed)h(virtual)f(clo)r(c)n(k)g(in)n
(terrupt.)34 b(Users)515 623 y(ma)n(y)27 b(not)g(c)n(ho)r(ose)g(whic)n
(h)g(clo)r(c)n(k)g(in)n(terrupt)g(is)h(deliv)n(ered)f(b)n(y)g(eac)n(h)g
(timer.)639 722 y(Remaining)33 b(timer)h(data)f(is)g(pre-initialized.)
54 b(A)33 b(zero-argumen)n(t)e(\(trap)j(and)f(in)n(ter-)515
822 y(rupt\))28 b(constructor)e(p)r(ermits)i(declaration)e(of)h
(uninitialized)h(ev)n(en)n(ts.)515 955 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 955 24 4 v 29 w(Tmr)p
Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 1046 y Fi(//)39 b(Allows)i
(uninitialized)h(timers.)598 1137 y(off_Tmr\(void\))g(:)676
1229 y(off_HWResUnit\(off_Protection)q(\(\),)j(OFF_PRTL_NULL,)e
(OFF_EU_ID_NULL,)1225 1320 y(OFF_MAGIC_TMR,)g(NULL\))598
1411 y({;})639 1553 y Fz(When)24 b(the)g(timer)f(serv)n(er)e(is)i
(created,)g(another)g(constructor)e(is)i(used)g(to)g(preinitialize)515
1652 y(\014elds)k(whic)n(h)h(will)g(remain)f(\014xed.)515
1768 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1768 V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
1860 y Fi(//)39 b(Preinitializes)k(a)c(timer.)598 1951
y(off_Tmr\(const)j(off_tmr_id_t)g(&id,)e(const)g(off_ev_id_t)i(&irq,)e
(off_TmrSrv)i(*c\);)515 2109 y Fk(h)p Fi(off)p 667 2109
V 29 w(Tmr::off)p 1008 2109 V 30 w(Tmr)28 b Fj(implementation.)f
Fk(i)p Fz(+)p Fq(\021)598 2200 y Fi(//)39 b(Preinitializes)k(a)c
(timer.)598 2291 y(off_Tmr::off_Tmr\(const)44 b(off_tmr_id_t)e(&id,)
1265 2383 y(const)e(off_ev_id_t)i(&irq,)e(off_TmrSrv)i(*c\))d(:)676
2474 y(off_HWResUnit\(id,OFF_MAGIC_T)q(MR,\(o)q(ff_H)q(WCom)q(pReso)q
(urce)q(*\)c\),)676 2565 y(t_ticks\(0\),)676 2657 y(t_irq\(irq\))598
2748 y({;})515 3014 y Fk(h)p Fj(O\013)27 b(timer)h(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 3105 y Fi(#include)41 b(<sys/types.h>)598
3196 y(#include)g(<klib/ids.h>)598 3288 y(#include)g(<klib/err.h>)473
b(//)40 b(for)g(err_t)598 3379 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 3470 y(#include)h(<klib/Magic.h>)395
b(//)40 b(for)g(magic)g(numbers)598 3562 y(class)g(off_TmrSrv;)639
3703 y Fz(W)-7 b(e)27 b(ha)n(v)n(e)e(to)h(de\014ne)g(the)g(new)h(magic)
e(n)n(um)n(b)r(er)h(as)f(w)n(ell)h(as)f(add)h(another)f(case)h(to)g
(the)515 3802 y(implemen)n(tation)h(of)h Fx(Magic::nameof)p
Fz(.)515 3935 y Fk(h)p Fj(O\013)f(magic)g(numb)l(ers.)i
Fk(i)p Fz(+)o Fq(\021)598 4027 y Fi(OFF_MAGIC_TMR,)42
b(//)e(Tmr)g(magic)g(nb.)515 4201 y Fk(h)p Fi(off)p 667
4201 V 29 w(Magic::nameof)30 b Fj(c)l(ase)f(for)e Fi(m)p
1559 4201 V 29 w(number)p Fj(s.)h Fk(i)p Fz(+)p Fq(\021)598
4292 y Fi(case)40 b(OFF_MAGIC_TMR:)676 4384 y(return)h("off_Tmr";)639
4525 y Fz(Timer)28 b(users)e(can)h(c)n(hec)n(k)g(their)h(references)e
(to)i(pro)r(cessors)d(using)i(this)h(metho)r(d.)515 4641
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4641 V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
4732 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(Tmr?)598
4824 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_TMR;)i(})1885 5255 y Fz(394)p eop
PStoPSsaved restore
%%Page: (396,397) 199
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
395 396 bop 639 523 a Fz(The)28 b(new)g(con)n(tainer)e(can)h(also)g
(implemen)n(t)h(its)g Fx(get)p 2323 523 27 4 v 30 w(umagic)d
Fz(metho)r(d.)515 652 y Fk(h)p Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 652 24 4 v 29 w(TmrSrv)p Fj(.)h
Fk(i)p Fq(\021)598 744 y Fi(virtual)41 b(off_magic_t)g
(get_umagic\(void\))i({)d(return)g(OFF_MAGIC_TMR;)j(})515
1104 y Fn(4.4.3)112 b(Timer)36 b(allo)s(cation)515 1257
y Fz(A)i(timer)g(allo)r(cator)e(is)i(a)g Fx(FixedAllocator)32
b Fz(instan)n(tiated)38 b(at)g(timer)g(serv)n(er)e(creation)515
1357 y(time)28 b(to)f(allo)r(cate)g Fx(Tmr)p Fz(s.)515
1486 y Fk(h)p Fj(O\013)g(timer)h(al)t(lo)l(c)l(ator.)g
Fk(i)p Fq(\021)598 1578 y Fi(//)39 b(A)h(timer)g(allocator.)598
1669 y(//)598 1760 y(class)g(off_TmrAllocator)j(:)c(public)i
(off_TFixedAllocator<off_LTmr>)46 b({)598 1852 y(public:)676
2034 y(//)40 b(Creates)h(a)e(timer)i(allocator.)676 2126
y(off_TmrAllocator\(off_Exhaust)q(ed)k(*r\);)676 2308
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 2308 V 29 w(TmrAllocator)p Fj(.)j Fk(i)598 2491
y Fi(private:)676 2582 y Fk(h)p Fj(Other)f(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2582 V 29 w(TmrAllocator)p Fj(.)j Fk(i)598
2674 y Fi(};)639 2994 y Fz(The)22 b(timer)f(serv)n(er)e(only)i(needs)g
(to)g(supply)g(the)h(appropriate)e(rev)n(o)r(cation)f(trigger)h(\(i.e.)
515 3094 y(himself)6 b(\))29 b(to)e(create)g(the)h(timer)f(allo)r
(cator.)515 3208 y Fk(h)p Fj(Initialize)f Fi(t)p 910
3208 V 29 w(alloc)p Fj(.)i Fk(i)p Fq(\021)598 3300 y
Fi(t_alloc\(\(off_Exhausted*\)this\))515 3452 y Fk(h)p
Fj(O\013)f(timer)h(al)t(lo)l(c)l(ator)g(dep)l(endencies.)i
Fk(i)o Fq(\021)598 3544 y Fi(#include)41 b(<klib/FixedAllocator.h>)j
(//)c(for)g(off_TFixedAllocator)j(et)d(al.)639 3681 y
Fz(T)-7 b(o)30 b(supp)r(ort)h(the)g(link)n(ed)f(lists)h(used)f(in)h
(the)g(timer)f(allo)r(cator,)g(no)r(des)g(allo)r(cated)g(are)515
3781 y(actually)d(of)g(t)n(yp)r(e)h Fx(LTmr)p Fz(.)515
3910 y Fk(h)p Fj(O\013)f(linkable)g(timer.)h Fk(i)o Fq(\021)598
4002 y Fi(//)39 b(A)h(linkable)h(timer.)598 4093 y(//)598
4184 y(class)f(off_LTmr)h(:)f(public)g(DLinkedNode)i({)598
4276 y(public:)676 4367 y(off_Tmr)f(l_tmr;)676 4550 y(//)f(To)g(allow)g
(uninitialized)i(timers.)676 4641 y(off_LTmr\(void\))h(:)c(l_tmr\(\))i
({;})676 4824 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4824 V 29 w(LTmr)p Fj(.)h Fk(i)598 4915
y Fi(};)1885 5255 y Fz(395)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
396 397 bop 515 523 a Fk(h)p Fj(O\013)27 b(timer)h(al)t(lo)l(c)l(ator)g
(dep)l(endencies.)i Fk(i)o Fz(+)p Fq(\021)598 614 y Fi(#include)41
b(<hw/Tmr.h>)316 b(//)40 b(for)f(off_Tmr)639 756 y Fz(The)25
b(\014xed)g(allo)r(cator)e(uses)i(a)f(\014xed)h(arra)n(y)e(of)i
Fx(LTmr)p Fz(s.)34 b(There)24 b(are)g(as)h(man)n(y)f(timers)h(as)515
855 y(virtual)i(clo)r(c)n(k)g(in)n(terrupts.)515 971
y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 971 24 4 v 29 w(TmrAllocator)p Fj(.)h Fk(i)p Fq(\021)598
1063 y Fi(off_LTmr)41 b(t_tmr[OFF_MDEP_NVINT_MAX];)k(//)40
b(Timer)g(slots.)515 1220 y Fk(h)p Fj(O\013)27 b(timer)h(al)t(lo)l(c)l
(ator)g(dep)l(endencies.)i Fk(i)o Fz(+)p Fq(\021)598
1312 y Fi(#include)41 b(<klib/limits.h>)239 b(//)39 b(for)h
(OFF_MDEP_NVINT_MAX)639 1453 y Fz(An)28 b(indexer)f(is)h(also)e
(needed.)515 1569 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1569 V 29 w(TmrAllocator)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 1660 y Fi(static)40 b(off_Indexer<off_LTmr>)k
(t_idx;)d(//)f(Linked)g(timer)h(indexer.)515 1818 y Fk(h)p
Fj(O\013)27 b(timer)h(al)t(lo)l(c)l(ator)g(static)h(memb)l(ers.)f
Fk(i)p Fq(\021)598 1910 y Fi(off_Indexer<off_LTmr>)44
b(off_TmrAllocator::t_idx;)g(//)c(Linked)h(timer)f(indexer.)515
2084 y Fk(h)p Fj(O\013)27 b(timer)h(al)t(lo)l(c)l(ator)g(dep)l
(endencies.)i Fk(i)o Fz(+)p Fq(\021)598 2175 y Fi(#include)41
b(<klib/Indexer.h>)278 b(//)40 b(for)g(off_Indexer)639
2316 y Fz(Timer)28 b(allo)r(cator)d(creation)i(is)g(prett)n(y)h
(simple.)515 2449 y Fk(h)p Fi(off)p 667 2449 V 29 w(TmrAllocator::off)p
1359 2449 V 32 w(TmrAllocator)i Fj(implementation.)d
Fk(i)p Fq(\021)598 2540 y Fi(//)39 b(Creates)i(a)f(timer)g(allocator.)
598 2632 y(off_TmrAllocator::off_TmrAlloc)q(ator\()q(off_)q(Exha)q
(usted)46 b(*r\))40 b(:)676 2723 y(off_TFixedAllocator<off_LTmr)q
(>\(r,\()q(cons)q(t)45 b(off_Indexable*\)&t_idx,&t_tmr[)q(0],)1225
2814 y(OFF_MDEP_NVINT_MAX\))676 2906 y({;})639 3138 y
Fz(Using)28 b(the)g(allo)r(cator,)e(the)i(timer)f(serv)n(er)f(can)h
(allo)r(cate)g(and)g(deallo)r(cate)g(timers.)515 3271
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3271 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3362 y Fi(//)39 b(Allocates)j(a)d(timer.)598 3454 y(off_Tmr)i
(*alloc\(boolean_t)h(use_revocation=FALSE\);)598 3545
y(off_Tmr)f(*alloc\(const)h(off_tmr_id_t)f(&at,)g(boolean_t)g
(use_revocation=FALSE\);)598 3728 y(//)e(Deallocates)j(a)e(timer..)598
3819 y(void)g(free\(const)h(off_Tmr)g(*rq\);)1885 5255
y Fz(396)p eop
PStoPSsaved restore
%%Page: (398,399) 200
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
397 398 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(TmrSrv::alloc)30 b Fj(and)e Fi(free)g Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Allocates)j(a)d(timer)598
706 y(off_Tmr)i(*off_TmrSrv::alloc\(boolean_t)k(use_revocation\))598
797 y({)676 888 y(off_LTmr)c(*lt;)676 980 y(assert\(valid\(\)\);)676
1071 y(w_lock\(\);)676 1162 y(lt=t_alloc.allocate\(use_revo)q(catio)q
(n\);)676 1254 y(w_unlock\(\);)676 1345 y
(assert\(lt->l_tmr.valid\(\)\);)676 1436 y(return)g
(\(lt\)?\(&lt->l_tmr\):\(off_Tmr*\)NU)q(LL;)598 1528
y(})598 1710 y(off_Tmr)g(*off_TmrSrv::alloc\(const)j(off_tmr_id_t)e
(&at,)1657 1802 y(boolean_t)f(use_revocation\))598 1893
y({)676 1984 y(off_LTmr)g(*lt;)676 2076 y(assert\(valid\(\)\);)676
2167 y(w_lock\(\);)676 2258 y(lt=t_alloc.allocate\(at,use_r)q(evoca)q
(tion)q(\);)676 2350 y(w_unlock\(\);)676 2441 y
(assert\(lt->l_tmr.valid\(\)\);)676 2532 y(return)g
(\(lt\)?\(&lt->l_tmr\):\(off_Tmr*\)NU)q(LL;)598 2715
y(})598 2897 y(//)e(Deallocates)j(a)e(timer)598 2989
y(void)g(off_TmrSrv::free\(const)k(off_Tmr)d(*t\))598
3080 y({)676 3171 y(off_LTmr)g(*lt=\(off_LTmr*\)\(\(\(char*\)t\)-\()q
(int\))q(&off_)q(LTmr)q(::l_t)q(mr\);)676 3263 y(assert\(valid\(\))i
(&&)c(t)h(&&)f(t->valid\(\)\);)676 3354 y(w_lock\(\);)676
3445 y(t_alloc.deallocate\(lt\);)676 3537 y Fk(h)p Fj(De)l(activate)30
b(HW)d(clo)l(ck)h(interrupt)h(if)e(ne)l(c)l(essary.)i
Fk(i)676 3628 y Fi(w_unlock\(\);)598 3719 y(})1885 5255
y Fz(397)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
398 399 bop 639 523 a Fz(Timers)22 b(ha)n(v)n(e)f(their)h(o)n(wn)g
Fx(new)f Fz(and)h Fx(delete)e Fz(op)r(erators.)33 b(The)22
b(op)r(erator)f Fx(new)g Fz(receiv)n(es)515 623 y(the)f(where)f(the)h
(slot)g(should)f(b)r(e)i(allo)r(cated.)33 b(Op)r(erator)18
b Fx(new)h Fz(uses)g(the)h(timer)g(serv)n(er)e Fx(alloc)515
722 y Fz(metho)r(d)28 b(to)f(\014nd)h(an)g(a)n(v)-5 b(ailable)26
b(timer.)515 855 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 855 24 4 v 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 946 y Fi(//)39 b(Allocate)i(a)f(timer.)598
1038 y(void)g(*operator)h(new\(size_t)h(s,)d(boolean_t)j
(use_revocation=FALSE\);)598 1129 y(void)e(*operator)h(new\(size_t)h
(s,)d(const)i(off_tmr_id_t)h(&at,)1343 1220 y(boolean_t)f
(use_revocation=FALSE\);)598 1403 y(//)e(Deallocates)j(this)e(timer.)
598 1494 y(void)g(operator)h(delete\(void)h(*p\);)515
1760 y Fk(h)p Fi(off)p 667 1760 V 29 w(Tmr::operator)g(new)28
b Fj(implementation.)f Fk(i)p Fq(\021)598 1851 y Fi(//)39
b(Allocate)i(a)f(timer.)598 1943 y(void)g(*off_Tmr::operator)j
(new\(size_t)f(s,)d(boolean_t)j(use_revocation\))598
2034 y({)676 2125 y(off_Tmr)f(*t=nd.get_proc\(0\).get_tmr\(\).a)q(lloc)
q(\(use_)q(revo)q(catio)q(n\);)676 2217 y(\(void\)s;)676
2308 y(assert\(s)g(&&)f(nd.get_proc\(0\).get_tmr\(\).vali)q(d\(\)\);)
676 2399 y(assert\(!t)h(||)f(t->valid\(\)\);)676 2491
y(return)h(\(void*\)t;)598 2582 y(})598 2765 y(void)f
(*off_Tmr::operator)j(new\(size_t)f(s,)d(const)i(off_tmr_id_t)h(&at,)
1696 2856 y(boolean_t)f(use_revocation\))598 2947 y({)676
3039 y(off_Tmr)g(*t=nd.get_proc\(0\).get_tmr\(\).a)q(lloc)q(\(at,u)q
(se_r)q(evoca)q(tion)q(\);)676 3130 y(\(void\)s;)676
3221 y(assert\(s)g(&&)f(nd.get_proc\(0\).get_tmr\(\).vali)q(d\(\)\);)
676 3313 y(assert\(!t)h(||)f(t->valid\(\)\);)676 3404
y(return)h(\(void*\)t;)598 3495 y(})515 3761 y Fk(h)p
Fj(O\013)27 b(timer)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3852 y Fi(#include)41 b(<node/Node.h>)395
b(//)40 b(for)g(off_Node,)h(nd,)f(etc.)639 3993 y Fz(The)28
b(op)r(erator)e Fx(delete)f Fz(do)r(es)i(what)h(could)f(b)r(e)h(exp)r
(ected.)515 4110 y Fk(h)p Fi(off)p 667 4110 V 29 w(Tmr::operator)42
b(delete)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4201 y Fi(//)39 b(Deallocates)j(this)e(run)g(queue)h(slot.)598
4292 y(void)f(off_Tmr::operator)j(delete\(void)f(*p\))598
4384 y({)715 4475 y(off_Tmr)f(*t=\(off_Tmr*\)p;)676 4566
y(assert\(t)g(&&)f(t->valid\(\)\);)676 4658 y
(\(\(off_TmrSrv*\)\(t->get_contai)q(ner\(\))q(\)\)->)q(free)q(\(t\);)
598 4749 y(})1885 5255 y Fz(398)p eop
PStoPSsaved restore
%%Page: (400,401) 201
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
399 400 bop 639 523 a Fz(Timers)27 b(are)g(pre-initialized)g(when)h
(the)g(timer)f(serv)n(er)f(is)i(started.)515 639 y Fk(h)p
Fj(Start)h(other)g(memb)l(ers)f(of)f Fi(off)p 1467 639
24 4 v 29 w(TmrSrv)i Fj(ac)l(c)l(or)l(ding)g(to)f Fi(mdep)p
Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 731 y Fi(for)40 b(\(natural_t)h(t=0;)f
(t<)g(get_ntmrs\(\);)i(t++\){)676 822 y(off_tmr_id_t)g
(tid\(get_id\(\),t\);)676 913 y(off_ev_id_t)81 b
(irq\(nd.get_proc\(0\).get_irqs\()q(\)->ge)q(t_vi)q(nt0\(\))q(,)1343
1005 y(t)40 b(+)f(nd.get_proc\(0\).get_irqs\(\)->ge)q(t_vin)q(t0\(\))q
(\);)676 1096 y(\(void\))i(new\(t_alloc+t\))h
(off_LTmr\(tid,irq,this\);)598 1187 y(})515 1436 y Fk(h)p
Fj(O\013)27 b(timer)h(server)h(implementation)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1528 y Fi(#include)41 b(<klib/mdep/types.h>)
161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)639
1669 y Fz(Again,)27 b(w)n(e)h(use)f(a)g(tric)n(ky)g Fx(new)g
Fz(op)r(erator.)515 1785 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1785 V 29 w(LTmr)p Fj(.)h Fk(i)p Fq(\021)598
1876 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LTmr)i(*t\))f({)
g(\(void\)s;)h(return)f(\(void*\)t;)i(})639 2001 y Fz(The)19
b Fx(LTmr)d Fz(constructor)h(pre-initializes)h(eac)n(h)f(timer)i(in)f
(turn)h(using)f(the)h(pre-initialization)515 2100 y(constructor)26
b(for)h Fx(Tmr)p Fz(s.)515 2217 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 2217 V 29 w(LTmr)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2308 y Fi(off_LTmr\(const)42 b(off_tmr_id_t)g(&id,)e
(const)h(off_ev_id_t)g(&irq,)g(off_TmrSrv)g(*c\))f(:)676
2399 y(l_tmr\(id,irq,c\))j({;})639 2524 y Fz(Using)35
b(the)g(timer)g(allo)r(cator,)g(the)g(timer)g(serv)n(er)e(implemen)n
(ts)i(these)g(op)r(erators)e(to)515 2623 y(access)26
b(existing)h(timers.)515 2740 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2740 V 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 2831 y Fi(//Gets)40 b(a)g(timer)g(from)g(its)g
(distributed)i(or)e(physical)h(address.)598 2922 y(inline)f(off_Tmr)h
(*operator+\(off_offset_t)k(t\);)515 3080 y Fk(h)p Fi(off)p
667 3080 V 29 w(TmrSrv::operator+)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 3171 y Fi(//Gets)40 b(a)g(timer)g(from)g(its)g
(distributed)i(or)e(physical)h(address.)598 3263 y(inline)f(off_Tmr)h
(*off_TmrSrv::operator+\(off_o)q(ffset)q(_t)k(t\))598
3354 y({)676 3445 y(return)c(&\(t_alloc+t\)->l_tmr;)598
3537 y(})639 3678 y Fz(The)34 b(implemen)n(tation)f(uses)g(a)g
(rede\014nition)g(of)g(the)h(op)r(erator)d(in)j(the)g(allo)r(cator)d
(to)515 3778 y(do)c(it)h(more)f(e\016cien)n(tly)-7 b(.)515
3894 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3894 V 29 w(TmrAllocator)p Fj(.)i Fk(i)p
Fq(\021)598 3985 y Fi(//Gets)40 b(a)g(timer)g(from)g(its)g(distributed)
i(or)e(physical)h(address.)598 4076 y(inline)f(off_LTmr)h
(*operator+\(natural_t)j(t\);)515 4234 y Fk(h)p Fi(off)p
667 4234 V 29 w(TmrAllocator::operator)g(+)27 b Fj(implementation.)h
Fk(i)p Fq(\021)598 4325 y Fi(//Gets)40 b(a)g(timer)g(from)g(its)g
(distributed)i(or)e(physical)h(address.)598 4417 y(inline)f(off_LTmr)h
(*off_TmrAllocator::operator)q(+\(nat)q(ural)q(_t)k(t\))598
4508 y({)676 4599 y(return)c(t_tmr+t;)598 4691 y(})1885
5255 y Fz(399)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
400 401 bop 515 523 a Fn(4.4.4)112 b(Timer)36 b(rev)m(o)s(cation)515
676 y Fz(The)31 b(timer)g(serv)n(er)f(m)n(ust)h(implemen)n(t)h(the)f
Fx(notify)e Fz(metho)r(d)j(used)f(to)g(b)r(eha)n(v)n(e)g(as)f(a)h(re-)
515 776 y(source)26 b(rev)n(o)r(cation)g(trigger.)639
876 y(As)i(of)g(to)r(da)n(y)-7 b(,)27 b(there)g(is)g(no)h(rev)n(o)r
(cation)e(for)h(timers.)515 1008 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 1008 24 4 v 29 w(TmrSrv)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 1100 y Fi(//)39 b(Notifies)i(that)g(run)f
(queue)g(is)g(exhausted.)598 1191 y(void)g(notify\(void\))i({)d
(return;)i(})515 1556 y Fn(4.4.5)112 b(Timer)36 b(handling)515
1710 y Fz(The)25 b(implemen)n(tation)h(of)g(timers)f(is)g(the)h(one)f
(t)n(ypically)g(used)h(in)g(OSes.)35 b(W)-7 b(e)26 b(main)n(tain)f(a)
515 1809 y(list)i(of)g(timers)f(in)i(increasing)d(expiration)h(order)f
(where)i(eac)n(h)f(timer)h(k)n(eeps)f(the)h(n)n(um)n(b)r(er)515
1909 y(of)g(tic)n(ks)g(to)h(expiration)f(relativ)n(e)f(to)h(the)h
(previous)f(one)g(\(whic)n(h)h(could)f(also)g(b)r(e)h(zero\).)515
2042 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2042 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 2133 y Fi(DLinkedQueue)42 b(t_events;)394
b(//)40 b(List)g(of)g(pending)g(events.)515 2307 y Fk(h)p
Fj(O\013)27 b(timer)h(server)h(dep)l(endencies.)g Fk(i)p
Fz(+)p Fq(\021)598 2399 y Fi(#include)41 b(<klib/dqueue.h>)317
b(//)40 b(for)g(DLinkedQueue)639 2540 y Fz(This)e(relativ)n(e)e(coun)n
(t)i(is)f(handled)h(not)g(b)n(y)f(the)h(timer,)i(but)f(b)n(y)e(the)h
(timer)g(serv)n(er)515 2639 y Fx(activate)24 b Fz(metho)r(d.)515
2756 y Fk(h)p Fj(Other)k(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 2756 V 29 w(Tmr)p Fj(.)h Fk(i)p Fq(\021)598
2847 y Fi(friend)40 b(class)h(off_TmrSrv;)316 b(//)40
b(for)g(activate\(\))598 2938 y(natural_t)h(t_rticks;)551
b(//)40 b(Relative)h(number)g(of)e(ticks.)515 3096 y
Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3096 V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
3187 y Fi(//)39 b(Returns)i(the)f(number)h(of)e(ticks)i(for)f
(expiration)h(relative)g(to)f(the)g(previous)598 3279
y(//)f(event.)598 3370 y(inline)h(natural_t)i(get_rticks\(void\);)515
3544 y Fk(h)p Fi(off)p 667 3544 V 29 w(Tmr::get)p 1008
3544 V 30 w(rticks)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3636 y Fi(//)39 b(Returns)i(the)f(number)h(of)e(ticks)i(for)f
(expiration)h(relative)g(to)f(the)g(previous)598 3727
y(//)f(event.)598 3818 y(extern)h(inline)h(natural_t)g
(off_Tmr::get_rticks\(void\))598 3910 y({)676 4001 y
(assert\(valid\(\)\);)676 4092 y(return)g(t_rticks;)598
4184 y(})639 4416 y Fz(The)30 b(n)n(um)n(b)r(er)f(of)g(tic)n(ks)g(un)n
(til)g(the)h(\014rst)f(ev)n(en)n(t)g(in)g(the)h(queue)f(happ)r(ens)g
(is)g(cac)n(hed)g(in)515 4516 y(the)f(timer)f(serv)n(er.)515
4632 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4632 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 4723 y Fi(atomic_t)41 b(t_remaining;)395
b(//)39 b(#)h(of)g(ticks)g(until)g(next)g(event.)515
4881 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 4881 V 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 4972 y Fi(t_remaining\(INT_MAX\),)1885
5255 y Fz(400)p eop
PStoPSsaved restore
%%Page: (402,403) 202
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
401 402 bop 515 523 a Fk(h)p Fj(O\013)27 b(timer)h(server)h(dep)l
(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(#include)41
b(<limits.h>)198 b(//)40 b(for)g(INT_MAX)598 706 y(#include)h
(<klib/mdep/bitops.h>)122 b(//)40 b(for)g(atomic.)639
840 y Fz(After)32 b(the)g(clo)r(c)n(k)e(in)n(terrupt)h(has)g(b)r(een)g
(allo)r(cated,)h Fx(clock)p 2534 840 27 4 v 29 w(handler)c
Fz(will)k(b)r(e)f(called)515 940 y(ev)n(ery)26 b(time)i(the)g(clo)r(c)n
(k)f(tic)n(ks.)515 1066 y Fk(h)p Fj(O\013)g(timer)h(server)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
1158 y Fi(#include)41 b(<hw/Processor.h>)278 b(//)40
b(for)g(self)515 1319 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1319 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 1410 y Fi(//)39 b(Another)i(clock)g(tick)f(in)f(the)
h(wall.)598 1502 y(inline)g(void)g(clock_handler\(void\);)639
1636 y Fz(It)25 b(decremen)n(ts)f(the)g(n)n(um)n(b)r(er)g(of)h(tic)n
(ks)f(un)n(til)g(the)h(\014rst)f(ev)n(en)n(t)g(in)g(the)h(queue)f(and)h
(then)515 1736 y(calls)i Fx(expired)d Fz(when)k(it)g(b)r(ecomes)g
(zero.)515 1862 y Fk(h)p Fi(off)p 667 1862 V 29 w(TmrSrv::clock)p
1203 1862 V 31 w(handler)h Fj(implementation.)e Fk(i)p
Fq(\021)598 1953 y Fi(//)39 b(Another)i(clock)g(tick)f(in)f(the)h
(wall.)598 2045 y(inline)g(void)g(off_TmrSrv::clock_handler\(v)q(oid\))
598 2136 y({)676 2227 y(if)g(\(is_locked\(\)\))755 2319
y(atomic_inc\(&t_lost\);)676 2410 y(else)g
(if\(atomic_dec_and_test\(&t_re)q(main)q(ing\))q(\))833
2501 y(expired\(\);)598 2593 y(})639 2727 y Fz(The)23
b(n)n(um)n(b)r(er)f(of)h(lost)f(tic)n(ks)g(is)g(stored.)35
b(In)22 b(the)h(future)g(w)n(e)f(should)g(use)h(that)f(to)h(adjust)515
2827 y(our)k(idea)g(of)g(the)h(real)f(n)n(um)n(b)r(er)g(of)h(tic)n(ks.)
515 2953 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2953 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 3045 y Fi(atomic_t)41 b(t_lost;)394 b(//)39
b(#)h(of)f(lost)i(ticks)515 3206 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 3206 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3297 y Fi(t_lost\(0\),)639 3432 y Fx(expired)g Fz(is)i(used)g(b)r(oth)g
(to)g(handle)g(the)h(ev)n(en)n(t)f(and)g(to)g(reset)f
Fx(t)p 2711 3432 27 4 v 31 w(remaining)e Fz(to)j(the)515
3531 y(n)n(um)n(b)r(er)d(of)h(tic)n(ks)f(un)n(til)h(further)f(ev)n(en)n
(ts.)515 3658 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3658 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 3749 y Fi(//)39 b(It)h(is)g(called)g(when)h(the)e
(period)i(until)f(next)h(event)f(expires.)598 3840 y(//)f(The)h(number)
h(of)f(ticks)g(until)g(next)g(event)h(is)f(returned.)598
3932 y(volatile)h(void)f(expired\(void\);)515 4093 y
Fk(h)p Fi(off)p 667 4093 V 29 w(TmrSrv::expired)30 b
Fj(implementation.)e Fk(i)p Fq(\021)598 4184 y Fi(//)39
b(It)h(is)g(called)g(when)h(the)e(period)i(until)f(next)h(event)f
(expires.)598 4276 y(//)f(The)h(number)h(of)f(ticks)g(until)g(next)g
(event)h(is)f(returned.)598 4367 y(volatile)h(void)f
(off_TmrSrv::expired\(void\))598 4458 y({)676 4550 y(off_LTmr)h(*ev;)
676 4732 y Fk(h)p Fj(Pick)28 b(up)f(\014rst)i(p)l(ending)f
Fi(ev)p Fj(.)g Fk(i)676 4824 y(h)p Fj(Hand)t(le)g(expir)l(e)l(d)h
(event)g Fi(ev)p Fj(.)e Fk(i)598 4915 y Fi(})1885 5255
y Fz(401)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
402 403 bop 639 523 a Fz(When)30 b(the)g(\014rst)f(p)r(ending)h(ev)n
(en)n(t)f(expires,)g(w)n(e)g(get)g(a)g(reference)g(to)g(it)h(\(to)f
(handle)h(it)515 623 y(later\))k(and)h(reset)g(the)g(clo)r(c)n(k)g
(coun)n(ter)f(with)i(the)f(relativ)n(e)f(coun)n(t)h(for)f(the)i(next)f
(timer.)515 722 y(The)23 b(queue)h(is)f(also)g(handled)g(from)g(in)n
(terrupts,)h(th)n(us)g(w)n(e)f(clear)f(in)n(terrupts)h(and)h(lo)r(c)n
(k)f(the)515 822 y(queue)k(for)g Fx(enqueue)e Fz(and)j
Fx(dequeue)c Fz(op)r(erations.)515 955 y Fk(h)p Fj(Pick)j(up)h(\014rst)
h(p)l(ending)f Fi(ev)p Fj(.)f Fk(i)p Fq(\021)598 1046
y Fi(w_lock\(\);)598 1137 y(if)39 b(\(t_events.is_empty\(\)\){)676
1229 y(t_remaining=\(atomic_t\)INT_MA)q(X;)163 b(//)40
b(Sometime)h(far)f(in)f(the)h(future)676 1320 y(w_unlock\(\);)676
1411 y(return;)598 1503 y(})598 1594 y(ev)f(=)h
(\(off_LTmr*\)t_events.dequeue\(\);)598 1685 y(w_unlock\(\);)639
1826 y Fz(T)-7 b(o)35 b(handle)h(a)f(timer)g(w)n(e)g(usually)g(raise)f
(its)i(virtual)f(in)n(terrupt;)k(but)d(for)e(a)h(sp)r(ecial)515
1926 y(timer)27 b(whic)n(h)h(will)g(b)r(e)g(discussed)f(later.)515
2042 y Fk(h)p Fj(Hand)t(le)g(expir)l(e)l(d)i(event)g
Fi(ev)p Fj(.)f Fk(i)o Fq(\021)598 2134 y Fk(h)p Fj(Hand)t(le)f(p)l
(erio)l(dic)i(expir)l(e)l(d)f(event)h Fi(ev)f Fj(and)g(r)l(eset)i
Fi(t)p 2124 2134 24 4 v 28 w(remaining)p Fj(.)f Fk(i)598
2225 y Fi(if)39 b(\()p Fk(h)p Fj(It)28 b(is)f(a)h(sp)l(e)l(cial)g
Fi(ev)g Fj(to)g(b)l(e)g(hand)t(le)l(d.)g Fk(i)p Fi(\){)676
2316 y Fk(h)p Fj(Hand)t(le)g(sp)l(e)l(cial)g Fi(ev)p
Fj(.)f Fk(i)598 2408 y Fi(})598 2499 y(else)40 b({)676
2590 y(off_Irq)h(*i=off_Processor::self\(\)->get)q(_irq)q(\(ev->)q
(l_tm)q(r.get)q(_irq)q(line)q(\(\)\);)676 2682 y(i->raise\(\);)598
2773 y(})598 2864 y Fk(h)p Fj(Cle)l(anup)28 b(expir)l(e)l(d)g(event)h
Fi(ev)p Fj(.)f Fk(i)639 2989 y Fz(W)-7 b(e)30 b(still)f(ha)n(v)n(e)f
(to)h(sho)n(w)f(ho)n(w)g(are)g(timers)h(created.)40 b(When)29
b(a)g(timer)g(is)g(created,)f(w)n(e)515 3088 y(m)n(ust)33
b(\014nd)g(the)g(place)g(in)g(the)g(list)g(of)g(activ)n(e)f(timers)g
(where)h(it)g(should)f(b)r(e)i(placed)e(and)515 3188
y(adjust)d(b)r(oth)g(its)f(relativ)n(e)g(n)n(um)n(b)r(er)g(of)g(tic)n
(ks)h(and)f(the)h(relativ)n(e)e(n)n(um)n(b)r(er)i(of)f(tic)n(ks)g(of)h
(the)515 3288 y(follo)n(wing)21 b(timers.)35 b(Both)23
b(tasks)f(are)g(done)g(b)n(y)h(the)g(timer)g(protected)f(metho)r(d)h
Fx(activate)p Fz(.)515 3404 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 3404 V 29 w(Tmr)p Fj(.)g
Fk(i)p Fq(\021)598 3495 y Fi(//)39 b(Activates)j(the)e(timer)g(by)g
(linking)g(it)g(in)g(the)g(active)g(timer)h(queue.)598
3587 y(void)f(activate\(void\);)639 3711 y Fz(whic)n(h)28
b(is)f(called)h(b)n(y)f(the)h(constructor)e(when)i(the)g(timer)f(is)h
(created.)515 3827 y Fk(h)p Fj(Initialize)e(other)j(private)g(memb)l
(ers)g(of)e Fi(off)p 1854 3827 V 29 w(Tmr)p Fj(.)g Fk(i)p
Fq(\021)598 3919 y Fi(activate\(\);)639 4043 y Fz(Note)e(that)h(when)f
(the)h(timer)f(is)g(p)r(erio)r(dic,)h(it)f(is)g(activ)-5
b(ated)26 b(when)f(expired)g(to)r(o.)35 b(Oth-)515 4143
y(erwise)26 b(the)i(timer)g(should)f(b)r(e)h(deleted.)515
4259 y Fk(h)p Fj(Hand)t(le)f(p)l(erio)l(dic)i(expir)l(e)l(d)f(event)h
Fi(ev)f Fj(and)g(r)l(eset)i Fi(t)p 2041 4259 V 28 w(remaining)p
Fj(.)f Fk(i)p Fq(\021)598 4350 y Fi(if)39 b
(\(ev->l_tmr.is_periodic\(\)\))676 4442 y(__activate\(&ev->l_tmr\);)598
4533 y(else)h(if)g(\(t_events.is_empty\(\)\))676 4624
y(t_remaining=INT_MAX;)598 4716 y(else)676 4807 y
(t_remaining=\(\(off_LTmr*\)t_ev)q(ents.)q(get_)q(firs)q(t\(\)\)-)q
(>l_t)q(mr.ge)q(t_rt)q(icks)q(\(\);)1885 5255 y Fz(402)p
eop
PStoPSsaved restore
%%Page: (404,405) 203
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
403 404 bop 515 523 a Fk(h)p Fj(Cle)l(anup)28 b(expir)l(e)l(d)g(event)h
Fi(ev)p Fj(.)f Fk(i)p Fq(\021)598 614 y Fi(if)39 b
(\(!ev->l_tmr.is_periodic\(\)\))676 706 y(delete)i(&\(ev->l_tmr\);)639
847 y Fz(W)-7 b(e)30 b(used)p 981 847 27 4 v 61 w Fx(activate)c
Fz(whic)n(h)k(\(re\)activ)-5 b(ates)28 b(a)i(timer.)42
b(It)30 b(do)r(es)f(not)g(lo)r(c)n(k)g(the)h(timer)515
946 y(serv)n(er.)54 b(Hence,)36 b(another)d Fx(activate)e
Fz(metho)r(d)k(is)e(pro)n(vided)g(for)h(users)f(whic)n(h)h(acquire)515
1046 y(the)29 b(lo)r(c)n(k.)42 b(There)29 b(is)g(another)f
Fx(activate)e Fz(metho)r(d)k(pro)n(vided)f(b)n(y)g(timers)g(whic)n(h)g
(simply)515 1146 y(calls)e(its)g(coun)n(terpart)g(in)g(the)h(timer)g
(serv)n(er.)515 1279 y Fk(h)p Fi(off)p 667 1279 24 4
v 29 w(Tmr::activate)i Fj(implementation.)d Fk(i)p Fq(\021)598
1370 y Fi(//)39 b(Activates)j(the)e(timer)g(by)g(linking)g(it)g(in)g
(the)g(active)g(timer)h(queue.)598 1461 y(void)f
(off_Tmr::activate\(void\))598 1553 y({)676 1644 y
(assert\(\(\(off_TmrSrv*\)get_con)q(taine)q(r\(\)\))q(->va)q(lid\(\))q
(\);)676 1735 y(\(\(off_TmrSrv*\)get_container\()q(\)\)->a)q(ctiv)q
(ate\()q(this\))q(;)598 1826 y(})515 2001 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2001 V 29
w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 2092 y Fi(//)39
b(Activates)j(the)e(timer)g(by)g(linking)g(it)g(in)g(the)g(active)g
(timer)h(queue.)598 2183 y(void)f(activate\(off_Tmr)j(*t\);)515
2358 y Fk(h)p Fj(Other)28 b(private)h(metho)l(ds)g(of)e
Fi(off)p 1529 2358 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fq(\021)598
2449 y Fi(//)39 b(Activates)j(the)e(timer)g(by)g(linking)g(it)g(in)g
(the)g(active)g(timer)h(queue.)598 2540 y(//)e(No)h(locks)598
2632 y(void)g(__activate\(off_Tmr)j(*t\);)1885 5255 y
Fz(403)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
404 405 bop 639 523 a Fz(The)31 b(timer)h(serv)n(er)d(metho)r(d)i(is)g
(used)h(to)f(main)n(tain)f(\(to)i(link)f(timers)g(in\))g(the)h(activ)n
(e)515 623 y(timer)j(queue.)61 b(T)-7 b(o)35 b(do)g(so,)i(w)n(e)e(need)
g(a)g(p)r(oin)n(ter)g(to)h(the)f Fx(LTmr)f Fz(the)i(timer)g(is)f(in)h
(so)e(w)n(e)515 722 y(could)f(reuse)f(the)h(p)r(oin)n(ters)g(used)g(b)n
(y)g(the)g(timer)g(allo)r(cator;)h(then)g(w)n(e)f(w)n(alk)f(the)h
(queue)515 822 y(main)n(taining)25 b(in)g Fx(ticks)f
Fz(the)i(relativ)n(e)e(n)n(um)n(b)r(er)h(of)g(tic)n(ks)g(\(with)i(resp)
r(ect)e(the)h(queue)f(no)r(de)515 922 y(b)r(eing)i(visited\))h(for)f
(timer)h(expiration.)515 1054 y Fk(h)p Fi(off)p 667 1054
24 4 v 29 w(TmrSrv::activate)j Fj(implementation.)c Fk(i)p
Fq(\021)598 1146 y Fi(//)39 b(Activates)j(the)e(timer)g(by)g(linking)g
(it)g(in)g(the)g(active)g(timer)h(queue.)598 1237 y(void)f
(off_TmrSrv::activate\(off_Tmr)45 b(*t\))598 1328 y({)676
1420 y(w_lock\(\);)676 1511 y(__activate\(t\);)676 1602
y(w_unlock\(\);)598 1694 y(})598 1876 y(//)39 b(Activates)j(the)e
(timer)g(by)g(linking)g(it)g(in)g(the)g(active)g(timer)h(queue.)598
1968 y(//)e(Beware,)i(NO)f(LOCKS)598 2059 y(void)g
(off_TmrSrv::__activate\(off_Tmr)46 b(*t\))598 2150 y({)676
2333 y(boolean_t)41 b(clrd;)676 2424 y(off_LTmr)g
(*lt=\(off_LTmr*\)\(\(\(char*\)t\)-\()q(int\))q(&off_)q(LTmr)q(::l_t)q
(mr\);)676 2516 y(natural_t)g(&ticks=t->t_rticks;)676
2698 y(assert\(valid\(\))i(&&)c(t)h(&&)f(t->valid\(\)\);)676
2790 y(ticks=t->get_ticks\(\);)676 2972 y(if)h
(\(t_events.is_empty\(\)\){)755 3064 y Fk(h)p Fj(Plac)l(e)27
b(timer)h Fi(t)g Fj(to)g(expir)l(e)h(in)e Fi(ticks)h
Fj(at)g(he)l(ad)h(of)e Fi(t)p 2300 3064 V 29 w(events)p
Fj(.)h Fk(i)676 3155 y Fi(})676 3246 y(else)40 b({)755
3337 y Fk(h)p Fj(Find)27 b(plac)l(e)h(in)f Fi(t)p 1298
3337 V 29 w(events)h Fj(for)g(timer)g Fi(t)f Fj(to)i(expir)l(e)f(in)f
Fi(ticks)i Fk(i)676 3429 y Fi(})676 3520 y
(t_remaining=\(\(off_LTmr*\)t_ev)q(ents.)q(get_)q(firs)q(t\(\)\)-)q
(>l_t)q(mr.ge)q(t_rt)q(icks)q(\(\);)676 3611 y Fk(h)p
Fj(A)l(ctivate)g(HW)e(clo)l(ck)h(interrupt)i(if)c(ne)l(c)l(essary.)k
Fk(i)598 3885 y Fi(})639 4118 y Fz(If)e(there)g(is)f(no)g(timer)h(w)n
(e)f(simply)h(put)g(the)g(timer)g(in)g(the)g(head)f(of)h(the)g(queue.)
515 4234 y Fk(h)p Fj(Plac)l(e)g(timer)f Fi(t)h Fj(to)g(expir)l(e)h(in)e
Fi(ticks)h Fj(at)h(he)l(ad)f(of)f Fi(t)p 2060 4234 V
29 w(events)p Fj(.)h Fk(i)p Fq(\021)598 4325 y Fi(t->t_rticks=ticks;)
598 4417 y(t_events.enqueue\(lt\);)1885 5255 y Fz(404)p
eop
PStoPSsaved restore
%%Page: (406,407) 204
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
405 406 bop 639 523 a Fz(If)26 b(there)g(are)f(timers,)h(w)n(e)f(start)
g(scanning)g(the)h(queue)g(from)f(its)h Fx(head)e Fz(using)i(a)f(queue)
515 623 y(iterator)i Fx(itr)p Fz(.)37 b(If)29 b(the)g(iterator)e(w)n
(as)g(not)h Fx(placed)e Fz(after)i(the)g(last)g(no)r(de)h(w)n(as)e
(visited,)h(w)n(e)515 722 y(link)f(the)h(no)r(de)g(at)g(the)g(end)f(of)
h(the)g(queue.)639 822 y(Ev)n(ery)37 b(time)i(a)f(new)g(no)r(de)g(is)g
(visited)h(w)n(e)f(main)n(tain)f Fx(ticks)g Fz(as)g(a)h(relativ)n(e)f
(coun)n(t)515 922 y(starting)26 b(at)i(it.)37 b(When)28
b(the)g(no)r(de)g(is)f(\014nally)g(placed,)h Fx(ticks)d
Fz(con)n(tains)i(a)g(relativ)n(e)f(coun)n(t)515 1021
y(and)h(w)n(e)g(adjust)h(the)g(relativ)n(e)f(coun)n(t)g(of)g(the)h
(follo)n(wing)f(no)r(de)h(to)f(discoun)n(t)g Fx(ticks)p
Fz(.)515 1139 y Fk(h)p Fj(Find)g(plac)l(e)h(in)f Fi(t)p
1058 1139 24 4 v 29 w(events)h Fj(for)g(timer)g Fi(t)f
Fj(to)i(expir)l(e)f(in)f Fi(ticks)i Fk(i)p Fq(\021)598
1230 y Fi(DLinkedQueueItr)42 b(itr,head;)598 1322 y(boolean_t)f
(placed=FALSE;)598 1413 y(head=itr=t_events.get_head\(\);)598
1504 y(do)e({)676 1596 y(natural_t)i(&nticks=)h
(\(\(off_LTmr*\)itr.get_element\(\)\)-)q(>l_tm)q(r.t_)q(rtic)q(ks;)676
1687 y(if)e(\(nticks)h(>=)e(ticks\){)755 1778 y(ticks)h(-=)g(nticks;)
676 1870 y(})676 1961 y(else)g({)755 2052 y(placed=TRUE;)755
2144 y(nticks)g(-=)g(ticks;)755 2235 y(t_events.link_before\(lt,itr\);)
676 2326 y(})676 2418 y(++itr;)598 2509 y(})f(while)i(\(!placed)g(&&)e
(itr)h(!=)g(head\);)598 2692 y(if)f(\(!placed\){)676
2783 y(DLinkedQueueItr)k(i=t_events.get_tail\(\);)676
2874 y(t_events.link_after\(lt,i\);)598 2966 y(})639
3092 y Fz(Finally)-7 b(,)39 b(w)n(e)c(do)h(not)h(w)n(an)n(t)e(to)h
(main)n(tain)g(the)h(hardw)n(are)d(clo)r(c)n(k)h(in)n(terrupt)h(alw)n
(a)n(ys)515 3191 y(enabled.)57 b(It)35 b(is)f(enabled)h(only)f(when)g
(there)h(are)e(timers)i(to)f(b)r(e)h(serviced.)56 b(The)35
b(timer)515 3291 y(serv)n(er)26 b(enables)h(the)h(hardw)n(are)d(clo)r
(c)n(k)i(in)n(terrupt)g(when)h(the)g(\014rst)f(timer)h(is)f(activ)-5
b(ated)515 3409 y Fk(h)p Fj(A)l(ctivate)29 b(HW)e(clo)l(ck)h(interrupt)
h(if)e(ne)l(c)l(essary.)i Fk(i)p Fq(\021)598 3500 y Fi
(t_clkirq->unmask\(\);)639 3627 y Fz(and)f(disables)f(it)h(again)e
(when)i(the)g(last)f(activ)n(e)g(timer)h(is)f(disabled.)515
3744 y Fk(h)p Fj(De)l(activate)i(HW)e(clo)l(ck)h(interrupt)i(if)c(ne)l
(c)l(essary.)k Fk(i)p Fq(\021)598 3836 y Fi(if)39 b
(\(!t_alloc.get_nalloc\(\)\))676 3927 y(t_clkirq->mask\(\);)515
4163 y FA(Helping)30 b(pro)s(cessors)h(with)g(their)h(quan)m(ta)515
4316 y Fz(Ev)n(ery)26 b(pro)r(cessor)h(with)i(a)e(run)i(queue)f(will)h
(alw)n(a)n(ys)d(w)n(an)n(t)i(to)g(b)r(e)h(in)n(terrupted)f(to)g(imple-)
515 4416 y(men)n(t)35 b(quan)n(ta.)59 b(Those)35 b(in)n(terrupts)f(tak)
n(e)h(part)f(in)i(the)f(critical)g(path)g(for)g(the)g(con)n(text)515
4516 y(switc)n(h,)27 b(hence)h(they)g(are)e(handled)i(apart.)639
4615 y(The)19 b(timer)f(serv)n(er)f(includes)h(a)g Fx(alloc)p
1839 4615 27 4 v 29 w(pclk)f Fz(metho)r(d)i(in)n(tended)g(to)f(start)g
(the)h(\\sc)n(hedul-)515 4715 y(ing")27 b(clo)r(c)n(k.)515
4824 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4824 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4915 y Fi(//)39 b(Starts)i(the)f(scheduling)h(clock)g(timer.)598
5006 y(void)f(alloc_pclk\(natural_t)k(nticks\);)1885
5255 y Fz(405)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
406 407 bop 639 523 a Fz(It)28 b(programs)e(a)h(sp)r(ecial)g(timer)h
(whic)n(h)f(is)h(handled)f(b)n(y)h(the)g(timer)f(serv)n(er)f(itself.)
515 656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(TmrSrv::alloc)p
1203 656 V 31 w(pclk)i Fj(implementation.)g Fk(i)o Fq(\021)598
747 y Fi(//)39 b(Starts)i(the)f(scheduling)h(clock)g(timer.)598
839 y(void)f(off_TmrSrv::alloc_pclk\(natural)q(_t)45
b(nticks\))598 930 y({)676 1021 y(assert\(valid\(\)\);)676
1112 y(if)40 b(\(!t_pclk\){)755 1204 y(off_Tmr)g(*t=new)h
(off_Tmr\(get_protection\(\),get_)q(doma)q(in\(\),)q(ntic)q(ks,T)q
(RUE\);)755 1295 y(assert\(t)g(&&)e(t->valid\(\)\);)755
1386 y(t_pclk=\(off_LTmr*\)\(\(\(char*\)t\)-\()q(int\))q(&off)q(_LTmr)q
(::l_)q(tmr\);)676 1478 y(})598 1569 y(})639 1802 y Fz(What)27
b(mak)n(es)f(it)g(so)g(sp)r(ecial)g(is)h(that)g(when)f(time)h(has)f
(come)g(to)h(handle)f(it)h(the)g(timer)515 1901 y(serv)n(er)e(c)n(hec)n
(ks)h(the)h(timer)g(address)f(to)h(see)f(if)i(it)f(is)g(the)g(same)g
(of)g Fx(t)p 2638 1901 27 4 v 31 w(pclk)p Fz(.)35 b(If)27
b(it)h(matc)n(hes,)515 2001 y(the)f(curren)n(t)f(pro)r(cessor)f
Fx(new)p 1445 2001 V 30 w(quantum)f Fz(metho)r(d)k(is)e(called)h
(instead)g(of)g(raising)e(a)i(virtual)515 2100 y(in)n(terrupt.)36
b(Th)n(us,)515 2233 y Fk(h)p Fj(It)27 b(is)g(a)h(sp)l(e)l(cial)g
Fi(ev)g Fj(to)g(b)l(e)g(hand)t(le)l(d.)g Fk(i)p Fq(\021)598
2325 y Fi(ev)39 b(==)h(t_pclk)515 2499 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 2499 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2590 y Fi(t_pclk\(NULL\),)515 2765 y Fk(h)p Fj(Other)g(private)h(memb)l
(ers)f(of)g Fi(off)p 1552 2765 V 29 w(TmrSrv)p Fj(.)g
Fk(i)p Fz(+)o Fq(\021)598 2856 y Fi(off_LTmr)41 b(*t_pclk;)590
b(//)40 b(Special)h(processor)g(clock)f(timer.)639 2997
y Fz(No)n(w,)27 b(to)h(handle)f(suc)n(h)h(ev)n(en)n(t)f(w)n(e)g(call)g
Fx(new)p 2038 2997 27 4 v 30 w(quantum)p Fz(.)515 3113
y Fk(h)p Fj(Hand)t(le)g(sp)l(e)l(cial)h Fi(ev)p Fj(.)g
Fk(i)p Fq(\021)598 3205 y Fi(off_Processor::self\(\)->new_qua)q(ntum\()
q(\);)639 3329 y Fz(The)34 b Fx(new)p 953 3329 V 30 w(quantum)c
Fz(routine)j(will)h(\(p)r(erhaps\))f(lea)n(v)n(e)f(us)h(in)h(the)f(con)
n(text)g(for)g(a)g(new)515 3429 y(sh)n(uttle)28 b(b)r(efore)f(it)h
(returns.)515 3661 y Fn(4.4.6)112 b(Timer)36 b(serv)m(er)h(na)m
(vigation)g(and)i(insp)s(ection)722 3814 y FA(NOTE:)27
b Fz(XXX)i(Not)e(y)n(et)h(implemen)n(ted.)515 4030 y
FA(Timer)i(serv)m(er)j(na)m(vigation)515 4175 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
4175 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4267 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f(timer)g(servers.)598
4358 y(off_Navigator)i(*get_navigator\(void\))i({)39
b(return)i(NULL;)f(})515 4532 y Fk(h)p Fj(O\013)27 b(timer)h(server)h
(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 4624 y
Fi(#include)41 b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)i(et)d
(al.)1885 5255 y Fz(406)p eop
PStoPSsaved restore
%%Page: (408,409) 205
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
407 408 bop 515 523 a FA(Timer)30 b(serv)m(er)j(insp)s(ection)515
676 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)e(to)i(implemen)n(t)g
Fx(get)p 1496 676 27 4 v 30 w(url)e Fz(and)i Fx(nameof)p
Fz(.)515 793 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 793 24 4 v 29 w(TmrSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 884 y Fi(//)39 b(Get)h(the)g(timer)h(server)f(URL.)
598 975 y(const)g(char)g(*get_url\(void\);)598 1066 y(//)f(Returns)i
(the)f(timer)h(server)f(name.)598 1158 y(const)g(char)g
(*nameof\(void\);)639 1282 y Fz(The)25 b(URL)h(for)e(a)h(timer)g(serv)n
(er)e(is)h(that)i(of)f(its)g(no)r(de)g(with)g Fx(tmrsrv.html)c
Fz(app)r(ended.)515 1382 y(W)-7 b(e)38 b(use)f(a)g(new)g(mem)n(b)r(er,)
j(a)d(c)n(haracter)e(arra)n(y)h(initialized)h(the)h(v)n(ery)e(\014rst)h
(time)h(it)g(is)515 1482 y(needed.)515 1598 y Fk(h)p
Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p 1552
1598 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598
1689 y Fi(static)40 b(char)g(*t_url;)512 b(//)40 b(URL)g(for)g(this)g
(TmrSrv.)639 1814 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 1930 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(static)g(memb)l
(ers.)f Fk(i)p Fq(\021)598 2021 y Fi(char)40 b
(*off_TmrSrv::t_url=NULL;)84 b(//)39 b(URL)h(for)g(this)g(TmrSrv.)515
2179 y Fk(h)p Fi(off)p 667 2179 V 29 w(TmrSrv::get)p
1125 2179 V 30 w(url)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 2270 y Fi(//)39 b(Get)h(the)g(timer)h(server)f(URL.)598
2362 y(const)g(char)g(*off_TmrSrv::get_url\(void\))598
2453 y({)676 2544 y(assert\(valid\(\)\);)676 2636 y(if)g(\(!t_url\){)
755 2727 y(t_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_T)q(MRSRV)q(_URL)q(\)+1])q(;)k(//+1)40 b(for)g(\\0)755
2818 y(if)f(\(t_url\){)833 2910 y(strcpy\(t_url,nd.get_url\(\)\);)833
3001 y(strcat\(t_url,OFF_TMRSRV_URL\);)755 3092 y(})676
3184 y(})676 3275 y(return)i(t_url;)598 3366 y(})639
3599 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(timer)f(serv)n(ers.)515 3715 y Fk(h)p
Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e Fk(i)p
Fq(\021)598 3806 y Fi(const)40 b(char)g(OFF_TMRSRV_URL[]="/tmrsrv.ht)q
(ml";)515 3964 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(dep)l
(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 4055 y Fi(#include)41
b(<klib/url.h>)434 b(//)40 b(for)g(OFF_TMRSRV_URL)515
4230 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(implementation)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4321 y Fi(#include)41
b(<string.h>)512 b(//)40 b(for)g(strcat)g(strdup)h(et)e(al)598
4412 y(#include)i(<node/Node.h>)395 b(//)40 b(for)g(nd)1885
5255 y Fz(407)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
408 409 bop 639 523 a Fz(The)31 b(name)f(for)g(a)g(timer)g(serv)n(er)f
(is)h(that)h(of)f(its)h(no)r(de)f(complemen)n(ted)g(with)h(a)f(little)
515 623 y(su\016x.)37 b(The)27 b(implemen)n(tation)h(is)f(almost)g(the)
h(same)f(of)h Fx(get)p 2464 623 27 4 v 30 w(url)p Fz(.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(TmrSrv::nameof)i
Fj(implementation.)e Fk(i)o Fq(\021)598 847 y Fi(//)39
b(Returns)i(the)f(timer)h(server)f(name.)598 938 y(const)g(char)g
(*off_TmrSrv::nameof\(void\))598 1029 y({)676 1121 y
(assert\(valid\(\)\);)676 1212 y(if)g(\(!t_name\){)755
1303 y(t_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q(\("/t)q
(mr"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755 1395 y(if)f(\(t_name\){)
833 1486 y(char)h(number[9];)833 1577 y
(strcpy\(t_name,nd.nameof\(\)\);)833 1669 y(strcat\(t_name,"/tmr"\);)
833 1760 y(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q
(id\(\)\))q(;)833 1851 y(strcat\(t_name,number\);)755
1943 y(})676 2034 y(})676 2125 y(return)h(t_name;)598
2217 y(})515 2482 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2482 V 29 w(TmrSrv)p Fj(.)g Fk(i)p Fz(+)o
Fq(\021)598 2574 y Fi(char)40 b(*t_name;)708 b(//)39
b(name)i(for)f(this)g(TmrSrv)515 2748 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 2748 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2839 y Fi(t_name\(NULL\))515 3097 y FA(Timer)i(insp)s(ection)515
3250 y Fz(W)-7 b(e)18 b(need)h Fx(get)p 970 3250 27 4
v 30 w(rurl)e Fz(and)h Fx(get)p 1477 3250 V 30 w(url)p
1639 3250 V 30 w(holder)e Fz(for)i(timers)g(to)h(supp)r(ort)f
Fx(ResUnit::get)p 3231 3250 V 26 w(url)p Fz(.)515 3383
y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3383 24 4 v 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3474 y Fi(//)39 b(Get)h(the)g(timer)h(url)598
3565 y(virtual)g(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)
g(OFF_TMR_URL;)i(})598 3657 y(//)d(Returns)i(the)f(timer)h(name.)598
3748 y(virtual)g(char)f(*&get_url_holder\(void\);)639
3889 y Fz(He)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(relativ)n(e)e(URL)
i(for)f(timers.)515 4005 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l(de)
g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 4097 y Fi(const)40
b(char)g(OFF_TMR_URL[]="#Tmr";)515 4254 y Fk(h)p Fj(O\013)27
b(timer)h(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
4346 y Fi(#include)41 b(<klib/url.h>)434 b(//)40 b(for)g(OFF_TMR_URL)
515 4520 y Fk(h)p Fj(O\013)27 b(timer)h(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 4611 y Fi(#include)41
b(<stdio.h>)551 b(//)40 b(for)g(sprintf)g(et)g(al)639
4753 y Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g(timers.)515
4869 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4869 V 29 w(Tmr)p Fj(.)f Fk(i)p Fq(\021)598
4960 y Fi(static)40 b(char)g(*t_url;)512 b(//)40 b(URL)g(for)g(this)g
(timer.)1885 5255 y Fz(408)p eop
PStoPSsaved restore
%%Page: (410,411) 206
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
409 410 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Tmr::get)p 1008 523 V 30 w(url)p 1155 523 V 29 w(holder)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 614 y Fi(char)40
b(*&off_Tmr::get_url_holder\(void)q(\))45 b({)79 b(return)40
b(t_url;)h(})639 847 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 963 y Fk(h)p Fj(O\013)27 b(timer)h(static)g(memb)l(ers.)h
Fk(i)o Fq(\021)598 1054 y Fi(char)40 b(*off_Tmr::t_url=NULL;)122
b(//)40 b(URL)g(for)g(timers.)515 1312 y Fn(4.4.7)112
b(F)-9 b(rozen)38 b(timers)722 1465 y FA(NOTE:)27 b Fz(Not)h(y)n(et)f
(implemen)n(ted.)515 1681 y FA(F)-8 b(reezing)31 b(timer)f(serv)m(ers)
515 1826 y Fk(h)p Fj(Other)e(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1826 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 1917 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
2008 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 2100 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2191 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2282
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 2374
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
2465 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
2556 y(return)e(ENOSYS;)598 2648 y(})598 2830 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
2922 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 3013 y(\(void\)curto;)h(\(void\)toavail;)
676 3104 y(return)f(ENOSYS;)598 3196 y(})515 3370 y Fk(h)p
Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3370 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3461 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
3553 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 3644 y(//)f(return.)598
3735 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
3827 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 3918 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 4009 y(\(void\)buf;)h
(\(void\)bsize;)676 4100 y(return)f(ENOSYS;)598 4192
y(})598 4283 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
4374 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 4466 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 4557 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
4648 y(return)f(ENOSYS;)598 4740 y(})1885 5255 y Fz(409)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
410 411 bop 515 523 a FA(F)-8 b(reezing)31 b(timers)515
668 y Fk(h)p Fj(Other)d(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 668 24 4 v 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 759 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
851 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 942 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
1033 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 1125
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 1216
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
1307 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
1399 y(return)e(ENOSYS;)598 1490 y(})598 1673 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
1764 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 1855 y(\(void\)curto;)h(\(void\)toavail;)
676 1947 y(return)f(ENOSYS;)598 2038 y(})515 2212 y Fk(h)p
Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2212 V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2304 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
2395 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 2486 y(//)f(return.)598
2577 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
2669 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 2760 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 2851 y(\(void\)buf;)h
(\(void\)bsize;)676 2943 y(return)f(ENOSYS;)598 3034
y(})598 3125 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
3217 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 3308 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 3399 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
3491 y(return)f(ENOSYS;)598 3582 y(})515 3947 y Fn(4.4.8)112
b(Dumping)37 b(timers.)515 4101 y Fz(T)-7 b(o)27 b(dump)h(a)f(Timer)h
(serv)n(er)d(w)n(e)j(use)f(this)h(op)r(erator.)515 4217
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4217 V 29 w(TmrSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4308 y Fi(//)39 b(Dumps)i(tmrsrv)f(state.)598 4399 y(friend)g(OStr)g
(&operator<<\(OStr)j(&s,)79 b(off_TmrSrv)42 b(&t\);)515
4557 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4557 V 29 w(Tmr)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 4648 y Fi(//)39 b(Dumps)i(tmr.)598 4740 y(friend)f(OStr)g
(&operator<<\(OStr)j(&s,)79 b(off_Tmr)41 b(&t\);)1885
5255 y Fz(410)p eop
PStoPSsaved restore
%%Page: (412,413) 207
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
411 412 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(TmrSrv::operator<<)31 b Fj(implementation.)d Fk(i)o
Fq(\021)598 614 y Fi(//)39 b(Dumps)i(tmrsrv)f(state.)598
706 y(OStr)g(&operator<<\(OStr)j(&s,)79 b(off_TmrSrv)41
b(&t\))598 797 y({)676 888 y(s)f(<<)f(*\(off_HWCompResource*\)&t;)676
980 y(s)h(<<)f("name=")i(<<)f(t.nameof\(\))h(<<)f(")f(url=")i(<<)f
(t.get_url\(\))h(<<)f(nl;)676 1071 y(return)h(s;)598
1162 y(})515 1411 y Fk(h)p Fj(O\013)27 b(timer)h(server)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
1503 y Fi(#include)41 b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f
(al.)515 1660 y Fk(h)p Fi(off)p 667 1660 V 29 w(Tmr::operator<<)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 1752 y Fi(//)39
b(Dumps)i(tmr)f(state.)598 1843 y(OStr)g(&operator<<\(OStr)j(&s,)d
(off_Tmr)g(&t\))598 1934 y({)676 2026 y(s)g(<<)79 b
(*\(off_HWResUnit*\)&t;)676 2117 y(s)40 b(<<)f(fmt\("\045d)i
(",t.get_rticks\(\)\))i(<<)d("ticks";)676 2208 y(s)g(<<)f("irq=")i(<<)f
(t.get_irqline\(\))i(<<)e(\(\(t.is_periodic\(\)\)?")k(periodic":")d
("\))f(<<)g(nl;)676 2300 y(return)h(s;)598 2391 y(})515
2640 y Fk(h)p Fj(O\013)27 b(timer)h(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 2731 y Fi(#include)41 b(<klib/str.h>)515
2993 y Fn(4.4.9)112 b(Timer)36 b Fd(C)8 b FC(++)38 b
Fn(source)f(\014les)515 3147 y Fz(Timer)27 b(serv)n(er)f(co)r(de)h(is)h
(k)n(ept)f(in)h Fx(hw/TmrSrv.h)23 b Fz(and)28 b Fx(hw/TmrSrv.C)p
Fz(.)515 3271 y Fk(h)p Fj(TmrSrv.h*)11 b Fk(i)p Fq(\021)598
3362 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3454 y Fi(#ifndef)41
b(__OFF_TMR_SRV_H)598 3545 y(#define)g(__OFF_TMR_SRV_H)h(1)598
3728 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(dep)l(endencies.)g
Fk(i)598 3910 y Fi(#ifdef)40 b(__KERNEL__)598 4002 y
Fk(h)p Fj(O\013)27 b(timer)h(server.)h Fk(i)598 4093
y Fi(#endif)40 b(//)g(__KERNEL__)598 4367 y(#ifdef)g(__KERNEL__)598
4458 y(//)f(Timer)i(server)f(inline)h(methods)598 4550
y(//)598 4641 y Fk(h)p Fi(off)p 750 4641 V 29 w(TmrSrv::get)p
1208 4641 V 30 w(allocator)30 b Fj(implementation.)d
Fk(i)598 4732 y(h)p Fi(off)p 750 4732 V 29 w(TmrSrv::is)p
1169 4732 V 30 w(local)i Fj(implementation.)e Fk(i)598
4824 y(h)p Fi(off)p 750 4824 V 29 w(TmrSrv::operator+)k
Fj(implementation.)c Fk(i)598 4915 y Fi(#endif)40 b(//)g(__KERNEL__)598
5006 y(#endif)g(//)g(__OFF_TMR_SRV_H)1885 5255 y Fz(411)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
412 413 bop 515 523 a Fk(h)p Fj(TmrSrv.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/TmrSrv.h>)395 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(timer)h(server)h(implementation)f(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(timer)h(server)h(static)g
(memb)l(ers.)f Fk(i)598 1254 y(h)p Fi(off)p 750 1254
24 4 v 29 w(TmrSrv::off)p 1208 1254 V 30 w(TmrSrv)h Fj(implementation.)
f Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(TmrSrv::start)i
Fj(implementation.)d Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(TmrSrv::alloc)j Fj(and)e Fi(free)g Fj(implementation.)g
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(TmrSrv::get)p
1208 1528 V 30 w(url)g Fj(implementation.)g Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(TmrSrv::nameof)i
Fj(implementation.)e Fk(i)598 1710 y(h)p Fi(off)p 750
1710 V 29 w(TmrSrv::expired)i Fj(implementation.)e Fk(i)598
1802 y(h)p Fi(off)p 750 1802 V 29 w(TmrSrv::activate)j
Fj(implementation.)c Fk(i)598 1893 y(h)p Fi(off)p 750
1893 V 29 w(TmrSrv::clock)p 1286 1893 V 31 w(handler)i
Fj(implementation.)e Fk(i)598 1984 y(h)p Fi(off)p 750
1984 V 29 w(TmrSrv::alloc)p 1286 1984 V 31 w(pclk)h Fj(implementation.)
g Fk(i)598 2076 y(h)p Fi(off)p 750 2076 V 29 w(TmrSrv::operator<<)j
Fj(implementation.)d Fk(i)639 2399 y Fz(Timers)f(are)g(k)n(ept)g(in)h
Fx(hw/Tmr.h)d Fz(and)i Fx(hw/Tmr.C)p Fz(.)515 2532 y
Fk(h)p Fj(Tmr.h*)11 b Fk(i)o Fq(\021)598 2623 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 2715 y Fi(#ifndef)41 b(__OFF_TMR_H)598
2806 y(#define)g(__OFF_TMR_H)g(1)598 2989 y Fk(h)p Fj(O\013)27
b(timer)h(dep)l(endencies.)h Fk(i)598 3171 y(h)p Fj(O\013)e(timer)h
(\015ags.)g Fk(i)598 3354 y Fi(#ifdef)40 b(__KERNEL__)598
3445 y Fk(h)p Fj(O\013)27 b(timer.)g Fk(i)598 3537 y
Fi(#endif)40 b(//)g(__KERNEL__)598 3811 y(#ifdef)g(__KERNEL__)598
3902 y(//)f(Timer)i(inline)f(methods)598 3993 y(//)598
4085 y Fk(h)p Fi(off)p 750 4085 V 29 w(Tmr::is)p 1052
4085 V 29 w(periodic)30 b Fj(implementation.)d Fk(i)598
4176 y(h)p Fi(off)p 750 4176 V 29 w(Tmr::get)p 1091 4176
V 30 w(irqline)i Fj(implementation.)e Fk(i)598 4267 y(h)p
Fi(off)p 750 4267 V 29 w(Tmr::get)p 1091 4267 V 30 w(ticks)h
Fj(implementation.)g Fk(i)598 4359 y(h)p Fi(off)p 750
4359 V 29 w(Tmr::get)p 1091 4359 V 30 w(rticks)g Fj(implementation.)g
Fk(i)598 4450 y Fi(#endif)40 b(//)g(__KERNEL__)598 4541
y(#endif)g(//)g(__OFF_TMR_H)1885 5255 y Fz(412)p eop
PStoPSsaved restore
%%Page: (414,415) 208
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
413 414 bop 515 523 a Fk(h)p Fj(Tmr.C*)11 b Fk(i)o Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 888 y Fi(#include)41 b(<hw/Tmr.h>)394
b(//)40 b(Exported)h(interface.)598 980 y Fk(h)p Fj(O\013)27
b(timer)h(implementation)g(dep)l(endencies.)h Fk(i)598
1162 y(h)p Fj(O\013)e(timer)h(static)h(memb)l(ers.)f
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 24 4 v 29 w(Tmr::off)p
1091 1345 V 30 w(Tmr)g Fj(implementation.)f Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(Tmr::operator)42
b(new)28 b Fj(implementation.)f Fk(i)598 1528 y(h)p Fi(off)p
750 1528 V 29 w(Tmr::operator)42 b(delete)29 b Fj(implementation.)e
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(Tmr::get)p
1091 1619 V 30 w(url)p 1238 1619 V 29 w(holder)h Fj(implementation.)g
Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w(Tmr::activate)i
Fj(implementation.)d Fk(i)639 1943 y Fz(The)19 b(timer)f(allo)r(cator)f
(can)h(b)r(e)g(found)h(in)g Fx(hw/TmrAllocator.)o(h)12
b Fz(and)18 b Fx(hw/TmrAllocator.C)o Fz(.)515 2076 y
Fk(h)p Fj(TmrA)n(l)t(lo)l(c)l(ator.h*)11 b Fk(i)p Fq(\021)598
2167 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2258 y Fi(#ifndef)41
b(__OFF_TMR_ALLOCATOR_H)598 2350 y(#define)g(__OFF_TMR_ALLOCATOR_H)j(1)
598 2532 y Fk(h)p Fj(O\013)27 b(timer)h(al)t(lo)l(c)l(ator)g(dep)l
(endencies.)i Fk(i)598 2715 y Fi(#ifdef)40 b(__KERNEL__)598
2806 y Fk(h)p Fj(O\013)27 b(linkable)g(timer.)h Fk(i)598
2897 y(h)p Fj(O\013)f(timer)h(al)t(lo)l(c)l(ator.)g Fk(i)598
2989 y Fi(#endif)40 b(//)g(__KERNEL__)598 3263 y(#ifdef)g(__KERNEL__)
598 3354 y(//)f(Timer)i(allocator)g(inline)g(methods)598
3445 y(//)598 3537 y Fk(h)p Fi(off)p 750 3537 V 29 w
(TmrAllocator::operator)j(+)27 b Fj(implementation.)h
Fk(i)598 3628 y Fi(#endif)40 b(//)g(__KERNEL__)598 3811
y(#endif)g(//)g(__OFF_TMR_ALLOCATOR_H)515 3985 y Fk(h)p
Fj(TmrA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)p Fq(\021)598
4076 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 4259 y Fi(#include)41
b(<hw/TmrAllocator.h>)396 b(//)40 b(Exported)h(interface.)598
4442 y Fk(h)p Fj(O\013)27 b(timer)h(al)t(lo)l(c)l(ator)g(static)h(memb)
l(ers.)f Fk(i)598 4624 y(h)p Fi(off)p 750 4624 V 29 w
(TmrAllocator::off)p 1442 4624 V 32 w(TmrAllocator)i
Fj(implementation.)d Fk(i)1885 5255 y Fz(413)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
414 415 bop 515 523 a Fn(4.4.10)112 b(Timers)36 b(for)i(ix86)e(based)j
(arc)m(hitectures)515 676 y Fz(On)g(In)n(tels,)j(the)d(mac)n(hine)g
(dep)r(enden)n(t)h(part)f(of)g(the)g(timer)g(serv)n(er)f(is)h(resp)r
(onsible)f(to)515 776 y(handle)30 b(the)g(programmable)e(in)n(terv)-5
b(al)29 b(timer)h(\(PIT\))h(c)n(hipset.)44 b(Th)n(us,)30
b(it)h(allo)r(cates)e(PIT)515 876 y(IO)e(p)r(orts)g(and)h(the)g(actual)
f(clo)r(c)n(k)f(in)n(terrupt.)515 1008 y Fk(h)p Fj(O\013)h(machine)h
(dep)l(endent)h(timer)f(server.)h Fk(i)p Fq(\021)598
1100 y Fi(//)39 b(An)h(ix86)g(timer)h(server)598 1191
y(//)598 1282 y(class)f(off_mdepTmrSrv)j({)598 1374 y(public:)676
1465 y(static)e(natural_t)g(get_ntmrs\(void\))82 b({)39
b(return)i(OFF_MDEP_NVINT_MAX;)j(})676 1556 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
1556 24 4 v 29 w(mdepTmrSrv)p Fj(.)i Fk(i)598 1648 y
Fi(};)515 1913 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h(timer)f
(server)i(dep)l(endencies.)f Fk(i)p Fq(\021)598 2005
y Fi(#include)41 b(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 2096 y(#include)h(<klib/limits.h>)639
2237 y Fz(PIT)27 b(is)h(initialized)g(when)f(the)h(mac)n(hine)g(dep)r
(enden)n(t)g(serv)n(er)e(is)h(started.)515 2353 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2353
V 29 w(mdepTmrSrv)p Fj(.)i Fk(i)p Fq(\021)598 2445 y
Fi(//)39 b(Starts)i(the)f(PIT)598 2536 y(//)f(Interrupts)j(must)e(be)g
(cleared!)598 2627 y(static)g(void)g(start\(natural_t)j(hz\);)515
2785 y Fk(h)p Fi(off)p 667 2785 V 29 w(mdepTmrSrv::start)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 2876 y Fi(//)39
b(Starts)i(the)f(PIT)598 2968 y(void)g(off_mdepTmrSrv::start\(natural_)
q(t)45 b(hz\))598 3059 y({)676 3150 y(//)40 b(XXX)g(use)g(APIC)g
(instead)h(for)f(SMP.)676 3242 y({)755 3333 y(off_io_id_t)h
(io\(nd.get_iobank\(0\).get_id\()q(\),PIT)q(CTL_)q(PORT\))q(;)755
3424 y(new\(&nd.get_iobank\(0\),io\))833 3516 y
(off_IOPort\(nd.get_proc\(0\).get)q(_tmr)q(\(\).g)q(et_pr)q(otec)q
(tion\()q(\),)1265 3607 y(nd.get_proc\(0\).get_tmr\(\).get_do)q(main)q
(\(\)\);)676 3698 y(})676 3790 y({)755 3881 y(off_io_id_t)g
(io\(nd.get_iobank\(0\).get_id\()q(\),PIT)q(CTR0)q(_PORT)q(\);)755
3972 y(new\(&nd.get_iobank\(0\),io\))833 4064 y
(off_IOPort\(nd.get_proc\(0\).get)q(_tmr)q(\(\).g)q(et_pr)q(otec)q
(tion\()q(\),)1265 4155 y(nd.get_proc\(0\).get_tmr\(\).get_do)q(main)q
(\(\)\);)676 4246 y(})676 4338 y(init_pit\(hz\);)598
4429 y(})1885 5255 y Fz(414)p eop
PStoPSsaved restore
%%Page: (416,417) 209
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
415 416 bop 639 523 a Fz(T)-7 b(o)34 b(fully)g(supp)r(ort)g(SMP)g
(systems,)h(this)f(implemen)n(tation)h(has)e(to)h(b)r(e)g(c)n(hanged)f
(to)515 623 y(program)26 b(the)k(lo)r(cal)e(APIC)g(instead)h(and)g(a)f
(timer)h(serv)n(er)e(p)r(er)h(pro)r(cessor)f(m)n(ust)i(b)r(e)g(cre-)515
722 y(ated.)515 855 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h(timer)
f(server)i(implementation)e(dep)l(endencies.)p Fk(i)q
Fq(\021)598 946 y Fi(#include)41 b(<hw/IOBank.h>)598
1038 y(#include)g(<hw/IOPort.h>)598 1129 y(#include)g(<node/Node.h>)598
1220 y(#include)g(<hw/Processor.h>)278 b(//)40 b(for)g(clri)g(seti)g
(et)g(al.)598 1312 y(#include)h(<flux/machine/pc/pic.h>)j(//)c(for)g
(PIC)g(settings)598 1403 y(#include)h(<flux/machine/pc/pit.h>)j(//)c
(for)g(PIT)g(settings)515 1660 y FA(Mac)m(hine)32 b(dep)s(enden)m(t)f
(timer)f Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
1814 y Fz(Mac)n(hine)27 b(dep)r(enden)n(t)h(timers)f(are)g(k)n(ept)h
(in)f Fx(mdep/mTmrSrv.h)22 b Fz(and)28 b Fx(mdep/mTmrSrv.C)p
Fz(.)515 1946 y Fk(h)p Fj(mdep)f(mTmrSrv.h*)11 b Fk(i)q
Fq(\021)598 2038 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2129 y Fi(#ifndef)41
b(__OFF_MDEP_TMR_SRV_H)598 2220 y(#define)g(__OFF_MDEP_TMR_SRV_H)i(1)
598 2403 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(timer)f
(server)i(dep)l(endencies.)f Fk(i)598 2586 y Fi(#ifdef)40
b(__KERNEL__)598 2677 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(timer)f(server.)h Fk(i)598 2768 y Fi(#endif)40 b(//)g(__KERNEL__)598
2951 y(#endif)g(//)g(__OFF_MDEP_TMR_SRV_H)515 3125 y
Fk(h)p Fj(mdep)27 b(mTmrSrv.C*)11 b Fk(i)p Fq(\021)598
3217 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3399 y Fi(#include)41
b(<hw/mdep/mTmrSrv.h>)161 b(//)40 b(Exported)h(interface)598
3491 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(timer)f(server)i
(implementation)e(dep)l(endencies.)p Fk(i)598 3673 y(h)p
Fi(off)p 750 3673 24 4 v 29 w(mdepTmrSrv::start)j Fj(implementation.)c
Fk(i)1885 5255 y Fz(415)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
416 417 bop 515 523 a Fr(4.5)135 b(DMA)44 b(lines)515
705 y Fx(DMA)33 b Fz(ob)5 b(jects)33 b(are)g(used)h(to)g(allo)r(cate)f
Fx(DMALine)p Fz(s.)53 b(Note)34 b(that)g(DMA)h(lines)f(are)f(k)n(ept)h
(in)515 805 y(the)24 b(k)n(ernel)f(although)g(they)h(could)f(ha)n(v)n
(e)g(b)r(een)h(considered)f(to)g(b)r(e)h(a)g(device)f(\(and)h(k)n(ept)g
(in)515 904 y(userland\).)41 b(The)29 b(reason)e(is)j(e\016ciency)-7
b(,)29 b(b)r(ecause)g(w)n(e)g(do)f(not)i(w)n(an)n(t)e(protection)g
(domain)515 1004 y(crossings)21 b(just)k(to)e(program)f(a)h(DMA)i
(line.)36 b(Also,)24 b(w)n(e)f(b)r(eliev)n(e)h(that)g(no)f
(\015exibilit)n(y)h(is)f(lost)515 1103 y(b)n(y)k(placing)g(this)h
(small)f(piece)h(of)f(co)r(de)h(in)n(to)f(the)h(k)n(ernel.)515
1231 y Fk(h)p Fj(O\013)f(DMA)g(table.)h Fk(i)p Fq(\021)598
1322 y Fi(//)39 b(Allocation)j(of)e(DMA)g(lines)598 1413
y(class)g(off_DMA:)h(public)g(off_HWCompResource)i({)598
1505 y(public:)676 1596 y(//)d(Allocates)h(n)f(DMA)g(lines.)676
1687 y(off_DMALine)i(*alloc\(off_Protection)i(*prot,natural_t)f(n=1,)
1422 1779 y(off_dma_id_t)e(at=OFF_EU_ID_NULL)j(\);)676
1870 y(//)c(Deallocates)i(the)e(n)f(contiguous)i(DMA)f(lines)h
(starting)g(at)e(d.)676 1961 y(void)h(free\()h(off_DMALine)g(*d,)f
(natural_t)i(n=1)e(\);)676 2053 y(//Gets)h(a)e(DMA)h(line)g(from)g(its)
80 b(number.)676 2144 y(off_DMALine)42 b(*operator)f([]\(natural_t)h
(n\))e(const;)676 2327 y(//)g(Starts)g(operation)i(in)d(this)i(memory)f
(bank.)676 2418 y(err_t)h(start\(const)g(off_mdepDMA)h(&dmainfo\);)598
2601 y(};)722 2806 y FA(NOTE:)27 b Fz(XXX)i(m)n(ust)e(pro)n(vide)g
Fx(off)p 1905 2806 27 4 v 30 w(DMA::off)p 2287 2806 V
28 w(DMA\(void\))p Fz(.)722 2975 y FA(NOTE:)18 b Fz(XXX)h(implemen)n(t)
g Fx(off)p 1784 2975 V 30 w(mdepDMA)d Fz(see)i Fx(off)p
2395 2975 V 30 w(mdepNode::get)p 2997 2975 V 26 w(dmainfo)722
3074 y Fz(implemen)n(tation)28 b(in)g(no)r(de.n)n(w)f(for)g(metho)r(ds)
h(used.)639 3243 y(DMA)e(lines)f(are)f(v)n(ery)g(not)i(w)n(ell)e(mo)r
(deled,)i(instead)f(w)n(e)g(pro)n(vided)f(a)h(mo)r(del)g(of)g(DMA)515
3343 y(prett)n(y)32 b(close)g(to)g(that)h(of)f(In)n(tel)h(based)f(mac)n
(hines.)51 b(F)-7 b(uture)33 b Fy(O\013)50 b Fz(p)r(ortings)32
b(to)g(di\013eren)n(t)515 3442 y(arc)n(hitectures)26
b(should)h(pro)n(vide)g(feedbac)n(k)g(on)g(ho)n(w)g(should)g(DMA)i
(lines)e(b)r(e)h(mo)r(deled.)515 3570 y Fk(h)p Fj(O\013)f(DMA)g(line.)g
Fk(i)o Fq(\021)598 3661 y Fi(typedef)41 b(off_mode_t)g(dma_mode_t;)598
3752 y(class)f(off_DMAline:)i(public)f(off_HWResUnit)h({)598
3844 y(public:)715 3935 y(//)e(Enables/disables)j(this)d(dma)g(line.)
715 4026 y(void)h(enable\(void\);)715 4118 y(void)g(disable\(void\);)
715 4209 y(//)f(Programs)h(a)f(DMA)g(operation.)715 4300
y(void)h(program\(off_pg_id_t)i(addr,)d(vm_offset_t)i(length,)f
(dma_mode_t)h(mode\);)715 4392 y(//)e(Gets)g(#)g(of)f(copied)i(or)f
(pending)g(bytes.)715 4483 y(vm_offset_t)i(get_copied\(void\);)715
4574 y(vm_offset_t)g(get_pending\(void\);)598 4666 y(};)515
4801 y Fz(where)515 4915 y Fk(h)p Fj(O\013)27 b(DMA)g(line)g(mo)l(de)h
(data)h(typ)l(e.)f Fk(i)p Fq(\021)598 5006 y Fi(typedef)41
b(natural_t)g(dma_mode_t;)1885 5255 y Fz(416)p eop
PStoPSsaved restore
%%Page: (418,419) 210
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
417 418 bop 515 523 a Fn(4.5.1)112 b(DMA)37 b(lines)g(for)g(plain)g
(users)515 676 y Fz(DMA)28 b(related)f(wrapp)r(ers)g(are)f(straigh)n
(tforw)n(ard.)515 796 y Fk(h)p Fj(O\013)h(DMA)g(table)h(for)g(users.)g
Fk(i)p Fq(\021)598 887 y Fi(ENTRY)40 b(class)g(off_uDMA)i(:)d(public)i
(off_uHWCompResource)i({)598 979 y(public:)637 1070 y(off_uDMALine)f
(*alloc\(off_Protection)i(*prot,)1422 1161 y(natural_t)d(n=1,)f
(off_dma_id_t)i(at=OFF_EU_ID_NULL\);)637 1253 y(void)e
(free\(off_uDMALine)j(*pf,)d(const)h(off_Rights)g(&r,)f(natural_t)h
(n=1)f(\);)637 1344 y(off_uDMALine)i(*fetch\(off_dma_id_t)h(d,const)e
(off_Rights)h(&r\))e(const;)598 1435 y(};)515 1584 y
Fk(h)p Fj(O\013)27 b(DMA)g(line)g(for)h(users.)g Fk(i)p
Fq(\021)598 1675 y Fi(ENTRY)40 b(class)g(off_uDMALine)i(:)e(public)g
(off_uHWResUnit)j({)598 1766 y(public:)715 1858 y(//)d
(Enables/disables)j(this)d(dma)g(line.)715 1949 y(void)h(enable\(const)
h(off_Rights)f(&r\);)715 2040 y(void)g(disable\(const)h(off_Rights)f
(&r\);)715 2132 y(//)f(Programs)h(a)f(DMA)g(operation.)715
2223 y(void)h(program\(off_pg_id_t)i(addr,)d(vm_offset_t)i(length,)f
(dma_mode_t)h(mode,)912 2314 y(const)e(off_Rights)h(&r\);)715
2406 y(//)f(Gets)g(#)g(of)f(copied)i(or)f(pending)g(bytes.)715
2497 y(vm_offset_t)i(get_copied\(void,const)i(off_Rights)e(&r\);)715
2588 y(vm_offset_t)g(get_pending\(void,const)i(off_Rights)e(&r\);)598
2680 y(};)515 2977 y Fr(4.6)135 b(Pro)t(cessors)722 3159
y FA(NOTE:)29 b Fz(Include)h(priorit)n(y)f(lev)n(els.)43
b(Note)30 b(that)g(eac)n(h)f(pro)r(cessor)f(m)n(ust)i(act)722
3258 y(as)25 b(a)f(referee)g(for)h(in)n(terrupt)g(priorities.)35
b(That)25 b(means)f(that)h(no)g(new)g(sh)n(uttle)722
3358 y(can)30 b(honor)e(a)i(priorit)n(y)e(lev)n(el)h(lo)n(w)n(er)f
(than)i(the)g(lo)n(w)n(est)f(in)n(terrupt....)43 b(Think)722
3458 y(ab)r(out)28 b(it.)639 3608 y(A)g(pro)r(cessor)e(is)h(a)g(comp)r
(osite)h(hardw)n(are)d(resource)h(whic)n(h)h(allo)r(cates)g(time)h
(slices.)515 3728 y Fk(h)p Fj(O\013)f(pr)l(o)l(c)l(essor.)j
Fk(i)p Fq(\021)598 3819 y Fi(//)39 b(A)h(processor.)598
3910 y(//)598 4002 y(class)g(off_Processor)i(:)e(public)g
(off_HWCompResource)k({)598 4093 y(public:)676 4184 y(//)c(Returns)h(a)
e(pointer)i(to)f(the)g(time)g(slice)g(allocator.)676
4276 y(virtual)h(off_RqAllocator)i(*get_allocator\(void\);)676
4458 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4458 24 4 v 29 w(Processor)p Fj(.)i Fk(i)598
4550 y Fi(protected:)676 4641 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 4641 V 29 w(Processor)p
Fj(.)i Fk(i)598 4732 y Fi(private:)676 4824 y(off_RqAllocator)43
b(p_alloc;)237 b(//)40 b(Time)g(slice)g(allocator.)676
4915 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4915 V 29 w(Processor)p Fj(.)i Fk(i)598
5006 y Fi(};)1885 5255 y Fz(417)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
418 419 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Processor::get)p 1242 523 V 31 w(allocator)29 b
Fj(implementation.)f Fk(i)p Fq(\021)598 614 y Fi(inline)40
b(off_RqAllocator)j(*off_Processor::get_allocator)q(\(void)q(\))i({)676
706 y(assert\(valid\(\)\);)e(return)e(&p_alloc;)598 797
y(})639 925 y Fz(Being)g(a)h(sub)r(class)e(of)i Fx(CompResource)37
b Fz(w)n(e)k(m)n(ust)h(implemen)n(t)g Fx(make)p 2939
925 27 4 v 30 w(available)p Fz(.)515 1025 y(This)c(metho)r(d)g(do)r(es)
g(not)g(ha)n(v)n(e)f(sense)g(for)h(run)g(queue)g(slots)f(th)n(us)h(it)h
(simply)f(returns)515 1125 y(an)27 b(error)f(co)r(de)998
1094 y Fp(7)1035 1125 y Fz(.)515 1245 y Fk(h)p Fj(Other)i(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1245 24 4 v 29 w(Processor)p
Fj(.)i Fk(i)p Fq(\021)598 1336 y Fi(//)39 b(We)h(may)g(wish)g(to)g
(cache)g(a)g(resource)h(unit.)598 1427 y(//)e(Returns)i(error)g(code)f
(if)f(the)h(resource)h(is)f(not)g(available.)h(Zero)g(otherwise.)598
1519 y(err_t)f(make_available\(off_id_t)45 b(&u\))39
b({)676 1610 y(\(void\)u;)676 1701 y(return)i(EINVAL;)598
1793 y(})598 1884 y(boolean_t)g(is_local\(off_id_t)i(&u\){)676
1975 y(\(void\)u;)676 2066 y(return)e(TRUE;)598 2158
y(})515 2306 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(dep)l
(endencies.)f Fk(i)p Fq(\021)598 2398 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 2489 y(#include)h(<klib/ids.h>)434 b(//)40 b(for)g(natural_t)h
(et)f(al.)598 2580 y(#include)h(<klib/HWCompResource.h>)j(//)c(for)g
(off_HWCompResource)598 2672 y(#include)h(<klib/err.h>)473
b(//)40 b(for)g(err_t)598 2763 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 2854 y(#include)h(<klib/Magic.h>)395
b(//)40 b(for)g(magic)g(numbers)598 2946 y(#include)h
(<hw/RqAllocator.h>)239 b(//)40 b(for)g(off_RqAllocator)639
3074 y Fz(Initially)-7 b(,)28 b(pro)r(cessors)d(are)i(created)g(with)h
(default)g(v)-5 b(alues)27 b(for)g(its)h(mem)n(b)r(ers.)515
3184 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3184 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
3275 y Fi(off_Processor\(void\))43 b(:)676 3367 y
(off_HWCompResource\(off_Prote)q(ction)q(\(\),O)q(FF_P)q(RTL_N)q(ULL,)
1422 3458 y(OFF_ID_NULL,)e(OFF_MAGIC_PROC\),)676 3549
y Fk(h)p Fj(Initialize)27 b Fi(p)p 1072 3549 V 28 w(alloc)p
Fj(.)h Fk(i)p Fi(,)676 3640 y Fk(h)p Fj(Initialize)f(other)i(aggr)l(e)l
(gate)h(memb)l(ers)e(of)g Fi(off)p 2090 3640 V 29 w(Processor)p
Fj(.)h Fk(i)598 3732 y Fi({;})639 3850 y Fz(W)-7 b(e)28
b(m)n(ust)g(de\014ne)g(the)g(new)f(magic)g(n)n(um)n(b)r(er)h(used)f(b)r
(efore.)515 3960 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)i
Fk(i)p Fq(\021)598 4051 y Fi(OFF_MAGIC_PROC,)42 b(//)e(Processor)h
(magic)g(nb.)639 4169 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e
(case)h(to)h(the)g(implemen)n(tation)f(of)h Fx(Magic::nameof)p
Fz(.)515 4279 y Fk(h)p Fi(off)p 667 4279 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 4279 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 4370 y Fi(case)40 b(OFF_MAGIC_PROC:)676
4462 y(return)h("off_Processor";)639 4580 y Fz(Pro)r(cessor)25
b(users)i(can)g(c)n(hec)n(k)g(their)g(references)g(to)g(pro)r(cessors)e
(using)j(this)g(metho)r(d.)515 4690 y Fk(h)p Fj(Other)g(public)g(metho)
l(ds)h(of)e Fi(off)p 1493 4690 V 29 w(Processor)p Fj(.)i
Fk(i)p Fz(+)o Fq(\021)598 4781 y Fi(//)39 b(Does)i(this)f(look)g(like)g
(a)f(Processor?)598 4872 y(boolean_t)i(valid\(void\))h(const)e({)g
(return)g(get_magic\(\))i(==)e(OFF_MAGIC_PROC;)i(})p
515 4929 1146 4 v 607 4983 a Fm(7)642 5006 y Fl(Al)23
b(alternate)i(implemen)n(tation)e(could)h(allo)r(cate)g(an)g(idle)g
(slot)f(and)i(set)f(it)f(up)h(instead.)1885 5255 y Fz(418)p
eop
PStoPSsaved restore
%%Page: (420,421) 211
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
419 420 bop 639 523 a Fz(After)28 b(instan)n(tiation,)f
Fx(start)f Fz(should)h(b)r(e)h(used)g(to)f(start)g(pro)r(cessor)f(op)r
(eration.)515 635 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 635 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 727 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f
(this)g(processor.)598 818 y(err_t)g(start\()h(const)f
(off_mdepProcessor)j(&mdep,)e(const)f(off_id_t)h(&id)f(\);)515
964 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(dep)l(endencies.)f
Fk(i)p Fz(+)p Fq(\021)598 1055 y Fi(#include)41 b
(<hw/mdep/mProcessor.h>)j(//)c(for)g(off_mdepProcessor)515
1214 y Fk(h)p Fi(off)p 667 1214 V 29 w(Processor::start)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 1305 y Fi(//)39
b(Starts)i(normal)g(operation)g(for)f(this)g(processor.)598
1396 y(err_t)g(off_Processor::start\()k(const)c(off_mdepProcessor)k
(&mdep,)c(const)h(off_id_t)g(&id\))598 1488 y({)676 1579
y(assert\(valid\(\)\);)676 1670 y(set_id\(id\);)676 1853
y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)g(of)e Fi(off)p
1629 1853 V 29 w(Processor)i Fj(ac)l(c)l(or)l(ding)g(to)g
Fi(mdep)p Fj(.)e Fk(i)676 2035 y Fi(kcout<<)41 b("Proc)119
b(#"<<id<<)41 b(fmt\(")f(\(\045d)g(slots\))h(",get_nslots\(\)\)<<)i
("started."<<)f(nl;)676 2218 y({)755 2309 y(extern)e(int)g
(morecore_debug;)755 2401 y(morecore_debug=1;)676 2492
y(})676 2675 y Fk(h)p Fj(Start)29 b(id)t(le)e(shuttle.)i
Fk(i)676 2766 y Fi(return)41 b(EOK;)598 2949 y(})515
3199 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(implementation)e(dep)l
(endencies.)h Fk(i)p Fq(\021)598 3290 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 3381 y(#include)h
(<klib/str.h>)434 b(//)40 b(for)g(kcout.)639 3514 y Fz(Here)28
b(w)n(e)f(used)g Fx(get)p 1284 3514 27 4 v 31 w(nslots)e
Fz(to)i(return)h(the)g(maxim)n(um)f(n)n(um)n(b)r(er)g(of)h(time)g
(slices.)37 b(It)515 3614 y(is)27 b(a)g(system)h(limit)g(as)f(w)n(e)g
(will)h(see)f(later.)515 3726 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3726 24 4 v 29 w(Processor)p Fj(.)i
Fk(i)p Fz(+)o Fq(\021)598 3818 y Fi(//)39 b(Returns)i(the)f(max.)g
(number)h(of)f(ts.)598 3909 y(natural_t)h(get_nslots\(void\))i(const)d
({)g(return)g(OFF_NRQS_MAX;)i(})639 4029 y Fz(A)22 b(new)g(mem)n(b)r
(er,)h Fx(m)p 1274 4029 27 4 v 31 w(mdep)d Fz(will)i(store)e(the)j(b)r
(o)r(ot)e(time)i(information,)f(whic)n(h)f(is)h(needed)515
4129 y(b)r(ecause)27 b(it)h(pro)n(vides)e(common)h(information)g
(useful)h(to)g(pro)r(cessor)d(users.)515 4241 y Fk(h)p
Fj(Other)j(private)h(memb)l(ers)f(of)g Fi(off)p 1552
4241 24 4 v 29 w(Processor)p Fj(.)h Fk(i)o Fq(\021)598
4333 y Fi(off_mdepProcessor)121 b(p_mdep;)355 b(//)40
b(Mach.)g(dep.)g(information)515 4478 y Fk(h)p Fj(Start)29
b(other)g(memb)l(ers)f(of)f Fi(off)p 1467 4478 V 29 w(Processor)j
Fj(ac)l(c)l(or)l(ding)f(to)f Fi(mdep)p Fj(.)g Fk(i)p
Fq(\021)598 4570 y Fi(p_mdep=mdep;)639 4703 y Fz(Initially)-7
b(,)34 b(b)r(efore)e(the)g(pro)r(cessor)e(is)i(started)g(it)h(is)f
(initialized)g(with)h(default)f(v)-5 b(alues)515 4803
y(for)27 b(the)h(b)r(o)r(ot)g(pro)r(cessor.)515 4915
y Fk(h)p Fj(Initialize)e(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 4915 V 29 w(Processor)p Fj(.)i Fk(i)p Fq(\021)598
5006 y Fi(p_mdep\(0\),)1885 5255 y Fz(419)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
420 421 bop 639 523 a Fz(Some)35 b(pro)r(cessor)f(initialization)h(m)n
(ust)g(b)r(e)h(done)f(b)n(y)g(the)h(pro)r(cessor)d(itself.)60
b(Th)n(us,)515 623 y(ev)n(ery)35 b(pro)r(cessor)g(supplies)h(a)h(metho)
r(d)g Fx(self)p 2010 623 27 4 v 30 w(start)e Fz(to)h(b)r(e)h(called)g
(b)n(y)f(the)h(pro)r(cessor)515 722 y(itself.)515 846
y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 846 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 938 y Fi(//)39 b(Completes)j(\(self\))e(initialization.)598
1029 y(void)g(self_start\(void\);)639 1161 y Fz(Namely)-7
b(,)42 b(the)d Ft(dmm)f Fz(and)h(the)f(sh)n(uttle)h(serv)n(er)e(migh)n
(t)i(use)f(or)g(set)g(some)g(mac)n(hine)515 1261 y(dep)r(enden)n(t)28
b(pro)r(cessor)d(state)j(to)f(get)h(sh)n(uttles)f(and)h
Ft(dtlb)p Fz(s)f(op)r(erational.)515 1385 y Fk(h)p Fi(off)p
667 1385 V 29 w(Processor::self)p 1281 1385 V 31 w(start)i
Fj(implementation.)e Fk(i)p Fq(\021)598 1476 y Fi(//)39
b(Completes)j(\(self\))e(initialization.)598 1567 y(void)g
(off_Processor::self_start\(void)q(\))598 1659 y({)676
1750 y(if)g(\(off_DMM::is_active\(\)\))755 1841 y(dmm.self_start\(\);)
676 1933 y(shtl.self_start\(\);)676 2024 y(start_clk\(\);)676
2115 y(seti\(\);)598 2207 y(})639 2522 y Fz(T)-7 b(o)34
b(\014nd)h(the)f(curren)n(t)g(pro)r(cessor)e(when)i(SMP)g(supp)r(ort)g
(is)h(enabled,)g Fx(self)e Fz(alw)n(a)n(ys)515 2621 y(returns)23
b(a)g(p)r(oin)n(ter)h(to)f(the)i(curren)n(t)d(pro)r(cessor.)34
b(It)24 b(is)g(a)f(mac)n(hine)h(dep)r(enden)n(t)g(op)r(eration.)515
2745 y Fk(h)p Fj(Other)k(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2745 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
2837 y Fi(//)39 b(Returns)i(the)f(current)h(processor)598
2928 y(static)f(off_Processor)j(*self\(void\);)515 3085
y Fk(h)p Fi(off)p 667 3085 V 29 w(Processor::self)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 3176 y Fi(//)39
b(Returns)i(the)f(current)h(processor)598 3267 y(off_Processor)h
(*off_Processor::self\(void\))598 3359 y({)676 3450 y(return)f
(&nd.get_proc\(off_mdepProcessor)q(::ge)q(t_pro)q(c_id)q(\(\)\);)598
3541 y(})515 3698 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
3789 y Fi(#include)41 b(<node/Node.h>)639 3921 y Fz(Finally)-7
b(,)27 b(as)e(w)n(e)h(said)f(when)h(w)n(e)g(discussed)g(traps)f(and)h
(in)n(terrupts,)g(eac)n(h)f Fx(Processor)515 4021 y Fz(con)n(tains)h(a)
i(couple)f(of)g(ev)n(en)n(t)g(tables,)h(one)f(for)g(traps)g(and)g
(another)g(one)g(for)g(in)n(terrupts.)515 4145 y Fk(h)p
Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p 1552
4145 V 29 w(Processor)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598
4236 y Fi(off_TrapTbl)41 b(p_traps;)473 b(//)40 b(Processor)h(trap)f
(table.)598 4328 y(off_IntTbl)80 b(p_irqs;)512 b(//)40
b(Processor)h(interrupt)g(table.)515 4484 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor)j(dep)l(endencies.)f Fk(i)p Fz(+)p
Fq(\021)598 4576 y Fi(#include)41 b(<hw/EventTbl.h>)317
b(//)40 b(for)g(off_TrapTbl,)i(off_IntTbl)f(et)f(al.)515
4732 y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)f(of)f
Fi(off)p 1467 4732 V 29 w(Processor)j Fj(ac)l(c)l(or)l(ding)f(to)f
Fi(mdep)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 4824 y Fi(new\(&p_traps\))42
b(off_TrapTbl\(this\);)598 4915 y(new\(&p_irqs\))g(off_IntTbl\(this\);)
1885 5255 y Fz(420)p eop
PStoPSsaved restore
%%Page: (422,423) 212
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
421 422 bop 639 523 a Fz(Notice)23 b(that)g(they)f(share)g(the)g(iden)n
(ti\014er)h(of)f(the)h(pro)r(cessor)e(they)h(are)g(in.)35
b(A)23 b(reference)515 623 y(to)k(suc)n(h)g(tables)h(can)f(b)r(e)h
(obtained.)515 756 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 756 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 847 y Fi(//)39 b(Return)i(a)e(reference)j(to)d(the)h
(trap/interrupt)j(event)d(tables.)598 938 y(off_TrapTbl)h
(*get_traps\(void\);)598 1029 y(off_IntTbl)80 b(*get_irqs\(void\);)639
1171 y Fz(They)28 b(simply)f(return)h(the)g(p)r(oin)n(ters)e(k)n(ept.)
515 1287 y Fk(h)p Fi(off)p 667 1287 V 29 w(Processor::get)p
1242 1287 V 31 w(traps)j Fj(and)f Fi(get)p 1763 1287
V 28 w(irqs)h Fj(implementation.)e Fk(i)p Fq(\021)598
1378 y Fi(//)39 b(Return)i(a)e(reference)j(to)d(the)h(trap/interrupt)j
(event)d(tables.)598 1469 y(inline)g(off_TrapTbl)i
(*off_Processor::get_traps\(voi)q(d\))j({)40 b(return)g(&p_traps;)i(})
598 1561 y(inline)e(off_IntTbl)81 b(*off_Processor::get_irqs\(void)q
(\))j({)40 b(return)g(&p_irqs;)h(})639 1685 y Fz(Another)19
b(couple)g(of)g(metho)r(ds)g(is)g(pro)n(vided)f(so)g(that)h(pro)r
(cessor)e(users)h(could)h(reference)515 1785 y(individual)h(traps)g
(and)g(in)n(terrupts)g(without)h(b)r(eing)f(a)n(w)n(are)f(of)h(trap)g
(and)g(in)n(terrupt)g(tables.)515 1901 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1901 V 29
w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 1993 y
Fi(off_Trap)41 b(*get_trap\(natural_t)i(t\);)598 2084
y(off_Irq)80 b(*get_irq\(natural_t)i(i\);)515 2242 y
Fk(h)p Fi(off)p 667 2242 V 29 w(Processor::get)p 1242
2242 V 31 w(trap)28 b Fj(and)g Fi(get)p 1723 2242 V 29
w(irq)g Fj(implementation.)g Fk(i)p Fq(\021)598 2333
y Fi(inline)40 b(off_Trap)h(*off_Processor::get_trap\(na)q(tural)q(_t)k
(t\))40 b({)676 2424 y(return)h(\(p_traps\)+t;)598 2516
y(})598 2607 y(inline)f(off_Irq)h(*off_Processor::get_irq\(natu)q
(ral_t)46 b(i\))40 b({)676 2698 y(return)h(\(p_irqs\)+i;)598
2790 y(})639 2931 y Fz(Sometimes)34 b(the)g(k)n(ernel)e(is)h(in)n
(terested)g(in)h(inhibiting/enabling)f(in)n(terrupts)g(in)h(the)515
3030 y(curren)n(t)26 b(pro)r(cessor,)g(some)g(static)i(metho)r(ds)f
(are)g(pro)n(vided)f(for)h(that)g(purp)r(ose.)37 b(Besides,)515
3130 y(the)28 b(pro)r(cessor)d(can)i(b)r(e)h(halted.)515
3263 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3263 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
3354 y Fi(//)39 b(Inhibits)i(interrupts.)598 3445 y(static)f(void)g
(clri\(void\);)598 3537 y(//)f(Enables)i(interrupts.)598
3628 y(static)f(void)g(seti\(void\);)598 3719 y(//)f(Are)h(interrupts)i
(enabled?)598 3811 y(static)e(boolean_t)i(has_clri\(void\))g(;)598
3902 y(//)d(Halts)i(the)f(processor.)598 3993 y(static)g(void)g
(halt\(void\);)1885 5255 y Fz(421)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
422 423 bop 639 523 a Fz(All)28 b(these)g(metho)r(ds)g(are)e(implemen)n
(ted)j(b)n(y)e(the)h(mac)n(hine)f(dep)r(enden)n(t)h(pro)r(cessor.)515
636 y Fk(h)p Fi(off)p 667 636 24 4 v 29 w(Processor::cli)i(sti)e(is)p
1495 636 V 29 w(cli)g Fj(and)g Fi(hlt)g Fj(implementation.)g
Fk(i)p Fq(\021)598 727 y Fi(//)39 b(Inhibits)i(interrupts.)598
818 y(inline)f(void)g(off_Processor::clri\(void\))163
b({)40 b(off_mdepProcessor::clri\(\);)45 b(})598 910
y(//)39 b(Enables)i(interrupts.)598 1001 y(inline)f(void)g
(off_Processor::seti\(void\))163 b({)40 b(off_mdepProcessor::seti\(\);)
45 b(})598 1092 y(//)39 b(Are)h(interrupts)i(enabled?)598
1184 y(inline)e(boolean_t)i(off_Processor::has_clri\(void\))85
b({)676 1275 y(return)41 b(off_mdepProcessor::has_clri\(\);)598
1366 y(})598 1458 y(//)e(Halts)i(the)f(processor.)598
1549 y(inline)g(void)g(off_Processor::halt\(void\))202
b({)40 b(off_mdepProcessor::halt\(\);)45 b(})515 1891
y Fn(4.6.1)112 b(Pro)s(cessor)37 b(registers)515 2044
y Fz(Pro)r(cessors)20 b(\(actually)j(mac)n(hine)f(dep)r(enden)n(t)i
(pro)r(cessors\))d(de\014ne)j(a)e(data)h(t)n(yp)r(e)g(to)g(repre-)515
2144 y(sen)n(t)k(the)g(pro)r(cessor)e(register)h(set.)37
b(Suc)n(h)27 b(data)f(t)n(yp)r(e)i(is)f(exp)r(orted)f(to)h
Fx(Processor)d Fz(users.)515 2243 y(The)31 b(mac)n(hine)g(indep)r
(enden)n(t)h(part)f(only)g(assumes)f(that)i(the)f(pro)r(cessor)f(has)g
(at)i(least)e(a)515 2343 y(program)25 b(coun)n(ter)i(and)g(a)h(stac)n
(k)e(p)r(oin)n(ter.)515 2572 y Fn(4.6.2)112 b(Sc)m(heduling)37
b(facilities)515 2726 y Fz(Pro)r(cessors)25 b(are)h(m)n(ultiplexed)j
(using)e(run)h(queues)f(of)h(pro)r(cessor)e(time)i(slices.)38
b(Eac)n(h)26 b(run)515 2825 y(queue)f(slot)h(has)f(an)h(iden)n
(ti\014er)f(corresp)r(onding)f(to)i(the)g(sh)n(uttle)g(whic)n(h)f
(should)h(run)g(in)g(it.)515 2951 y Fk(h)p Fj(O\013)h(run)h(queue)h
(slot.)e Fk(i)p Fq(\021)598 3042 y Fi(class)40 b(off_RunqSlot)i(:)e
(public)g(off_HWResUnit)i({)598 3134 y(public:)676 3225
y(//)e(Get/Set)h(the)f(shuttle)g(for)g(this)g(slot.)676
3316 y(inline)h(const)f(off_shtl_id_t)i(&get_shtl\(void\))h(const;)676
3408 y(inline)e(void)393 b(set_shtl\(const)42 b(off_shtl_id_t)h(&s\);)
676 3499 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3499 V 29 w(RunqSlot)p Fj(.)i Fk(i)598
3590 y Fi(protected:)676 3682 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 3682 V 29 w(RunqSlot)p
Fj(.)i Fk(i)598 3773 y Fi(private:)676 3864 y(off_shtl_id_t)42
b(r_shtl;)355 b(//)40 b(Shuttle)h(to)e(be)h(run.)676
3956 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 3956 V 29 w(RunqSlot)p Fj(.)i Fk(i)676
4047 y(h)p Fj(Other)g(private)f(metho)l(ds)h(of)f Fi(off)p
1691 4047 V 29 w(RunqSlot)p Fj(.)g Fk(i)598 4229 y Fi(};)515
4481 y Fk(h)p Fj(O\013)f(run)h(queue)h(slot)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 4572 y Fi(#include)41 b(<klib/ids.h>)434
b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d(al.)598 4664 y(#include)i
(<klib/HWResUnit.h>)200 b(//)40 b(for)g(off_HWResUnit)598
4755 y(class)g(off_Processor;)474 b(//)40 b(to)f(break)i(the)f
(circular)h(dependency)515 4915 y Fk(h)p Fj(O\013)27
b(run)h(queue)h(slot)f(implementation)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 5006 y Fi(#include)41 b(<hw/Processor.h>)278
b(//)40 b(for)g(off_Processor)1885 5255 y Fz(422)p eop
PStoPSsaved restore
%%Page: (424,425) 213
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
423 424 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(RunqSlot::get)p 1203 523 V 31 w(shtl)28 b Fj(and)g
Fi(set)p 1684 523 V 29 w(shtl)g Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Get/Set)i(the)f(shuttle)h(for)f
(this)g(slot.)598 706 y(extern)g(inline)h(const)f(off_shtl_id_t)i
(&off_RunqSlot::get_shtl\(voi)q(d\))j(const)c({)676 797
y(return)g(r_shtl;)598 888 y(})598 980 y(extern)f(inline)h(void)79
b(off_RunqSlot::set_shtl\(const)46 b(off_shtl_id_t)c(&s\))e({)676
1071 y(r_shtl)h(=)e(s;)676 1162 y Fk(h)p Fj(Set)28 b(other)h(slot)f
(state)i(for)d(shuttle)i Fi(s)p Fj(.)e Fk(i)598 1254
y Fi(})639 1486 y Fz(The)41 b(run)f(queue)g(is)g(alw)n(a)n(ys)f
(honored)g(but)i(for)f(those)g(cases)f(where)h(ev)n(en)n(ts)g(with)515
1586 y(higher)33 b(priorit)n(y)g(than)i(that)g(of)f(the)h(curren)n(t)e
(sh)n(uttle)i(happ)r(ens.)57 b(Besides)34 b(While)h(run-)515
1685 y(ning,)k(a)d(sh)n(uttle)h(migh)n(t)f(su\013er)h(an)f(exception)h
(\(either)f(noticed)h(b)n(y)f(the)h(hardw)n(are)e(or)515
1785 y(arti\014cially)25 b(raised)g(b)n(y)h(the)h(k)n(ernel\))f(and)g
(the)g(remaining)g(tic)n(ks)g(of)g(the)g(time)h(slot)f(will)h(b)r(e)515
1885 y(automatically)f(yield)i(to)f(the)h(exception)g(handler.)639
1984 y(T)-7 b(o)39 b(sp)r(eedup)g(con)n(text)f(switc)n(h,)j(run)e
(queue)f(slots)g(ha)n(v)n(e)g(a)g(\(cac)n(hed\))g(reference)g(to)515
2084 y(the)30 b(sh)n(uttle)g(installed.)44 b(A)31 b(metho)r(d)f(whic)n
(h)g(returns)f(suc)n(h)h(reference)f(\(or)g(obtains)h(it\))g(is)515
2183 y(pro)n(vided.)515 2300 y Fk(h)p Fj(Other)e(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2300 V 29 w(RunqSlot)p Fj(.)i Fk(i)o
Fq(\021)598 2391 y Fi(inline)40 b(off_Shtl)h(*get_shtlref\(void\);)515
2549 y Fk(h)p Fi(off)p 667 2549 V 29 w(RunqSlot::get)p
1203 2549 V 31 w(shtlref)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2640 y Fi(extern)40 b(inline)h(off_Shtl)g
(*off_RunqSlot::get_shtlref\(vo)q(id\){)676 2731 y(if)f(\(r_pshtl\))755
2823 y(return)g(r_pshtl;)676 2914 y(cache_pshtl\(\);)676
3005 y(return)h(r_pshtl;)598 3097 y(})515 3362 y Fk(h)p
Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p 1552
3362 V 29 w(RunqSlot)p Fj(.)g Fk(i)p Fq(\021)598 3454
y Fi(off_Shtl)41 b(*r_pshtl;)515 3628 y Fk(h)p Fj(Set)28
b(other)h(slot)f(state)h(for)f(shuttle)h Fi(s)p Fj(.)e
Fk(i)p Fq(\021)598 3719 y Fi(r_pshtl=NULL;)515 3894 y
Fk(h)p Fj(Other)h(private)h(metho)l(ds)g(of)e Fi(off)p
1529 3894 V 29 w(RunqSlot)p Fj(.)i Fk(i)p Fq(\021)598
3985 y Fi(void)40 b(cache_pshtl\(void\);)515 4159 y Fk(h)p
Fi(off)p 667 4159 V 29 w(RunqSlot::cache)p 1281 4159
V 31 w(pshtl)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4251 y Fi(void)40 b(off_RunqSlot::cache_pshtl\(void)q(\))598
4342 y({)676 4433 y(shtl.make_available\(r_shtl\);)676
4525 y(r_pshtl=shtl+\(natural_t\)r_sh)q(tl;)598 4616
y(})515 4882 y Fk(h)p Fj(O\013)27 b(run)h(queue)h(slot)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
4973 y Fi(#include)41 b(<shtl/ShtlSrv.h>)1885 5255 y
Fz(423)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
424 425 bop 639 523 a Fz(Eac)n(h)27 b(run)g(queue)h(slot)f(is)g
(created)g(usually)g(with)h(this)g(constructor,)515 639
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 639 24 4 v 29 w(RunqSlot)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 731 y Fi(//)39 b(Creates)i(a)f(pre-initialized)i(run)e
(queue)h(slot.)598 822 y(off_RunqSlot\(const)i(off_Protection)f(&p,)e
(const)h(off_prtl_id_t)h(&domain,)1108 913 y(const)e(off_shtl_id_t)i
(&s\);)639 1038 y Fz(although)36 b(a)h(trivial)f(constructor)f(allo)n
(ws)h(uninitialized)h(run)g(queue)f(slot)h(declara-)515
1137 y(tions.)515 1254 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 1254 V 29 w(RunqSlot)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 1345 y Fi(//)39 b(An)h(uninitialized)i(run)e(queue)h
(slot.)598 1436 y(off_RunqSlot\(void\))i(:)676 1528 y
(off_HWResUnit\(off_Protection)q(\(\),)1225 1619 y(OFF_PRTL_NULL,)1225
1710 y(OFF_ID_NULL,)1225 1802 y(OFF_MAGIC_RQSLOT,NULL\),)676
1893 y(r_shtl\(OFF_SHTL_NULL\),)676 1984 y(r_pshtl\(NULL\))598
2076 y({;})639 2200 y Fz(The)27 b(n)n(um)n(b)r(er)g(of)g(tic)n(ks)g(p)r
(er)g(quan)n(tum)g(is)g(a)f(mac)n(hine)h(dep)r(enden)n(t)h(constan)n(t)
e(\014xed)h(at)515 2300 y(compile)g(time.)515 2433 y
Fk(h)p Fj(O\013)g(run)h(queue)h(slot)f(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 2524 y Fi(#include)41 b(<klib/Magic.h>)356
b(//)40 b(for)g(magic)g(numbers.)598 2615 y(#include)h(<klib/prot.h>)
395 b(//)40 b(for)g(off_Protection)598 2707 y(class)g(off_Shtl;)639
2848 y Fz(A)28 b(new)g(magic)f(n)n(um)n(b)r(er)g(is)h(de\014ned)f(no)n
(w.)515 2964 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)i
Fk(i)p Fz(+)o Fq(\021)598 3055 y Fi(OFF_MAGIC_RQSLOT,)278
b(//)40 b(Off)g(run)g(queue)g(slot)g(magic)h(number)639
3180 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)
g(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
3296 y Fk(h)p Fi(off)p 667 3296 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 3296 V 29 w(number)p Fj(s.)h
Fk(i)p Fz(+)p Fq(\021)598 3387 y Fi(case)40 b(OFF_MAGIC_RQSLOT:)676
3479 y(return)h("off_RunqSlot";)639 3603 y Fz(Run)28
b(queue)g(slot)f(users)g(can)g(c)n(hec)n(k)g(their)g(references)g
(using)g(this)h(metho)r(d.)515 3719 y Fk(h)p Fj(Other)g(public)g(metho)
l(ds)h(of)e Fi(off)p 1493 3719 V 29 w(RunqSlot)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 3811 y Fi(//)39 b(Does)i(this)f(look)g(like)g
(a)f(RunqSlot?)598 3902 y(boolean_t)i(valid\(void\))h(const)e({)g
(return)g(get_magic\(\))i(==)e(OFF_MAGIC_RQSLOT;)j(})639
4027 y Fz(The)28 b(new)g(con)n(tainer)e(can)h(also)g(implemen)n(t)h
(its)g Fx(get)p 2323 4027 27 4 v 30 w(umagic)d Fz(metho)r(d.)515
4143 y Fk(h)p Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 4143 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p
Fq(\021)598 4234 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i
({)d(return)g(OFF_MAGIC_RQSLOT;)j(})1885 5255 y Fz(424)p
eop
PStoPSsaved restore
%%Page: (426,427) 214
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
425 426 bop 639 523 a Fz(That)27 b(w)n(as)f(a)g(dumm)n(y)h
(constructor.)35 b(The)27 b(actual)f(run)h(queue)g(slot)f(constructor)f
(sets)515 623 y(the)31 b(slot)g(protection,)g(domain,)g(sh)n(uttle)h
(to)e(b)r(e)i(run.)47 b(Suc)n(h)31 b(constructor)e(is)i(to)g(b)r(e)g
(used)515 722 y(b)n(y)c(user-lev)n(el)f(sc)n(hedulers.)515
855 y Fk(h)p Fi(off)p 667 855 24 4 v 29 w(RunqSlot::off)p
1203 855 V 31 w(RunqSlot)j Fj(implementation.)e Fk(i)p
Fq(\021)598 946 y Fi(//)39 b(Creates)i(a)f(pre-initialized)i(run)e
(queue)h(slot.)598 1038 y(off_RunqSlot::off_RunqSlot\(con)q(st)k
(off_Protection)e(&p,)1657 1129 y(const)d(off_prtl_id_t)i(&domain,)1657
1220 y(const)e(off_shtl_id_t)i(&s\))e(:)676 1312 y
(off_HWResUnit\(p,domain\),)676 1403 y(r_shtl\(s\))598
1494 y({)f(;)h(})515 1843 y FA(Idle)515 1996 y Fz(When)24
b(run)g(queues)g(are)f(empt)n(y)-7 b(,)25 b(a)e(silly)h(idle)g(sh)n
(uttle)h(is)f(run)f(\(see)h(section)g(5.1.10\).)34 b(That)515
2096 y(actually)e(means)h(that)h(run)f(queues)g(are)f(nev)n(er)g(empt)n
(y)-7 b(.)54 b(The)33 b(v)n(ery)f(\014rst)h(slot)g(of)g(ev)n(ery)515
2196 y(run)23 b(queue)g(is)g(used)g(for)g(an)g(idle)h(sh)n(uttle.)35
b(Suc)n(h)24 b(sh)n(uttle)f(is)g(created)g(and)g(installed)g
Fy(b)l(efor)l(e)515 2295 y Fz(the)28 b(pro)r(cessor)d(is)j(actually)f
(started.)515 2428 y Fk(h)p Fj(Start)i(id)t(le)e(shuttle.)h
Fk(i)p Fq(\021)598 2611 y Fi(if)39 b(\(this)i(==)e(&nd.get_proc\(\)\))k
({)676 2702 y(p_idle=new)f(off_IdleAtPrimary\(get_protecti)q(on\(\),)q
(get_)q(domai)q(n\(\)\))q(;)676 2793 y(start_clk\(\);)598
2885 y(})598 2976 y(else)e({)676 3067 y(p_idle=new)i
(off_IdleAtSecondary\(get_protec)q(tion\()q(\),ge)q(t_dom)q(ain\()q
(\)\);)676 3159 y(//)79 b(p_mdep.start\(p_idle->get_pc\(\))q(,p_i)q
(dle-)q(>get_)q(sp\(\))q(\);)1853 3250 y(//)40 b(Create)g(and)g(pass)g
(an)g(indle)g(shuttle)598 3341 y(})598 3433 y(assert\(p_idle)i(&&)e
(p_idle->valid\(\)\);)1853 3707 y(//)g(for)g(secondary)h(processors.)
1853 3798 y(//)f(\(Just)g(initialization)i(for)e(boot)h(processors.\))
515 4064 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(implementation)e
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 4155 y
Fi(#include)41 b(<shtl/idle.h>)515 4329 y Fk(h)p Fj(Other)28
b(private)h(memb)l(ers)f(of)g Fi(off)p 1552 4329 V 29
w(Processor)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598 4421 y
Fi(off_Shtl)41 b(*p_idle;)590 b(//)40 b(Idle)g(shuttle.)515
4595 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 4595 V 29 w(Processor)p Fj(.)i Fk(i)p
Fz(+)p Fq(\021)598 4686 y Fi(p_idle\(NULL\),)1885 5255
y Fz(425)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
426 427 bop 515 523 a FA(The)32 b(heartb)s(eat)515 676
y Fz(Pro)r(cessors)g(sc)n(heduling)j(is)h(done)f(using)g(a)g(the)h
(hardw)n(are)d(clo)r(c)n(k)i(in)n(terrupt.)60 b(As)36
b(eac)n(h)515 776 y(pro)r(cessor)21 b(uses)i(its)g(clo)r(c)n(k)f(in)n
(terrupt)h(for)g(sc)n(heduling,)h(eac)n(h)e(pro)r(cessor)f(con)n(tains)
h(a)h(timer)515 876 y(serv)n(er)j(to)h(re-exp)r(ort)f(virtual)h(clo)r
(c)n(k)g(in)n(terrupts.)515 1008 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 1008 24 4 v 29 w(Processor)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 1100 y Fi(inline)40
b(off_TmrSrv)160 b(&get_tmr\(void\))199 b({assert\(valid\(\)\);)43
b(return)e(p_tmr;)f(})515 1274 y Fk(h)p Fj(Other)28 b(private)h(memb)l
(ers)f(of)g Fi(off)p 1552 1274 V 29 w(Processor)p Fj(.)h
Fk(i)o Fz(+)p Fq(\021)598 1365 y Fi(off_TmrSrv)159 b(p_tmr;)472
b(//)40 b(Timer)g(server.)515 1540 y Fk(h)p Fj(Start)29
b(other)g(memb)l(ers)f(of)f Fi(off)p 1467 1540 V 29 w(Processor)j
Fj(ac)l(c)l(or)l(ding)f(to)f Fi(mdep)p Fj(.)g Fk(i)p
Fz(+)o Fq(\021)598 1631 y Fi(p_tmr.protect\(get_protection\(\))q(\);)
598 1722 y({)676 1814 y(off_mdepTmrSrv)43 b(mtmr;)676
1905 y(p_tmr.start\(mtmr,nd.get_serv)q(er_id)q(\(\)\);)598
1996 y(})515 2171 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(dep)l
(endencies.)f Fk(i)p Fz(+)p Fq(\021)598 2262 y Fi(#include)41
b(<hw/TmrSrv.h>)395 b(//)40 b(for)g(off_TmrSrv)639 2403
y Fz(The)28 b(v)n(ery)f(\014rst)g(time)i(a)e(run)h(queue)g(slot)f(is)h
(allo)r(cated,)f(a)g(p)r(erio)r(dic)h(timer)g(is)g(started)515
2503 y(to)f(raise)g(clo)r(c)n(k)f(in)n(terrupts.)639
2602 y(The)i(timer)g(is)f(started)g(b)n(y)g(the)h Fx(start)p
1880 2602 27 4 v 30 w(clk)e Fz(priv)-5 b(ate)27 b(metho)r(d.)515
2735 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2735 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 2827 y Fi(//)39 b(Starts)i(the)f(clock)g(\(a)g(timer,)h
(actually\))g(to)f(interrupt)h(this)f(processor.)598
2918 y(void)g(start_clk\(void\);)639 3059 y Fz(As)22
b(suc)n(h)g(a)f(timer)h(is)g(lik)n(ely)f(to)h(b)r(e)g(alw)n(a)n(ys)e
(set)h(with)i(a)e(\014xed)h(p)r(erio)r(d,)h(the)f(timer)g(serv)n(er)515
3159 y(pro)n(vides)k(sp)r(ecial)h(co)r(de)h(to)f(handle)h(it.)515
3291 y Fk(h)p Fi(off)p 667 3291 V 29 w(Processor::start)p
1320 3291 V 31 w(clk)h Fj(implementation.)e Fk(i)p Fq(\021)598
3383 y Fi(//)39 b(Starts)i(the)f(clock)g(\(a)g(timer,)h(actually\))g
(to)f(interrupt)h(this)f(processor.)598 3474 y(void)g
(off_Processor::start_clk\(void\))598 3565 y({)676 3657
y(if)g(\(!p_started\){)755 3748 y(p_tmr.alloc_pclk\(OFF_TICKS_PER_)q
(QUAN)q(TUM\))q(;)755 3839 y(p_started=TRUE;)755 3931
y(p_current=p_idle;)755 4022 y(p_curslot=0;)755 4113
y(p_idle->switch_from\(NULL\);)676 4205 y(})598 4296
y(})515 4470 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4470 V 29 w(Processor)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 4562 y Fi(boolean_t)41 b(p_started;)473 b(//)40
b(Clock)g(started.)515 4736 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 4736 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
4827 y Fi(p_started\(FALSE\),)1885 5255 y Fz(426)p eop
PStoPSsaved restore
%%Page: (428,429) 215
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
427 428 bop 639 523 a Fz(When)29 b(the)g(timer)f(serv)n(er)f
Fx(alloc)p 1715 523 27 4 v 29 w(clk)g Fz(is)i(called)f(a)g(p)r(erio)r
(dic)g(timer)g(serviced)g(b)n(y)g(the)515 623 y(timer)h(serv)n(er)f
(itself)i(is)f(created.)42 b(The)30 b(n)n(um)n(b)r(er)f(of)h(clo)r(c)n
(k)e(tic)n(ks)i(p)r(er)f(quan)n(tum)g(is)h(a)f(new)515
722 y(system)e(limit.)515 839 y Fk(h)p Fj(O\013)g(limits.)f
Fk(i)p Fq(\021)598 930 y Fi(//)39 b(Number)i(of)f(ticks)g(in)g(a)f
(quantum.)598 1021 y(const)h(int)g(OFF_TICKS_PER_QUANTUM=1000;)639
1146 y Fz(Whenev)n(er)33 b(suc)n(h)g(timer)g(expires,)g(it)h(calls)e
(the)i(curren)n(t)e Fx(Processor)e(new)p 3049 1146 V
30 w(quantum)515 1245 y Fz(metho)r(d.)515 1378 y Fk(h)p
Fj(Other)e(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1378
24 4 v 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
1469 y Fi(//)39 b(Starts)i(a)e(new)h(quantum.)598 1561
y(void)g(new_quantum\(void\);)639 1702 y Fz(T)-7 b(o)26
b(start)f(a)h(new)g(quan)n(tum)g(w)n(e)f(m)n(ust)i(obtain)e(the)i(iden)
n(ti\014er)e(of)h(the)h(next)f(sh)n(uttle)g(to)515 1802
y(b)r(e)i(run,)f(and)h(switc)n(h)f(to)h(it.)515 1934
y Fk(h)p Fi(off)p 667 1934 V 29 w(Processor::new)p 1242
1934 V 31 w(quantum)h Fj(implementation.)e Fk(i)p Fq(\021)598
2026 y Fi(//)39 b(Starts)i(a)e(new)h(quantum.)598 2117
y(void)g(off_Processor::new_quantum\(voi)q(d\))598 2208
y({)676 2300 y Fk(h)p Fi(off)p 828 2300 V 29 w(Processor::new)p
1403 2300 V 31 w(quantum)29 b Fj(lo)l(c)l(al)f(variables.)g
Fk(i)676 2391 y(h)p Fj(Obtain)g(a)g(r)l(efer)l(enc)l(e)h(to)f(the)h
Fi(next)f Fj(shuttle)h(and)f(terminate)h(if)d(none.)i
Fk(i)676 2482 y(h)p Fj(Switch)g(to)g(the)h Fi(next)f
Fj(shuttle.)h Fk(i)598 2574 y Fi(})639 2806 y Fz(Suc)n(h)j(sh)n(uttle)g
(is)f(the)h(one)f(the)h(next)g(sh)n(uttle)g(in)g(the)f(run)h(queue)f
(is)h(yielding)f(to.)49 b(If)515 2906 y(suc)n(h)27 b(sh)n(uttle)h(is)f
(running)h(or)e(blo)r(c)n(k)n(ed)h(a)g(new)h(one)f(m)n(ust)h(b)r(e)g
(selected.)639 3005 y(The)37 b(run)g(queue)f(is)h(scanned)f(in)h(a)f
(round-robin)f(fashion;)41 b(W)-7 b(e)37 b(w)n(an)n(t)f(to)h(\014nd)g
(the)515 3105 y(\014rst)23 b(non-blo)r(c)n(k)n(ed)g(sh)n(uttle)h(\(the)
h(next)f(to)g(run\))g(in)g(the)g(allo)r(cated)f(p)r(ortion)h(of)g(the)g
(queue.)515 3205 y(Hence,)35 b(w)n(e)d(main)n(tain)h(a)g(p)r(oin)n(ter)
g(to)g(the)g(curren)n(t)g(slot)g(\(and)g(another)f(to)h(the)h(curren)n
(t)515 3304 y(sh)n(uttle\).)515 3437 y Fk(h)p Fj(Other)28
b(private)h(memb)l(ers)f(of)g Fi(off)p 1552 3437 V 29
w(Processor)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598 3528 y
Fi(natural_t)41 b(p_curslot;)473 b(//)40 b(Current)h(run)e(queue)i
(slot.)598 3620 y(off_Shtl)g(*p_current;)473 b(//)40
b(Current)h(shuttle.)515 3794 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 3794 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
3885 y Fi(p_curslot\(0\),p_current\(NULL\),)515 4060
y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4060 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
4151 y Fi(//)39 b(Returns)i(the)f(shuttle)h(being)f(run.)598
4242 y(off_Shtl)h(*get_current\(void\);)515 4417 y Fk(h)p
Fi(off)p 667 4417 V 29 w(Processor::get)p 1242 4417 V
31 w(current)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4508 y Fi(//)39 b(Returns)i(the)f(shuttle)h(being)f(run.)598
4599 y(off_Shtl)h(*off_Processor::get_current\(vo)q(id\))598
4691 y({)676 4782 y(return)g(p_current;)598 4873 y(})1885
5255 y Fz(427)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
428 429 bop 515 523 a Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(dep)l
(endencies.)f Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(class)40
b(off_Shtl;)515 789 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(late)e
(dep)l(endencies.)h Fk(i)p Fq(\021)598 880 y Fi(#include)41
b(<shtl/Shtl.h>)395 b(//)40 b(for)g(off_Shtl)515 1054
y Fk(h)p Fj(Obtain)27 b(a)h(r)l(efer)l(enc)l(e)i(to)e(the)g
Fi(next)g Fj(shuttle)i(and)d(terminate)i(if)e(none.)h
Fk(i)o Fq(\021)598 1146 y Fi(if)39 b(\(!\(max=p_alloc.get_maxalloc)q
(\(\)\)\))46 b(//)39 b(no)h(need)g(to)g(switch)676 1237
y(return;)598 1328 y(if)f(\(!w_try_lock\(\)\){)676 1420
y(p_expired=TRUE;)676 1511 y(return;)598 1602 y(})598
1694 y(assert\(!p_expired\);)598 1785 y(\(void\)&p_curslot;)598
1876 y(\(void\)&current;)598 1968 y(current=p_curslot;)598
2059 y(end=p_curslot)j(=)d(++p_curslot)j(\045)e(max;)598
2150 y(\(void\)&p_curslot;)598 2242 y(do)f({)676 2333
y(if)h(\(\(next=\(\(*this\)+p_curslot\)->ge)q(t_sh)q(tlre)q(f\(\)\)\))q
({)755 2424 y(while)g(\(next->is_blocked\(\))k(&&)39
b(next->is_yielding\(\)\))44 b({)833 2516 y(off_shtl_id_t)e
(nextid=next->yields_to\(\);)833 2607 y(shtl.make_available\(nextid\);)
833 2698 y(next=shtl+\(natural_t\)nextid;)833 2790 y
(assert\(next->get_id\(\))i(==)c(nextid\);)755 2881 y(})755
2972 y(if)f(\(next->is_blocked\(\))44 b(||)c(\(next->is_running\(\))j
(&&)d(next)g(!=)g(p_current\)\){)833 3064 y(next=NULL;)833
3155 y(p_curslot)h(=)f(++p_curslot)i(\045)d(max;)755
3337 y(})676 3429 y(})598 3611 y(})g(while)i(\(!next)f(&&)g
(p_curslot!=end\);)598 3703 y(if)f(\(!next\))676 3794
y(next=p_idle;)639 3935 y Fz(W)-7 b(e)39 b(used)g(a)f(\015ag)g
Fx(p)p 1291 3935 27 4 v 31 w(expired)d Fz(to)k(ask)e(for)h(the)h(lo)r
(c)n(k)f(holder)g(\(whic)n(h)h(m)n(ust)f(b)r(e)h(an)515
4035 y(allo)r(cator)26 b(or)g(deallo)r(cator)g(of)i(run)f(queue)h
(slots\))f(to)g(call)h Fx(new)p 2485 4035 V 30 w(quantum)d
Fz(himself.)515 4151 y Fk(h)p Fj(Other)j(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4151 24 4 v 29 w(Processor)p Fj(.)h Fk(i)o
Fz(+)p Fq(\021)598 4242 y Fi(boolean_t)41 b(p_expired;)395
b(//)39 b(Quantum)i(expired.)515 4400 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 4400 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
4491 y Fi(p_expired\(FALSE\),)1885 5255 y Fz(428)p eop
PStoPSsaved restore
%%Page: (430,431) 216
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
429 430 bop 639 523 a Fz(Routines)28 b(holding)g(lo)r(c)n(ks)f(m)n(ust)
h(include)h(the)f(next)h(c)n(h)n(unk)e(righ)n(t)h(b)r(efore)f(the)i(lo)
r(c)n(k)e(is)515 623 y(released)k(and)g(the)i(the)f(follo)n(wing)f(one)
h(after)g(releasing)e(the)i(lo)r(c)n(k.)50 b(Besides,)32
b(the)h(giv)n(en)515 722 y(lo)r(cal)27 b(v)-5 b(ariable)26
b(declaration)h(should)g(b)r(e)h(included)g(to)r(o.)515
839 y Fk(h)p Fj(Che)l(ck)g(if)f(the)h(quantum)h(expir)l(e)l(d)f(while)f
(holding)h(the)g(lo)l(ck.)g Fk(i)p Fq(\021)598 930 y
Fi(q_expired=p_expired;)598 1021 y(if)39 b(\(p_expired\){)676
1112 y(p_expired=FALSE;)598 1204 y(})515 1362 y Fk(h)p
Fj(Start)29 b(a)e(new)h(quantum)h(if)d(expir)l(e)l(d)j(while)e(holding)
h(the)g(lo)l(ck.)g Fk(i)o Fq(\021)598 1453 y Fi(if)39
b(\(q_expired\))j(new_quantum\(\);)515 1627 y Fk(h)p
Fj(L)l(o)l(c)l(al)28 b(variables)g(for)g(new)g(quantum)g(while)f(lo)l
(cke)l(d)i(che)l(cking.)f Fk(i)p Fq(\021)598 1719 y Fi(boolean_t)41
b(q_expired;)515 1893 y Fk(h)p Fi(off)p 667 1893 24 4
v 29 w(Processor::new)p 1242 1893 V 31 w(quantum)29 b
Fj(lo)l(c)l(al)e(variables.)i Fk(i)o Fq(\021)598 1984
y Fi(off_Shtl)41 b(*next,*prev;)598 2076 y(natural_t)g
(max,current,end;)639 2217 y Fz(Once)27 b(w)n(e)h(ha)n(v)n(e)e(a)h
(reference)g(to)g(the)h(next)g(sh)n(uttle)g(to)g(b)r(e)g(run,)f(w)n(e)g
(switc)n(h)h(to)f(it.)515 2333 y Fk(h)p Fj(Switch)h(to)g(the)g
Fi(next)h Fj(shuttle.)f Fk(i)p Fq(\021)598 2424 y Fi(prev=p_current;)
598 2516 y(p_current=next;)598 2607 y(assert\(next)41
b(&&)f(next->valid\(\)\);)598 2698 y(assert\(prev)h(&&)f
(prev->valid\(\)\);)598 2790 y(w_unlock\(\);)598 2881
y(if)f(\(next==prev\){)676 2972 y(return;)598 3064 y(})598
3155 y(next->switch_from\(prev\);)515 3412 y Fn(4.6.3)112
b(Time)36 b(slice)g(allo)s(cation)515 3565 y Fz(Time)18
b(slices)g(are)g(allo)r(cated)f(from)h(a)g Fx(RqAllocator)c
Fz(whic)n(h)k(is)h(a)f(sub)r(class)f(of)i(a)f Fx(FixedAllocator)515
3665 y Fz(instan)n(tiated)27 b(to)h(allo)r(cate)e Fx(RunqSlot)p
Fz(s.)515 3798 y Fk(h)p Fj(O\013)h(time)g(slic)l(e)h(al)t(lo)l(c)l
(ator.)g Fk(i)p Fq(\021)598 3889 y Fi(//)39 b(A)h(time)g(slice)g
(allocator.)598 3981 y(//)598 4072 y(class)g(off_RqAllocator)j(:)c
(public)i(off_TFixedAllocator<off_LRunqS)q(lot>)46 b({)598
4163 y(public:)676 4254 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 4254 V 29 w(RqAllocator)p Fj(.)j
Fk(i)598 4346 y Fi(private:)676 4437 y Fk(h)p Fj(Other)f(private)f
(memb)l(ers)h(of)e Fi(off)p 1713 4437 V 29 w(RqAllocator)p
Fj(.)j Fk(i)598 4528 y Fi(};)515 4794 y Fk(h)p Fj(O\013)d(time)g(slic)l
(e)h(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g Fk(i)p Fq(\021)598
4885 y Fi(#include)41 b(<klib/FixedAllocator.h>)j(//)c(for)g
(off_TFixedAllocator)j(et)d(al.)1885 5255 y Fz(429)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
430 431 bop 639 523 a Fz(T)-7 b(o)32 b(supp)r(ort)g(the)h(link)n(ed)f
(lists)g(used)g(in)h(the)g(\014xed)f(allo)r(cator,)g(no)r(des)g(allo)r
(cated)f(are)515 623 y(actually)c(of)g(t)n(yp)r(e)h Fx(LRunqSlot)p
Fz(.)515 739 y Fk(h)p Fj(O\013)f(linkable)g(run)h(queue)h(slot.)f
Fk(i)o Fq(\021)598 830 y Fi(//)39 b(A)h(linkable)h(run)f(queue)g(slot.)
598 922 y(//)598 1013 y(class)g(off_LRunqSlot)i(:)e(public)g
(DLinkedNode)i({)598 1104 y(public:)676 1196 y(off_RunqSlot)g(l_ts;)676
1378 y(//)e(To)g(allow)g(uninitialized)i(run)e(queue)g(slots.)676
1469 y(off_LRunqSlot\(void\))k(:)39 b(l_ts\(\))i({;})676
1652 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 1652 24 4 v 29 w(LRunqSlot)p Fj(.)i Fk(i)598
1743 y Fi(};)515 1976 y Fk(h)p Fj(O\013)e(time)g(slic)l(e)h(al)t(lo)l
(c)l(ator)h(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
2067 y Fi(#include)41 b(<hw/RunqSlot.h>)317 b(//)40 b(for)g
(off_RunqSlot)639 2192 y Fz(The)28 b(\014xed)g(allo)r(cator)d(uses)j(a)
f(\014xed)g(arra)n(y)f(of)h Fx(LRunqSlot)p Fz(s)515 2300
y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 2300 V 29 w(RqAllocator)p Fj(.)h Fk(i)p Fq(\021)598
2391 y Fi(off_LRunqSlot)42 b(r_ts[OFF_NRQS_MAX];)h(//)d(Run)g(queue)g
(slots.)639 2507 y Fz(where)28 b Fx(OFF)p 1017 2507 27
4 v 30 w(NRQS)p 1223 2507 V 30 w(MAX)f Fz(is)h(the)h(maxim)n(um)f(n)n
(um)n(b)r(er)g(of)h(time)g(slices)e(in)i(a)f(run)g(queue,)515
2607 y(whic)n(h)f(is)h(a)f(system)g(limit.)515 2715 y
Fk(h)p Fj(O\013)g(limits.)f Fk(i)p Fz(+)p Fq(\021)598
2806 y Fi(const)40 b(int)g(OFF_NRQS_MAX)i(=)d(64;)158
b(//)40 b(Max.)g(number)g(of)g(run)g(queue)g(slots.)515
2939 y Fk(h)p Fj(O\013)27 b(time)g(slic)l(e)h(al)t(lo)l(c)l(ator)h(dep)
l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 3030 y Fi(#include)41
b(<klib/limits.h>)317 b(//)40 b(ofr)g(OFF_NRQS_MAX)639
3155 y Fz(An)28 b(indexer)f(is)h(also)e(needed.)515 3263
y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f(of)g Fi(off)p
1552 3263 24 4 v 29 w(RqAllocator)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3354 y Fi(static)40 b(off_Indexer<off_LRunqSlot>)45
b(r_idx;)c(//)f(Linked)g(slot)g(indexer.)515 3487 y Fk(h)p
Fj(O\013)27 b(time)g(slic)l(e)h(al)t(lo)l(c)l(ator)h(static)f(memb)l
(ers.)g Fk(i)p Fq(\021)598 3578 y Fi(off_Indexer<off_LRunqSlot>)45
b(off_RqAllocator::r_idx;)f(//)c(Linked)h(slot)f(indexer.)515
3719 y Fk(h)p Fj(O\013)27 b(time)g(slic)l(e)h(al)t(lo)l(c)l(ator)h(dep)
l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598 3811 y Fi(#include)41
b(<klib/Indexer.h>)278 b(//)40 b(for)g(off_Indexer)639
3935 y Fz(No)n(w)22 b(w)n(e)f(can)h(state)g(ho)n(w)f(the)h(slot)g(allo)
r(cator)e(is)i(created.)34 b(Only)22 b(a)g(rev)n(o)r(cation)e(trigger)
515 4035 y(m)n(ust)27 b(b)r(e)h(supplied.)515 4143 y
Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4143 V 29 w(RqAllocator)p Fj(.)i Fk(i)p Fq(\021)598
4234 y Fi(//)39 b(Creates)i(a)f(run)g(queue)g(slot)g(allocator.)598
4325 y(off_RqAllocator\(off_Exhausted)46 b(*r\);)515
4458 y Fk(h)p Fi(off)p 667 4458 V 29 w(RqAllocator::off)p
1320 4458 V 31 w(RqAllocator)30 b Fj(implementation.)e
Fk(i)p Fq(\021)598 4550 y Fi(//)39 b(Creates)i(a)f(run)g(queue)g(slot)g
(allocator.)598 4641 y(off_RqAllocator::off_RqAllocat)q(or\(of)q(f_Ex)q
(haus)q(ted)45 b(*r\))40 b(:)676 4732 y(off_TFixedAllocator<off_LRun)q
(qSlot)q(>\(r,)46 b(\(const)40 b(off_Indexable*\)&r_idx,)2049
4824 y(r_ts,OFF_NRQS_MAX\))598 4915 y({;})1885 5255 y
Fz(430)p eop
PStoPSsaved restore
%%Page: (432,433) 217
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
431 432 bop 639 523 a Fz(The)38 b(arra)n(y)d(of)j Fx(LRunqSlot)p
Fz(s)33 b(is)38 b(initialized)g(when)f(the)h(pro)r(cessor)e(is)h
(instan)n(tiated)515 623 y(using)27 b(the)h(pro)r(cessor)d(itself)k(as)
d(a)i(rev)n(o)r(cation)d(trigger.)515 739 y Fk(h)p Fj(Initialize)h
Fi(p)p 910 739 24 4 v 29 w(alloc)p Fj(.)i Fk(i)p Fq(\021)598
830 y Fi(p_alloc\(\(off_Exhausted*\)this\))639 955 y
Fz(As)g(of)g(to)r(da)n(y)e(there)i(is)f(no)h(rev)n(o)r(cation)d(for)j
(time)g(slices.)515 1071 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1071 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 1162 y Fi(//)39 b(Notifies)i(that)g(run)f(queue)g(is)g
(exhausted.)598 1254 y(void)g(notify\(void\))i({)d(return;)i(})639
1469 y Fz(Using)28 b(this)g(allo)r(cator,)d(a)j(pro)r(cessor)d(can)i
(allo)r(cate)g(memory)g(for)g(run)g(time)h(slots.)515
1586 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1586 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
1677 y Fi(//)39 b(Allocates)j(a)d(run)h(queue)g(slot.)598
1768 y(off_RunqSlot)i(*alloc\(boolean_t)h(use_revocation=FALSE\);)598
1951 y(//)c(Deallocates)j(a)e(run)g(queue)g(slot.)598
2042 y(void)g(free\(const)h(off_RunqSlot)h(*rq\);)515
2291 y Fk(h)p Fi(off)p 667 2291 V 29 w(Processor::alloc)31
b Fj(and)d Fi(free)g Fj(implementation.)f Fk(i)p Fq(\021)598
2383 y Fi(//)39 b(Allocates)j(a)d(run)h(queue)g(slot.)598
2474 y(off_RunqSlot)i(*off_Processor::alloc\(boolean_)q(t)j
(use_revocation\))598 2565 y({)676 2657 y(off_LRunqSlot)d(*lts;)676
2748 y Fk(h)p Fj(L)l(o)l(c)l(al)28 b(variables)h(for)e(new)h(quantum)h
(while)e(lo)l(cke)l(d)h(che)l(cking.)g Fk(i)676 2839
y Fi(assert\(valid\(\)\);)676 2931 y(w_lock\(\);)676
3022 y(lts=p_alloc.allocate\(use_rev)q(ocati)q(on\);)676
3113 y Fk(h)p Fj(Che)l(ck)h(if)d(the)i(quantum)h(expir)l(e)l(d)g(while)
e(holding)h(the)g(lo)l(ck.)f Fk(i)676 3205 y Fi(w_unlock\(\);)676
3296 y Fk(h)p Fj(Start)i(a)f(new)g(quantum)g(if)f(expir)l(e)l(d)i
(while)e(holding)g(the)i(lo)l(ck.)e Fk(i)676 3387 y Fi(return)41
b(\(lts\)?\(&lts->l_ts\):\(off_RunqSl)q(ot*\))q(NULL;)598
3479 y(})598 3661 y(//)e(Deallocates)j(a)e(run)g(queue)g(slot.)598
3753 y(void)g(off_Processor::free\(const)45 b(off_RunqSlot)d(*ts\))598
3844 y({)676 3935 y(off_LRunqSlot)g(*lts=\(off_LRunqSlot*\)\(\(\(cha)q
(r*\)ts)q(\)-\(i)q(nt\)&o)q(ff_L)q(Runq)q(Slot:)q(:l_t)q(s\);)676
4027 y Fk(h)p Fj(L)l(o)l(c)l(al)28 b(variables)h(for)e(new)h(quantum)h
(while)e(lo)l(cke)l(d)h(che)l(cking.)g Fk(i)676 4118
y Fi(assert\(valid\(\))43 b(&&)c(ts\);)676 4209 y(w_lock\(\);)676
4301 y(p_alloc.deallocate\(lts\);)676 4392 y Fk(h)p Fj(Che)l(ck)29
b(if)d(the)i(quantum)h(expir)l(e)l(d)g(while)e(holding)h(the)g(lo)l
(ck.)f Fk(i)676 4483 y Fi(w_unlock\(\);)676 4575 y Fk(h)p
Fj(Start)i(a)f(new)g(quantum)g(if)f(expir)l(e)l(d)i(while)e(holding)g
(the)i(lo)l(ck.)e Fk(i)598 4666 y Fi(})1885 5255 y Fz(431)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
432 433 bop 639 523 a Fz(Run)35 b(queue)e(slots)h(ha)n(v)n(e)e(their)i
(o)n(wn)f Fx(new)g Fz(and)h Fx(delete)d Fz(op)r(erators.)54
b(The)34 b(op)r(erator)515 623 y Fx(new)g Fz(receiv)n(es)g(the)i(pro)r
(cessor)e(where)h(the)h(slot)f(should)g(b)r(e)h(allo)r(cated.)60
b(Op)r(erator)34 b Fx(new)515 722 y Fz(uses)27 b(its)h
Fx(alloc)d Fz(metho)r(d)j(to)g(\014nd)g(an)f(a)n(v)-5
b(ailable)27 b(slot.)515 840 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 840 24 4 v 29 w(RunqSlot)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 931 y Fi(//)39 b(Allocate)i(a)f(run)g(queue)g
(slot.)598 1022 y(void)g(*operator)h(new\(size_t)h(s,)d(off_Processor)k
(*p,)1343 1114 y(boolean_t)e(use_revocation=FALSE\);)598
1205 y(//)e(Deallocates)j(this)e(run)g(queue)h(slot.)598
1296 y(void)f(operator)h(delete\(void)h(*p\);)515 1531
y Fk(h)p Fi(off)p 667 1531 V 29 w(RunqSlot::operator)h(new)28
b Fj(implementation.)f Fk(i)p Fq(\021)598 1622 y Fi(//)39
b(Allocate)i(a)f(run)g(queue)g(slot.)598 1714 y(void)g
(*off_RunqSlot::operator)k(new\(size_t)e(s,)e(off_Processor)i(*p,)1892
1805 y(boolean_t)g(use_revocation\))598 1896 y({)676
1988 y(off_RunqSlot)g(*ts=p->alloc\(use_revocation\))q(;)676
2079 y(\(void\)s;)676 2170 y(assert\(s)f(&&)f(p\);)676
2262 y(assert\(!ts)i(||)d(ts->valid\(\)\);)676 2353 y(return)i
(\(void*\)ts;)598 2444 y(})639 2752 y Fz(The)28 b(op)r(erator)e
Fx(delete)f Fz(do)r(es)i(what)h(could)f(b)r(e)h(exp)r(ected.)515
2861 y Fk(h)p Fi(off)p 667 2861 V 29 w(RunqSlot::operator)43
b(delete)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
2952 y Fi(//)39 b(Deallocates)j(this)e(run)g(queue)h(slot.)598
3044 y(void)f(off_RunqSlot::operator)k(delete\(void)e(*p\))598
3135 y({)676 3226 y(off_RunqSlot)g(*ts=\(off_RunqSlot*\)p;)676
3318 y(assert\(ts)f(&&)f(ts->valid\(\)\);)676 3409 y
(\(\(off_Processor*\)\(ts->get_co)q(ntain)q(er\(\))q(\)\)->)q(free\()q
(ts\);)598 3500 y(})639 3708 y Fz(Run)28 b(queue)g(slots)f(m)n(ust)h(b)
r(e)h(pre-initialized.)36 b(Pre-initialization)27 b(is)g(done)h(when)g
(the)515 3808 y(pro)r(cessor)d(is)j(started.)515 3916
y Fk(h)p Fj(Start)h(other)g(memb)l(ers)f(of)f Fi(off)p
1467 3916 V 29 w(Processor)j Fj(ac)l(c)l(or)l(ding)f(to)f
Fi(mdep)p Fj(.)g Fk(i)p Fz(+)o Fq(\021)598 4008 y Fi(for)40
b(\(natural_t)h(ts=0;)g(ts<)e(get_nslots\(\);)k(ts++\){)676
4099 y(off_ts_id_t)f(tsid\(get_id\(\),ts\);)676 4190
y(\(void\))f(new\(p_alloc+ts\))h(off_LRunqSlot\(tsid,this\);)598
4282 y(})639 4490 y Fz(Again,)27 b(w)n(e)h(use)f(a)g(tric)n(ky)g
Fx(new)g Fz(op)r(erator.)515 4598 y Fk(h)p Fj(Other)h(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 4598 V 29 w(LRunqSlot)p Fj(.)i
Fk(i)p Fq(\021)598 4690 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d
(off_LRunqSlot)k(*ts\))d({)f(\(void\)s;)i(return)g(\(void*\)ts;)g(})639
4806 y Fz(The)28 b Fx(LRunqSlot)c Fz(constructor)i(pre-initializes)h
(eac)n(h)f(slot)i(in)g(turn)515 4915 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 4915 V 29 w(LRunqSlot)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 5006 y Fi(off_LRunqSlot\(const)43
b(off_ts_id_t)f(&id,)e(off_Processor)i(*p\))e(:)g(l_ts\(id,p\))h({;})
1885 5255 y Fz(432)p eop
PStoPSsaved restore
%%Page: (434,435) 218
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
433 434 bop 639 523 a Fz(using)28 b(a)f(pre-initialization)f
(constructor)g(for)h Fx(RunqSlot)p Fz(s.)515 639 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 639
24 4 v 29 w(RunqSlot)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
731 y Fi(off_RunqSlot\(const)43 b(off_ts_id_t)f(&id,)e(off_Processor)i
(*p\))e(:)676 822 y(off_HWResUnit\(id,OFF_MAGIC_R)q(QSLOT)q(,\(of)q
(f_HW)q(CompR)q(esou)q(rce*\))q(p\))598 913 y({;})639
1129 y Fz(Using)26 b(the)g(allo)r(cator,)f(pro)r(cessors)e(implemen)n
(t)k(these)f(op)r(erators)e(to)i(access)e(existing)515
1229 y(run)j(queue)h(slots.)515 1345 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1345 V 29 w(Processor)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 1436 y Fi(//Gets)40
b(a)g(run)g(queue)g(slot)g(from)g(its)g(distributed)i(or)e(physical)h
(address.)598 1528 y(inline)f(off_RunqSlot)i(*operator+\(vm_offset_t)j
(s\);)515 1685 y Fk(h)p Fi(off)p 667 1685 V 29 w(Processor::operator+)
32 b Fj(implementation.)27 b Fk(i)p Fq(\021)598 1777
y Fi(//Gets)40 b(a)g(run)g(queue)g(slot)g(from)g(its)g(distributed)i
(or)e(physical)h(address.)598 1868 y(inline)f(off_RunqSlot)i
(*off_Processor::operator+\(vm)q(_off)q(set_t)k(s\))598
1959 y({)676 2051 y(return)41 b(&\(p_alloc+s\)->l_ts;)598
2142 y(})639 2283 y Fz(The)34 b(implemen)n(tation)f(uses)g(a)g
(rede\014nition)g(of)g(the)h(op)r(erator)d(in)j(the)g(allo)r(cator)d
(to)515 2383 y(do)c(it)h(more)f(e\016cien)n(tly)-7 b(.)515
2499 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2499 V 29 w(RqAllocator)p Fj(.)i Fk(i)p
Fz(+)p Fq(\021)598 2590 y Fi(//Gets)40 b(a)g(run)g(queue)g(slot)g(from)
g(its)g(distributed)i(or)e(physical)h(address.)598 2682
y(inline)f(off_LRunqSlot)j(*operator+\(vm_offset_t)h(s\);)515
2839 y Fk(h)p Fi(off)p 667 2839 V 29 w(RqAllocator::operator)g(+)27
b Fj(implementation.)h Fk(i)p Fq(\021)598 2931 y Fi(//Gets)40
b(a)g(run)g(queue)g(slot)g(from)g(its)g(distributed)i(or)e(physical)h
(address.)598 3022 y(inline)f(off_LRunqSlot)j
(*off_RqAllocator::operator+\(vm_)q(offse)q(t_t)j(s\))598
3113 y({)676 3205 y(return)41 b(r_ts+s;)598 3296 y(})515
3661 y Fn(4.6.4)112 b(Pro)s(cessor)37 b(na)m(vigation)g(and)h(insp)s
(ection)722 3814 y FA(NOTE:)27 b Fz(XXX)i(Not)e(y)n(et)h(implemen)n
(ted.)515 4030 y FA(Pro)s(cessor)j(na)m(vigation)515
4175 y Fk(h)p Fj(Other)d(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4175 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
4267 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f(Processors.)598
4358 y(off_Navigator)i(*get_navigator\(void\))i({)39
b(return)i(NULL;)f(})515 4532 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l
(essor)j(dep)l(endencies.)f Fk(i)p Fz(+)p Fq(\021)598
4624 y Fi(#include)41 b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)
i(et)d(al.)1885 5255 y Fz(433)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
434 435 bop 515 523 a FA(Pro)s(cessor)31 b(insp)s(ection)515
676 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)e(to)i(implemen)n(t)g
Fx(get)p 1496 676 27 4 v 30 w(url)e Fz(and)i Fx(nameof)p
Fz(.)515 793 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 793 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 884 y Fi(//)39 b(Get)h(the)g(processor)i(URL.)598
975 y(const)e(char)g(*get_url\(void\);)598 1066 y(//)f(Returns)i(the)f
(processor)h(name.)598 1158 y(const)f(char)g(*nameof\(void\);)639
1282 y Fz(The)28 b(URL)g(for)f(a)g(pro)r(cessor)e(is)j(that)g(of)f(its)
h(no)r(de)g(with)g Fx(proc.html)c Fz(app)r(ended.)37
b(W)-7 b(e)515 1382 y(use)26 b(a)g(new)g(mem)n(b)r(er,)h(a)f(c)n
(haracter)e(arra)n(y)g(initialized)j(the)g(v)n(ery)e(\014rst)h(time)h
(it)g(is)f(needed.)515 1498 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 1498 V 29 w(Processor)p Fj(.)h Fk(i)o
Fz(+)p Fq(\021)598 1590 y Fi(static)40 b(char)g(*p_url;)512
b(//)40 b(URL)g(for)g(this)g(Processor.)639 1714 y Fz(Initially)28
b(it)g(is)f(empt)n(y)-7 b(.)515 1830 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor)j(static)f(memb)l(ers.)f Fk(i)p
Fq(\021)598 1922 y Fi(char)40 b(*off_Processor::p_url=NULL;)84
b(//)40 b(URL)g(for)g(this)g(Processor.)515 2079 y Fk(h)p
Fi(off)p 667 2079 V 29 w(Processor::get)p 1242 2079 V
31 w(url)28 b Fj(implementation.)g Fk(i)o Fq(\021)598
2171 y Fi(//)39 b(Get)h(the)g(Processor)i(URL.)598 2262
y(const)e(char)g(*off_Processor::get_url\(void)q(\))598
2353 y({)676 2445 y(assert\(valid\(\)\);)676 2536 y(if)g(\(!p_url\){)
755 2627 y(p_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_P)q(ROC_U)q(RL\)+)q(1];)46 b(//+1)40 b(for)g(\\0)755
2719 y(if)f(\(p_url\){)833 2810 y(strcpy\(p_url,nd.get_url\(\)\);)833
2901 y(strcat\(p_url,OFF_PROC_URL\);)755 2993 y(})676
3084 y(})676 3175 y(return)i(p_url;)598 3267 y(})639
3499 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(pro)r(cessors.)515 3615 y Fk(h)p Fj(O\013)f(sour)l(c)l
(e)i(c)l(o)l(de)g(urls.)e Fk(i)p Fq(\021)598 3707 y Fi(const)40
b(char)g(OFF_PROC_URL[]="/proc.html";)515 3864 y Fk(h)p
Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(dep)l(endencies.)f
Fk(i)p Fz(+)p Fq(\021)598 3956 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_PROC_URL)598 4047 y(#include)h(<string.h>)512
b(//)40 b(for)g(strcat)g(strdup)h(et)e(al)1885 5255 y
Fz(434)p eop
PStoPSsaved restore
%%Page: (436,437) 219
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
435 436 bop 639 523 a Fz(The)39 b(name)f(for)f(a)h(pro)r(cessor)e(is)i
(that)h(of)f(its)g(no)r(de)h(complemen)n(ted)f(with)h(a)e(little)515
623 y(su\016x.)43 b(The)30 b(implemen)n(tation)g(is)g(almost)f(the)h
(same)f(of)h Fx(get)p 2486 623 27 4 v 30 w(url)p Fz(,)g(ho)n(w)n(ev)n
(er,)e(the)i(name)515 722 y(is)d(not)h(shared)e(among)h(pro)r(cessors)e
(in)j(the)g(same)f(no)r(de)h(\(i.e.)37 b(it)28 b(is)f(not)h
Fx(static)p Fz(\).)515 855 y Fk(h)p Fi(off)p 667 855
24 4 v 29 w(Processor::nameof)j Fj(implementation.)c
Fk(i)p Fq(\021)598 946 y Fi(//)39 b(Returns)i(the)f(processor)h(name.)
598 1038 y(const)f(char)g(*off_Processor::nameof\(void\))598
1129 y({)676 1220 y(assert\(valid\(\)\);)676 1312 y(if)g(\(!p_name\){)
755 1403 y(p_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q
(\("/p)q(roc"\))q(+9];)46 b(//)40 b(for)f(N...N\\0)755
1494 y(if)g(\(p_name\){)833 1586 y(char)h(number[9];)833
1677 y(strcpy\(p_name,nd.nameof\(\)\);)833 1768 y
(strcat\(p_name,"/proc"\);)833 1860 y
(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q(id\(\)\))q(;)833
1951 y(strcat\(p_name,number\);)755 2042 y(})676 2134
y(})676 2225 y(return)h(p_name;)598 2316 y(})515 2582
y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p
1552 2582 V 29 w(Processor)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598
2673 y Fi(char)40 b(*p_name;)708 b(//)39 b(name)i(for)f(this)g
(Processor.)515 2848 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l
(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 2848 V 29 w(Processor)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 2939 y Fi(p_name\(NULL\))515
3196 y FA(Run)i(queue)h(slot)f(insp)s(ection)515 3350
y Fz(W)-7 b(e)23 b(need)f Fx(get)p 978 3350 27 4 v 30
w(rurl)f Fz(and)i Fx(get)p 1494 3350 V 30 w(url)p 1656
3350 V 30 w(holder)d Fz(for)i(slots)g(to)g(supp)r(ort)h
Fx(ResUnit::get)p 3204 3350 V 26 w(url)p Fz(.)515 3482
y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3482 24 4 v 29 w(RunqSlot)p Fj(.)i Fk(i)o
Fq(\021)598 3574 y Fi(//)39 b(Get)h(the)g(slot)598 3665
y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const;)598
3756 y(//)c(Returns)i(the)f(slot)g(name.)598 3848 y(virtual)h(char)f
(*&get_url_holder\(void\);)515 4022 y Fk(h)p Fi(off)p
667 4022 V 29 w(RunqSlot::get)p 1203 4022 V 31 w(rurl)28
b Fj(implementation.)g Fk(i)o Fq(\021)598 4113 y Fi(//)39
b(Get)h(the)g(slot)598 4205 y(const)g(char)g
(*off_RunqSlot::get_rurl\(void)q(\))45 b(const)40 b({)g(return)g
(OFF_RUNQSL_URL;)j(})639 4346 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g
(de\014ne)h(the)g(relativ)n(e)f(URL)g(for)h(slots.)515
4462 y Fk(h)p Fj(O\013)f(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e
Fk(i)p Fz(+)p Fq(\021)598 4553 y Fi(const)40 b(char)g
(OFF_RUNQSL_URL[]="#RunqSlot")q(;)515 4711 y Fk(h)p Fj(O\013)27
b(run)h(queue)h(slot)f(dep)l(endencies.)h Fk(i)p Fz(+)o
Fq(\021)598 4802 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_RUNQSL_URL)598 4894 y(#include)h(<stdio.h>)551
b(//)40 b(for)g(sprintf)g(et)g(al)1885 5255 y Fz(435)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
436 437 bop 639 523 a Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g
(slots.)515 639 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 639 24 4 v 29 w(RunqSlot)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 731 y Fi(static)40 b(char)g(*r_url;)512
b(//)40 b(URL)g(for)g(this)g(slot.)515 888 y Fk(h)p Fi(off)p
667 888 V 29 w(RunqSlot::get)p 1203 888 V 31 w(url)p
1351 888 V 29 w(holder)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 980 y Fi(char)40 b(*&off_RunqSlot::get_url_holder)q(\(voi)q
(d\))45 b({)79 b(return)41 b(r_url;)f(})639 1121 y Fz(Initially)28
b(it)g(is)f(empt)n(y)-7 b(.)515 1237 y Fk(h)p Fj(O\013)27
b(run)h(queue)h(slot)f(static)g(memb)l(ers.)h Fk(i)o
Fq(\021)598 1328 y Fi(char)40 b(*off_RunqSlot::r_url=NULL;)123
b(//)40 b(URL)g(for)g(slots.)515 1569 y FA(Pro)s(cessor)31
b(na)m(vigation)h(and)h(insp)s(ection)d Fg(C)7 b Fx(++)31
b FA(source)g(\014les)515 1739 y Fn(4.6.5)112 b(F)-9
b(rozen)38 b(pro)s(cessors)722 1892 y FA(NOTE:)27 b Fz(Not)h(y)n(et)f
(implemen)n(ted.)515 2108 y FA(F)-8 b(reezing)31 b(pro)s(cessors)515
2261 y Fz(T)-7 b(o)29 b(freeze)g(a)g(pro)r(cessor)e(w)n(e)i(freeze)g
(the)h(run)g(queue)f(slots)g(and)g(the)h(trap)f(and)g(in)n(terrupt)515
2361 y(tables.)62 b(Unlik)n(e)36 b(other)g(con)n(tainers,)h(pro)r
(cessors)d(freeze)h(their)h(resource)f(unit)i(eagerly)-7
b(,)515 2460 y(not)34 b(lazily)-7 b(.)57 b(The)35 b(reason)e(is)h(that)
h(w)n(e)f(exp)r(ect)h(few)g(resource)d(units)j(and)g(doing)f(a)g(lazy)
515 2560 y(freeze/melt)27 b(w)n(ould)g(degrade)f(p)r(erformance.)639
2660 y(W)-7 b(e)28 b(need)g(these)g(metho)r(ds)f(to)h(supp)r(ort)f
Fx(freeze)p Fz(,)515 2776 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 2776 V 29 w(Processor)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 2867 y Fi(//)39 b(These)i(are)f(for)g
(freeze:)598 2959 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g
(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 3050 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
3141 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 3233
y(const)f(off_prtl_id_t)i(&frozen_domain\);)598 3415
y(//)d(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f(toavail)
h(bytes.)598 3507 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e
(size_t)f(&toavail\))h(const;)639 3631 y Fz(as)27 b(w)n(ell)h(as)e
(these)i(others)f(to)g(supp)r(ort)h Fx(melt)p Fz(:)515
3747 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3747 V 29 w(Processor)p Fj(.)i Fk(i)p Fz(+)o
Fq(\021)598 3839 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
3930 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 4021 y(//)f(return.)598
4113 y(virtual)i(err_t)f(cleanup\(void\);)598 4204 y(//)f(Restores)i
(the)f(static)h(state)f(from)g(a)g(user)g(supplied)h(buffer.)598
4295 y(virtual)g(err_t)f(restore_state\(char)j(*&buf,)e(size_t)f
(&bsize\);)598 4387 y(//)f(Restores)i(dynamic)g(resource)g(state.)598
4478 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 4569 y(const)h(off_prtl_id_t)h
(&melted_domain\);)1885 5255 y Fz(436)p eop
PStoPSsaved restore
%%Page: (438,439) 220
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
437 438 bop 639 523 a Fz(The)28 b(most)f(simple)h(are)f
Fx(cleanup)d Fz(and)k Fx(copy)p 2086 523 27 4 v 30 w(state)p
Fz(.)515 639 y Fk(h)p Fi(off)p 667 639 24 4 v 29 w(Processor::cleanup)j
Fj(implementation.)d Fk(i)o Fq(\021)598 731 y Fi(//)39
b(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g(should)g(be)f
(used)g(after)598 822 y(//)f(return.)598 913 y(err_t)h
(off_Processor::cleanup\(void\))598 1005 y({)676 1096
y(assert\(valid\(\))j(&&)c(p_name)i(&&)f(p_url\);)676
1187 y(delete[])h(p_name;)676 1279 y(delete[])g(p_url;)676
1370 y(return)g(EOK;)598 1461 y(})639 1677 y Fz(T)-7
b(o)39 b(cop)n(y)f(the)i(pro)r(cessor)d(static)i(state)g(w)n(e)g(cop)n
(y)f(the)h(pro)r(cessor)e(itself.)72 b(W)-7 b(e)40 b(for-)515
1777 y(get)27 b(ab)r(out)g(run)g(queues,)g(trap)g(and)g(in)n(terrupt)g
(tables)g(b)r(ecause)f Fx(freeze)p 2844 1777 27 4 v 29
w(state)g Fz(already)515 1876 y(freezes)h(ev)n(ery)f(pro)r(cessor)f
(comp)r(onen)n(t.)515 2009 y Fk(h)p Fi(off)p 667 2009
24 4 v 29 w(Processor::copy)p 1281 2009 V 31 w(state)k
Fj(implementation.)e Fk(i)p Fq(\021)598 2100 y Fi(//)39
b(Copy)i(static)f(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h
(bytes.)598 2192 y(err_t)f(off_Processor::copy_state\(cha)q(r)45
b(*&curto,)c(size_t)g(&toavail\))g(const)598 2283 y({)676
2374 y(assert\(valid\(\)\);)676 2466 y(if)f(\(curto\){)755
2557 y(if)f(\(toavail<sizeof\(*this\)\))833 2648 y(return)i(ENOSPC;)755
2740 y(//*\(off_Processor*\)curto)j(=)c(*this;)g(XXX)755
2831 y(assert\(\(\(off_Processor*\)curto\)-)q(>val)q(id\(\))q(\);)755
2922 y(curto)g(+=)g(sizeof\(*this\);)755 3014 y
(toavail-=sizeof\(*this\);)676 3105 y(})676 3196 y(return)h(EOK;)598
3288 y(})639 3520 y Fz(The)30 b(coun)n(terpart,)e Fx(restore)p
1600 3520 27 4 v 29 w(state)p Fz(,)f(uses)i Fx(can)p
2209 3520 V 30 w(melt)f Fz(to)h(kno)n(w)g(if)h(the)f(frozen)g(pro-)515
3620 y(cessor)d(can)h(b)r(e)h(melted)g(on)f(this)h(one.)515
3736 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3736 24 4 v 29 w(Processor)p Fj(.)i Fk(i)p
Fz(+)o Fq(\021)598 3827 y Fi(//)39 b(Is)h(the)g(other)g(bank)h
(meltable)g(at)e(this)h(one?)598 3919 y(boolean_t)h(can_melt\(const)h
(off_Processor)h(*other\))d(const;)1885 5255 y Fz(437)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
438 439 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Processor::restore)p 1398 523 V 32 w(state)28 b
Fj(implementation.)g Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g(supplied)h
(buffer.)598 706 y(err_t)f(off_Processor::restore_state\()q(char)46
b(*&buf,)40 b(size_t)h(&bsize\))598 797 y({)676 888 y(off_Processor)h
(*other=\(off_Processor*\)buf;)676 980 y(assert\(valid\(\)\);)676
1071 y(if)e(\(buf\){)755 1162 y(if)f(\(bsize)i(<)e(sizeof\(*this\))k
(||)c(!can_melt\(other\)\){)833 1254 y(return)i(EINVAL;)755
1345 y(})755 1436 y(assert\(other->valid\(\)\);)755 1528
y(//*this=*other;)h(XXX)755 1619 y(buf+=sizeof\(*this\);)755
1710 y(bsize-=sizeof\(*this\);)676 1802 y(})676 1893
y(return)f(EOK;)598 1984 y(})722 2300 y FA(NOTE:)27 b
Fz(XXX)i(freeze)e(traps,)g(irqs)f(and)i(allo)r(c.)515
2474 y Fk(h)p Fi(off)p 667 2474 V 29 w(Processor::can)p
1242 2474 V 31 w(melt)g Fj(implementation.)g Fk(i)p Fq(\021)598
2565 y Fi(//)39 b(Is)h(the)g(other)g(IO)g(meltable)h(at)f(this)g(one?)
598 2657 y(boolean_t)h(off_Processor::can_melt\(const)46
b(off_Processor)c(*other\))f(const)598 2748 y({)676 2839
y(//)f(XXX)g(do)f(check)i(it!)676 2931 y(assert\(valid\(\))i(&&)c
(other)i(&&)e(other->valid\(\)\);)676 3022 y(return)i(TRUE;)598
3113 y(})515 3379 y Fk(h)p Fi(off)p 667 3379 V 29 w(Processor::freeze)p
1359 3379 V 32 w(state)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 3470 y Fi(//)39 b(Freeze)i(dynamic)g(resource)g(state)f(at)
g(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 3562
y(err_t)f(off_Processor::freeze_state\(c)q(har)46 b(*buf,)40
b(char)g(*&curbuf,)h(size_t)g(&avail,)1931 3653 y(char)g(*&curto,)g
(size_t)f(&toavail,)1931 3744 y(const)h(off_prtl_id_t)h
(&frozen_domain\))598 3836 y({)676 3927 y(\(void\)curto;)g
(\(void\)toavail;)676 4018 y(assert\(valid\(\))h(&&)c(buf)h(&&)g
(curbuf\);)676 4110 y(set_domain\(frozen_domain\);)676
4201 y(if)g(\(!::freeze\(p_name,buf,curbuf,a)q(vail)q(\))45
b(||)833 4292 y(!::freeze\(p_url,buf,curbuf,av)q(ail\))q(\))755
4384 y(return)40 b(ENOSPC;)676 4566 y(//)g(XXX)g(freeze)g(traps,)h
(irqs)f(and)g(run)g(queue.)676 4749 y(return)h(ENOSYS;)598
4840 y(})1885 5255 y Fz(438)p eop
PStoPSsaved restore
%%Page: (440,441) 221
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
439 440 bop 515 523 a Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
614 y Fi(#include)41 b(<klib/freeze.h>)317 b(//)40 b(for)g(::freeze,)h
(::melt)f(et)g(al.)515 789 y Fk(h)p Fi(off)p 667 789
24 4 v 29 w(Processor::melt)p 1281 789 V 31 w(state)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 880 y Fi(//)39
b(Restores)i(dynamic)g(resource)g(state.)598 971 y(err_t)f
(off_Processor::melt_state\(cha)q(r)45 b(*&buf,)c(size_t)f(&bsize,)1853
1063 y(char)g(*&from,)h(size_t)g(&size,)1853 1154 y(const)f
(off_prtl_id_t)j(&melted_domain\))598 1245 y({)676 1337
y(assert\(valid\(\))g(&&)c(buf\);)676 1428 y(\(void\)from;)j
(\(void\)size;)676 1519 y(p_name=::melt\(p_name,buf,bsi)q(ze\);)676
1611 y(p_url=::melt\(p_url,buf,bsize)q(\);)676 1702 y
(set_domain\(melted_domain\);)676 1793 y(//)e(melt)g(traps,)h(irqs)f
(and)g(run)g(queue.)676 1885 y(return)h(EOK;)598 1976
y(})515 2325 y FA(F)-8 b(reezing)31 b(run)h(queue)g(slots)515
2478 y Fz(W)-7 b(e)28 b(need)f(to)h(implemen)n(t)g(only)f(these)h
(metho)r(ds:)515 2594 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 2594 V 29 w(RunqSlot)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 2685 y Fi(//)39 b(Copy)i(static)f(resource)h
(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598 2777
y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f(&toavail\))h
(const;)598 2959 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g
(user)g(supplied)h(buffer.)598 3051 y(virtual)g(err_t)f
(restore_state\(char)j(*&buf,)e(size_t)f(&bsize\);)598
3142 y(//)f(Restores)i(dynamic)g(resource)g(state.)515
3300 y Fk(h)p Fi(off)p 667 3300 V 29 w(RunqSlot::copy)p
1242 3300 V 31 w(state)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 3391 y Fi(//)39 b(Copy)i(static)f(resource)h(state)g(in)e
(curbuf)i(with)f(toavail)h(bytes.)598 3482 y(err_t)f
(off_RunqSlot::copy_state\(char)46 b(*&curto,)41 b(size_t)g(&toavail\))
g(const)598 3574 y({)676 3665 y(assert\(valid\(\)\);)676
3756 y(if)f(\(curto\){)755 3848 y(if)f(\(toavail<sizeof\(*this\)\))833
3939 y(return)i(ENOSPC;)755 4030 y(*\(off_RunqSlot*\)curto)j(=)39
b(*this;)755 4122 y(assert\(\(\(off_RunqSlot*\)curto\)->)q(vali)q
(d\(\)\))q(;)755 4213 y(curto)h(+=)g(sizeof\(*this\);)755
4304 y(toavail-=sizeof\(*this\);)676 4396 y(})676 4487
y(return)h(EOK;)598 4578 y(})1885 5255 y Fz(439)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
440 441 bop 639 523 a Fz(Note)28 b(ho)n(w)e(in)i(this)g(one)e(w)n(e)h
(tak)n(e)g(care)f(that)i(the)g(reference)e(to)h(the)h(con)n(tainer)e
(is)h(not)515 623 y(a\013ected)g(b)n(y)h(the)g(state)f(restore.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(RunqSlot::restore)p
1359 756 V 32 w(state)h Fj(implementation.)g Fk(i)p Fq(\021)598
847 y Fi(//)39 b(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 938 y(err_t)f(off_RunqSlot::restore_state\(c)q
(har)46 b(*&buf,)40 b(size_t)h(&bsize\))598 1029 y({)676
1121 y(off_RunqSlot)h(*other=\(off_RunqSlot*\)buf;)676
1212 y(assert\(valid\(\)\);)676 1303 y(if)e(\(buf\){)755
1395 y(off_Processor)i(*bank=\(off_Processor*\)get_cont)q(aine)q
(r\(\);)755 1486 y(if)d(\(bsize)i(<)e(sizeof\(*this\)\){)833
1577 y(return)i(EINVAL;)755 1669 y(})755 1760 y
(assert\(other->valid\(\)\);)755 1851 y(*this=*other;)755
1943 y(set_container\(\(off_CompResource)q(*\)ba)q(nk\);)755
2034 y(buf+=sizeof\(*this\);)755 2125 y(bsize-=sizeof\(*this\);)676
2217 y(})676 2308 y(return)g(EOK;)598 2399 y(})515 2765
y Fn(4.6.6)112 b(Dumping)37 b(pro)s(cessors)515 2934
y(4.6.7)112 b(Pro)s(cessors)37 b(and)i(pro)s(cessor)f(p)s(o)s(ols)f
(for)g(plain)g(users)515 3079 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l
(essor)j(for)e(users.)g Fk(i)p Fq(\021)598 3171 y Fi(class)40
b(off_uProcessor)j(:)c(public)i(off_uHWCompResource)i({)598
3262 y(public:)598 3353 y(#ifdef)d(__KERNEL__)676 3445
y(off_uProcessor\(off_Processor)46 b(*r\):)40 b
(off_uHWCompResource\(r\))k({;})676 3536 y
(off_uProcessor\(off_Processor)i(&r\):)40 b(off_uHWCompResource\(&r\))k
({;})598 3627 y(#endif)676 3719 y(off_uProcessor\(void\))g({;})676
3810 y(off_uProcessor\(const)g(off_id_t)d(&id\):)f
(off_uHWCompResource\(id\))45 b({;})598 3993 y(#ifndef)c(__KERNEL__)676
4084 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k(for)c(users)i(metho)l
(ds.)g Fk(i)598 4267 y Fi(#endif)598 4449 y(};)1885 5255
y Fz(440)p eop
PStoPSsaved restore
%%Page: (442,443) 222
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
441 442 bop 639 523 a Fz(Pro)r(cessors)25 b(pro)n(vide:)515
689 y FA(allo)s(c)41 b Fz(Allo)r(cates)27 b(a)g(new)h(run)f(queue)h
(slot.)36 b(Receiv)n(es:)822 855 y Fq(\017)41 b Fz(Protection)26
b(for)h(the)h(slot)g(b)r(eing)f(allo)r(cated)g Fx(p)p
Fz(.)822 988 y Fq(\017)41 b Fz(Domain)27 b(for)g(the)h(slot)g(b)r(eing)
f(allo)r(cated)g Fx(domain)p Fz(.)822 1121 y Fq(\017)41
b Fz(A)28 b(sh)n(uttle)g(to)f(run)h(in)g(the)g(slot)f
Fx(s)p Fz(.)822 1254 y Fq(\017)41 b Fz(Execute)27 b(access)f(righ)n(ts)
h(for)g(the)h(sh)n(uttle)g Fx(sr)p Fz(.)822 1386 y Fq(\017)41
b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(domain)f
Fx(dr)p Fz(.)822 1519 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(write)i(for)f(the)h(pro)r(cessor)d Fx(r)p
Fz(.)722 1652 y Fk(h)p Fj(O\013)i(pr)l(o)l(c)l(essor)k(for)c(users)i
(metho)l(ds.)g Fk(i)p Fq(\021)805 1743 y Fi(//)40 b(Allocates)h(any)f
(rq)805 1835 y(off_ts_id_t)i(alloc\(off_Protection)i(p,)1511
1926 y(off_prtl_id_t)82 b(domain,)1511 2017 y(off_shtl_id_t)43
b(s,)1511 2109 y(off_Rights)f(sr,)1511 2200 y(off_Rights)g(dr,)1511
2291 y(off_Rights)g(r\){)884 2383 y(off_proc_alloc_req)h
(req\(p,domain,s,sr,dr,r\);)884 2474 y(off_proc_alloc_rep)g(rep;)884
2565 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
2657 y(if)f(\(err)i(||)e(rep.m_err\))962 2748 y
(errno=\(err\)?err:rep.m_err;)884 2839 y(return)h(rep.res;)805
2931 y(})722 3138 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k
(messages.)e Fk(i)o Fq(\021)805 3230 y Fi(#define)41
b(OFF_MSG_PROC_ALLOC)i(0x01f)884 3321 y(struct)d(off_proc_alloc_req:)k
(public)d(off_KernReq)g({)962 3412 y(off_Protection)i(prot;)962
3504 y(off_prtl_id_t)82 b(dom;)962 3595 y(off_shtl_id_t)g(sh;)962
3686 y(off_Rights)199 b(sright;)962 3778 y(off_Rights)g(dright;)962
3869 y(off_proc_alloc_req\(off_Prote)q(ctio)q(n)45 b(p,)1825
3960 y(off_prtl_id_t)82 b(domain,)1825 4051 y(off_shtl_id_t)g(s,)1825
4143 y(off_Rights)42 b(sr,)1825 4234 y(off_Rights)g(dr,)1825
4325 y(off_Rights)g(r\):)1041 4417 y
(prot\(p\),dom\(domain\),sh\(s\),srig)q(ht\(sr)q(\),dr)q(ight\()q
(dr\),)1041 4508 y(off_KernReq\(OFF_MSG_PROC_ALLOC)q(,r\))j({;})884
4599 y(};)884 4691 y(struct)40 b(off_proc_alloc_rep:)k(public)d
(off_KernRep)g({)962 4782 y(off_ts_id_t)h(res;)962 4873
y(off_proc_alloc_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i({;})884
4965 y(};)1885 5255 y Fz(441)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
442 443 bop 722 523 a Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k(for)c
(users)i(in-kernel)g(metho)l(ds.)f Fk(i)p Fq(\021)884
614 y Fi(void)40 b(alloc\(off_proc_alloc_req)45 b
(*m,off_proc_alloc_rep)83 b(*r\))884 706 y({)962 797
y(off_RunqSlot)42 b(*s;)962 888 y(s=new\(\(off_Processor*\)w_r\))j
(off_RunqSlot\(m->prot,m->dom)q(,m->s)q(h\);)962 980
y(if)40 b(\(!s\))1041 1071 y(r->m_err=EAGAIN;)962 1162
y(r->res=\(s\)?s->get_id\(\):OFF_I)q(D_NU)q(LL;)884 1254
y(})515 1494 y FA(free)h Fz(Deallo)r(cates)27 b(a)g(run)h(queue)f
(slot.)37 b(Receiv)n(es:)822 1660 y Fq(\017)k Fz(The)28
b(iden)n(ti\014er)f(of)h(the)g(slot)f(b)r(eing)h(released)e
Fx(s)p Fz(.)822 1793 y Fq(\017)41 b Fz(Delete)28 b(access)e(righ)n(ts)h
(for)g(the)h(slot)f Fx(r)p Fz(.)722 1926 y Fk(h)p Fj(O\013)g(pr)l(o)l
(c)l(essor)k(for)c(users)i(metho)l(ds.)g Fk(i)p Fz(+)o
Fq(\021)805 2017 y Fi(//)40 b(Deallocates)i(a)d(rq)805
2109 y(void)h(free\()h(off_ts_id_t)h(s,)d(off_Rights)j(r\){)884
2200 y(off_proc_free_req)h(req\(s,r\);)884 2291 y(off_proc_free_rep)g
(rep;)884 2383 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
2474 y(if)f(\(err)i(||)e(rep.m_err\))962 2565 y
(errno=\(err\)?err:rep.m_err;)805 2657 y(})722 2864 y
Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k(messages.)e
Fk(i)o Fz(+)p Fq(\021)805 2956 y Fi(#define)41 b(OFF_MSG_PROC_FREE)i
(0x03f)884 3047 y(struct)d(off_proc_free_req:)k(public)c(off_KernReq)i
({)962 3138 y(off_ts_id_t)81 b(id;)962 3230 y
(off_proc_free_req\(off_ts_id_)q(t)45 b(s,)40 b(off_Rights)h(r\):)f
(id\(s\),)1041 3321 y(off_KernReq\(OFF_MSG_PROC_FREE,)q(r\))45
b({;})884 3412 y(};)884 3504 y(struct)40 b(off_proc_free_rep:)k(public)
c(off_KernRep)i({)962 3595 y(off_proc_free_rep\(err_t)j(r=0\))40
b(:)f(off_KernRep\(r\))k({;})884 3686 y(};)722 3894 y
Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k(for)c(users)i(in-kernel)g
(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)884 3985 y Fi(void)40
b(free\(off_proc_free_req)k(*m,off_proc_free_rep)83 b(*r\))884
4076 y({)962 4168 y(\(void\)r;)962 4259 y(if)40 b
(\(!\(\(off_Processor*\)w_r\)->is_l)q(ocal\()q(m->i)q(d\)\))1041
4350 y(panic\("proc:)i(should)e(raise)h(missing,)g(but)f(not)f(yet)h
(implemented."\);)962 4442 y(delete)h
(\(\(*\(off_Processor*\)w_r\)+m->id\))q(;)884 4533 y(})1885
5255 y Fz(442)p eop
PStoPSsaved restore
%%Page: (444,445) 223
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
443 444 bop 515 523 a FA(gettraps)41 b Fz(Returns)28
b(the)g(pro)r(cessor)d(trap)i(table.)37 b(Receiv)n(es:)822
689 y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(pro)r
(cessor)e Fx(r)p Fz(.)722 822 y Fk(h)p Fj(O\013)h(pr)l(o)l(c)l(essor)k
(for)c(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805
913 y Fi(//)40 b(Returns)h(the)f(trap)g(table.)805 1005
y(off_uTrapTbl)i(gettraps\(off_Rights)i(r\){)884 1096
y(off_proc_get_traps_req)g(req\(r\);)884 1187 y(off_proc_get_traps_rep)
g(rep;)884 1279 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
1370 y(if)f(\(err)i(||)e(rep.m_err\))962 1461 y
(errno=\(err\)?err:rep.m_err;)884 1553 y(return)h(rep.traps;)805
1644 y(})722 1851 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k
(messages.)e Fk(i)o Fz(+)p Fq(\021)805 1943 y Fi(#define)41
b(OFF_MSG_PROC_GETTRAPS)j(0x04f)884 2034 y(struct)c
(off_proc_get_traps_req:)45 b(public)40 b(off_KernReq)i({)962
2125 y(off_proc_get_traps_req\(off_R)q(ight)q(s)j(r\):)1041
2217 y(off_KernReq\(OFF_MSG_PROC_GETTR)q(APS,r)q(\))g({;})884
2308 y(};)884 2399 y(struct)40 b(off_proc_get_traps_rep:)45
b(public)40 b(off_KernRep)i({)962 2491 y(off_uTrapTbl)g(traps;)962
2582 y(off_proc_get_traps_rep\(err_t)k(r=0\))40 b(:)f(off_KernRep\(r\))
k({;})884 2673 y(};)722 2881 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)
k(for)c(users)i(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p
Fq(\021)884 2972 y Fi(void)40 b(gettraps\(off_proc_get_traps_r)q(eq)45
b(*m,off_proc_get_traps_rep)84 b(*r\))884 3064 y({)962
3155 y(\(void\)m;)962 3246 y(r->traps=\(\(off_Processor*\)w_)q(r\)->)q
(get_t)q(raps)q(\(\);)884 3337 y(})515 3578 y FA(getirqs)41
b Fz(Returns)27 b(the)h(pro)r(cessor)e(in)n(terrupt)h(table.)37
b(Receiv)n(es:)822 3744 y Fq(\017)k Fz(Read)27 b(access)g(righ)n(ts)f
(for)h(the)h(pro)r(cessor)e Fx(r)p Fz(.)722 3877 y Fk(h)p
Fj(O\013)h(pr)l(o)l(c)l(essor)k(for)c(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)805 3968 y Fi(//)40 b(Returns)h(the)f(interrupt)h
(table.)805 4060 y(off_uIntTbl)h(getirqs\(off_Rights)h(r\){)884
4151 y(off_proc_get_irqs_req)h(req\(r\);)884 4242 y
(off_proc_get_irqs_rep)g(rep;)884 4334 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 4425 y(if)f(\(err)i(||)e
(rep.m_err\))962 4516 y(errno=\(err\)?err:rep.m_err;)884
4608 y(return)h(rep.irqs;)805 4699 y(})1885 5255 y Fz(443)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
444 445 bop 722 523 a Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k
(messages.)e Fk(i)o Fz(+)p Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_PROC_GETIRQS)j(0x05f)884 706 y(struct)c
(off_proc_get_irqs_req:)45 b(public)40 b(off_KernReq)i({)962
797 y(off_proc_get_irqs_req\(off_Ri)q(ghts)k(r\):)1041
888 y(off_KernReq\(OFF_MSG_PROC_GETIR)q(QS,r\))g({;})884
980 y(};)884 1071 y(struct)40 b(off_proc_get_irqs_rep:)45
b(public)40 b(off_KernRep)i({)962 1162 y(off_uIntTbl)g(irqs;)962
1254 y(off_proc_get_irqs_rep\(err_t)k(r=0\))40 b(:)f(off_KernRep\(r\))k
({;})884 1345 y(};)722 1553 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k
(for)c(users)i(in-kernel)g(metho)l(ds.)f Fk(i)p Fz(+)p
Fq(\021)884 1644 y Fi(void)40 b(getirqs\(off_proc_get_irqs_req)46
b(*m,off_proc_get_irqs_rep)84 b(*r\))884 1735 y({)962
1826 y(\(void\)m;)962 1918 y(r->irqs=\(\(off_Processor*\)w_r)q(\)->g)q
(et_ir)q(qs\(\))q(;)884 2009 y(})515 2242 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor)j(for)e(users)h(in-kernel.)f Fk(i)p
Fq(\021)598 2333 y Fi(class)40 b(off_kProcessor)j(:)c(public)i
(off_kHWCompResource)i({)598 2424 y(public:)676 2516
y(static)e(err_t)f(handler\(const)i(off_shtl_id_t)h(&sender,)1500
2607 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 2698
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676 2881 y(virtual)g(err_t)f
(handle\(const)i(off_shtl_id_t)h(&sender,)1500 2972 y(vm_size_t)e(msz,)
f(vm_size_t)i(rsz,)1500 3064 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))f
({)755 3155 y(return)g(handler\(sender,msz,rsz,m,r\);)676
3246 y(})676 3429 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)k(for)c
(users)i(in-kernel)g(metho)l(ds.)f Fk(i)598 3520 y Fi(};)1885
5255 y Fz(444)p eop
PStoPSsaved restore
%%Page: (446,447) 224
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
445 446 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(kProcessor::handler)31 b Fj(implementation.)d Fk(i)p
Fq(\021)598 614 y Fi(err_t)40 b(off_kProcessor::handler\(const)46
b(off_shtl_id_t)c(&sender,)1657 706 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)1657 797 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598
888 y({)676 980 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 1071 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 1162 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 1254 y
(do_debug\(printf\("proc[\045x]",m)q(->m_t)q(ype\))q(\);)676
1345 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)755 1436
y(off_ts_id_t)h(s=\(\(off_ObjKernReq*\)m\)->obj)q(;)755
1528 y(if)e(\(!nd.get_proc\(0\).is_local\(s\))q(\))833
1619 y(panic\("proc:)j(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)755 1710 y(else)g({)833 1802 y(panic\("ts:)i(not)e
(wrapped."\);)755 1893 y(})676 1984 y(})676 2076 y(r->m_err=EOK;)676
2167 y(switch\(m->m_type\){)676 2258 y(case)g(OFF_MSG_R_INIT:)755
2350 y(return)g(EOK;)676 2441 y(case)g(OFF_MSG_PROC_ALLOC:)755
2532 y(if)f(\(!nd.get_proc\(0\).access_gran)q(ted\()q(OFF_)q(OP_W,)q
(m->m)q(_righ)q(ts\)\))833 2623 y(r->m_err=)i(EPERM;)755
2715 y(else)f(if)f(\(msz!=sizeof\(off_proc_alloc)q(_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_proc_alloc_rep\))q(\))833
2806 y(r->m_err=)h(EINVAL;)755 2897 y(else)f({)833 2989
y(kproc.alloc\(\(off_proc_alloc_r)q(eq*\))q(m,\(o)q(ff_pr)q(oc_a)q
(lloc_)q(rep*)q(\)r\);)755 3080 y(})755 3171 y(return)g(EOK;)637
3263 y(case)g(OFF_MSG_PROC_FREE:)755 3354 y(if)f
(\(msz!=sizeof\(off_proc_free_r)q(eq\))46 b(||)39 b
(rsz!=sizeof\(off_proc_free_re)q(p\)\))833 3445 y(r->m_err=EINVAL;)755
3537 y(else)h({)833 3628 y(kproc.free\(\(off_proc_free_req)q(*\)m,)q
(\(off)q(_proc)q(_fre)q(e_rep)q(*\)r\))q(;)755 3719 y(})755
3811 y(return)g(EOK;)637 3993 y(case)g(OFF_MSG_PROC_GETTRAPS:)755
4085 y(if)f(\(msz!=sizeof\(off_proc_get_tr)q(aps_)q(req\))46
b(||)39 b(rsz!=sizeof\(off_proc_get_tr)q(aps_r)q(ep\)\))833
4176 y(r->m_err=EINVAL;)755 4267 y(else)h({)833 4359
y(kproc.gettraps\(\(off_proc_get_)q(trap)q(s_re)q(q*\)m,)q(\(off)q
(_proc)q(_get)q(_tra)q(ps_re)q(p*\)r)q(\);)755 4450 y(})755
4541 y(return)g(EOK;)637 4724 y(case)g(OFF_MSG_PROC_GETIRQS:)755
4815 y(if)f(\(msz!=sizeof\(off_proc_get_ir)q(qs_r)q(eq\))46
b(||)39 b(rsz!=sizeof\(off_proc_get_irq)q(s_rep)q(\)\))833
4907 y(r->m_err=EINVAL;)755 4998 y(else)h({)1885 5255
y Fz(445)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
446 447 bop 833 523 a Fi(kproc.getirqs\(\(off_proc_get_i)q(rqs_)q(req*)
q(\)m,\(o)q(ff_p)q(roc_g)q(et_i)q(rqs_)q(rep*\))q(r\);)755
614 y(})755 706 y(return)40 b(EOK;)676 797 y(case)g
(OFF_MSG_INTTBL_ALLOCAT:)676 888 y(case)g(OFF_MSG_INTTBL_FREE:)755
980 y({)755 1071 y(off_kTrapTbl)i(ktraps\(nd.get_proc\(0\).get_traps)q
(\(\)\);)755 1162 y(return)e(ktraps.handle\(sender,msz,rsz)q(,m,r)q
(\);)755 1254 y(})676 1345 y(case)g(OFF_MSG_TRAPTBL_ALLOCAT:)676
1436 y(case)g(OFF_MSG_TRAPTBL_FREE:)755 1528 y({)755
1619 y(off_kIntTbl)h(kirqs\(nd.get_proc\(0\).get_ir)q(qs\(\)\))q(;)755
1710 y(return)f(kirqs.handle\(sender,msz,rsz,)q(m,r\))q(;)755
1802 y(})676 1893 y(default:)755 1984 y(return)g
(\(\(off_kHWCompResource*\)&kpro)q(c\)->)q(handl)q(e\(se)q(nder,)q
(msz,)q(rsz,)q(m,r\);)676 2076 y(})598 2167 y(})515 2532
y Fn(4.6.8)112 b(Pro)s(cessors)37 b Fd(C)8 b FC(++)38
b Fn(source)g(\014les)515 2685 y Fz(Pro)r(cessor)25 b(co)r(de)i(is)g(k)
n(ept)h(in)g Fx(hw/Processor.h)22 b Fz(and)27 b Fx(hw/Processor.C)p
Fz(.)515 2818 y Fk(h)p Fj(Pr)l(o)l(c)l(essor.h*)11 b
Fk(i)r Fq(\021)598 2910 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 3001 y
Fi(#ifndef)41 b(__OFF_PROCESSOR_H)598 3092 y(#define)g
(__OFF_PROCESSOR_H)i(1)598 3275 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor)j(dep)l(endencies.)f Fk(i)598 3457
y Fi(#ifdef)40 b(__KERNEL__)598 3549 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor.)j Fk(i)598 3640 y Fi(#endif)40
b(//)g(__KERNEL__)598 3823 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j
(late)e(dep)l(endencies.)h Fk(i)598 3914 y Fi(#include)41
b(<prtl/ex.h>)598 4005 y(#include)g(<hw/uProcessor.h>)598
4188 y(#ifdef)f(__KERNEL__)598 4279 y Fk(h)p Fi(off)p
750 4279 24 4 v 29 w(Processor::get)p 1325 4279 V 31
w(allocator)29 b Fj(implementation.)f Fk(i)598 4371 y(h)p
Fi(off)p 750 4371 V 29 w(Processor::get)p 1325 4371 V
31 w(traps)h Fj(and)f Fi(get)p 1846 4371 V 28 w(irqs)h
Fj(implementation.)e Fk(i)598 4462 y(h)p Fi(off)p 750
4462 V 29 w(Processor::get)p 1325 4462 V 31 w(trap)h
Fj(and)g Fi(get)p 1806 4462 V 29 w(irq)g Fj(implementation.)g
Fk(i)598 4553 y(h)p Fi(off)p 750 4553 V 29 w(Processor::cli)i(sti)e(is)
p 1578 4553 V 29 w(cli)g Fj(and)g Fi(hlt)g Fj(implementation.)g
Fk(i)598 4645 y(h)p Fi(off)p 750 4645 V 29 w(Processor::operator+)k
Fj(implementation.)27 b Fk(i)598 4736 y Fi(#endif)40
b(//)g(__KERNEL__)598 4919 y(#endif)g(//)g(__OFF_PROCESSOR_H)1885
5255 y Fz(446)p eop
PStoPSsaved restore
%%Page: (448,449) 225
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
447 448 bop 515 523 a Fk(h)p Fj(Pr)l(o)l(c)l(essor.C*)11
b Fk(i)r Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<hw/Processor.h>)278 b(//)40 b(Exported)h(interface.)
598 888 y Fk(h)p Fj(O\013)27 b(pr)l(o)l(c)l(essor)j(implementation)e
(dep)l(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(pr)l(o)l(c)l(essor)j
(static)f(memb)l(ers.)f Fk(i)598 1254 y(h)p Fi(off)p
750 1254 24 4 v 29 w(Processor::self)i Fj(implementation.)e
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(Processor::start)j
Fj(implementation.)c Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(Processor::alloc)k Fj(and)d Fi(free)g Fj(implementation.)f
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(Processor::start)p
1403 1528 V 31 w(clk)i Fj(implementation.)e Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(Processor::new)p
1325 1619 V 31 w(quantum)i Fj(implementation.)e Fk(i)598
1710 y(h)p Fi(off)p 750 1710 V 29 w(Processor::nameof)k
Fj(implementation.)c Fk(i)598 1802 y(h)p Fi(off)p 750
1802 V 29 w(Processor::get)p 1325 1802 V 31 w(url)h Fj(implementation.)
g Fk(i)598 1893 y(h)p Fi(off)p 750 1893 V 29 w(Processor::restore)p
1481 1893 V 32 w(state)g Fj(implementation.)g Fk(i)598
1984 y(h)p Fi(off)p 750 1984 V 29 w(Processor::cleanup)j
Fj(implementation.)d Fk(i)598 2076 y(h)p Fi(off)p 750
2076 V 29 w(Processor::copy)p 1364 2076 V 31 w(state)h
Fj(implementation.)e Fk(i)598 2167 y(h)p Fi(off)p 750
2167 V 29 w(Processor::freeze)p 1442 2167 V 32 w(state)h
Fj(implementation.)g Fk(i)598 2258 y(h)p Fi(off)p 750
2258 V 29 w(Processor::melt)p 1364 2258 V 31 w(state)h
Fj(implementation.)e Fk(i)598 2350 y(h)p Fi(off)p 750
2350 V 29 w(Processor::can)p 1325 2350 V 31 w(melt)h
Fj(implementation.)g Fk(i)598 2441 y(h)p Fi(off)p 750
2441 V 29 w(Processor::get)p 1325 2441 V 31 w(current)h
Fj(implementation.)e Fk(i)598 2532 y(h)p Fi(off)p 750
2532 V 29 w(Processor::self)p 1364 2532 V 31 w(start)i
Fj(implementation.)e Fk(i)639 2673 y Fz(Run)h(queue)g(slots)f(are)f
(found)i(in)g Fx(RunqSlot.h)c Fz(and)j Fx(RunqSlot.C)p
Fz(.)515 2806 y Fk(h)p Fj(R)n(unqSlot.h*)11 b Fk(i)p
Fq(\021)598 2897 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2989 y Fi(#ifndef)41
b(__OFF_RUNQ_SLOT_H)598 3080 y(#define)g(__OFF_RUNQ_SLOT_H)i(1)598
3263 y Fk(h)p Fj(O\013)27 b(run)h(queue)h(slot)f(dep)l(endencies.)h
Fk(i)598 3445 y Fi(#ifdef)40 b(__KERNEL__)598 3537 y
Fk(h)p Fj(O\013)27 b(run)h(queue)h(slot.)e Fk(i)598 3628
y Fi(#endif)40 b(//)g(__KERNEL__)598 3811 y(#ifdef)g(__KERNEL__)598
3902 y Fk(h)p Fi(off)p 750 3902 V 29 w(RunqSlot::get)p
1286 3902 V 31 w(shtl)28 b Fj(and)g Fi(set)p 1767 3902
V 29 w(shtl)g Fj(implementation.)g Fk(i)598 3993 y(h)p
Fi(off)p 750 3993 V 29 w(RunqSlot::get)p 1286 3993 V
31 w(shtlref)h Fj(implementation.)e Fk(i)598 4085 y Fi(#endif)40
b(//)g(__KERNEL__)598 4267 y(#endif)g(//)g(__OFF_RUNQ_SLOT_H)1885
5255 y Fz(447)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
448 449 bop 515 523 a Fk(h)p Fj(R)n(unqSlot.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<hw/RunqSlot.h>)278 b(//)39 b(Exported)j(interface.)598
888 y Fk(h)p Fj(O\013)27 b(run)h(queue)h(slot)f(implementation)g(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(run)h(queue)h(slot)f
(static)h(memb)l(ers.)f Fk(i)598 1162 y(h)p Fi(off)p
750 1162 24 4 v 29 w(RunqSlot::get)p 1286 1162 V 31 w(url)p
1434 1162 V 29 w(holder)g Fj(implementation.)g Fk(i)598
1254 y(h)p Fi(off)p 750 1254 V 29 w(RunqSlot::get)p 1286
1254 V 31 w(rurl)g Fj(implementation.)g Fk(i)598 1345
y(h)p Fi(off)p 750 1345 V 29 w(RunqSlot::off)p 1286 1345
V 31 w(RunqSlot)h Fj(implementation.)e Fk(i)598 1436
y(h)p Fi(off)p 750 1436 V 29 w(RunqSlot::operator)43
b(new)28 b Fj(implementation.)f Fk(i)598 1528 y(h)p Fi(off)p
750 1528 V 29 w(RunqSlot::operator)43 b(delete)29 b Fj(implementation.)
e Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(RunqSlot::copy)p
1325 1619 V 31 w(state)i Fj(implementation.)e Fk(i)598
1710 y(h)p Fi(off)p 750 1710 V 29 w(RunqSlot::restore)p
1442 1710 V 32 w(state)h Fj(implementation.)g Fk(i)598
1802 y(h)p Fi(off)p 750 1802 V 29 w(RunqSlot::cache)p
1364 1802 V 31 w(pshtl)h Fj(implementation.)e Fk(i)639
1943 y Fz(Run)h(queue)g(slot)f(allo)r(cation)g(is)g(k)n(ept)h(in)f
Fx(RqAllocator.h)c Fz(and)k Fx(RqAllocator.C)p Fz(.)515
2076 y Fk(h)p Fj(R)l(qA)n(l)t(lo)l(c)l(ator.h*)11 b Fk(i)q
Fq(\021)598 2167 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2258 y Fi(#ifndef)41
b(__OFF_RQ_ALLOCATOR_H)598 2350 y(#define)g(__OFF_RQ_ALLOCATOR_H)i(1)
598 2532 y Fk(h)p Fj(O\013)27 b(time)g(slic)l(e)h(al)t(lo)l(c)l(ator)h
(dep)l(endencies.)g Fk(i)598 2715 y Fi(#ifdef)40 b(__KERNEL__)598
2806 y Fk(h)p Fj(O\013)27 b(linkable)g(run)h(queue)h(slot.)f
Fk(i)598 2897 y(h)p Fj(O\013)f(time)g(slic)l(e)h(al)t(lo)l(c)l(ator.)g
Fk(i)598 2989 y Fi(#endif)40 b(//)g(__KERNEL__)598 3171
y(#ifdef)g(__KERNEL__)598 3263 y Fk(h)p Fi(off)p 750
3263 V 29 w(RqAllocator::operator)k(+)27 b Fj(implementation.)h
Fk(i)598 3354 y Fi(#endif)40 b(//)g(__KERNEL__)598 3537
y(#endif)g(//)g(__OFF_RQ_ALLOCATOR_H)515 3711 y Fk(h)p
Fj(R)l(qA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q Fq(\021)598
3802 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3985 y Fi(#include)41
b(<hw/RqAllocator.h>)200 b(//)40 b(Exported)h(interface.)598
4168 y Fk(h)p Fj(O\013)27 b(time)g(slic)l(e)h(al)t(lo)l(c)l(ator)h
(static)f(memb)l(ers.)g Fk(i)598 4259 y(h)p Fi(off)p
750 4259 V 29 w(RqAllocator::off)p 1403 4259 V 31 w(RqAllocator)i
Fj(implementation.)e Fk(i)515 4525 y(h)p Fj(uPr)l(o)l(c)l(essor.h*)11
b Fk(i)r Fq(\021)598 4616 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4799 y(h)p Fj(O\013)f(pr)l(o)l(c)l(essor)j(messages.)f
Fk(i)598 4890 y(h)p Fj(O\013)e(pr)l(o)l(c)l(essor)j(for)e(users.)g
Fk(i)1885 5255 y Fz(448)p eop
PStoPSsaved restore
%%Page: (450,451) 226
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
449 450 bop 515 523 a Fk(h)p Fj(kPr)l(o)l(c)l(essor.h*)11
b Fk(i)r Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<hw/Processor.h>)239 b(//)39 b(Exported)j(interface.)
598 888 y(#include)f(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
980 y(#include)h(<klib/kResource.h>)598 1071 y(#include)g(<prtl/ex.h>)
473 b(//)40 b(for)g(XDT{Req|Rep})598 1162 y(#include)h(<string.h>)598
1345 y(#ifndef)g(__OFF_KPROC_H)598 1436 y(#define)g(__OFF_KPROC_H)h(1)
598 1528 y(#ifdef)e(__KERNEL__)598 1710 y Fk(h)p Fj(O\013)27
b(pr)l(o)l(c)l(essor)j(for)e(users)h(in-kernel.)f Fk(i)598
1893 y Fi(extern)40 b(off_kProcessor)j(kproc;)598 2076
y(#endif)d(//)g(__KERNEL__)598 2167 y(#endif)g(//)g(__OFF_KPROC_H)515
2341 y Fk(h)p Fj(kPr)l(o)l(c)l(essor.C*)11 b Fk(i)r Fq(\021)598
2433 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2615 y Fi(#include)41
b(<hw/Processor.h>)239 b(//)39 b(Exported)j(interface.)598
2707 y(#include)f(<klib/str.h>)277 b(//)40 b(for)g(kcout)598
2798 y(#include)h(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
2889 y(#include)h(<string.h>)598 2980 y(#include)g(<node/Node.h>)598
3163 y(#include)g(<hw/kProcessor.h>)598 3254 y(#include)g
(<hw/kEventTbl.h>)598 3346 y(#include)g(<klib/mdep/debug.h>)598
3528 y(off_kProcessor)h(kproc;)598 3711 y Fk(h)p Fi(off)p
750 3711 24 4 v 29 w(kProcessor::handler)31 b Fj(implementation.)d
Fk(i)1885 5255 y Fz(449)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
450 451 bop 515 523 a Fn(4.6.9)112 b(Pro)s(cessors)37
b(for)h(ix86)f(based)h(arc)m(hitectures)515 676 y Fz(Mac)n(hine)31
b(dep)r(enden)n(t)h(pro)r(cessors)d(are)h(structures)h(used)g(to)h(p)r
(erform)f(mac)n(hine)g(dep)r(en-)515 776 y(den)n(t)k(tasks)g(needed)h
(to)f(implemen)n(t)h(the)g Fx(Processor)c Fz(abstraction)i(describ)r
(ed)h(b)r(efore.)515 876 y(Most)27 b(of)h(its)f(metho)r(ds)h(are)f
(simple)h(wrapp)r(ers)e(for)h(OSKit)g(or)g(nativ)n(e)g(functions.)515
994 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor.)h
Fk(i)p Fq(\021)598 1085 y Fi(//)39 b(A)h(processor)h(for)f(ix86)g
(machines.)598 1177 y(//)598 1268 y(class)g(off_mdepProcessor)j({)598
1359 y(public:)676 1542 y(//)d(Inhibits)h(interrupts.)676
1633 y(static)g(void)f(clri\(void\))h({)f(cli\(\);)g(})676
1725 y(//)g(Enables)h(interrupts.)676 1816 y(static)g(void)f
(seti\(void\))h({)f(sti\(\);)g(})676 1907 y(//)g(Are)g(interrupts)h
(enabled?)676 1999 y(static)g(boolean_t)g(has_clri\(void\))82
b({)833 2090 y(return)41 b(!\(get_eflags\(\))h(&)e(EFL_IF\);)676
2181 y(})676 2273 y(//)g(Halts)g(the)g(processor.)676
2364 y(static)h(void)f(halt\(void\))h({)f(__asm__)h(__volatile__\("hlt)
i(;)c(hlt)h(;)g(hlt)g(;)f(hlt"\);)i(})676 2546 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
2546 24 4 v 29 w(mdepProcessor)p Fj(.)j Fk(i)598 2729
y Fi(private:)676 2820 y Fk(h)p Fj(Other)f(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2820 V 29 w(mdepProcessor)p Fj(.)j Fk(i)598
2912 y Fi(};)515 3149 y Fk(h)p Fj(O\013)d(machine)h(dep)l(endent)h(pr)l
(o)l(c)l(essor)i(dep)l(endencies.)e Fk(i)p Fq(\021)598
3240 y Fi(#include)41 b(<flux/types.h>)474 b(//)39 b(for)h(boolean_t)i
(natural_t)f(et)f(al.)598 3331 y(#include)h(<flux/machine/proc_reg.h>)k
(//)39 b(for)h(cli,)g(sti)g(et)g(al.)598 3423 y(#include)h
(<flux/machine/eflags.h>)123 b(//)39 b(for)h(EFL_IF)h(et)f(al.)639
3549 y Fz(Mac)n(hine)21 b(dep)r(enden)n(t)h(pro)r(cessors)c(are)i
(created)h(from)f(the)i(pro)r(cessor)d(n)n(um)n(b)r(er,)j(whic)n(h)515
3649 y(is)27 b(k)n(ept)h(in)g(a)f(priv)-5 b(ate)27 b(mem)n(b)r(er.)515
3758 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3758 V 29 w(mdepProcessor)p Fj(.)j Fk(i)p Fq(\021)598
3849 y Fi(//)39 b(Creates)i(a)f(machine)h(dependent)g(processor.)598
3941 y(off_mdepProcessor\(natural_t)k(nb=0\);)515 4168
y Fk(h)p Fi(off)p 667 4168 V 29 w(mdepProcessor::off)p
1398 4168 V 32 w(mdepProcessor)30 b Fj(implementation.)e
Fk(i)p Fq(\021)598 4260 y Fi(//)39 b(Creates)i(a)f(machine)h(dependent)
g(processor.)598 4351 y(off_mdepProcessor::off_mdepPro)q(cesso)q(r\(na)
q(tura)q(l_t)k(nb\))40 b(:)g(p_nb\(nb\))h({;})515 4496
y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p
1552 4496 V 29 w(mdepProcessor)p Fj(.)i Fk(i)o Fq(\021)598
4588 y Fi(natural_t)41 b(p_nb;)639 4715 y Fz(Non)28 b(b)r(o)r(ot)g(pro)
r(cessors)d(are)h(really)h(started)g(only)g(after)g Fx(start)f
Fz(is)h(called.)515 4824 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4824 V 29 w(mdepProcessor)p Fj(.)j Fk(i)p
Fz(+)o Fq(\021)598 4915 y Fi(//)39 b(Starts)i(the)f(processor.)598
5006 y(void)g(start\(register_t)j(pc,)d(register_t)h(sp\);)1885
5255 y Fz(450)p eop
PStoPSsaved restore
%%Page: (452,453) 227
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
451 452 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)
l(o)l(c)l(essor)i(dep)l(endencies.)e Fk(i)p Fz(+)o Fq(\021)598
614 y Fi(#include)41 b(<flux/machine/proc_reg.h>)k(//)39
b(for)h(register_t)598 706 y(class)g(off_mdepShtl;)515
880 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor)
i(implementation)d(dep)l(endencies.)h Fk(i)p Fq(\021)598
971 y Fi(#include)41 b(<shtl/mdep/mShtl.h>)161 b(//)40
b(for)g(off_mdepShtl)515 1146 y Fk(h)p Fi(off)p 667 1146
24 4 v 29 w(mdepProcessor::start)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 1237 y Fi(//)39 b(Starts)i(the)f(processor.)598
1328 y(void)g(off_mdepProcessor::start\(regis)q(ter_)q(t)45
b(pc,)40 b(register_t)h(sp\))598 1420 y({)598 1511 y(#ifndef)g
(__NOSMP__)755 1602 y(smp_start_cpu\(p_nb,0,\(void*\)s,0)q(\);)k(//)40
b(XXX)g(use)g(run_idle)h(and)f(shuttle)h(stack.)598 1694
y(#else)755 1785 y(\(void\)pc;)g(\(void\)sp;)598 1876
y(#endif)598 1968 y(})639 2109 y Fz(The)28 b(n)n(um)n(b)r(er)f(of)h
(installed)f(pro)r(cessors)f(can)h(b)r(e)h(obtained)f(with)515
2225 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2225 V 29 w(mdepProcessor)p Fj(.)j Fk(i)p Fz(+)o
Fq(\021)598 2316 y Fi(//)39 b(#)h(of)g(processors)h(on)f(intels.)598
2408 y(static)g(natural_t)i(how_many\(void\);)639 2532
y Fz(It)28 b(uses)f(an)h(OSKit)f(routine.)515 2648 y
Fk(h)p Fi(off)p 667 2648 V 29 w(mdepProcessor::how)p
1398 2648 V 32 w(many)h Fj(implementation.)g Fk(i)p Fq(\021)598
2740 y Fi(//)39 b(#)h(of)g(processors)h(on)f(intels.)598
2831 y(natural_t)h(off_mdepProcessor::how_many\(v)q(oid\))598
2922 y({)676 3014 y Fk(h)p Fj(Initialize)27 b(glob)l(al)g(machine)h
(dep)l(endent)i(pr)l(o)l(c)l(essor)g(state.)f Fk(i)676
3105 y Fi(return)41 b(smp_get_num_cpus\(\);)598 3196
y(})639 3412 y Fz(Before)33 b(using)h Fx(smp)p 1266 3412
27 4 v 30 w(get)p 1428 3412 V 30 w(num)p 1590 3412 V
30 w(cpus)e Fz(w)n(e)i(migh)n(t)f(w)n(an)n(t)h(to)f(initialize)h(lo)n
(w-lev)n(el)e(SMP)515 3512 y(supp)r(ort.)515 3628 y Fk(h)p
Fj(Initialize)26 b(glob)l(al)i(machine)g(dep)l(endent)h(pr)l(o)l(c)l
(essor)i(state.)e Fk(i)o Fq(\021)598 3719 y Fi(static)40
b(boolean_t)i(initialized=FALSE;)598 3811 y(if)d(\(!initialized\){)676
3902 y(p_hassmp=\(smp_initialize\(\)>0)q(\);)676 3993
y(initialized=TRUE;)598 4085 y(})639 4301 y Fz(where)27
b(w)n(e)h(record)e(in)i Fx(p)p 1402 4301 V 31 w(hassmp)d
Fz(whether)i(this)h(system)f(has)h(SMP)f(or)g(not.)515
4417 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4417 24 4 v 29 w(mdepProcessor)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 4508 y Fi(static)40 b(boolean_t)i(p_hassmp;)
237 b(//)40 b(Do)f(we)h(have)g(SMP?)515 4666 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor)i(static)e
(memb)l(ers.)f Fk(i)o Fq(\021)598 4757 y Fi(boolean_t)41
b(off_mdepProcessor::p_hassmp=F)q(ALSE)q(;)241 b(//)40
b(Do)f(we)h(have)g(SMP?)1885 5255 y Fz(451)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
452 453 bop 639 523 a Fz(The)23 b(implemen)n(tation)g(of)f
Fx(self)f Fz(di\013ers)h(for)g(SMP)h(and)f(non)h(SMP)f(k)n(ernels.)34
b(On)22 b(SMP)515 623 y(k)n(ernels,)h(self)g(obtains)f(the)i(pro)r
(cessor)d(id)i(from)g(the)h(APIC)f(and)g(uses)f(that)i(is)f(as)f(an)h
(index)515 722 y(in)n(to)g(the)i(no)r(de)f(p)r(o)r(ol)g(of)g(pro)r
(cessors.)33 b(On)24 b(non)g(SMP)f(k)n(ernel)h(the)g(no)r(de)g(con)n
(tains)f(a)h(single)515 822 y Fx(Processor)g Fz(instance)j(and)g
Fx(self)f Fz(returns)h(a)h(p)r(oin)n(ter)f(to)g(it.)639
922 y(W)-7 b(e)39 b(use)f Fx(get)p 1084 922 27 4 v 30
w(proc)p 1290 922 V 30 w(id)f Fz(to)i(get)f(either)g(the)g(pro)r
(cessor)f(id)h(or)g(zero)f(dep)r(ending)h(on)515 1021
y(existing)27 b(SMP)g(supp)r(ort.)515 1154 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 1154 24 4 v 29 w(mdepProcessor)p
Fj(.)j Fk(i)p Fz(+)o Fq(\021)598 1245 y Fi(//)39 b(Return)i(the)f
(processor)h(id)f(as)g(said)g(by)f(the)h(APIC.)598 1337
y(static)g(inline)h(natural_t)g(get_proc_id\(void\);)515
1511 y Fk(h)p Fi(off)p 667 1511 V 29 w(mdepProcessor::get)p
1398 1511 V 32 w(proc)p 1586 1511 V 29 w(id)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1602 y Fi(//)39 b(Return)i(the)f(processor)h(id)f
(as)g(said)g(by)f(the)h(APIC.)598 1694 y(extern)g(inline)h(natural_t)g
(off_mdepProcessor::get_proc_)q(id\(vo)q(id\))598 1785
y({)676 1876 y(return)g(smp_find_cur_cpu\(\);)598 1968
y(})515 2233 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)l(o)l
(c)l(essor)i(dep)l(endencies.)e Fk(i)p Fz(+)o Fq(\021)598
2325 y Fi(#include)41 b(<flux/smp/smp.h>)278 b(//)40
b(for)g(smp_find_cur_cpu)i(et)e(al.)1885 5255 y Fz(452)p
eop
PStoPSsaved restore
%%Page: (454,455) 228
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
453 454 bop 515 523 a FA(Pro)s(cessor)31 b(registers)g(for)h(ix86)f
(based)h(arc)m(hitectures)515 676 y Fz(On)22 b(In)n(tels,)i(w)n(e)f
(de\014ne)g(the)g(pro)r(cessor)e(register)g(set)i(so)f(that)i(it)f
(matc)n(hes)f(the)i(stac)n(k)e(frame)515 776 y(sa)n(v)n(ed)30
b(on)h(traps)g(and)h(in)n(terrupts.)48 b(In)32 b(that)g(w)n(a)n(y)e(w)n
(e)i(can)f(create)g(register)f(sets)h(from)g(a)515 876
y(sa)n(v)n(ed)26 b(trap)h(frame.)515 1008 y Fk(h)p Fj(O\013)g(machine)h
(dep)l(endent)h(pr)l(o)l(c)l(essor)i(r)l(e)l(gisters.)e
Fk(i)p Fq(\021)598 1100 y Fi(//)39 b(Processor)j(registers)f(for)f
(ix86s)598 1191 y(//)598 1282 y(struct)g(off_mdepProcRegs)j({)676
1374 y(volatile)e(struct)g(trap_state)g(p_ts;)g(//ix86)f(registers)i
(matching)f(a)e(trap)h(stk)g(frame.)676 1556 y(//)g(Creates)h(a)e(set)h
(of)g(processor)h(registers.)676 1648 y(off_mdepProcRegs\(void\){)k
(assert\(sizeof\(p_ts\)==sizeof\(off)q(_mde)q(pPro)q(cRegs)q(\)\);)h(})
676 1830 y(//)40 b(Set)g(or)f(get)h(the)g(PC/SP/EFLAGS.)676
1922 y(void)236 b(set_pc\(register_t)44 b(pc\))39 b({)h(p_ts.eip)h(=)e
(pc;)h(})676 2013 y(void)236 b(set_sp\(register_t)44
b(sp\))39 b({)h(p_ts.esp)h(=)e(sp;)h(p_ts.ebp=sp;)i(})676
2104 y(void)236 b(set_flags\(register_t)44 b(f\))c({)f(p_ts.eflags)j(=)
e(f;)f(})676 2196 y(register_t)j(get_pc\(void\))g(const)e({)f(return)i
(p_ts.eip;)g(})676 2287 y(register_t)h(get_sp\(void\))g(const)e({)f
(return)i(p_ts.esp;)g(})676 2378 y(register_t)h(get_flags\(void\))g
(const)f({)e(return)i(p_ts.eflags;)h(})676 2470 y(//)e(Set)g(or)f(get)h
(the)g(pdbr)g(\(we)g(use)g(the)g(err)g(field)g(for)g(that\).)676
2561 y(void)g(set_ctx\(register_t)k(pdbr\))79 b({)40
b(p_ts.err)h(=)e(pdbr;)i(})676 2652 y(register_t)h(get_ctx\(void\))g
(const)e({)g(return)g(p_ts.err;)i(})676 2835 y(boolean_t)f
(is_kernel\(void\))i(const)d({)755 2926 y(extern)g(char)g(etext[];)755
3018 y(return)g(p_ts.eip)h(<)f(\(register_t\)etext;)676
3109 y(})676 3200 y(boolean_t)h(is_user\(void\))i(const)d({)755
3291 y(extern)g(char)g(etext[];)755 3383 y(return)g(p_ts.eip)h(>)f
(\(register_t\)etext;)676 3474 y(})676 3657 y(void)g(*operator)i
(new\(size_t)f(s,)f(off_mdepProcRegs)j(*p\))d({\(void\)s;)h(return)f
(\(void*\)p;})676 3839 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)
e Fi(off)p 1654 3839 24 4 v 29 w(mdepProcRegs)p Fj(.)j
Fk(i)598 4022 y Fi(};)515 4288 y Fk(h)p Fj(O\013)d(machine)h(dep)l
(endent)h(pr)l(o)l(c)l(essor)i(dep)l(endencies.)e Fk(i)p
Fz(+)o Fq(\021)598 4379 y Fi(#include)41 b(<assert.h>)598
4470 y(#include)g(<flux/machine/base_trap.h>)k(//)40
b(for)g(struct)g(trap_state)i(et)d(al.)1885 5255 y Fz(453)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
454 455 bop 639 523 a Fz(P)n(art)26 b(of)i(the)g(pro)r(cessor)d(state)j
(is)f(safely)g(accessible)g(b)n(y)g(users,)515 656 y
Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor)i(user)d
(r)l(e)l(gisters.)i Fk(i)p Fq(\021)598 747 y Fi(//)39
b(User)i(processor)g(registers)g(for)f(ix86s)598 839
y(//)f(***MUST)i(MATCH)g(those)f(of)g(trap_state)h
(\(oskit:base_trap.h\)!)598 930 y(struct)f(off_mdepUProcRegs)j({)912
1021 y(/*)c(PUSHA)i(register)g(state)f(frame)g(*/)912
1112 y(unsigned)h(int)157 b(edi;)912 1204 y(unsigned)41
b(int)157 b(esi;)912 1295 y(unsigned)41 b(int)157 b(ebp;)912
1386 y(unsigned)41 b(int)157 b(cr2;)912 1478 y(unsigned)41
b(int)157 b(ebx;)912 1569 y(unsigned)41 b(int)157 b(edx;)912
1660 y(unsigned)41 b(int)157 b(ecx;)912 1752 y(unsigned)41
b(int)157 b(eax;)912 1934 y(unsigned)41 b(int)157 b(d0;)197
b(//)40 b(pad)912 2026 y(unsigned)h(int)157 b(d1;)197
b(//)40 b(pad)912 2208 y(unsigned)h(int)157 b(eip;)912
2300 y(unsigned)41 b(int)157 b(d2;)197 b(//)40 b(pad)912
2391 y(unsigned)h(int)157 b(eflags;)41 b(//)f(\(only)g
(user-serviceable)j(flags)d(honored\))912 2482 y(unsigned)h(int)157
b(esp;)676 2665 y(//)40 b(Set)g(or)f(get)h(the)g(PC/SP/EFLAGS.)676
2756 y(void)236 b(set_pc\(register_t)44 b(pc\))39 b({)h(eip)g(=)f(pc;)h
(})676 2848 y(void)236 b(set_sp\(register_t)44 b(sp\))39
b({)h(esp)g(=)f(sp;)h(ebp=sp;)h(})676 2939 y(void)236
b(set_flags\(register_t)44 b(f\))c({)f(eflags)i(=)e(f;)h(})676
3030 y(register_t)i(get_pc\(void\))g(const)e({)f(return)i(eip;)f(})676
3122 y(register_t)i(get_sp\(void\))g(const)e({)f(return)i(esp;)f(})676
3213 y(register_t)i(get_flags\(void\))g(const)f({)e(return)i(eflags;)g
(})676 3396 y(//)f(Get)g(or)f(set)h(register)h(values)g(without)g
(knowing)g(their)f(names.)676 3487 y(void)315 b(set_r0\(register_t)43
b(r\))d({)f(eax=)h(r;})676 3578 y(register_t)81 b(get_r0\(void\))356
b({)39 b(return)i(eax;})676 3761 y(void)315 b(set_r0hi\(register_t)43
b(r\))d({)g(eax=)g(\(\(eax&0xffff\)|\(r<<16\)\);})676
3852 y(register_t)81 b(get_r0hi\(void\))356 b({)40 b(return)g
(\(\(eax&0xffff0000\)>>16\);})676 3944 y(void)315 b
(set_r0lo\(register_t)43 b(r\))d({)g(eax=)g
(\(\(eax&0xffff0000\)|\(r&0xffff\)\);)q(})676 4035 y(register_t)81
b(get_r0lo\(void\))356 b({)40 b(return)g(\(eax&0xffff\);})676
4218 y(void)315 b(set_r1\(register_t)43 b(r\))d({)f(ebx=)h(r;})676
4309 y(register_t)81 b(get_r1\(void\))356 b({)39 b(return)i(ebx;})676
4400 y(void)315 b(set_r2\(register_t)43 b(r\))d({)f(ecx=)h(r;})676
4491 y(register_t)81 b(get_r2\(void\))356 b({)39 b(return)i(ecx;})676
4583 y(void)315 b(set_r3\(register_t)43 b(r\))d({)f(edx=)h(r;})676
4674 y(register_t)81 b(get_r3\(void\))356 b({)39 b(return)i(edx;})676
4765 y(void)315 b(set_r4\(register_t)43 b(r\))d({)f(edi=)h(r;})676
4857 y(register_t)81 b(get_r4\(void\))356 b({)39 b(return)i(edi;})676
4948 y(void)315 b(set_r5\(register_t)43 b(r\))d({)f(esi=)h(r;})1885
5255 y Fz(454)p eop
PStoPSsaved restore
%%Page: (456,457) 229
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
455 456 bop 676 523 a Fi(register_t)81 b(get_r5\(void\))356
b({)39 b(return)i(esi;})676 614 y(void)315 b(set_r6\(register_t)43
b(r\))d({)f(ebp=)h(r;})676 706 y(register_t)81 b(get_r6\(void\))356
b({)39 b(return)i(ebp;})676 888 y(//)f(Copy)g(all)g(general-purpose)j
(user)d(registers.)676 980 y(inline)h(void)f
(copy_rX\(off_mdepUProcRegs)45 b(*other\){)755 1071 y(edi=other->edi;)
755 1162 y(esi=other->esi;)755 1254 y(ebp=other->ebp;)755
1345 y(cr2=other->cr2;)755 1436 y(ebx=other->ebx;)755
1528 y(edx=other->edx;)755 1619 y(ecx=other->ecx;)755
1710 y(eax=other->eax;)676 1802 y(})598 1984 y(};)639
2123 y Fz(Suc)n(h)28 b(subset)g(can)f(b)n(y)g(obtained)g(from)h(a)f
Fx(ProcRregs)d Fz(using)515 2238 y Fk(h)p Fj(Other)k(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 2238 24 4 v 29 w(mdepProcRegs)p
Fj(.)i Fk(i)p Fq(\021)598 2330 y Fi(off_mdepUProcRegs)43
b(*get_uregs\(void\))g({)c(return)i(\(off_mdepUProcRegs*\)&p_ts.edi;)46
b(})639 2453 y Fz(A)28 b(small)f(utilit)n(y)i(routine)e(is)g(pro)n
(vided)g(to)g(dump)h(a)g(stac)n(k.)515 2568 y Fk(h)p
Fj(O\013)f(machine)h(dep)l(endent)h(stack)g(dump.)f Fk(i)p
Fq(\021)598 2660 y Fi(void)40 b(off_mdep_dump_stack_at\(registe)q(r_t)
46 b(sp\);)515 2814 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(stack)g(dump)f(implementation.)g Fk(i)p Fq(\021)598
2906 y Fi(#define)41 b(MAX_ST_LEVELS)h(3)598 2997 y(void)e
(off_mdep_dump_stack_at\(registe)q(r_t)46 b(sp\))598
3088 y({)676 3180 y(unsigned)41 b(int)f(*fp,)g(i,j;)676
3362 y(fp=\(unsigned)i(int)e(*\)sp;)676 3545 y(for)g(\(i)g(=)f(0;)h(fp)
g(&&)f(*fp)h(&&)g(i)f(<)h(MAX_ST_LEVELS;)i(i++,)e(fp=\(unsigned)i(int)e
(*\)\(*fp\)\))h({)755 3636 y(printf\("\04502d])h(@0x\04508x)f
(ebp=0x\04508x)g(eip=0x\04508x",)1029 3728 y(i,)f(fp,)g
(\(\(u_int\)\(*fp\)\),)i(\(u_int\)\(*\(fp)g(+)e(1\)\)\);)755
3819 y(if)f(\(!\(*\(fp)i(+)f(1\))f(&&)h(*fp\)\))833 3910
y(break;)755 4093 y(for)g(\(j=2;)g(j<2+10)h(&&)e(fp+j)h(<)g
(\(\(u_int*\)\(*fp\)\);)j(j++\){)833 4184 y(if)d(\(\(j-2\))g(\045)g(5)f
(==)h(0)f(\))912 4276 y(printf\("\\n)159 b("\);)833 4367
y(printf\(")g(0x\04508x",)41 b(*\(fp)f(+)f(j\)\);)755
4458 y(})755 4550 y(if)g(\(fp+j)i(!=)e(\(u_int*\)\(*fp\)\))833
4641 y(printf\("..."\);)755 4732 y(printf\("\\n"\);)676
4824 y(})598 4915 y(})1885 5255 y Fz(455)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
456 457 bop 515 523 a FA(Math)32 b(copro)s(cessor)f(on)h(In)m(tels)515
668 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(c)l(opr)l(o)l(c)l
(essor)i(r)l(e)l(gister)f(set.)e Fk(i)p Fq(\021)598 759
y Fi(struct)40 b(off_mdepMProcRegs)j({)676 851 y(struct)e(i386_fp_save)
h(x87;)676 942 y(off_mdepMProcRegs\(void\){)755 1033
y(memset\(\(void*\)&x87,0,sizeof\(x87)q(\)\);)676 1125
y(})598 1216 y(};)515 1390 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l
(endent)h(pr)l(o)l(c)l(essor)i(dep)l(endencies.)e Fk(i)p
Fz(+)o Fq(\021)598 1482 y Fi(#include)41 b(<string.h>)198
b(//)40 b(for)g(memset)598 1573 y(#include)h(<flux/machine/fp_reg.h>//)
84 b(for)40 b(i386_fp_save)i(et)d(a.)515 1830 y FA(Pro)s(cessors)31
b(for)h(ix86)f(based)h(arc)m(hitectures)h Fg(C)7 b Fx(++)31
b FA(source)g(\014les)515 1983 y Fz(Mac)n(hine)18 b(dep)r(enden)n(t)h
(pro)r(cessor)d(co)r(de)i(is)g(k)n(ept)h(in)f Fx(mdep/mProcessor.h)12
b Fz(and)18 b Fx(mdep/mProcessor.)o(C)p Fz(.)515 2116
y Fk(h)p Fj(mdep)27 b(mPr)l(o)l(c)l(essor.h*)11 b Fk(i)s
Fq(\021)598 2208 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2299 y Fi(#ifndef)41
b(__OFF_MDEP_PROCESSOR_H)598 2390 y(#define)g(__OFF_MDEP_PROCESSOR_H)j
(1)598 2573 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)l(o)l(c)
l(essor)i(dep)l(endencies.)e Fk(i)598 2756 y Fi(#ifdef)40
b(__KERNEL__)598 2847 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(pr)l(o)l(c)l(essor)i(user)d(r)l(e)l(gisters.)i Fk(i)598
2938 y(h)p Fj(O\013)d(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor)i(r)l
(e)l(gisters.)e Fk(i)598 3030 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(c)l(opr)l(o)l(c)l(essor)i(r)l(e)l(gister)f(set.)e Fk(i)598
3121 y(h)p Fj(O\013)f(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor.)h
Fk(i)598 3212 y Fi(#endif)40 b(//)g(__KERNEL__)598 3486
y(#ifdef)g(__KERNEL__)598 3577 y Fk(h)p Fi(off)p 750
3577 24 4 v 29 w(mdepProcessor::get)p 1481 3577 V 32
w(proc)p 1669 3577 V 29 w(id)28 b Fj(implementation.)f
Fk(i)598 3669 y Fi(#endif)40 b(//)g(__KERNEL__)598 3760
y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(stack)h(dump.)d
Fk(i)598 3943 y Fi(#endif)40 b(//)g(__OFF_MDEP_PROCESSOR_H)1885
5255 y Fz(456)p eop
PStoPSsaved restore
%%Page: (458,459) 230
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
457 458 bop 515 523 a Fk(h)p Fj(mdep)27 b(mPr)l(o)l(c)l(essor.C*)11
b Fk(i)r Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<hw/mdep/mProcessor.h>)j(//)c(Exported)h(interface.)
598 888 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(pr)l(o)l(c)l
(essor)i(implementation)d(dep)l(endencies.)h Fk(i)598
1071 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h(pr)l(o)l(c)l(essor)i
(static)e(memb)l(ers.)f Fk(i)598 1254 y(h)p Fi(off)p
750 1254 24 4 v 29 w(mdepProcessor::how)p 1481 1254 V
32 w(many)g Fj(implementation.)g Fk(i)598 1345 y(h)p
Fi(off)p 750 1345 V 29 w(mdepProcessor::off)p 1481 1345
V 32 w(mdepProcessor)i Fj(implementation.)e Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(mdepProcessor::start)k
Fj(implementation.)27 b Fk(i)598 1528 y(h)p Fj(O\013)g(machine)h(dep)l
(endent)h(stack)h(dump)d(implementation.)h Fk(i)1885
5255 y Fz(457)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
458 459 bop 515 1146 a Fs(Chapter)64 b(5)515 1561 y Fv(Implemen)-6
b(ting)76 b(abstract)515 1810 y(resources)515 2242 y
Fz(The)32 b(o)n(v)n(erall)f(picture)h(is)h(depicted)g(in)g(\014gure)e
(5.1.)51 b(The)33 b(relationships)e(there)i(depicted)515
2341 y(will)28 b(b)r(ecome)f(clear)g(as)g(this)g(c)n(hapter)g(pro)r
(ceeds.)515 3841 y @beginspecial 0 @llx 0 @lly 600 @urx
290 @ury 3437 @rwi @setspecial
%%BeginDocument: fig/s+p+d.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-49.0 298.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 5850 2400 m 5700 2325 l 5550 2400 l 5700 2475 l 5850 2400 l gs col-1 s gr 
% Polyline
n 5550 2400 m 5325 2400 l gs col-1 s gr 
% Polyline
n 7050 4275 m 7800 4275 l 7800 4875 l 7050 4875 l cp gs col-1 s gr 
% Polyline
n 7050 4475 m 7800 4475 l gs col-1 s gr 
/Courier ff 165.00 scf sf
7350 4425 m
gs 1 -1 sc (at) col-1 sh gr
% Polyline
n 6300 4650 m 6450 4725 l 6600 4650 l 6450 4575 l 6300 4650 l gs col-1 s gr 
% Polyline
n 6600 4650 m 6825 4650 l gs col-1 s gr 
% Ellipse
n 6975 4650 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
6753 4620 m 6873 4650 l 6753 4680 l 6915 4680 l 6915 4620 l  cp clip
n 6600 4650 m 6900 4650 l gs col-1 s gr gr

% arrowhead
n 6753 4620 m 6873 4650 l 6753 4680 l  col-1 s
% Polyline
n 7800 4650 m 7950 4725 l 8100 4650 l 7950 4575 l 7800 4650 l gs col-1 s gr 
% Polyline
n 8100 4650 m 8325 4650 l gs col-1 s gr 
% Ellipse
n 8475 4650 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
8253 4620 m 8373 4650 l 8253 4680 l 8415 4680 l 8415 4620 l  cp clip
n 8100 4650 m 8400 4650 l gs col-1 s gr gr

% arrowhead
n 8253 4620 m 8373 4650 l 8253 4680 l  col-1 s
% Polyline
n 2775 2175 m 2925 2250 l 3075 2175 l 2925 2100 l 2775 2175 l gs col-1 s gr 
% Polyline
n 3075 2175 m 3300 2175 l gs col-1 s gr 
% Polyline
n 5850 2175 m 5700 2100 l 5550 2175 l 5700 2250 l 5850 2175 l gs col-1 s gr 
% Polyline
n 5550 2175 m 5325 2175 l gs col-1 s gr 
% Polyline
n 5475 1350 m 5625 1425 l 5775 1350 l 5625 1275 l 5475 1350 l gs col-1 s gr 
% Polyline
n 5775 1350 m 6000 1350 l gs col-1 s gr 
% Polyline
n 6375 900 m 6525 975 l 6675 900 l 6525 825 l 6375 900 l gs col-1 s gr 
% Polyline
n 6675 900 m 6900 900 l gs col-1 s gr 
% Ellipse
n 7725 375 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
7503 345 m 7623 375 l 7503 405 l 7665 405 l 7665 345 l  cp clip
n 7350 375 m 7650 375 l gs col-1 s gr gr

% arrowhead
n 7503 345 m 7623 375 l 7503 405 l  col-1 s
% Ellipse
n 7725 750 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
7503 720 m 7623 750 l 7503 780 l 7665 780 l 7665 720 l  cp clip
n 7350 750 m 7650 750 l gs col-1 s gr gr

% arrowhead
n 7503 720 m 7623 750 l 7503 780 l  col-1 s
% Polyline
n 8550 4425 m 8400 4350 l 8250 4425 l 8400 4500 l 8550 4425 l gs col-1 s gr 
% Polyline
n 8250 4425 m 8025 4425 l gs col-1 s gr 
% Polyline
n 1050 1050 m 2250 1050 l 2250 1725 l 1050 1725 l cp gs col-1 s gr 
% Polyline
n 1050 1275 m 2250 1275 l gs col-1 s gr 
/Courier ff 165.00 scf sf
1200 1200 m
gs 1 -1 sc (Processor) col-1 sh gr
% Polyline
n 1800 975 m 1875 825 l 1800 675 l 1725 825 l 1800 975 l gs col-1 s gr 
% Polyline
n 1800 675 m 1800 450 l gs col-1 s gr 
% Polyline
n 3225 1125 m 4350 1125 l 4350 1800 l 3225 1800 l cp gs col-1 s gr 
% Polyline
n 3225 1350 m 4350 1350 l gs col-1 s gr 
% Ellipse
n 3150 1425 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
2928 1395 m 3048 1425 l 2928 1455 l 3090 1455 l 3090 1395 l  cp clip
n 2775 1425 m 3075 1425 l gs col-1 s gr gr

% arrowhead
n 2928 1395 m 3048 1425 l 2928 1455 l  col-1 s
% Polyline
n 4725 675 m 5475 675 l 5475 1425 l 4725 1425 l cp gs col-1 s gr 
% Polyline
n 4725 925 m 5475 925 l gs col-1 s gr 
% Polyline
n 5625 375 m 6375 375 l 6375 1125 l 5625 1125 l cp gs col-1 s gr 
% Polyline
n 5625 625 m 6375 625 l gs col-1 s gr 
% Polyline
n 7800 150 m 9225 150 l 9225 975 l 7800 975 l cp gs col-1 s gr 
% Polyline
n 7800 425 m 9225 425 l gs col-1 s gr 
% Polyline
n 8550 1200 m 8400 1350 l 8700 1350 l 8550 1200 l gs col-1 s gr 
% Polyline
n 8550 975 m 8550 1200 l gs col-1 s gr 
% Polyline
n 9150 1575 m 10800 1575 l 10800 2175 l 9150 2175 l cp gs col-1 s gr 
% Polyline
n 9150 1775 m 10800 1775 l gs col-1 s gr 
/Courier ff 165.00 scf sf
9300 1725 m
gs 1 -1 sc (FnEventHandler) col-1 sh gr
% Polyline
n 7125 1575 m 8925 1575 l 8925 2175 l 7125 2175 l cp gs col-1 s gr 
% Polyline
n 7125 1775 m 8925 1775 l gs col-1 s gr 
/Courier ff 165.00 scf sf
7200 1725 m
gs 1 -1 sc (PrtlEventHandler) col-1 sh gr
% Polyline
n 3600 2025 m 4650 2025 l 4650 2625 l 3600 2625 l cp gs col-1 s gr 
% Polyline
n 3600 2225 m 4650 2225 l gs col-1 s gr 
% Polyline
n 5850 2025 m 6675 2025 l 6675 2625 l 5850 2625 l cp gs col-1 s gr 
% Polyline
n 5850 2225 m 6675 2225 l gs col-1 s gr 
% Polyline
n 8550 4275 m 9450 4275 l 9450 4875 l 8550 4875 l cp gs col-1 s gr 
% Polyline
n 8550 4475 m 9450 4475 l gs col-1 s gr 
% Polyline
n 1950 3150 m 3000 3150 l 3000 3750 l 1950 3750 l cp gs col-1 s gr 
% Polyline
n 1950 3350 m 3000 3350 l gs col-1 s gr 
/Courier ff 165.00 scf sf
2025 3300 m
gs 1 -1 sc (ShtlSrv) col-1 sh gr
% Polyline
n 3675 3150 m 4725 3150 l 4725 3750 l 3675 3750 l cp gs col-1 s gr 
% Polyline
n 3675 3350 m 4725 3350 l gs col-1 s gr 
/Courier ff 165.00 scf sf
3750 3300 m
gs 1 -1 sc (ShtlProp) col-1 sh gr
% Ellipse
n 3600 3525 75 75 0 360 DrawEllipse gs col-1 s gr

% Polyline
gs  clippath
3378 3495 m 3498 3525 l 3378 3555 l 3540 3555 l 3540 3495 l  cp clip
n 3225 3525 m 3525 3525 l gs col-1 s gr gr

% arrowhead
n 3378 3495 m 3498 3525 l 3378 3555 l  col-1 s
% Polyline
n 3300 3525 m 3000 3525 l gs col-1 s gr 
% Rotated Ellipse
gs
2400 2775 tr
-90.000 rot
n 0 0 75 75 0 360 DrawEllipse gs col-1 s gr
gr

% Polyline
gs  clippath
2370 2997 m 2400 2877 l 2430 2997 l 2430 2835 l 2370 2835 l  cp clip
n 2400 3150 m 2400 2850 l gs col-1 s gr gr

% arrowhead
n 2370 2997 m 2400 2877 l 2430 2997 l  col-1 s
% Polyline
n 4200 3975 m 4050 4125 l 4350 4125 l 4200 3975 l gs col-1 s gr 
% Polyline
n 4200 3750 m 4200 3975 l gs col-1 s gr 
% Polyline
n 3900 4350 m 4500 4350 l 4500 4950 l 3900 4950 l cp gs col-1 s gr 
% Polyline
n 3900 4550 m 4500 4550 l gs col-1 s gr 
/Courier ff 165.00 scf sf
4050 4500 m
gs 1 -1 sc (DMM) col-1 sh gr
% Polyline
n 5700 4275 m 6300 4275 l 6300 4875 l 5700 4875 l cp gs col-1 s gr 
% Polyline
n 5700 4475 m 6300 4475 l gs col-1 s gr 
% Polyline
gs  clippath
4497 1680 m 4377 1650 l 4497 1620 l 4335 1620 l 4335 1680 l  cp clip
n 5400 2175 m 5025 2175 l 5025 1650 l 4350 1650 l gs col-1 s gr gr

% arrowhead
n 4497 1680 m 4377 1650 l 4497 1620 l  col-1 s
% Polyline
n 1500 2475 m 1500 2475 l gs col-1 s gr
% Polyline
gs  clippath
6030 228 m 6000 348 l 5970 228 l 5970 390 l 6030 390 l  cp clip
n 5025 150 m 6000 150 l 6000 375 l gs col-1 s gr gr

% arrowhead
n 6030 228 m 6000 348 l 5970 228 l  col-1 s
% Polyline
n 5925 1350 m 7350 1350 l 7350 750 l gs col-1 s gr 
% Polyline
n 7125 1650 m 4725 1650 l gs col-1 s gr 
% Polyline
gs  clippath
6870 1797 m 6900 1677 l 6930 1797 l 6930 1635 l 6870 1635 l  cp clip
n 8175 4425 m 8025 4425 l 8025 2475 l 6900 2475 l 6900 1650 l gs col-1 s gr gr

% arrowhead
n 6870 1797 m 6900 1677 l 6930 1797 l  col-1 s
% Polyline
gs  clippath
4797 2430 m 4677 2400 l 4797 2370 l 4635 2370 l 4635 2430 l  cp clip
n 4650 2400 m 5400 2400 l gs col-1 s gr gr

% arrowhead
n 4797 2430 m 4677 2400 l 4797 2370 l  col-1 s
% Polyline
gs  clippath
5055 528 m 5025 648 l 4995 528 l 4995 690 l 5055 690 l  cp clip
n 1800 450 m 3225 450 l 3525 150 l 5025 150 l 5025 675 l gs col-1 s gr gr

% arrowhead
n 5055 528 m 5025 648 l 4995 528 l  col-1 s
% Polyline
gs  clippath
1953 2445 m 2073 2475 l 1953 2505 l 2115 2505 l 2115 2445 l  cp clip
n 1575 1725 m 1575 2475 l 2100 2475 l gs col-1 s gr gr

% arrowhead
n 1953 2445 m 2073 2475 l 1953 2505 l  col-1 s
% Polyline
n 6900 900 m 6900 375 l 7500 375 l gs col-1 s gr 
% Polyline
n 2250 1425 m 2400 1500 l 2550 1425 l 2400 1350 l 2250 1425 l gs col-1 s gr 
% Polyline
n 2100 2025 m 2775 2025 l 2775 2700 l 2100 2700 l cp gs col-1 s gr 
% Polyline
n 2100 2250 m 2775 2250 l gs col-1 s gr 
% Polyline
gs  clippath
3345 1947 m 3375 1827 l 3405 1947 l 3405 1785 l 3345 1785 l  cp clip
n 3300 2175 m 3375 2175 l 3375 1800 l gs col-1 s gr gr

% arrowhead
n 3345 1947 m 3375 1827 l 3405 1947 l  col-1 s
% Polyline
gs  clippath
4020 1947 m 4050 1827 l 4080 1947 l 4080 1785 l 4020 1785 l  cp clip
n 4050 2025 m 4050 1800 l gs col-1 s gr gr

% arrowhead
n 4020 1947 m 4050 1827 l 4080 1947 l  col-1 s
% Polyline
gs  clippath
3453 2370 m 3573 2400 l 3453 2430 l 3615 2430 l 3615 2370 l  cp clip
n 2775 2400 m 3600 2400 l gs col-1 s gr gr

% arrowhead
n 3453 2370 m 3573 2400 l 3453 2430 l  col-1 s
% Polyline
n 2550 1425 m 2775 1425 l gs col-1 s gr 
% Polyline
gs  clippath
7755 1428 m 7725 1548 l 7695 1428 l 7695 1590 l 7755 1590 l  cp clip
n 8550 1350 m 8550 1350 l 7725 1350 l 7725 1575 l gs col-1 s gr gr

% arrowhead
n 7755 1428 m 7725 1548 l 7695 1428 l  col-1 s
% Polyline
gs  clippath
9480 1428 m 9450 1548 l 9420 1428 l 9420 1590 l 9480 1590 l  cp clip
n 8550 1350 m 9450 1350 l 9450 1575 l gs col-1 s gr gr

% arrowhead
n 9480 1428 m 9450 1548 l 9420 1428 l  col-1 s
% Polyline
n 4200 4125 m 4200 4350 l gs col-1 s gr 
% Polyline
n 2400 3075 m 2400 3150 l gs col-1 s gr 
% Polyline
gs  clippath
5553 4620 m 5673 4650 l 5553 4680 l 5715 4680 l 5715 4620 l  cp clip
n 4500 4650 m 5700 4650 l gs col-1 s gr gr

% arrowhead
n 5553 4620 m 5673 4650 l 5553 4680 l  col-1 s
/Courier ff 165.00 scf sf
2400 1275 m
gs 1 -1 sc (runq) col-1 sh gr
/Courier ff 165.00 scf sf
825 1950 m
gs 1 -1 sc (current) col-1 sh gr
/Courier ff 165.00 scf sf
2250 2175 m
gs 1 -1 sc (Shtl) col-1 sh gr
/Courier ff 165.00 scf sf
4725 825 m
gs 1 -1 sc (TrapTbl) col-1 sh gr
/Courier ff 165.00 scf sf
5700 540 m
gs 1 -1 sc (IrqTbl) col-1 sh gr
/Courier ff 165.00 scf sf
7875 300 m
gs 1 -1 sc (EventHandler) col-1 sh gr
/Courier ff 165.00 scf sf
3750 2175 m
gs 1 -1 sc (ShtlPSet) col-1 sh gr
/Courier ff 165.00 scf sf
6000 2158 m
gs 1 -1 sc (Prtl) col-1 sh gr
/Courier ff 165.00 scf sf
8625 4425 m
gs 1 -1 sc (eu_id_t) col-1 sh gr
/Courier ff 165.00 scf sf
3525 1275 m
gs 1 -1 sc (id_t) col-1 sh gr
/Courier ff 165.00 scf sf
5775 4425 m
gs 1 -1 sc (DTLB) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 541 4024 a(Figure)g(5.1:)36 b(Relationship)27
b(among)g(Sh)n(uttles,)h(P)n(ortals,)d Ft(dtlb)p Fz(s)i(and)h(other)f
(resources.)515 4481 y Fr(5.1)135 b(Sh)l(uttles)515 4663
y Fz(The)27 b(Sh)n(uttle)h(abstraction)d(represen)n(ts)h(a)g(\015o)n(w)
h(of)g(con)n(trol)e(or)i(pro)r(cessor)e(con)n(text)h(whic)n(h)515
4763 y(can)21 b(b)r(e)i(extended)f(to)g(supp)r(ort)f(user-lev)n(el)g
(or)g(in-k)n(ernel)g(pro)r(cess)f(abstractions.)34 b(Sh)n(uttles)515
4862 y(are)26 b(implemen)n(ted)j(b)n(y)e(the)h(sh)n(uttle)g(serv)n(er.)
1885 5255 y(458)p eop
PStoPSsaved restore
%%Page: (460,461) 231
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
459 460 bop 515 523 a Fn(5.1.1)112 b(Sh)m(uttle)37 b(serv)m(ers)515
676 y Fz(The)f(main)g(task)f(of)h(the)h(sh)n(uttle)f(serv)n(er,)g
Fx(ShtlSrv)p Fz(,)g(is)f(to)h(allo)r(cate)f(sh)n(uttles,)k(th)n(us)d
(it)515 776 y(main)n(tains)27 b(a)g(sh)n(uttle)h(allo)r(cator.)515
895 y Fk(h)p Fj(O\013)f(shuttle)i(server.)g Fk(i)p Fq(\021)598
986 y Fi(//)39 b(A)h(shuttle)h(server)598 1078 y(//)598
1169 y(class)f(off_ShtlSrv:)i(public)f(off_AbsCompResource)i({)598
1260 y(public:)676 1443 y(//)d(Returns)h(a)e(pointer)i(to)f(the)g
(shuttle)g(allocator.)676 1534 y(virtual)h(off_ShtlAllocator)i
(*get_allocator\(void\);)676 1717 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 1717 24 4
v 29 w(ShtlSrv)p Fj(.)i Fk(i)598 1808 y Fi(protected:)676
1900 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 1900 V 29 w(ShtlSrv)p Fj(.)i Fk(i)598 1991
y Fi(private:)676 2082 y(static)41 b(off_ShtlAllocator)i(s_alloc;)159
b(//)39 b(Shuttle)i(allocator.)676 2174 y Fk(h)p Fj(Other)29
b(private)f(memb)l(ers)h(of)e Fi(off)p 1713 2174 V 29
w(ShtlSrv)p Fj(.)i Fk(i)598 2265 y Fi(};)515 2412 y Fk(h)p
Fj(O\013)e(shuttle)i(server)g(dep)l(endencies.)h Fk(i)o
Fq(\021)598 2503 y Fi(#include)41 b(<klib/AbsCompResource.h>)j(//)c
(for)g(off_AbsCompResource)598 2595 y(#include)h
(<shtl/ShtlAllocator.h>)122 b(//)40 b(for)g(allocated)h
(off_ShtlAllocator)598 2686 y(#include)g(<shtl/Shtl.h>)317
b(//)39 b(for)h(off_Shtl)515 2833 y Fk(h)p Fj(O\013)27
b(shuttle)i(server)g(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598
2924 y Fi(off_ShtlAllocator)43 b(off_ShtlSrv::s_alloc;)h(//)c(Shuttle)g
(allocator.)515 3071 y Fk(h)p Fi(off)p 667 3071 V 29
w(ShtlSrv::get)p 1164 3071 V 30 w(allocator)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 3163 y Fi(//)39 b(Returns)i(a)f(pointer)h(to)e(the)h
(shuttle)h(allocator.)598 3254 y(off_ShtlAllocator)i
(*off_ShtlSrv::get_allocator\(vo)q(id\))598 3345 y({)676
3437 y(return)e(&s_alloc;)598 3528 y(})639 3655 y Fz(Being)24
b(a)h(sub)r(class)f(of)g Fx(CompResource)c Fz(w)n(e)k(m)n(ust)h
(implemen)n(t)g Fx(make)p 2803 3655 27 4 v 30 w(available)c
Fz(and)515 3755 y Fx(is)p 608 3755 V 30 w(local)p Fz(.)515
3864 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3864 24 4 v 29 w(ShtlSrv)p Fj(.)h Fk(i)p
Fq(\021)598 3956 y Fi(//)39 b(We)h(may)g(wish)g(to)g(cache)g(a)g
(resource)h(unit.)598 4047 y(//)e(Returns)i(error)g(code)f(if)f(the)h
(resource)h(is)f(not)g(available.)h(Zero)g(otherwise.)598
4138 y(inline)f(err_t)h(make_available\(off_id_t)j(&u\);)515
4367 y Fk(h)p Fi(off)p 667 4367 V 29 w(ShtlSrv::make)p
1203 4367 V 31 w(available)29 b Fj(implementation.)f
Fk(i)p Fq(\021)598 4458 y Fi(//)39 b(We)h(may)g(wish)g(to)g(cache)g(a)g
(resource)h(unit.)598 4550 y(//)e(Returns)i(error)g(code)f(if)f(the)h
(resource)h(is)f(not)g(available.)h(Zero)g(otherwise.)598
4641 y(inline)f(err_t)h(off_ShtlSrv::make_available\(of)q(f_id_)q(t)k
(&u\))598 4732 y({)676 4824 y Fk(h)p Fj(Bo)l(dy)28 b(of)f
Fi(off)p 1111 4824 V 29 w(CompResource::make)p 1842 4824
V 33 w(available)p Fj(.)i Fk(i)598 4915 y Fi(})1885 5255
y Fz(459)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
460 461 bop 515 523 a Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 523 24 4 v 29 w(ShtlSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)
i(one?)598 706 y(inline)f(boolean_t)i(is_local\(const)g(off_shtl_id_t)g
(&s\);)515 880 y Fk(h)p Fi(off)p 667 880 V 29 w(ShtlSrv::is)p
1125 880 V 30 w(local)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 971 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i(one?)
598 1063 y(inline)f(boolean_t)i(off_ShtlSrv::is_local\(const)j
(off_shtl_id_t)d(&s\))598 1154 y({)755 1245 y(return)e(\()g(s)f(<=)h
(s_alloc.get_length\(\))k(&&)1108 1337 y
(\(s_alloc+s\)->l_shtl.get_id\(\))h(==)40 b(s)f(\);)598
1519 y(})515 1785 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(dep)l
(endencies.)h Fk(i)o Fz(+)p Fq(\021)598 1876 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d(al.)598
1968 y(#include)i(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 2059 y(#include)h(<klib/err.h>)473
b(//)40 b(for)g(err_t)598 2150 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 2242 y(#include)h(<klib/Magic.h>)395
b(//)40 b(for)g(magic)g(numbers)639 2383 y Fz(Initially)-7
b(,)28 b(sh)n(uttle)g(serv)n(ers)d(are)i(created)g(with)h(default)g(v)
-5 b(alues)27 b(for)g(its)h(mem)n(b)r(ers.)515 2516 y
Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2516 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2607 y Fi(//)39 b(Creates)i(a)f(shuttle)h(server.)598
2698 y(off_ShtlSrv\(void\);)639 2839 y Fz(There)27 b(is)h(a)f(single)g
(instance)g(p)r(er)h(system.)515 2956 y Fk(h)p Fj(O\013)f(shuttle)i
(server)g(exp)l(orte)l(d)h(variables.)e Fk(i)p Fq(\021)598
3047 y Fi(extern)40 b(off_ShtlSrv)i(shtl;)315 b(//)40
b(Shuttle)h(server)f(instance)h(for)f(this)g(node.)515
3205 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(glob)l(al)f(variables.)g
Fk(i)p Fq(\021)598 3296 y Fi(off_ShtlSrv)41 b(shtl;)590
b(//)40 b(Shuttle)h(server)f(instance)h(for)f(this)g(node.)515
3470 y Fk(h)p Fi(off)p 667 3470 V 29 w(ShtlSrv::off)p
1164 3470 V 30 w(ShtlSrv)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 3562 y Fi(//)39 b(Creates)i(a)f(shuttle)h(server.)598
3653 y(off_ShtlSrv::off_ShtlSrv\(void\))46 b(:)676 3744
y(off_AbsCompResource\(off_Prot)q(ectio)q(n\(\),)g(OFF_PRTL_NULL,)1461
3836 y(OFF_ID_NULL,)c(OFF_MAGIC_SHTLSRV\),)676 3927 y
Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 3927 V 29 w(ShtlSrv)p Fj(.)g Fk(i)598 4018
y Fi({)39 b(;)h(})639 4251 y Fz(Where)28 b(the)g(magic)f(n)n(um)n(b)r
(er)g(has)g(to)g(b)r(e)h(de\014ned.)515 4367 y Fk(h)p
Fj(O\013)f(magic)g(numb)l(ers.)i Fk(i)p Fq(\021)598 4458
y Fi(OFF_MAGIC_SHTLSRV,)43 b(//)d(ShtlSrv)h(magic)f(nb.)639
4583 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)
g(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
4699 y Fk(h)p Fi(off)p 667 4699 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 4699 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 4790 y Fi(case)40 b(OFF_MAGIC_SHTLSRV:)676
4882 y(return)h("off_ShtlSrv";)1885 5255 y Fz(460)p eop
PStoPSsaved restore
%%Page: (462,463) 232
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
461 462 bop 639 523 a Fz(Sh)n(uttle)29 b(serv)n(er)c(users)i(can)g(c)n
(hec)n(k)g(their)g(references)g(using)g(this)h(metho)r(d.)515
639 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 639 24 4 v 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
730 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(ShtlSrv?)598
821 y(inline)h(boolean_t)i(valid\(void\))f(const;)515
977 y Fk(h)p Fi(off)p 667 977 V 29 w(ShtlSrv::valid)30
b Fj(implementation.)e Fk(i)o Fq(\021)598 1069 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(ShtlSrv?)598 1160 y(inline)h
(boolean_t)i(off_ShtlSrv::valid\(void\))i(const)598 1251
y({)39 b(return)i(get_magic\(\))h(==)d(OFF_MAGIC_SHTLSRV;)44
b(})639 1483 y Fz(After)28 b(instan)n(tiation,)f Fx(start)f
Fz(should)h(b)r(e)h(used)g(to)f(start)g(sh)n(uttle)h(serv)n(er)e(op)r
(eration.)515 1614 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1614 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 1706 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)
g(shuttle)h(server.)598 1797 y(err_t)f(start\()h(const)f
(off_mdepShtlSrv)j(&mdep,)d(const)h(off_id_t)g(&id)f(\);)515
2060 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(dep)l(endencies.)h
Fk(i)o Fz(+)p Fq(\021)598 2152 y Fi(#include)41 b
(<shtl/mdep/mShtlSrv.h>)j(//)c(for)g(off_mdepShtlSrv)515
2324 y Fk(h)p Fi(off)p 667 2324 V 29 w(ShtlSrv::start)30
b Fj(implementation.)e Fk(i)o Fq(\021)598 2415 y Fi(//)39
b(Starts)i(normal)g(operation)g(for)f(this)g(shuttle)h(server.)598
2506 y(err_t)f(off_ShtlSrv::start\()k(const)c(off_mdepShtlSrv)j(&mdep,)
d(const)h(off_id_t)g(&id)f(\))598 2598 y({)676 2689 y
(assert\(valid\(\)\);)676 2780 y(set_id\(id\);)676 2872
y Fk(h)p Fj(Initialize)27 b Fi(ShtlSrv::s)p 1423 2872
V 30 w(alloc)p Fj(.)h Fk(i)676 3054 y(h)p Fj(Start)h(other)g(memb)l
(ers)g(of)e Fi(off)p 1629 3054 V 29 w(ShtlSrv)i Fj(ac)l(c)l(or)l(ding)g
(to)f Fi(mdep)p Fj(.)g Fk(i)676 3237 y Fi(kcout<<)41
b("Shtl)119 b(#")40 b(<<)f(id)h(<<)g(")f(started."<<)j(nl;)676
3328 y(return)f(EOK;)598 3511 y(})515 3683 y Fk(h)p Fj(O\013)27
b(shuttle)i(server)g(dep)l(endencies.)h Fk(i)o Fz(+)p
Fq(\021)598 3774 y Fi(#include)41 b(<assert.h>)512 b(//)40
b(for)g(assert)598 3866 y(#include)h(<klib/str.h>)434
b(//)40 b(for)g(kcout.)639 4006 y Fz(A)22 b(new)f(mem)n(b)r(er,)h
Fx(s)p 1272 4006 27 4 v 31 w(mdep)e Fz(stores)f(an)n(y)i(b)r(o)r(ot)g
(time)g(mac)n(hine)g(dep)r(enden)n(t)h(information)515
4105 y(whic)n(h)27 b(migh)n(t)h(b)r(e)g(needed)g(b)n(y)f(the)h(sh)n
(uttle)g(serv)n(er.)515 4221 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 4221 24 4 v 29 w(ShtlSrv)p Fj(.)g
Fk(i)p Fq(\021)598 4312 y Fi(off_mdepShtlSrv)42 b(s_mdep;)355
b(//)40 b(Machine)h(dependent)g(info.)515 4468 y Fk(h)p
Fj(Start)29 b(other)g(memb)l(ers)f(of)f Fi(off)p 1467
4468 V 29 w(ShtlSrv)i Fj(ac)l(c)l(or)l(ding)g(to)g Fi(mdep)p
Fj(.)e Fk(i)p Fq(\021)598 4560 y Fi(s_mdep=mdep;)639
4700 y Fz(Initially)-7 b(,)41 b(b)r(efore)e(the)f(sh)n(uttle)h(serv)n
(er)d(is)j(started,)h(it)f(is)f(initialized)h(with)g(default)515
4799 y(v)-5 b(alues.)515 4915 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 4915 V 29 w(ShtlSrv)p Fj(.)i Fk(i)p Fq(\021)598
5006 y Fi(s_mdep\(\),)1885 5255 y Fz(461)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
462 463 bop 515 523 a Fn(5.1.2)112 b(Sh)m(uttles)515
676 y Fz(A)22 b(sh)n(uttle)h(is)f(a)f(set)h(of)g(prop)r(ert)n(y)f(v)-5
b(alues,)23 b(including)f(a)g(pro)r(cessor)e(con)n(text.)35
b(It)22 b(is)g(the)g(only)515 776 y Fy(sche)l(dulable)38
b Fz(en)n(tit)n(y)30 b(pro)n(vided)f(b)n(y)h(the)h Fw(\026)p
Fz(k)n(ernel.)44 b(Sh)n(uttles)31 b(run)f(when)g(installed)g(in)h(the)
515 876 y(run)e(queue)g(of)g(a)f(giv)n(en)g(pro)r(cessor)f(\(as)i(w)n
(e)g(sa)n(w)f(in)h(section)g(4.6\).)40 b(Eac)n(h)28 b(sh)n(uttle)h(has)
g(its)515 975 y(o)n(wn)20 b Fx(ShtlPropAllocat)o(or)14
b Fz(whic)n(h)21 b(can)f(b)r(e)h(accessed)e(b)n(y)h(the)h(accessor)e
Fx(get)p 2939 975 27 4 v 30 w(allocator)p Fz(.)515 1108
y Fk(h)p Fj(O\013)27 b(shuttle.)h Fk(i)p Fq(\021)598
1199 y Fi(//)39 b(A)h(shuttle.)598 1291 y(//)598 1382
y(class)g(off_Shtl)h(:)f(public)g(off_AbsResUnit)j({)598
1473 y(public:)676 1656 y(//)d(Returns)h(the)f(property)h(allocator)g
(for)f(this)g(shuttle.)676 1747 y(off_ShtlPropAllocator)k
(*get_allocator\(void\);)676 1930 y(//)c(Mainly)g(to)g(use)g(by)g(the)g
(mach)g(dep)g(layer.)676 2021 y(inline)h(off_mdepShtl)h
(*get_mdep\(void\);)676 2204 y Fk(h)p Fj(Other)29 b(public)e(metho)l
(ds)i(of)e Fi(off)p 1654 2204 24 4 v 29 w(Shtl)p Fj(.)h
Fk(i)598 2295 y Fi(protected:)676 2387 y Fk(h)p Fj(Other)h(pr)l(ote)l
(cte)l(d)h(metho)l(ds)f(of)e Fi(off)p 1755 2387 V 29
w(Shtl)p Fj(.)h Fk(i)598 2478 y Fi(private:)676 2569
y(off_mdepShtl)42 b(s_mdep;)394 b(//)40 b(Processor)h(context.)676
2661 y(off_ShtlPropAllocator)j(*s_palloc;)e(//)d(Property)i(allocator.)
676 2752 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2752 V 29 w(Shtl)p Fj(.)h Fk(i)598 2843
y Fi(};)515 3018 y Fk(h)p Fj(O\013)f(shuttle)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 3109 y Fi(#include)41 b(<klib/AbsResUnit.h>)200
b(//)40 b(for)g(off_AbsResUnit)598 3200 y(#include)h
(<shtl/ShtlPropAllocator.h>)515 3374 y Fk(h)p Fi(off)p
667 3374 V 29 w(Shtl::get)p 1047 3374 V 30 w(allocator)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 3466 y Fi(//)39
b(Returns)i(the)f(property)h(allocator)g(for)f(this)h(shuttle.)598
3557 y(off_ShtlPropAllocator)j(*off_Shtl::get_allocator\(void\))598
3648 y({)676 3740 y(assert\(!s_palloc)f(||)d
(s_palloc->get_num_refs\(\))k(>0\);)676 3831 y(return)d(s_palloc;)598
3922 y(})515 4188 y Fk(h)p Fi(off)p 667 4188 V 29 w(Shtl::get)p
1047 4188 V 30 w(mdep)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 4279 y Fi(//)39 b(Mainly)i(to)f(use)g(by)f(the)h(mach)g
(dep)g(layer.)598 4371 y(inline)g(off_mdepShtl)i
(*off_Shtl::get_mdep\(void\))j({)40 b(return)g(&s_mdep;)h(})1885
5255 y Fz(462)p eop
PStoPSsaved restore
%%Page: (464,465) 233
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
463 464 bop 639 523 a Fz(Sh)n(uttle)32 b(prop)r(erties)e(are)f(en)n
(tities)i(used)g(to)g(sp)r(ecify)g(whic)n(h)g(kind)g(of)f(resources)f
(\(e.g.)515 623 y Ft(dtlb)p Fz(s,)e(IO)h(maps,)f(etc.\))38
b(should)28 b(b)r(e)g(readily)f(a)n(v)-5 b(ailable)27
b(for)g(a)g(sh)n(uttle)h(to)g(run.)38 b(Sp)r(eci\014c)515
722 y(resource)26 b(instances)h(are)f(iden)n(ti\014ed)i(b)n(y)g(prop)r
(ert)n(y)e(v)-5 b(alues.)639 822 y(There)27 b(are)g(three)g(di\013eren)
n(t)h(kinds)g(of)f(prop)r(erties:)616 988 y(1.)41 b(Prop)r(erties)28
b(folded)i(in)n(to)f(the)h(sh)n(uttle.)42 b(In)30 b(those)f(cases)f
(where)h(a)g(giv)n(en)f(prop)r(ert)n(y)722 1088 y(is)33
b(almost)e Fy(always)41 b Fz(used)32 b(w)n(e)g(hardwire)f(it)i(in)n(to)
f(the)h(sh)n(uttle)g(co)r(de)f(\(e.g.)51 b(w)n(e)32 b(will)722
1187 y(b)r(e)i(seeing)f(ho)n(w)h(pro)r(cessor)d(registers)h(are)h
(handled)h(righ)n(t)f(a)n(w)n(a)n(y)e(b)n(y)j(the)g(sh)n(uttle)722
1287 y(itself)6 b(\).)616 1453 y(2.)41 b(Prop)r(erties)e(whic)n(h)h
(are)f(serviced)g(in)n(to)h(the)h(k)n(ernel.)74 b(In)40
b(those)g(cases)f(where)g(a)722 1553 y(resource)29 b(has)h(to)g(b)r(e)h
(made)f(a)n(v)-5 b(ailable)30 b(b)n(y)g(the)h(k)n(ernel)e(for)h(a)g(sh)
n(uttle)h(to)g(run,)g(the)722 1652 y(prop)r(ert)n(y)c(in)n(v)n(olv)n
(ed)f(is)h(handled)h(b)n(y)f(a)h(function)g(call)f(inside)h(the)g(k)n
(ernel.)616 1818 y(3.)41 b(Prop)r(erties)28 b(whic)n(h)i(are)f
(serviced)f(b)n(y)i(the)g(user.)42 b(Ev)n(ery)28 b(user)h(can)g
(de\014ne)h(its)g(o)n(wn)722 1918 y(prop)r(erties)24
b(and)h(arrange)e(for)h(a)h(user-lev)n(el)e(prop)r(ert)n(y)h(serv)n(er)
f(to)i(b)r(e)h(called)e(\(in)i(the)722 2017 y(prop)r(ert)n(y)h(user)g
(con)n(text\))g(to)h(service)e(them.)515 2183 y(Only)h(the)h(last)f(t)n
(w)n(o)g(kinds)h(of)f(prop)r(erties)g(will)h(app)r(ear)e(in)n(to)i(the)
g Fx(s)p 2674 2183 27 4 v 31 w(props)d Fz(mem)n(b)r(er.)639
2283 y(A)32 b(sh)n(uttle)f(is)g(created)f(with)i(a)f(presp)r(eci\014ed)
g(protection)f(and)h(domain.)47 b(Besides,)31 b(a)515
2383 y(protot)n(yp)r(e)f(sh)n(uttle)h(can)g(b)r(e)g(giv)n(en)f(to)h
(initialize)g(the)h(set)f(of)g(prop)r(erties.)46 b(Only)30
b(for)h(the)515 2482 y(ro)r(ot)22 b(\(the)i(v)n(ery)e(\014rst\))h(sh)n
(uttle)g(is)g(suc)n(h)g(protot)n(yp)r(e)f(not)h(supplied;)i(in)f(an)n
(y)e(other)g(case)h(the)515 2582 y(curren)n(t)g(sh)n(uttle)i(is)g(alw)n
(a)n(ys)d(used)j(as)f(a)g(protot)n(yp)r(e.)35 b(The)24
b(program)f(coun)n(ter)h(and)g(\(user)3310 2552 y Fp(1)3347
2582 y Fz(\))515 2682 y(stac)n(k)i(p)r(oin)n(ter)i(m)n(ust)f(b)r(e)h
(alw)n(a)n(ys)e(supplied.)515 2814 y Fk(h)p Fj(Other)i(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 2814 24 4 v 29 w(Shtl)p Fj(.)h
Fk(i)p Fq(\021)598 2906 y Fi(//)39 b(Creates)i(a)f(shuttle.)598
2997 y(off_Shtl\()h(const)f(off_Protection)j(&p,)990
3088 y(const)d(off_prtl_id_t)j(&domain,)990 3180 y(const)d
(off_shtl_id_t)j(&id,)990 3271 y(off_ShtlSrv)199 b(*srv,)990
3362 y(register_t)277 b(pc,)990 3454 y(register_t)g(sp,)990
3545 y(register_t)g(ksp,)990 3636 y(off_Shtl)316 b(*proto)40
b(\);)515 3811 y Fk(h)p Fj(O\013)27 b(shuttle)i(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 3902 y Fi(#include)41 b(<klib/err.h>)434
b(//)40 b(for)g(err_t)598 3993 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 4085 y(#include)h(<klib/Magic.h>)356
b(//)40 b(for)g(magic)g(numbers)598 4176 y(class)g(off_ShtlSrv;)552
b(//)40 b(to)f(break)i(the)f(circular)h(dependency)598
4267 y(#include)g(<shtl/mdep/mShtl.h>)161 b(//)40 b(for)g(off_mdepShtl)
p 515 4929 1146 4 v 607 4983 a Fm(1)642 5006 y Fl(Another)24
b(stac)n(k)h(for)e(the)h(k)n(ernel)g(will)e(b)r(e)i(supplied)g(b)n(y)g
(the)h(k)n(ernel)f(itself.)1885 5255 y Fz(463)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
464 465 bop 639 523 a Fz(System)25 b(users)e(go)g(through)h(a)f
(di\013eren)n(t)i(constructor,)e(b)r(ecause)h(most)g(of)g(the)h(sh)n
(uttle)515 623 y(\014elds)i(are)g(pre-initialized.)515
739 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
830 y Fi(//)39 b(Creates)i(a)f(shuttle.)598 922 y(off_Shtl\(const)i
(off_Protection)h(&p,)951 1013 y(const)d(off_prtl_id_t)i(&domain,)951
1104 y(register_t)277 b(pc,)951 1196 y(register_t)g(sp,)951
1287 y(register_t)g(ksp,)951 1378 y(off_Shtl)315 b(*proto)41
b(\);)639 1503 y Fz(The)25 b(k)n(ernel)f(stac)n(k)g(p)r(oin)n(ter)h
(and)g(user)f(stac)n(k)g(p)r(oin)n(ter)h(and)f(program)f(coun)n(ter)h
(is)h(sen)n(t)515 1602 y(to)39 b(the)h(mac)n(hine)f(dep)r(enden)n(t)h
(sh)n(uttle)g(information,)i(whic)n(h)e(includes)f(the)h(pro)r(cessor)
515 1702 y(con)n(text.)515 1818 y Fk(h)p Fi(off)p 667
1818 V 29 w(Shtl::off)p 1047 1818 V 30 w(Shtl)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 1910 y Fi(//)39 b(Creates)i(a)f(shuttle.)598
2001 y(off_Shtl::off_Shtl\(const)k(off_Protection)f(&p,)1343
2092 y(const)d(off_prtl_id_t)j(&domain,)1343 2183 y(register_t)277
b(pc,)1343 2275 y(register_t)g(sp,)1343 2366 y(register_t)g(ksp,)1343
2457 y(off_Shtl)120 b(*proto)40 b(\))g(:)676 2549 y
(off_AbsResUnit\(p,domain\),)676 2640 y(s_mdep\(this,pc,sp,ksp\),)676
2731 y Fk(h)p Fj(Initialize)27 b Fi(Shtl::s)p 1306 2731
V 30 w(palloc)p Fj(.)h Fk(i)p Fi(,)676 2823 y Fk(h)p
Fj(Initialize)f(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 2823 V 29 w(Shtl)p Fj(.)f Fk(i)598 2914
y Fi({)676 3005 y Fk(h)p Fj(Initialize)g(other)i(private)f(memb)l(ers)h
(of)e Fi(off)p 2015 3005 V 29 w(Shtl)h Fj(ac)l(c)l(or)l(ding)i(to)e
Fi(proto)p Fj(.)g Fk(i)598 3097 y Fi(})639 3313 y Fz(Remaining)23
b(sh)n(uttle)f(data)h(is)f(pre-initialized.)35 b(First,)23
b(a)g(zero-argumen)n(t)d(constructor)515 3412 y(p)r(ermits)28
b(declaration)e(of)h(uninitialized)h(sh)n(uttles.)515
3528 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3528 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3620 y Fi(//)79 b(Allows)40 b(uninitialized)i(shuttles.)598
3711 y(off_Shtl\(void\);)515 3869 y Fk(h)p Fi(off)p 667
3869 V 29 w(Shtl::off)p 1047 3869 V 30 w(Shtl)28 b Fj(implementation.)g
Fk(i)p Fz(+)o Fq(\021)598 3960 y Fi(//)79 b(Allows)40
b(uninitialized)i(shuttles.)598 4051 y(off_Shtl::off_Shtl\(void\))i(:)
676 4143 y(off_AbsResUnit\(off_Protectio)q(n\(\),)i(OFF_PRTL_NULL,)1265
4234 y(OFF_SHTL_NULL,)c(OFF_MAGIC_SHTL,)h(NULL\))598
4325 y({;})639 4558 y Fz(Later,)24 b(when)g(sh)n(uttle)h(serv)n(ers)d
(are)h(b)r(eing)h(created,)g(another)f(constructor)f(is)i(used)g(to)515
4658 y(pre-initialize)j(those)g(sh)n(uttle)h(\014elds)f(whic)n(h)h(are)
f(unlik)n(ely)g(to)g(c)n(hange.)515 4774 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 4774 V 29 w(Shtl)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 4865 y Fi(//)39 b(Pre-initializes)k(a)d
(shuttle.)598 4956 y(off_Shtl\(const)i(off_shtl_id_t)g(&id,)e(const)h
(off_magic_t)h(&m,)d(off_ShtlSrv)j(*c\);)1885 5255 y
Fz(464)p eop
PStoPSsaved restore
%%Page: (466,467) 234
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
465 466 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Shtl::off)p 1047 523 V 30 w(Shtl)28 b Fj(implementation.)g
Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(//)39 b(Pre-initializes)k(a)d
(shuttle.)598 706 y(off_Shtl::off_Shtl\(const)k(off_shtl_id_t)f(&id,)
1343 797 y(const)d(off_magic_t)i(&m,)e(off_ShtlSrv)i(*c\))e(:)676
888 y(off_AbsResUnit\(id,m,\(off_Abs)q(CompR)q(esou)q(rce*)q(\)c\))598
980 y({;})639 1212 y Fz(Where)28 b(the)g(magic)f(n)n(um)n(b)r(er)g(has)
g(to)g(b)r(e)h(de\014ned.)515 1328 y Fk(h)p Fj(O\013)f(magic)g(numb)l
(ers.)i Fk(i)p Fz(+)o Fq(\021)598 1420 y Fi(OFF_MAGIC_SHTL,)42
b(//)e(Shtl)g(magic)h(nb.)639 1544 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g
(add)h(another)e(case)h(to)h(the)g(implemen)n(tation)f(of)h
Fx(Magic::nameof)p Fz(.)515 1660 y Fk(h)p Fi(off)p 667
1660 V 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e Fi(m)p
1559 1660 V 29 w(number)p Fj(s.)h Fk(i)p Fz(+)p Fq(\021)598
1752 y Fi(case)40 b(OFF_MAGIC_SHTL:)676 1843 y(return)h("off_Shtl";)639
1968 y Fz(Sh)n(uttle)29 b(users)d(can)h(c)n(hec)n(k)g(their)h
(references)e(to)i(pro)r(cessors)d(using)i(this)h(metho)r(d.)515
2084 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2084 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2175 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(Shtl?)598
2267 y(inline)h(boolean_t)i(valid\(void\))f(const;)515
2424 y Fk(h)p Fi(off)p 667 2424 V 29 w(Shtl::valid)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 2516 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(Shtl?)598 2607 y(inline)h(boolean_t)i
(off_Shtl::valid\(void\))i(const)598 2698 y({)39 b(return)i
(get_magic\(\))h(==)d(OFF_MAGIC_SHTL;)k(})639 2931 y
Fz(The)28 b(new)g(con)n(tainer)e(can)h(also)g(implemen)n(t)h(its)g
Fx(get)p 2323 2931 27 4 v 30 w(umagic)d Fz(metho)r(d.)515
3047 y Fk(h)p Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3047 24 4 v 29 w(ShtlSrv)p Fj(.)h Fk(i)p
Fq(\021)598 3138 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i
({)d(return)g(OFF_MAGIC_SHTL;)j(})515 3487 y Fn(5.1.3)112
b(Sh)m(uttle)37 b(allo)s(cation)515 3640 y Fz(A)28 b(sh)n(uttle)g(allo)
r(cator)d(is)j(a)f(blo)r(c)n(k)g(allo)r(cator)f(instan)n(tiated)h(to)h
(main)n(tain)f(sh)n(uttles.)515 3756 y Fk(h)p Fj(O\013)g(shuttle)i(al)t
(lo)l(c)l(ator.)f Fk(i)p Fq(\021)598 3848 y Fi(//)39
b(A)h(Shuttle)h(allocator.)598 3939 y(//)598 4030 y(class)f
(off_ShtlAllocator)j(:)d(public)g(off_TBlockAllocator<off_LSht)q(l>)45
b({)598 4122 y(public:)676 4213 y(//)40 b(Allows)g(declarations)i(of)e
(uninitialized)i(shuttle)f(allocators)676 4304 y
(off_ShtlAllocator\(void\){;})676 4487 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 4487 V 29
w(ShtlAllocator)p Fj(.)j Fk(i)598 4578 y Fi(private:)676
4670 y Fk(h)p Fj(Other)f(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4670 V 29 w(ShtlAllocator)p Fj(.)j Fk(i)598
4761 y Fi(};)1885 5255 y Fz(465)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
466 467 bop 639 523 a Fz(As)32 b(the)h(blo)r(c)n(k)e(allo)r(cator)f
(uses)i(a)f(lik)n(ed)h(free-list,)g(the)h(arra)n(y)c(no)r(des)j(m)n
(ust)g(sub)r(class)515 623 y Fx(DLinkedNode)p Fz(.)515
756 y Fk(h)p Fj(O\013)27 b(linkable)g(shuttle.)i Fk(i)p
Fq(\021)598 847 y Fi(//)39 b(A)h(linkable)h(off_Shtl.)598
938 y(//)598 1029 y(class)f(off_LShtl)h(:)f(public)g(DLinkedNode)i({)
598 1121 y(public:)676 1212 y(off_Shtl)f(l_shtl;)551
b(//)40 b(The)g(shuttle)676 1395 y(//)g(To)g(allow)g(uninitilized)i
(LShtls.)676 1486 y(off_LShtl\(void\))h({;})676 1669
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 1669 24 4 v 29 w(LShtl)p Fj(.)h Fk(i)598 1760 y
Fi(};)515 2026 y Fk(h)p Fj(O\013)f(shuttle)i(al)t(lo)l(c)l(ator)g(dep)l
(endencies.)g Fk(i)p Fq(\021)598 2117 y Fi(#include)41
b(<klib/BlockAllocator.h>)j(//)c(for)g(off_TBlockAllocator)598
2208 y(#include)h(<shtl/Shtl.h>)395 b(//)40 b(for)g(off_Shtl)639
2350 y Fz(An)25 b(indexer)f(is)g(main)n(tained)g(b)n(y)g(the)h(allo)r
(cator.)34 b(Besides,)24 b(a)g(k)n(ernel)f(virtual)h(memory)515
2449 y(region)i(is)i(pro)n(vided)e(b)n(y)h(the)h(creator.)515
2582 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2582 V 29 w(ShtlAllocator)p Fj(.)i Fk(i)o
Fq(\021)598 2673 y Fi(static)40 b(off_Indexer<off_LShtl>)45
b(s_idx;)515 2848 y Fk(h)p Fj(O\013)27 b(shuttle)i(al)t(lo)l(c)l(ator)g
(static)f(memb)l(ers.)g Fk(i)p Fq(\021)598 2939 y Fi
(off_Indexer<off_LShtl>)44 b(off_ShtlAllocator::s_idx;)639
3080 y Fz(The)28 b(allo)r(cator)e(is)h(initialized)h(as)f(follo)n(ws.)
515 3196 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3196 V 29 w(ShtlAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 3288 y Fi(//)39 b(Creates)i(a)f(shuttle)h(allocator.)598
3379 y(off_ShtlAllocator\(off_Exhauste)q(d)k(*r,)40 b(off_KVMRegion)i
(*reg\);)639 3504 y Fz(The)25 b(region)f(is)h(used)g(to)g(pro)n(vide)f
(memory)g(for)h(the)g(\(gro)n(wing\))f(arra)n(y)f(of)i(sh)n(uttles.)36
b(A)515 3603 y(p)r(oin)n(ter)24 b(to)g(the)h(start)f(of)g(suc)n(h)g
(arra)n(y)e(is)i(k)n(ept)h(inside)f(the)h(sh)n(uttle)g(allo)r(cator)d
(so)i(w)n(e)g(could)515 3703 y(rede\014ne)j(the)h Fx(operator)40
b(+)p Fz(.)515 3836 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3836 V 29 w(ShtlAllocator)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 3927 y Fi(off_LShtl)41 b(*s_shtls;)515
4101 y Fk(h)p Fi(off)p 667 4101 V 29 w(ShtlAllocator::off)p
1398 4101 V 32 w(ShtlAllocator)30 b Fj(implementation.)e
Fk(i)p Fq(\021)598 4193 y Fi(//)39 b(Creates)i(a)f(shuttle)h
(allocator.)598 4284 y(off_ShtlAllocator::off_ShtlAll)q(ocato)q(r\(of)q
(f_Ex)q(haust)q(ed)k(*r,)40 b(off_KVMRegion)i(*reg\))f(:)676
4375 y(off_TBlockAllocator<off_LSht)q(l>\(r,)q(\(con)q(st)k
(off_Indexable*\)&s_idx,reg\),)676 4467 y
(s_shtls\(\(off_LShtl*\)reg->get)q(_star)q(t\(\)\))598
4558 y({;})515 4732 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4732 V 29 w(ShtlAllocator)p Fj(.)j Fk(i)p
Fz(+)o Fq(\021)598 4824 y Fi(inline)40 b(off_LShtl)i(*operator)f
(+\(vm_offset_t)h(at\);)1885 5255 y Fz(466)p eop
PStoPSsaved restore
%%Page: (468,469) 235
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
467 468 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlAllocator::operator+)32 b Fj(implementation.)c
Fk(i)p Fq(\021)598 614 y Fi(inline)40 b(off_LShtl)i
(*off_ShtlAllocator::operator)j(+\(vm_offset_t)d(at\))598
706 y({)676 797 y(return)f(s_shtls+at;)598 888 y(})639
1121 y Fz(The)21 b(allo)r(cator)f(m)n(ust)h(b)r(e)g(initialized)h(when)
f(the)g(sh)n(uttle)h(serv)n(er)d(is)i(started,)h(not)f(when)515
1220 y(it)26 b(is)g(instan)n(tiated)f(as)g(there)h(migh)n(t)g(b)r(e)g
(no)g(KVM)f(b)n(y)h(that)g(time.)37 b(The)26 b(rev)n(o)r(cator)d(is)j
(the)515 1320 y(sh)n(uttle)35 b(serv)n(er)d(itself,)37
b(as)d(set)h(at)f(construction)g(time;)39 b(the)c(region)e(is)i(also)e
(created)h(at)515 1420 y(construction)26 b(time.)515
1553 y Fk(h)p Fj(Initialize)g Fi(ShtlSrv::s)p 1261 1553
V 31 w(alloc)p Fj(.)i Fk(i)p Fq(\021)598 1644 y Fi(new\(&s_alloc\))81
b(off_ShtlAllocator\(\(off_Exhau)q(sted*)q(\)thi)q(s,)1892
1735 y(kvm.create_region\("shtl"\)\);)515 1910 y Fk(h)p
Fj(O\013)27 b(shuttle)i(server)g(implementation)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2001 y Fi(#include)41 b(<dmm/KVM.h>)473
b(//)40 b(for)g(kvm)639 2142 y Fz(Where)28 b(w)n(e)f(used)h(the)f
Fx(new)g Fz(op)r(erator)f(tric)n(k.)515 2258 y Fk(h)p
Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2258
V 29 w(ShtlAllocator)p Fj(.)j Fk(i)p Fz(+)o Fq(\021)598
2350 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_ShtlAllocator)k
(*a\))d({)g(\(void\)s;)h(return)f(a;)g(})639 2474 y Fz(The)27
b Fx(notify)d Fz(metho)r(d)j(m)n(ust)g(th)n(us)g(b)r(e)g(pro)n(vided)e
(b)n(y)i(sh)n(uttle)f(serv)n(ers)f(to)h(implemen)n(t)515
2574 y(the)f(resource)e(rev)n(o)r(cator)g(signature.)35
b(Ho)n(w)n(ev)n(er,)24 b(suc)n(h)g(ev)n(en)n(ts)h(are)f(silen)n(tly)h
(discarded)f(in)515 2673 y(this)k(implemen)n(tation.)515
2790 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2790 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2881 y Fi(//)39 b(Notifies)i(that)g(shuttles)g(are)f(exhausted.)598
2972 y(void)g(notify\(void\);)639 3097 y Fz(Once)25 b(the)h(allo)r
(cator)d(has)i(b)r(een)h(initialized,)g(the)g(Sh)n(uttle)g(serv)n(er)d
(can)i(b)r(e)h(indexed)f(to)515 3196 y(obtain)i(references)f(to)i(sh)n
(uttles;)g(they)f(can)h(b)r(e)g(allo)r(cated)e(and)i(deallo)r(cated.)
515 3329 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3329 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3421 y Fi(//Gets)40 b(a)g(Shuttle)h(from)f(its)g
(distributed)h(address)598 3512 y(inline)f(off_Shtl)h
(*operator+\(off_offset_t)k(s\);)598 3603 y(//)39 b(Allocates)j(a)d
(shuttle.)598 3694 y(off_Shtl)i(*alloc\(const)h(off_shtl_id_t)g(&at,)e
(boolean_t)h(use_revocation=FALSE\);)598 3786 y(//)e(Allocates)j(any)e
(shuttle.)598 3877 y(off_Shtl)h(*alloc\(boolean_t)i
(use_revocation=FALSE\);)598 3968 y(//)c(Deallocates)j(a)e(shuttle)598
4060 y(void)g(free\()g(const)h(off_Shtl)g(*s)e(\);)515
4325 y Fk(h)p Fi(off)p 667 4325 V 29 w(ShtlSrv::operator+)31
b Fj(implementation.)d Fk(i)o Fq(\021)598 4417 y Fi(//Gets)40
b(a)g(Shuttle)h(from)f(its)g(distributed)h(address)598
4508 y(inline)f(off_Shtl)h(*off_ShtlSrv::operator+\(off)q(_offs)q(et_t)
46 b(s\))598 4599 y({)676 4691 y(assert\(valid\(\)\);)676
4782 y(return)41 b(&\(s_alloc+s\)->l_shtl;)598 4873 y(})1885
5255 y Fz(467)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
468 469 bop 639 523 a Fz(Sh)n(uttles)28 b(are)f(preinitialized)g(when)h
(they)g(are)e(allo)r(cated.)515 656 y Fk(h)p Fi(off)p
667 656 24 4 v 29 w(ShtlSrv::alloc)k Fj(and)e Fi(free)g
Fj(implementation.)g Fk(i)p Fq(\021)598 747 y Fi(//)39
b(Allocates)j(a)d(shuttle.)598 839 y(off_Shtl)i
(*off_ShtlSrv::alloc\(const)k(off_shtl_id_t)d(&at,)e(boolean_t)h
(use_revocation\))598 930 y({)676 1021 y(off_LShtl)g(*ls;)676
1112 y(assert\(valid\(\)\);)676 1204 y(w_lock\(\);)676
1295 y(ls=s_alloc.allocate\(at,use_r)q(evoca)q(tion)q(\);)676
1386 y(w_unlock\(\);)676 1478 y(if)f(\(ls\))g({)755 1569
y(\(void\))g(new\(ls\))h(off_LShtl\(at,this\);)676 1660
y(})676 1752 y(return)g(\(ls\)?\(&ls->l_shtl\):\(off_Shtl*\))q(NULL)q
(;)598 1843 y(})598 2026 y(//)e(Allocates)j(a)d(shuttle.)598
2117 y(off_Shtl)i(*off_ShtlSrv::alloc\(boolean_t)46 b(use_revocation\))
598 2208 y({)676 2300 y(off_LShtl)41 b(*ls;)676 2391
y(assert\(valid\(\)\);)676 2482 y(w_lock\(\);)676 2574
y(ls=s_alloc.allocate\(use_revo)q(catio)q(n\);)676 2665
y(w_unlock\(\);)676 2756 y(if)f(\(ls\))g({)755 2848 y(off_shtl_id_t)i
(sid\(get_id\(\),s_alloc.pos\(ls\)\);)755 2939 y(\(void\))e(new\(ls\))h
(off_LShtl\(sid,this\);)676 3030 y(})676 3122 y(return)g
(\(ls\)?\(&ls->l_shtl\):\(off_Shtl*\))q(NULL)q(;)598
3213 y(})598 3396 y(//)e(Deallocates)j(an)e(Shuttle)598
3487 y(void)g(off_ShtlSrv::free\()j(const)e(off_Shtl)g(*s)e(\))598
3578 y({)676 3670 y(off_LShtl)i(*ls=\(off_LShtl*\)\(\(\(char*\)s\))q
(-\(in)q(t\)&of)q(f_LS)q(htl::)q(l_sh)q(tl\);)676 3761
y(assert\(valid\(\)\);)676 3852 y(w_lock\(\);)676 3944
y(s_alloc.deallocate\(ls\);)676 4035 y(w_unlock\(\);)598
4126 y(})515 4392 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(dep)l
(endencies.)h Fk(i)o Fz(+)p Fq(\021)598 4483 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)639 4624 y Fz(Sh)n(uttle)34
b(preinitialization)f(uses)f(a)h Fx(new)f Fz(op)r(erator)g(for)g
Fx(LShtl)g Fz(returning)g(its)i(single)515 4724 y(argumen)n(t.)515
4840 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4840 V 29 w(LShtl)p Fj(.)h Fk(i)p Fq(\021)598
4932 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LShtl)j(*p\))e
({)f(\(void\)s;)i(return)g(\(void*\))f(p;)g(})1885 5255
y Fz(468)p eop
PStoPSsaved restore
%%Page: (470,471) 236
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
469 470 bop 639 523 a Fz(A)28 b(preinitialization)f(constructor)f(for)h
Fx(LShtl)p Fz(s)f(is)h(also)g(used.)515 639 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 639
24 4 v 29 w(LShtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
731 y Fi(off_LShtl\(const)42 b(off_shtl_id_t)h(&id,)d(off_ShtlSrv)h
(*ssrv\))g(:)676 822 y(l_shtl\(id,OFF_MAGIC_SHTL,ssr)q(v\))598
913 y({;})639 1038 y Fz(Sh)n(uttles)27 b(are)f(allo)r(cated)f(and)h
(deallo)r(cated)g(with)h Fx(new)e Fz(and)i Fx(delete)d
Fz(op)r(erators.)34 b(The)515 1137 y(op)r(erator)26 b
Fx(new)g Fz(uses)h(the)h(sh)n(uttle)g(serv)n(er)e Fx(alloc)f
Fz(metho)r(d.)515 1270 y Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1270 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 1362 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(const)i
(off_shtl_id_t)h(&at,)1343 1453 y(boolean_t)f(use_revocation=FALSE\);)
598 1544 y(void)f(*operator)h(new\(size_t)h(s,)d(boolean_t)j
(use_revocation=FALSE\);)598 1636 y(void)e(operator)h(delete\(void)h
(*p\);)515 1810 y Fk(h)p Fi(off)p 667 1810 V 29 w(Shtl::operator)g(new)
28 b Fj(implementation.)g Fk(i)o Fq(\021)598 1901 y Fi(void)40
b(*off_Shtl::operator)j(new\(size_t)f(s,)e(boolean_t)h
(use_revocation=FALSE\))598 1993 y({)676 2084 y(off_Shtl)g
(*sh=shtl.alloc\(use_revocatio)q(n\);)676 2175 y(\(void\)s;)676
2267 y(assert\(s)g(&&)f(shtl.valid\(\)\);)676 2358 y(assert\(!sh)i(||)d
(sh->valid\(\)\);)676 2449 y(return)i(\(void*\)sh;)598
2540 y(})598 2632 y(void)f(*off_Shtl::operator)j(new\(size_t)f(s,)e
(const)g(off_shtl_id_t)i(&at,)1735 2723 y(boolean_t)g
(use_revocation=FALSE\))598 2814 y({)676 2906 y(off_Shtl)f
(*sh=shtl.alloc\(at,use_revoca)q(tion)q(\);)676 2997
y(\(void\)s;)676 3088 y(assert\(s)g(&&)f(shtl.valid\(\)\);)676
3180 y(assert\(!sh)i(||)d(sh->valid\(\)\);)676 3271 y(return)i
(\(void*\)sh;)598 3362 y(})515 3628 y Fk(h)p Fi(off)p
667 3628 V 29 w(Shtl::operator)h(delete)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 3719 y Fi(//)39 b(Deallocates)j(this)e(shuttle.)598
3811 y(void)g(off_Shtl::operator)j(delete\(void)f(*p\))598
3902 y({)676 3993 y(off_Shtl)f(*sh=\(off_Shtl*\)p;)676
4085 y(assert\(sh)g(&&)f(sh->valid\(\)\);)676 4176 y(shtl.free\(sh\);)
598 4267 y(})515 4533 y Fk(h)p Fj(O\013)27 b(shuttle)i(implementation)f
(dep)l(endencies.)h Fk(i)p Fq(\021)598 4624 y Fi(#include)41
b(<shtl/ShtlSrv.h>)278 b(//)40 b(for)g(shtl)1885 5255
y Fz(469)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
470 471 bop 515 523 a Fn(5.1.4)112 b(Sh)m(uttle)37 b(rev)m(o)s(cation)
515 676 y Fz(Eac)n(h)17 b(sh)n(uttle)i(serv)n(er)d(deliv)n(ers)h(rev)n
(o)r(cation)g(ev)n(en)n(ts)h(to)g(its)g(exception)g(p)r(ortal)g(or)g
Fx(r)p 3078 676 27 4 v 31 w(domain)p Fz(,)515 776 y(in)23
b(case)e(that)i(p)r(ortal)f(has)g(b)r(een)h(set.)35 b(The)23
b(o)n(wner)e(of)i(that)f(p)r(ortal)g(is)h(the)g(referee)e(for)h(sh)n
(ut-)515 876 y(tle)28 b(rev)n(o)r(cation)d(inside)j(the)g(sh)n(uttle)g
(serv)n(er.)515 1008 y Fk(h)p Fi(off)p 667 1008 24 4
v 29 w(ShtlSrv::notify)i Fj(implementation.)e Fk(i)p
Fq(\021)598 1100 y Fi(//)39 b(Notifies)i(that)g(shuttles)g(are)f
(exhausted.)598 1191 y(void)g(off_ShtlSrv::notify\(void\))598
1282 y({)676 1374 y(assert\(valid\(\)\);)676 1465 y(if)g
(\(get_domain\(\)==OFF_PRTL_NULL\))755 1556 y(return;)676
1648 y(else)g({)755 1739 y(;)598 1830 y(#if)g(0)1059
b(//)40 b(XXX)g(fix)g(this)755 1922 y(off_ExhaustReq)i
(m\(OFF_MAGIC_SHTLSRV,get_id\(\)\))q(;)755 2013 y
(prtl.kpct\(get_domain\(\),off_Shtl)q(::se)q(lf\(\))q(,size)q(of\(m)q
(\),0,&)q(m,NU)q(LL,0)q(\);)598 2104 y(#endif)676 2196
y(})598 2287 y(})515 2553 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
2644 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_ExhaustReq)
598 2735 y(#include)h(<prtl/PrtlSrv.h>)278 b(//)40 b(for)g(prtl.)598
2827 y(#include)h(<hw/Processor.h>)278 b(//)40 b(for)g(Processor)h(and)
f(self.)515 3100 y Fn(5.1.5)112 b(Sh)m(uttles,)37 b(stac)m(ks)h(and)g
(SMP)515 3254 y Fz(On)26 b(SMP)h(mac)n(hines,)f Fx(self)f
Fz(can)h(b)r(e)h(used)g(to)f(determine)h(the)g(sh)n(uttle)g(b)r(eing)f
(run)h(in)g(the)515 3353 y(curren)n(t)f(pro)r(cessor.)515
3486 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3486 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3577 y Fi(//)39 b(Returns)i(the)f(current)h(shuttle)g(in)e(the)h
(current)h(processor.)598 3669 y(static)f(off_Shtl)h(*self\(void\);)639
3810 y Fz(The)36 b(implemen)n(tation)h(is)f(mac)n(hine)f(dep)r(enden)n
(t)i(and)f(uses)g(information)f(found)i(in)515 3910 y(the)28
b(sh)n(uttle)g(k)n(ernel)e(stac)n(k.)515 4042 y Fk(h)p
Fi(off)p 667 4042 V 29 w(Shtl::self)j Fj(implementation.)f
Fk(i)p Fq(\021)598 4134 y Fi(//)39 b(Returns)i(the)f(current)h(shuttle)
g(in)e(the)h(current)h(processor.)598 4225 y(off_Shtl)g
(*off_Shtl::self\(void\))598 4316 y({)676 4408 y(return)g
(off_Processor::self\(\)->get_cur)q(rent)q(\(\);)598
4499 y(})515 4765 y Fk(h)p Fj(O\013)27 b(shuttle)i(late)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4856 y Fi(#include)41
b(<hw/Processor.h>)1885 5255 y Fz(470)p eop
PStoPSsaved restore
%%Page: (472,473) 237
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
471 472 bop 639 523 a Fz(Our)32 b(curren)n(t)h(stac)n(k)e(p)r(oin)n
(ter)i(is)g(a)f(v)-5 b(alue)33 b(so)f(commonly)h(referenced)f(that)h
(sh)n(uttles)515 623 y(pro)n(vide)28 b(means)i(to)f(access)g(it)h
(without)g(a)f(reference)g(to)h(the)g(curren)n(t)f(sh)n(uttle)h
(registers.)515 722 y(Note)d(that)h(it)g(returns)f(k)n(ernel)g
(addresses,)f(b)r(ecause)h(it)h(is)g(called)f(within)h(the)g(k)n
(ernel.)515 855 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 855 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 946 y Fi(//)39 b(Get)h(or)g(set)g(the)g(PC/SP.)598
1038 y(static)g(inline)h(register_t)g(get_sp\(void\);)515
1212 y Fk(h)p Fi(off)p 667 1212 V 29 w(Shtl::get)p 1047
1212 V 30 w(pc)28 b Fj(implementation.)f Fk(i)p Fq(\021)598
1303 y Fi(//)39 b(Get)h(or)g(set)g(the)g(PC/SP.)598 1395
y(inline)g(register_t)i(off_Shtl::get_sp\(void\))i({return)d
(off_mdepShtl::get_sp\(\);})515 1669 y Fn(5.1.6)112 b(Sh)m(uttle)37
b(prop)s(erties)515 1822 y Fz(Prop)r(erties)i(are)g(used)h(to)g(sp)r
(ecify)h(whic)n(h)f(resources)e(\(e.g.)75 b Ft(dtlb)p
Fz(s,)43 b(IO)d(maps,)k(etc.\))515 1922 y(should)23 b(b)r(e)g(readily)f
(a)n(v)-5 b(ailable)22 b(for)g(the)i(sh)n(uttle)f(to)g(run.)35
b(Sp)r(eci\014c)23 b(resource)f(instances)g(are)515 2021
y(iden)n(ti\014ed)30 b(b)n(y)g(a)f(prop)r(ert)n(y)g(v)-5
b(alue)30 b(\(of)g(t)n(yp)r(e)g Fx(off)p 2082 2021 27
4 v 30 w(id)p 2200 2021 V 31 w(t)p Fz(\),)h(resource)d(kinds)i(are)f
(iden)n(ti\014ed)515 2121 y(b)n(y)e(prop)r(erties)g(\(of)h(t)n(yp)r(e)f
Fx(off)p 1471 2121 V 30 w(prop)p 1677 2121 V 30 w(t)p
Fz(\).)515 2254 y Fk(h)p Fj(O\013)g(shuttle)i(pr)l(op)l(erty)h
(identifer.)d Fk(i)p Fq(\021)598 2345 y Fi(//)39 b(Properties)598
2436 y(typedef)i(natural_t)g(off_prop_t;)598 2528 y(const)f(off_prop_t)
i(OFF_PROP_NULL=\(off_prop_t\)-1;)1885 5255 y Fz(471)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
472 473 bop 639 523 a Fz(The)22 b(op)r(erational)e(meaning)h(of)h(a)f
(prop)r(ert)n(y)g(is)h(clear)e(if)j(w)n(e)e(consider)g(that)h(the)g(sh)
n(uttle)515 623 y(serv)n(er)k(co)r(de)h(is)g(guaran)n(teed)f(to:)639
789 y Fq(\017)41 b Fz(Call)24 b(a)f(prop)r(ert)n(y)g(switc)n(h)h
(function,)h Fx(pswitch)p Fz(,)d(supplying)i(the)g(prop)r(ert)n(y)f(v)
-5 b(alue)24 b(as)722 888 y(an)k(argumen)n(t)e(ev)n(ery)g(time)j(a)e
(sh)n(uttle)h(using)f(it)h(is)f(ab)r(out)h(to)f(run.)639
1054 y Fq(\017)41 b Fz(Call)35 b(a)h(prop)r(ert)n(y)e(set)i(function,)i
Fx(pset)p Fz(,)e(supplying)f(the)h(v)-5 b(alue)35 b(b)r(eing)h(set)f
(ev)n(ery)722 1154 y(time)28 b(the)g(prop)r(ert)n(y)f(v)-5
b(alue)27 b(is)h(\(re\)set)f(in)h(a)f(sh)n(uttle.)639
1320 y Fq(\017)41 b Fz(Call)25 b(a)f(prop)r(ert)n(y)g(clean)n(up)g
(function,)i Fx(pclr)p Fz(,)d(supplying)i(the)g(v)-5
b(alue)25 b(b)r(eing)f(cleaned)722 1420 y(up)k(ev)n(ery)f(time)h(the)g
(prop)r(ert)n(y)e(v)-5 b(alue)28 b(is)f(ab)r(out)h(to)f(b)r(e)h(set.)
639 1586 y(The)39 b(\014rst)f(function)h(is)f(in)n(tended)h(to)f(b)r(e)
h(used)f(as)g(a)g(command)2763 1556 y Fp(2)2838 1586
y Fz(or)g(callbac)n(k)f(for)515 1685 y(con)n(text)26
b(switc)n(hes;)h(The)f(last)h(t)n(w)n(o)e(functions,)j(are)d(pro)n
(vided)h(for)g(those)g(cases)g(when)h(the)515 1785 y(hardw)n(are)c(is)j
(switc)n(hing)f(the)h(con)n(text)g(automatically)e(but)i(some)g(w)n
(ork)e(should)h(b)r(e)h(done)515 1885 y(to)h(install)h(\(or)f
(deinstall\))h(a)f(prop)r(ert)n(y)f(v)-5 b(alue)28 b(in)g(a)f(giv)n(en)
g(sh)n(uttle.)639 1984 y(Th)n(us,)h(a)f(prop)r(ert)n(y)f(can)i(b)r(e)g
(de\014ned)f(as)g(follo)n(ws:)515 2100 y Fk(h)p Fj(O\013)g(shuttle)i
(pr)l(op)l(erty.)g Fk(i)p Fq(\021)598 2192 y Fi(//)39
b(A)h(shuttle)h(property.)598 2283 y(//)598 2374 y(class)f
(off_ShtlProp)i({)598 2466 y(public:)676 2557 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
2557 24 4 v 29 w(ShtlProp)p Fj(.)i Fk(i)598 2648 y Fi(private:)676
2740 y(off_id_t)41 b(p_val;)629 b(//)40 b(Property)h(value.)676
2831 y(off_ShtlPropSrv)i(*p_srv;)315 b(//)40 b(Property)h(server.)676
2922 y(off_ShtlPropSrv)i(*p_swsrv;)237 b(//)40 b(Property)h(server)g
(for)e(switch\(\))j(\(cached\).)598 3014 y(};)515 3263
y Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(dep)l(endencies.)f
Fk(i)p Fq(\021)598 3354 y Fi(#include)41 b(<klib/err.h>)434
b(//)40 b(for)g(err_t)598 3445 y(#include)h(<klib/ids.h>)434
b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d(al.)598 3537 y(#include)i
(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)p 515 4929 1146 4 v 607 4983 a Fm(2)642 5006 y Fl(See)24
b(the)h(command)d(pattern.)1885 5255 y Fz(472)p eop
PStoPSsaved restore
%%Page: (474,475) 238
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
473 474 bop 639 523 a Fz(Where)28 b(the)g(prop)r(ert)n(y)e(serv)n(er)g
(m)n(ust)i(implemen)n(t)g(this)g(in)n(terface)2714 493
y Fp(3)2750 523 y Fz(:)515 656 y Fk(h)p Fj(O\013)f(shuttle)i(pr)l(op)l
(erty)h(server.)f Fk(i)p Fq(\021)598 747 y Fi(//)39 b(The)h(interface)i
(of)d(a)h(property)h(server.)598 839 y(//)598 930 y(signature)g
(off_ShtlPropSrv)i({)676 1112 y(//)d(Switches)h(property)g(values.)676
1204 y(//)f(Returns)h(either)f(0)g(or)f(an)h(error)g(code.)676
1295 y(err_t)h(pswitch\(const)h(off_id_t)f(&to,)f(const)g
(off_shtl_id_t)i(&s\);)676 1478 y(//)e(Set)g(or)f(clear)i(the)f
(property)h(at)e(a)h(given)g(shuttle.)676 1569 y(err_t)h
(pset\(off_id_t)h(&pval,const)f(off_shtl_id_t)i(&s\);)676
1660 y(void)80 b(pclr\(const)41 b(off_id_t)g(&pval,)g(const)f
(off_shtl_id_t)i(&s\);)676 1843 y(//)e(Is)g(pswitch)g(used?)676
1934 y(boolean_t)h(needs_switch\(void\);)598 2026 y(};)639
2258 y Fz(When)33 b(a)f(prop)r(ert)n(y)f(is)g(b)r(eing)i(created)e
(\(i.e.)51 b(de\014ned\),)34 b(its)e(v)-5 b(alue)32 b(and)g(serv)n(er)e
(m)n(ust)515 2358 y(b)r(e)e(pro)n(vided.)515 2474 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2474
24 4 v 29 w(ShtlProp)p Fj(.)i Fk(i)o Fq(\021)598 2565
y Fi(//)39 b(Creates)i(this)f(property.)598 2657 y
(off_ShtlProp\(off_ShtlPropSrv)45 b(*srv,)c(const)f(off_id_t)h(&val\);)
639 2781 y Fz(Although)23 b(another)f(constructor)f(is)h(pro)n(vided)g
(to)g(declare)g(uninitialized)h(prop)r(erties.)515 2897
y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2897 V 29 w(ShtlProp)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
2989 y Fi(//)39 b(Creates)i(this)f(property)h(as)f(unitialized)598
3080 y(off_ShtlProp\(void\))j(:)676 3171 y(p_val\(OFF_ID_NULL\))598
3263 y({;})515 3421 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3421 V 29 w(ShtlProp)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 3512 y Fi(inline)80 b(off_ShtlProp)42 b
(&off_ShtlProp::operator=\(off_Sh)q(tlPro)q(p&ot)q(her\))q(;)515
3686 y Fk(h)p Fi(off)p 667 3686 V 29 w(ShtlProp::operator=)31
b Fj(implementation.)d Fk(i)p Fq(\021)598 3778 y Fi(inline)80
b(off_ShtlProp)42 b(&off_ShtlProp::operator=\(off_Sh)q(tlPro)q(p&ot)q
(her\))598 3869 y({)676 3960 y(p_val=other.p_val;)676
4051 y(\(void\)\(p_swsrv=other.p_swsrv)q(\);)676 4143
y(\(void\)\(p_srv=other.p_srv\);)676 4234 y(return)f(*this;)598
4325 y(})p 515 4850 1146 4 v 607 4904 a Fm(3)642 4927
y Fl(An)24 b(abstract)h(class)f(could)h(do)g(the)g(job,)f(but)h(GNU)f
(C++)g(signatures)g(pro)n(vide)h(subt)n(yp)r(e)h(p)r(olymor-)515
5006 y(phism)c(indep)r(enden)n(tly)k(from)21 b(the)k(inheritance)g
(hierarc)n(h)n(y)-6 b(.)1885 5255 y Fz(473)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
474 475 bop 639 523 a Fz(The)26 b(prop)r(ert)n(y)e(calls)h(the)g(serv)n
(er)f Fx(needs)p 1932 523 27 4 v 29 w(switch)f Fz(to)j(determine)f(if)h
(the)g(switc)n(h)f(func-)515 623 y(tion)c(is)f(needed)h(or)f(not,)j(as)
d(there)g(are)g(prop)r(erties)g(whic)n(h)h(do)g(not)f(need)h(a)g(switc)
n(h)f(function)515 722 y(\(eg.)38 b(those)28 b(prop)r(erties)f(handled)
h(b)n(y)g(the)g(hardw)n(are,)e(lik)n(e)i(the)g(IOPL,)f(and)h(those)g
(prop-)515 822 y(erties)f(whic)n(h)g(are)g(passiv)n(e,)f(lik)n(e)i
(user)e(ids\).)515 944 y Fk(h)p Fi(off)p 667 944 24 4
v 29 w(ShtlProp::off)p 1203 944 V 31 w(ShtlProp)j Fj(implementation.)e
Fk(i)p Fq(\021)598 1035 y Fi(off_ShtlProp::off_ShtlProp\(off)q(_Shtl)q
(Prop)q(Srv)46 b(*srv,)40 b(const)g(off_id_t)h(&val\))g(:)676
1127 y(p_val\(val\),)h(p_srv\(srv\))598 1218 y({)676
1309 y(if)e(\(srv->needs_switch\(\)\))755 1401 y(p_swsrv=srv;)676
1492 y(else)755 1583 y(*\(void**\)&p_swsrv=NULL;)598
1675 y(})639 1896 y Fz(The)28 b(prop)r(ert)n(y)e(v)-5
b(alue)27 b(can)g(b)r(e)h(c)n(hanged)e(later)h(at)g(an)n(y)f(time)i
(and)f(can)g(b)r(e)h(consulted.)515 2007 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2007 V 29 w(ShtlProp)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 2099 y Fi(//)39 b(Sets)i(a)e(new)h
(value)g(for)g(this)g(property.)598 2190 y(inline)g(void)g
(set_val\(const)j(off_id_t)e(&val\);)598 2281 y(//)e(Returns)i(the)f
(property)h(value.)598 2373 y(inline)f(const)h(off_id_t)g
(&get_val\(void\))h(const;)598 2464 y(inline)e(off_ShtlPropSrv)j
(*get_psrv\(void\);)515 2606 y Fk(h)p Fi(off)p 667 2606
V 29 w(ShtlProp::set)p 1203 2606 V 31 w(val)28 b Fj(and)g
Fi(get)p 1645 2606 V 29 w(val)g Fj(implementation.)f
Fk(i)p Fq(\021)598 2697 y Fi(//)39 b(Sets)i(a)e(new)h(value)g(for)g
(this)g(property.)598 2788 y(inline)g(void)g
(off_ShtlProp::set_val\(const)46 b(off_id_t)41 b(&val\))f({)g(p_val)g
(=)g(val;)g(})598 2880 y(//)f(Returns)i(the)f(property)h(value.)598
2971 y(inline)f(const)h(off_id_t)g(&off_ShtlProp::get_val\(void\))k
(const)c({)e(return)i(p_val;)f(})598 3062 y(inline)g(off_ShtlPropSrv)j
(*off_ShtlProp::get_psrv\(void\))j({)39 b(return)i(p_srv;)f(})639
3193 y Fz(The)33 b(prop)r(ert)n(y)e(serv)n(er,)h(implemen)n(ting)h(the)
g(functions)g(servicing)e(the)i(prop)r(ert)n(y)-7 b(,)33
b(is)515 3292 y(reac)n(hable)26 b(through)h(the)h(prop)r(ert)n(y)-7
b(.)515 3403 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3403 V 29 w(ShtlProp)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 3495 y Fi(//)39 b(Switches)i(property)h(values.)598
3586 y(//)d(Returns)i(either)g(0)e(or)h(an)g(error)g(code.)598
3677 y(inline)g(err_t)h(pswitch\(const)h(off_shtl_id_t)g(&s\);)598
3860 y(//)d(Set)h(or)g(clear)g(the)g(property)h(at)f(a)f(given)i
(shuttle.)598 3951 y(err_t)f(pset\(off_id_t)i(&pval,)f(const)f
(off_shtl_id_t)i(&s\);)515 4184 y Fk(h)p Fi(off)p 667
4184 V 29 w(ShtlProp::pswitch)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 4276 y Fi(//)39 b(Switches)i(property)h(values.)598
4367 y(//)d(Returns)i(either)g(0)e(or)h(an)g(error)g(code.)598
4458 y(inline)g(err_t)h(off_ShtlProp::pswitch\(const)k(off_shtl_id_t)d
(&s\))598 4550 y({)676 4641 y(if)e(\(\(void*\)p_swsrv!=NULL\))755
4732 y(return)79 b(p_swsrv->pswitch\(p_val,s\);)676 4824
y(else)755 4915 y(return)40 b(EOK;)598 5006 y(})1885
5255 y Fz(474)p eop
PStoPSsaved restore
%%Page: (476,477) 239
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
475 476 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlProp::pset)30 b Fj(and)e Fi(pclr)g Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Set)h(or)g(clear)g(the)g(property)h
(at)f(a)f(given)i(shuttle.)598 706 y(err_t)f
(off_ShtlProp::pset\(off_id_t)45 b(&pval,)c(const)f(off_shtl_id_t)j
(&s\))598 797 y({)676 888 y(p_srv->pclr\(p_val,s\);)676
980 y(p_val=pval;)676 1071 y(return)e(p_srv->pset\(p_val,s\);)598
1162 y(})639 1395 y Fz(There)19 b(are)g(t)n(w)n(o)g(kind)h(of)f(prop)r
(ert)n(y)g(serv)n(ers,)g(one)g(using)g(pro)r(cedure)g(calls)g(for)g
(in-k)n(ernel)515 1494 y(prop)r(erties)24 b(and)i(another)f(using)g(p)r
(ortal)g(calls)g(for)g(o\013-k)n(ernel)f(prop)r(erties.)35
b(The)26 b(\014rst)f(one)515 1594 y(can)j(b)r(e)h(implemen)n(ted)g
(using)f(a)g(p)r(oin)n(ter)g(to)g(an)g(ob)5 b(ject)28
b(matc)n(hing)g(the)h(prop)r(ert)n(y)e(serv)n(er)515
1694 y(in)n(terface)g(sho)n(wn)g(ab)r(o)n(v)n(e.)35 b(The)28
b(second)f(one)g(can)g(use)h(this)f(wrapp)r(er.)515 1826
y Fk(h)p Fj(O\013)g(o\013-kernel)i(shuttle)g(pr)l(op)l(erty)h(server.)f
Fk(i)p Fq(\021)598 1918 y Fi(//)39 b(A)h(user-serviced)i(property)598
2009 y(//)598 2100 y(class)e(off_uShtlPropSrv)j({)598
2192 y(public:)676 2283 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 2283 V 29 w(uShtlPropSrv)p Fj(.)j
Fk(i)676 2466 y Fi(//)40 b(Switches)h(property)g(values.)676
2557 y(//)f(Returns)h(either)f(0)g(or)f(an)h(error)g(code.)676
2648 y(err_t)h(pswitch\(const)h(off_id_t)f(&to,)f(const)g
(off_shtl_id_t)i(&s\);)676 2831 y(//)e(Set)g(or)f(clear)i(the)f
(property)h(at)e(a)h(given)g(shuttle.)676 2922 y(err_t)h
(pset\(off_id_t)h(&pval,const)f(off_shtl_id_t)i(&s\);)676
3014 y(void)80 b(pclr\(const)41 b(off_id_t)g(&pval,)g(const)f
(off_shtl_id_t)i(&s\);)676 3196 y(//)e(Is)g(pswitch)g(used?)676
3288 y(boolean_t)h(needs_switch\(void\);)598 3470 y(};)639
3703 y Fz(Prop)r(erties)30 b(handled)h(inside)g(the)g(k)n(ernel)g(m)n
(ust)g(b)r(e)g(w)n(ell-de\014ned)g(at)g(ev)n(ery)f(no)r(de)h(in)515
3802 y(the)j(net)n(w)n(ork,)f(user)g(prop)r(erties)g(do)g(not)g(need)h
(to.)54 b(F)-7 b(or)33 b(user)g(de\014ned)h(prop)r(erties,)g(the)515
3902 y(p)r(ortal)f(servicing)g(prop)r(ert)n(y)g(switc)n(hes)g(is)h
(carried)f(along)f(with)j(the)f(prop)r(ert)n(y)f(v)-5
b(alue)34 b(in)515 4002 y(ev)n(ery)29 b(sh)n(uttle.)48
b(Ev)n(ery)29 b(k)n(ernel)h(can)h(then)h(blindly)f(jump)h(through)e
(that)i(p)r(ortal)e(at)h(an)n(y)515 4101 y(no)r(de.)k(Of)21
b(course,)g(it)h(is)f(wise)g(to)g(ha)n(v)n(e)f(those)g(p)r(ortals)h
(replicated)f(at)h(ev)n(ery)f(no)r(de)h(b)r(ecause)515
4201 y(they)28 b(will)f(b)r(e)h(used)g(ev)n(ery)e(sh)n(uttle)i(switc)n
(h.)639 4301 y(The)23 b(user)f(p)r(ortal)h(servicing)e(a)i(prop)r(ert)n
(y)e(is)i(giv)n(en)f(when)h(the)g(user)g(prop)r(ert)n(y)e(is)i(b)r
(eing)515 4400 y(created.)515 4516 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4516 V 29
w(uShtlPropSrv)p Fj(.)i Fk(i)p Fq(\021)598 4608 y Fi(//)39
b(Creates)i(a)f(user)g(property)h(server)f(dispatching)i(to)e(the)g
(given)g(portal.)598 4699 y(off_uShtlPropSrv\(const)k(off_prtl_id_t)e
(&uobj,)f(boolean_t)g(needs_switch=FALSE\);)639 4824
y Fz(A)26 b(\015ag)e(is)i(also)e(giv)n(en)g(so)h(that)h(the)f(sh)n
(uttle)h(serv)n(er)d(could)i(kno)n(w)g(if)h(it)f(is)h(necessary)d(at)
515 4923 y(all)k(to)h(call)p Fx(pswitch)c Fz(\(to)k(prepare)e(the)i
(prop)r(ert)n(y)e(for)h(use\).)1885 5255 y(475)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
476 477 bop 515 523 a FA(Sh)m(uttle)32 b(prop)s(ert)m(y)g(allo)s
(cation)515 676 y Fz(Hardwired)k(sh)n(uttle)i(prop)r(erties)e(are)g
(not)i(an)f(issue)g(for)g(allo)r(cation.)65 b(Non-hardwired)515
776 y(sh)n(uttle)37 b(prop)r(erties)e(are)h(k)n(ept)g(in)h(prop)r(ert)n
(y)e(sets,)k(of)d(t)n(yp)r(e)h Fx(ShtlPropAllocato)o(r)p
Fz(.)58 b(A)515 876 y Fx(ShtlPropAllocato)o(r)21 b Fz(is)28
b(a)f(collection)g(of)h(s)f(using)g(a)g(\014xed)h(allo)r(cator.)639
975 y(As)35 b(they)f(are)g(shared,)h(they)f(get)g(reference)g(coun)n
(ters)f(and)h(are)f(deallo)r(cated)h(when)515 1075 y(the)28
b(coun)n(t)f(comes)g(do)n(wn)g(to)h(zero.)515 1208 y
Fk(h)p Fj(O\013)f(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l(ator.)e
Fk(i)p Fq(\021)598 1299 y Fi(//)39 b(A)h(set)g(of)f(property)j(values)
598 1390 y(class)e(off_ShtlPropAllocator)k(:)c(public)g
(off_TBmAllocator<off_ShtlPro)q(p>)45 b({)598 1482 y(private:)676
1573 y Fk(h)p Fj(O\013)27 b(private)i(memb)l(ers)g(for)e(r)l(efer)l
(enc)l(e)j(c)l(ounting)e(obje)l(cts.)h Fk(i)676 1664
y Fi(static)41 b(off_Indexer<off_ShtlProp>)k(s_idx;)676
1756 y(off_ShtlProp)d(s_props[OFF_NPROP_MAX];)598 1847
y(protected:)598 2030 y(public:)676 2121 y Fk(h)p Fj(O\013)27
b(public)h(metho)l(ds)h(for)e(r)l(efer)l(enc)l(e)j(c)l(ounting)f(obje)l
(cts.)f Fk(i)676 2212 y Fi(//)40 b(Allows)g(uninitialized)j
(allocators.)676 2304 y(off_ShtlPropAllocator\(void\):)755
2395 y(off_TBmAllocator<off_ShtlProp>\()q(OFF_)q(NPRO)q(P_MAX)q(\))676
2486 y({;})676 2669 y(void)d(unused\(void\))i({)e(delete)g(this;)h(})
676 2851 y Fk(h)p Fi(off)p 828 2851 24 4 v 29 w(ShtlPropAllocator::off)
p 1715 2851 V 33 w(ShtlPropAllocator)32 b Fj(implementation.)27
b Fk(i)676 3125 y(h)p Fj(Other)i(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3125 V 29 w(ShtlPropAllocator)p Fj(.)k
Fk(i)598 3308 y Fi(};)515 3482 y Fk(h)p Fj(O\013)c(shuttle)i(pr)l(op)l
(erty)h(al)t(lo)l(c)l(ator)f(static)f(memb)l(ers.)g Fk(i)p
Fq(\021)598 3574 y Fi(off_Indexer<off_ShtlProp>)45 b
(off_ShtlPropAllocator::s_idx;)639 3715 y Fz(The)28 b(maxim)n(um)f(n)n
(um)n(b)r(er)h(of)f(sh)n(uttle)h(prop)r(erties)f(is)g(a)g(system)h
(limit.)515 3831 y Fk(h)p Fj(O\013)f(limits.)f Fk(i)p
Fq(\021)598 3922 y Fi(const)40 b(int)g(OFF_NPROP_MAX)i(=)e(8;)f(//)h
(Max.)g(#)g(of)f(shuttle)i(properties.)515 4080 y Fk(h)p
Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l(ator)f(dep)l
(endencies.)g Fk(i)p Fq(\021)598 4172 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(off_id_t)h(et)e(al.)598
4263 y(#include)i(<klib/BmAllocator.h>)122 b(//)40 b(for)g
(off_TBmAllocator)598 4354 y(#include)h(<shtl/ShtlProp.h>)239
b(//)40 b(for)g(off_ShtlProp)598 4445 y(#include)h(<klib/limits.h>)317
b(//)40 b(for)g(OFF_NPROP_MAX)598 4537 y(#include)h
(<klib/mdep/debug.h>)161 b(//)40 b(for)g(do_debug)1885
5255 y Fz(476)p eop
PStoPSsaved restore
%%Page: (478,479) 240
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
477 478 bop 639 523 a Fz(The)29 b(prop)r(ert)n(y)f(allo)r(cator)g
(rede\014nes)g(a)h(couple)g(of)g Fx(TBmAllocator)24 b
Fz(metho)r(ds)29 b(to)g(im-)515 623 y(plemen)n(t)f(them)g(more)f
(e\016cien)n(tly)-7 b(.)515 756 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 756 24 4 v
29 w(ShtlPropAllocator)p Fj(.)k Fk(i)o Fq(\021)598 847
y Fi(off_ShtlProp)42 b(*operator)f(+\(natural_t)h(at\))e({)676
938 y(return)h(s_props+\(at\);)598 1029 y(})598 1121
y(off_ShtlProp)h(&operator)f([]\(natural_t)h(at\))e({)676
1212 y(return)h(s_props[at];)598 1303 y(})598 1395 y(natural_t)159
b(pos\(off_ShtlProp*p\))43 b({)676 1486 y(return)e(p)e(-)h(s_props;)598
1577 y(})639 1719 y Fz(When)28 b(the)g(prop)r(ert)n(y)f(allo)r(cator)f
(is)h(created,)g(it)h(initializes)g(its)f(prop)r(ert)n(y)g(arra)n(y)-7
b(.)515 1835 y Fk(h)p Fi(off)p 667 1835 V 29 w(ShtlPropAllocator::off)p
1554 1835 V 33 w(ShtlPropAllocator)31 b Fj(implementation.)d
Fk(i)o Fq(\021)598 1926 y Fi(//)39 b(Creates)i(a)f(ShtlProp)h
(allocator.)598 2017 y(off_ShtlPropAllocator::off_Sht)q(lProp)q(Allo)q
(cato)q(r\(off)q(_Exh)q(auste)q(d)k(*r\))40 b(:)676 2109
y(off_TBmAllocator<off_ShtlPro)q(p>\(r,)q(\(con)q(st)45
b(off_Indexable*\)&s_idx,)1892 2200 y(&s_props[0],OFF_NPROP_MAX)g(\),)
676 2291 y Fk(h)p Fj(O\013)27 b(aggr)l(e)l(gate)k(initialization)c(for)
g(r)l(efer)l(enc)l(e)i(c)l(ounting)g(obje)l(cts.)g Fk(i)598
2383 y Fi({)676 2565 y(do_debug\(putchar\('p'\)\);)598
2657 y(})639 2873 y Fz(The)h(allo)r(cator)e(is)i(initialized)g(only)f
(the)h(v)n(ery)f(\014rst)g(time)h(it)g(is)g(needed.)43
b(It)30 b(uses)g(the)515 2972 y(sh)n(uttle)e(as)f(a)g(\(n)n(ull\))h
(rev)n(o)r(cator.)515 3088 y Fk(h)p Fj(Initialize)e Fi(Shtl::s)p
1144 3088 V 30 w(palloc)p Fj(.)i Fk(i)p Fq(\021)598 3180
y Fi(s_palloc\(NULL\))639 3304 y Fz(The)g(sh)n(uttle)g(pro)n(vides)e
(this)i(n)n(ull)g Fx(notify)d Fz(routine.)515 3421 y
Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3421 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3512 y Fi(//)39 b(Notifies)i(that)g(properties)g(are)f(exhausted.)598
3603 y(void)g(notify\(void\){;})1885 5255 y Fz(477)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
478 479 bop 639 523 a Fz(After)28 b(b)r(eing)g(initialized,)f(the)h
(allo)r(cator)e(is)h(\014lled)h(up)f(with)h(those)f(prop)r(erties)g
(found)515 623 y(in)21 b(the)g(protot)n(yp)r(e)e(sh)n(uttle)i(so)f
(that)h(a)f(sh)n(uttle)h(can)f(not)h(violate)f(the)h(constrain)n(ts)e
(imp)r(osed)515 722 y(b)n(y)27 b(its)h(prop)r(erties)e(b)n(y)i
(creating)e(another)h(sh)n(uttle.)639 822 y(Initially)-7
b(,)28 b(sh)n(uttles)g(with)g(a)f(protot)n(yp)r(e)g(b)r(orro)n(w)f(the)
i(protot)n(yp)r(e)e(arra)n(y)-7 b(.)515 938 y Fk(h)p
Fj(Initialize)26 b(other)j(private)g(memb)l(ers)g(of)e
Fi(off)p 1854 938 24 4 v 29 w(Shtl)h Fj(ac)l(c)l(or)l(ding)h(to)f
Fi(proto)p Fj(.)g Fk(i)p Fq(\021)598 1029 y Fi(if)39
b(\(proto\){)676 1121 y(if)h(\(\(s_palloc=proto->get_allocato)q
(r\(\)\))q(\){)755 1212 y(s_palloc->reference\(\);)755
1303 y(for)g(\(natural_t)h(nprops=proto->get_nprops\(\),p=)q(OFF_)q
(NPROP)q(_BUI)q(LTIN)q(;)951 1395 y(p<nprops;)951 1486
y(p++\){)833 1577 y(proto->get_psrv\(p\)->pset\(prot)q(o->g)q(et_p)q
(rop\(p)q(\),ge)q(t_id\()q(\)\);)755 1669 y(})676 1760
y(})676 1851 y(assert\(!s_palloc)i(||)d(s_palloc->get_num_refs\(\))k
(>1\);)676 1943 y Fk(h)p Fj(Initialize)27 b(har)l(dwir)l(e)l(d)i(pr)l
(op)l(erties)h(with)d(those)i(of)e Fi(proto)p Fj(.)h
Fk(i)598 2034 y Fi(})598 2125 y(else)40 b({)676 2217
y Fk(h)p Fj(Setup)29 b(r)l(o)l(ot)g(shuttle.)f Fk(i)598
2308 y Fi(})639 2433 y Fz(Where)g Fx(OFF)p 1042 2433
27 4 v 30 w(NPROP)p 1292 2433 V 29 w(BUILTIN)d Fz(is)i(a)h(sh)n(uttle)g
(serv)n(er)d(supplied)j(constan)n(t.)639 2532 y(Later,)e(when)h
(attempting)g(to)g(either)g(de\014ne)g(or)e(set)i(a)f(new)h(prop)r(ert)
n(y)-7 b(,)26 b(the)h(prop)r(ert)n(y)515 2632 y(arra)n(y)e(is)i
(duplicated.)515 2748 y Fk(h)p Fj(Ensur)l(e)h(we)g(have)h(pr)l(op)l
(erties.)g Fk(i)p Fq(\021)598 2839 y Fi(if)39 b(\(!s_palloc\){)676
2931 y(s_palloc=new)j(off_ShtlPropAllocator\(\(off_E)q(xhaus)q(ted*)q
(\)this)q(\);)676 3022 y(assert\(s_palloc)h(&&)d
(s_palloc->get_num_refs\(\)==1\);)676 3113 y(for\(off_prop_t)j(pi=0;)d
(pi<OFF_NPROP_BUILTIN;)k(pi++\))755 3205 y(new\(this\))d
(off_ShtlProp\(\);)676 3296 y(assert\(s_palloc->get_nalloc\()q(\)==OF)q
(F_NP)q(ROP_)q(BUILT)q(IN\);)598 3387 y(})515 3545 y
Fk(h)p Fj(Ensur)l(e)28 b(we)g(have)h(our)f(own)f(pr)l(op)l(erties.)j
Fk(i)p Fq(\021)598 3636 y Fi(assert\(s_palloc\);)598
3728 y(if)39 b(\(s_palloc->get_num_refs\(\)>1)q(\){)676
3819 y(off_ShtlPropAllocator)44 b(*old=s_palloc;)676
3910 y(s_palloc=new)e(off_ShtlPropAllocator\(\(off_E)q(xhaus)q(ted*)q
(\)this)q(\);)676 4002 y(assert\(s_palloc\);)676 4093
y(*s_palloc=*old;)676 4184 y(old->unreference\(\);)598
4276 y(})1885 5255 y Fz(478)p eop
PStoPSsaved restore
%%Page: (480,481) 241
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
479 480 bop 639 523 a Fz(The)30 b(sh)n(uttle)g(for)f(the)i(initial)f
(\015o)n(w)f(of)g(con)n(trol)g(is)g(a)h(little)g(bit)h(sp)r(ecial.)43
b(Their)29 b(prop-)515 623 y(erties)e(are)f(initialized)i(to)g(matc)n
(h)f(those)g(of)h(the)g(already)e(existing)h(\015o)n(w)g(of)h(con)n
(trol.)639 722 y(T)-7 b(o)40 b(simplify)g(prop)r(ert)n(y)e(handling,)43
b(sh)n(uttles)d(pro)n(vide)e(some)i(metho)r(ds)g(to)f(handle)515
822 y(their)27 b(prop)r(erties.)515 955 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 955 24 4 v 29 w(Shtl)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1046 y Fi(//)39 b(How)h(many)g
(properties)i(defined?)598 1137 y(natural_t)80 b(get_nprops\(void\);)
598 1229 y(//)39 b(Defines)i(a)f(new)g(property)h(and)f(sets)g(its)g
(initial)g(value.)598 1320 y(off_prop_t)h(def_prop\(off_ShtlPropSrv)k
(*srv,)40 b(const)h(off_id_t)g(&val\);)598 1411 y(//)e(Gets)i(the)e
(value)i(for)f(a)f(given)i(property.)598 1503 y(off_id_t)g
(get_prop\(off_prop_t)i(p\);)598 1594 y(//)c(Sets)i(the)e(value)i(for)f
(a)f(given)i(property.)598 1685 y(void)f(set_prop\(off_prop_t)j(p,)d
(const)g(off_id_t)i(&val\);)598 1777 y(off_ShtlPropSrv)g
(*get_psrv\(off_prop_t)i(p\);)515 1951 y Fk(h)p Fj(O\013)27
b(shuttle)i(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598
2042 y Fi(#include)41 b(<shtl/ShtlProp.h>)639 2183 y
Fz(When)33 b(a)f(prop)r(ert)n(y)f(is)h(de\014ned)g(it)g(uses)g(the)h
(\014rst)e(a)n(v)-5 b(ailable)31 b(prop)r(ert)n(y)g(slot)h(and)g(its)
515 2283 y(n)n(um)n(b)r(er)25 b(\(adjusted)h(with)g(the)f(n)n(um)n(b)r
(er)g(of)h(prede\014ned)f(prop)r(erties,)g Fx(NPROP)p
2936 2283 27 4 v 29 w(BUILTIN)p Fz(\))e(is)515 2383 y(returned)k(to)g
(the)h(user.)515 2516 y Fk(h)p Fi(off)p 667 2516 24 4
v 29 w(Shtl::get)p 1047 2516 V 30 w(nprops)h Fj(implementation.)e
Fk(i)p Fq(\021)598 2607 y Fi(//)39 b(How)h(many)g(properties)i
(defined?)598 2698 y(natural_t)80 b(off_Shtl::get_nprops\(void\))598
2790 y({)676 2881 y(if\(s_palloc\))755 2972 y(return)40
b(s_palloc->get_nalloc\(\);)676 3064 y(else)676 3155
y(return)h(OFF_NPROP_BUILTIN;)598 3246 y(})515 3512 y
Fk(h)p Fi(off)p 667 3512 V 29 w(Shtl::get)p 1047 3512
V 30 w(psrv)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3603 y Fi(off_ShtlPropSrv)42 b(*off_Shtl::get_psrv\(off_pro)q(p_t)j
(p\))598 3694 y({)676 3786 y(assert\(p>=OFF_NPROP_BUILTIN\))q(;)676
3877 y(return)c(\(*s_palloc\)[p].get_psrv\(\);)598 3968
y(})1885 5255 y Fz(479)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
480 481 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Shtl::def)p 1047 523 V 30 w(prop)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Defines)i(a)f(new)g(property.)598
706 y(off_prop_t)h(off_Shtl::def_prop\(off_ShtlP)q(ropS)q(rv)k(*srv,)c
(const)f(off_id_t)h(&val\))598 797 y({)715 888 y(off_ShtlProp)h(*p;)715
980 y Fk(h)p Fj(Ensur)l(e)29 b(we)f(have)g(pr)l(op)l(erties.)i
Fk(i)715 1071 y(h)p Fj(Ensur)l(e)f(we)f(have)g(our)g(own)g(pr)l(op)l
(erties.)i Fk(i)715 1162 y Fi(if)40 b(\(!\(p=new\(this\))j
(off_ShtlProp\(srv,val\)\)\))794 1254 y(return)d(OFF_PROP_NULL;)715
1345 y(else)h({)794 1436 y(off_prop_t)g(pid=s_palloc->pos\(p\);)794
1528 y(set_prop\(pid,val\);)794 1619 y(return)f(pid;)715
1710 y(})598 1802 y(})515 2067 y Fk(h)p Fi(off)p 667
2067 V 29 w(Shtl::get)p 1047 2067 V 30 w(prop)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 2159 y Fi(//)39 b(Gets)i(the)e(value)i(for)f(a)f
(given)i(property.)598 2250 y(off_id_t)g
(off_Shtl::get_prop\(off_prop_t)46 b(p\))598 2341 y({)676
2433 y(switch\(p\){)755 2524 y Fk(h)p Fj(c)l(ase)28 b(to)g(r)l(eturn)i
(pr)l(e)l(de\014ne)l(d)f(pr)l(op)l(erty)h Fi(p)e Fj(value)g(in)f
Fi(get)p 2413 2524 V 29 w(prop)p Fj(.)h Fk(i)676 2615
y Fi(default:)755 2707 y(if)39 b(\(!s_palloc\))833 2798
y(return)i(OFF_ID_NULL;)755 2889 y(else)833 2980 y(return)g
(\(*s_palloc\)[p].get_val\(\);)676 3072 y(})598 3163
y(})515 3429 y Fk(h)p Fi(off)p 667 3429 V 29 w(Shtl::set)p
1047 3429 V 30 w(prop)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 3520 y Fi(//)39 b(Sets)i(the)e(value)i(for)f(a)f(given)i
(property.)598 3611 y(void)f(off_Shtl::set_prop\(off_prop_t)46
b(p,)39 b(const)i(off_id_t)g(&val\))598 3703 y({)676
3794 y(switch\(p\){)755 3885 y Fk(h)p Fj(c)l(ase)28 b(to)g(set)h(pr)l
(e)l(de\014ne)l(d)h(pr)l(op)l(erty)g Fi(p)d Fj(value)h
Fi(val)g Fj(in)f Fi(set)p 2444 3885 V 29 w(prop)p Fj(.)h
Fk(i)676 3977 y Fi(default:)755 4068 y(if)39 b(\(!s_palloc)j(||)e(p)f
(>=)h(s_palloc->get_maxalloc\(\)\))833 4159 y(return;)755
4251 y Fk(h)p Fj(Ensur)l(e)28 b(we)g(have)g(our)h(own)e(pr)l(op)l
(erties.)j Fk(i)755 4342 y Fi(\(*s_palloc\)[p].pset\(val,get_id\()q
(\)\);)755 4433 y(\(*s_palloc\)[p].set_val\(val\);)676
4525 y(})598 4616 y(})1885 5255 y Fz(480)p eop
PStoPSsaved restore
%%Page: (482,483) 242
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
481 482 bop 639 523 a Fz(Before)39 b(w)n(e)g(used)g(the)h(op)r(erator)e
Fx(new)g Fz(to)h(de\014ne)h(a)f(new)h(prop)r(ert)n(y)-7
b(.)71 b(W)-7 b(e)40 b(ha)n(v)n(e)e(to)515 623 y(implemen)n(t)28
b(it.)515 756 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 756 24 4 v 29 w(ShtlProp)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 847 y Fi(//)39 b(Allocates)j(a)d(new)h(property)h
(slot.)598 938 y(void)f(*operator)h(new\(size_t)h(s,)d(off_Shtl)i
(*s\);)515 1112 y Fk(h)p Fi(off)p 667 1112 V 29 w(ShtlProp::operator)i
(new)28 b Fj(implementation.)f Fk(i)p Fq(\021)598 1204
y Fi(//)39 b(Allocates)j(a)d(new)h(property)h(slot.)598
1295 y(void)f(*off_ShtlProp::operator)k(new\(size_t)e(s,)e(off_Shtl)h
(*sh\))598 1386 y({)676 1478 y(\(void\)s;)676 1569 y(return)g
(\(void*\)\(sh->get_allocator\(\)->a)q(lloc)q(ate\(F)q(ALSE)q(\)\);)598
1660 y(})515 1926 y Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h
(dep)l(endencies.)f Fk(i)p Fz(+)p Fq(\021)598 2017 y
Fi(class)40 b(off_Shtl;)515 2192 y Fk(h)p Fj(O\013)27
b(shuttle)i(pr)l(op)l(erty)h(implementation)e(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2283 y Fi(#include)41 b(<shtl/Shtl.h>)1885
5255 y Fz(481)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
482 483 bop 515 523 a FA(Allo)s(cating)30 b(the)i(allo)s(cator)515
676 y Fz(W)-7 b(e)31 b(still)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g
Fx(new)e Fz(op)r(erator)g(for)h(prop)r(ert)n(y)g(allo)r(cators.)43
b(What)31 b(w)n(e)f(use)515 776 y(is)d(an)h(static)f(allo)r(cator)f
(allo)r(cator.)515 909 y Fk(h)p Fj(O\013)h(shuttle)i(pr)l(op)l(erty)h
(r)l(e-al)t(lo)l(c)l(ator.)f Fk(i)p Fq(\021)598 1000
y Fi(//)39 b(A)h(linkable)h(off_ShtlPropAllocator)598
1091 y(//)598 1183 y(class)f(off_LShtlPropAllocator)k(:)c(public)g
(DLinkedNode)i({)598 1274 y(public:)676 1365 y(off_ShtlPropAllocator)i
(l_alloc;)551 b(//)40 b(The)g(alloctaor)676 1548 y(//)g(To)g(allow)g
(uninitilized)i(declarations)676 1639 y(off_LShtlPropAllocator\(void\))
k({;})598 1822 y(};)598 2096 y(class)40 b(off_ShtlPropReAllocator)45
b(:)676 2187 y(public)c(off_TBlockAllocator<off_LShtlP)q(ropA)q(lloca)q
(tor>)46 b({)598 2279 y(public:)676 2370 y(//)40 b(Allows)g
(declarations)i(of)e(uninitialized)i(allocators)676 2461
y(off_ShtlPropReAllocator\(void)q(\){;})676 2644 y(//)e(Creates)h(an)e
(allocator.)676 2735 y(off_ShtlPropReAllocator\(off_)q(Exhau)q(sted)46
b(*r,)40 b(off_KVMRegion)i(*reg\);)676 2827 y(inline)f
(off_LShtlPropAllocator)j(*operator)d(+\(vm_offset_t)h(at\);)676
2918 y(void)e(*operator)i(new\(size_t)f(s,)f(off_ShtlPropReAllocator)k
(*a\))c({)755 3009 y(\(void\)s;)h(return)f(a;)676 3101
y(})598 3192 y(private:)676 3283 y(static)h
(off_Indexer<off_LShtlPropAlloc)q(ator)q(>)k(p_idx;)676
3374 y(off_LShtlPropAllocator)f(*p_allocs;)598 3557 y(};)598
3740 y(inline)598 3831 y(off_LShtlPropAllocator)g(*)39
b(off_ShtlPropReAllocator::op)q(erato)q(r)45 b(+\(vm_offset_t)d(at\))
598 3922 y({)676 4014 y(return)f(p_allocs+at;)598 4105
y(})515 4371 y Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(al)t(lo)
l(c)l(ator)f(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
4462 y Fi(#include)41 b(<klib/dlist.h>)598 4553 y(#include)g
(<klib/BlockAllocator.h>)515 4728 y Fk(h)p Fj(O\013)27
b(shuttle)i(pr)l(op)l(erty)h(r)l(e-al)t(lo)l(c)l(ator)g(static)e(memb)l
(ers.)h Fk(i)o Fq(\021)598 4819 y Fi(off_Indexer<off_LShtlPropAlloc)q
(ator>)46 b(off_ShtlPropReAllocator::p_id)q(x;)1885 5255
y Fz(482)p eop
PStoPSsaved restore
%%Page: (484,485) 243
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
483 484 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlPropReAllocator::off)p 1632 523 V 33 w(ShtlPropReAllocator)32
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Creates)i(an)f(allocator.)598 706 y(off_ShtlPropReAllocator::off_S)q
(htlPr)q(opRe)q(Allo)q(cator)q(\(off)q(_Exha)q(uste)q(d)45
b(*r,)2520 797 y(off_KVMRegion)d(*reg\))e(:)676 888 y
(off_TBlockAllocator<off_LSht)q(lProp)q(Allo)q(cato)q(r>\(r,)2128
980 y(\(const)g(off_Indexable*\)&p_idx,reg\),)676 1071
y(p_allocs\(\(off_LShtlPropAlloc)q(ator*)q(\)reg)q(->ge)q(t_sta)q
(rt\(\))q(\))598 1162 y({;})639 1303 y Fz(The)28 b(allo)r(cator)e(is)h
(initialized)h(when)g(the)g(sh)n(uttle)g(serv)n(er)e(is)h(started.)515
1436 y Fk(h)p Fj(O\013)g(shuttle)i(server)g(static)g(memb)l(ers.)f
Fk(i)p Fz(+)p Fq(\021)598 1528 y Fi(off_ShtlPropReAllocator)44
b(shtl_realloc;)515 1702 y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)f
(of)f Fi(off)p 1467 1702 V 29 w(ShtlSrv)i Fj(ac)l(c)l(or)l(ding)g(to)g
Fi(mdep)p Fj(.)e Fk(i)p Fz(+)p Fq(\021)598 1793 y Fi
(new\(&shtl_realloc\))82 b(off_ShtlPropReAllocator\(\(off)q(_Exh)q
(auste)q(d*\)t)q(his,)2206 1885 y(kvm.create_region\("props"\)\);)515
2059 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2059 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 2150 y Fi(friend)40 b(class)h(off_ShtlPropAllocator;)598
2242 y(off_ShtlPropAllocator)j(*palloc\(void\);)598 2333
y(void)c(pfree\(off_ShtlPropAllocator)45 b(*a\);)515
2507 y Fk(h)p Fi(off)p 667 2507 V 29 w(ShtlSrv::palloc)30
b Fj(and)e Fi(pfree)h Fj(implementation.)e Fk(i)p Fq(\021)598
2599 y Fi(//)39 b(Allocates)j(props)598 2690 y(off_ShtlPropAllocator)i
(*off_ShtlSrv::palloc\(void\))598 2781 y({)676 2873 y
(off_LShtlPropAllocator*lp;)676 2964 y(assert\(valid\(\)\);)676
3055 y(w_lock\(\);)676 3147 y(lp=shtl_realloc.allocate\(FAL)q(SE\);)676
3238 y(w_unlock\(\);)676 3329 y(return)d
(\(lp\)?\(&lp->l_alloc\):\(off_ShtlP)q(ropA)q(lloca)q(tor*)q(\)NULL)q
(;)598 3421 y(})598 3603 y(//)e(Deallocates)j(props)598
3694 y(void)e(off_ShtlSrv::pfree\()j(off_ShtlPropAllocator)h(*s)c(\))
598 3786 y({)676 3877 y(off_LShtlPropAllocator*lp=\(o)q(ff_LS)q(htlP)q
(ropA)q(lloca)q(tor*)q(\))1225 3968 y
(\(\(\(char*\)s\)-\(int\)&off_LShtl)q(PropA)q(lloc)q(ator:)q(:l_a)q
(lloc)q(\);)676 4060 y(assert\(valid\(\)\);)676 4151
y(w_lock\(\);)676 4242 y(shtl_realloc.deallocate\(lp\);)676
4334 y(w_unlock\(\);)598 4425 y(})515 4691 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4691 V 29
w(ShtlPropAllocator)p Fj(.)k Fk(i)o Fz(+)p Fq(\021)598
4782 y Fi(void)40 b(*operator)h(new\(size_t)h(s\);)598
4873 y(void)e(operator)h(delete\(void)h(*p\);)1885 5255
y Fz(483)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
484 485 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlPropAllocator::operator)45 b(new)28 b Fj(and)g
Fi(delete)h Fj(implementation.)e Fk(i)p Fq(\021)598 614
y Fi(void)40 b(*off_ShtlPropAllocator::operat)q(or)45
b(new\(size_t)d(s\))598 706 y({)676 797 y(\(void\)s;)676
888 y(return)f(shtl.palloc\(\);)598 980 y(})598 1071
y(void)f(off_ShtlPropAllocator::operato)q(r)45 b(delete\(void)d(*s\))
598 1162 y({)676 1254 y(shtl.pfree\(\(off_ShtlPropAllo)q(cator)q
(*\)s\))q(;)598 1345 y(})515 1611 y Fk(h)p Fj(O\013)27
b(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l(ator)f(implementation)e(dep)
l(endencies.)j Fk(i)p Fq(\021)598 1702 y Fi(#include)41
b(<shtl/ShtlSrv.h>)515 1976 y Fn(5.1.7)112 b(Hardwired)37
b(sh)m(uttle)f(prop)s(erties)515 2129 y Fz(Most)28 b(of)h(the)g
(hardwired)f(prop)r(erties)g(are)g(prop)r(erties)g(already)g(supp)r
(orted)g(b)n(y)h(the)g(pro-)515 2229 y(cessor)21 b(hardw)n(are.)34
b(They)23 b(are)f(usually)g(implemen)n(ted)i(in)f(the)h(mac)n(hine)f
(dep)r(enden)n(t)g(part.)515 2328 y(Ev)n(ery)30 b(sh)n(uttle)i(main)n
(tains)f(a)g(data)h(structure,)g Fx(s)p 2122 2328 27
4 v 31 w(mdep)e Fz(with)i(mac)n(hine)g(dep)r(enden)n(t)g(in-)515
2428 y(formation)26 b(and)i(routines.)515 2561 y Fk(h)p
Fj(O\013)f(shuttle)i(server)g(pr)l(e)l(de\014ne)l(d)h(pr)l(op)l(erties)
g(numb)l(ers.)e Fk(i)p Fq(\021)598 2652 y Fi(//)39 b(Predefined)j
(shuttle)f(properties:)598 2743 y(const)f(off_prop_t)i(OFF_SHTLP_PCTX)
120 b(=)40 b(0;)g(//)f(processor)j(context)598 2835 y(const)e
(off_prop_t)i(OFF_SHTLP_IPL)159 b(=)40 b(1;)g(//)f(irq)h(privilege)h
(level)598 2926 y(const)f(off_prop_t)i(OFF_SHTLP_DTLB)120
b(=)40 b(2;)g(//)f(dtlb)h(being)h(used)598 3017 y(const)f(off_prop_t)i
(OFF_SHTLP_RUNS)120 b(=)40 b(3;)g(//)f(run)h(state)h(\(blocked|ready\))
598 3109 y(const)f(off_prop_t)i(OFF_SHTLP_YLDS)120 b(=)40
b(4;)g(//)f(yield)i(state.)598 3200 y(const)f(off_prop_t)i
(OFF_SHTLP_IOPL)120 b(=)40 b(5;)g(//)f(Can)h(do)g(user)g(io?)598
3291 y(const)g(off_prop_t)i(OFF_SHTLP_UCTX)120 b(=)40
b(6;)g(//)f(has)h(user-level)i(properties)598 3383 y(//)d(#)h(of)g
(predefined)h(shuttle)g(properties.)598 3474 y(const)f(off_prop_t)i
(OFF_NPROP_BUILTIN=)h(7;)1885 5255 y Fz(484)p eop
PStoPSsaved restore
%%Page: (486,487) 244
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
485 486 bop 1238 1805 a @beginspecial 0 @llx 0 @lly 298
@urx 287 @ury 1700 @rwi @setspecial
%%BeginDocument: fig/activations.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-4.0 304.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawSplineSection {
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	/y1 exch def
	/x1 exch def
	/xa x1 x2 x1 sub 0.666667 mul add def
	/ya y1 y2 y1 sub 0.666667 mul add def
	/xb x3 x2 x3 sub 0.666667 mul add def
	/yb y3 y2 y3 sub 0.666667 mul add def
	x1 y1 lineto
	xa ya xb yb x3 y3 curveto
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 1725 4575 m 1650 4604 l 1650 4660 l 1575 4688 l gs col-1 s gr 
% Polyline
n 1725 4800 m 1650 4772 l 1650 4716 l 1575 4688 l gs col-1 s gr 
/Times-Italic ff 180.00 scf sf
75 4732 m
gs 1 -1 sc (One activation frame) col-1 sh gr
% Polyline
n 1800 300 m 1800 1800 l 3000 1800 l 3000 300 l gs col-1 s gr 
% Polyline
n 1800 1575 m 3000 1575 l 3000 1800 l 1800 1800 l cp gs col-1 s gr 
% Polyline
n 1800 1350 m 3000 1350 l 3000 1575 l 1800 1575 l cp gs col-1 s gr 
% Polyline
n 1800 1125 m 3000 1125 l 3000 1350 l 1800 1350 l cp gs col-1 s gr 
% Polyline
n 1800 900 m 3000 900 l 3000 1125 l 1800 1125 l cp gs col-1 s gr 
% Polyline
n 1800 675 m 3000 675 l 3000 900 l 1800 900 l cp gs col-1 s gr 
% Polyline
 [15 50.0] 50.0 sd
gs  clippath
2370 447 m 2400 327 l 2430 447 l 2430 285 l 2370 285 l  cp clip
n 2400 675 m 2400 300 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 2370 447 m 2400 327 l 2430 447 l  col-1 s
% Polyline
n 1800 3300 m 1800 4800 l 3000 4800 l 3000 3300 l gs col-1 s gr 
% Polyline
n 1800 4575 m 3000 4575 l 3000 4800 l 1800 4800 l cp gs col-1 s gr 
% Polyline
n 1800 4350 m 3000 4350 l 3000 4575 l 1800 4575 l cp gs col-1 s gr 
% Polyline
 [15 50.0] 50.0 sd
gs  clippath
2370 3597 m 2400 3477 l 2430 3597 l 2430 3435 l 2370 3435 l  cp clip
n 2400 3900 m 2400 3450 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 2370 3597 m 2400 3477 l 2430 3597 l  col-1 s
% Polyline
n 1800 4125 m 3000 4125 l 3000 4350 l 1800 4350 l cp gs col-1 s gr 
% Polyline
n 1800 3900 m 3000 3900 l 3000 4125 l 1800 4125 l cp gs col-1 s gr 
15.000 slw
% Interp Spline
gs  clippath
1653 1153 m 1775 1135 l 1675 1208 l 1839 1141 l 1816 1086 l  cp clip
n 1800 4425 m
	1618.2 4370.0 1543.2 4332.5 1500 4275 curveto
	1212.3 3891.5 1201.0 3021.5 1200 2625 curveto
	1199.2 2318.9 1221.5 1645.9 1425 1350 curveto
	1476.6 1275.0 1570.3 1218.8 1800 1125 curveto
 gs col-1 s gr
 gr

% arrowhead
7.500 slw
n 1653 1153 m 1775 1135 l 1675 1208 l  col-1 s
15.000 slw
% Interp Spline
gs  clippath
3133 4506 m 3021 4558 l 3096 4459 l 2958 4570 l 2995 4617 l  cp clip
n 3000 1200 m
	3132.5 1224.8 3188.8 1243.6 3225 1275 curveto
	3395.8 1423.2 3565.2 1816.5 3600 2025 curveto
	3694.3 2589.3 3558.3 3752.3 3300 4275 curveto
	3263.8 4348.3 3188.8 4423.3 3000 4575 curveto
 gs col-1 s gr
 gr

% arrowhead
7.500 slw
n 3133 4506 m 3021 4558 l 3096 4459 l  col-1 s
% Open spline
gs  clippath
3150 4120 m 3026 4118 l 3136 4062 l 2964 4103 l 2978 4161 l  cp clip
15.000 slw
n 3015.0 1005.0 m 3450.0 1245.0 l
	3450.0 1245.0 3885.0 1485.0 3885.0 2700.0 DrawSplineSection
	3885.0 2700.0 3885.0 3915.0 3442.5 4020.0 DrawSplineSection
	3000.0 4125.0 l  gs col-1 s gr
 gr

% arrowhead
7.500 slw
n 3150 4120 m 3026 4118 l 3136 4062 l  col-1 s
/Times-Bold ff 210.00 scf sf
4725 2325 m
gs 1 -1 sc (system) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Bold ff 210.00 scf sf
4725 2625 m
gs 1 -1 sc (calls) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Bold ff 210.00 scf sf
1050 2625 m
gs 1 -1 sc (upcall) dup sw pop neg 0 rm  col-1 sh gr
/Times-Bold ff 210.00 scf sf
2407 5025 m
gs 1 -1 sc (Kernel stack) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Bold ff 210.00 scf sf
2400 2025 m
gs 1 -1 sc (User stack) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Courier ff 180.00 scf sf
2377 4515 m
gs 1 -1 sc (an upcall) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Courier ff 180.00 scf sf
2445 1740 m
gs 1 -1 sc (main\(\)) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Courier ff 180.00 scf sf
2400 1290 m
gs 1 -1 sc (a sys call) dup sw pop 2 div neg 0 rm  col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 903 1988 a Fz(Figure)27 b(5.2:)36 b(Sh)n(uttle)28
b(activ)-5 b(ations:)36 b(system)27 b(calls)g(and)h(up-calls.)639
2334 y(W)-7 b(e)28 b(will)g(b)r(e)g(seeing)f(features)g(pro)n(vided)g
(b)n(y)g Fx(mdepShtl)d Fz(through)j(this)h(section.)515
2549 y FA(Pro)s(cessor)j(con)m(texts)515 2703 y Fz(The)38
b(pro)r(cessor)f(con)n(text)h(is)g(a)g(hardwired)f(prop)r(ert)n(y)h
(whic)n(h)g(con)n(tains)f(the)i(pro)r(cessor)515 2802
y(register)26 b(v)-5 b(alues.)639 2902 y(As)31 b(w)n(e)f(will)g(see)g
(in)h(the)g(next)f(c)n(hapter,)g(sh)n(uttles)h(ma)n(y)f(mo)n(v)n(e)f
(from)h(one)g(protection)515 3001 y(domain)21 b(to)h(another,)g
(including)g(the)g(k)n(ernel)f(protection)g(domain,)h(b)n(y)g(means)f
(of)h(p)r(ortals.)515 3101 y(Besides,)h(the)g(use)f(of)h(up)r(calls)g
(from)f(k)n(ernel)g(to)g(user)g(space)g(means)h(that)g(the)g(set)f(of)h
(k)n(ernel)515 3201 y(and)31 b(user)f(activ)-5 b(ations)1250
3171 y Fp(4)1318 3201 y Fz(\(see)31 b(\014gure)f(5.2\))h(will)g(b)r(e)h
(mixed.)47 b(Th)n(us,)32 b(a)f(user)f(sh)n(uttle)i(ma)n(y)515
3300 y(call)23 b(the)i(k)n(ernel)e(and)h(the)g(k)n(ernel)f(m)n(y)h(up)r
(call)h(bac)n(k)e(to)h(the)g(user)g(during)f(the)i(system)e(call;)515
3400 y(the)28 b(up)r(call)f(routine)h(ma)n(y)f(in)g(turn)h(issue)f(new)
h(system)f(calls,)g(and)h(so)f(on.)639 3500 y(Therefore,)22
b(w)n(e)f(migh)n(t)g(b)r(e)h(in)n(terested)f(in)h(an)n(y)f(of)g(three)h
(di\013eren)n(t)f(pro)r(cessor)f(con)n(texts)515 3599
y(when)28 b(referring)e(to)h(a)g(sh)n(uttle)h(pro)r(cessor)e(con)n
(text:)616 3763 y(1.)41 b(The)21 b Fy(curr)l(ent)28 b
Fz(register)19 b(set,)j(i.e.)35 b(the)21 b(last)g(sa)n(v)n(ed)e
(register)h(set)g(whic)n(h)h(holds)g(register)722 3863
y(v)-5 b(alues)28 b(at)f(the)h(time)g(the)g(sh)n(uttle)g(w)n(as)f(last)
g(preempted.)722 3995 y(This)i(is)g(the)g(one)f(used)h(when)f(w)n(e)h
(are)e(in)n(terested)i(in)g(the)g(\\curren)n(t")e(state)h(of)h(the)722
4095 y(sh)n(uttle,)f(no)g(matter)f(what)g(its)h(privilege)f(lev)n(el)g
(is.)616 4260 y(2.)41 b(The)25 b Fy(last)i(user)34 b
Fz(register)23 b(set,)i(i.e.)36 b(the)25 b(topmost)g(user)f(con)n(text)
g(sa)n(v)n(ed)f(in)i(the)g(stac)n(k)722 4360 y(of)j(activ)-5
b(ations)27 b(\(system)g(calls/up)r(calls\).)722 4492
y(This)f(is)f(the)h(one)f(used)h(when)f(w)n(e)g(are)g(in)n(terested)g
(either)g(in)h(the)g(user)f(state)g(at)h(the)722 4592
y(last)i(system)f(call)g(or)g(in)h(the)g(state)f(to)h(b)r(e)g(returned)
f(to)g(the)h(user.)616 4757 y(3.)41 b(The)31 b Fy(last)i(kernel)39
b Fz(register)30 b(set,)h(i.e.)46 b(the)31 b(topmost)g(k)n(ernel)e(con)
n(text)i(sa)n(v)n(ed)e(in)i(the)722 4856 y(stac)n(k)c(of)g(activ)-5
b(ations)27 b(\(system)h(calls/up)r(calls\).)p 515 4929
1146 4 v 607 4983 a Fm(4)642 5006 y Fl(By)23 b(activ)l(ation)j(w)n(e)e
(mean)f(state)i(on)f(en)n(try)g(p)r(oin)n(t)g(in)n(v)n(o)r(cations)h
(or)f(cross-domain)e(calls.)1885 5255 y Fz(485)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
486 487 bop 722 523 a Fz(This)26 b(is)f(the)h(one)f(used)h(when)g(w)n
(e)f(are)f(in)n(terested)h(in)h(the)g(state)f(of)h(a)f(sh)n(uttle)h
(while)722 623 y(pro)r(ceeding)h(inside)h(the)g(k)n(ernel.)515
789 y(The)f(\014rst)h(register)e(set)h(will)h(alw)n(a)n(ys)e(matc)n(h)h
(one)h(of)f(the)h(t)n(w)n(o)f(latter)g(ones.)639 888
y(T)-7 b(o)34 b(implemen)n(t)g(this,)h(sh)n(uttles)f(con)n(tain)f
(references)f(to)i(their)f(top-most)g(pro)r(cessor)515
988 y(con)n(text.)38 b(Suc)n(h)28 b(reference)g(is)g(con)n(tained)f
(inside)h(the)h(mac)n(hine)f(dep)r(enden)n(t)h(part,)f(where)515
1088 y(it)g(is)f(handled.)639 1187 y(Eac)n(h)e(con)n(text)g(con)n
(tains)f(a)i(reference)e(to)i(the)g(actual)f(pro)r(cessor)e(con)n(text)
i(and)h(a)f(link)515 1287 y(to)i(the)h(next)g(con)n(text)f(in)h(the)g
(stac)n(k.)515 1420 y Fk(h)p Fj(O\013)f(shuttle)i(c)l(ontext.)g
Fk(i)p Fq(\021)598 1511 y Fi(struct)40 b(off_ShtlCtx)i({)676
1602 y(off_mdepProcRegs)h(*c_regs;)198 b(//)40 b(The)g(actual)g
(context.)676 1694 y(off_ShtlCtx)81 b(*c_nxt;)394 b(//)40
b(Next)g(context.)676 1785 y(off_ShtlCtx\(off_mdepProcRegs)85
b(*regs=NULL\))42 b(:)d(c_regs\(regs\),)j(c_nxt\(NULL\))g({;})598
1876 y(};)515 2051 y Fk(h)p Fj(O\013)27 b(shuttle)i(c)l(ontext)h(dep)l
(endencies.)f Fk(i)p Fq(\021)598 2142 y Fi(class)40 b
(off_mdepProcRegs;)357 b(//)40 b(off_Processor)i(must)e(be)g(included)
1853 2233 y(//)g(by)f(those)i(including)g(ShtlCtx.)639
2374 y Fz(The)28 b(sh)n(uttle)g(exp)r(orts)f(iterators)f(o)n(v)n(er)g
(its)h(con)n(texts.)515 2507 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2507 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2599 y Fi(//)39 b(Get)h(an)g(iterator)h(for)f(the)g
(context.)598 2690 y(inline)g(off_ShtlCtxItr)j(get_ctx\(void\);)515
2864 y Fk(h)p Fi(off)p 667 2864 V 29 w(Shtl::get)p 1047
2864 V 30 w(ctx)28 b Fj(implementation.)f Fk(i)p Fq(\021)598
2956 y Fi(//)39 b(Get)h(a)g(context)h(iterator.)598 3047
y(inline)f(off_ShtlCtxItr)j(off_Shtl::get_ctx\(void\))h({)c(return)79
b(s_mdep.get_ctx\(\);)44 b(})1885 5255 y Fz(486)p eop
PStoPSsaved restore
%%Page: (488,489) 245
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
487 488 bop 515 523 a Fk(h)p Fj(O\013)27 b(shuttle)i(c)l(ontext)h(iter)
l(ator.)f Fk(i)p Fq(\021)598 614 y Fi(//)39 b(A)h(context)h(iterator.)
598 706 y(//)598 797 y(class)f(off_ShtlCtxItr)j({)598
888 y(private:)676 980 y(off_ShtlCtx)f(*i_ctx;)598 1071
y(public:)676 1162 y(off_ShtlCtxItr\(off_ShtlCtx)j(*c=NULL\))c(:)f
(i_ctx\(c\))h({;})676 1254 y(//)f(get)g(a)f(reference)j(to)d(the)h
(element)h(pointed)g(by)e(the)h(iterator.)676 1345 y(off_ShtlCtx)i
(*get_element\(void\){)h(return)e(i_ctx;)g(})676 1436
y(//)f(Advance)h(iterator.)676 1528 y(off_ShtlCtxItr)i(operator++\(\){)
755 1619 y(assert\(i_ctx\);)f(i_ctx=i_ctx->c_nxt;)i(return)c(*this;)676
1710 y(})676 1802 y(//)g(Advance)h(iterator.)676 1893
y(off_ShtlCtxItr)i(operator++\(int)f(i\){)755 1984 y(off_ShtlCtxItr)g
(r=*this;)755 2076 y(assert\(!i\);)755 2167 y(assert\(i_ctx\);)g
(i_ctx=i_ctx->c_nxt;)i(return)c(r;)676 2258 y(})676 2350
y(int)g(is_null\(void\))i(const)f({)e(return)i(i_ctx)f(==)g(NULL;)g(})
676 2441 y(//)g(For)g(tests.)676 2532 y(operator)h(boolean_t\(void\){)i
(return)e(\(boolean_t\)i_ctx;)i(})676 2715 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2715 24 4
v 29 w(ShtlCtxItr)p Fj(.)i Fk(i)598 2897 y Fi(};)515
3145 y Fk(h)p Fj(O\013)e(shuttle)i(c)l(ontext)h(dep)l(endencies.)f
Fk(i)p Fz(+)o Fq(\021)598 3236 y Fi(#include)41 b(<klib/mdep/types.h>)
161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)639
3368 y Fz(The)19 b(con)n(text)g(iterator)f(can)h(tell)g(us)g(whether)g
(the)h(con)n(text)e(corresp)r(onds)g(to)g(the)i(k)n(ernel)515
3468 y(or)26 b(to)i(the)g(user,)f(b)n(y)g(asking)g(to)g(the)h(mac)n
(hine)f(dep)r(enden)n(t)i(registers.)515 3579 y Fk(h)p
Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3579
V 29 w(ShtlCtxItr)p Fj(.)i Fk(i)p Fq(\021)598 3670 y
Fi(inline)40 b(boolean_t)i(is_kernel\(void\))81 b({)676
3762 y(assert\(i_ctx)42 b(&&)e(i_ctx->c_regs)i(\);)676
3853 y(return)f(i_ctx->c_regs->is_kernel\(\);)598 3944
y(};)598 4036 y(inline)f(boolean_t)i(is_user\(void\))81
b({)676 4127 y(assert\(i_ctx)42 b(&&)e(i_ctx->c_regs)i(\);)676
4218 y(return)f(i_ctx->c_regs->is_user\(\);)598 4310
y(};)639 4521 y Fz(Using)c(this)g(facilit)n(y)-7 b(,)38
b(sh)n(uttles)f(implemen)n(t)g(another)f(couple)g(of)h(metho)r(ds)f(to)
h(gain)515 4621 y(access)26 b(to)i(the)g(outermost)e(k)n(ernel)h(or)g
(user)g(con)n(text.)515 4732 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 4732 V 29 w(Shtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 4824 y Fi(//)39 b(Get)h(the)g(last)g(user/kernel)i
(context)f(\(NULL)f(is)g(no)g(one\).)598 4915 y(inline)g
(off_ShtlCtxItr)160 b(get_user_ctx\(void\);)598 5006
y(inline)40 b(off_ShtlCtxItr)160 b(get_kernel_ctx\(void\);)1885
5255 y Fz(487)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
488 489 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlCtx::get)p 1164 523 V 30 w(user)p 1350 523 V
30 w(ctx)28 b Fj(and)g Fi(get)p 1791 523 V 29 w(kernel)p
2054 523 V 29 w(ctx)g Fj(implementation.)g Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Get)h(the)g(last)g(user/kernel)i(context.)598
706 y(inline)e(off_ShtlCtxItr)j(off_Shtl::get_user_ctx\(void\))598
797 y({)676 888 y(off_ShtlCtxItr)g(i=get_ctx\(\);)676
980 y(while)e(\(i)e(&&)h(i.is_kernel\(\)\))755 1071 y(i++;)676
1162 y(return)h(i;)598 1254 y(})598 1345 y(inline)f(off_ShtlCtxItr)j
(off_Shtl::get_kernel_ctx\(void\))598 1436 y({)676 1528
y(off_ShtlCtxItr)g(i=get_ctx\(\);)676 1619 y(while)e(\(i)e(&&)h
(i.is_user\(\)\))755 1710 y(i++;)676 1802 y(return)h(i;)598
1893 y(})639 2125 y Fz(But,)d(Ho)n(w)d(are)g(nested)h(con)n(texts)f
(actually)g(handled?)61 b(The)35 b(mac)n(hine)g(dep)r(enden)n(t)515
2225 y(part)24 b(is)h(resp)r(onsible)g(for)f(allo)r(cating)g(space)h
(for)f(con)n(texts.)35 b(Usually)-7 b(,)26 b(list)f(no)r(des)g(are)f(k)
n(ept)515 2325 y(as)29 b(lo)r(cal)h(v)-5 b(ariables)29
b(of)h(the)h(up)r(call)f(and)g(system)g(call)g(pro)r(cedures)f(so)h
(that)g(the)h(stac)n(k)e(is)515 2424 y(used)e(to)h(main)n(tain)f(the)h
(list.)639 2524 y(Once)j(allo)r(cated,)g(sh)n(uttle)h(metho)r(ds)f
Fx(push)p 2033 2524 27 4 v 30 w(ctx)f Fz(and)h Fx(pop)p
2522 2524 V 30 w(ctx)f Fz(are)g(called)h(to)g(build)515
2623 y(the)d(list.)515 2756 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2756 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2848 y Fi(//)39 b(Installs)i(a)f(new)g(context)h(as)
e(the)h(top-most.)598 2939 y(inline)g(void)g(push_ctx\(off_ShtlCtx)k
(*c\);)598 3030 y(//)39 b(Installs)i(a)f(new)g(kernel)g(context)h(as)f
(the)g(top-most.)h(---)f(do)g(not)g(use.)598 3122 y(inline)g(void)g
(push_kctx\(off_ShtlCtx)k(*c\);)598 3304 y(//)39 b(Installs)i(a)f(new)g
(context)h(as)e(the)h(top-most)h(saving)g(the)f(current)h(kernel)f
(state.)598 3396 y(inline)g(err_t)h(push_current_ctx\(off_ShtlCtx)k
(*c\);)598 3578 y(//)39 b(Deinstalls)j(the)e(top-most)h(context.)598
3670 y(inline)f(void)g(pop_ctx\(void\);)598 3761 y(//)f(Deinstalls)j
(the)e(top-most)h(kernel)f(context.)i(---)d(do)h(not)g(use.)598
3852 y(inline)g(void)g(pop_kctx\(void\);)598 4035 y(//)f(Deinstalls)j
(the)e(top-most)h(context)g(and)f(reloads)g(it.)598 4126
y(inline)g(void)g(pop_current_ctx\(err_t)k(code=TRUE\);)1885
5255 y Fz(488)p eop
PStoPSsaved restore
%%Page: (490,491) 246
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
489 490 bop 639 523 a Fz(All)28 b(of)g(them)g(delegate)f(to)g(the)h
(mac)n(hine)g(dep)r(enden)n(t)g(implemen)n(tation.)515
639 y Fk(h)p Fi(off)p 667 639 24 4 v 29 w(Shtl::push)p
1086 639 V 30 w(ctx)g Fj(and)g Fi(pop)p 1527 639 V 29
w(ctx)g Fj(implementation.)g Fk(i)p Fq(\021)598 731 y
Fi(//)39 b(Installs)i(a)f(new)g(context)h(as)e(the)h(top-most.)598
822 y(extern)g(inline)h(void)f(off_Shtl::push_ctx\(off_ShtlCt)q(x)45
b(*c\))40 b({)676 913 y(s_mdep.push_ctx\(c\);)598 1005
y(})598 1187 y(//)f(---)h(do)g(not)g(use)598 1279 y(extern)g(inline)h
(void)f(off_Shtl::push_kctx\(off_ShtlC)q(tx)45 b(*c\))40
b({)676 1370 y(s_mdep.push_kctx\(c\);)598 1461 y(})598
1644 y(//)f(Deinstalls)j(the)e(top-most)h(context.)598
1735 y(extern)f(inline)h(void)f(off_Shtl::pop_ctx\(void\))45
b({)676 1826 y(s_mdep.pop_ctx\(\);)598 1918 y(})598 2100
y(//)39 b(Deinstalls)j(the)e(top-most)h(kernel)f(context.)i(---)d(do)h
(not)g(use)598 2192 y(extern)g(inline)h(void)f
(off_Shtl::pop_kctx\(void\))45 b({)676 2283 y(s_mdep.pop_kctx\(\);)598
2374 y(})515 2532 y Fk(h)p Fi(off)p 667 2532 V 29 w(Shtl::push)p
1086 2532 V 30 w(current)p 1389 2532 V 30 w(ctx)28 b
Fj(and)g Fi(pop)p 1830 2532 V 29 w(current)p 2132 2532
V 30 w(ctx)g Fj(implementation.)f Fk(i)p Fq(\021)598
2623 y Fi(//)39 b(Installs)i(a)f(new)g(context)h(as)e(the)h(top-most)h
(saving)g(the)f(current)h(kernel)f(state.)598 2715 y(extern)g(inline)h
(err_t)f(off_Shtl::push_current_ctx\(o)q(ff_S)q(htlCt)q(x)45
b(*c\))40 b({)676 2806 y(return)h(s_mdep.push_current_ctx\(c\);)598
2897 y(})598 3080 y(//)e(Deinstalls)j(the)e(top-most)h(context)g(and)f
(reloads)g(it.)598 3171 y(extern)g(inline)h(void)f
(off_Shtl::pop_current_ctx\(err)q(_t)45 b(code=TRUE\))d({)676
3263 y(s_mdep.pop_current_ctx\(code\))q(;)598 3354 y(})639
3587 y Fz(On)28 b(traps,)f(the)h(sa)n(v)n(ed)e(user)h(con)n(text)g
(will)h(b)r(e)g(\(un\)link)n(ed)g(b)n(y)f(trap)g(handling)h(co)r(de.)
515 3719 y Fk(h)p Fj(L)l(o)l(c)l(al)g(variables)g(for)g
Fi(uregs)g Fj(user)h(state)g(pushing.)f Fk(i)p Fq(\021)598
3811 y Fi(off_ShtlCtx)238 b(ctx\(uregs\);)515 3985 y
Fk(h)p Fj(Push)28 b Fi(uregs)g Fj(user)h(state)g(for)f
Fi(me)p Fj(.)f Fk(i)p Fq(\021)598 4076 y Fi(me->push_ctx\(&ctx\);)515
4251 y Fk(h)p Fj(Pop)g Fi(uregs)i Fj(user)g(state)g(for)e
Fi(me)p Fj(.)h Fk(i)p Fq(\021)598 4342 y Fi(me->pop_ctx\(\);)515
4516 y Fk(h)p Fj(Push)g Fi(uregs)g Fj(user)h(state)g(for)f(curr)l(ent)h
(shuttle.)g Fk(i)p Fq(\021)598 4608 y Fi
(off_Shtl::self\(\)->push_ctx\(&ct)q(x\);)515 4782 y
Fk(h)p Fj(Pop)e Fi(uregs)i Fj(user)g(state)g(for)e(curr)l(ent)j
(shuttle.)f Fk(i)o Fq(\021)598 4873 y Fi
(off_Shtl::self\(\)->pop_ctx\(\);)1885 5255 y Fz(489)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
490 491 bop 515 523 a Fk(h)p Fj(Push)28 b(and)g(p)l(op)g
Fi(uregs)h Fj(user)f(state)h(dep)l(endencies.)h Fk(i)o
Fq(\021)598 614 y Fi(#include)41 b(<shtl/Shtl.h>)639
756 y Fz(Finally)-7 b(,)31 b(w)n(e)f(should)g(sa)n(y)f(the)i(the)f
(copro)r(cessor)e(con)n(text)i(is)g(considered)f(to)h(b)r(e)h(part)515
855 y(of)g(the)h(pro)r(cessor)e(con)n(text.)48 b(It)32
b(is)g(to)f(b)r(e)h(handled)2157 825 y Fp(5)2226 855
y Fz(b)n(y)f(the)h(mac)n(hine)f(dep)r(enden)n(t)i(part)515
955 y(using)27 b(lazy)g(copro)r(cessor)e(con)n(text)i(switc)n(hing.)639
1054 y(The)j(pro)r(cessor)d(con)n(text)i(prop)r(ert)n(y)f(is)h(ignored)
f(b)n(y)h Fx(get)p 2451 1054 27 4 v 31 w(prop)e Fz(and)i
Fx(set)p 2980 1054 V 31 w(prop)p Fz(;)f(sp)r(e-)515 1154
y(ci\014c)f(metho)r(ds)h(sho)n(wn)f(ab)r(o)n(v)n(e)f(m)n(ust)i(b)r(e)g
(used)g(instead.)515 1287 y Fk(h)p Fj(c)l(ase)g(to)g(r)l(eturn)i(pr)l
(e)l(de\014ne)l(d)f(pr)l(op)l(erty)h Fi(p)e Fj(value)g(in)f
Fi(get)p 2173 1287 24 4 v 29 w(prop)p Fj(.)h Fk(i)p Fq(\021)598
1378 y Fi(case)40 b(OFF_SHTLP_PCTX:)715 1469 y(return)h(OFF_PRTL_NULL;)
515 1644 y Fk(h)p Fj(c)l(ase)28 b(to)g(set)h(pr)l(e)l(de\014ne)l(d)h
(pr)l(op)l(erty)g Fi(p)d Fj(value)h Fi(val)g Fj(in)g
Fi(set)p 2205 1644 V 28 w(prop)p Fj(.)g Fk(i)p Fq(\021)598
1735 y Fi(case)40 b(OFF_SHTLP_PCTX:)715 1826 y(break;)639
1968 y Fz(T)-7 b(o)22 b(supp)r(ort)f(the)h(math)g(copro)r(cessor,)e
(the)i(sh)n(uttle)g(serv)n(er)e(services)h(the)h(trap)f(\(if)i(an)n
(y\))515 2067 y(whic)n(h)33 b(happ)r(ens)g(when)g(the)g(copro)r(cessor)
d(state)j(should)g(b)r(e)g(restored.)52 b(T)-7 b(o)32
b(do)h(so,)h(an)n(y)515 2167 y(pro)r(cessor)21 b(will)j(call)f(the)h
(sh)n(uttle)g(serv)n(er)e Fx(self)p 2003 2167 27 4 v
29 w(start)g Fz(metho)r(d)i(so)f(it)h(could)f(allo)r(cate)g(the)515
2267 y(desired)k(trap)g(for)g(the)h(mac)n(hine)f(dep)r(enden)n(t)h
(implemen)n(tation.)515 2399 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2399 24 4 v 29 w(ShtlSrv)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 2491 y Fi(void)40 b(self_start\(void\);)515
2665 y Fk(h)p Fi(off)p 667 2665 V 29 w(ShtlSrv::self)p
1203 2665 V 31 w(start)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 2756 y Fi(void)40 b(off_ShtlSrv::self_start\(void\))598
2848 y({)676 2939 y(if)g(\(off_mdepShtl::needs_nofpu\(\)\){)755
3030 y(off_Trap)h(*t;)755 3122 y(off_TrapTbl)g(*traps;)755
3213 y(traps=off_Processor::self\(\)->ge)q(t_tr)q(aps\()q(\);)755
3304 y(t=new\(traps,traps->get_nofpu\(\)\))833 3396 y
(off_Trap\(get_protection\(\),get)q(_dom)q(ain\()q(\),&s_)q(fpu_)q
(handl)q(er\);)755 3487 y(if)e(\(!t\))833 3578 y(panic\("shtl:)j(could)
e(not)g(allocate)h(FPU)f(trap."\);)676 3670 y(})598 3761
y(})639 3993 y Fz(Where)28 b(the)g(handler)f(only)g(services)f(the)i
(trap)f(to)h(the)g(mac)n(hine)f(dep)r(enden)n(t)h(la)n(y)n(er.)515
4110 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4110 V 29 w(ShtlSrv)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 4201 y Fi(static)40 b(off_KrnEventHandler)k(s_fpu_handler;)
598 4292 y(static)c(int)g(fpu_fault\(const)j(off_shtl_id_t)f(&sender,)
1422 4384 y(vm_size_t)f(msz,)f(vm_size_t)h(rsz,)1422
4475 y(off_MsgReq)g(*m,)f(off_MsgRep)h(*r\);)515 4724
y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(static)g(memb)l(ers.)f
Fk(i)p Fz(+)p Fq(\021)598 4815 y Fi(off_KrnEventHandler)43
b(off_ShtlSrv::s_fpu_handler\(o)q(ff_S)q(htlSr)q(v::f)q(pu_f)q(ault\))q
(;)p 515 4885 1146 4 v 607 4939 a Fm(5)642 4962 y Fl(But)24
b(not)g(y)n(et)h(supp)r(orted.)1885 5255 y Fz(490)p eop
PStoPSsaved restore
%%Page: (492,493) 247
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
491 492 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(ShtlSrv::fpu)p 1164 523 V 30 w(fault)29 b Fj(implementation.)f
Fk(i)o Fq(\021)637 614 y Fi(int)40 b(off_ShtlSrv::fpu_fault\(const)45
b(off_shtl_id_t)e(&sender,)1696 706 y(vm_size_t)e(msz,)g(vm_size_t)g
(rsz,)1696 797 y(off_MsgReq)h(*m,)e(off_MsgRep)h(*r\))598
888 y({)676 980 y(\(void\)sender;\(void\)msz;\(void)q(\)rsz;)q(\(voi)q
(d\)m;)q(\(void)q(\)r;)676 1071 y(off_Shtl::self\(\)->get_mdep\(\))q
(->fpu)q(_tra)q(p_ha)q(ndler)q(\(\);)676 1162 y(return)g(EOK;)598
1254 y(})515 1602 y FA(I/O)31 b(privilege)g(lev)m(el)515
1756 y Fz(This)e(is)g(a)f(hardwired)g(prop)r(ert)n(y)g(whic)n(h)h
(determines)f(if)i(the)f(sh)n(uttle)h(can)e(do)h(I/O)f(when)515
1855 y(running)f(in)h(user)f(mo)r(de.)37 b(T)-7 b(o)27
b(k)n(eep)g(the)h(state)f(of)g(suc)n(h)h(capabilit)n(y)e(w)n(e)i(use)f
(the)h(resource)515 1955 y(\015ags.)515 2088 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2088
V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 2179 y
Fi(//)39 b(Supports)i(user)g(IO?)598 2270 y(inline)f(boolean_t)i
(is_usrio\(void\))g(const;)598 2362 y(//)d(Enables)i(user)f(IO.)598
2453 y(void)g(usrio_enable\(void\);)598 2544 y(//)f(Disables)i(user)g
(IO.)598 2636 y(void)f(usrio_disable\(void\);)515 2810
y Fk(h)p Fi(off)p 667 2810 V 29 w(Shtl::is)p 1008 2810
V 30 w(usrio)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
2901 y Fi(//)39 b(Supports)i(user)g(IO?)598 2993 y(inline)f(boolean_t)i
(off_Shtl::is_usrio\(void\))i(const)d({)e(return)i(r_flags&OFF_SF_USR;)
i(})515 3258 y Fk(h)p Fi(off)p 667 3258 V 29 w(Shtl::usrio)p
1125 3258 V 30 w(enable)29 b Fj(and)f Fi(usrio)p 1762
3258 V 29 w(disable)h Fj(implementation.)f Fk(i)p Fq(\021)598
3350 y Fi(//)39 b(Enables)i(user)f(IO.)598 3441 y(void)g
(off_Shtl::usrio_enable\(void\))598 3532 y({)676 3624
y(r_flags)h(|=)f(OFF_SF_USR;)676 3715 y(assert\(get_ctx\(\)\);)676
3806 y(s_mdep.usrio_enable\(get_ctx\()q(\).get)q(_ele)q(ment)q(\(\)->c)
q(_reg)q(s\);)598 3897 y(})598 3989 y(//)f(Disables)i(user)g(IO.)598
4080 y(void)f(off_Shtl::usrio_disable\(void\))598 4171
y({)676 4263 y(r_flags)h(&=)f(~OFF_SF_USR;)676 4354 y
(s_mdep.usrio_disable\(get_ctx)q(\(\).ge)q(t_el)q(emen)q(t\(\)->)q
(c_re)q(gs\);)598 4445 y(})639 4678 y Fz(W)-7 b(e)28
b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(new)g(\015ag.)515
4794 y Fk(h)p Fj(O\013)f(shuttle)i(\015ag)f(bits.)g Fk(i)o
Fq(\021)598 4885 y Fi(const)40 b(unsigned8_t)i(OFF_SF_USR)f(=)f(0x10;)g
(//)g(User)g(level)g(IO?)1885 5255 y Fz(491)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
492 493 bop 639 523 a Fz(Finally)-7 b(,)29 b(this)f(prop)r(ert)n(y)g
(is)g(initialized)g(at)g(sh)n(uttle)h(creation)e(time)i(whenev)n(er)e
(a)h(pro-)515 623 y(tot)n(yp)r(e)f(sh)n(uttle)h(is)g(supplied.)515
756 y Fk(h)p Fj(Initialize)e(har)l(dwir)l(e)l(d)j(pr)l(op)l(erties)h
(with)e(those)h(of)e Fi(proto)p Fj(.)h Fk(i)p Fq(\021)598
847 y Fi(if)39 b(\(proto->is_usrio\(\)\))676 938 y(usrio_enable\(\);)
598 1029 y(else)676 1121 y(usrio_disable\(\);)639 1262
y Fz(User)27 b(IO)h(is)f(initially)h(disabled.)515 1378
y Fk(h)p Fj(Setup)g(r)l(o)l(ot)h(shuttle.)g Fk(i)p Fq(\021)598
1469 y Fi(usrio_disable\(\);)639 1594 y Fz(W)-7 b(e)28
b(m)n(ust)g(complete)g Fx(get)p 1476 1594 27 4 v 30 w(prop)e
Fz(and)h Fx(set)p 2001 1594 V 30 w(prop)f Fz(no)n(w.)515
1727 y Fk(h)p Fj(c)l(ase)i(to)g(r)l(eturn)i(pr)l(e)l(de\014ne)l(d)f(pr)
l(op)l(erty)h Fi(p)e Fj(value)g(in)f Fi(get)p 2173 1727
24 4 v 29 w(prop)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1818
y Fi(case)40 b(OFF_SHTLP_IOPL:)715 1910 y(return)h(\(is_usrio\(\)\))h
(?)d(get_id\(\))i(:)f(OFF_PRTL_NULL;)515 2084 y Fk(h)p
Fj(c)l(ase)28 b(to)g(set)h(pr)l(e)l(de\014ne)l(d)h(pr)l(op)l(erty)g
Fi(p)d Fj(value)h Fi(val)g Fj(in)g Fi(set)p 2205 2084
V 28 w(prop)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 2175 y
Fi(case)40 b(OFF_SHTLP_IOPL:)715 2267 y(if)g(\(val)g(==)g
(OFF_PRTL_NULL\))794 2358 y(usrio_disable\(\);)715 2449
y(else)794 2540 y(usrio_enable\(\);)715 2632 y(break;)515
2889 y FA(In)m(terrupt)33 b(priorit)m(y)f(lev)m(els)515
3042 y Fz(Sh)n(uttles)43 b(include)h(an)f(in)n(terrupt)g(priorit)n(y)f
(lev)n(el)h(so)g(that)g(the)h(k)n(ernel)e(could)h(c)n(ho)r(ose)515
3142 y(whether)36 b(to)g(evict)h(the)g(curren)n(t)e(sh)n(uttle)i(on)f
(in)n(terrupt)g(or)g(to)g(defer)g(in)n(terrupt)g(deliv-)515
3242 y(ering.)515 3374 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 3374 V 29 w(Shtl)p Fj(.)f Fk(i)p
Fq(\021)598 3466 y Fi(off_pl_t)41 b(s_pl;)707 b(//)40
b(Shuttle)h(interrupt)g(priority)g(level.)515 3640 y
Fk(h)p Fj(O\013)27 b(shuttle)i(dep)l(endencies.)g Fk(i)p
Fz(+)p Fq(\021)598 3731 y Fi(#include)41 b(<hw/Event.h>)434
b(//)40 b(for)g(off_pl_t)515 3906 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3906 V 29
w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3997 y Fi(//)39
b(Returns)i(the)f(interrupt)h(priority)g(level)g(for)f(this)g(shuttle.)
598 4088 y(inline)g(off_pl_t)h(get_prty\(void\))i(const;)598
4180 y(//)c(Sets)i(the)e(interrupt)j(priority)f(level)f(for)g(this)g
(shuttle.)598 4271 y(inline)g(err_t)158 b(set_prty\(off_pl_t)43
b(prty\);)515 4445 y Fk(h)p Fi(off)p 667 4445 V 29 w(Shtl::get)p
1047 4445 V 30 w(prty)28 b Fj(and)g Fi(off)p 1527 4445
V 29 w(Shtl::set)p 1907 4445 V 30 w(prty)h Fj(implementation.)e
Fk(i)p Fq(\021)598 4537 y Fi(//)39 b(Returns)i(the)f(interrupt)h
(priority)g(level)g(for)f(this)g(shuttle.)598 4628 y(inline)g(off_pl_t)
h(off_Shtl::get_prty\(void\))k(const)40 b({)g(return)g(s_pl;)h(})598
4719 y(//)e(Sets)i(the)e(interrupt)j(priority)f(level)f(for)g(this)g
(shuttle.)598 4811 y(inline)g(err_t)158 b(off_Shtl::set_prty\(off_pl_t)
46 b(prty\))40 b({)g(s_pl)g(=)f(prty;)i(return)f(EOK;)g(})1885
5255 y Fz(492)p eop
PStoPSsaved restore
%%Page: (494,495) 248
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
493 494 bop 639 523 a Fz(In)n(terrupt)27 b(priorit)n(y)g(lev)n(els)g(m)
n(ust)g(b)r(e)h(honored)f(b)n(y)g Fx(Processor)p Fz(s)d(\(see)j
(section)h(4.6\).)639 623 y(The)f(priorit)n(y)f(lev)n(el)h(is)g
(initialized)g(to)g(a)g(default)g(v)-5 b(alue)27 b(so)f(that)i(b)n(y)f
(default)g(sh)n(uttles)515 722 y(yield)g(to)h(in)n(terrupts.)515
855 y Fk(h)p Fj(Initialize)e(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)
e Fi(off)p 1928 855 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p
Fq(\021)598 946 y Fi(s_pl\(OFF_NPL_DFL\),)639 1088 y
Fz(Finally)-7 b(,)26 b(this)f(prop)r(ert)n(y)f(also)g(set)h(at)g(sh)n
(uttle)h(creation)e(time)h(whenev)n(er)f(a)h(protot)n(yp)r(e)515
1187 y(sh)n(uttle)j(is)f(supplied.)515 1320 y Fk(h)p
Fj(Initialize)f(har)l(dwir)l(e)l(d)j(pr)l(op)l(erties)h(with)e(those)h
(of)e Fi(proto)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1411
y Fi(set_prty\(proto->get_prty\(\)\);)639 1553 y Fz(W)-7
b(e)28 b(m)n(ust)g(complete)g Fx(get)p 1476 1553 27 4
v 30 w(prop)e Fz(and)h Fx(set)p 2001 1553 V 30 w(prop)f
Fz(no)n(w.)515 1685 y Fk(h)p Fj(c)l(ase)i(to)g(r)l(eturn)i(pr)l(e)l
(de\014ne)l(d)f(pr)l(op)l(erty)h Fi(p)e Fj(value)g(in)f
Fi(get)p 2173 1685 24 4 v 29 w(prop)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 1777 y Fi(case)40 b(OFF_SHTLP_IPL:)715 1868
y(return)h(off_id_t\(get_id\(\),get_prty\(\)\))q(;)515
2042 y Fk(h)p Fj(c)l(ase)28 b(to)g(set)h(pr)l(e)l(de\014ne)l(d)h(pr)l
(op)l(erty)g Fi(p)d Fj(value)h Fi(val)g Fj(in)g Fi(set)p
2205 2042 V 28 w(prop)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
2134 y Fi(case)40 b(OFF_SHTLP_IPL:)715 2225 y
(set_prty\(val.i_offset\);)715 2316 y(break;)515 2574
y FA(dtlb)515 2727 y Fz(Although)31 b Ft(dtlb)f Fz(usage)g(is)h
(optional,)g(it)g(is)g(the)g(common)f(case)g(that)h(eac)n(h)f(sh)n
(uttle)i(has)515 2826 y(an)27 b(asso)r(ciated)f Ft(dtlb)h
Fz(to)g(b)r(e)h(used)g(as)e(its)i(protection)f(domain.)36
b(Th)n(us,)27 b(this)h(prop)r(ert)n(y)e(is)515 2926 y(also)g
(hardwired.)639 3026 y(When)k(there)f(is)h(no)f Ft(dtlb)g
Fz(supp)r(ort)g(and)g(the)h(k)n(ernel)f(is)g(exp)r(ected)h(to)f(op)r
(erate)f(on)h(a)515 3125 y(single)e(address)f(space,)h(these)h(metho)r
(ds)g(should)f(nev)n(er)g(b)r(e)h(called.)515 3258 y
Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g Fi(off)p
1552 3258 V 29 w(Shtl)p Fj(.)f Fk(i)p Fz(+)p Fq(\021)598
3350 y Fi(off_dtlb_id_t)42 b(s_dtlb;)433 b(//)40 b(DTLB)g(used)g(by)g
(this)g(shuttle.)515 3524 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 3524 V 29 w(Shtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 3615 y Fi(//)39 b(Returns)i(the)f(identifier)i(of)d
(the)h(DTLB)g(being)h(used.)598 3707 y(inline)f(const)h(off_dtlb_id_t)h
(&get_dtlb\(void\))h(const;)598 3889 y(//)c(Sets)i(the)e(associated)j
(DTLB)e(for)g(this)g(shuttle.)598 3981 y(void)g(set_dtlb\(const)i
(off_dtlb_id_t)g(&dtlb\);)515 4155 y Fk(h)p Fi(off)p
667 4155 V 29 w(Shtl::get)p 1047 4155 V 30 w(dtlb)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 4246 y Fi(//)39
b(Returns)i(the)f(identifier)i(of)d(the)h(DTLB)g(being)h(used.)598
4337 y(inline)f(const)h(off_dtlb_id_t)h(&off_Shtl::get_dtlb\(void\))j
(const)598 4429 y({)676 4520 y(return)c(s_dtlb;)598 4611
y(})1885 5255 y Fz(493)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
494 495 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Shtl::set)p 1047 523 V 30 w(dtlb)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Sets)i(the)e(associated)j(DTLB)e
(for)g(this)g(shuttle.)598 706 y(void)g(off_Shtl::set_dtlb\(const)45
b(off_dtlb_id_t)d(&dtlb\))598 797 y({)676 888 y
(dmm.pclr\(s_dtlb,get_id\(\)\);)676 980 y(s_dtlb=dtlb;)676
1071 y(dmm.pset\(dtlb,get_id\(\)\);)598 1162 y(})639
1395 y Fz(Initially)-7 b(,)28 b(the)g Ft(dtlb)f Fz(iden)n(ti\014er)h
(is)f(set)h(to)f(a)h(n)n(ull)f(v)-5 b(alue.)515 1511
y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 1511 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 1602 y Fi(s_dtlb\(OFF_DTLB_NULL\),)639 1727
y Fz(Finally)-7 b(,)26 b(this)f(prop)r(ert)n(y)f(also)g(set)h(at)g(sh)n
(uttle)h(creation)e(time)h(whenev)n(er)f(a)h(protot)n(yp)r(e)515
1826 y(sh)n(uttle)j(is)f(supplied)h(and)f Ft(dtlb)h Fz(supp)r(ort)f(is)
h(enabled.)515 1959 y Fk(h)p Fj(Initialize)e(har)l(dwir)l(e)l(d)j(pr)l
(op)l(erties)h(with)e(those)h(of)e Fi(proto)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 2051 y Fi(set_dtlb\(proto->get_dtlb\(\)\);)
639 2192 y Fz(The)f(ro)r(ot)e(sh)n(uttle)i(uses)f(the)g
Ft(dtlb)g Fz(created)g(at)g Ft(dmm)g Fz(startup)g(time,)i(pro)n(vided)d
(that)515 2291 y(the)j Ft(dmm)f Fz(is)h(activ)n(e.)515
2408 y Fk(h)p Fj(Setup)g(r)l(o)l(ot)h(shuttle.)g Fk(i)p
Fz(+)o Fq(\021)598 2499 y Fi(if)39 b(\(off_DMM::is_active\(\)\))676
2590 y(set_dtlb\(dmm.get_kdtlb\(\)->ge)q(t_id\()q(\)\);)639
2715 y Fz(Note)32 b(ho)n(w)g(if)g(no)g Ft(dtlb)g Fz(supp)r(ort)g(has)f
(b)r(een)h(enabled,)h(w)n(e)f(do)g(not)g(care)f(ab)r(out)h(the)515
2814 y Fx(set)p 652 2814 27 4 v 30 w(dtlb)h Fz(e\013ects,)j(as)d(the)i
(hardw)n(are)d(will)i(ignore)f(the)i(attempt)g(to)f(set)g(a)g
(protection)515 2914 y(domain.)h(Dep)r(ending)25 b(on)g(the)g(arc)n
(hitecture)e(b)r(eing)i(used,)g(the)g(page)f(table)g(register)f(\(e.g.)
515 3014 y(on)h(In)n(tels\))h(will)g(b)r(e)g(silen)n(tly)f(set)h(and)f
(ignored)g(or)g(the)h(domain)f(tag)g(\(e.g.)36 b(on)24
b(MIPS\))h(will)515 3113 y(b)r(e)j(set)f(to)h(the)g(only)f(one)g(b)r
(eing)h(used.)639 3213 y(W)-7 b(e)28 b(m)n(ust)g(complete)g
Fx(get)p 1476 3213 V 30 w(prop)e Fz(and)h Fx(set)p 2001
3213 V 30 w(prop)f Fz(no)n(w.)515 3346 y Fk(h)p Fj(c)l(ase)i(to)g(r)l
(eturn)i(pr)l(e)l(de\014ne)l(d)f(pr)l(op)l(erty)h Fi(p)e
Fj(value)g(in)f Fi(get)p 2173 3346 24 4 v 29 w(prop)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3437 y Fi(case)40 b(OFF_SHTLP_DTLB:)
715 3528 y(return)h(get_dtlb\(\);)515 3703 y Fk(h)p Fj(c)l(ase)28
b(to)g(set)h(pr)l(e)l(de\014ne)l(d)h(pr)l(op)l(erty)g
Fi(p)d Fj(value)h Fi(val)g Fj(in)g Fi(set)p 2205 3703
V 28 w(prop)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 3794 y
Fi(case)40 b(OFF_SHTLP_DTLB:)794 3885 y(set_dtlb\(val\);)715
3977 y(break;)1885 5255 y Fz(494)p eop
PStoPSsaved restore
%%Page: (496,497) 249
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
495 496 bop 515 523 a FA(Run)31 b(state)515 676 y Fz(Sh)n(uttles)d(ma)n
(y)f(also)g(w)n(ait)h(on)g(abstract)f(system)h(resources)e(due)i(to)g
(some)f(reason)g(\(eg.)37 b(a)515 776 y(sh)n(uttle)21
b(migh)n(t)g(w)n(an)n(t)f(to)g(blo)r(c)n(k)h(un)n(til)g(a)f(p)r(ortal)h
(message)e(b)r(e)i(sen)n(t)g(to)g(it\).)35 b(When)21
b(a)g(sh)n(uttle)515 876 y(go)r(es)27 b(to)h(sleep)g(it)h(should)f
(call)g Fx(block)p Fz(.)37 b(Later)27 b(on,)h(someone)f(else)h(ma)n(y)g
(call)g Fx(unblock)d Fz(to)515 975 y(un)n(blo)r(c)n(k)i(it.)639
1075 y(Another)k(e\013ect)h(of)f(calling)f Fx(block)g
Fz(is)h(that)g(\(ev)n(en)g(if)h(no)f(ev)n(en)n(t)f(is)h(ev)n(er)f
(raised\))h(the)515 1174 y(sh)n(uttle)k(will)g(b)r(e)h(ignored)e(b)n(y)
g(its)i(pro)r(cessor)d(un)n(til)i(a)g(subsequen)n(t)f(call)h(to)g
Fx(unblock)d Fz(is)515 1274 y(p)r(erformed.)58 b(The)35
b Fx(Processor)d Fz(where)i(the)i(sh)n(uttle)f(is)g(running)g(c)n(hec)n
(ks)e(the)j Fx(blocked)515 1374 y Fz(\015ag)29 b(and)h(ignores)e(the)j
(sh)n(uttle)f(if)g(it)h(is)f(set.)44 b(The)30 b Fx(blocked)d
Fz(\015ag)i(means)h Fy(unable)i(to)g(run)515 1473 y Fz(and)19
b(can)h(b)r(e)g(used)g(not)g(only)g(to)g(blo)r(c)n(k)f(a)g(sh)n(uttle,)
j(but)f(also)e(during)g(sh)n(uttle)h(initialization,)515
1573 y(during)e(sh)n(uttle)g(disman)n(tling,)i(etc.)34
b(It)19 b(should)f(not)h(b)r(e)f(confused)h(with)g(the)g(more)e
(abstract)515 1673 y Fy(blo)l(cke)l(d)37 b Fz(state)28
b(used)f(in)h(traditional)f(pro)r(cess)f(abstractions.)515
1805 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1805 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1897 y Fi(//)39 b(Checks/Sets)j(if)e(this)g(shuttle)h(is)e(unable)i(to)
f(run)g(\(blocked\).)598 1988 y(inline)g(boolean_t)i
(is_blocked\(void\))g(const;)598 2079 y(void)e(block\(void\);)598
2171 y(void)g(unblock\(void\);)639 2312 y Fz(After)28
b(the)f(main)g(en)n(try)f(p)r(oin)n(t)i(of)e(a)h(sh)n(uttle)g
(\014nishes,)g(it)h(is)f(declared)f(as)g(terminated)515
2411 y(and)h(will)h(not)g(b)r(e)g(able)f(to)g(run)h(an)n(y)f(more.)515
2528 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2528 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2619 y Fi(//)39 b(Sets)i(the)e(shuttle)i(as)f(terminated.)598
2710 y(void)g(terminated\(void\);)598 2802 y(inline)g(boolean_t)i
(is_terminated\(void\))h(const;)639 2926 y Fz(W)-7 b(e)39
b(use)g(one)f(of)g(the)h(a)n(v)-5 b(ailable)37 b(resource)g(\015ags)h
(to)g(main)n(tain)g(the)h Fx(blocked)d Fz(\015ag.)515
3026 y(Besides,)d(nested)g(blo)r(c)n(k)g(requests)e(are)h(allo)n(w)n
(ed.)51 b(A)34 b(coun)n(ter)e Fx(s)p 2589 3026 27 4 v
31 w(blockcnt)d Fz(is)k(used)g(for)515 3125 y(that.)515
3258 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3258 24 4 v 29 w(Shtl)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 3350 y Fi(atomic_t)41 b(s_blockcnt;)355 b(//)40
b(#)f(of)h(nested)h(block)f(requests.)515 3524 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 1928 3524 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3615 y Fi(s_blockcnt\(0\),)515 3790 y Fk(h)p
Fj(O\013)f(shuttle)i(dep)l(endencies.)g Fk(i)p Fz(+)p
Fq(\021)598 3881 y Fi(#include)41 b(<klib/mdep/bitops.h>)122
b(//)40 b(for)g(atomic_t)h(and)f(atomic_inc/dec)515 4055
y Fk(h)p Fi(off)p 667 4055 V 29 w(Shtl::is)p 1008 4055
V 30 w(blocked)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
4147 y Fi(//)39 b(Checks)i(if)f(this)g(shuttle)h(is)e(unable)i(to)f
(run)g(\(blocked\).)598 4238 y(inline)g(boolean_t)i
(off_Shtl::is_blocked\(void\)const)k({)39 b(return)i
(r_flags&OFF_SF_BLK;)i(})598 4329 y(//)c(Checks)i(if)f(this)g(shuttle)h
(is)e(terminated.)598 4421 y(inline)h(boolean_t)i
(off_Shtl::is_terminated\(void\)co)q(nst)k({)676 4512
y(return)41 b(r_flags&OFF_SF_TRM;)598 4603 y(})1885 5255
y Fz(495)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
496 497 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(Shtl::block)p Fj(,)29 b Fi(unblock)p Fj(,)g(and)f
Fi(terminated)h Fj(implementation.)f Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Set)h(this)g(shuttle)h(to)f(unable/able)i(to)d(run.)
598 706 y(void)h(off_Shtl::block\(void\))598 797 y({)676
888 y(atomic_inc\(&s_blockcnt\);)676 980 y(if)g(\(s_blockcnt==1\){)755
1071 y(r_flags)g(|=)g(OFF_SF_BLK;)755 1162 y(\(void\)&r_flags;)755
1254 y(if)f(\(get_id\(\)==off_Shtl::self\(\)-)q(>get)q(_id\()q(\)\))833
1345 y(off_Processor::self\(\)->new_qu)q(antu)q(m\(\);)755
1436 y(else)h(if)f(\(is_running\(\)\){)833 1528 y(otsan\(\);)833
1619 y(//)h(XXX)g(running)h(on)e(a)h(different)h(processor.)833
1710 y(//)f(should)g(make)h(its)e(processor-clock-tick)44
b(timer)d(expire)f(on)g(the)833 1802 y(//)g(next)g(tick.)833
1893 y(//)g(This)g(needs)g(a)g(new)g(method)g(in)g(Tmr)g(which)g(does)g
(not)g(delete)h(it)f(but)833 1984 y(//)g(resets)g(it)g(to)g(a)f
(different)i(time.)833 2076 y(//)f(But)g(it's)g(only)g(needed)h(for)e
(SMP.)i(can)f(wait.)833 2167 y(while)g(\(is_running\(\)\))755
2258 y(;)755 2350 y(})676 2441 y(})598 2532 y(})598 2623
y(void)g(off_Shtl::unblock\(void\))k({)676 2715 y
(atomic_dec\(&s_blockcnt\);)676 2806 y(if)c(\(s_blockcnt<=0\))755
2897 y(if)f(\(\(r_flags&OFF_SF_TRM\)==0\){)833 2989 y(r_flags)i(&=)f
(~OFF_SF_BLK;)676 3080 y(})598 3171 y(})598 3263 y(void)g
(off_Shtl::terminated\(void\){)676 3354 y(r_flags)h(|=)f
(OFF_SF_BLK|OFF_SF_TRM;)598 3445 y(})639 3678 y Fz(W)-7
b(e)28 b(ha)n(v)n(e)f(to)g(de\014ned)h(the)g(new)g(\015ag.)515
3794 y Fk(h)p Fj(O\013)f(shuttle)i(\015ag)f(bits.)g Fk(i)o
Fz(+)p Fq(\021)598 3885 y Fi(const)40 b(unsigned8_t)i(OFF_SF_BLK)f(=)f
(0x20;)g(//)g(Unable)g(to)g(run?)598 3977 y(const)g(unsigned8_t)i
(OFF_SF_TRM)f(=)f(0x08;)g(//)118 b(permanently?)1885
5255 y Fz(496)p eop
PStoPSsaved restore
%%Page: (498,499) 250
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
497 498 bop 639 523 a Fz(Sh)n(uttles)22 b(migh)n(t)e(b)r(e)i(clev)n(er)
d(and)i(donate)f(their)h(pro)r(cessor)e(time)i(to)g(the)g(sh)n(uttle)g
(whic)n(h)515 623 y(w)n(ould)27 b(un)n(blo)r(c)n(k)g(them.)37
b(In)28 b(that)g(case)f(they)h(should)f(use)g Fx(yield)f
Fz(righ)n(t)h(b)r(efore)g Fx(block)p Fz(.)515 756 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 756
24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 847
y Fi(//)39 b(Yields)i(quanta)g(to)e(s)h(when)g(blocked.)598
938 y(//)f(\(Or)h(reclaims)h(quanta)g(when)f(yield\(get_id\(\)\).\))598
1029 y(err_t)g(yield\(const)i(off_shtl_id_t)g(&s\);)598
1212 y(//)d(Is)h(this)g(shuttle)h(yielding?)598 1303
y(inline)f(boolean_t)i(is_yielding\(void\))h(const;)598
1486 y(//Who)d(does)g(this)g(shuttle)h(yield)g(to?)598
1577 y(inline)f(const)h(off_shtl_id_t)h(&yields_to\(void\))h(const;)639
1719 y Fz(W)-7 b(e)32 b(use)g(a)f(\015ag)g(to)g(record)f(the)i(fact)g
(that)g(w)n(e)f(are)g(yielding)g(and)h(another)e(mem)n(b)r(er)515
1818 y(to)d(k)n(eep)g(the)h(iden)n(ti\014er)g(of)f(the)h(sh)n(uttle)g
(w)n(e)f(are)g(yielding)g(to.)515 1934 y Fk(h)p Fj(Other)h(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 1934 V 29 w(Shtl)p Fj(.)f
Fk(i)p Fz(+)p Fq(\021)598 2026 y Fi(off_shtl_id_t)42
b(s_yield;)394 b(//)40 b(We)f(are)h(yielding)h(to)f(this)g(guy.)639
2150 y Fz(It)28 b(is)g(initially)f(set)h(to)f(a)h(n)n(ull)f(v)-5
b(alue.)515 2267 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h
(memb)l(ers)f(of)e Fi(off)p 1928 2267 V 29 w(Shtl)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 2358 y Fi(s_yield\(OFF_SHTL_NULL\),)515
2516 y Fk(h)p Fi(off)p 667 2516 V 29 w(Shtl::is)p 1008
2516 V 30 w(yielding)h Fj(implementation.)e Fk(i)p Fq(\021)598
2607 y Fi(//)39 b(Is)h(this)g(shuttle)h(yieldig?)598
2698 y(inline)f(boolean_t)i(off_Shtl::is_yielding\(void\))j(const)598
2790 y({)637 2881 y(return)c(r_flags)f(&)g(OFF_SF_YLD;)598
2972 y(})639 3113 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ned)h(the)
g(new)g(\015ag.)515 3230 y Fk(h)p Fj(O\013)f(shuttle)i(\015ag)f(bits.)g
Fk(i)o Fz(+)p Fq(\021)598 3321 y Fi(const)40 b(unsigned8_t)i
(OFF_SF_YLD)f(=)f(0x40;)g(//)g(Is)g(yielding?)515 3479
y Fk(h)p Fi(off)p 667 3479 V 29 w(Shtl::yields)p 1164
3479 V 30 w(to)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3570 y Fi(//Who)40 b(is)g(this)g(shuttle)h(yielding)g(to?)598
3661 y(inline)f(const)h(off_shtl_id_t)h(&off_Shtl::yields_to\(void\))j
(const)598 3753 y({)676 3844 y(return)c(\(is_yielding\(\)\)?)i(s_yield)
d(:)g(get_id\(\);)598 3935 y(})1885 5255 y Fz(497)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
498 499 bop 639 523 a Fz(T)-7 b(o)24 b(yield)h(the)f(pro)r(cessor)f
(time)i(w)n(e)f(set)g(the)h(yield)f(\015ag)g(\(or)f(clear)h(it)h(when)f
(yielding)g(to)515 623 y(ourselv)n(es\).)38 b(Besides,)28
b(if)h(w)n(e)f(are)f(running)h(on)h(the)f(yielding)h(sh)n(uttle)f(the)h
(pro)r(cessor)e(has)515 722 y(to)g(b)r(e)h(noti\014ed)g(that)g(the)g
(curren)n(t)f(quan)n(tum)g(is)h(to)f(b)r(e)h(yield.)515
853 y Fk(h)p Fi(off)p 667 853 24 4 v 29 w(Shtl::yield)h
Fj(implementation.)f Fk(i)p Fq(\021)598 944 y Fi(//)39
b(Yields)i(quanta)g(to)e(s.)598 1035 y(//)g(\(Or)h(reclaims)h(quanta)g
(when)f(yield\(get_id\(\)\).\))598 1127 y(err_t)g
(off_Shtl::yield\(const)k(off_shtl_id_t)e(&s\))598 1218
y({)676 1309 y(if)e(\(s)g(==)f(get_id\(\)\))j({)755 1401
y(r_flags)e(&=)g(~OFF_SF_YLD;)676 1492 y(})676 1583 y(else)g({)755
1675 y(r_flags)g(|=)g(OFF_SF_YLD;)755 1766 y(s_yield=s;)755
1857 y(if)f(\(off_Shtl::self\(\))k(==)d(this\){)833 1949
y(return)h(\(shtl+s\)->switch_from\(this\);)755 2040
y(})676 2131 y(})676 2222 y(return)g(EOK;)598 2314 y(})515
2575 y Fk(h)p Fj(O\013)27 b(shuttle)i(implementation)f(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 2666 y Fi(#include)41
b(<node/Node.h>)395 b(//)40 b(for)g(nd)639 2804 y Fz(The)34
b(call)f(to)h Fx(switch)p 1351 2804 27 4 v 28 w(from)e
Fz(lo)r(cates)h(the)h(giv)n(en)f(sh)n(uttle)h(and)f(p)r(erforms)g(a)g
(con)n(text)515 2904 y(switc)n(h)27 b(to)h(it.)37 b(W)-7
b(e)28 b(will)g(see)f(later)g(ho)n(w)g(it)h(w)n(orks.)515
3034 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3034 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3126 y Fi(//)39 b(Context)i(switches)g(from)f(another)h(shuttle)g
(\(maybe)g(from)f(none\))598 3217 y(err_t)g(switch_from\(off_Shtl)k
(*s\);)639 3356 y Fz(Another)28 b(v)-5 b(arian)n(t)26
b(of)i Fx(yield)d Fz(just)k(relinquishes)d(the)i(pro)r(cessor.)515
3471 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3471 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3562 y Fi(//)39 b(Yields)i(to)f(any)g(other)g(one.)598
3653 y(void)g(yield\(void\);)515 3807 y Fk(h)p Fi(off)p
667 3807 V 29 w(Shtl::yield)29 b Fj(implementation.)f
Fk(i)p Fz(+)o Fq(\021)598 3899 y Fi(//)39 b(Yields)i(to)f(any)g(other)g
(one.)598 3990 y(void)g(off_Shtl::yield\(void\))598 4081
y({)676 4173 y(off_Processor::self\(\)->new_q)q(uantu)q(m\(\);)598
4264 y(})639 4494 y Fz(Sh)n(uttles)26 b(m)n(ust)g(not)g(run)f(at)h(the)
g(same)f(time)h(on)f(more)g(than)h(one)f(pro)r(cessor.)34
b(T)-7 b(o)25 b(en-)515 4594 y(sure)20 b(it,)j(running)e(sh)n(uttles)h
(are)e(\015agged)g(and)h(suc)n(h)g(a)g(\015ag)f(is)h(c)n(hec)n(k)n(ed)f
(b)n(y)h(ev)n(ery)f(pro)r(cessor)515 4693 y(b)r(efore)27
b(switc)n(hing)g(to)h(a)f(new)g(sh)n(uttle.)38 b(These)27
b(new)h(metho)r(ds)f(do)h(the)g(job:)515 4824 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4824
V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 4915 y
Fi(//)39 b(Checks/Sets)j(if)e(this)g(shuttle)h(is)e(running.)598
5006 y(inline)h(boolean_t)i(is_running\(void\))g(const;)1885
5255 y Fz(498)p eop
PStoPSsaved restore
%%Page: (500,501) 251
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
499 500 bop 515 523 a Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 523 24 4 v 29 w(Shtl)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 614 y Fi(inline)40 b(void)g(run\(void\);)598
706 y(inline)g(void)g(stop\(void\);)639 847 y Fz(Again,)27
b(w)n(e)h(use)f(another)g(bit)h(in)g(the)g(resource)e(\015ags.)515
963 y Fk(h)p Fi(off)p 667 963 V 29 w(Shtl::is)p 1008
963 V 30 w(running)j Fj(et)f(al.)f(implementation.)g
Fk(i)p Fq(\021)598 1054 y Fi(//)39 b(Checks/Sets)j(if)e(this)g(shuttle)
h(is)e(running.)598 1146 y(inline)h(boolean_t)i
(off_Shtl::is_running\(void\))j(const)598 1237 y({)676
1328 y(return)c(r_flags&OFF_SF_RUN;)598 1420 y(})598
1511 y(inline)f(void)g(off_Shtl::run\(void\))k({)118
b(r_flags)41 b(|=)e(OFF_SF_RUN;)j(})598 1602 y(inline)e(void)g
(off_Shtl::stop\(void\))k({)79 b(r_flags)41 b(&=)e(~OFF_SF_RUN;)j(})639
1727 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ned)h(the)g(new)g
(\015ag.)515 1843 y Fk(h)p Fj(O\013)f(shuttle)i(\015ag)f(bits.)g
Fk(i)o Fz(+)p Fq(\021)598 1934 y Fi(const)40 b(unsigned8_t)i
(OFF_SF_RUN)f(=)f(0x80;)g(//)g(Is)g(running?)639 2059
y Fz(When)25 b(a)e(sh)n(uttle)h(is)g(created,)f(it)i(is)e(alw)n(a)n(ys)
f(blo)r(c)n(k)n(ed,)i(not)g(yielding)f(and)h(not)f(running)515
2159 y(un)n(til)28 b(explicitly)g(un)n(blo)r(c)n(k)n(ed.)515
2291 y Fk(h)p Fj(Initialize)e(har)l(dwir)l(e)l(d)j(pr)l(op)l(erties)h
(with)e(those)h(of)e Fi(proto)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2383 y Fi(yield\(get_id\(\)\);)317 b(//)79
b(yielding)41 b(to)f(ourselves)598 2474 y(stop\(\);)511
b(//)79 b(and)40 b(not)g(running.)639 2615 y Fz(Ho)n(w)n(ev)n(er,)26
b(the)i(ro)r(ot)f(sh)n(uttle)h(starts)e(running.)515
2731 y Fk(h)p Fj(Setup)i(r)l(o)l(ot)h(shuttle.)g Fk(i)p
Fz(+)o Fq(\021)598 2823 y Fi(yield\(get_id\(\)\);)598
2914 y(run\(\);)639 3039 y Fz(W)-7 b(e)28 b(m)n(ust)g(complete)g
Fx(get)p 1476 3039 27 4 v 30 w(prop)e Fz(and)h Fx(set)p
2001 3039 V 30 w(prop)f Fz(no)n(w.)515 3171 y Fk(h)p
Fj(c)l(ase)i(to)g(r)l(eturn)i(pr)l(e)l(de\014ne)l(d)f(pr)l(op)l(erty)h
Fi(p)e Fj(value)g(in)f Fi(get)p 2173 3171 24 4 v 29 w(prop)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3263 y Fi(case)40 b(OFF_SHTLP_RUNS:)
715 3354 y(if)g(\(is_terminated\(\)\))794 3445 y(return)g
(off_id_t\(0,OFF_SHTL_RTERM\);)715 3537 y(else)h(if)e
(\(is_blocked\(\)\))794 3628 y(return)h(off_id_t\(0,OFF_SHTL_RBLK\);)
715 3719 y(else)794 3811 y(return)g(off_id_t\(0,OFF_SHTL_RRDY\);)715
3902 y(return)h(\(is_blocked\(\)\))h(?)79 b(OFF_PRTL_NULL:)43
b(get_id\(\))e(;)598 3993 y(case)f(OFF_SHTLP_YLDS:)715
4085 y(return)h(\(is_yielding\(\)\)?)82 b(yields_to\(\))f(:)40
b(OFF_SHTL_NULL;)1885 5255 y Fz(499)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
500 501 bop 515 523 a Fk(h)p Fj(c)l(ase)28 b(to)g(set)h(pr)l(e)l
(de\014ne)l(d)h(pr)l(op)l(erty)g Fi(p)d Fj(value)h Fi(val)g
Fj(in)g Fi(set)p 2205 523 24 4 v 28 w(prop)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(case)40 b(OFF_SHTLP_RUNS:)715
706 y(switch\(val.i_offset\){)715 797 y(case)h(OFF_SHTL_RBLK:)794
888 y(block\(\);)794 980 y(break;)715 1071 y(case)g(OFF_SHTL_RRDY:)794
1162 y(unblock\(\);)794 1254 y(break;)715 1345 y(case)g(OFF_SHTL_RYLD:)
794 1436 y(yield\(\);)794 1528 y(break;)715 1619 y(})715
1710 y(break;)598 1802 y(case)f(OFF_SHTLP_YLDS:)715 1893
y(yield\(val\);)715 1984 y(break;)639 2125 y Fz(Where)515
2242 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(pr)l(e)l(de\014ne)l(d)h
(pr)l(op)l(erties)g(numb)l(ers.)e Fk(i)p Fz(+)p Fq(\021)598
2333 y Fi(//)39 b(i_offsets)j(in)d(values)i(for)f(the)g(run)g(state)g
(shuttle)h(property.)598 2424 y(enum)f({)f(OFF_SHTL_RTERM,)396
b(//)40 b(terminated)h(--cannot)g(be)f(set.)872 2516
y(OFF_SHTL_RBLK,)435 b(//)40 b(blocked)872 2607 y(OFF_SHTL_RRDY,)435
b(//)40 b(unblocked)872 2698 y(OFF_SHTL_RYLD)j(};)353
b(//)40 b(yielding)h(current)g(slot.--cannot)h(be)d(get.)1885
5255 y Fz(500)p eop
PStoPSsaved restore
%%Page: (502,503) 252
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
501 502 bop 515 523 a FA(Sh)m(uttles)31 b(and)i(T)-8
b(raps)515 676 y Fz(As)32 b(w)n(e)g(ha)n(v)n(e)f(seen)g(in)i(section)e
(4.6,)i(eac)n(h)e Fx(Processor)e Fz(includes)j(b)r(oth)g(a)g
Fx(TrapTbl)d Fz(and)515 776 y(an)i Fx(IntTbl)p Fz(.)47
b(As)31 b(in)h(certain)f(circumstances)g(w)n(e)g(ma)n(y)g(desire)g(to)g
(dispatc)n(h)g(traps)g(on)g(a)515 876 y(p)r(er-sh)n(uttle)e(basis,)h
(there)f(is)h(a)f(prede\014ned)g(sh)n(uttle)h(prop)r(ert)n(y)f
(de\014ning)h(those)f(traps)g(in)515 975 y(whic)n(h)e(the)h(curren)n(t)
f(sh)n(uttle)h(has)f(in)n(terest.)639 1075 y(When)h(a)f(trap)f(is)h
(found,)h(the)f(p)r(er-pro)r(cessor)e(trap)i(table)g(is)g(c)n(hec)n(k)n
(ed)f(\014rst)h(and)f(only)515 1174 y(when)i(the)f(trap)h(is)f(not)h
(handled)f(there)h(is)f(the)h(p)r(er-sh)n(uttle)g(trap)f(table)g(c)n
(hec)n(k)n(ed.)639 1274 y(P)n(er-sh)n(uttle)19 b(trap)i(tables)f(are)f
(not)i(y)n(et)f(implemen)n(ted.)35 b(They)21 b(are)e(easy)h(to)g
(implemen)n(t)515 1374 y(though,)25 b(b)n(y)g(using)g(the)h(co)r(de)f
(used)g(to)g(handle)g(p)r(er-pro)r(cessor)e(trap)h(tables.)36
b(The)25 b(idea)g(is)515 1473 y(to)f(use)g(a)f(trap)h(table)g(serv)n
(er)e(supplying)i(di\013eren)n(t)g(trap)g(tables)f(and)h(then)h(w)n(e)e
(can)h(install)515 1573 y(the)38 b(iden)n(ti\014er)h(of)f(the)h
(\\curren)n(t)d(trap)i(table")g(as)g(the)g(v)-5 b(alue)38
b(of)h(a)f(new)g(\\trap-table")515 1673 y(sh)n(uttle)28
b(prop)r(ert)n(y)-7 b(.)639 1772 y(P)n(er-sh)n(uttle)37
b(trap)g(tables)g(will)h(b)r(e)g(implemen)n(ted)h(as)e(so)r(on)g(as)g
(remaining)f(system)515 1872 y(services)26 b(b)r(e)i(stable)f(enough.)
515 2088 y FA(User-lev)m(el)k(prop)s(erties)515 2241
y Fz(Some)37 b(times)h(it)h(migh)n(t)e(b)r(e)i(desirable)d(to)i
(implemen)n(t)h(user-lev)n(el)d(prop)r(erties.)66 b(As)38
b(an)515 2340 y(example,)23 b(a)f(user)g(lev)n(el)g(thread)f(pac)n(k)-5
b(age)21 b(migh)n(t)i(express)e(the)i(user-lev)n(el)e(thread)g(con)n
(text)515 2440 y(as)30 b(a)g(prop)r(ert)n(y)-7 b(.)46
b(T)-7 b(o)30 b(supp)r(ort)h(user-lev)n(el)e(prop)r(erties)h(the)h(sh)n
(uttle)g(serv)n(er)e(prede\014ned)h(a)515 2540 y Fx(SHTLP)p
740 2540 27 4 v 29 w(UCTX)e Fz(prop)r(ert)n(y)-7 b(.)43
b(Suc)n(h)30 b(prop)r(ert)n(y)-7 b(,)30 b(when)g(set)f(to)h(a)g(non-n)n
(ull)f(v)-5 b(alue)30 b(express)f(the)515 2639 y(usage)d(of)i(user-lev)
n(el)e(prop)r(erties.)639 2739 y(The)39 b(prop)r(ert)n(y)e(v)-5
b(alue)38 b(con)n(tains)g(the)h(\(program\))d(en)n(try)i(p)r(oin)n(t)h
(for)f(the)h(user-lev)n(el)515 2839 y(prop)r(ert)n(y)21
b(serv)n(er.)34 b(That)23 b(serv)n(ers)d(runs)j(after)f(ev)n(ery)g(k)n
(ernel)g(prop)r(ert)n(y)g(has)g(b)r(een)h(honored)515
2938 y(but)30 b(b)r(efore)f(the)h(pro)r(cessor)e(con)n(text)h
(\(general)f(purp)r(ose)i(registers,)e(actually\))h(prop)r(ert)n(y)515
3038 y(is)e(handled.)639 3137 y(A)i(consequence)e(is)i(that)f(when)h
(user)f(prop)r(erties)f(are)h(used,)g(the)h(pro)r(cessor)d(con)n(text)
515 3237 y Fy(must)32 b Fz(b)r(e)25 b(handled)g(b)n(y)g(the)g(user-lev)
n(el)e(prop)r(ert)n(y)h(serv)n(er)f(and)i(not)g(b)n(y)f(the)i(k)n
(ernel)e(sh)n(uttle)515 3337 y(serv)n(er.)35 b(That)27
b(is)h(to)f(a)n(v)n(oid)f(unnecessary)g(calls)h(to)h(the)g(k)n(ernel.)
639 3436 y(First,)c(the)f(k)n(ernel)f(sa)n(v)n(es)f(user)i(registers)e
(in)n(to)h(a)h(place)f(sp)r(eci\014ed)h(b)n(y)g(the)g
Fx(SHTLP)p 3180 3436 V 30 w(UCTX)515 3536 y Fz(prop)r(ert)n(y)g(v)-5
b(alue.)36 b(Second,)25 b(instead)f(of)h(reloading)e(the)i(user)f(con)n
(text,)g(the)h(k)n(ernel)f(simply)515 3636 y(sets)e(the)i(program)d
(coun)n(ter)h(to)h(the)g(prop)r(ert)n(y)f(serv)n(er)f(en)n(try)h(p)r
(oin)n(t)h(\(remaining)g(registers)515 3735 y(will)28
b(matc)n(h)f(the)h(user)f(con)n(text\).)639 3835 y(W)-7
b(e)28 b(m)n(ust)g(complete)g Fx(get)p 1476 3835 V 30
w(prop)e Fz(and)h Fx(set)p 2001 3835 V 30 w(prop)f Fz(no)n(w.)515
3968 y Fk(h)p Fj(c)l(ase)i(to)g(r)l(eturn)i(pr)l(e)l(de\014ne)l(d)f(pr)
l(op)l(erty)h Fi(p)e Fj(value)g(in)f Fi(get)p 2173 3968
24 4 v 29 w(prop)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 4059
y Fi(case)40 b(OFF_SHTLP_UCTX:)715 4150 y(return)h
(off_id_t\(s_usrv,\(vm_offset_t\))q(s_uc)q(tx\);)1885
5255 y Fz(501)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
502 503 bop 515 523 a Fk(h)p Fj(c)l(ase)28 b(to)g(set)h(pr)l(e)l
(de\014ne)l(d)h(pr)l(op)l(erty)g Fi(p)d Fj(value)h Fi(val)g
Fj(in)g Fi(set)p 2205 523 24 4 v 28 w(prop)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(case)40 b(OFF_SHTLP_UCTX:)715
706 y(if)g(\(val)g(==)g(OFF_PRTL_NULL\))i({)794 797 y(r_flags)f(&=)e
(~OFF_SF_UCTX;)794 888 y(s_uctx=\(vm_offset_t\)\(s_usrv=0\))q(;)715
980 y(})715 1071 y(else)i({)794 1162 y(r_flags)g(|=)e(OFF_SF_UCTX;)794
1254 y(s_usrv=val.i_node;)794 1345 y(s_uctx=\(off_mdepUProcRegs*\)val)q
(.i_o)q(ffse)q(t;)715 1436 y(})715 1528 y(break;)515
1678 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1678 V 29 w(Shtl)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 1770 y Fi(vm_offset_t)41 b(s_usrv;)512 b(//)40
b(user)g(level)g(property)h(server.)598 1861 y(off_mdepUProcRegs*)i
(s_uctx;)237 b(//)40 b(usre)g(level)g(property)h(array.)515
2012 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f
(of)e Fi(off)p 1928 2012 V 29 w(Shtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 2103 y Fi(s_usrv\(0\),s_uctx\(NULL\))639
2233 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(new)g
(\015ag)e(to)r(o.)515 2354 y Fk(h)p Fj(O\013)h(shuttle)i(\015ag)f
(bits.)g Fk(i)o Fz(+)p Fq(\021)598 2445 y Fi(const)40
b(unsigned8_t)i(OFF_SF_UCTX)g(=)d(0x04;)h(//)g(using)g(u-props?)639
2574 y Fz(There)27 b(are)g(usual)g(accessors)e(for)i(this)h(prop)r(ert)
n(y)-7 b(.)515 2695 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2695 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2787 y Fi(//)39 b(Returns)i(the)f(uctx)g(for)g(this)g
(shuttle.)598 2878 y(inline)g(off_id_t)h(get_uctx\(void\))i(const;)598
2969 y(//)c(Sets)i(the)e(uctx)i(for)f(this)g(shuttle.)598
3061 y(err_t)158 b(set_uctx\(const)42 b(off_id_t)f(&val\);)515
3212 y Fk(h)p Fi(off)p 667 3212 V 29 w(Shtl::get)p 1047
3212 V 30 w(uctx)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3303 y Fi(//)39 b(Returns)i(the)f(uctx)g(for)g(this)g(shuttle.)598
3394 y(inline)g(off_id_t)h(off_Shtl::get_uctx\(void\))k(const)40
b({)676 3486 y(return)h(off_id_t\(s_usrv,\(vm_offset_t\)s)q(_uct)q
(x\);)598 3577 y(})515 3728 y Fk(h)p Fi(off)p 667 3728
V 29 w(Shtl::set)p 1047 3728 V 30 w(uctx)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 3819 y Fi(//)39 b(Sets)i(the)e(uctx)i(for)f(this)g
(shuttle.)598 3910 y(err_t)158 b(off_Shtl::set_uctx\(const)44
b(off_id_t)e(&val\))598 4002 y({)676 4093 y(if)e(\(val)g(==)g
(OFF_PRTL_NULL\))i({)755 4184 y(r_flags)e(&=)g(~OFF_SF_UCTX;)755
4276 y(s_uctx=\(vm_offset_t\)\(s_usrv=0\);)676 4367 y(})676
4458 y(else)g({)755 4550 y(r_flags)g(|=)g(OFF_SF_UCTX;)755
4641 y(s_usrv=val.i_node;)755 4732 y(s_uctx=\(off_mdepUProcRegs*\)val.)
q(i_of)q(fset)q(;)676 4824 y(})676 4915 y(return)h(EOK;)598
5006 y(})1885 5255 y Fz(502)p eop
PStoPSsaved restore
%%Page: (504,505) 253
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
503 504 bop 639 523 a Fz(This)25 b(prop)r(ert)n(y)f(also)f(set)i(at)g
(sh)n(uttle)g(creation)e(time)j(whenev)n(er)e(a)g(protot)n(yp)r(e)g(sh)
n(uttle)515 623 y(is)j(supplied.)515 739 y Fk(h)p Fj(Initialize)f(har)l
(dwir)l(e)l(d)j(pr)l(op)l(erties)h(with)e(those)h(of)e
Fi(proto)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 830 y Fi
(set_uctx\(proto->get_uctx\(\)\);)639 955 y Fz(T)-7 b(o)27
b(honor)g(this)h(prop)r(ert)n(y)e(w)n(e)i(follo)n(w)e(what)i(w)n(as)f
(said)g(ab)r(o)n(v)n(e.)515 1088 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l
(d)j(metho)l(ds)e(of)e Fi(off)p 1594 1088 24 4 v 29 w(Shtl)p
Fj(.)h Fk(i)o Fq(\021)598 1179 y Fi(inline)40 b(void)g
(handoff_uctx\(void\);)515 1353 y Fk(h)p Fi(off)p 667
1353 V 29 w(Shtl::handoff)p 1203 1353 V 31 w(uctx)28
b Fj(implementation.)g Fk(i)o Fq(\021)598 1445 y Fi(inline)40
b(void)g(off_Shtl::handoff_uctx\(void)q(\))45 b({)676
1536 y(if)40 b(\(r_flags&OFF_SF_UCTX\){)755 1627 y(off_ShtlCtxItr)i
(ctx=get_ctx\(\);)755 1719 y(++ctx;)755 1810 y(*s_uctx)e(=)g
(*ctx.get_element\(\)->c_regs->g)q(et_ur)q(egs\()q(\);)755
1901 y(ctx.get_element\(\)->c_regs->set_)q(pc\(s)q(_usr)q(v\);)755
1993 y(})676 2084 y(})515 2358 y Fn(5.1.8)112 b(Starting)37
b(and)h(terminating)d(sh)m(uttles)515 2511 y Fz(A)24
b(sh)n(uttle)h(is)f(initially)g(started)g(b)n(y)g(up)r(calling)g(to)g
(its)g(en)n(try)g(p)r(oin)n(t.)36 b(Whenev)n(er)24 b(the)g(main)515
2611 y(en)n(try)h(p)r(oin)n(t)h(returns,)f(an)h(exit)g(routine)f(is)h
(called.)36 b(It)26 b(m)n(ust)g(clean)n(up)f(sh)n(uttle)h(resources.)
515 2743 y Fk(h)p Fj(Other)i(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2743 V 29 w(Shtl)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 2835 y Fi(friend)40 b(volatile)h(void)g
(off_shtl_main\(volatile)j(off_Shtl)d(*s,)f(volatile)h(register_t)g
(usp,)f(volatile)h(register_t)h(upc\);)598 3017 y(//)d(Starts)i
(executing)g(shuttle)g(by)f(upcalling)h(to)f(upc)g(on)f(usp)h(stack.)
598 3109 y(void)g(main\(off_mdepStck)j(usp,)d(register_t)i(upc\);)598
3200 y(//)d(Terminates)j(a)d(shuttle.)i(Its)f(main)g(entry)h(point)f
(returned.)598 3291 y(void)g(exit\(void\);)639 3433 y
Fz(T)-7 b(o)29 b(pro)n(vide)f(a)g(\\C")g(en)n(try)h(p)r(oin)n(t,)g(a)g
(global)f(function)h(dispatc)n(hes)g(to)f(the)i(adequate)515
3532 y(sh)n(uttle)e(metho)r(d.)515 3648 y Fk(h)p Fj(O\013)f
Fi(shtl)p 839 3648 V 29 w(main)h Fj(r)l(outine.)h Fk(i)o
Fq(\021)598 3740 y Fi(volatile)41 b(void)f(off_shtl_main\(volatile)k
(off_Shtl)d(*s,)f(volatile)h(register_t)h(usp,)1696 3831
y(volatile)f(register_t)h(upc\);)515 3989 y Fk(h)p Fj(O\013)27
b Fi(shtl)p 839 3989 V 29 w(main)h Fj(implementation.)g
Fk(i)p Fq(\021)598 4080 y Fi(volatile)41 b(void)f
(off_shtl_main\(volatile)k(off_Shtl)d(*s,)1696 4171 y(volatile)g
(register_t)h(usp,)e(volatile)h(register_t)g(upc\))598
4263 y({)676 4354 y(off_Processor::seti\(\);)676 4445
y(\(\(off_Shtl*\)s\)->main\(usp,upc)q(\);)676 4537 y
(\(\(off_Shtl*\)s\)->exit\(\);)676 4628 y(panic\("exit)h(returned"\);)
598 4719 y(})1885 5255 y Fz(503)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
504 505 bop 639 523 a Fz(The)24 b(w)n(ork)f(is)h(actually)f(done)g(in)i
Fx(main)p Fz(.)34 b(It)24 b(calls)f Fx(upcall)f Fz(to)i(jump)g(to)g
(the)g(user)g(en)n(try)515 623 y(p)r(oin)n(t)g(without)g(argumen)n(ts.)
34 b(Hence,)25 b(space)e(for)g(the)h(up)r(call)g(return)f(tramp)r
(oline)g(is)h(righ)n(t)515 722 y(b)r(elo)n(w)j(the)h(giv)n(en)f(stac)n
(k)f(p)r(oin)n(ter)i(\(see)f(section)g(5.2.7)g(for)g(details\).)515
855 y Fk(h)p Fi(off)p 667 855 24 4 v 29 w(Shtl::main)i
Fj(implementation.)f Fk(i)p Fq(\021)598 946 y Fi(//)39
b(Starts)i(executing)g(shuttle)g(by)f(upcalling)h(to)f(upc)g(on)f(usp)h
(stack.)598 1038 y(void)g(off_Shtl::main\(off_mdepStck)45
b(usp,)40 b(register_t)i(upc\))598 1129 y({)676 1220
y(err_t)f(err;)676 1312 y(err=off_upcall\(usp,upc,0\);)676
1403 y(kcout)g(<<)e("shuttle)i(#")f(<<)g(get_id\(\))h(<<")f
(terminated.)h("<<)f(fmt\(")h(code)f(\045x\\n",err\);)598
1586 y(})515 1851 y Fk(h)p Fj(O\013)27 b(shuttle)i(implementation)f
(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 1943 y
Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40 b(for)g(panic,)g
(otsan)h(et)e(al.)598 2034 y(#include)i(<klib/mdep/mStck.h>)161
b(//)40 b(for)g(mdepStck)598 2125 y(#include)h(<prtl/upcall.h>)317
b(//)40 b(for)g(off_upcall)639 2267 y Fz(The)28 b(exit)g(routine)f
(simply)h(destro)n(ys)e(the)i(sh)n(uttle.)515 2383 y
Fk(h)p Fi(off)p 667 2383 V 29 w(Shtl::exit)h Fj(implementation.)f
Fk(i)p Fq(\021)598 2474 y Fi(//)39 b(This)i(shuttle)f(has)g
(terminated.)598 2565 y(void)g(off_Shtl::exit\(void\))598
2657 y({)676 2748 y(delete)h(this;)676 2839 y
(off_Processor::self\(\)->new_q)q(uantu)q(m\(\);)598
2931 y(})515 3088 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3088 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3180 y Fi(//)39 b(Deletes)i(the)f(shuttle)h(releasing)g
(its)f(resources.)598 3271 y(~off_Shtl\(void\);)515 3445
y Fk(h)p Fi(off)p 667 3445 V 29 w(Shtl::~off)p 1086 3445
V 30 w(Shtl)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3537 y Fi(off_Shtl::~off_Shtl\(void\))598 3628 y({)676
3719 y(terminated\(\);)676 3811 y(//)40 b(XXX)676 3902
y(//)g(call)g(to)g(every)g(property)h(w/)f(unset.)676
3993 y(//)g(upcall)g(to)g(the)g(user)g(w/)g(unused)g(exception.)598
4085 y(})1885 5255 y Fz(504)p eop
PStoPSsaved restore
%%Page: (506,507) 254
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
505 506 bop 515 523 a Fn(5.1.9)112 b(Con)m(text)37 b(switc)m(hing)515
676 y Fz(T)-7 b(o)41 b(switc)n(h)g(the)h(con)n(text)f(from)g(one)g(sh)n
(uttle)h(to)f(another)g(w)n(e)g(simply)g(call)g(prop)r(ert)n(y)515
776 y(handlers.)35 b(Note)23 b(ho)n(w)h(prede\014ned)f(prop)r(erties)g
(are)g(honored)g(last.)35 b(W)-7 b(e)25 b(do)e(not)h(care)f(ho)n(w)515
876 y(m)n(uc)n(h)28 b(time)g(it)h(tak)n(es)e(to)h(switc)n(h)g(ev)n(ery)
e(prop)r(ert)n(y)h(as)h(w)n(e)g(are)f(running)g(in)i(the)f(quan)n(tum)
515 975 y(of)f(the)h(en)n(tering)f(sh)n(uttle.)515 1108
y Fk(h)p Fi(off)p 667 1108 24 4 v 29 w(Shtl::switch)p
1164 1108 V 30 w(from)i Fj(implementation.)e Fk(i)p Fq(\021)598
1199 y Fi(//)39 b(Context)i(switches)g(from)f(another)h(shuttle.)598
1291 y(err_t)f(off_Shtl::switch_from\(off_Sht)q(l)45
b(*s\))598 1382 y({)676 1473 y(assert\(!is_yielding\(\))f(&&)c
(!is_blocked\(\)\);)676 1565 y(if)g(\(s\))g(s->stop\(\);)676
1656 y(run\(\);)676 1747 y(if)g(\(s_palloc\))755 1839
y(for)g(\(off_prop_t)h(p=s_palloc->get_nalloc\(\);)k(p--)40
b(>0;)g(\))833 1930 y(\(*s_palloc\)[p].pswitch\(get_id)q(\(\)\);)676
2113 y(handoff_uctx\(\);)676 2204 y(if)g(\(s\){)755 2295
y(s->s_mdep.switch_to\(&s_mdep\);)755 2387 y(return)g(EOK;)676
2478 y(})676 2569 y(else)g({)755 2661 y(s_mdep.switch_to\(\);)755
2752 y(return)g(EOK;)676 2843 y(})598 3026 y(})1885 5255
y Fz(505)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
506 507 bop 515 523 a Fn(5.1.10)112 b(Idle)37 b(sh)m(uttles)515
676 y Fz(When)28 b(run)f(queues)h(are)e(empt)n(y)-7 b(,)28
b(a)f(silly)h(idle)f(sh)n(uttle)h(is)g(run.)515 793 y
Fk(h)p Fj(O\013)f(Id)t(le)g(shuttle.)h Fk(i)p Fq(\021)598
884 y Fi(//)39 b(An)h(idle)g(shuttle.)598 975 y(class)g(off_Idle)h(:)f
(public)g(off_Shtl)h({)598 1066 y(protected:)676 1158
y(off_Idle\(const)i(off_Protection)f(&p,)1029 1249 y(const)f
(off_prtl_id_t)h(&domain,)1029 1340 y(void)e(\(*entry\)\(void\)\);)676
1432 y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 1432 24 4 v 29 w(Idle)p Fj(.)h Fk(i)598
1523 y Fi(};)598 1706 y(//)39 b(An)h(idle)g(shuttle)h(for)f(boot)g
(processors.)598 1797 y(class)g(off_IdleAtPrimary)j(:)d(public)g
(off_Idle)h({)598 1888 y(public:)676 1980 y(off_IdleAtPrimary\(const)k
(off_Protection)d(&p,)e(const)g(off_prtl_id_t)j(&domain\);)598
2071 y(};)598 2254 y(//)c(An)h(idle)g(shuttle)h(for)f(secondary)h
(processors.)598 2345 y(class)f(off_IdleAtSecondary)k(:)39
b(public)i(off_Idle)g({)598 2436 y(public:)676 2528 y
(off_IdleAtSecondary\(const)k(off_Protection)e(&p,)1461
2619 y(const)d(off_prtl_id_t)i(&domain\);)598 2710 y(};)515
2959 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 3051 y Fi(#include)41 b(<shtl/Shtl.h>)598
3142 y(#include)g(<hw/Processor.h>)639 3283 y Fz(F)-7
b(or)26 b(non-b)r(o)r(ot)g(pro)r(cessors)e(the)j(idle)g(sh)n(uttle)g
(will)g(simply)f(do)g(nothing)h(but)g(starting)515 3383
y(the)h(clo)r(c)n(k.)515 3516 y Fk(h)p Fj(O\013)f(Id)t(le)g(shuttle)i
(for)e(non-b)l(o)l(ot)j(pr)l(o)l(c)l(essor.)g Fk(i)p
Fq(\021)598 3607 y Fi(//)39 b(Idle)i(shuttle)f(main)h(loop)598
3698 y(void)f(off_idle\(void\))598 3790 y({)676 3881
y(off_Processor::self\(\)->self_)q(start)q(\(\);)676
3972 y(for\(;;\))755 4064 y(;)598 4155 y(})1885 5255
y Fz(506)p eop
PStoPSsaved restore
%%Page: (508,509) 255
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
507 508 bop 639 523 a Fz(F)-7 b(or)34 b(b)r(o)r(ot)g(pro)r(cessors,)g
(the)g(idle)h(sh)n(uttle)f(installs)g(b)n(y)g(hand)g(an)g(initial)g
(run)g(queue)515 623 y(for)29 b(OS)h(init)g(mo)r(dules)g(loaded)f(at)h
(b)r(o)r(ot)g(time)g(along)e(with)j(the)f(k)n(ernel)f(and)h(then)g(k)n
(eeps)515 722 y(doing)d(nothing.)515 855 y Fk(h)p Fj(O\013)g(Id)t(le)g
(shuttle)i(for)e(b)l(o)l(ot)i(pr)l(o)l(c)l(essor.)h Fk(i)p
Fq(\021)598 946 y Fi(#if)40 b(0)598 1038 y(void)g(s0main\(void\))598
1129 y({)676 1220 y(for)g(\(natural_t)i(c=0;)e(c<2000;)h(c++\){)755
1312 y(for)f(\(natural_t)h(i=0;)f(i<0x100000;)i(i++\))833
1403 y(;)755 1494 y(putchar\('z'\);)676 1586 y(})676
1677 y(kcout)f(<<)e("s0)h(terminated";)676 1768 y(nd.halt\(\);)598
1860 y(})598 1951 y(void)g(s1main\(void\))598 2042 y({)676
2134 y(for)g(\(natural_t)i(c=0;)e(c<2000;)h(c++\){)755
2225 y(for)f(\(natural_t)h(i=0;)f(i<0x100000;)i(i++\))833
2316 y(;)755 2408 y(putchar\('Z'\);)676 2499 y(})676
2590 y(kcout)f(<<)e("s1)h(terminated";)676 2682 y(nd.halt\(\);)598
2773 y(})598 2864 y(#endif)598 3047 y(void)g(off_root_idle\(void\))598
3138 y({)755 3230 y(kcout)g(<<)g("root_idle")h(<<)f(nl;)755
3321 y(off_Processor::self\(\)->self_sta)q(rt\(\))q(;)676
3412 y(#if)g(1)755 3504 y(nd.modstart\(\);)755 3595 y(kcout)g(<<)g
("modstat)h(returned?")g(<<)f(nl;)676 3686 y(#else)755
3778 y({)833 3869 y(off_GrowingRegion)j(*us0,*ks0,*us1,*ks1;)833
3960 y(off_Shtl)e(*s0,*s1;)833 4051 y(us0=kvm.create_kstack\("s0u"\);)
833 4143 y(ks0=kvm.create_kstack\("s0k"\);)833 4234 y
(us1=kvm.create_kstack\("s1u"\);)833 4325 y
(ks1=kvm.create_kstack\("s1k"\);)833 4417 y(s1=new)g
(off_Shtl\(nd.get_protection\(\),n)q(d.get)q(_dom)q(ain\(\))q(,\(re)q
(gist)q(er_t\))q(s1ma)q(in,)1147 4508 y(us1->get_start\(\),)1147
4599 y(ks1->get_start\(\),)i(off_Shtl::self\(\)\);)833
4691 y(s0=new)e(off_Shtl\(nd.get_protection\(\),n)q(d.get)q(_dom)q
(ain\(\))q(,\(re)q(gist)q(er_t\))q(s0ma)q(in,)1147 4782
y(us0->get_start\(\),)1147 4873 y(ks0->get_start\(\),)i
(off_Shtl::self\(\)\);)833 4965 y(s0->unblock\(\);)1885
5255 y Fz(507)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
508 509 bop 833 523 a Fi(s1->unblock\(\);)833 614 y(printf\("s0u)42
b(\045x)e(s0k)f(\045x)h(s0)g(\045x",)g(us0->get_start\(\),ks0->get_sta)
q(rt\(\),)951 706 y(\(register_t\)s0\);)833 797 y(printf\("\\nshtl)j(1)
c(at)h(\045x)f(shtl)h(0)g(at)g(\045x",\(register_t\)s1,\(register_t\))q
(s0\);)833 888 y(kcout)g(<<")g("<<)g(s0->get_id\(\))i(<<)e(nl;)833
980 y(new\(off_Processor::self\(\)\))45 b
(off_RunqSlot\(nd.get_protecti)q(on\(\))q(,)1618 1071
y(nd.get_domain\(\),)1618 1162 y(s0->get_id\(\)\);)833
1345 y(new\(off_Processor::self\(\)\))g(off_RunqSlot\(nd.get_protecti)q
(on\(\))q(,)1618 1436 y(nd.get_domain\(\),)1618 1528
y(s1->get_id\(\)\);)755 1710 y(})755 1802 y(kcout)40
b(<<)g(nl;)755 1893 y(kcout)g(<<)g(fmt\("\045d)h
(",nd.get_proc\(\).get_irqs\(\)->get)q(_coun)q(t\(\)\))46
b(<<)40 b("irqs")g(<<)g(nl;)755 1984 y(extern)g(long)g
(off_mdep_intr_count;)755 2167 y(kcout)g(<<)g(fmt\("\045d)h
(",off_mdep_intr_count\))j(<<)39 b("count")i(<<)f(nl;)598
2258 y(#endif)755 2350 y(for\(;;\))833 2441 y(;)755 2532
y(kcout)g(<<)g("Root)g(idle)g(terminated?")i(<<nl;)755
2623 y(nd.halt\(\);)598 2715 y(})515 2980 y Fk(h)p Fj(O\013)27
b(Id)t(le)g(shuttle)i(implementation)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3072 y Fi(#include)41 b(<hw/Processor.h>)278
b(//)40 b(for)g(off_Processor)i(and)e(self)598 3163 y(#include)h
(<node/Node.h>)395 b(//)40 b(for)g(nd)639 3304 y Fz(The)28
b(classes)e(de\014ned)i(ab)r(o)n(v)n(e)e(simply)i(automate)f(the)h
(creation)f(of)g(idle)h(sh)n(uttles.)515 3421 y Fk(h)p
Fi(off)p 667 3421 24 4 v 29 w(Idle::off)p 1047 3421 V
30 w(Idle)g Fj(implementation.)g Fk(i)p Fq(\021)598 3512
y Fi(off_Idle::off_Idle\(const)44 b(off_Protection)f(&p,)1343
3603 y(const)d(off_prtl_id_t)j(&domain,)1343 3694 y(void)d
(\(*entry\)\(void\)\))j(:)676 3786 y(off_Shtl\(p,domain,\(register_)q
(t\)ent)q(ry,c)q(reat)q(e_stc)q(k\(\),)q(creat)q(e_ks)q(tck\()q(\),NUL)
q(L\))598 3877 y({;})515 4035 y Fk(h)p Fi(off)p 667 4035
V 29 w(IdleAtPrimary::off)p 1398 4035 V 32 w(IdleAtPrimary)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 4126 y Fi
(off_IdleAtPrimary::off_IdleAtP)q(rimar)q(y\(co)q(nst)46
b(off_Protection)c(&p,)2049 4218 y(const)f(off_prtl_id_t)h(&domain\):)
676 4309 y(off_Idle\(p,domain,off_root_i)q(dle\))598
4400 y({)676 4491 y(do_debug\(putchar\('Z'\)\);)598 4583
y(})1885 5255 y Fz(508)p eop
PStoPSsaved restore
%%Page: (510,511) 256
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
509 510 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(IdleAtSecondary::off)p 1476 523 V 32 w(IdleAtSecondary)31
b Fj(implementation.)d Fk(i)p Fq(\021)598 614 y Fi
(off_IdleAtSecondary::off_IdleA)q(tSeco)q(ndar)q(y\(co)q(nst)45
b(off_Protection)e(&p,)2206 706 y(const)d(off_prtl_id_t)j(&domain\):)
676 797 y(off_Idle\(p,domain,off_idle\))598 888 y({)676
980 y(do_debug\(putchar\('z'\)\);)598 1071 y(})515 1245
y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1245 V 29 w(Idle)p Fj(.)h Fk(i)o Fq(\021)598
1337 y Fi(//)39 b(Creates)i(a)f(user)g(stack.)598 1428
y(static)g(register_t)i(create_stck\(void\);)515 1602
y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 1602 V 29 w(Idle)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 1694 y Fi(//)39 b(Creates)i(a)f(kernel)g(stack)h(for)f(an)f
(idle)h(shuttle.)598 1785 y(static)g(register_t)i
(create_kstck\(void\);)515 1959 y Fk(h)p Fi(off)p 667
1959 V 29 w(Idle::create)p 1164 1959 V 30 w(stck)29 b
Fj(implementation.)e Fk(i)p Fq(\021)598 2051 y Fi(//)39
b(Creates)i(a)f(user)g(stack.)598 2142 y(register_t)h
(off_Idle::create_stck\(void\))598 2233 y({)676 2325
y(off_GrowingRegion)i(*r=kvm.create_kstack\("idle_u)q(stck)q("\);)676
2416 y(return)e(r->get_start\(\);)598 2507 y(})515 2682
y Fk(h)p Fi(off)p 667 2682 V 29 w(Idle::create)p 1164
2682 V 30 w(kstck)29 b Fj(implementation.)f Fk(i)o Fq(\021)598
2773 y Fi(//)39 b(Creates)i(a)f(kernel)g(stack)h(for)f(an)f(idle)h
(shuttle.)598 2864 y(register_t)h(off_Idle::create_kstck\(void\))598
2956 y({)676 3047 y(off_GrowingRegion)i(*r=kvm.create_kstack\("idle_k)q
(stck)q("\);)676 3138 y(return)e(r->get_start\(\);)598
3230 y(})515 3495 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle)i
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
3587 y Fi(#include)41 b(<dmm/KVM.h>)515 3860 y Fn(5.1.11)112
b(Sh)m(uttle)37 b(na)m(vigation)g(and)h(insp)s(ection)722
4014 y FA(NOTE:)55 b Fz(Not)27 b(y)n(et)h(implemen)n(ted)515
4230 y FA(Sh)m(uttle)k(serv)m(er)g(na)m(vigation)515
4374 y Fk(h)p Fj(Other)c(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4374 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4466 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f(ShtlSrvs.)598
4557 y(off_Navigator)i(*get_navigator\(void\))i({)39
b(return)i(NULL;)f(})515 4731 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g
(dep)l(endencies.)h Fk(i)o Fz(+)p Fq(\021)598 4823 y
Fi(#include)41 b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)i(et)d
(al.)1885 5255 y Fz(509)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
510 511 bop 515 523 a FA(Sh)m(uttle)32 b(serv)m(er)g(insp)s(ection)515
676 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)e(to)i(implemen)n(t)g(these)f(t)n(w)n
(o)g(metho)r(ds.)515 793 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 793 24 4 v 29 w(ShtlSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 884 y Fi(//)39 b(Get)h(the)g(ShtlSrv)h(URL.)598
975 y(const)f(char)g(*get_url\(void\);)598 1066 y(//)f(Returns)i(the)f
(ShtlSrv)h(name.)598 1158 y(const)f(char)g(*nameof\(void\);)639
1282 y Fz(The)e(URL)f(for)g(a)g(sh)n(uttle)g(serv)n(er)e(is)i(that)h
(of)f(its)g(no)r(de)h(with)f Fx(shtlsrv.html)c Fz(ap-)515
1382 y(p)r(ended.)k(W)-7 b(e)27 b(use)f(a)g(new)h(mem)n(b)r(er,)f(a)g
(c)n(haracter)f(arra)n(y)f(initialized)i(the)h(v)n(ery)e(\014rst)i
(time)515 1482 y(it)h(is)f(needed.)515 1598 y Fk(h)p
Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p 1552
1598 V 29 w(ShtlSrv)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
1689 y Fi(static)40 b(char)g(*s_url;)512 b(//)40 b(URL)g(for)g(this)g
(ShtlSrv.)639 1814 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 1930 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(static)g(memb)l
(ers.)f Fk(i)p Fz(+)p Fq(\021)598 2021 y Fi(char)40 b
(*off_ShtlSrv::s_url=NULL;)84 b(//)40 b(URL)g(for)g(this)g(ShtlSrv.)515
2179 y Fk(h)p Fi(off)p 667 2179 V 29 w(ShtlSrv::get)p
1164 2179 V 30 w(url)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2270 y Fi(//)39 b(Get)h(the)g(ShtlSrv)h(URL.)598
2362 y(const)f(char)g(*off_ShtlSrv::get_url\(void\))598
2453 y({)676 2544 y(assert\(valid\(\)\);)676 2636 y(if)g(\(!s_url\){)
755 2727 y(s_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q
(FF_S)q(HTLSR)q(V_UR)q(L\)+1)q(];)k(//+1)40 b(for)g(\\0)755
2818 y(if)f(\(s_url\){)833 2910 y(strcpy\(s_url,nd.get_url\(\)\);)833
3001 y(strcat\(s_url,OFF_SHTLSRV_URL\))q(;)755 3092 y(})676
3184 y(})676 3275 y(return)i(s_url;)598 3366 y(})639
3599 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(sh)n(uttle)f(serv)n(ers.)515 3715 y
Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e
Fk(i)p Fq(\021)598 3806 y Fi(const)40 b(char)g
(OFF_SHTLSRV_URL[]="/shtlsrv.)q(html)q(";)515 3964 y
Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(dep)l(endencies.)h
Fk(i)o Fz(+)p Fq(\021)598 4055 y Fi(#include)41 b(<klib/url.h>)434
b(//)40 b(for)g(OFF_SHTLSRV_URL)515 4230 y Fk(h)p Fj(O\013)27
b(shuttle)i(server)g(implementation)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 4321 y Fi(#include)41 b(<string.h>)512
b(//)40 b(for)g(strcat)g(strdup)h(et)e(al)598 4412 y(#include)i
(<node/Node.h>)395 b(//)40 b(for)g(nd)1885 5255 y Fz(510)p
eop
PStoPSsaved restore
%%Page: (512,513) 257
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
511 512 bop 639 523 a Fz(The)32 b(name)g(for)f(sh)n(uttle)h(serv)n(er)e
(is)i(that)g(of)g(its)g(no)r(de)g(complemen)n(ted)g(with)g(a)f(little)
515 623 y(su\016x.)37 b(The)27 b(implemen)n(tation)h(is)f(almost)g(the)
h(same)f(of)h Fx(get)p 2464 623 27 4 v 30 w(url)p Fz(.)515
748 y Fk(h)p Fi(off)p 667 748 24 4 v 29 w(ShtlSrv::nameof)i
Fj(implementation.)e Fk(i)p Fq(\021)598 839 y Fi(//)39
b(Returns)i(the)f(shuttle)h(server)g(name.)598 930 y(const)f(char)g
(*off_ShtlSrv::nameof\(void\))598 1022 y({)676 1113 y
(assert\(valid\(\)\);)676 1204 y(if)g(\(!s_name\){)755
1296 y(s_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q(\("/s)q
(htlsr)q(v"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755
1387 y(if)f(\(s_name\){)833 1478 y(char)h(number[9];)833
1570 y(strcpy\(s_name,nd.nameof\(\)\);)833 1661 y
(strcat\(s_name,"/shtlsrv"\);)833 1752 y
(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q(id\(\)\))q(;)833
1844 y(strcat\(s_name,number\);)755 1935 y(})676 2026
y(})676 2118 y(return)h(s_name;)598 2209 y(})515 2459
y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p
1552 2459 V 29 w(ShtlSrv)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
2551 y Fi(char)40 b(*s_name;)708 b(//)39 b(name)i(for)f(this)g
(ShtlSrv.)515 2710 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)
h(memb)l(ers)f(of)e Fi(off)p 1928 2710 V 29 w(ShtlSrv)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 2801 y Fi(s_name\(NULL\))515
2960 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2960 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3051 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(ShtlSrv.)598
3142 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})515 3389 y FA(Sh)m(uttle)32 b(insp)s(ection)515
3534 y Fk(h)p Fj(Other)c(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3534 V 29 w(Shtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3625 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(Shtl.)598
3716 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})639 3850 y Fz(W)-7 b(e)19 b(need)g
Fx(get)p 1095 3850 27 4 v 30 w(rurl)d Fz(and)j Fx(get)p
1602 3850 V 30 w(url)p 1764 3850 V 30 w(holder)d Fz(for)i(sh)n(uttles)g
(to)g(supp)r(ort)h Fx(ResUnit::get)p 3409 3850 V 26 w(url)p
Fz(.)515 3975 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e
(of)e Fi(off)p 1594 3975 24 4 v 29 w(Shtl)p Fj(.)h Fk(i)o
Fz(+)p Fq(\021)598 4066 y Fi(//)39 b(Get)h(the)g(shtl)g(url)598
4158 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)
g(OFF_SHTL_URL;)i(})598 4249 y(//)d(Returns)i(the)f(shtl)g(name.)598
4340 y(virtual)h(char)f(*&get_url_holder\(void\);)639
4474 y Fz(He)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(relativ)n(e)e(URL)
i(for)f(sh)n(uttles)515 4586 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l
(de)g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 4677 y Fi(const)40
b(char)g(OFF_SHTL_URL[]="#Shtl";)515 4824 y Fk(h)p Fj(O\013)27
b(shuttle)i(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598
4915 y Fi(#include)41 b(<klib/url.h>)434 b(//)40 b(for)g(OFF_SHTL_URL)
598 5006 y(#include)h(<stdio.h>)551 b(//)40 b(for)g(sprintf)g(et)g(al)
1885 5255 y Fz(511)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
512 513 bop 639 523 a Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g(sh)n
(uttles.)515 639 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 639 24 4 v 29 w(Shtl)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 731 y Fi(static)40 b(char)g(*s_url;)512 b(//)40
b(URL)g(for)g(this)g(shtl.)515 888 y Fk(h)p Fi(off)p
667 888 V 29 w(Shtl::get)p 1047 888 V 30 w(url)p 1194
888 V 29 w(holder)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
980 y Fi(char)40 b(*&off_Shtl::get_url_holder\(voi)q(d\))45
b({)79 b(return)41 b(s_url;)f(})639 1212 y Fz(Initially)28
b(it)g(is)f(empt)n(y)-7 b(.)515 1328 y Fk(h)p Fj(O\013)27
b(shuttle)i(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598
1420 y Fi(char)40 b(*off_Shtl::s_url=NULL;)123 b(//)39
b(URL)h(for)g(shtl.)515 1677 y Fn(5.1.12)112 b(F)-9 b(rozen)38
b(sh)m(uttles)722 1830 y FA(NOTE:)55 b Fz(Not)27 b(y)n(et)h(implemen)n
(ted)515 2046 y FA(F)-8 b(reezing)31 b(sh)m(uttle)h(serv)m(ers)515
2191 y Fk(h)p Fj(Other)c(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2191 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 2282 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
2374 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 2465 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2556 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2648
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 2739
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
2830 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
2922 y(return)e(ENOSYS;)598 3013 y(})598 3196 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
3287 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 3378 y(\(void\)curto;)h(\(void\)toavail;)
676 3470 y(return)f(ENOSYS;)598 3561 y(})1885 5255 y
Fz(512)p eop
PStoPSsaved restore
%%Page: (514,515) 258
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
513 514 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(ShtlSrv)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(//)39 b(These)i(are)f(for)g(melt:)
598 706 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 797 y(//)f(return.)598
888 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
980 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1071 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 1162 y(\(void\)buf;)h
(\(void\)bsize;)676 1254 y(return)f(ENOSYS;)598 1345
y(})598 1436 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
1528 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 1619 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 1710 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
1802 y(return)f(ENOSYS;)598 1893 y(})515 2242 y FA(F)-8
b(reezing)31 b(sh)m(uttles)515 2386 y Fk(h)p Fj(Other)d(pr)l(ote)l(cte)
l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 2386 V 29 w(Shtl)p
Fj(.)h Fk(i)o Fz(+)p Fq(\021)598 2478 y Fi(//)39 b(These)i(are)f(for)g
(freeze:)598 2569 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g
(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 2660 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2752 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2843
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 2934
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
3026 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
3117 y(return)e(ENOSYS;)598 3208 y(})598 3391 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
3482 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 3574 y(\(void\)curto;)h(\(void\)toavail;)
676 3665 y(return)f(ENOSYS;)598 3756 y(})1885 5255 y
Fz(513)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
514 515 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(Shtl)p Fj(.)h
Fk(i)o Fz(+)p Fq(\021)598 614 y Fi(//)39 b(These)i(are)f(for)g(melt:)
598 706 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 797 y(//)f(return.)598
888 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
980 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1071 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 1162 y(\(void\)buf;)h
(\(void\)bsize;)676 1254 y(return)f(ENOSYS;)598 1345
y(})598 1436 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
1528 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 1619 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)637 1710 y(\(void\)buf;)e(\(void\)bsize;)h
(\(void\)from;)g(\(void\)size;)g(\(void\)melted_domain;)676
1802 y(return)f(ENOSYS;)598 1893 y(})515 2258 y Fn(5.1.13)112
b(Dumping)37 b(Sh)m(uttles)515 2411 y Fz(T)-7 b(o)27
b(dump)h(a)f(sh)n(uttle)h(serv)n(er)e(w)n(e)h(use)h(this)g(op)r
(erator.)515 2528 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2528 V 29 w(ShtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 2619 y Fi(//)39 b(Dumps)i(shtl)f(state.)598
2710 y(friend)g(OStr)g(&operator<<\(OStr)j(&s,)79 b(off_ShtlSrv)42
b(&sh\);)515 2868 y Fk(h)p Fi(off)p 667 2868 V 29 w
(ShtlSrv::operator<<)31 b Fj(implementation.)d Fk(i)p
Fq(\021)598 2959 y Fi(//)39 b(Dumps)i(shtl)f(state.)598
3051 y(OStr)g(&operator<<\(OStr)j(&s,)79 b(off_ShtlSrv)42
b(&sh\))598 3142 y({)676 3233 y(s)e(<<)f(*\(off_HWCompResource*\)&sh;)
676 3325 y(s)h(<<)f("name=")i(<<)f(sh.nameof\(\))i(<<)d(")h(url=")g(<<)
g(sh.get_url\(\))i(<<)d(nl;)676 3416 y(return)i(s;)598
3507 y(})515 3773 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598
3864 y Fi(#include)41 b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f
(al.)1885 5255 y Fz(514)p eop
PStoPSsaved restore
%%Page: (516,517) 259
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
515 516 bop 515 523 a Fn(5.1.14)112 b(Sh)m(uttles)37
b(for)g(plain)g(users)515 668 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g
(for)f(users.)g Fk(i)p Fq(\021)598 759 y Fi(class)40
b(off_uShtlSrv)i(:)e(public)g(off_uAbsCompResource)k({)598
851 y(public:)598 942 y(#ifdef)c(__KERNEL__)676 1033
y(off_uShtlSrv\(off_ShtlSrv)45 b(*r\):)40 b(off_uAbsCompResource\(r\))k
({;})676 1125 y(off_uShtlSrv\(off_ShtlSrv)h(&r\):)40
b(off_uAbsCompResource\(&r\))45 b({;})598 1216 y(#endif)676
1307 y(off_uShtlSrv\(void\))f({;})676 1399 y(off_uShtlSrv\(const)g
(off_id_t)d(&id\):)f(off_uAbsCompResource\(id\))45 b({;})598
1581 y(#ifndef)c(__KERNEL__)676 1673 y Fk(h)p Fj(O\013)27
b(shuttle)i(server)h(for)d(users)i(metho)l(ds.)g Fk(i)598
1855 y Fi(#endif)598 2038 y(};)515 2353 y FA(allo)s(c)41
b Fz(Allo)r(cates)27 b(a)g(sh)n(uttle)h(at)f(a)g(giv)n(en)g(p)r
(osition.)37 b(Receiv)n(es:)822 2519 y Fq(\017)k Fz(The)28
b(desired)f(id,)h Fx(at)p Fz(.)822 2652 y Fq(\017)41
b Fz(Protection)26 b Fx(p)h Fz(and)h Fx(domain)d Fz(for)i(the)h(new)g
(sh)n(uttle.)822 2785 y Fq(\017)41 b Fz(User)27 b(en)n(try)g(p)r(oin)n
(t)h Fx(pc)p Fz(.)822 2918 y Fq(\017)41 b Fz(User)27
b(stac)n(k)g Fx(sp)p Fz(.)822 3051 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(domain)f
Fx(dr)p Fz(.)822 3184 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(righ)n(ts)h(for)g(the)h(sh)n(uttle)g(serv)n(er)d
Fx(r)p Fz(.)722 3316 y Fk(h)p Fj(O\013)i(shuttle)i(server)h(for)d
(users)i(metho)l(ds.)g Fk(i)p Fq(\021)805 3408 y Fi(//)40
b(Allocates)h(a)f(shuttle.)805 3499 y(off_uShtl)i(alloc\(const)f
(off_shtl_id_t)i(&at,)1119 3590 y(off_Protection)g(p,)1119
3682 y(off_prtl_id_t)82 b(domain,)1119 3773 y(void)433
b(*pc,)1119 3864 y(void)g(*sp,)1119 3956 y(off_Rights)42
b(dr,)1119 4047 y(off_Rights)g(r\){)884 4138 y(off_shtlsrv_allocat_req)
i(req\(at,p,domain,pc,sp,dr,r\);)884 4230 y(off_shtlsrv_allocat_rep)g
(rep;)884 4321 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q
(f\(re)q(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
4412 y(if)f(\(err)i(||)e(rep.m_err\))962 4504 y
(errno=\(err\)?err:rep.m_err;)884 4595 y(return)h(rep.res;)805
4686 y(})1885 5255 y Fz(515)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
516 517 bop 722 523 a Fk(h)p Fj(O\013)27 b(shuttle)i(server)h
(messages.)f Fk(i)p Fq(\021)805 614 y Fi(#define)41 b
(OFF_MSG_SHTLSRV_ALLOCAT)k(0x01f)884 706 y(struct)40
b(off_shtlsrv_allocat_req:)45 b(public)c(off_KernReq)g({)962
797 y(off_shtl_id_t)82 b(id;)962 888 y(off_Protection)43
b(prot;)962 980 y(off_prtl_id_t)82 b(dom;)962 1071 y(void)393
b(*upc;)962 1162 y(void)g(*usp;)962 1254 y(off_Rights)199
b(dright;)962 1345 y(off_shtlsrv_allocat_req\(cons)q(t)45
b(off_shtl_id_t)d(&at,)1904 1436 y(off_Protection)g(p,)1904
1528 y(off_prtl_id_t)81 b(domain,)1904 1619 y(void)432
b(*pc,)1904 1710 y(void)g(*sp,)1904 1802 y(off_Rights)41
b(dr,)1904 1893 y(off_Rights)g(r\):)1041 1984 y
(id\(at\),prot\(p\),dom\(domain\),upc)q(\(pc\),)q(usp\()q(sp\),d)q
(righ)q(t\(dr)q(\),)1041 2076 y(off_KernReq\(OFF_MSG_SHTLSRV_AL)q
(LOCAT)q(,r\))46 b({;})884 2167 y(};)884 2258 y(struct)40
b(off_shtlsrv_allocat_rep:)45 b(public)c(off_KernRep)g({)962
2350 y(off_shtl_id_t)h(res;)962 2441 y(off_shtlsrv_allocat_rep\(err_)q
(t)j(r=0\))40 b(:)g(off_KernRep\(r\))i({;})884 2532 y(};)515
2864 y FA(allo)s(c)f Fz(Allo)r(cates)27 b(a)g(sh)n(uttle.)37
b(Receiv)n(es:)822 3030 y Fq(\017)k Fz(Protection)26
b Fx(p)h Fz(and)h Fx(domain)d Fz(for)i(the)h(new)g(sh)n(uttle.)822
3163 y Fq(\017)41 b Fz(User)27 b(en)n(try)g(p)r(oin)n(t)h
Fx(pc)p Fz(.)822 3296 y Fq(\017)41 b Fz(User)27 b(stac)n(k)g
Fx(sp)p Fz(.)822 3429 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(righ)n(ts)h(for)g(the)h(domain)f Fx(dr)p Fz(.)822
3562 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)
h(sh)n(uttle)g(serv)n(er)d Fx(r)p Fz(.)722 3694 y Fk(h)p
Fj(O\013)i(shuttle)i(server)h(for)d(users)i(metho)l(ds.)g
Fk(i)p Fz(+)o Fq(\021)805 3786 y Fi(//)40 b(Allocates)h(any)f(shuttle.)
805 3877 y(off_uShtl)i(alloc\(off_Protection)h(p,)1119
3968 y(off_prtl_id_t)82 b(domain,)1119 4060 y(void)433
b(*pc,)1119 4151 y(void)g(*sp,)1119 4242 y(off_Rights)42
b(dr,)1119 4334 y(off_Rights)g(r\){)884 4425 y(off_shtlsrv_alloc_req)i
(req\(p,domain,pc,sp,dr,r\);)884 4516 y(off_shtlsrv_alloc_rep)g(rep;)
884 4608 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
4699 y(if)f(\(err)i(||)e(rep.m_err\))962 4790 y
(errno=\(err\)?err:rep.m_err;)884 4882 y(return)h(rep.res;)805
4973 y(})1885 5255 y Fz(516)p eop
PStoPSsaved restore
%%Page: (518,519) 260
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
517 518 bop 722 523 a Fk(h)p Fj(O\013)27 b(shuttle)i(server)h
(messages.)f Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_SHTLSRV_ALLOC)j(0x02f)884 706 y(struct)c
(off_shtlsrv_alloc_req:)45 b(public)40 b(off_KernReq)i({)962
797 y(off_Protection)h(prot;)962 888 y(off_prtl_id_t)82
b(dom;)962 980 y(void)393 b(*upc;)962 1071 y(void)g(*usp;)962
1162 y(off_Rights)199 b(dright;)962 1254 y
(off_shtlsrv_alloc_req\(off_Pr)q(otec)q(tion)46 b(p,)1825
1345 y(off_prtl_id_t)82 b(domain,)1825 1436 y(void)433
b(*pc,)1825 1528 y(void)g(*sp,)1825 1619 y(off_Rights)42
b(dr,)1825 1710 y(off_Rights)g(r\):)1041 1802 y
(prot\(p\),dom\(domain\),upc\(pc\),us)q(p\(sp\))q(,dri)q(ght\(d)q(r\),)
1041 1893 y(off_KernReq\(OFF_MSG_SHTLSRV_AL)q(LOC,r)q(\))j({;})884
1984 y(};)884 2076 y(struct)40 b(off_shtlsrv_alloc_rep:)45
b(public)40 b(off_KernRep)i({)962 2167 y(off_shtl_id_t)g(res;)962
2258 y(off_shtlsrv_alloc_rep\(err_t)k(r=0\))40 b(:)f(off_KernRep\(r\))k
({;})884 2350 y(};)515 2590 y FA(free)e Fz(Deallo)r(cates)27
b(a)g(sh)n(uttle.)37 b(Receiv)n(es:)822 2756 y Fq(\017)k
Fz(The)28 b(sh)n(uttle)f(id)h Fx(s)p Fz(.)822 2889 y
Fq(\017)41 b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h(sh)n
(uttle)g Fx(r)p Fz(.)722 3022 y Fk(h)p Fj(O\013)f(shuttle)i(server)h
(for)d(users)i(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805
3113 y Fi(//)40 b(Deallocates)i(a)d(shuttle)805 3205
y(void)h(free\()h(off_uShtl)g(s,)f(off_Rights)h(r\){)884
3296 y(off_shtlsrv_free_req)j(req\(s.get_id\(\),r\);)884
3387 y(off_shtlsrv_free_rep)g(rep;)884 3479 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 3570 y(if)f(\(err)i(||)e
(rep.m_err\))962 3661 y(errno=\(err\)?err:rep.m_err;)805
3753 y(})722 4051 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)h(messages.)f
Fk(i)p Fz(+)o Fq(\021)805 4143 y Fi(#define)41 b(OFF_MSG_SHTLSRV_FREE)j
(0x03f)884 4234 y(struct)c(off_shtlsrv_free_req:)k(public)d
(off_KernReq)h({)962 4325 y(off_shtl_id_t)82 b(id;)962
4417 y(off_shtlsrv_free_req\(off_sht)q(l_id)q(_t)45 b(s,)40
b(off_Rights)h(r\):)f(id\(s\),)1041 4508 y
(off_KernReq\(OFF_MSG_SHTLSRV_FR)q(EE,r\))46 b({;})884
4599 y(};)884 4691 y(struct)40 b(off_shtlsrv_free_rep:)k(public)d
(off_KernRep)h({)962 4782 y(off_shtlsrv_free_rep\(err_t)j(r=0\))c(:)e
(off_KernRep\(r\))j({;})884 4873 y(};)1885 5255 y Fz(517)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
518 519 bop 515 523 a FA(self)40 b Fz(Returns)25 b(an)g(iden)n
(ti\014er)g(whic)n(h)g(will)h(act)e(as)h(the)g(curren)n(t)g(sh)n(uttle)
g(iden)n(ti\014er.)36 b(It)25 b(is)g(a)722 623 y(fak)n(e)i(iden)n
(ti\014er)g(only)g(in)n(tended)h(to)g(allo)n(w)e(calls)h(for)g(the)g
(curren)n(t)g(sh)n(uttle)h(without)722 722 y(kno)n(wing)f(its)h(iden)n
(ti\014er.)722 839 y Fk(h)p Fj(O\013)f(shuttle)i(server)h(for)d(users)i
(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)884 930 y Fi(inline)40
b(off_uShtl)i(self\(void\))f({)f(return)g(off_id_t\(get_id\(\),0\);)k
(})515 1162 y Fk(h)p Fj(uShtlSrv.h*)11 b Fk(i)q Fq(\021)598
1254 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(messages.)g
Fk(i)598 1345 y(h)p Fj(O\013)e(shuttle)i(server)g(for)f(users.)g
Fk(i)515 1611 y(h)p Fj(O\013)f(shuttle)i(for)e(users.)i
Fk(i)p Fq(\021)598 1702 y Fi(class)40 b(off_uShtl)h(:)f(public)g
(off_uAbsResUnit)j({)598 1793 y(public:)598 1885 y(#ifdef)d(__KERNEL__)
676 1976 y(off_uShtl\(off_Shtl)k(*r\):)c(off_uAbsResUnit\(r\))j({;})676
2067 y(off_uShtl\(off_Shtl)h(&r\):)c(off_uAbsResUnit\(&r\))j({;})598
2159 y(#endif)676 2250 y(off_uShtl\(void\))g({;})676
2341 y(off_uShtl\(const)g(off_id_t)e(&id\):)f(off_uAbsResUnit\(id\))k
({;})598 2524 y(#ifndef)d(__KERNEL__)676 2615 y Fk(h)p
Fj(O\013)27 b(shuttle)i(for)f(users)h(metho)l(ds.)f Fk(i)598
2798 y Fi(#endif)598 2980 y(};)515 3205 y FA(getnprops)41
b Fz(Returns)27 b(the)h(n)n(um)n(b)r(er)g(of)f(prop)r(erties.)36
b(Receiv)n(es:)822 3371 y Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)
f(for)h(the)h(sh)n(tl)g Fx(r)p Fz(.)722 3504 y Fk(h)p
Fj(O\013)f(shuttle)i(for)f(users)h(metho)l(ds.)f Fk(i)p
Fq(\021)805 3595 y Fi(//)40 b(How)g(many)g(properties)i(defined?)805
3686 y(natural_t)g(get_nprops\(off_Rights)i(r\))79 b({)884
3778 y(off_shtl_get_nprops_req)44 b(req\(w_p,r\);)884
3869 y(off_shtl_get_nprops_rep)g(rep;)884 3960 y(err_t)c
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1786
4051 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
4143 y(if)f(\(err)i(||)e(rep.m_err\))962 4234 y
(errno=\(err\)?err:rep.m_err;)884 4325 y(return)h(rep.res;)805
4417 y(})1885 5255 y Fz(518)p eop
PStoPSsaved restore
%%Page: (520,521) 261
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
519 520 bop 722 523 a Fk(h)p Fj(O\013)27 b(shuttle)i(messages.)g
Fk(i)p Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_SHTL_GET_NPROPS)k
(0x011f)884 706 y(struct)40 b(off_shtl_get_nprops_req:)45
b(public)c(off_ObjKernReq)h({)962 797 y(off_shtl_get_nprops_req\(off_)q
(id_t)k(me,)40 b(off_Rights)h(r\))f(:)1041 888 y
(off_ObjKernReq\(me,OFF_MSG_SHTL)q(_GET_)q(NPRO)q(PS,r\))q({;})884
980 y(};)884 1071 y(struct)g(off_shtl_get_nprops_rep:)45
b(public)c(off_KernRep)g({)962 1162 y(boolean_t)g(res;)962
1254 y(off_shtl_get_nprops_rep\(err_)q(t)k(r=0\))40 b(:)g
(off_KernRep\(r\))i({;})884 1345 y(};)515 1586 y FA(getprop)f
Fz(Returns)27 b(the)h(v)-5 b(alue)28 b(of)g(a)f(prop)r(ert)n(y)-7
b(.)36 b(Receiv)n(es:)822 1752 y Fq(\017)41 b Fz(The)28
b(prop)r(ert)n(y)e(n)n(um)n(b)r(er)h Fx(p)p Fz(.)822
1885 y Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h(sh)n
(tl)g Fx(r)p Fz(.)722 2017 y Fk(h)p Fj(O\013)f(shuttle)i(for)f(users)h
(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805 2109 y Fi(//)40
b(Gets)g(the)g(value)g(for)g(a)g(given)g(property.)805
2200 y(off_id_t)h(get_prop\(off_prop_t)j(p,)c(off_Rights)h(r\))f({)884
2291 y(off_shtl_get_prop_req)k(req\(w_p,p,r\);)884 2383
y(off_shtl_get_prop_rep)g(rep;)884 2474 y(err_t)c
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1315
2565 y(sizeof\(req\),sizeof\(rep\),&req)q(,&re)q(p,0\);)884
2657 y(if)f(\(err)i(||)e(rep.m_err\))962 2748 y
(errno=\(err\)?err:rep.m_err;)884 2839 y(return)h(rep.res;)805
3022 y(})722 3321 y Fk(h)p Fj(O\013)27 b(shuttle)i(messages.)g
Fk(i)p Fz(+)p Fq(\021)805 3412 y Fi(#define)41 b(OFF_MSG_SHTL_GET_PROP)
j(0x012f)884 3504 y(struct)c(off_shtl_get_prop_req:)45
b(public)40 b(off_ObjKernReq)j({)962 3595 y(off_prop_t)f(prop;)962
3686 y(off_shtl_get_prop_req\(off_id)q(_t)j(me,)40 b(off_prop_t)i(p,)d
(off_Rights)j(r\))e(:)f(prop\(p\),)1041 3778 y
(off_ObjKernReq\(me,OFF_MSG_SHTL)q(_GET_)q(PROP)q(,r\))45
b({;})884 3869 y(};)884 3960 y(struct)40 b(off_shtl_get_prop_rep:)45
b(public)40 b(off_KernRep)i({)962 4051 y(off_id_t)f(res;)962
4143 y(off_shtl_get_prop_rep\(err_t)46 b(r=0\))40 b(:)f
(off_KernRep\(r\))k({;})884 4234 y(};)1885 5255 y Fz(519)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
520 521 bop 515 523 a FA(setprop)41 b Fz(Sets)28 b(the)g(v)-5
b(alue)27 b(for)g(a)g(prop)r(ert)n(y)-7 b(.)36 b(Receiv)n(es:)822
689 y Fq(\017)41 b Fz(The)28 b(prop)r(ert)n(y)e(id)i
Fx(p)p Fz(.)822 822 y Fq(\017)41 b Fz(The)28 b(desired)f(v)-5
b(alue)27 b Fx(val)822 955 y Fq(\017)41 b Fz(Execute)27
b(access)f(righ)n(ts)h(for)g(the)h(prop)r(ert)n(y)f(v)-5
b(alue)27 b Fx(pr)p Fz(.)822 1088 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(sh)n(tl)f
Fx(r)p Fz(.)722 1220 y Fk(h)p Fj(O\013)g(shuttle)i(for)f(users)h(metho)
l(ds.)f Fk(i)p Fz(+)p Fq(\021)805 1312 y Fi(//)40 b(Sets)g(the)g(value)
g(for)g(a)g(given)g(property.)805 1403 y(void)g(set_prop\(off_prop_t)k
(p,)c(const)g(off_id_t)h(&val,)1198 1494 y(off_Rights)g(pr,)f
(off_Rights)i(r\){)884 1586 y(off_shtl_set_prop_req)i
(req\(w_p,p,val,pr,r\);)884 1677 y(off_shtl_set_prop_rep)g(rep;)884
1768 y(err_t)c(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()
q(\),)1315 1860 y(sizeof\(req\),sizeof\(rep\),&req)q(,&re)q(p,0\);)884
1951 y(if)f(\(err)i(||)e(rep.m_err\))962 2042 y
(errno=\(err\)?err:rep.m_err;)805 2134 y(})722 2341 y
Fk(h)p Fj(O\013)27 b(shuttle)i(messages.)g Fk(i)p Fz(+)p
Fq(\021)805 2433 y Fi(#define)41 b(OFF_MSG_SHTL_SET_PROP)j(0x013f)884
2524 y(struct)c(off_shtl_set_prop_req:)45 b(public)40
b(off_ObjKernReq)j({)962 2615 y(off_prop_t)f(prop;)962
2707 y(off_id_t)120 b(pval;)962 2798 y(off_Rights)42
b(prights;)962 2889 y(off_shtl_set_prop_req\(off_id)q(_t)j(me,)40
b(off_prop_t)i(p,)d(off_id_t)i(val,)1825 2980 y(off_Rights)h(pr,)e
(off_Rights)h(r\))f(:)1041 3072 y(off_ObjKernReq\(me,OFF_MSG_SHTL)q
(_SET_)q(PROP)q(,r\),)1041 3163 y(prop\(p\),pval\(val\),prights\(pr\))
85 b({;})884 3254 y(};)884 3346 y(struct)40 b(off_shtl_set_prop_rep:)45
b(public)40 b(off_KernRep)i({)962 3437 y(off_shtl_set_prop_rep\(err_t)k
(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884 3528 y(};)515
3769 y FA(self)d Fz(Returns)28 b(the)g(curren)n(t)f(sh)n(uttle.)722
3885 y Fk(h)p Fj(O\013)g(shuttle)i(for)f(users)h(metho)l(ds.)f
Fk(i)p Fz(+)p Fq(\021)805 3977 y Fi(#include)41 b("uShtlSrv.h")884
4068 y(static)f(off_uShtl)i(self\(void\))f({)962 4159
y(off_shtl_self_req)i(req;)962 4251 y(off_shtl_self_rep)g(rep;)962
4342 y(extern)e(off_uShtlSrv)h(__shtlsrv;)962 4433 y(err_t)f
(err=off_prtl_pct\(__shtlsrv.get_)q(prtl)q(\(\),)1394
4525 y(sizeof\(req\),sizeof\(rep\),&req,&)q(rep,0)q(\);)962
4616 y(if)f(\(err)g(||)g(rep.m_err\))1041 4707 y
(errno=\(err\)?err:rep.m_err;)962 4799 y(return)h(rep.res;)884
4890 y(})1885 5255 y Fz(520)p eop
PStoPSsaved restore
%%Page: (522,523) 262
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
521 522 bop 722 523 a Fk(h)p Fj(O\013)27 b(shuttle)i(messages.)g
Fk(i)p Fz(+)p Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_SHTL_SELF)i
(0x14f)884 706 y(struct)d(off_shtl_self_req:)k(public)c(off_MsgReq)i({)
962 797 y(off_shtl_self_req\(void\))j(:)1041 888 y
(off_MsgReq\(OFF_MSG_SHTL_SELF\){)q(;})884 980 y(};)884
1071 y(struct)40 b(off_shtl_self_rep:)k(public)c(off_KernRep)i({)962
1162 y(off_shtl_id_t)g(res;)962 1254 y(off_shtl_self_rep\(err_t)j
(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884 1345 y(};)515
1685 y Fk(h)p Fj(uShtl.h*)11 b Fk(i)p Fq(\021)598 1777
y Fk(h)p Fj(O\013)27 b(shuttle)i(messages.)g Fk(i)598
1959 y(h)p Fj(O\013)e(shuttle)i(for)e(users.)i Fk(i)1885
5255 y Fz(521)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
522 523 bop 515 523 a Fk(h)p Fj(kShtlSrv.h*)11 b Fk(i)q
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<shtl/ShtlSrv.h>)
239 b(//)39 b(Exported)j(interface.)598 1528 y(#include)f(<klib/str.h>)
277 b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 1893 y(#include)g(<dmm/KVM.h>)598
2076 y(#ifndef)g(__OFF_KSHTL_SRV_H)598 2167 y(#define)g
(__OFF_KSHTL_SRV_H)i(1)598 2258 y(#ifdef)d(__KERNEL__)598
2441 y(class)g(off_kShtlSrv)i(:)e(public)g(off_kAbsCompResource)k({)598
2532 y(public:)676 2623 y(static)d(err_t)f(handler\(const)i
(off_shtl_id_t)h(&sender,)1500 2715 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 2806 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676
2989 y(virtual)g(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
3080 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 3171
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))f({)755 3263
y(return)g(off_kResource::handle\(sender)q(,msz)q(,rsz,)q(m,r\))q(;)676
3354 y(})676 3537 y(void)g(allocat\(off_shtlsrv_allocat_)q(req)46
b(*m,off_shtlsrv_allocat_rep)84 b(*r\))676 3628 y({)755
3719 y(off_Shtl)41 b(*s;)755 3811 y(\(void\)m;)755 3902
y(off_GrowingRegion)i(*kstck=kvm.create_kstack\("uk"\))q(;)755
3993 y(if)c(\(!kstck\))i({)833 4085 y(r->m_err=ENOMEM;)833
4176 y(return;)755 4267 y(})755 4359 y(//)e(XXX)h(check)h(domain)f
(rights.)755 4450 y(s)196 b(=new\(m->id\))42 b
(off_Shtl\(m->prot,m->dom,)1814 4541 y(\(register_t\)m->upc,)h
(\(register_t\)m->usp,)1814 4633 y(kstck->get_start\(\),)1814
4724 y(off_Shtl::self\(\)\);)755 4815 y(if)c(\(!s\))833
4907 y(r->m_err=EAGAIN;)755 4998 y(r->res=\(s\)?s->get_id\(\):OFF_SHTL)
q(_NUL)q(L;)1885 5255 y Fz(522)p eop
PStoPSsaved restore
%%Page: (524,525) 263
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
523 524 bop 676 523 a Fi(})676 614 y(void)40 b
(alloc\(off_shtlsrv_alloc_req)46 b(*m,off_shtlsrv_alloc_rep)84
b(*r\))676 706 y({)755 797 y(off_Shtl)41 b(*s;)755 888
y(off_GrowingRegion)i(*kstck=kvm.create_kstack\("uk"\))q(;)755
980 y(if)c(\(!kstck\))i({)833 1071 y(r->m_err=ENOMEM;)833
1162 y(return;)755 1254 y(})755 1345 y(//)e(XXX)h(check)h(domain)f
(rights.)755 1436 y(s=new)g(off_Shtl\(m->prot,m->dom,)1343
1528 y(\(register_t\)m->upc,)k(\(register_t\)m->usp,)1343
1619 y(kstck->get_start\(\),)1343 1710 y(off_Shtl::self\(\)\);)755
1802 y(if)39 b(\(!s\))833 1893 y(r->m_err=EAGAIN;)755
1984 y(r->res=\(s\)?s->get_id\(\):OFF_SHTL)q(_NUL)q(L;)676
2076 y(})676 2167 y(void)h(free\(off_shtlsrv_free_req)45
b(*m,off_shtlsrv_free_rep)84 b(*r\))676 2258 y({)755
2350 y(\(void\)r;)755 2441 y(if)39 b(\(!shtl.is_local\(m->id\)\))833
2532 y(panic\("shtl:)j(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)755 2623 y(\(shtl+m->id\)->unreference\(\);)676
2715 y(})598 2897 y(};)598 3171 y(extern)g(off_kShtlSrv)i(kshtl;)598
3354 y(#endif)e(//)g(__KERNEL__)598 3445 y(#endif)g(//)g
(__OFF_KSHTL_SRV_H)1885 5255 y Fz(523)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
524 525 bop 515 523 a Fk(h)p Fj(kShtlSrv.C*)11 b Fk(i)q
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<shtl/ShtlSrv.h>)
239 b(//)39 b(Exported)j(interface.)598 1528 y(#include)f(<klib/str.h>)
277 b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1893 y(#include)g(<shtl/kShtlSrv.h>)598 1984 y(#include)g
(<shtl/kShtl.h>)598 2076 y(#include)g(<flux/gdb_serial.h>)161
b(//)40 b(OSKit)g(gdb)g(support)598 2167 y(#include)h(<flux/gdb.h>)434
b(//)40 b(OSKit)g(gdb)g(support)598 2258 y(#include)h
(<klib/mdep/debug.h>)598 2532 y(off_kShtlSrv)h(kshtl;)598
2715 y(err_t)e(off_kShtlSrv::handler\(const)45 b(off_shtl_id_t)e
(&sender,)1657 2806 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1657
2897 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598 2989
y({)676 3080 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 3171 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 3263 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 3354 y
(do_debug\(printf\("shtl[\045x]",m)q(->m_t)q(ype\))q(\);)676
3445 y(r->m_err=EOK;)676 3537 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)
755 3628 y(if)f(\(m->m_type==OFF_MSG_SHTL_SEL)q(F\){)833
3719 y(\(\(off_shtl_get_prop_rep*\)r\)->)q(res=)q(off_)q(Shtl:)q(:sel)q
(f\(\)->)q(get_)q(id\(\))q(;)833 3811 y(return)i(EOK;)755
3902 y(})755 3993 y(else)f({)833 4085 y(off_shtl_id_t)i
(s=\(\(off_ObjKernReq*\)m\)->obj;)833 4176 y(if)e(\(!s.i_offset\){)912
4267 y(off_kShtl)h(ks\(off_Shtl::self\(\)\);)912 4359
y(return)f(ks.handle\(sender,msz,rsz,\(of)q(f_Obj)q(Kern)q(Req*\))q
(m,r\))q(;)833 4450 y(})833 4541 y(else)g(if)g
(\(!shtl.is_local\(s\)\){)912 4633 y(panic\("shtl:)i(should)e(raise)g
(missing,)i(but)d(not)h(yet)g(implemented."\);)833 4724
y(})833 4815 y(else)g({)912 4907 y(off_kShtl)h(ks\(shtl+s\);)912
4998 y(return)f(ks.handle\(sender,msz,rsz,\(of)q(f_Obj)q(Kern)q(Req*\))
q(m,r\))q(;)1885 5255 y Fz(524)p eop
PStoPSsaved restore
%%Page: (526,527) 264
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
525 526 bop 833 523 a Fi(})755 614 y(})676 706 y(})676
797 y(switch\(m->m_type\){)676 888 y(case)40 b(OFF_MSG_R_INIT:)755
980 y(return)g(EOK;)676 1071 y(case)g(OFF_MSG_SHTLSRV_ALLOCAT:)755
1162 y(if)f(\(!shtl.access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 1254 y(r->m_err=)i(EPERM;)755 1345 y(else)f(if)f
(\(msz!=sizeof\(off_shtlsrv_al)q(loca)q(t_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_shtlsrv_alloca)q(t_re)q(p\)\))833
1436 y(r->m_err=)h(EINVAL;)755 1528 y(else)f({)833 1619
y(kshtl.allocat\(\(off_shtlsrv_al)q(loca)q(t_re)q(q*\)m,)q(\(off)q
(_shtl)q(srv_)q(allo)q(cat_r)q(ep*\))q(r\);)755 1710
y(})755 1802 y(return)g(EOK;)676 1893 y(case)g(OFF_MSG_SHTLSRV_ALLOC:)
755 1984 y(if)f(\(!shtl.access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 2076 y(r->m_err=)i(EPERM;)755 2167 y(else)f(if)f
(\(msz!=sizeof\(off_shtlsrv_al)q(loc_)q(req\))46 b(||)39
b(rsz!=sizeof\(off_shtlsrv_allo)q(c_re)q(p\)\))833 2258
y(r->m_err=)i(EINVAL;)755 2350 y(else)f({)833 2441 y
(kshtl.alloc\(\(off_shtlsrv_allo)q(c_re)q(q*\)m)q(,\(off)q(_sht)q
(lsrv_)q(allo)q(c_re)q(p*\)r\))q(;)755 2532 y(})755 2623
y(return)g(EOK;)637 2715 y(case)g(OFF_MSG_SHTLSRV_FREE:)755
2806 y(if)f(\(msz!=sizeof\(off_shtlsrv_fre)q(e_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_shtlsrv_free_)q(rep\)\))833
2897 y(r->m_err=)h(EINVAL;)755 2989 y(else)f({)833 3080
y(kshtl.free\(\(off_shtlsrv_free_)q(req*)q(\)m,\()q(off_s)q(htls)q
(rv_fr)q(ee_r)q(ep*\))q(r\);)755 3171 y(})755 3263 y(return)g(EOK;)676
3354 y(default:)755 3445 y(return)g(\(\(off_kAbsCompResource*\)&ksh)q
(tl\)-)q(>hand)q(le\(s)q(ender)q(,msz)q(,rsz)q(,m,r\))q(;)676
3537 y(})598 3628 y(})1885 5255 y Fz(525)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
526 527 bop 515 523 a Fk(h)p Fj(kShtl.h*)11 b Fk(i)p
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<shtl/Shtl.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 1984 y(#ifndef)g(__OFF_KSHTL_H)598
2076 y(#define)g(__OFF_KSHTL_H)h(1)598 2167 y(#ifdef)e(__KERNEL__)598
2350 y(class)g(off_kShtl)h(:)f(public)g(off_kAbsResUnit)j({)598
2441 y(public:)676 2532 y(off_kShtl\(off_Shtl)h(*r=NULL\))d(:)e
(off_kAbsResUnit\(r\))k({};)676 2623 y(virtual)e(err_t)f(handle\(const)
i(off_shtl_id_t)h(&sender,)1500 2715 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 2806 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)637
3080 y(void)f(get_nprops\(off_shtl_get_nprop)q(s_re)q(q)45
b(*m,off_shtl_get_nprops_rep)84 b(*r\))676 3171 y({)755
3263 y(\(void\)m;)755 3354 y(r->res=\(\(off_Shtl*\)w_r\)->get_np)q
(rops)q(\(\);)676 3445 y(})637 3537 y(void)40 b
(get_prop\(off_shtl_get_prop_re)q(q)45 b(*m,off_shtl_get_prop_rep)84
b(*r\))676 3628 y({)755 3719 y(if)39 b(\(m->prop)i(>)f
(\(\(off_Shtl*\)w_r\)->get_nprops\(\))q(\))833 3811 y(r->m_err=E2BIG;)
755 3902 y(else)833 3993 y(r->res=\(\(off_Shtl*\)w_r\)->get_)q(prop)q
(\(m->)q(prop\))q(;)676 4085 y(})637 4176 y(void)g
(set_prop\(off_shtl_set_prop_re)q(q)45 b(*m,off_shtl_set_prop_rep)84
b(*r\))676 4267 y({)755 4359 y(//)39 b(XXX)h(should)h(check)f(pserver)h
(protection!.)755 4450 y(if)e(\(m->prop)i(>)f
(\(\(off_Shtl*\)w_r\)->get_nprops\(\))q(\))833 4541 y(r->m_err=E2BIG;)
755 4633 y(else)833 4724 y(\(\(off_Shtl*\)w_r\)->set_prop\(m-)q(>pro)q
(p,m-)q(>pval)q(\);)676 4815 y(})598 4907 y(};)1885 5255
y Fz(526)p eop
PStoPSsaved restore
%%Page: (528,529) 265
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
527 528 bop 598 523 a Fi(#endif)40 b(//)g(__KERNEL__)598
614 y(#endif)g(//)g(__OFF_KSHTL_H)1885 5255 y Fz(527)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
528 529 bop 515 523 a Fk(h)p Fj(kShtl.C*)11 b Fk(i)p
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<shtl/Shtl.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1893 y(#include)g(<shtl/kShtl.h>)598 2076 y(err_t)f
(off_kShtl::handle\(const)45 b(off_shtl_id_t)d(&sender,)1068
2167 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)1068 2258
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 2350 y({)676
2441 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i(<<)f(")f
(";)676 2532 y(//kcout)i(<<fmt\("msg@\04508x)i(",\(vm_offset_t\)m\))g
(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)676 2623
y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 2715 y
(switch\(m->m_type\){)676 2806 y(case)h(OFF_MSG_R_INIT:)755
2897 y(return)g(EOK;)676 2989 y(case)g(OFF_MSG_SHTL_GET_NPROPS:)755
3080 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_R,m)q(->m_)q(right)q
(s\)\))833 3171 y(r->m_err=)i(EPERM;)755 3263 y(else)f(if)f
(\(msz!=sizeof\(off_shtl_get_n)q(prop)q(s_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_shtl_get_nprop)q(s_re)q(p\)\))833
3354 y(r->m_err=)h(EINVAL;)755 3445 y(else)f({)833 3537
y(get_nprops\(\(off_shtl_get_npro)q(ps_r)q(eq*\))q(m,\(of)q(f_sh)q
(tl_ge)q(t_np)q(rops)q(_rep*)q(\)r\);)755 3628 y(})755
3719 y(return)g(EOK;)676 3811 y(case)g(OFF_MSG_SHTL_GET_PROP:)755
3902 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_R,m)q(->m_)q(right)q
(s\)\))833 3993 y(r->m_err=)i(EPERM;)755 4085 y(else)f(if)f
(\(msz!=sizeof\(off_shtl_get_p)q(rop_)q(req\))46 b(||)39
b(rsz!=sizeof\(off_shtl_get_pro)q(p_re)q(p\)\))833 4176
y(r->m_err=)i(EINVAL;)755 4267 y(else)f({)833 4359 y
(get_prop\(\(off_shtl_get_prop_r)q(eq*\))q(m,\(o)q(ff_sh)q(tl_g)q
(et_pr)q(op_r)q(ep*\))q(r\);)755 4450 y(})755 4541 y(return)g(EOK;)676
4633 y(case)g(OFF_MSG_SHTL_SET_PROP:)755 4724 y(if)f
(\(!w_r->access_granted\(OFF_OP)q(_R,m)q(->m_)q(right)q(s\)\))833
4815 y(r->m_err=)i(EPERM;)755 4907 y(else)f(if)f
(\(msz!=sizeof\(off_shtl_set_p)q(rop_)q(req\))46 b(||)39
b(rsz!=sizeof\(off_shtl_set_pro)q(p_re)q(p\)\))833 4998
y(r->m_err=)i(EINVAL;)1885 5255 y Fz(528)p eop
PStoPSsaved restore
%%Page: (530,531) 266
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
529 530 bop 755 523 a Fi(else)40 b({)833 614 y
(set_prop\(\(off_shtl_set_prop_r)q(eq*\))q(m,\(o)q(ff_sh)q(tl_s)q
(et_pr)q(op_r)q(ep*\))q(r\);)755 706 y(})755 797 y(return)g(EOK;)676
888 y(default:)755 980 y(return)g(off_kAbsResUnit::handle\(send)q(er,m)
q(sz,rs)q(z,m,)q(r\);)676 1071 y(})598 1162 y(})515 1619
y Fn(5.1.15)112 b(Sh)m(uttles)37 b Fd(C)8 b FC(++)38
b Fn(source)f(\014les)515 1772 y Fz(Sh)n(uttle)28 b(serv)n(er)e(co)r
(de)h(is)h(found)g(in)f Fx(shtl/ShtlSrv.h)22 b Fz(and)28
b Fx(shtl/ShtlSrv.C)p Fz(.)515 1905 y Fk(h)p Fj(ShtlSrv.h*)11
b Fk(i)q Fq(\021)598 1996 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2088 y Fi(#ifndef)41 b(__OFF_SHTL_SRV_H)598 2179 y(#define)g
(__OFF_SHTL_SRV_H)h(1)598 2362 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)
g(dep)l(endencies.)h Fk(i)598 2544 y Fi(#ifdef)40 b(__KERNEL__)598
2636 y Fk(h)p Fj(O\013)27 b(shuttle)i(server.)g Fk(i)598
2818 y(h)p Fj(O\013)e(shuttle)i(server)g(exp)l(orte)l(d)h(variables.)e
Fk(i)598 3001 y Fi(#endif)40 b(//)g(__KERNEL__)598 3183
y(#include)h(<prtl/ex.h>)598 3275 y(#include)g(<shtl/uShtlSrv.h>)598
3549 y(#ifdef)f(__KERNEL__)598 3640 y Fk(h)p Fi(off)p
750 3640 24 4 v 29 w(ShtlSrv::make)p 1286 3640 V 31 w(available)29
b Fj(implementation.)f Fk(i)598 3731 y(h)p Fi(off)p 750
3731 V 29 w(ShtlSrv::is)p 1208 3731 V 30 w(local)h Fj(implementation.)e
Fk(i)598 3823 y(h)p Fi(off)p 750 3823 V 29 w(ShtlSrv::valid)j
Fj(implementation.)e Fk(i)598 3914 y(h)p Fi(off)p 750
3914 V 29 w(ShtlSrv::operator+)j Fj(implementation.)d
Fk(i)598 4005 y Fi(#endif)40 b(//)g(__KERNEL__)598 4188
y(#endif)g(//)g(__OFF_SHTL_SRV_H)1885 5255 y Fz(529)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
530 531 bop 515 523 a Fk(h)p Fj(ShtlSrv.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<shtl/ShtlSrv.h>)278 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(shuttle)i(server)g(implementation)f(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(shuttle)i(server)g(static)
g(memb)l(ers.)f Fk(i)598 1162 y(h)p Fj(O\013)f(shuttle)i(server)g(glob)
l(al)f(variables.)g Fk(i)598 1345 y(h)p Fi(off)p 750
1345 24 4 v 29 w(ShtlSrv::off)p 1247 1345 V 31 w(ShtlSrv)h
Fj(implementation.)e Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(ShtlSrv::get)p 1247 1436 V 31 w(allocator)i
Fj(implementation.)e Fk(i)598 1528 y(h)p Fi(off)p 750
1528 V 29 w(ShtlSrv::start)j Fj(implementation.)e Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(ShtlSrv::alloc)i
Fj(and)e Fi(free)h Fj(implementation.)e Fk(i)598 1710
y(h)p Fi(off)p 750 1710 V 29 w(ShtlSrv::notify)j Fj(implementation.)e
Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(ShtlSrv::operator<<)j
Fj(implementation.)d Fk(i)598 1893 y(h)p Fi(off)p 750
1893 V 29 w(ShtlSrv::nameof)i Fj(implementation.)e Fk(i)598
1984 y(h)p Fi(off)p 750 1984 V 29 w(ShtlSrv::get)p 1247
1984 V 31 w(url)g Fj(implementation.)f Fk(i)598 2076
y(h)p Fi(off)p 750 2076 V 29 w(ShtlSrv::palloc)j Fj(and)e
Fi(pfree)h Fj(implementation.)e Fk(i)598 2167 y(h)p Fi(off)p
750 2167 V 29 w(ShtlSrv::fpu)p 1247 2167 V 31 w(fault)h
Fj(implementation.)g Fk(i)598 2258 y(h)p Fi(off)p 750
2258 V 29 w(ShtlSrv::self)p 1286 2258 V 31 w(start)g
Fj(implementation.)g Fk(i)1885 5255 y Fz(530)p eop
PStoPSsaved restore
%%Page: (532,533) 267
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
531 532 bop 639 523 a Fz(Sh)n(uttle)29 b(co)r(de)e(is)g(in)h
Fx(shtl/Shtl.h)23 b Fz(and)28 b Fx(shtl/Shtl.C)p Fz(.)515
656 y Fk(h)p Fj(Shtl.h*)11 b Fk(i)p Fq(\021)598 747 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 839 y Fi(#ifndef)41 b(__OFF_SHTL_H)598
930 y(#define)g(__OFF_SHTL_H)h(1)598 1112 y Fk(h)p Fj(O\013)27
b(shuttle)i(dep)l(endencies.)g Fk(i)598 1295 y(h)p Fj(O\013)e(shuttle)i
(\015ag)f(bits.)g Fk(i)598 1386 y(h)p Fj(O\013)f(shuttle)i(server)g(pr)
l(e)l(de\014ne)l(d)h(pr)l(op)l(erties)g(numb)l(ers.)e
Fk(i)598 1569 y Fi(#ifdef)40 b(__KERNEL__)598 1660 y
Fk(h)p Fj(O\013)27 b(shuttle.)h Fk(i)598 1843 y(h)p Fj(O\013)f
Fi(shtl)p 922 1843 24 4 v 29 w(main)h Fj(r)l(outine.)h
Fk(i)598 1934 y Fi(#endif)40 b(//)g(__KERNEL__)598 2117
y(#include)h(<prtl/ex.h>)598 2208 y(#include)g(<shtl/uShtl.h>)598
2391 y(#ifdef)f(__KERNEL__)598 2482 y(//)f(Inline)i(methods)g(for)f
(off_Shtl)598 2574 y(//)598 2665 y Fk(h)p Fj(O\013)27
b(shuttle)i(late)f(dep)l(endencies.)h Fk(i)598 2848 y(h)p
Fi(off)p 750 2848 V 29 w(Shtl::get)p 1130 2848 V 30 w(pc)f
Fj(implementation.)f Fk(i)598 2939 y(h)p Fi(off)p 750
2939 V 29 w(Shtl::get)p 1130 2939 V 30 w(ctx)h Fj(implementation.)f
Fk(i)598 3030 y(h)p Fi(off)p 750 3030 V 29 w(Shtl::push)p
1169 3030 V 30 w(ctx)h Fj(and)g Fi(pop)p 1610 3030 V
29 w(ctx)g Fj(implementation.)g Fk(i)598 3122 y(h)p Fi(off)p
750 3122 V 29 w(Shtl::push)p 1169 3122 V 30 w(current)p
1472 3122 V 30 w(ctx)g Fj(and)g Fi(pop)p 1913 3122 V
29 w(current)p 2215 3122 V 30 w(ctx)g Fj(implementation.)f
Fk(i)598 3213 y(h)p Fi(off)p 750 3213 V 29 w(Shtl::is)p
1091 3213 V 30 w(usrio)h Fj(implementation.)g Fk(i)598
3304 y(h)p Fi(off)p 750 3304 V 29 w(Shtl::get)p 1130
3304 V 30 w(prty)g Fj(and)g Fi(off)p 1610 3304 V 29 w(Shtl::set)p
1990 3304 V 30 w(prty)h Fj(implementation.)e Fk(i)598
3396 y(h)p Fi(off)p 750 3396 V 29 w(Shtl::get)p 1130
3396 V 30 w(dtlb)h Fj(implementation.)g Fk(i)598 3487
y(h)p Fi(off)p 750 3487 V 29 w(Shtl::get)p 1130 3487
V 30 w(uctx)g Fj(implementation.)g Fk(i)598 3578 y(h)p
Fi(off)p 750 3578 V 29 w(ShtlCtx::get)p 1247 3578 V 31
w(user)p 1434 3578 V 29 w(ctx)g Fj(and)g Fi(get)p 1874
3578 V 29 w(kernel)p 2137 3578 V 29 w(ctx)g Fj(implementation.)g
Fk(i)598 3670 y(h)p Fi(off)p 750 3670 V 29 w(Shtl::is)p
1091 3670 V 30 w(blocked)h Fj(implementation.)e Fk(i)598
3761 y(h)p Fi(off)p 750 3761 V 29 w(Shtl::is)p 1091 3761
V 30 w(yielding)i Fj(implementation.)e Fk(i)598 3852
y(h)p Fi(off)p 750 3852 V 29 w(Shtl::yields)p 1247 3852
V 31 w(to)g Fj(implementation.)h Fk(i)598 3944 y(h)p
Fi(off)p 750 3944 V 29 w(Shtl::is)p 1091 3944 V 30 w(running)h
Fj(et)f(al.)f(implementation.)g Fk(i)598 4035 y(h)p Fi(off)p
750 4035 V 29 w(Shtl::valid)i Fj(implementation.)f Fk(i)598
4126 y(h)p Fi(off)p 750 4126 V 29 w(Shtl::get)p 1130
4126 V 30 w(mdep)g Fj(implementation.)g Fk(i)598 4218
y Fi(#endif)40 b(//)g(__KERNEL__)598 4400 y(#endif)g(//)g(__OFF_SHTL_H)
1885 5255 y Fz(531)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
532 533 bop 515 523 a Fk(h)p Fj(Shtl.C*)11 b Fk(i)p Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<shtl/Shtl.h>)395
b(//)40 b(Exported)h(interface.)598 888 y Fk(h)p Fj(O\013)27
b(shuttle)i(implementation)f(dep)l(endencies.)h Fk(i)598
1071 y(h)p Fj(O\013)e(shuttle)i(static)g(memb)l(ers.)f
Fk(i)598 1254 y(h)p Fi(off)p 750 1254 24 4 v 29 w(Shtl::off)p
1130 1254 V 30 w(Shtl)g Fj(implementation.)g Fk(i)598
1345 y(h)p Fi(off)p 750 1345 V 29 w(Shtl::~off)p 1169
1345 V 30 w(Shtl)g Fj(implementation.)g Fk(i)598 1436
y(h)p Fi(off)p 750 1436 V 29 w(Shtl::self)h Fj(implementation.)f
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(Shtl::block)p
Fj(,)h Fi(unblock)p Fj(,)g(and)f Fi(terminated)h Fj(implementation.)f
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(Shtl::yield)h
Fj(implementation.)f Fk(i)598 1710 y(h)p Fi(off)p 750
1710 V 29 w(Shtl::get)p 1130 1710 V 30 w(nprops)h Fj(implementation.)e
Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(Shtl::def)p
1130 1802 V 30 w(prop)h Fj(implementation.)g Fk(i)598
1893 y(h)p Fi(off)p 750 1893 V 29 w(Shtl::get)p 1130
1893 V 30 w(prop)g Fj(implementation.)g Fk(i)598 1984
y(h)p Fi(off)p 750 1984 V 29 w(Shtl::set)p 1130 1984
V 30 w(prop)g Fj(implementation.)g Fk(i)598 2076 y(h)p
Fi(off)p 750 2076 V 29 w(Shtl::get)p 1130 2076 V 30 w(psrv)g
Fj(implementation.)g Fk(i)598 2167 y(h)p Fi(off)p 750
2167 V 29 w(Shtl::handoff)p 1286 2167 V 31 w(uctx)g Fj(implementation.)
g Fk(i)598 2258 y(h)p Fi(off)p 750 2258 V 29 w(Shtl::get)p
1130 2258 V 30 w(allocator)h Fj(implementation.)f Fk(i)598
2350 y(h)p Fi(off)p 750 2350 V 29 w(Shtl::operator)42
b(new)28 b Fj(implementation.)g Fk(i)598 2441 y(h)p Fi(off)p
750 2441 V 29 w(Shtl::operator)42 b(delete)29 b Fj(implementation.)e
Fk(i)598 2532 y(h)p Fi(off)p 750 2532 V 29 w(Shtl::switch)p
1247 2532 V 31 w(from)h Fj(implementation.)f Fk(i)598
2623 y(h)p Fi(off)p 750 2623 V 29 w(Shtl::get)p 1130
2623 V 30 w(url)p 1277 2623 V 29 w(holder)i Fj(implementation.)e
Fk(i)598 2715 y(h)p Fi(off)p 750 2715 V 29 w(Shtl::usrio)p
1208 2715 V 30 w(enable)i Fj(and)f Fi(usrio)p 1845 2715
V 29 w(disable)h Fj(implementation.)f Fk(i)598 2806 y(h)p
Fi(off)p 750 2806 V 29 w(Shtl::set)p 1130 2806 V 30 w(uctx)g
Fj(implementation.)g Fk(i)598 2897 y(h)p Fi(off)p 750
2897 V 29 w(Shtl::set)p 1130 2897 V 30 w(dtlb)g Fj(implementation.)g
Fk(i)598 2989 y(h)p Fi(off)p 750 2989 V 29 w(Shtl::main)h
Fj(implementation.)f Fk(i)598 3080 y(h)p Fi(off)p 750
3080 V 29 w(Shtl::exit)h Fj(implementation.)f Fk(i)598
3171 y(h)p Fj(O\013)f Fi(shtl)p 922 3171 V 29 w(main)h
Fj(implementation.)g Fk(i)1885 5255 y Fz(532)p eop
PStoPSsaved restore
%%Page: (534,535) 268
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
533 534 bop 639 523 a Fz(The)28 b(sh)n(uttle)g(allo)r(cator)e(is)h
(found)h(in)g Fx(ShtlAllocator.h)21 b Fz(and)28 b Fx(ShtlAllocator.C)p
Fz(.)515 656 y Fk(h)p Fj(ShtlA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y
Fi(#ifndef)41 b(__SHTL_ALLOCATOR_H)598 930 y(#define)g
(__SHTL_ALLOCATOR_H)i(1)598 1112 y Fk(h)p Fj(O\013)27
b(shuttle)i(al)t(lo)l(c)l(ator)g(dep)l(endencies.)g Fk(i)598
1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y Fk(h)p Fj(O\013)27
b(linkable)g(shuttle.)i Fk(i)598 1478 y(h)p Fj(O\013)e(shuttle)i(al)t
(lo)l(c)l(ator.)f Fk(i)598 1569 y Fi(#endif)40 b(//)g(__KERNEL__)598
1843 y(#ifdef)g(__KERNEL__)598 1934 y(//)f(Inline)i(methods)g(of)f
(shuttle)g(allocator.)598 2026 y(//)598 2117 y Fk(h)p
Fi(off)p 750 2117 24 4 v 29 w(ShtlAllocator::operator+)32
b Fj(implementation.)c Fk(i)598 2208 y Fi(#endif)40 b(//)g(__KERNEL__)
598 2391 y(#endif)g(//)g(__SHTL_ALLOCATOR_H)515 2565
y Fk(h)p Fj(ShtlA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)q
Fq(\021)598 2657 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2839 y Fi(#include)41
b(<shtl/ShtlAllocator.h>)j(//)c(Exported)h(interface)598
3022 y Fk(h)p Fj(O\013)27 b(shuttle)i(al)t(lo)l(c)l(ator)g(static)f
(memb)l(ers.)g Fk(i)598 3205 y(h)p Fi(off)p 750 3205
V 29 w(ShtlAllocator::off)p 1481 3205 V 32 w(ShtlAllocator)i
Fj(implementation.)e Fk(i)639 3346 y Fz(Sh)n(uttle)h(con)n(text)e(co)r
(de)g(is)h(in)f Fx(ShtlCtx.h)p Fz(.)515 3479 y Fk(h)p
Fj(ShtlCtx.h*)11 b Fk(i)q Fq(\021)598 3570 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 3661 y Fi(#ifndef)41 b(__OFF_SHTL_CTX_H)598
3753 y(#define)g(__OFF_SHTL_CTX_H)h(1)598 3935 y Fk(h)p
Fj(O\013)27 b(shuttle)i(c)l(ontext)h(dep)l(endencies.)f
Fk(i)598 4118 y Fi(#ifdef)40 b(__KERNEL__)598 4209 y
Fk(h)p Fj(O\013)27 b(shuttle)i(c)l(ontext.)g Fk(i)598
4301 y(h)p Fj(O\013)e(shuttle)i(c)l(ontext)h(iter)l(ator.)f
Fk(i)598 4392 y Fi(#endif)40 b(//)g(__KERNEL__)598 4666
y(#endif)g(//)g(!__OFF_SHTL_CTX_H)1885 5255 y Fz(533)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
534 535 bop 639 523 a Fz(Sh)n(uttle)29 b(prop)r(ert)n(y)d(co)r(de)h(is)
h(in)g Fx(ShtlProp.h)23 b Fz(and)28 b Fx(ShtlProp.C)p
Fz(.)515 656 y Fk(h)p Fj(ShtlPr)l(op.h*)11 b Fk(i)q Fq(\021)598
747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 839 y Fi(#ifndef)41 b(__OFF_SHTL_PROP_H)598
930 y(#define)g(__OFF_SHTL_PROP_H)i(1)598 1112 y Fk(h)p
Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(dep)l(endencies.)f
Fk(i)598 1295 y(h)p Fj(O\013)e(shuttle)i(pr)l(op)l(erty)h(identifer.)d
Fk(i)598 1478 y Fi(#ifdef)40 b(__KERNEL__)598 1569 y
Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(server.)f
Fk(i)598 1660 y(h)p Fj(O\013)e(shuttle)i(pr)l(op)l(erty.)g
Fk(i)598 1752 y(h)p Fj(O\013)e(o\013-kernel)i(shuttle)g(pr)l(op)l(erty)
h(server.)f Fk(i)598 1843 y Fi(#endif)40 b(//)g(__KERNEL__)598
2208 y(#ifdef)g(__KERNEL__)598 2300 y Fk(h)p Fi(off)p
750 2300 24 4 v 29 w(ShtlProp::set)p 1286 2300 V 31 w(val)28
b Fj(and)g Fi(get)p 1728 2300 V 29 w(val)g Fj(implementation.)f
Fk(i)598 2391 y(h)p Fi(off)p 750 2391 V 29 w(ShtlProp::pswitch)k
Fj(implementation.)c Fk(i)598 2482 y(h)p Fi(off)p 750
2482 V 29 w(ShtlProp::operator=)k Fj(implementation.)d
Fk(i)598 2574 y Fi(#endif)40 b(//)g(__KERNEL__)598 2756
y(#endif)g(//)g(__OFF_SHTL_PROP_H)515 3022 y Fk(h)p Fj(ShtlPr)l(op.C*)
11 b Fk(i)p Fq(\021)598 3113 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 3296 y Fi(#include)41 b(<shtl/ShtlProp.h>)239
b(//)40 b(Exported)h(interface.)598 3387 y Fk(h)p Fj(O\013)27
b(shuttle)i(pr)l(op)l(erty)h(implementation)e(dep)l(endencies.)h
Fk(i)598 3570 y(h)p Fi(off)p 750 3570 V 29 w(ShtlProp::off)p
1286 3570 V 31 w(ShtlProp)g Fj(implementation.)e Fk(i)598
3661 y(h)p Fi(off)p 750 3661 V 29 w(ShtlProp::pset)j
Fj(and)e Fi(pclr)h Fj(implementation.)e Fk(i)598 3753
y(h)p Fi(off)p 750 3753 V 29 w(ShtlProp::operator)43
b(new)28 b Fj(implementation.)f Fk(i)1885 5255 y Fz(534)p
eop
PStoPSsaved restore
%%Page: (536,537) 269
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
535 536 bop 639 523 a Fz(The)19 b(prop)r(ert)n(y)e(allo)r(cator)g(is)h
(in)g Fx(shtl/ShtlPropAllo)o(cat)o(or)o(.h)12 b Fz(and)18
b Fx(shtl/ShtlPropAllo)o(ca)o(to)o(r.C)o Fz(.)515 656
y Fk(h)p Fj(ShtlPr)l(opA)n(l)t(lo)l(c)l(ator.h*)11 b
Fk(i)r Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y
Fi(#ifndef)41 b(__OFF_SHTL_PROP_ALLOC_H)598 930 y(#define)g
(__OFF_SHTL_PROP_ALLOC_H)j(1)598 1112 y Fk(h)p Fj(O\013)27
b(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l(ator)f(dep)l(endencies.)g
Fk(i)598 1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y
Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l(ator.)e
Fk(i)598 1478 y(h)p Fj(O\013)f(shuttle)i(pr)l(op)l(erty)h(r)l(e-al)t
(lo)l(c)l(ator.)f Fk(i)598 1569 y Fi(#endif)40 b(//)g(__KERNEL__)598
1752 y(#endif)g(//)g(__OFF_SHTL_PROP_ALLOC_H)515 1926
y Fk(h)p Fj(ShtlPr)l(opA)n(l)t(lo)l(c)l(ator.C*)11 b
Fk(i)q Fq(\021)598 2017 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h
(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2200 y
Fi(#include)41 b(<shtl/ShtlPropAllocator.h>)k(//)40 b(Exported)h
(interface.)598 2291 y Fk(h)p Fj(O\013)27 b(shuttle)i(pr)l(op)l(erty)h
(al)t(lo)l(c)l(ator)f(implementation)e(dep)l(endencies.)j
Fk(i)598 2474 y(h)p Fj(O\013)d(shuttle)i(pr)l(op)l(erty)h(al)t(lo)l(c)l
(ator)f(static)f(memb)l(ers.)g Fk(i)598 2565 y(h)p Fj(O\013)f(shuttle)i
(pr)l(op)l(erty)h(r)l(e-al)t(lo)l(c)l(ator)g(static)e(memb)l(ers.)h
Fk(i)598 2748 y(h)p Fi(off)p 750 2748 24 4 v 29 w
(ShtlPropReAllocator::off)p 1715 2748 V 33 w(ShtlPropReAllocator)j
Fj(implementation.)27 b Fk(i)598 2839 y(h)p Fi(off)p
750 2839 V 29 w(ShtlPropAllocator::operator)45 b(new)28
b Fj(and)g Fi(delete)h Fj(implementation.)e Fk(i)639
2980 y Fz(En)n(try)g(p)r(oin)n(ts)g(for)g(idle)h(sh)n(uttles)g(are)f
(found)g(at)h Fx(shtl/idle.h)23 b Fz(and)k Fx(shtl/idle.C)p
Fz(.)515 3113 y Fk(h)p Fj(id)t(le.h*)11 b Fk(i)o Fq(\021)598
3205 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3296 y Fi(#ifndef)41
b(__OFF_IDLE_H)598 3387 y(#define)g(__OFF_IDLE_H)h(1)598
3570 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle)i(dep)l(endencies.)g
Fk(i)598 3753 y Fi(#ifdef)40 b(__KERNEL__)598 3844 y(extern)g("C")g({)
676 3935 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle.)i
Fk(i)598 4027 y Fi(};)598 4118 y(#endif)40 b(//)g(__KERNEL__)598
4301 y(#endif)g(//)g(!__OFF_IDLE_H)1885 5255 y Fz(535)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
536 537 bop 515 523 a Fk(h)p Fj(id)t(le.C*)11 b Fk(i)o
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<shtl/idle.h>)395 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle)i(implementation)f(dep)l
(endencies.)h Fk(i)598 1071 y Fi(extern)40 b("C")g({)676
1162 y Fk(h)p Fj(O\013)27 b(Id)t(le)g(shuttle)i(for)f(b)l(o)l(ot)h(pr)l
(o)l(c)l(essor.)h Fk(i)676 1254 y(h)p Fj(O\013)d(Id)t(le)g(shuttle)i
(for)f(non-b)l(o)l(ot)i(pr)l(o)l(c)l(essor.)f Fk(i)598
1345 y Fi(};)598 1528 y Fk(h)p Fi(off)p 750 1528 24 4
v 29 w(Idle::off)p 1130 1528 V 30 w(Idle)f Fj(implementation.)g
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(IdleAtPrimary::off)p
1481 1619 V 32 w(IdleAtPrimary)i Fj(implementation.)e
Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w(IdleAtSecondary::off)p
1559 1710 V 32 w(IdleAtSecondary)j Fj(implementation.)d
Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(Idle::create)p
1247 1802 V 31 w(stck)g Fj(implementation.)f Fk(i)598
1893 y(h)p Fi(off)p 750 1893 V 29 w(Idle::create)p 1247
1893 V 31 w(kstck)h Fj(implementation.)g Fk(i)515 2167
y Fn(5.1.16)112 b(Sh)m(uttles)37 b(for)g(ix86)g(based)i(arc)m
(hitectures)515 2320 y Fz(There)20 b(is)i(no)e(mac)n(hine)h(dep)r
(enden)n(t)h(sh)n(uttle)g(serv)n(er)d(co)r(de.)35 b(Ho)n(w)n(ev)n(er,)
20 b(a)h(dumm)n(y)g(mac)n(hine)515 2420 y(dep)r(enden)n(t)34
b(sh)n(uttle)g(serv)n(er)e(is)i(pro)n(vided)f(so)g(that)h(the)g(no)r
(de)g(serv)n(er)e(could)i(create)f(the)515 2519 y(sh)n(uttle)28
b(serv)n(er)d(as)i(it)h(do)r(es)g(with)g(remaining)e(serv)n(ers.)515
2652 y Fk(h)p Fj(O\013)h(machine)h(dep)l(endent)h(shuttle)g(server.)g
Fk(i)p Fq(\021)598 2743 y Fi(//)39 b(A)h(machine)h(dependent)g(shuttle)
g(server.)598 2835 y(//)598 2926 y(class)f(off_mdepShtlSrv)j({)598
3017 y(public:)676 3109 y(static)e(natural_t)g(how_many\(void\))h({)e
(return)h(1;})676 3200 y(off_mdepShtlSrv\(void\))j({)c(;)f(})598
3291 y(};)515 3557 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(server)h(dep)l(endencies.)f Fk(i)p Fq(\021)598
3648 y Fi(#include)41 b(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)1885 5255 y Fz(536)p eop
PStoPSsaved restore
%%Page: (538,539) 270
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
537 538 bop 639 523 a Fz(Mac)n(hine)23 b(dep)r(enden)n(t)h(sh)n(uttles)
f(pro)n(vide)f(the)h(lo)n(w-lev)n(el)f(glue)g(co)r(de)h(and)g(data)g
(needed)515 623 y(to)18 b(implemen)n(t)h(sh)n(uttles.)34
b(W)-7 b(e)19 b(ha)n(v)n(e)e(seen)h(most)g(of)g(the)h(routines)f(pro)n
(vided)f(b)n(y)h Fx(mdepShtl)p Fz(s.)515 756 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle.)g Fk(i)p
Fq(\021)598 847 y Fi(//)39 b(A)h(machine)h(dependent)g(shuttle.)598
938 y(//)598 1029 y(class)f(off_mdepShtl)i({)598 1121
y(public:)676 1212 y(//)e(Finds)g(the)g(next)g(register)h(frame)80
b(in)40 b(the)g(shuttle)g(stack)676 1303 y(off_mdepProcRegs)j
(*get_next_regs\(const)h(off_mdepProcRegs)f(*r\);)676
1486 y(//)d(Enables)h(user)f(IO)676 1577 y(inline)h(void)f
(usrio_enable\(off_mdepProcRegs)46 b(*r\);)676 1669 y(//)40
b(Disables)h(user)f(IO)676 1760 y(inline)h(void)f
(usrio_disable\(off_mdepProcReg)q(s)45 b(*r\);)676 1943
y(static)c(natural_t)g(get_sp\(void\))81 b({)40 b(return)g
(get_esp\(\);)i(})676 2125 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 2125 24 4 v 29 w(mdepShtl)p Fj(.)i
Fk(i)598 2217 y Fi(protected:)676 2308 y Fk(h)p Fj(Other)g(pr)l(ote)l
(cte)l(d)h(metho)l(ds)f(of)e Fi(off)p 1755 2308 V 29
w(mdepShtl)p Fj(.)i Fk(i)598 2399 y Fi(private:)676 2491
y Fk(h)p Fj(Other)g(private)f(memb)l(ers)h(of)e Fi(off)p
1713 2491 V 29 w(mdepShtl)p Fj(.)i Fk(i)598 2582 y Fi(};)515
2848 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h(shuttle)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 2939 y Fi(#include)41
b(<flux/machine/proc_reg.h>)k(//)39 b(for)h(get_esp)h(and)f(get_eip.)
598 3030 y(#include)h(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 3122 y(#include)h(<dmm/mdep/mDTLB.h>)200
b(//)40 b(for)g(off_mdepDTLB)515 3296 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(shuttle)g(late)f(dep)l(endencies.)i
Fk(i)p Fq(\021)598 3387 y Fi(#include)41 b(<hw/Processor.h>)278
b(//)40 b(for)g(off_mdepProcRegs)515 3645 y FA(Supp)s(ort)32
b(for)g(hardwired)g(prop)s(erties)515 3798 y Fz(T)-7
b(o)27 b(enable)g(and)h(disable)f(user)g(lev)n(el)g(IO)g(w)n(e)g(use)h
(the)g Fx(IOPL)e Fz(\014eld)i(in)g(the)g Fx(eflags)p
Fz(.)515 3931 y Fk(h)p Fi(off)p 667 3931 V 29 w(mdepShtl::usrio)p
1281 3931 V 31 w(enable)h Fj(implementation.)e Fk(i)p
Fq(\021)598 4022 y Fi(//)39 b(Enables)i(user)f(IO)598
4113 y(inline)g(void)g(off_mdepShtl::usrio_enable\()q(off_)q(mdepP)q
(rocR)q(egs)45 b(*r\))598 4205 y({)676 4296 y(r->p_ts.eflags)e(|=)c
(EFL_IOPL_USER;)598 4387 y(})1885 5255 y Fz(537)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
538 539 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepShtl::usrio)p 1281 523 V 31 w(disable)29 b Fj(implementation.)
f Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Disables)i(user)g(IO)598
706 y(inline)f(void)g(off_mdepShtl::usrio_disable)q(\(off)q(_mdep)q
(Proc)q(Regs)46 b(*r\))598 797 y({)676 888 y(r->p_ts.eflags)d(&=)c
(~EFL_IOPL_USER;)598 980 y(})639 1212 y Fz(As)28 b(of)g(to)r(da)n(y)-7
b(,)27 b Fx(get)p 1243 1212 27 4 v 30 w(next)p 1449 1212
V 29 w(regs)f Fz(is)i(not)g(implemen)n(ted.)515 1328
y Fk(h)p Fi(off)p 667 1328 24 4 v 29 w(mdepShtl::get)p
1203 1328 V 31 w(next)p 1390 1328 V 29 w(regs)g Fj(implementation.)g
Fk(i)p Fq(\021)598 1420 y Fi(//)39 b(Finds)i(the)f(next)g(register)h
(frame)79 b(in)40 b(the)g(shuttle)h(stack)598 1511 y(off_mdepProcRegs)i
(*off_mdepShtl::get_next_regs\(co)q(nst)j(off_mdepProcRegs)c(*r\))598
1602 y({)676 1694 y(\(void\)r;)676 1785 y(return)f(NULL;)598
1876 y(})515 2034 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
2125 y Fi(#include)41 b(<flux/machine/paging.h>)j(//)c(for)g(set_pdbr)
515 2383 y FA(Multipro)s(cessing)29 b(on)j(In)m(tels)515
2536 y Fz(On)27 b(SMP)h(system)f(w)n(e)g(need)h(to)f(lo)r(cate)g(the)h
(curren)n(t)f(sh)n(uttle.)37 b(W)-7 b(e)28 b(ha)n(v)n(e)f(t)n(w)n(o)g
(metho)r(ds:)616 2702 y(1.)41 b(A)32 b(w)n(ord)f(in)h(the)g(b)r(ottom)g
(of)f(the)h(k)n(ernel)f(stac)n(k)g(can)g(b)r(e)h(used)g(to)f(k)n(eep)g
(a)g(p)r(oin)n(ter)722 2802 y(to)e(the)g(curren)n(t)f(sh)n(uttle.)42
b(If)29 b(w)n(e)g(main)n(tain)f(k)n(ernel)g(stac)n(ks)g(aligned)g(to)h
(a)f(m)n(ultiple)722 2901 y(of)d(a)f(giv)n(en)g(v)-5
b(alue)25 b(\()p Fx(OFF)p 1475 2901 27 4 v 30 w(MDEP)p
1681 2901 V 30 w(KSTK)p 1887 2901 V 30 w(MAX)p Fz(\))f(w)n(e)g(can)h
(\014nd)g(the)g(b)r(ottom)g(of)g(the)g(stac)n(k)722 3001
y(b)n(y)j(simple)f(arithmetic.)722 3134 y Fk(h)p Fj(Other)i(public)e
(metho)l(ds)i(of)e Fi(off)p 1700 3134 24 4 v 29 w(mdepShtl)j
Fj(with)d(\014xe)l(d)i(kernel)f(stacks.)h Fk(i)p Fq(\021)805
3225 y Fi(static)41 b(off_Shtl)g(*self\(void\))h({)884
3316 y(return)e(\(off_Shtl*\)\()i(\(get_esp\(\)&OFF_MDEP_KSTK_MSK)q(\))
j(+)1708 3408 y(OFF_MDEP_KSTK_MAX-sizeof\(off_Sh)q(tl*\))h(\);)805
3499 y(})1885 5255 y Fz(538)p eop
PStoPSsaved restore
%%Page: (540,541) 271
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
539 540 bop 616 523 a Fz(2.)41 b(Alternativ)n(ely)-7
b(,)25 b(the)h(curren)n(t)e(pro)r(cessor)e(is)j(ask)n(ed)f(for)g(the)h
(p)r(oin)n(ter)g(to)g(the)g(curren)n(t)722 623 y(sh)n(uttle.)37
b(It)28 b(can)g(k)n(eep)f(suc)n(h)g(p)r(oin)n(ter.)639
789 y(W)-7 b(e)28 b(emplo)n(y)f(the)h(last)f(one.)639
888 y(T)-7 b(o)26 b(supp)r(ort)g(m)n(ultiprogramming)f(on)h(In)n(tels)g
(w)n(e)g(use)g(a)g(single)g(In)n(tel)g(task)g(state)g(seg-)515
988 y(men)n(t)d(\(TSS\).)h(Suc)n(h)f(TSS)g(is)g(pro)n(vided)f(b)n(y)h
(the)h(OSKit)e(\(in)i Fx(base)p 2579 988 27 4 v 30 w(tss)p
Fz(,)f(of)g(t)n(yp)r(e)g Fx(x86)p 3191 988 V 30 w(tss)p
Fz(\))515 1088 y(and)k(it)h(is)g(encapsulated)f(in)h(the)f(mac)n(hine)h
(dep)r(enden)n(t)g(sh)n(uttle)g(service.)639 1187 y(The)i(TSS)g(is)f
(only)g(used)h(to)f(setup)h(the)g(k)n(ernel)e(stac)n(k)h(automatically)
f(on)h(traps)g(and)515 1287 y(in)n(terrupts,)i(th)n(us)h(the)f(OSKit)g
Fx(base)p 1704 1287 V 30 w(tss)f Fz(is)h(shared)f(and)h(register)f
(frames)g(are)h(k)n(ept)g(in)515 1386 y(the)d(k)n(ernel)e(stac)n(ks.)
639 1486 y(Con)n(text)31 b(switc)n(h)g(is)g(done)f(b)n(y)h(hand.)47
b(It)32 b(has)e(to)h(b)r(e)g(concerned)f(only)h(ab)r(out)g(k)n(ernel)
515 1586 y(state,)k(b)r(ecause)e(user)g(state)g(is)h(handled)f
(automatically)g(b)n(y)g(the)h(in)n(terrupt)f(pro)r(cedure)515
1685 y(with)28 b(some)f(help)h(from)f(the)h(hardw)n(are.)639
1785 y(When)i(ab)r(out)f(to)g(con)n(text)f(switc)n(h,)i(w)n(e)f(push)g
(the)g(k)n(ernel)f(registers)g(in)n(to)h(the)g(k)n(ernel)515
1885 y(stac)n(k)22 b(and)h(store)f(b)r(oth)i(the)f(new)g(\(k)n(ernel\))
g(stac)n(k)f(p)r(oin)n(ter)h(and)g(the)g(p)r(oin)n(ter)g(to)g(the)h(sa)
n(v)n(ed)515 1984 y(k)n(ernel)i(registers)g(in)i(the)g(mac)n(hine)f
(dep)r(enden)n(t)i(sh)n(uttle.)515 2117 y Fk(h)p Fj(Other)f(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 2117 24 4 v 29 w(mdepShtl)p
Fj(.)g Fk(i)p Fq(\021)598 2208 y Fi(off_mdepStck)238
b(s_ksp;)315 b(//)40 b(Kernel)g(stack)h(pointer)598 2300
y(off_mdepProcRegs)i(*s_kregs;)237 b(//)40 b(Saved)g(kernel)h
(registers)515 2474 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
2565 y Fi(#include)41 b(<klib/mdep/mStck.h>)639 2707
y Fz(Then)30 b(\(after)f(adjusting)g(sh)n(uttle)g(prop)r(erties\))g(w)n
(e)f(switc)n(h)h(the)h(mac)n(hine)e(dep)r(enden)n(t)515
2806 y(part)d(of)i(a)f(sh)n(uttle)g(b)n(y)g(reloading)f(a)h(previously)
f(sa)n(v)n(ed)f(set)j(of)f(k)n(ernel)f(registers.)35
b(W)-7 b(e)26 b(can)515 2906 y(\014nd)i(them)g(b)n(y)f(lo)r(oking)g(at)
g(the)h Fx(s)p 1592 2906 27 4 v 31 w(ksp)f Fz(mem)n(b)r(er)g(stored)g
(b)r(efore.)639 3005 y(This)41 b(pro)r(cess)f(has)h(to)g(b)r(e)g(done)g
(with)g(in)n(terrupts)g(cleared)f(and)h(the)g Fx(esp0)e
Fz(\(ring)515 3105 y(0)e(stac)n(k\))f(mem)n(b)r(er)i(of)f(the)h
Fx(base)p 1615 3105 V 30 w(tss)e Fz(needs)h(to)g(b)r(e)h(up)r(dated)g
(b)r(efore)f(in)n(terrupts)g(are)515 3205 y(enabled)27
b(to)h(the)g(real)e(\(i.e.)38 b(curren)n(t\))27 b(v)-5
b(alue.)639 3304 y(Mac)n(hine)31 b(dep)r(enden)n(t)g(con)n(text)f
(switc)n(h)h(is)g(p)r(erformed)f(b)n(y)g Fx(switch)p
2811 3304 V 29 w(to)p Fz(.)46 b(It)31 b(is)f(called)515
3404 y(from)37 b(the)g(outgoing)f(sh)n(uttle)h(with)h(the)g(mac)n(hine)
e(dep)r(enden)n(t)i(part)f(of)g(the)h(incoming)515 3504
y(sh)n(uttle.)515 3636 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)
e Fi(off)p 1493 3636 24 4 v 29 w(mdepShtl)p Fj(.)i Fk(i)o
Fq(\021)598 3728 y Fi(//)39 b(Does)i(a)e(context)i(switch)f(to)g(the)g
(other)g(shuttle.)598 3819 y(void)g(switch_to\(off_mdepShtl)k
(*other\);)1885 5255 y Fz(539)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
540 541 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepShtl::switch)p 1320 523 V 31 w(to)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Does)i(a)e(context)i(switch)f(from)
h(the)e(other)i(shuttle.)598 706 y(void)f
(off_mdepShtl::switch_to\(off_md)q(epSh)q(tl)45 b(*other\))598
797 y({)676 888 y(off_mdepProcRegs)e(kregs;)276 b(//)40
b(Buffer)g(to)g(save)g(registers.)676 980 y(off_ShtlCtx)i
(ctx\(&kregs\);)238 b(//)40 b(The)g(new)g(topmost)g(kernel)h(context)
676 1071 y(off_Processor::clri\(\);)676 1162 y(register_t)h
(old_esp0=base_tss.esp0;)676 1254 y(s_kregs=&kregs;)676
1345 y(\(void\)&s_kregs;)676 1436 y(push_ctx\(&ctx\);)676
1528 y(kregs.set_ctx\(get_pdbr\(\)\);)676 1619 y(//printf\("[esp)h
(\045x)c(ctx)h(\045x->\045x]",get_esp\(\),&kregs,)676
1710 y(//)197 b(\(\(other\)?other->s_ctx->c_regs:)q(0\)\);)676
1802 y(if)40 b(\(!off_mdep_save_kregs\(s_kregs\))q(\){)755
1893 y(assert\(other)i(&&)d(other->s_ctx)j(&&)e
(other->s_ctx->c_regs\);)755 1984 y Fk(h)p Fj(Save)28
b(other)h(machine)f(dep)l(endent)h(state.)g Fk(i)755
2076 y Fi(if)39 b(\(get_pdbr\(\)!=other->s_kregs-)q(>get)q(_ctx)q
(\(\)\))833 2167 y(set_pdbr\(other->s_kregs->get_)q(ctx\()q(\)\);)755
2258 y(//printf\("\(\045x,\045x\)",s_kregs->p_t)q(s.es)q(p,ot)q(her->)q
(s_ct)q(x->c_)q(regs)q(->p_)q(ts.es)q(p\);)755 2350 y
(off_mdep_load_kregs\(other->s_ct)q(x->c)q(_reg)q(s,TRU)q(E\);)755
2441 y(otsan\(\);)676 2532 y(})676 2623 y Fk(h)p Fj(L)l(o)l(ad)28
b(other)h(machine)f(dep)l(endent)i(state.)f Fk(i)676
2715 y Fi(base_tss.esp0=old_esp0;)676 2806 y(pop_ctx\(\);)676
2897 y(//printf\("[esp)43 b(\045x)c(ctx)h(\045x)g(ds)g
(\045x]",get_esp\(\),&kregs,get_ds\(\)\))q(;)676 2989
y(off_Processor::seti\(\);)598 3080 y(})515 3335 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(implementation)f(dep)l
(endencies.)i Fk(i)p Fq(\021)598 3426 y Fi(#include)41
b(<flux/machine/base_tss.h>)598 3517 y(#include)g(<shtl/mdep/kregs.h>)
161 b(//)40 b(for)g(save_)g(and)g(load_kregs)639 3653
y Fz(A)28 b(v)-5 b(arian)n(t)27 b(is)g(pro)n(vided)g(to)g(switc)n(h)h
(for)f(the)h(v)n(ery)e(\014rst)i(time.)515 3766 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3766
V 29 w(mdepShtl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 3858
y Fi(//)39 b(Does)i(a)e(context)i(switch)f(to)g(this)g(shuttle.)598
3949 y(void)g(switch_to\(void\);)639 4071 y Fz(It)28
b(simply)g(reloads)e(the)i(pro)r(cessor)d(state)j(with)g(the)g(new)g
(sh)n(uttle)f(registers.)515 4184 y Fk(h)p Fi(off)p 667
4184 V 29 w(mdepShtl::switch)p 1320 4184 V 31 w(to)h
Fj(implementation.)g Fk(i)p Fz(+)o Fq(\021)598 4276 y
Fi(//)39 b(Switches)i(to)f(this)g(shuttle)598 4367 y(void)g
(off_mdepShtl::switch_to\(void\))598 4458 y({)676 4550
y(off_Processor::clri\(\);)676 4641 y(if)g
(\(get_pdbr\(\)!=s_kregs->get_ctx\()q(\)\))755 4732 y
(set_pdbr\(s_kregs->get_ctx\(\)\);)676 4824 y
(off_mdep_load_kregs\(s_kregs,)q(TRUE\))q(;)676 4915
y(otsan\(\);)598 5006 y(})1885 5255 y Fz(540)p eop
PStoPSsaved restore
%%Page: (542,543) 272
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
541 542 bop 639 523 a Fz(Where)28 b(w)n(e)f(used)h(a)f(couple)g(of)h
(lo)n(w-lev)n(el)e(routines)g(to)i(do)f(the)h(dirt)n(y)f(w)n(ork.)515
639 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(kernel)g(r)l(e)l
(gister)g(switching.)f Fk(i)p Fq(\021)598 731 y Fi(//)39
b(Save)i(current)f(registers)i(in)d(the)h(buffer)h(at)f(kregs.)598
822 y(//)f(Returns)i(zero)f(when)h(called)f(to)g(save)g(registers,)598
913 y(//)f(non-zero)i(when)g(registers)g(are)f(reloaded.)598
1005 y(volatile)h(int)f(off_mdep_save_kregs\(volatile)45
b(off_mdepProcRegs)e(*kregs\);)598 1187 y(//)c(Load)i(previously)g
(saved)f(registers)i(from)e(kregs.)598 1279 y(//)f(It)h(should)h(never)
f(return)h(and)f(the)f(previous)j(off_mdep_save_kregs)598
1370 y(//)d(will)i(return)f(with)g(the)g(given)h(code)f(after)g
(reload.)598 1461 y(volatile)h(void)f(off_mdep_load_kregs\(volatile)46
b(off_mdepProcRegs)c(*kregs,)1931 1553 y(volatile)g(int)d(code\);)515
1710 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(kernel)g(r)l(e)l
(gister)g(switching)g(dep)l(endencies.)g Fk(i)p Fq(\021)598
1802 y Fi(#include)41 b(<flux/types.h>)356 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)639 1943 y Fz(The)h(implemen)n(tation)f(uses)h(a)
f(little)h(bit)g(of)g(assem)n(bly)e(glue)h(whic)n(h)h(sa)n(v)n(es)d(ev)
n(ery)515 2042 y(register)26 b(in)n(to)h(a)g Fx(mdepProcRegs)c
Fz(bu\013er.)37 b(It)28 b(returns)f Fx(0)p Fz(,)g(i.e.)37
b Fx(FALSE)26 b Fz(to)h(the)h(caller.)515 2175 y Fk(h)p
Fi(off)p 667 2175 24 4 v 29 w(mdep)p 852 2175 V 29 w(save)p
1037 2175 V 29 w(kregs)g Fj(implementation.)g Fk(i)p
Fq(\021)598 2267 y Fi(ENTRY\(off_mdep_save_kregs\))598
2358 y(ENTRY\(_off_mdep_save_kregs\))755 2449 y(movl)40
b(4\(\045esp\),\045eax)434 b(/*)40 b(fetch)g(buffer)h(\(trap_state\))h
(*/)755 2540 y(movl)e(\045edi,16\(\045eax\))395 b(/*)40
b(save)g(edi)g(in)f(trap_state->edi)k(*/)755 2632 y(movl)d
(\045esi,20\(\045eax\))395 b(/*)40 b(save)g(esi)g(in)f(trap_state->esi)
k(*/)755 2723 y(movl)d(\045ebp,24\(\045eax\))395 b(/*)40
b(save)g(ebp)g(in)f(trap_state->ebp)k(*/)755 2814 y(movl)d
(\045ebx,32\(\045eax\))395 b(/*)40 b(save)g(ebx)g(in)f(trap_state->ebx)
k(*/)755 2906 y(movl)d(\045edx,36\(\045eax\))395 b(/*)40
b(save)g(edx)g(in)f(trap_state->edx)k(*/)755 2997 y(movl)d
(\045ecx,40\(\045eax\))395 b(/*)40 b(save)g(ecx)g(in)f(trap_state->ecx)
k(*/)755 3088 y(movl)d($1,44\(\045eax\))473 b(/*)40 b(save)g(0)118
b(in)39 b(trap_state->eax)k(*/)755 3180 y(pushf)903 b(/*)40
b(save)g(flags...)80 b(*/)755 3271 y(popl)40 b(\045ecx)755
3362 y(movl)g(\045ecx,64\(\045eax\))395 b(/*)275 b(...in)40
b(trap_state->eflags)k(*/)755 3454 y(popl)c(\045ecx)746
b(/*)40 b(save)g(caller)g(eip...)512 b(*/)755 3545 y(movl)40
b(\045ecx,56\(\045eax\))395 b(/*)275 b(...in)40 b(trap_state->eip)161
b(*/)755 3636 y(movl)40 b(\045esp,68\(\045eax\))395 b(/*)40
b(save)g(esp)g(in)f(trap_state->esp)161 b(*/)755 3728
y(movl)40 b($0,\045eax)629 b(/*)40 b(return)g(FALSE...)630
b(*/)755 3819 y(jmp)79 b(*\045ecx)707 b(/*)275 b(...to)40
b(the)g(caller)355 b(*/)1885 5255 y Fz(541)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
542 543 bop 639 523 a Fz(Note)21 b(ho)n(w)f Fx(off)p
1136 523 27 4 v 30 w(mdep)p 1342 523 V 30 w(load)p 1548
523 V 30 w(kregs)f Fz(will)i(reload)e(a)i(register)e(set)i(as)f(sa)n(v)
n(ed)f(b)n(y)i(the)g(pre-)515 623 y(vious)e(routine.)34
b(It)20 b(returns)f(the)i(giv)n(en)e(return)g(v)-5 b(alue)20
b(to)g(the)g(caller)f(of)h Fx(mdep)p 2908 623 V 29 w(save)p
3113 623 V 30 w(kregs)p Fz(.)515 756 y Fk(h)p Fi(off)p
667 756 24 4 v 29 w(mdep)p 852 756 V 29 w(load)p 1037
756 V 29 w(kregs)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
847 y Fi(ENTRY\(off_mdep_load_kregs\))755 938 y(movl)118
b(8\(\045esp\),\045edx)356 b(/*)40 b(fetch)g(ret)g(value)g(*/)755
1029 y(movl)118 b(4\(\045esp\),\045eax)356 b(/*)40 b(fetch)g(buffer)h
(\(trap_state\))355 b(*/)755 1121 y(movl)79 b(16\(\045eax\),\045edi)356
b(/*)40 b(fetch)g(edi)g(from)g(trap_state->edi)160 b(*/)755
1212 y(movl)79 b(20\(\045eax\),\045esi)356 b(/*)40 b(fetch)g(esi)g
(from)g(trap_state->esi)160 b(*/)755 1303 y(movl)79 b
(24\(\045eax\),\045ebp)356 b(/*)40 b(fetch)g(ebp)g(from)g
(trap_state->ebp)160 b(*/)755 1395 y(movl)79 b(32\(\045eax\),\045ebx)
356 b(/*)40 b(fetch)g(ebx)g(from)g(trap_state->ebx)160
b(*/)755 1486 y(movl)79 b(40\(\045eax\),\045ecx)356 b(/*)40
b(fetch)g(ecx)g(from)g(trap_state->ecx)160 b(*/)755 1577
y(pushl)40 b(64\(\045eax\))551 b(/*)40 b(fetch)197 b(from)40
b(trap_state->eflags)j(*/)755 1669 y(popf)942 b(/*)275
b(eflags)864 b(*/)755 1760 y(movl)79 b(68\(\045eax\),\045esp)356
b(/*)40 b(fetch)g(esp)g(from)g(trap_state->esp)160 b(*/)755
1851 y(pushl)40 b(56\(\045eax\))551 b(/*)40 b(set)g(the)g(caller)g(eip)
g(to)g(trap_state->eip)i(*/)755 1943 y(pushl)e(\045edx)707
b(/*)40 b(save)g(ret)g(value)785 b(*/)755 2034 y(movl)79
b(36\(\045eax\),\045edx)356 b(/*)40 b(fetch)g(edx)g(from)g
(trap_state->edx)160 b(*/)755 2125 y(popl)79 b(\045eax)707
b(/*)40 b(return)g(ret)g(value)707 b(*/)755 2217 y(ret)981
b(/*)157 b(to)40 b(the)g(caller)h(eip)549 b(*/)598 2308
y(ENTRY\(_off_mdep_load_kregs\))639 2540 y Fz(T)-7 b(o)21
b(startup)g(a)f(new)h(sh)n(uttle,)i(a)d(k)n(ernel)h(stac)n(k)f(is)g
(allo)r(cated)h(and)g(a)f(fak)n(e)g(k)n(ernel)h(register)515
2640 y(frame)f(is)g(pushed)h(on)f(it.)35 b(Suc)n(h)21
b(frame)f(corresp)r(onds)e(to)j(the)f(execution)h(of)f(the)h
Fx(shtl)p 3180 2640 27 4 v 30 w(main)515 2740 y Fz(routine.)515
2873 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2873 24 4 v 29 w(mdepShtl)p Fj(.)i Fk(i)o
Fq(\021)598 2964 y Fi(//)39 b(Setup)i(an)e(initial)i(kernel)g(stack)f
(for)g(this)g(shuttle)h(so)f(that)g(it)g(calls)598 3055
y(//)f(upcall)i(to)f(enter)g(userland)h(with)f(the)g(program)h(counter)
g(and)f(stack)g(pointer)598 3147 y(//)f(specified.)598
3238 y(void)h(setup_stack\(void)j(*s,)d(register_t)h(sp,)f(register_t)i
(pc\);)639 3379 y Fz(The)32 b(argumen)n(ts)e(\(pushed)i(b)n(y)g(hand)f
(on)h(the)g(stac)n(k\))f(will)h(mak)n(e)f(it)h(to)f(call)g
Fx(upcall)515 3479 y Fz(to)36 b(transfer)g(the)h(con)n(trol)e(to)h(the)
h(user)f(lev)n(el)g(en)n(try)g(p)r(oin)n(t)h(using)f(the)h(supplied)g
(stac)n(k)515 3578 y(and)29 b(program)e(coun)n(ter)h(\(whic)n(h)h(are)f
(those)h(sp)r(eci\014ed)g(as)g(initial)g(v)-5 b(alues)29
b(b)n(y)f(the)i(sh)n(uttle)515 3678 y(creator\).)44 b(Up)r(on)31
b Fx(upcall)d Fz(return,)j(the)g Fx(terminated)26 b Fz(k)n(ernel)k
(routine)g(is)g(called,)h(whic)n(h)515 3778 y(simply)g(destro)n(ys)f
(the)h(sh)n(uttle|this)h(happ)r(ens)f(only)g(when)g(the)h(user)e
Fx(main)g Fz(pro)r(cedure)515 3877 y(is)d(terminated.)639
3977 y(W)-7 b(e)28 b(are)f(no)n(w)g(in)h(p)r(osition)f(to)h(create)e(a)
h(sh)n(uttle)h(for)f(In)n(tel)h(arc)n(hitectures.)515
4093 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4093 V 29 w(mdepShtl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
4184 y Fi(//)39 b(Creates)i(a)f(machine)h(dependent)g(shuttle.)598
4276 y(off_mdepShtl\(void)i(*s=NULL,)e(register_t)g(pc=0,)g(register_t)
g(sp=0,)g(register_t)g(ksp=0\);)1885 5255 y Fz(542)p
eop
PStoPSsaved restore
%%Page: (544,545) 273
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
543 544 bop 639 523 a Fz(W)-7 b(e)28 b(simply)g(setup)g(the)g(k)n
(ernel)e(stac)n(k.)515 639 y Fk(h)p Fi(off)p 667 639
24 4 v 29 w(mdepShtl::off)p 1203 639 V 31 w(mdepShtl)j
Fj(implementation.)e Fk(i)p Fq(\021)598 731 y Fi(//)39
b(Creates)i(a)f(machine)h(dependent)g(shuttle.)598 822
y(off_mdepShtl::off_mdepShtl\(voi)q(d)k(*s,)1657 913
y(register_t)c(pc,)f(register_t)i(sp,)e(register_t)h(ksp\))f(:)676
1005 y Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e
(of)g Fi(off)p 2090 1005 V 29 w(mdepShtl)p Fj(.)g Fk(i)p
Fi(,)676 1096 y(s_ctx\(NULL\),s_ksp\(ksp\),s_kre)q(gs\(0\))598
1187 y({)676 1279 y(if)40 b(\(sp\))755 1370 y(setup_stack\(s,sp,pc\);)
598 1461 y(})515 1710 y Fk(h)p Fi(off)p 667 1710 V 29
w(mdepShtl::create)p 1320 1710 V 31 w(stack)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 1802 y Fi(//)39 b(Creates)i(an)f(initial)h(kernel)f
(stack)h(for)f(a)f(shuttle)i(so)f(that)g(it)f(enters)598
1893 y(//)g(userland)i(with)g(the)f(program)g(counter)h(and)f(stack)g
(pointer)h(specified.)598 1984 y(void)f
(off_mdepShtl::setup_stack\(void)46 b(*s,)40 b(register_t)h(sp,)f
(register_t)i(pc\))598 2076 y({)676 2167 y(register_t)g(inital_sp;)676
2258 y(off_mdepProcRegs)h(*r;)676 2350 y(s_kregs=)e(r)f(=)f
(new\(\(off_mdepProcRegs*\)s_ksp)q(.allo)q(ca\(s)q(izeof)q(\(off)q
(_mde)q(pProc)q(Regs)q(\)\)\))1265 2441 y(off_mdepProcRegs;)676
2532 y(s_ksp.push\(pc\);)592 b(//)40 b(User)g(pc)157
b(\(upcall)41 b(arg\))676 2623 y(s_ksp.push\(sp\);)592
b(//)40 b(User)g(sp)157 b(\(upcall)41 b(arg\))676 2715
y(s_ksp.push\(\(register_t\)s\);)676 2806 y(s_ksp.push\(0\);)631
b(//)40 b(fake)g(return)g(eip)g(for)g(upcall\(\))676
2897 y(inital_sp=s_ksp;)j(//was)d(r->p_ts.cr2=inital_sp=s_ksp)q(;)676
2989 y Fk(h)p Fj(Setup)29 b(initial)d(c)l(ontext.)k Fk(i)676
3080 y Fi(r->set_pc\(\(register_t\)off_sh)q(tl_ma)q(in\);)676
3171 y(r->set_sp\(inital_sp\);)676 3263 y
(r->set_flags\(r->get_flags\(\))46 b(&~EFL_IF\);)676
3354 y(s_ksp=inital_sp;)598 3445 y(})515 3711 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(implementation)f(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 3802 y Fi(#include)41
b(<prtl/upcall.h>)639 3944 y Fz(After)31 b(the)h(stac)n(k)d(is)i
(setup,)h(the)f(new)g(sh)n(uttle)g(is)g(ready)e(for)i(execution.)46
b(Whenev)n(er)515 4043 y(it)28 b(\014nishes,)f Fx(shtl)p
1093 4043 27 4 v 30 w(terminated)d Fz(is)j(called.)515
4259 y FA(Math)32 b(copro)s(cessor)f(on)h(In)m(tels)515
4412 y Fz(T)-7 b(o)26 b(supp)r(ort)g(co-pro)r(cessors)d(a)j(new)g
(\014eld)h(m)n(ust)g(b)r(e)f(included)h(in)g(the)g(x86)e(sh)n(uttle)i
(struc-)515 4512 y(ture)g(to)h(k)n(eep)f(the)h(co-pro)r(cessor)c
(state.)515 4628 y Fk(h)p Fj(Other)k(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4628 24 4 v 29 w(mdepShtl)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 4719 y Fi(off_mdepMProcRegs)43 b(s_math;)1885
5255 y Fz(543)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
544 545 bop 639 523 a Fz(What)31 b(has)e(to)h(b)r(e)g(done)g(to)g(supp)
r(ort)f(lazy)h(co-pro)r(cessor)d(switc)n(hing)i(is)h(to)g(sa)n(v)n(e)e
(and)515 623 y(restore)18 b(its)j(state)f(on)f(con)n(text)h(switc)n(h,)
i(but)e(only)g(when)g(strictly)g(needed.)35 b(T)-7 b(o)20
b(kno)n(w)f(when)515 722 y(the)30 b Fx(fpu)f Fz(con)n(text)g(m)n(ust)h
(b)r(e)g(restored)f(w)n(e)g(will)h(k)n(eep)f(trac)n(k)g(of)h
Fx(fpu)f Fz(usage)f(b)n(y)i(means)f(of)515 822 y(a)f(\015ag)g(in)h(the)
g(sh)n(uttle)h(structure.)40 b(Th)n(us)28 b(w)n(e)h(can)f(c)n(hec)n(k)g
(that)h(\015ag)f(to)h(kno)n(w)f(if)h(the)g Fx(fpu)515
922 y Fz(con)n(text)j(m)n(ust)g(b)r(e)h(restored.)49
b(If)33 b(w)n(e)f(are)f(switc)n(hing)h(for)g(the)g(v)n(ery)g(\014rst)g
(time)g(\(i.e.)52 b(the)515 1021 y(ro)r(ot)27 b(sh)n(uttle)g(has)g(b)r
(een)i(just)f(created\))f(w)n(e)g(will)h(not)f(sa)n(v)n(e)f(an)n(y)h
(con)n(text)g(at)h(all.)515 1154 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l
(d)j(metho)l(ds)e(of)e Fi(off)p 1594 1154 24 4 v 29 w(mdepShtl)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 1245 y Fi(inline)40
b(void)g(save_math\(void\);)515 1420 y Fk(h)p Fj(Save)28
b(other)h(machine)f(dep)l(endent)h(state.)g Fk(i)p Fq(\021)598
1511 y Fi(save_math\(\);)515 1685 y Fk(h)p Fi(off)p 667
1685 V 29 w(mdepShtl::save)p 1242 1685 V 31 w(math)f
Fj(implementation.)g Fk(i)p Fq(\021)598 1777 y Fi(inline)40
b(void)g(off_mdepShtl::save_math\(voi)q(d\){)715 1868
y(if)g(\(s_flags)h(&)f(OFF_MDEP_SF_DIRTYFPU\){)833 1959
y(__asm__)h(__volatile__\("fnsave)j(\0450":"=m")d(\(s_math.x87\)\);)833
2051 y(__asm__)g(__volatile__\("fwait"\);)833 2142 y(s_flags)g(&=)f
(~OFF_MDEP_SF_DIRTYFPU;)715 2233 y(})598 2325 y(})515
2499 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(symb)l
(ols.)f Fk(i)p Fq(\021)598 2590 y Fi(const)40 b(unsigned8_t)i
(OFF_MDEP_SF_DIRTYFPU=0x1;)598 2682 y(const)e(unsigned8_t)i
(OFF_MDEP_SF_USEDFPU=0x2;)515 2856 y Fk(h)p Fj(Other)28
b(private)h(memb)l(ers)f(of)g Fi(off)p 1552 2856 V 29
w(mdepShtl)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 2947 y
Fi(unsigned8_t)41 b(s_flags;)515 3122 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 3122 V 29 w(mdepShtl)p Fj(.)i Fk(i)p Fq(\021)598
3213 y Fi(s_flags\(0\))639 3354 y Fz(When)c(w)n(e)g(receiv)n(e)e(the)i
(trap)f(of)h(co-pro)r(cessor)d(not)i(presen)n(t)g(w)n(e)h(will)g(ha)n
(v)n(e)e(to)i(restore)515 3454 y(the)k(co-pro)r(cessor)c(state)1305
3424 y Fp(6)1342 3454 y Fz(.)40 b(W)-7 b(e)29 b(c)n(hec)n(k)e(if)i(the)
g(sh)n(uttle)g(actually)f(did)h(use)f(it)h(and)g(in)f(suc)n(h)515
3553 y(a)f(case)g(restore)g(it.)38 b(If)28 b(this)h(is)e(the)i(v)n(ery)
d(\014rst)i(time)g(this)h(sh)n(uttle)f(used)g(the)g(co-pro)r(cessor)515
3653 y(it)k(will)f(get)g(initialized)h(instead.)48 b(The)32
b(curren)n(t)e(sh)n(uttle)i(will)f(b)r(e)h(found)g(using)f(another)515
3753 y(\014eld)e(in)h(the)g Fx(cpu)e Fz(structure)h(|though)h(w)n(e)f
(should)g(obtain)g(a)g(p)r(oin)n(ter)g(to)h(the)f(mac)n(hine)515
3852 y(dep)r(enden)n(t)f(data)f(of)h(the)g(curren)n(t)e(sh)n(uttle)i
(using)g(a)f(mac)n(hine)g(indep)r(enden)n(t)h(routine.)515
3985 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3985 V 29 w(mdepShtl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
4076 y Fi(//)39 b(Should)i(be)f(hardwired)h(to)f(the)g(machine)g
(dependent)i(trap)e(table.)598 4168 y(inline)g(void)g
(fpu_trap_handler\(void\);)598 4259 y(static)g(inline)h(boolean_t)g
(needs_nofpu\(void\))i({)d(return)g(TRUE;)h(})p 515 4850
1146 4 v 607 4904 a Fm(6)642 4927 y Fl(The)26 b(trap)g(is)f(sen)n(t)i
(the)f(\014rst)g(time)f(the)i(sh)n(uttle)f(uses)g(the)h(co-pro)r
(cessor)f(b)r(ecause)h(w)n(e)f(do)g(not)h(clear)515 5006
y(the)d(\\task)h(switc)n(h")f(bit)g(in)f Fh(eflags)p
Fl(.)1885 5255 y Fz(544)p eop
PStoPSsaved restore
%%Page: (546,547) 274
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
545 546 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepShtl::fpu)p 1203 523 V 31 w(trap)p 1390 523
V 29 w(handler)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
614 y Fi(inline)40 b(void)g(off_mdepShtl::fpu_trap_hand)q(ler\()q
(void\))q({)755 706 y(__asm__)g(__volatile__\("clts"\);)947
b(/*)39 b(FPU)h(state<-ok)i(*/)833 888 y(if)e(\(s_flags)h(&)e
(OFF_MDEP_SF_USEDFPU\))201 b(/*)40 b(restore)g(it)g(*/)951
980 y(__asm__\("frstor)i(\0450":)f(:"m")f(\(s_math.x87\)\);)833
1071 y(else)g({)1766 b(/*)39 b(initialize)j(FPU)e(*/)951
1162 y(__asm__\("fninit"\);)951 1254 y(s_flags)h(|=)e
(OFF_MDEP_SF_USEDFPU|OFF_MDEP)q(_SF_)q(DIRTY)q(FPU;)833
1345 y(})598 1436 y(})639 1577 y Fz(W)-7 b(e)32 b(need)g(to)f(set)g(b)n
(y)g(hand)h(the)g(task)f(switc)n(h)g(bit)h(ev)n(ery)e(time)i(a)f(con)n
(text)g(switc)n(h)g(is)515 1677 y(done|T)-7 b(ask)26
b(state)i(segmen)n(ts)e(are)h(not)h(b)r(eing)f(used)h(for)f(con)n(text)
g(switc)n(hing.)515 1810 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 1810 V 29 w(mdepShtl)p
Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 1901 y Fi(inline)40
b(static)h(void)f(set_tsks\(void\);)515 2076 y Fk(h)p
Fj(L)l(o)l(ad)28 b(other)h(machine)f(dep)l(endent)h(state.)g
Fk(i)p Fq(\021)598 2167 y Fi(set_tsks\(\);)515 2341 y
Fk(h)p Fi(off)p 667 2341 V 29 w(mdepShtl::set)p 1203
2341 V 31 w(tsks)f Fj(implementation.)g Fk(i)o Fq(\021)598
2433 y Fi(inline)40 b(void)g(off_mdepShtl::set_tsks\(void)q(\))45
b({)676 2524 y(__asm__)c(__volatile__)h(\()d("movl)i
(\045\045cr0,\045\045eax\\n\\t")i(\\)1578 2615 y("orl)e
($8,\045\045eax\\n\\t")h(\\)1578 2707 y("movl)f
(\045\045eax,\045\045cr0")h(\\)1578 2798 y(:)e(/*)g(no)f(outputs)i(*/)f
(\\)1578 2889 y(:)g(/*)g(no)f(inputs)i(*/)f(\\)1578 2980
y(:"ax"\);)598 3072 y(})515 3346 y Fn(5.1.17)112 b(Nesting)37
b(sh)m(uttle)f(con)m(texts)515 3499 y Fz(Sh)n(uttles)28
b(con)n(tain)g(references)f(to)g(their)i(top-most)e(pro)r(cessor)f(con)
n(text.)38 b(Suc)n(h)28 b(reference)515 3599 y(is)f(con)n(tained)g
(inside)h(the)g(mac)n(hine)f(dep)r(enden)n(t)h(part,)f(where)g(it)i(is)
e(handled.)515 3731 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3731 V 29 w(mdepShtl)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3823 y Fi(off_ShtlCtx)41 b(*s_ctx;)473 b(//)39
b(Top-most)j(context.)515 3997 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l
(endent)h(shuttle)g(dep)l(endencies.)h Fk(i)p Fz(+)o
Fq(\021)598 4088 y Fi(#include)41 b(<shtl/ShtlCtx.h>)278
b(//)40 b(for)g(off_ShtlCtx)1885 5255 y Fz(545)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
546 547 bop 515 523 a Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 523 24 4 v 29 w(mdepShtl)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Installs)i(a)f(new)g(context)h(as)e
(the)h(top-most.)598 706 y(inline)g(void)g(push_ctx\(off_ShtlCtx)k
(*c\);)598 888 y(//)39 b(Installs)i(a)f(new)g(kernel)g(context)h(as)f
(the)g(top-most.)h(---)f(do)g(not)g(use.)598 980 y(inline)g(void)g
(push_kctx\(off_ShtlCtx)k(*c\);)598 1162 y(//)39 b(Installs)i(a)f(new)g
(context)h(as)e(the)h(top-most)h(saving)g(the)f(current)h(kernel)f
(state.)598 1254 y(inline)g(err_t)h(push_current_ctx\(off_ShtlCtx)k
(*c\);)598 1436 y(//)39 b(Deinstalls)j(the)e(top-most)h(context.)598
1528 y(inline)f(void)g(pop_ctx\(void\);)598 1710 y(//)f(Deinstalls)j
(the)e(top-most)h(kernel)f(context.)i(---)d(do)h(not)g(use.)598
1802 y(inline)g(void)g(pop_kctx\(void\);)598 1984 y(//)f(Deinstalls)j
(the)e(top-most)h(context)g(and)f(reloads)g(it.)598 2076
y(inline)g(void)g(pop_current_ctx\(err_t)k(code=TRUE\);)1885
5255 y Fz(546)p eop
PStoPSsaved restore
%%Page: (548,549) 275
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
547 548 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepShtl::push)p 1242 523 V 31 w(ctx)28 b Fj(and)g
Fi(pop)p 1684 523 V 29 w(ctx)g Fj(implementation.)g Fk(i)o
Fq(\021)598 614 y Fi(//)39 b(Installs)i(a)f(new)g(context)h(as)e(the)h
(top-most.)598 706 y(inline)g(void)g(off_mdepShtl::push_ctx\(off_)q
(Shtl)q(Ctx)45 b(*c\))598 797 y({)676 888 y(assert\(c\);)676
980 y(c->c_nxt=s_ctx;)676 1071 y(s_ctx=c;)598 1162 y(})598
1345 y(//)39 b(Installs)i(a)f(new)g(kernel)g(context)h(as)f(the)g
(top-most.)h(---)f(do)g(not)g(use)598 1436 y(inline)g(void)g
(off_mdepShtl::push_kctx\(off)q(_Sht)q(lCtx)46 b(*c\))598
1528 y({)676 1619 y(assert\(c\);)676 1710 y(c->c_nxt=s_ctx;)676
1802 y(s_ctx=c;)676 1893 y(c->c_regs->p_ts.trapno=\(regi)q(ster_)q
(t\)s_)q(kreg)q(s;)676 1984 y(s_kregs=c->c_regs;)676
2076 y(base_tss.esp0=s_kregs->p_ts.)q(cr2=g)q(et_e)q(sp\(\))q(;)598
2258 y(})598 2441 y(//)39 b(Deinstalls)j(the)e(top-most)h(context.)598
2532 y(inline)f(void)g(off_mdepShtl::pop_ctx\(void\))598
2623 y({)676 2715 y(assert\(s_ctx\);)676 2806 y(s_ctx=s_ctx->c_nxt;)598
2897 y(})598 3080 y(//)f(Deinstalls)j(the)e(top-most)h(kernel)f
(context.)i(---)d(do)h(not)g(use)598 3171 y(inline)g(void)g
(off_mdepShtl::pop_kctx\(void)q(\))598 3263 y({)676 3354
y(assert\(s_ctx\);)676 3445 y(s_kregs=\(off_mdepProcRegs*\)s)q(_ctx-)q
(>c_r)q(egs-)q(>p_ts)q(.tra)q(pno;)676 3537 y(s_ctx=s_ctx->c_nxt;)598
3628 y(})515 3894 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
3985 y Fi(#include)41 b(<flux/machine/base_tss.h>)241
b(//)40 b(for)f(base_tss)1885 5255 y Fz(547)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
548 549 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepShtl::push)p 1242 523 V 31 w(current)p 1546
523 V 30 w(ctx)28 b Fj(and)g Fi(pop)p 1987 523 V 56 w
Fj(implementation.)g Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Installs)i(a)f(new)g(context)h(as)e(the)h(top-most)h(saving)g(the)f
(current)h(kernel)f(state.)598 706 y(inline)g(err_t)h
(off_mdepShtl::push_current_ctx)q(\(off_)q(Shtl)q(Ctx)k(*c\))598
797 y({)676 888 y(assert\(c)c(&&)f(c->c_regs\);)676 980
y(c->c_nxt=s_ctx;)676 1071 y(s_ctx=c;)676 1162 y(return)h
(off_mdep_save_kregs\(c->c_regs\))q(;)598 1254 y(})598
1436 y(//)e(Deinstalls)j(the)e(top-most)h(context)g(and)f(reloads)g
(it.)598 1528 y(inline)g(void)g(off_mdepShtl::pop_current_c)q(tx\(e)q
(rr_t)46 b(code\))598 1619 y({)676 1710 y(off_ShtlCtx)c(*c=s_ctx;)676
1802 y(assert\(c\);)676 1893 y(s_ctx=s_ctx->c_nxt;)676
1984 y(off_mdep_load_kregs\(c->c_reg)q(s,cod)q(e\);)598
2076 y(})515 2341 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
2433 y Fi(#include)41 b(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g
(error)g(numbers)598 2524 y(#include)h(<shtl/mdep/kregs.h>)161
b(//)40 b(for)g(off_mdep_save_kregs)j(and)d(load)639
2665 y Fz(The)h(\014rst)f(con)n(text)h(is)f(not)h(allo)r(cated)f(on)g
(the)h(stac)n(k,)i(it)f(is)e(k)n(ept)h(in)g(the)g(sh)n(uttle)515
2765 y(structure)36 b(so)g(that)h(the)g(mac)n(hine)f(dep)r(enden)n(t)h
(sh)n(uttle)g(could)f(feel)h(free)g(to)f(mangle)g(is)515
2864 y(stac)n(k)25 b(on)g(startup.)36 b(This)26 b(is)g(also)f(a)h(pro)n
(vision)e(for)h(dynamic)h(k)n(ernel)f(stac)n(k)g(allo)r(cation)g(in)515
2964 y(the)j(future.)515 3080 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)
f(of)g Fi(off)p 1552 3080 V 29 w(mdepShtl)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 3171 y Fi(off_ShtlCtx)41 b(s_ctx0;)512
b(//)40 b(Initial)h(context.)515 3329 y Fk(h)p Fj(Setup)28
b(initial)f(c)l(ontext.)i Fk(i)p Fq(\021)598 3421 y Fi
(s_ctx0.c_regs=s_kregs;)598 3512 y(push_current_ctx\(&s_ctx0\);)515
3686 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3686 V 29 w(mdepShtl)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
3778 y Fi(//)39 b(Get)h(a)g(reference)h(to)f(the)g(context.)598
3869 y(inline)g(off_ShtlCtx)i(*get_ctx\(void\);)515 4043
y Fk(h)p Fi(off)p 667 4043 V 29 w(mdepShtl::get)p 1203
4043 V 31 w(ctx)28 b Fj(implementation.)f Fk(i)p Fq(\021)598
4134 y Fi(//)39 b(Get)h(a)g(context)h(iterator.)598 4226
y(inline)f(off_ShtlCtx)i(*off_mdepShtl::get_ctx\(void\))k({)39
b(return)80 b(s_ctx;)41 b(})1885 5255 y Fz(548)p eop
PStoPSsaved restore
%%Page: (550,551) 276
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
549 550 bop 515 523 a FA(Sh)m(uttles)31 b(for)h(ix86)f(based)h(arc)m
(hitectures)h Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
676 y Fz(Mac)n(hine)27 b(dep)r(enden)n(t)h(sh)n(uttle)g(serv)n(er)e(is)
h(in)h Fx(mdep/mShtlSrv.h)p Fz(.)515 809 y Fk(h)p Fj(mdep)f
(mShtlSrv.h*)11 b Fk(i)q Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 992 y Fi(#ifndef)41 b(__MDEP_SHTL_SRV_H)598
1083 y(#define)g(__MDEP_SHTL_SRV_H)i(1)598 1266 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(server)h(dep)l
(endencies.)f Fk(i)598 1448 y Fi(#ifdef)40 b(__KERNEL__)598
1540 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(server.)
g Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598
1814 y(#endif)g(//)g(__MDEP_SHTL_SRV_H)639 1955 y Fz(Mac)n(hine)27
b(dep)r(enden)n(t)i(sh)n(uttles)e(are)g(k)n(ept)g(in)h
Fx(mdep/mShtl.h)23 b Fz(and)k Fx(mdep/mShtl.C)p Fz(.)515
2088 y Fk(h)p Fj(mdep)g(mShtl.h*)11 b Fk(i)p Fq(\021)598
2179 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2270 y Fi(#ifndef)41
b(__MDEP_SHTL_H)598 2362 y(#define)g(__MDEP_SHTL_H)h(1)598
2544 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(dep)l
(endencies.)h Fk(i)598 2727 y(h)p Fj(O\013)d(machine)h(dep)l(endent)h
(shuttle)g(symb)l(ols.)f Fk(i)598 2910 y Fi(#ifdef)40
b(__KERNEL__)598 3001 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle.)g Fk(i)598 3092 y Fi(#endif)40 b(//)g(__KERNEL__)598
3275 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(shuttle)g(late)g
(dep)l(endencies.)g Fk(i)598 3458 y Fi(#ifdef)40 b(__KERNEL__)598
3549 y Fk(h)p Fi(off)p 750 3549 24 4 v 29 w(mdepShtl::usrio)p
1364 3549 V 31 w(enable)29 b Fj(implementation.)e Fk(i)598
3640 y(h)p Fi(off)p 750 3640 V 29 w(mdepShtl::usrio)p
1364 3640 V 31 w(disable)i Fj(implementation.)f Fk(i)598
3731 y(h)p Fi(off)p 750 3731 V 29 w(mdepShtl::get)p 1286
3731 V 31 w(ctx)g Fj(implementation.)f Fk(i)598 3823
y(h)p Fi(off)p 750 3823 V 29 w(mdepShtl::push)p 1325
3823 V 31 w(ctx)h Fj(and)g Fi(pop)p 1767 3823 V 29 w(ctx)g
Fj(implementation.)g Fk(i)598 3914 y(h)p Fi(off)p 750
3914 V 29 w(mdepShtl::push)p 1325 3914 V 31 w(current)p
1629 3914 V 30 w(ctx)g Fj(and)g Fi(pop)p 2070 3914 V
56 w Fj(implementation.)g Fk(i)598 4005 y(h)p Fi(off)p
750 4005 V 29 w(mdepShtl::fpu)p 1286 4005 V 31 w(trap)p
1473 4005 V 29 w(handler)h Fj(implementation.)e Fk(i)598
4097 y Fi(#endif)40 b(//)g(__KERNEL__)598 4279 y(#endif)g(//)g
(__MDEP_SHTL_H)1885 5255 y Fz(549)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
550 551 bop 515 523 a Fk(h)p Fj(mdep)27 b(mShtl.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<shtl/mdep/mShtl.h>)161 b(//)40 b(Exported)h
(interface)598 888 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(shuttle)g(implementation)f(dep)l(endencies.)i Fk(i)598
1162 y(h)p Fi(off)p 750 1162 24 4 v 29 w(mdepShtl::off)p
1286 1162 V 31 w(mdepShtl)f Fj(implementation.)e Fk(i)598
1254 y(h)p Fi(off)p 750 1254 V 29 w(mdepShtl::get)p 1286
1254 V 31 w(next)p 1473 1254 V 29 w(regs)h Fj(implementation.)g
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(mdepShtl::create)p
1403 1345 V 31 w(stack)h Fj(implementation.)e Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(mdepShtl::save)p
1325 1436 V 31 w(math)h Fj(implementation.)g Fk(i)598
1528 y(h)p Fi(off)p 750 1528 V 29 w(mdepShtl::set)p 1286
1528 V 31 w(tsks)g Fj(implementation.)g Fk(i)598 1619
y(h)p Fi(off)p 750 1619 V 29 w(mdepShtl::switch)p 1403
1619 V 31 w(to)g Fj(implementation.)g Fk(i)639 1760 y
Fz(Assem)n(bly)e(glue)g(to)g(sa)n(v)n(e)e(and)i(load)f(k)n(ernel)g
(register)g(is)h(k)n(ept)g(in)g Fx(mdep/kregs.h)21 b
Fz(and)515 1860 y Fx(mdep/kregs.S)p Fz(.)515 1993 y Fk(h)p
Fj(mdep)27 b(kr)l(e)l(gs.h*)11 b Fk(i)r Fq(\021)598 2084
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2175 y Fi(#ifndef)41 b(__MDEP_KREGS_H)598
2267 y(#define)g(__MDEP_KREGS_H)h(1)598 2449 y(#ifndef)f(ASSEMBLER)598
2632 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(kernel)g(r)l(e)l
(gister)g(switching)g(dep)l(endencies.)g Fk(i)598 2814
y Fi(#ifdef)40 b(__KERNEL__)598 2906 y(extern)g("C")g({)676
2997 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)i(kernel)e(r)l(e)l
(gister)i(switching.)e Fk(i)598 3088 y Fi(};)598 3180
y(#endif)40 b(//)g(__KERNEL__)598 3362 y(#endif)g(//)g(ASSEMBLER)598
3545 y(#endif)g(//)g(__MDEP_KREGS_H)515 3719 y Fk(h)p
Fj(mdep)27 b(kr)l(e)l(gs.S*)11 b Fk(i)r Fq(\021)598 3811
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 3993 y Fi(#include)41 b(<shtl/mdep/kregs.h>)
161 b(//)40 b(Exported)h(interface.)598 4085 y(#include)g
(<flux/machine/asm.h>)122 b(//)40 b(for)g(ENTRY)g(et)g(al.)912
4267 y(.text)912 4359 y(P2ALIGN\(TEXT_ALIGN\))598 4450
y Fk(h)p Fi(off)p 750 4450 V 29 w(mdep)p 935 4450 V 29
w(save)p 1120 4450 V 29 w(kregs)28 b Fj(implementation.)g
Fk(i)598 4541 y(h)p Fi(off)p 750 4541 V 29 w(mdep)p 935
4541 V 29 w(load)p 1120 4541 V 29 w(kregs)g Fj(implementation.)g
Fk(i)912 4633 y Fi(P2ALIGN\(TEXT_ALIGN\))1885 5255 y
Fz(550)p eop
PStoPSsaved restore
%%Page: (552,553) 277
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
551 552 bop 515 523 a Fr(5.2)135 b(P)l(ortals)722 705
y FA(NOTE:)27 b Fz(Must)h(pro)n(vide)e(a)i Fx(prtl)e
Fz(instance.)36 b(Implemen)n(t)28 b Fx(upcall)e Fz(to)r(o!)639
888 y(A)39 b(p)r(ortal)f(is)h(a)f(comm)n(unication)g(endp)r(oin)n(t.)71
b(It)39 b(can)f(b)r(e)i(attac)n(hed)e(to)g(a)h(handler)515
987 y(and)31 b(also)g(in)n(v)n(ok)n(ed)f(lik)n(e)i(an)f(in)n(terrupt.)
49 b(P)n(ortals)30 b(are)h(con)n(tained)g(in)h(the)g(p)r(ortal)f(serv)n
(er,)515 1087 y(an)c(instance)g(of)h(the)g Fx(PrtlSrv)c
Fz(class)j(whose)g(main)g(task)g(is)h(to)f(allo)r(cate)g(p)r(ortals.)36
b(Cross-)515 1186 y(domain)20 b(in)n(v)n(o)r(cation)f(is)i(also)e(supp)
r(orted.)34 b(When)21 b(a)g(sh)n(uttle)f Fy(cr)l(osses)28
b Fz(a)20 b(p)r(ortal,)i(the)f(p)r(ortal)515 1286 y(ma)n(y)27
b(cause)f(some)h(of)h(its)g(prop)r(erties)e(to)i(b)r(e)g(adjusted)g
(automatically)-7 b(.)639 1386 y(P)n(ortals)35 b(ma)n(y)h(b)r(e)h(used)
g(to)g(enforce)f(ob)5 b(ject)37 b(access)f(con)n(trol.)63
b(When)37 b(the)h(handler)515 1485 y(is)i(attac)n(hed)f(to)h(the)g(p)r
(ortal,)j(the)d(p)r(ermitted)h(access)d(mo)r(de)i(through)g(this)g(p)r
(ortal)f(is)515 1585 y(sp)r(eci\014ed.)70 b(The)38 b(k)n(ernel)g(do)r
(es)g(not)g(enforce)g(it.)70 b(Instead,)41 b(the)e(access)e(mo)r(de)i
(will)g(b)r(e)515 1685 y(placed)25 b(in)h(a)g(pre-sp)r(eci\014ed)f
(register)f(so)h(that)h(the)g(user)g(handler)f(can)g(c)n(hec)n(k)g(the)
h(v)-5 b(alidit)n(y)515 1784 y(of)34 b(the)h(access.)56
b(F)-7 b(or)33 b(example,)j(a)e(\014le)g(ob)5 b(ject)34
b(ma)n(y)g(create)f(a)h(read-only)f(access)g(p)r(oin)n(t)515
1884 y(using)22 b(a)g(p)r(ortal)g(sp)r(ecifying)h Fx(OFF)p
1551 1884 27 4 v 30 w(OP)p 1669 1884 V 30 w(R)f Fz(as)g(the)h(only)f(p)
r(ermitted)i(access)d(mo)r(de.)35 b(W)-7 b(e)23 b(could)515
1983 y(ha)n(v)n(e)k(omitted)j(this)f(access)e Fx(mode)h
Fz(feature)g(from)h(p)r(ortals,)f(but)h(it)h(do)r(es)e(not)h(c)n(hange)
f(the)515 2083 y(p)r(ortal)f(seman)n(tics)g(and)g(a)n(v)n(oid)f(those)h
(calls)g(whic)n(h)h(will)g(fail)f(to)h(pro)r(ceed)f(further.)515
2315 y Fn(5.2.1)112 b(The)38 b(p)s(ortal)f(serv)m(er)515
2469 y Fz(The)j(main)g(task)f(of)h(the)h(p)r(ortal)e(serv)n(er,)j
Fx(PrtlSrv)p Fz(,)e(is)g(to)g(allo)r(cate)f(p)r(ortals,)k(th)n(us)d(it)
515 2568 y(main)n(tains)27 b(a)g(p)r(ortal)g(allo)r(cator.)515
2701 y Fk(h)p Fj(O\013)g(p)l(ortal)h(server.)h Fk(i)p
Fq(\021)598 2792 y Fi(//)39 b(A)h(portal)g(server.)598
2884 y(//)598 2975 y(class)g(off_PrtlSrv)i(:)d(public)i
(off_AbsCompResource)i({)598 3066 y(public:)676 3158
y(//)d(Returns)h(a)e(pointer)i(to)f(the)g(portal)g(allocator.)676
3249 y(virtual)h(off_PrtlAllocator)i(*get_allocator\(void\);)676
3432 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3432 24 4 v 29 w(PrtlSrv)p Fj(.)i Fk(i)598
3523 y Fi(protected:)676 3614 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h
(metho)l(ds)f(of)e Fi(off)p 1755 3614 V 29 w(PrtlSrv)p
Fj(.)i Fk(i)598 3706 y Fi(private:)676 3797 y(static)41
b(off_PrtlAllocator)i(p_alloc;)159 b(//)39 b(Portal)i(allocator.)676
3888 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 3888 V 29 w(PrtlSrv)p Fj(.)i Fk(i)598 4071
y Fi(};)515 4245 y Fk(h)p Fj(O\013)e(p)l(ortal)h(server)i(dep)l
(endencies.)f Fk(i)p Fq(\021)598 4337 y Fi(#include)41
b(<klib/AbsCompResource.h>)j(//)c(for)g(off_AbsCompResource)598
4428 y(#include)h(<prtl/PrtlAllocator.h>)122 b(//)40
b(for)g(allocated)h(off_PrtlAllocator)598 4519 y(#include)g
(<prtl/Prtl.h>)395 b(//)40 b(for)g(off_Prtl)515 4694
y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(static)f(memb)l(ers.)f
Fk(i)p Fq(\021)598 4785 y Fi(off_PrtlAllocator)43 b
(off_PrtlSrv::p_alloc;)h(//)c(Portal)g(allocator.)1885
5255 y Fz(551)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
552 553 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PrtlSrv::get)p 1164 523 V 30 w(allocator)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Returns)i(a)f(pointer)h(to)e(the)h
(portal)h(allocator.)598 706 y(off_PrtlAllocator)i
(*off_PrtlSrv::get_allocator\(vo)q(id\))598 797 y({)676
888 y(return)e(&p_alloc;)598 980 y(})639 1121 y Fz(Being)24
b(a)h(sub)r(class)f(of)g Fx(CompResource)c Fz(w)n(e)k(m)n(ust)h
(implemen)n(t)g Fx(make)p 2803 1121 27 4 v 30 w(available)c
Fz(and)515 1220 y Fx(is)p 608 1220 V 30 w(local)p Fz(.)515
1337 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1337 24 4 v 29 w(PrtlSrv)p Fj(.)h Fk(i)p
Fq(\021)598 1428 y Fi(//)39 b(We)h(may)g(wish)g(to)g(cache)g(a)g
(resource)h(unit.)598 1519 y(//)e(Returns)i(error)g(code)f(if)f(the)h
(resource)h(is)f(not)g(available.)h(Zero)g(otherwise.)598
1611 y(inline)f(err_t)h(make_available\(off_id_t)j(&u\);)515
1860 y Fk(h)p Fi(off)p 667 1860 V 29 w(PrtlSrv::make)p
1203 1860 V 31 w(available)29 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1951 y Fi(//)39 b(We)h(may)g(wish)g(to)g(cache)g(a)g
(resource)h(unit.)598 2042 y(//)e(Returns)i(error)g(code)f(if)f(the)h
(resource)h(is)f(not)g(available.)h(Zero)g(otherwise.)598
2134 y(inline)f(err_t)h(off_PrtlSrv::make_available\(of)q(f_id_)q(t)k
(&u\))598 2225 y({)676 2316 y Fk(h)p Fj(Bo)l(dy)28 b(of)f
Fi(off)p 1111 2316 V 29 w(CompResource::make)p 1842 2316
V 33 w(available)p Fj(.)i Fk(i)598 2408 y Fi(})515 2673
y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2673 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2765 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i(one?)598
2856 y(inline)f(boolean_t)i(is_local\(const)g(off_prtl_id_t)g(&p\);)515
3030 y Fk(h)p Fi(off)p 667 3030 V 29 w(PrtlSrv::is)p
1125 3030 V 30 w(local)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 3122 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d(local)i
(one?)598 3213 y(inline)f(boolean_t)i(off_PrtlSrv::is_local\(const)j
(off_prtl_id_t)d(&p\))598 3304 y({)755 3396 y(return)e(\()g(p)f(<=)h
(p_alloc.get_length\(\))k(&&)1108 3487 y
(\(p_alloc+p\)->l_prtl.get_id\(\))h(==)40 b(p)f(\);)598
3670 y(})515 3935 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(dep)l
(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 4027 y Fi(#include)41
b(<klib/ids.h>)434 b(//)40 b(for)g(OFF_PRTL_NULL)i(et)d(al.)598
4118 y(#include)i(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 4209 y(#include)h(<klib/err.h>)473
b(//)40 b(for)g(err_t)598 4301 y(#include)h(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 4392 y(#include)h(<klib/Magic.h>)395
b(//)40 b(for)g(magic)g(numbers)639 4533 y Fz(Initially)-7
b(,)28 b(the)g(p)r(ortal)f(serv)n(er)f(is)h(created)g(with)h(default)g
(v)-5 b(alues)27 b(for)h(its)f(mem)n(b)r(ers.)515 4666
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4666 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
4757 y Fi(//)39 b(Creates)i(a)f(portal)g(server.)598
4848 y(off_PrtlSrv\(void\);)1885 5255 y Fz(552)p eop
PStoPSsaved restore
%%Page: (554,555) 278
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
553 554 bop 639 523 a Fz(There)27 b(is)h(a)f(single)g(instance)g(p)r
(er)h(system.)515 639 y Fk(h)p Fj(O\013)f(p)l(ortal)h(server)i(exp)l
(orte)l(d)g(variables.)e Fk(i)p Fq(\021)598 731 y Fi(extern)40
b(off_PrtlSrv)i(prtl;)315 b(//)40 b(Portal)g(server)h(instance)g(for)f
(this)g(node.)515 888 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(glob)
l(al)e(variables.)g Fk(i)o Fq(\021)598 980 y Fi(off_PrtlSrv)41
b(prtl;)590 b(//)40 b(Portal)g(server)h(instance)g(for)f(this)g(node.)
515 1154 y Fk(h)p Fi(off)p 667 1154 24 4 v 29 w(PrtlSrv::off)p
1164 1154 V 30 w(PrtlSrv)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 1245 y Fi(//)39 b(Creates)i(a)f(portal)g(server.)598
1337 y(off_PrtlSrv::off_PrtlSrv\(void\))46 b(:)676 1428
y(off_AbsCompResource\(off_Prot)q(ectio)q(n\(\),)g(OFF_PRTL_NULL,)1461
1519 y(OFF_ID_NULL,)c(OFF_MAGIC_PRTLSRV\),)676 1611 y
Fk(h)p Fj(Initialize)27 b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g
Fi(off)p 2090 1611 V 29 w(PrtlSrv)p Fj(.)g Fk(i)598 1702
y Fi({)39 b(;)h(})639 1934 y Fz(Where)28 b(the)g(magic)f(n)n(um)n(b)r
(er)g(has)g(to)g(b)r(e)h(de\014ned.)515 2051 y Fk(h)p
Fj(O\013)f(magic)g(numb)l(ers.)i Fk(i)p Fq(\021)598 2142
y Fi(OFF_MAGIC_PRTLSRV,)43 b(//)d(PrtlSrv)h(magic)f(nb.)639
2267 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)
g(implemen)n(tation)f(of)h Fx(Magic::nameof)p Fz(.)515
2383 y Fk(h)p Fi(off)p 667 2383 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 2383 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 2474 y Fi(case)40 b(OFF_MAGIC_PRTLSRV:)676
2565 y(return)h("off_PrtlSrv";)639 2690 y Fz(P)n(ortal)26
b(serv)n(er)g(users)g(can)i(c)n(hec)n(k)e(their)i(references)e(using)i
(this)g(metho)r(d.)515 2806 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2806 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 2897 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f
(PrtlSrv?)598 2989 y(inline)h(boolean_t)i(valid\(void\))f(const;)515
3147 y Fk(h)p Fi(off)p 667 3147 V 29 w(PrtlSrv::valid)30
b Fj(implementation.)e Fk(i)o Fq(\021)598 3238 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(PrtlSrv?)598 3329 y(inline)h
(boolean_t)i(off_PrtlSrv::valid\(void\))i(const)598 3421
y({)39 b(return)i(get_magic\(\))h(==)d(OFF_MAGIC_PRTLSRV;)44
b(})639 3653 y Fz(After)28 b(instan)n(tiation,)f Fx(start)f
Fz(should)h(b)r(e)h(used)g(to)f(start)g(p)r(ortal)g(serv)n(er)f(op)r
(eration.)515 3786 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3786 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3877 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)
g(portal)h(server.)598 3968 y(err_t)f(start\()h(const)f
(off_mdepPrtlSrv)j(&mdep,)d(const)h(off_id_t)g(&id)f(\);)515
4234 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(dep)l(endencies.)f
Fk(i)p Fz(+)o Fq(\021)598 4325 y Fi(#include)41 b
(<prtl/mdep/mPrtlSrv.h>)j(//)c(for)g(off_mdepPrtlSrv)1885
5255 y Fz(553)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
554 555 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PrtlSrv::start)30 b Fj(implementation.)e Fk(i)o
Fq(\021)598 614 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)g
(portal)h(server.)598 706 y(err_t)f(off_PrtlSrv::start\()k(const)c
(off_mdepPrtlSrv)j(&mdep,)d(const)h(off_id_t)g(&id)f(\))598
797 y({)676 888 y(assert\(valid\(\)\);)676 980 y(set_id\(id\);)676
1071 y Fk(h)p Fj(Initialize)27 b Fi(PrtlSrv::p)p 1423
1071 V 30 w(alloc)p Fj(.)h Fk(i)676 1254 y(h)p Fj(Start)h(other)g(memb)
l(ers)g(of)e Fi(off)p 1629 1254 V 29 w(PrtlSrv)i Fj(ac)l(c)l(or)l(ding)
g(to)f Fi(mdep)p Fj(.)g Fk(i)676 1436 y Fi(kcout<<)41
b("Prtl)119 b(#")40 b(<<)f(id)h(<<)g(")f(started."<<)j(nl;)676
1528 y(return)f(EOK;)598 1710 y(})515 1885 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(server)i(dep)l(endencies.)f Fk(i)p Fz(+)o
Fq(\021)598 1976 y Fi(#include)41 b(<assert.h>)512 b(//)40
b(for)g(assert)598 2067 y(#include)h(<klib/str.h>)434
b(//)40 b(for)g(kcout.)639 2208 y Fz(A)22 b(new)f(mem)n(b)r(er,)h
Fx(p)p 1272 2208 27 4 v 31 w(mdep)e Fz(stores)f(an)n(y)i(b)r(o)r(ot)g
(time)g(mac)n(hine)g(dep)r(enden)n(t)h(information)515
2308 y(whic)n(h)27 b(migh)n(t)h(b)r(e)g(needed)g(b)n(y)f(the)h(p)r
(ortal)f(serv)n(er.)515 2424 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 2424 24 4 v 29 w(PrtlSrv)p Fj(.)g
Fk(i)p Fq(\021)598 2516 y Fi(off_mdepPrtlSrv)42 b(p_mdep;)355
b(//)40 b(Machine)h(dependent)g(info.)515 2673 y Fk(h)p
Fj(Start)29 b(other)g(memb)l(ers)f(of)f Fi(off)p 1467
2673 V 29 w(PrtlSrv)i Fj(ac)l(c)l(or)l(ding)g(to)g Fi(mdep)p
Fj(.)e Fk(i)p Fq(\021)598 2765 y Fi(p_mdep=mdep;)639
2906 y Fz(Initially)-7 b(,)45 b(b)r(efore)40 b(the)h(p)r(ortal)f(serv)n
(er)f(is)i(started,)i(it)f(is)e(initialized)h(with)h(default)515
3005 y(v)-5 b(alues.)515 3122 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 3122 V 29 w(PrtlSrv)p Fj(.)i Fk(i)p Fq(\021)598
3213 y Fi(p_mdep\(\),)1885 5255 y Fz(554)p eop
PStoPSsaved restore
%%Page: (556,557) 279
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
555 556 bop 515 523 a Fn(5.2.2)112 b(P)m(ortals)515 676
y Fz(A)38 b(p)r(ortal)g(is)g(an)g(IPC)g(abstraction)f(supp)r(orting)h
(b)r(oth)h(protected)f(con)n(trol)f(transfers)3343 646
y Fp(7)515 776 y Fz(\(PCTs\))27 b(and)h(async)n(hronous)d(message)h
(deliv)n(ering.)515 909 y Fk(h)p Fj(O\013)h(p)l(ortal.)h
Fk(i)p Fq(\021)598 1000 y Fi(//)39 b(An)h(Off)g(portal.)598
1091 y(//)598 1183 y(class)g(off_Prtl)h(:)f(public)g(off_AbsResUnit)j
({)598 1274 y(public:)676 1365 y Fk(h)p Fj(Other)29 b(public)e(metho)l
(ds)i(of)e Fi(off)p 1654 1365 24 4 v 29 w(Prtl)p Fj(.)h
Fk(i)598 1548 y Fi(protected:)676 1639 y Fk(h)p Fj(Other)h(pr)l(ote)l
(cte)l(d)h(metho)l(ds)f(of)e Fi(off)p 1755 1639 V 29
w(Prtl)p Fj(.)h Fk(i)598 1731 y Fi(private:)676 1913
y(off_mdepPrtl)42 b(p_mdep;)394 b(//)40 b(Machine)h(dependent)g(info.)
676 2005 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 2005 V 29 w(Prtl)p Fj(.)h Fk(i)598 2187
y Fi(};)639 2420 y Fz(When)35 b(used)f(for)g(PCTs,)i(the)e(sender)g(sh)
n(uttle)h(c)n(hanges)d(its)j(prop)r(erties)e(on)h(the)h(\015y)515
2519 y(and)f(b)r(ecomes)g(itself)h(a)f(\015o)n(w)g(of)h(con)n(trol)e
(in)i(the)g(receiv)n(er)e(protection)g(domain.)58 b(After)515
2619 y(the)32 b(handler)f(completes,)i(the)f(sh)n(uttle)g(reco)n(v)n
(ers)d(its)j(original)e(state)h(and)h(con)n(tin)n(ues)f(its)515
2719 y(execution.)515 2851 y Fk(h)p Fj(Other)d(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 2851 V 29 w(Prtl)p Fj(.)h Fk(i)p
Fq(\021)598 2943 y Fi(//)39 b(\(Locally\))j(delivers)f(a)e(message)i
(to)f(this)g(portal)g(using)h(a)e(PCT.)598 3034 y(//)g(\(May)i(reset)f
(the)g(stack\))598 3125 y(err_t)g(pct\(const)h(off_shtl_id_t)i
(&sender,)e(vm_size_t)g(msz,)f(vm_size_t)h(&rsz,)990
3217 y(off_Msg)g(*msg,)f(off_Msg)h(*reply,)g(natural_t)g(tmout\);)598
3399 y(//)e(\(Locally\))j(delivers)f(a)e(message)i(to)f(this)g(portal)g
(using)h(a)e(PCT.)598 3491 y(//)g(in-kernel)j(version.)598
3582 y(err_t)e(kpct\(const)i(off_shtl_id_t)g(&sender,)1029
3673 y(vm_size_t)g(msz,)e(vm_size_t)h(&rsz,)1029 3765
y(off_Msg)g(*msg,)f(off_Msg)h(*krep,)g(natural_t)g(tmout\);)598
3947 y(//)e(This)i(version)f(is)g(faster)h(and)f(transfers)h(only)f
(what)g(can)g(be)g(kept)g(in)598 4039 y(//)f(machine)i(registers.)598
4130 y(//)e(\(Locally\))j(delivers)f(a)e(message)i(to)f(this)g(portal)g
(using)h(a)e(PCT.)598 4221 y(err_t)h(pct\(const)h(off_shtl_id_t)i
(&sender,)e(natural_t)g(tmout\);)p 515 4929 1146 4 v
607 4983 a Fm(7)642 5006 y Fl(cross-domain)22 b(in)n(v)n(o)r(cations)j
(with)f(stac)n(k)g(hand-o\013)1885 5255 y Fz(555)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
556 557 bop 639 523 a Fz(Callees)30 b(ma)n(y)-7 b(,)30
b(at)h(an)n(y)e(time,)j(delegate)e(the)h(execution)f(of)g(PCTs)g(to)g
(other)g(serv)n(ers.)515 623 y(In)h(this)g(case,)g(one)g(single)f(sh)n
(uttle)i(can)e(cross)g(sev)n(eral)f(protection)h(domains)h(and)g(come)
515 722 y(bac)n(k)c(directly)g(to)h(its)g(original)e(site.)38
b(T)-7 b(o)27 b(delegate)g(a)g(PCT)h(reply)f(to)h(a)f(di\013eren)n(t)h
(serv)n(er,)515 822 y Fx(pct)p 652 822 27 4 v 30 w(pass)e
Fz(can)h(b)r(e)h(used.)515 955 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 955 24 4 v 29 w(Prtl)p Fj(.)h Fk(i)p
Fz(+)o Fq(\021)598 1046 y Fi(//)39 b(Pass)i(the)e(PCT)h(to)g(a)g
(different)h(portal.)598 1137 y(//)e(Request)i(MUST)f(be)g(issued)h
(from)f(the)g(shuttle)h(who)e(received)i(the)f(original)h(PCT.)598
1229 y(//)e(Reply)i(to)e(the)h(initial)h(PCT)f(will)g(be)g(issued)h
(from)f(there.)g(\(May)g(reset)h(the)f(stack\))598 1320
y(err_t)g(pct_pass\(vm_size_t)j(msz,)e(off_Msg)f(*msg\);)598
1411 y(//)f(A)h(faster)g(version)h(using)g(only)f(registers.)598
1503 y(err_t)g(pct_pass\(void\);)639 1644 y Fz(Finally)-7
b(,)38 b(when)d(no)h(reply)f(is)g(ev)n(er)f(exp)r(ected,)k
Fx(deliver)33 b Fz(should)i(b)r(e)h(used)f(instead.)515
1743 y(It)c(will)g(simply)f(sa)n(v)n(e)f(\(in)j(the)f(callee)f(con)n
(text\))g(what)h(users)f(are)f(unable)i(to)f(sa)n(v)n(e)g(safely)515
1843 y(\(lik)n(e)24 b Fx(eflags)d Fz(on)j(In)n(tel)g(arc)n
(hitectures\))f(and)h(install)g(a)g(simple)g(activ)-5
b(ation)24 b(frame)f(for)h(the)515 1943 y(handler)33
b(on)g(the)g(receiv)n(er)f(sh)n(uttle.)55 b(In)33 b(this)h(case,)g(the)
g(caller)e(will)i(resume)e(execution)515 2042 y(as)k(so)r(on)h(as)f
(the)i(callee)e(has)h(b)r(een)h(noti\014ed;)k(the)37
b(message)f(is)h(sen)n(t)g(but)h(ma)n(y)e(b)r(e)i(not)515
2142 y(deliv)n(ered)27 b(y)n(et.)515 2275 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2275 V 29 w(Prtl)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 2366 y Fi(//)39 b(Delivers)i(an)f(event)h(to)
e(a)h(portal)g(\(one-way)h(PCT\).)598 2457 y(//)e(\(May)i(reset)f(the)g
(stack\))598 2549 y(err_t)g(deliver\(const)i(off_shtl_id_t)g(&sender,)
1147 2640 y(vm_offset_t)g(msz,)e(off_Msg)h(*msg,)f(natural_t)h
(tmout\);)598 2731 y(//)e(Delivers)i(an)f(event)h(to)e(a)h(portal)g
(\(one-way)h(PCT\).)598 2823 y(//)e(in-kernel)j(version)598
2914 y(//)d(When)i(called)f(with)g(sender)h(OFF_SHTL_NULL,)h(the)e
(request)h(originates)h(from)e(the)598 3005 y(//)f(kernel.)598
3097 y(//)g(Msg)h(will)g(be)g(deleted)h(by)f(the)g(receiver)h(kernel)f
(ctx)g(unless)h(originated)g(from)f(the)598 3188 y(//)f(kernel.)598
3279 y(err_t)h(kdeliver\(const)j(off_shtl_id_t)f(&sender,)1186
3371 y(vm_offset_t)g(msz,)e(off_Msg)h(*msg,)f(natural_t)h(tmout\);)598
3462 y(//)e(A)h(faster)g(version,)i(using)e(only)g(registers.)598
3553 y(err_t)g(deliver\(const)i(off_shtl_id_t)g(&sender,)g(natural_t)f
(tmout\);)1885 5255 y Fz(556)p eop
PStoPSsaved restore
%%Page: (558,559) 280
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
557 558 bop 639 523 a Fz(The)23 b(handler)g(information)f(presen)n(t)g
(in)h(the)h(p)r(ortal)e(is)h(basically)f(a)g(program)f(coun)n(ter)515
623 y(\()p Fx(entry)p Fz(\),)26 b(a)i(p)r(oin)n(ter)f(to)h(a)g(p)r(o)r
(ol)g(of)g(stac)n(k)f(p)r(oin)n(ters)g(\()p Fx(spp)p
Fz(\),)g(an)h(access)f(mo)r(de)h Fx(mode)p Fz(,)e(and)515
722 y(an)d(\(optional\))g(set)g(of)g(prop)r(erties)f(\()p
Fx(props)p Fz(\).)34 b(Eac)n(h)22 b(prop)r(ert)n(y)h(v)-5
b(alue)23 b(in)g Fx(props)e Fz(will)j(cause)515 822 y(the)38
b(prop)r(ert)n(y)f(in)h(the)h(sender)e(to)h(b)r(e)h(set)f(to)g(that)g
(v)-5 b(alue)38 b(during)g(p)r(ortal)f(in)n(v)n(o)r(cation.)515
922 y(Remaining)c(sender)h(prop)r(erties)f(will)h(main)n(tain)g(their)g
(original)e(v)-5 b(alue.)56 b(As)34 b(it)g(is)g(most)515
1021 y(lik)n(ely)j(that)g(the)h(address)e(space)h(prop)r(ert)n(y)g
(\(see)g(section)g(5.3\))g(will)h(b)r(e)f(presen)n(t,)j(that)515
1121 y(prop)r(ert)n(y)31 b(is)i(factored)f(out)g(of)h(the)g(prop)r(ert)
n(y)e(arra)n(y)g(to)h(gain)g(some)g(p)r(erformance.)51
b(On)515 1220 y(no)r(des)35 b(where)g(the)i Fw(\026)p
Fz(k)n(ernel)d(is)i(compiled)g(without)g(supp)r(ort)f(for)g(m)n
(ultiple)i(protection)515 1320 y(domains,)f(a)e(n)n(ull)h(v)-5
b(alue)34 b(is)h(used)g(the)g(suc)n(h)f(prop)r(ert)n(y)g(is)h(ignored.)
57 b(When)35 b(the)g Fx(props)515 1420 y Fz(set)25 b(is)h(not)f(presen)
n(t)g(in)h(the)g(p)r(ortal,)f(it)h(will)g(not)f(supp)r(ort)h(PCTs)e
(but)i(just)h(async)n(hronous)515 1519 y(message)f(deliv)n(ering.)515
1652 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1652 24 4 v 29 w(Prtl)p Fj(.)f Fk(i)p Fq(\021)598
1743 y Fi(off_mode_t)473 b(p_mode;)119 b(//)40 b(Valid)g(access)h
(modes.)598 1835 y(off_ShtlPropAllocator*p_props;)85
b(//)40 b(Properties)h(to)f(be)g(reset)g(at)g(PCT.)598
1926 y(vm_size_t)512 b(p_maxmsg;)41 b(//)f(Max)g(msg)g(size.)598
2017 y(//)f(entry)i(and)f(spp)118 b(handled)41 b(by)f(p_mdep;)639
2159 y Fz(As)30 b(it)g(is)f(common)g(to)g(install)g(just)h(a)f(single)g
(prop)r(ert)n(y)g(for)f(a)h Ft(dtlb)p Fz(,)h(suc)n(h)f(prop)r(ert)n(y)
515 2258 y(is)e(not)h(k)n(ept)f(in)h(the)g(prop)r(ert)n(y)f(arra)n(y)e
(but)j(k)n(ept)g(in)f(the)h(p)r(ortal.)515 2374 y Fk(h)p
Fj(Other)g(private)h(memb)l(ers)f(of)g Fi(off)p 1552
2374 V 29 w(Prtl)p Fj(.)f Fk(i)p Fz(+)p Fq(\021)598 2466
y Fi(off_dtlb_id_t)356 b(p_dtlb;)119 b(//)40 b(DTLB)g(cached)g(from)h
(p_props)639 2590 y Fz(That)31 b(is)f(enough)h(to)f(supp)r(ort)h(PCTs,)
f(but)i(for)e(async)n(hronous)e(message)h(deliv)n(ering)515
2690 y(it)i(is)f(necessary)e(for)i(the)h(p)r(ortal)f(to)g(k)n(eep)g(a)g
(sh)n(uttle)g(iden)n(ti\014er.)46 b(Th)n(us,)30 b(when)h
Fx(deliver)515 2790 y Fz(is)h(used,)h(the)f(handler)g(\(kno)n(wn)f(b)n
(y)h Fx(entry)p Fz(\))e(will)j(run)f(not)g(on)f(the)i(sender)e(sh)n
(uttle)h(but)515 2889 y(on)27 b(the)i(receiv)n(er.)36
b(If)29 b(the)f(receiv)n(er)e(sh)n(uttle)j(iden)n(ti\014er)f(is)g(not)g
(sp)r(eci\014ed,)g(the)g(p)r(ortal)g(will)515 2989 y(not)f(supp)r(ort)h
(async)n(hronous)d(deliv)n(ering.)515 3122 y Fk(h)p Fj(Other)j(private)
h(memb)l(ers)f(of)g Fi(off)p 1552 3122 V 29 w(Prtl)p
Fj(.)f Fk(i)p Fz(+)p Fq(\021)598 3213 y Fi(off_shtl_id_t)356
b(p_sid;)158 b(//)40 b(Server)g(shuttle)h(id)f(for)g(deliver.)639
3354 y Fz(All)24 b(this)g(information)f(is)h(supplied)g(b)n(y)f(the)h
(user)f(allo)r(cating)f(the)i(p)r(ortal,)g(b)r(esides)g(the)515
3454 y(desired)j(protection)g(and)g(domain.)515 3587
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3587 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3678 y Fi(//)39 b(Creates)i(a)f(portal.)598 3769 y(//)f(If)h(props)g
(is)g(given,)h(a)e(call)h(to)g(props->reference\(\))598
3861 y(//)f(should)i(be)f(made)g(by)g(the)f(caller.)598
3952 y(off_Prtl\(const)j(off_Protection)h(&p,)951 4043
y(const)d(off_prtl_id_t)i(&domain,)951 4134 y(vm_offset_t)g(entry,)951
4226 y(vm_offset_t)g(spp,)275 b(//)40 b(kernel)g(virtual)h(address)g
(for)f(usr)g(spp.)951 4317 y(const)g(off_shtl_id_t)i(&s,)951
4408 y(off_ShtlPropAllocator)83 b(*props=NULL,)951 4500
y(off_mode_t)41 b(mode=OFF_M_ALL,)200 b(//)40 b(all)f(permitted)951
4591 y(vm_size_t)80 b(maxmsg=0)434 b(//)39 b(unlimited)951
4682 y(\);)1885 5255 y Fz(557)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
558 559 bop 515 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)h(dep)l
(endencies.)i Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<klib/err.h>)434 b(//)40 b(for)g(err_t)598 706 y(#include)h
(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
797 y(#include)h(<klib/Magic.h>)356 b(//)40 b(for)g(magic)g(numbers)598
888 y(class)g(off_PrtlSrv;)552 b(//)40 b(to)f(break)i(the)f(circular)h
(dependency)598 980 y(#include)g(<prtl/mdep/mPrtl.h>)161
b(//)40 b(for)g(off_mdepPrtl)598 1071 y(#include)h
(<shtl/ShtlPropAllocator.h>)515 1245 y Fk(h)p Fi(off)p
667 1245 24 4 v 29 w(Prtl::off)p 1047 1245 V 30 w(Prtl)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 1337 y Fi(//)39
b(Creates)i(a)f(portal.)598 1428 y(//)f(If)h(props)g(is)g(given,)h(a)e
(call)h(to)g(props->reference\(\))598 1519 y(//)f(should)i(be)f(made)g
(by)g(the)f(caller.)598 1611 y(off_Prtl::off_Prtl\(const)44
b(off_Protection)f(&p,)1343 1702 y(const)d(off_prtl_id_t)j(&domain,)
1343 1793 y(vm_offset_t)f(entry,)1343 1885 y(vm_offset_t)g(spp,)e(//)g
(kernel)g(virtual)h(address)g(for)f(usr)g(spp.)1343 1976
y(const)g(off_shtl_id_t)j(&s,)1343 2067 y(off_ShtlPropAllocator)83
b(*props=NULL,)1343 2159 y(off_mode_t)42 b(mode=OFF_M_ALL,)199
b(//)40 b(all)g(permitted)1343 2250 y(vm_size_t)81 b(maxmsg=0)472
b(//)40 b(unlimited)1343 2341 y(\))g(:)676 2433 y
(off_AbsResUnit\(p,domain\),)676 2524 y(p_mdep\(entry,spp\),)676
2615 y(p_mode\(mode\),)676 2707 y(p_props\(NULL\),)676
2798 y(p_maxmsg\(maxmsg\),)676 2889 y(p_dtlb\(OFF_DTLB_NULL\),)676
2980 y(p_sid\(s\),)676 3072 y Fk(h)p Fj(Initialize)27
b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g Fi(off)p
2090 3072 V 29 w(Prtl)p Fj(.)f Fk(i)598 3163 y Fi({)676
3254 y(if)40 b(\(props\))h({)755 3346 y(off_dtlb_id_t)h
(d=\(*props\)[OFF_SHTLP_DTLB].get)q(_val)q(\(\);)755
3437 y(p_props=props;)755 3528 y(if)d(\(d!=OFF_ID_NULL\))990
3620 y(p_dtlb=d;)676 3711 y(})598 3802 y(})639 3944 y
Fz(The)28 b(handler)f(ma)n(y)g(b)r(e)h(reset)f(later)g(on.)515
4076 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4076 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
4168 y Fi(//)39 b(Sets)i(handler.)598 4259 y(//)e(If)h(props)g(is)g
(given,)h(a)e(call)h(to)g(props->reference\(\))598 4350
y(//)f(should)i(be)f(made)g(by)g(the)f(caller.)598 4442
y(err_t)h(set_hndlr\(vm_offset_t)k(entry,)1225 4533 y(vm_offset_t)e
(spp,)276 b(//)39 b(kernel)i(virtual)g(address)g(for)e(usr)h(spp.)1225
4624 y(const)h(off_shtl_id_t)h(&s,)1225 4716 y(off_ShtlPropAllocator)84
b(*props=NULL,)1225 4807 y(off_mode_t)42 b(mode=OFF_M_ALL,)199
b(//)40 b(all)g(permitted)1225 4898 y(vm_size_t)81 b(maxmsg=0)472
b(//)40 b(unlimited)1225 4990 y(\);)1885 5255 y Fz(558)p
eop
PStoPSsaved restore
%%Page: (560,561) 281
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
559 560 bop 639 523 a Fz(When)33 b(\(re\)setting)f(a)g(single)g(prop)r
(ert)n(y)-7 b(,)32 b(there)g(is)g(no)g(need)g(to)h(pass)e(a)h(full)h
(handler)515 623 y(description.)515 739 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 739 24 4 v
29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 830 y Fi(//)39
b(Sets)i(just)f(a)f(prop)h(in)g(the)g(portal.)598 922
y(void)g(set_prop\(off_prop_t)j(prop,)e(off_id_t)g(val\);)515
1079 y Fk(h)p Fi(off)p 667 1079 V 29 w(Prtl::set)p 1047
1079 V 30 w(hndlr)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
1171 y Fi(//)39 b(Sets)i(handler.)598 1262 y(//)e(If)h(props)g(is)g
(given,)h(a)e(call)h(to)g(props->reference\(\))598 1353
y(//)f(should)i(be)f(made)g(by)g(the)f(caller.)598 1445
y(err_t)h(off_Prtl::set_hndlr\(vm_offset)q(_t)45 b(entry,)1618
1536 y(vm_offset_t)c(spp,)g(//)e(kernel)i(virtual)g(addr)f(for)g(usr)g
(spp.)1618 1627 y(const)g(off_shtl_id_t)i(&s,)1618 1719
y(off_ShtlPropAllocator)83 b(*props=NULL,)1618 1810 y(off_mode_t)41
b(mode=OFF_M_ALL,)200 b(//)39 b(all)h(permitted)1618
1901 y(vm_size_t)80 b(maxmsg=0)473 b(//)39 b(unlimited)1618
1993 y(\))598 2084 y({)676 2175 y(w_lock\(\);)676 2267
y(p_mdep.set_hndlr\(entry,spp\);)676 2358 y(p_mode=mode;)676
2449 y(p_maxmsg=maxmsg;)676 2540 y(if)h(\(p_props\){)755
2632 y(assert\(p_props->get_num_refs\(\)>)q(0\);)755
2723 y(p_props->unreference\(\);)676 2814 y(})676 2906
y(if)g(\(props\))h({)755 2997 y(off_dtlb_id_t)h
(d=\(*props\)[OFF_SHTLP_DTLB].get)q(_val)q(\(\);)755
3088 y(p_props=props;)755 3180 y(if)d(\(d!=OFF_ID_NULL\))990
3271 y(p_dtlb=d;)676 3362 y(})676 3454 y(p_sid=s;)676
3545 y(w_unlock\(\);)676 3636 y(return)i(EOK;)598 3728
y(})1885 5255 y Fz(559)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
560 561 bop 639 523 a Fz(When)34 b(setting)f(a)g(single)f(prop)r(ert)n
(y)-7 b(,)33 b(w)n(e)g(tak)n(e)f(care)g(of)h(storing)f(an)n(y)i
Ft(dtlb)e Fz(in)i(righ)n(t)515 623 y(in)n(to)27 b(the)h(p)r(ortal.)515
739 y Fk(h)p Fi(off)p 667 739 24 4 v 29 w(Prtl::set)p
1047 739 V 30 w(prop)g Fj(implementation.)g Fk(i)p Fq(\021)598
830 y Fi(//)39 b(Sets)i(just)f(a)f(prop)h(in)g(the)g(portal.)598
922 y(void)g(off_Prtl::set_prop\(off_prop_t)46 b(prop,)40
b(off_id_t)h(val\))598 1013 y({)676 1104 y
(assert\(prop<OFF_NPROP_MAX\);)676 1196 y(if)f
(\(prop==OFF_SHTLP_DTLB\){)755 1287 y(p_dtlb=val;)755
1378 y(return;)676 1469 y(})676 1561 y(if)g(\(!p_props\))755
1652 y(new)g(off_ShtlPropAllocator\(\(off_Exha)q(uste)q(d*\)th)q(is\);)
676 1743 y(assert\(p_props)j(&&)c(p_props->get_num_refs\(\)>0\);)676
1835 y(\(void\)p_props->allocate\(prop)q(\);)676 1926
y(\(*p_props\)[prop].set_val\(val)q(\);)598 2017 y(})515
2267 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2267 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 2358 y Fi(void)40 b(notify\(void\){;})639
2499 y Fz(Remaining)26 b(p)r(ortal)g(data)g(is)h(pre-initialized.)36
b(First,)27 b(a)f(zero-argumen)n(t)e(constructor)515
2599 y(p)r(ermits)k(declaration)e(of)h(uninitialized)h(p)r(ortals.)515
2715 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2715 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2806 y Fi(//)79 b(Allows)40 b(uninitialized)i(shuttles.)598
2897 y(off_Prtl\(void\);)515 3055 y Fk(h)p Fi(off)p 667
3055 V 29 w(Prtl::off)p 1047 3055 V 30 w(Prtl)28 b Fj(implementation.)g
Fk(i)p Fz(+)o Fq(\021)598 3147 y Fi(//)79 b(Allows)40
b(uninitialized)i(portals.)598 3238 y(off_Prtl::off_Prtl\(void\))i(:)
676 3329 y(off_AbsResUnit\(off_Protectio)q(n\(\),)i(OFF_PRTL_NULL,)1265
3421 y(OFF_PRTL_NULL,)c(OFF_MAGIC_PRTL,)h(NULL\))598
3512 y({;})639 3744 y Fz(Later,)26 b(when)h(p)r(ortal)f(serv)n(ers)f
(are)g(b)r(eing)i(created,)f(another)g(constructor)f(is)i(used)f(to)515
3844 y(pre-initialize)h(those)g(p)r(ortal)g(\014elds)h(whic)n(h)f(are)g
(unlik)n(ely)g(to)g(c)n(hange.)515 3960 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3960 V 29 w(Prtl)p Fj(.)h
Fk(i)p Fz(+)o Fq(\021)598 4051 y Fi(//)39 b(Pre-initializes)k(a)d
(portal.)598 4143 y(off_Prtl\(const)i(off_prtl_id_t)g(&id,)e(const)h
(off_magic_t)h(&m,)d(off_PrtlSrv)j(*c\);)515 4301 y Fk(h)p
Fi(off)p 667 4301 V 29 w(Prtl::off)p 1047 4301 V 30 w(Prtl)28
b Fj(implementation.)g Fk(i)p Fz(+)o Fq(\021)598 4392
y Fi(//)39 b(Pre-initializes)k(a)d(portal.)598 4483 y
(off_Prtl::off_Prtl\(const)k(off_prtl_id_t)f(&id,)1343
4575 y(const)d(off_magic_t)i(&m,)e(off_PrtlSrv)i(*c\))e(:)676
4666 y(off_AbsResUnit\(id,m,\(off_Abs)q(CompR)q(esou)q(rce*)q(\)c\))598
4757 y({;})1885 5255 y Fz(560)p eop
PStoPSsaved restore
%%Page: (562,563) 282
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
561 562 bop 639 523 a Fz(Where)28 b(the)g(magic)f(n)n(um)n(b)r(er)g
(has)g(to)g(b)r(e)h(de\014ned.)515 639 y Fk(h)p Fj(O\013)f(magic)g
(numb)l(ers.)i Fk(i)p Fz(+)o Fq(\021)598 731 y Fi(OFF_MAGIC_PRTL,)42
b(//)e(Prtl)g(magic)h(nb.)639 855 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g
(add)h(another)e(case)h(to)h(the)g(implemen)n(tation)f(of)h
Fx(Magic::nameof)p Fz(.)515 971 y Fk(h)p Fi(off)p 667
971 24 4 v 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e Fi(m)p
1559 971 V 29 w(number)p Fj(s.)h Fk(i)p Fz(+)p Fq(\021)598
1063 y Fi(case)40 b(OFF_MAGIC_PRTL:)676 1154 y(return)h("off_Prtl";)639
1279 y Fz(P)n(ortal)26 b(users)h(can)g(c)n(hec)n(k)g(their)g
(references)g(to)g(pro)r(cessors)e(using)j(this)f(metho)r(d.)515
1395 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1395 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1486 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(Prtl?)598
1577 y(inline)h(boolean_t)i(valid\(void\))f(const;)515
1735 y Fk(h)p Fi(off)p 667 1735 V 29 w(Prtl::valid)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 1826 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(Prtl?)598 1918 y(inline)h(boolean_t)i
(off_Prtl::valid\(void\))i(const)598 2009 y({)39 b(return)i
(get_magic\(\))h(==)d(OFF_MAGIC_PRTL;)k(})639 2242 y
Fz(The)28 b(new)g(con)n(tainer)e(can)h(also)g(implemen)n(t)h(its)g
Fx(get)p 2323 2242 27 4 v 30 w(umagic)d Fz(metho)r(d.)515
2358 y Fk(h)p Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2358 24 4 v 29 w(PrtlSrv)p Fj(.)h Fk(i)p
Fq(\021)598 2449 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i
({)d(return)g(OFF_MAGIC_PRTL;)j(})515 2798 y Fn(5.2.3)112
b(P)m(ortal)36 b(allo)s(cation)515 2951 y Fz(A)28 b(p)r(ortal)f(allo)r
(cator)f(is)h(a)g(blo)r(c)n(k)g(allo)r(cator)f(instan)n(tiated)i(to)f
(main)n(tain)g(p)r(ortals.)515 3067 y Fk(h)p Fj(O\013)g(p)l(ortal)h(al)
t(lo)l(c)l(ator.)h Fk(i)p Fq(\021)598 3159 y Fi(//)39
b(A)h(Portal)g(allocator.)598 3250 y(//)598 3341 y(class)g
(off_PrtlAllocator)j(:)d(public)g(off_TBlockAllocator<off_LPrt)q(l>)45
b({)598 3433 y(public:)676 3524 y(//)40 b(Allows)g(declarations)i(of)e
(uninitialized)i(portal)f(allocators)676 3615 y
(off_PrtlAllocator\(void\){;})676 3798 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 3798 V 29
w(PrtlAllocator)p Fj(.)j Fk(i)598 3889 y Fi(private:)676
3981 y Fk(h)p Fj(Other)f(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 3981 V 29 w(PrtlAllocator)p Fj(.)j Fk(i)598
4072 y Fi(};)1885 5255 y Fz(561)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
562 563 bop 639 523 a Fz(As)32 b(the)h(blo)r(c)n(k)e(allo)r(cator)f
(uses)i(a)f(lik)n(ed)h(free-list,)g(the)h(arra)n(y)c(no)r(des)j(m)n
(ust)g(sub)r(class)515 623 y Fx(DLinkedNode)p Fz(.)515
756 y Fk(h)p Fj(O\013)27 b(linkable)g(p)l(ortal.)h Fk(i)p
Fq(\021)598 847 y Fi(//)39 b(A)h(linkable)h(off_Prtl.)598
938 y(//)598 1029 y(class)f(off_LPrtl)h(:)f(public)g(DLinkedNode)i({)
598 1121 y(public:)676 1212 y(off_Prtl)f(l_prtl;)551
b(//)40 b(The)g(portal)676 1395 y(//)g(To)g(allow)g(uninitilized)i
(LPrtls.)676 1486 y(off_LPrtl\(void\))h({;})676 1669
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 1669 24 4 v 29 w(LPrtl)p Fj(.)h Fk(i)598 1760 y
Fi(};)515 2026 y Fk(h)p Fj(O\013)f(p)l(ortal)h(al)t(lo)l(c)l(ator)h
(dep)l(endencies.)g Fk(i)p Fq(\021)598 2117 y Fi(#include)41
b(<klib/BlockAllocator.h>)j(//)c(for)g(off_TBlockAllocator)598
2208 y(#include)h(<prtl/Prtl.h>)395 b(//)40 b(for)g(off_Prtl)639
2350 y Fz(An)25 b(indexer)f(is)g(main)n(tained)g(b)n(y)g(the)h(allo)r
(cator.)34 b(Besides,)24 b(a)g(k)n(ernel)f(virtual)h(memory)515
2449 y(region)i(is)i(pro)n(vided)e(b)n(y)h(the)h(creator.)515
2582 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2582 V 29 w(PrtlAllocator)p Fj(.)i Fk(i)o
Fq(\021)598 2673 y Fi(static)40 b(off_Indexer<off_LPrtl>)45
b(p_idx;)515 2848 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(al)t(lo)l(c)l
(ator)h(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 2939
y Fi(off_Indexer<off_LPrtl>)44 b(off_PrtlAllocator::p_idx;)639
3080 y Fz(The)28 b(allo)r(cator)e(is)h(initialized)h(as)f(follo)n(ws.)
515 3196 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3196 V 29 w(PrtlAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 3288 y Fi(//)39 b(Creates)i(a)f(portal)g(allocator.)598
3379 y(off_PrtlAllocator\(off_Exhauste)q(d)45 b(*r,)40
b(off_KVMRegion)i(*reg\);)639 3504 y Fz(The)28 b(region)e(is)h(used)g
(to)g(pro)n(vide)g(memory)f(for)h(the)h(\(gro)n(wing\))e(arra)n(y)e(of)
k(p)r(ortals.)36 b(A)515 3603 y(p)r(oin)n(ter)24 b(to)g(the)h(start)f
(of)g(suc)n(h)g(arra)n(y)e(is)i(k)n(ept)h(inside)f(the)h(sh)n(uttle)g
(allo)r(cator)d(so)i(w)n(e)g(could)515 3703 y(rede\014ne)j(the)h
Fx(operator)40 b(+)p Fz(.)515 3836 y Fk(h)p Fj(Other)28
b(private)h(memb)l(ers)f(of)g Fi(off)p 1552 3836 V 29
w(PrtlAllocator)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 3927
y Fi(off_LPrtl)41 b(*p_prtls;)515 4101 y Fk(h)p Fi(off)p
667 4101 V 29 w(PrtlAllocator::off)p 1398 4101 V 32 w(PrtlAllocator)30
b Fj(implementation.)e Fk(i)p Fq(\021)598 4193 y Fi(//)39
b(Creates)i(a)f(portal)g(allocator.)598 4284 y
(off_PrtlAllocator::off_PrtlAll)q(ocato)q(r\(of)q(f_Ex)q(haust)q(ed)45
b(*r,)40 b(off_KVMRegion)i(*reg\))f(:)676 4375 y
(off_TBlockAllocator<off_LPrt)q(l>\(r,)q(\(con)q(st)k
(off_Indexable*\)&p_idx,reg\),)676 4467 y
(p_prtls\(\(off_LPrtl*\)reg->get)q(_star)q(t\(\)\))598
4558 y({;})515 4732 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4732 V 29 w(PrtlAllocator)p Fj(.)j Fk(i)p
Fz(+)o Fq(\021)598 4824 y Fi(inline)40 b(off_LPrtl)i(*operator)f
(+\(vm_offset_t)h(at\);)1885 5255 y Fz(562)p eop
PStoPSsaved restore
%%Page: (564,565) 283
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
563 564 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PrtlAllocator::operator+)32 b Fj(implementation.)c
Fk(i)p Fq(\021)598 614 y Fi(inline)40 b(off_LPrtl)i
(*off_PrtlAllocator::operator)j(+\(vm_offset_t)d(at\))598
706 y({)676 797 y(return)f(p_prtls+at;)598 888 y(})639
1121 y Fz(The)24 b(allo)r(cator)d(m)n(ust)j(b)r(e)g(initialized)f(when)
h(the)g(p)r(ortal)f(serv)n(er)e(is)j(started,)f(not)h(when)515
1220 y(it)35 b(is)g(instan)n(tiated)g(as)f(there)h(migh)n(t)g(b)r(e)g
(no)g(KVM)f(b)n(y)h(that)g(time.)60 b(The)35 b(rev)n(o)r(cator)d(is)515
1320 y(the)26 b(p)r(ortal)g(serv)n(er)e(itself,)j(as)f(set)g(at)g
(construction)g(time;)h(the)g(region)e(is)h(also)f(created)g(at)515
1420 y(construction)h(time.)515 1553 y Fk(h)p Fj(Initialize)g
Fi(PrtlSrv::p)p 1261 1553 V 31 w(alloc)p Fj(.)i Fk(i)p
Fq(\021)598 1644 y Fi(new\(&p_alloc\))81 b
(off_PrtlAllocator\(\(off_Exhau)q(sted*)q(\)thi)q(s,)1892
1735 y(kvm.create_region\("prtl"\)\);)515 1910 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(server)i(implementation)e(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2001 y Fi(#include)41 b(<dmm/KVM.h>)473
b(//)40 b(for)g(kvm)639 2142 y Fz(Where)28 b(w)n(e)f(used)h(the)f
Fx(new)g Fz(op)r(erator)f(tric)n(k.)515 2258 y Fk(h)p
Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2258
V 29 w(PrtlAllocator)p Fj(.)j Fk(i)p Fz(+)o Fq(\021)598
2350 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_PrtlAllocator)k
(*p\))d({)g(\(void\)s;)h(return)f(p;)g(})639 2474 y Fz(The)29
b Fx(notify)e Fz(metho)r(d)j(m)n(ust)f(th)n(us)g(b)r(e)h(pro)n(vided)e
(b)n(y)h(p)r(ortal)f(serv)n(ers)f(to)i(implemen)n(t)515
2574 y(the)c(resource)e(rev)n(o)r(cator)g(signature.)35
b(Ho)n(w)n(ev)n(er,)24 b(suc)n(h)g(ev)n(en)n(ts)h(are)f(silen)n(tly)h
(discarded)f(in)515 2673 y(this)k(implemen)n(tation.)515
2790 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2790 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2881 y Fi(//)39 b(Notifies)i(that)g(portals)f(are)g(exhausted.)598
2972 y(void)g(notify\(void\);)639 3097 y Fz(Once)29 b(the)g(allo)r
(cator)e(has)h(b)r(een)h(initialized,)h(the)f(p)r(ortal)f(serv)n(er)f
(can)h(b)r(e)h(indexed)g(to)515 3196 y(obtain)e(references)f(to)i(sh)n
(uttles;)g(they)f(can)h(b)r(e)g(allo)r(cated)e(and)i(deallo)r(cated.)
515 3329 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3329 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 3421 y Fi(//Gets)40 b(a)g(Portal)g(from)h(its)e
(distributed)j(address)598 3512 y(inline)e(off_Prtl)h
(*operator+\(off_offset_t)k(p\);)598 3603 y(//)39 b(Allocates)j(a)d
(portal.)598 3694 y(off_Prtl)i(*alloc\(const)h(off_prtl_id_t)g(&at,)e
(boolean_t)h(use_revocation=FALSE\);)598 3786 y(//)e(Allocates)j(any)e
(portal.)598 3877 y(off_Prtl)h(*alloc\(boolean_t)i
(use_revocation=FALSE\);)598 3968 y(//)c(Deallocates)j(a)e(portal)598
4060 y(void)g(free\()g(const)h(off_Prtl)g(*p)e(\);)515
4325 y Fk(h)p Fi(off)p 667 4325 V 29 w(PrtlSrv::operator+)31
b Fj(implementation.)d Fk(i)o Fq(\021)598 4417 y Fi(//Gets)40
b(a)g(Portal)g(from)h(its)e(distributed)j(address)598
4508 y(inline)e(off_Prtl)h(*off_PrtlSrv::operator+\(off)q(_offs)q(et_t)
46 b(p\))598 4599 y({)676 4691 y(assert\(valid\(\)\);)676
4782 y(return)41 b(&\(p_alloc+p\)->l_prtl;)598 4873 y(})1885
5255 y Fz(563)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
564 565 bop 639 523 a Fz(P)n(ortals)26 b(are)g(preinitialized)i(when)g
(they)f(are)g(allo)r(cated.)515 656 y Fk(h)p Fi(off)p
667 656 24 4 v 29 w(PrtlSrv::alloc)j Fj(and)e Fi(free)g
Fj(implementation.)g Fk(i)p Fq(\021)598 747 y Fi(//)39
b(Allocates)j(a)d(portal.)598 839 y(off_Prtl)i
(*off_PrtlSrv::alloc\(const)k(off_prtl_id_t)d(&at,)e(boolean_t)h
(use_revocation\))598 930 y({)676 1021 y(off_LPrtl)g(*lp;)676
1112 y(assert\(valid\(\)\);)676 1204 y(w_lock\(\);)676
1295 y(lp=p_alloc.allocate\(at,use_r)q(evoca)q(tion)q(\);)676
1386 y(w_unlock\(\);)676 1478 y(if)f(\(lp\))g({)755 1569
y(\(void\))g(new\(lp\))h(off_LPrtl\(at,this\);)676 1660
y(})676 1752 y(return)g(\(lp\)?\(&lp->l_prtl\):\(off_Prtl*\))q(NULL)q
(;)598 1843 y(})598 2026 y(//)e(Allocates)j(a)d(portal.)598
2117 y(off_Prtl)i(*off_PrtlSrv::alloc\(boolean_t)46 b(use_revocation\))
598 2208 y({)676 2300 y(off_LPrtl)41 b(*lp;)676 2391
y(assert\(valid\(\)\);)676 2482 y(w_lock\(\);)676 2574
y(lp=p_alloc.allocate\(use_revo)q(catio)q(n\);)676 2665
y(w_unlock\(\);)676 2756 y(if)f(\(lp\))g({)755 2848 y(off_prtl_id_t)i
(pid\(get_id\(\),p_alloc.pos\(lp\)\);)755 2939 y(\(void\))e(new\(lp\))h
(off_LPrtl\(pid,this\);)676 3030 y(})676 3122 y(return)g
(\(lp\)?\(&lp->l_prtl\):\(off_Prtl*\))q(NULL)q(;)598
3213 y(})598 3396 y(//)e(Deallocates)j(an)e(Portal)598
3487 y(void)g(off_PrtlSrv::free\()j(const)e(off_Prtl)g(*p)e(\))598
3578 y({)676 3670 y(off_LPrtl)i(*lp=\(off_LPrtl*\)\(\(\(char*\)p\))q
(-\(in)q(t\)&of)q(f_LP)q(rtl::)q(l_pr)q(tl\);)676 3761
y(assert\(valid\(\)\);)676 3852 y(w_lock\(\);)676 3944
y(p_alloc.deallocate\(lp\);)676 4035 y(w_unlock\(\);)598
4126 y(})515 4392 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(dep)l
(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 4483 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)639 4624 y Fz(P)n(ortal)35
b(preinitialization)h(uses)h(a)f Fx(new)g Fz(op)r(erator)f(for)h
Fx(LPrtl)f Fz(returning)h(its)h(single)515 4724 y(argumen)n(t.)515
4840 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4840 V 29 w(LPrtl)p Fj(.)h Fk(i)p Fq(\021)598
4932 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LPrtl)j(*p\))e
({)f(\(void\)s;)i(return)g(\(void*\))f(p;)g(})1885 5255
y Fz(564)p eop
PStoPSsaved restore
%%Page: (566,567) 284
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
565 566 bop 639 523 a Fz(A)28 b(preinitialization)f(constructor)f(for)h
Fx(LPrtl)p Fz(s)f(is)h(also)g(used.)515 639 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 639
24 4 v 29 w(LPrtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
731 y Fi(off_LPrtl\(const)42 b(off_prtl_id_t)h(&id,)d(off_PrtlSrv)h
(*psrv\))g(:)676 822 y(l_prtl\(id,OFF_MAGIC_PRTL,psr)q(v\))598
913 y({;})639 1038 y Fz(P)n(ortals)28 b(are)g(allo)r(cated)h(and)h
(deallo)r(cated)f(with)h Fx(new)e Fz(and)i Fx(delete)d
Fz(op)r(erators.)41 b(The)515 1137 y(op)r(erator)26 b
Fx(new)g Fz(uses)h(the)h(p)r(ortal)f(serv)n(er)f Fx(alloc)g
Fz(metho)r(d.)515 1270 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1270 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 1362 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(const)i
(off_prtl_id_t)h(&at,)1343 1453 y(boolean_t)f(use_revocation=FALSE\);)
598 1544 y(void)f(*operator)h(new\(size_t)h(s,)d(boolean_t)j
(use_revocation=FALSE\);)598 1636 y(void)e(operator)h(delete\(void)h
(*p\);)515 1810 y Fk(h)p Fi(off)p 667 1810 V 29 w(Prtl::operator)g(new)
28 b Fj(implementation.)g Fk(i)o Fq(\021)598 1901 y Fi(void)40
b(*off_Prtl::operator)j(new\(size_t)f(s,)e(boolean_t)h
(use_revocation=FALSE\))598 1993 y({)676 2084 y(off_Prtl)g
(*p=prtl.alloc\(use_revocation)q(\);)676 2175 y(\(void\)s;)676
2267 y(assert\(s)g(&&)f(prtl.valid\(\)\);)676 2358 y(assert\(!p)h(||)f
(p->valid\(\)\);)676 2449 y(return)h(\(void*\)p;)598
2540 y(})598 2632 y(void)f(*off_Prtl::operator)j(new\(size_t)f(s,)e
(const)g(off_prtl_id_t)i(&at,)1735 2723 y(boolean_t)g
(use_revocation=FALSE\))598 2814 y({)676 2906 y(off_Prtl)f
(*p=prtl.alloc\(at,use_revocat)q(ion\))q(;)676 2997 y(\(void\)s;)676
3088 y(assert\(s)g(&&)f(shtl.valid\(\)\);)676 3180 y(assert\(!p)h(||)f
(p->valid\(\)\);)676 3271 y(return)h(\(void*\)p;)598
3362 y(})515 3628 y Fk(h)p Fi(off)p 667 3628 V 29 w(Prtl::operator)h
(delete)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
3719 y Fi(//)39 b(Deallocates)j(this)e(portal.)598 3811
y(void)g(off_Prtl::operator)j(delete\(void)f(*p\))598
3902 y({)676 3993 y(off_Prtl)f(*pt=\(off_Prtl*\)p;)676
4085 y(assert\(pt)g(&&)f(pt->valid\(\)\);)676 4176 y(prtl.free\(pt\);)
598 4267 y(})515 4533 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h
(implementation)g(dep)l(endencies.)i Fk(i)p Fq(\021)598
4624 y Fi(#include)41 b(<prtl/PrtlSrv.h>)278 b(//)40
b(for)g(prtl)598 4716 y(#include)h(<shtl/ShtlSrv.h>)278
b(//)40 b(for)g(shtl)598 4807 y(#include)h(<shtl/Shtl.h>)1885
5255 y Fz(565)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
566 567 bop 515 523 a Fn(5.2.4)112 b(P)m(ortal)36 b(rev)m(o)s(cation)
515 676 y Fz(Eac)n(h)19 b(p)r(ortal)g(serv)n(er)f(deliv)n(ers)h(rev)n
(o)r(cation)g(ev)n(en)n(ts)g(to)h(its)g(exception)g(p)r(ortal)f(or)g
Fx(r)p 3068 676 27 4 v 31 w(domain)p Fz(,)515 776 y(in)h(case)f(that)i
(p)r(ortal)e(has)h(b)r(een)h(set.)34 b(The)20 b(o)n(wner)f(of)h(that)h
(p)r(ortal)e(is)h(the)h(referee)e(for)h(p)r(ortal)515
876 y(rev)n(o)r(cation)26 b(inside)h(the)h(p)r(ortal)f(serv)n(er.)515
999 y Fk(h)p Fi(off)p 667 999 24 4 v 29 w(PrtlSrv::notify)j
Fj(implementation.)e Fk(i)p Fq(\021)598 1090 y Fi(//)39
b(Notifies)i(that)g(portals)f(are)g(exhausted.)598 1182
y(void)g(off_PrtlSrv::notify\(void\))598 1273 y({)676
1364 y(assert\(valid\(\)\);)676 1456 y(if)g
(\(get_domain\(\)==OFF_PRTL_NULL\))755 1547 y(return;)676
1638 y(else)g({)755 1730 y(;)598 1821 y(#if)g(0)1059
b(//)40 b(XXX)g(fix)g(this)755 1912 y(off_ExhaustReq)i
(m\(OFF_MAGIC_PRTLSRV,get_id\(\)\))q(;)755 2004 y
(prtl.kpct\(get_domain\(\),off_Shtl)q(::se)q(lf\(\))q(,size)q(of\(m)q
(\),0,&)q(m,NU)q(LL,0)q(\);)598 2095 y(#endif)676 2186
y(})598 2278 y(})515 2525 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
2616 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_ExhaustReq)
598 2707 y(#include)h(<hw/Processor.h>)278 b(//)40 b(for)g(Processor)h
(and)f(self.)515 2968 y Fn(5.2.5)112 b(Kernel-User)37
b(in)m(terface)515 3121 y Fz(Messages)26 b(exc)n(hanged)g(b)r(et)n(w)n
(een)h(the)h(k)n(ernel)f(and)h(the)f(user)g(are)g(instances)g(of)h
Fx(Msg)p Fz(.)515 3245 y Fk(h)p Fj(O\013)f(message.)h
Fk(i)p Fq(\021)598 3336 y Fi(struct)40 b(off_Msg)h({)598
3427 y(};)639 3559 y Fz(They)28 b(are)e(of)i(t)n(w)n(o)f(kinds,)g
(requests)g(and)g(replies.)36 b(Requests)28 b(carry)e(a)h(\014eld)h
(with)g(the)515 3659 y(request)23 b(t)n(yp)r(e)h(so)f(that)h(the)g
(same)f(p)r(ortal)g(could)g(b)r(e)h(m)n(ultiplexed)g(for)g(m)n(ultiple)
g(requests.)515 3770 y Fk(h)p Fj(O\013)j(message)i(r)l(e)l(quest.)g
Fk(i)p Fq(\021)598 3862 y Fi(//)39 b(Message)i(types.)598
4044 y(struct)f(off_MsgReq)i(:)d(public)i(off_Msg)g({)676
4136 y(off_ex_t)g(m_type;)551 b(//)40 b(message)h(type)676
4227 y(off_MsgReq\(void\){;})676 4318 y(off_MsgReq\(off_ex_t)j(type\))c
(:)g(m_type\(type\))i({;})598 4409 y(};)639 4529 y Fz(Replies)28
b(are)e(not)i(t)n(yp)r(ed.)515 4641 y Fk(h)p Fj(O\013)f(message)i(r)l
(eply.)f Fk(i)o Fq(\021)598 4732 y Fi(struct)40 b(off_MsgRep)i(:)d
(public)i(off_Msg)g({)676 4824 y(err_t)276 b(m_err;)676
4915 y(off_MsgRep\(err_t)43 b(res=0\))e(:)e(m_err\(res\))j({;})598
5006 y(};)1885 5255 y Fz(566)p eop
PStoPSsaved restore
%%Page: (568,569) 285
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
567 568 bop 639 523 a Fz(A)28 b(p)r(ortal)f(handler)g(is)h(de\014ned)
515 639 y Fk(h)p Fj(O\013)f(p)l(ortal)h(hand)t(ler.)g
Fk(i)p Fq(\021)598 731 y Fi(//)39 b(A)h(portal)g(handler.)598
822 y(extern)g("C")g({)598 913 y(typedef)h(err_t)f
(off_PrtlHandlerFn\(const)k(off_shtl_id_t)f(&sender,)1500
1005 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 1096
y(off_MsgReq)f(*m,)f(off_MsgRep)i(*r\);)598 1187 y(};)515
1345 y Fk(h)p Fj(O\013)27 b(kernel)h(p)l(ortal)h(hand)t(ler.)f
Fk(i)p Fq(\021)598 1436 y Fi(extern)40 b("C")g({)598
1528 y(typedef)h(err_t)f(off_KernPrtlHandlerFn\(const)45
b(off_shtl_id_t)d(&sender,)2010 1619 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)2010 1710 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)598
1802 y(};)1885 5255 y Fz(567)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
568 569 bop 515 523 a Fn(5.2.6)112 b(Doing)37 b(IPC)g(with)f(p)s
(ortals)515 676 y Fz(IPC)g(pro)r(ceeds)g(b)n(y)g(lo)r(oking)g(ensuring)
f(the)i(p)r(ortal)f(is)h(lo)r(cal,)h(and)f(issuing)f(a)g
Fx(MISSING)515 776 y Fz(exception)24 b(to)g(the)h(sender)f(sh)n(uttle)h
(otherwise.)35 b(The)24 b(handler)g(for)g(suc)n(h)g(exception)g(is)h
(ex-)515 876 y(p)r(ected)f(to)g(b)r(eha)n(v)n(e)f(as)g(the)i(remote)e
(handler)h(b)n(y)f(lo)r(cating)g(and)h(forw)n(arding)e(the)i(message)
515 975 y(as)31 b(necessary)-7 b(.)47 b(Suc)n(h)32 b(pro)r(cessing)e
(is)i(done)f(b)n(y)g(wrapp)r(ers)g(found)h(in)g(the)g(p)r(ortal)f(serv)
n(er,)515 1075 y(whic)n(h)c(will)h(b)r(e)g(describ)r(ed)f(later.)37
b(In)27 b(what)h(follo)n(ws)f(w)n(e)g(assume)g(the)h(p)r(ortal)f(is)g
(lo)r(cal.)515 1291 y FA(Protected)32 b(con)m(trol)g(transfers)515
1444 y Fz(T)-7 b(o)26 b(issue)h(a)g(PCT)g(from)f Fx(sender)p
Fz(,)f(w)n(e)i(m)n(ust)g(adjust)h(prop)r(erties)e(of)h(the)g(curren)n
(t)g(sh)n(uttle,)515 1543 y(up)r(call)g(to)h(the)g(handler)f(using)g
(the)h(message)e(as)h(an)g(argumen)n(t,)f(get)i(the)f(reply)g(message)
515 1643 y(as)g(the)h(result)f(from)g(the)h(handler,)f(and)h(then)g
(return.)639 1743 y(A)e(timer)g(should)f(b)r(e)h(set)g(for)f(the)h(v)-5
b(alue)26 b(sp)r(eci\014ed)g(in)f Fx(tmout)f Fz(and)i(the)g(PCT)f(ab)r
(orted)515 1842 y(on)i(timer)h(expiration.)36 b(This)27
b(feature)g(is)h(not)f(implemen)n(ted.)515 1975 y Fk(h)p
Fi(off)p 667 1975 24 4 v 29 w(Prtl::pct)i Fj(implementation.)e
Fk(i)p Fq(\021)598 2066 y Fi(//)39 b(\(Locally\))j(delivers)f(a)e
(message)i(to)f(this)g(portal)g(using)h(a)e(PCT.)598
2158 y(//)g(\(May)i(reset)f(the)g(stack\))598 2249 y(err_t)g
(off_Prtl::pct\(const)k(off_shtl_id_t)e(&sender,)1382
2340 y(vm_size_t)g(msz,)e(vm_size_t)h(&rsz,)1382 2432
y(off_Msg)g(*msg,)f(off_Msg)h(*reply,)g(natural_t)g(tmout\))598
2523 y({)676 2614 y(off_Msg)80 b(*kmsg;)676 2706 y(off_Msg)g(*krep;)676
2797 y(err_t)158 b(err;)676 2980 y(\(void\)tmout;)395
b(//)40 b(XXX)g(not)g(implemented.)676 3071 y(if)g(\(p_maxmsg<msz\))755
3162 y(return)g(E2BIG;)676 3254 y(if)g
(\(allocate_pctblock\(kmsg,krep,m)q(sz,r)q(sz\)=)q(=NULL)q(\))755
3345 y(return)g(ENOMEM;)676 3436 y(off_mdepPrtl::copyin\(kmsg,ms)q
(g,msz)q(\);)676 3528 y(err=kpct\(sender,msz,rsz,kmsg)q(,krep)q(,tmo)q
(ut\);)676 3619 y(if)g(\(!err\){)755 3710 y
(off_mdepPrtl::copyout\(reply,kre)q(p,rs)q(z\);)676 3802
y(})676 3893 y(deallocate_pctblock\(kmsg\);)676 4076
y(return)h(err;)598 4167 y(})1885 5255 y Fz(568)p eop
PStoPSsaved restore
%%Page: (570,571) 286
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
569 570 bop 639 523 a Fz(First,)36 b(the)f(message)e(is)h(copied)g(in)n
(to)g(newly)g(allo)r(cated)f(memory)h(b)n(y)g(the)g(mac)n(hine)515
623 y(dep)r(enden)n(t)h(part.)56 b(W)-7 b(e)34 b(allo)r(cate)g(a)g
(single)f(piece)h(of)h(memory)e(for)h(the)g(message)f(b)r(eing)515
722 y(sen)n(t,)27 b(the)h(reply)f(exp)r(ected)h(and)g(other)f(stu\013)h
(w)n(e)f(will)h(see)f(b)r(elo)n(w.)515 855 y Fk(h)p Fi(off)p
667 855 24 4 v 29 w(Prtl::allocate)p 1242 855 V 31 w(pctblock)i
Fj(implementation.)f Fk(i)p Fq(\021)598 946 y Fi(#define)41
b(allocate_pctblock\(kmsg,krep,msz)q(,rsz)q(\)\\)676
1038 y(\(\(kmsg)g(=)e(\(off_Msg*\))j(__builtin_alloca\(msz+rsz+2\)\),)k
(\\)676 1129 y(\(krep)41 b(=)e(\(off_Msg*\))j(\(\()d(\(\(unsigned)j
(int\)\(\(\(char*\)kmsg\)+msz\)\))i(+0x3\)&~0x3\)\),kmsg\))515
1395 y Fk(h)p Fi(off)p 667 1395 V 29 w(Prtl::deallocate)p
1320 1395 V 31 w(pctblock)30 b Fj(implementation.)d Fk(i)p
Fq(\021)598 1486 y Fi(#define)41 b(deallocate_pctblock\(kmsg\))j
(\(\(void\)kmsg\))639 1719 y Fz(The)29 b(v)n(ersion)e(for)h(in-k)n
(ernel)f(a)n(v)n(oids)g(the)i(cop)n(y-in)e(and)h(cop)n(y-out)g(as)f
(the)i(message)e(is)515 1818 y(already)f(inside)i(the)g(con)n(text.)515
1951 y Fk(h)p Fi(off)p 667 1951 V 29 w(Prtl::kpct)h Fj(implementation.)
f Fk(i)p Fq(\021)598 2042 y Fi(//)39 b(\(Locally\))j(delivers)f(a)e
(message)i(to)f(this)g(portal)g(using)h(a)e(PCT.)598
2134 y(//)g(in-kernel)j(version.)598 2225 y(err_t)e
(off_Prtl::kpct\(const)k(off_shtl_id_t)e(&sender,)1382
2316 y(vm_size_t)g(msz,)e(vm_size_t)h(&rsz,)1382 2408
y(off_Msg)g(*msg,)f(off_Msg)h(*krep,)g(natural_t)g(tmout\))598
2499 y({)676 2590 y(off_Shtl)g(*self=off_Shtl::self\(\);)676
2682 y(err_t)158 b(err;)676 2773 y Fk(h)p Fi(off)p 828
2773 V 29 w(Prtl::kpct)30 b Fj(lo)l(c)l(al)d(variables.)h
Fk(i)676 2956 y Fi(\(void\)tmout;)709 b(//)40 b(Not)g(implemented)676
3047 y(assert\(self)i(&&)e(self->valid\(\)\);)676 3138
y(if)g(\(p_mdep.is_kernel\(\)\){)755 3230 y(return)g
(p_mdep.hardwired_call\(sender)q(,msz)q(,rsz,)q(msg,)q(krep\))q(;)676
3321 y(})676 3412 y(w_lock\(\);)676 3504 y Fk(h)p Fj(Save)28
b(and)g(r)l(eset)i Fi(self)e Fj(pr)l(op)l(erties.)h Fk(i)676
3595 y Fi(//)40 b(lock)g(will)g(be)g(released)h(right)f(before)h(the)f
(upcall.)676 3686 y Fk(h)p Fj(Up)l(c)l(al)t(l)28 b(fr)l(om)f
Fi(self)h Fj(with)g Fi(sender)h Fj(and)f Fi(msg)p Fj(,)f(and)h(get)h
Fi(krep)p Fj(.)f Fk(i)676 3778 y(h)p Fj(R)l(estor)l(e)i
Fi(self)e Fj(pr)l(op)l(erties.)h Fk(i)676 3869 y Fi(return)41
b(err;)598 3960 y(})1885 5255 y Fz(569)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
570 571 bop 639 523 a Fz(As)21 b(system)f(services)f(are)g(made)i(a)n
(v)-5 b(ailable)19 b(b)n(y)h(means)g(of)g(p)r(ortals,)h(a)f(bunc)n(h)h
(of)f(p)r(ortals)515 623 y(will)33 b(b)r(e)g(serviced)f(within)i(the)f
(k)n(ernel.)53 b(Only)32 b(PCT)h(in)n(v)n(o)r(cation)e(is)i(allo)n(w)n
(ed)f(for)g(them.)515 722 y(What)24 b(w)n(e)f(do)g(is)g(to)g(forget)g
(ab)r(out)g(the)h(up)r(call)g(when)f(the)h(p)r(ortal)f(en)n(try)g(p)r
(oin)n(t)h(is)f(a)g(k)n(ernel)515 822 y(address.)35 b(Instead,)28
b(w)n(e)f(call)g(the)h(p)r(ortal)f(handler)g(b)n(y)h(hand.)639
922 y(W)-7 b(e)28 b(m)n(ust)g(\014rst)f(adjust)h(our)f(prop)r(erties,)g
(ma)n(yb)r(e)g(c)n(hanging)f(our)h(domain.)515 1054 y
Fk(h)p Fj(Save)h(and)g(r)l(eset)h Fi(self)g Fj(pr)l(op)l(erties.)g
Fk(i)p Fq(\021)598 1146 y Fi(np=\(p_props\)?p_props->get_nall)q
(oc\(\):)q(0;)598 1237 y(if)39 b(\(p_dtlb!=OFF_ID_NULL\){)676
1328 y(old_dtlb=self->get_dtlb\(\);)676 1420 y
(self->set_dtlb\(p_dtlb\);)598 1511 y(})598 1602 y(if)g(\(np>0\){)676
1694 y(off_prop_t)j(snp=np;)676 1785 y(np=p_props->get_length\(\);)676
1876 y(psaved=)f(new)f(off_ShtlPropAllocator\(\);)676
1968 y(*psaved=*self->get_allocator)q(\(\);)676 2059
y(while\(np--)i(>0\))755 2150 y(if)d(\(\(*p_props\)[np].get_val\(\)!=O)
q(FF_P)q(RTL_)q(NULL\))833 2242 y(self->set_prop\(np,\(*p_props\)[)q
(np].)q(get_)q(val\(\))q(\);)676 2333 y(np=snp;)598 2424
y(})515 2690 y Fk(h)p Fi(off)p 667 2690 24 4 v 29 w(Prtl::kpct)29
b Fj(lo)l(c)l(al)f(variables.)g Fk(i)p Fq(\021)598 2781
y Fi(off_ShtlPropAllocator)44 b(*psaved;)598 2873 y(off_dtlb_id_t)e
(old_dtlb=OFF_DTLB_NULL;)598 2964 y(off_prop_t)f(np;)639
3105 y Fz(They)28 b(will)g(b)r(e)g(reloaded)e(later.)515
3221 y Fk(h)p Fj(R)l(estor)l(e)j Fi(self)f Fj(pr)l(op)l(erties.)i
Fk(i)p Fq(\021)598 3313 y Fi(if)39 b(\(p_dtlb!=OFF_ID_NULL\){)676
3404 y(self->set_dtlb\(old_dtlb\);)598 3495 y(})598 3587
y(if)g(\(np>0\){)676 3678 y(for\(off_prop_t)k
(snp=psaved->get_length\(\);)i(snp--)40 b(>0;\))755 3769
y(if)f(\(\(*psaved\)[snp].get_val\(\)!=O)q(FF_I)q(D_NU)q(LL\))833
3861 y(self->set_prop\(snp,\(*psaved\)[)q(snp])q(.get)q(_val\()q(\)\);)
676 3952 y(delete)i(psaved;)598 4043 y(})1885 5255 y
Fz(570)p eop
PStoPSsaved restore
%%Page: (572,573) 287
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
571 572 bop 639 523 a Fz(Once)24 b(prop)r(erties)e(are)h(adjusted,)i(w)
n(e)f(are)e(in)i(the)g(con)n(text)g(of)g(the)g(handler.)35
b(A)24 b(single-)515 623 y(domain)31 b(up)r(call)h(su\016ces.)49
b(W)-7 b(e)32 b(m)n(ust)f(\014rst)h(setup)g(a)f(v)-5
b(alid)32 b(stac)n(k)e(frame)i(for)f(the)h(p)r(ortal)515
722 y(handler,)c(allo)r(cating)g(one)h(a)n(v)-5 b(ailable)27
b(stac)n(k)h(p)r(oin)n(ter)h(from)f(the)h(stac)n(k)f(p)r(o)r(ol.)41
b(Then)29 b(cop)n(y)515 822 y(the)f(message)e(out)h(to)h(the)g(user)f
(stac)n(k)g(and,)g(\014nally)-7 b(,)28 b(issue)f(the)h(up)r(call.)639
922 y(When)c(there)f(are)f(no)h(more)f(free)h(stac)n(ks,)f(an)n(y)h
(further)g(call)f(on)h(the)g(p)r(ortal)g(will)g(either)515
1021 y(blo)r(c)n(k)i(or)h(fail.)36 b(These)26 b(blo)r(c)n(k)n(ed)f(sh)n
(uttles)h(should)g(b)r(e)h(queued)f(\(using)g(sh)n(uttle)g(iden)n
(ti\014ers)515 1121 y(instead)h(of)g(p)r(oin)n(ters,)g(so)f(that)i(the)
g(list)f(can)g(span)g(sev)n(eral)f(no)r(des\))h(using)g(the)h
Fx(p)p 3092 1121 27 4 v 30 w(wstack)515 1220 y Fz(priv)-5
b(ate)21 b(mem)n(b)r(er.)35 b(When)23 b(a)f(new)g(stac)n(k)f(is)h(made)
g(a)n(v)-5 b(ailable,)21 b(they)i(should)f(b)r(e)g(a)n(w)n(ak)n(ened.)
515 1320 y(As)27 b(of)h(to)r(da)n(y)-7 b(,)27 b(w)n(e)g(simply)h(fail)g
(and)f(return)g(an)g(error)f(co)r(de)i(in)f(suc)n(h)h(a)f(case.)515
1451 y Fk(h)p Fj(Other)h Fi(off)p 885 1451 24 4 v 29
w(Prtl)g Fj(private)h(memb)l(ers.)f Fk(i)p Fq(\021)676
1543 y Fi(off_Bureaucrat)43 b(p_wstack;)e(//)f(No)f(stack)i(available)g
(on)f(a)f(PCT)h(portal)639 1682 y Fz(Register)27 b(v)-5
b(alues)26 b(when)i(coming)e(bac)n(k)h(from)f(the)i(up)r(call)f(are)f
(copied)h(in)n(to)g(a)g(temp)r(o-)515 1782 y(rary)f(bu\013er.)515
1913 y Fk(h)p Fj(Up)l(c)l(al)t(l)h(fr)l(om)g Fi(self)i
Fj(with)e Fi(sender)i Fj(and)f Fi(msg)p Fj(,)g(and)g(get)g
Fi(krep)p Fj(.)g Fk(i)p Fq(\021)676 2004 y Fi({)755 2095
y(off_mdepStck)42 b(sp;)755 2187 y(off_mdepStck)g(tramp;)755
2278 y(off_Msg)197 b(*umsg;)755 2369 y(off_Msg)g(*urep;)755
2461 y(vm_size_t)119 b(*ursz=&rsz;)755 2552 y(natural_t)g
(spid=p_mdep.sp_alloc\(sp\);)755 2643 y(off_mdepStck)42
b(initial=sp;)755 2735 y(while)e(\(!spid\){)833 2826
y(w_unlock\(\);)833 2917 y(p_wait.wait\(\);)833 3009
y(w_lock\(\);)833 3100 y(spid=p_mdep.sp_alloc\(sp\);)833
3191 y(initial=sp;)755 3283 y(})755 3374 y(assert\(spid\);)755
3465 y(tramp=\(register_t\)sp.alloca\(OFF)q(_UCT)q(RAMP)q(_SIZE)q(\);)
755 3557 y(w_unlock\(\);)755 3648 y(umsg=off_mdepPrtl::setup_stack\()q
(send)q(er,m)q(sg,ms)q(z,ur)q(sz,sp)q(\);)755 3739 y
(urep=\(off_Msg*\)\(\(\(char*\)umsg\)+\()q(\(\(ms)q(z\)+0)q(x3\)&~)q
(0x3\))q(\);)755 3831 y(off_mdepPrtl::copyout\(umsg,msg,)q(msz\))q(;)
755 3922 y(//do_debug\(printf\("upcall\(\045x,\045x)q(\)\\n")q(,sp,)q
(p_mde)q(p.ge)q(t_ent)q(ry\(\))q(\)\);)755 4013 y
(err=off_upcall\(sp,p_mdep.get_en)q(try\()q(\),tr)q(amp\);)755
4105 y(if)f(\(!err\){)833 4196 y(if)h(\(rsz)g(>)f(*ursz\))912
4287 y(rsz=*ursz;)833 4379 y(off_mdepPrtl::copyin\(krep,ure)q(p,rs)q
(z\);)755 4470 y(})755 4561 y(p_mdep.sp_free\(spid,initial\);)755
4653 y(p_wait.signal\(\);)676 4744 y(})515 4915 y Fk(h)p
Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p 1552
4915 V 29 w(Prtl)p Fj(.)f Fk(i)p Fz(+)p Fq(\021)598 5006
y Fi(off_Cond)41 b(p_wait;)1885 5255 y Fz(571)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
572 573 bop 515 523 a Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l
(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 523 24 4 v 29
w(Prtl)p Fj(.)h Fk(i)p Fq(\021)598 614 y Fi(p_wait\(\),)515
789 y Fk(h)p Fj(O\013)f(p)l(ortal)h(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 880 y Fi(#include)41 b(<klib/Bureaucrat.h>)
639 1021 y Fz(A)28 b(register-passing,)d(message-less)g(v)n(ersion)h
(of)i(PCT)f(is)g(included)h(to)r(o.)515 1154 y Fk(h)p
Fi(off)p 667 1154 V 29 w(Prtl::pct)h Fj(implementation.)e
Fk(i)p Fz(+)p Fq(\021)598 1245 y Fi(//)39 b(This)i(version)f(is)g
(faster)h(and)f(transfers)h(only)f(what)g(can)g(be)g(kept)g(in)598
1337 y(//)f(machine)i(registers.)598 1428 y(//)e(\(Locally\))j
(delivers)f(a)e(message)i(to)f(this)g(portal)g(using)h(a)e(PCT.)598
1519 y(err_t)h(off_Prtl::pct\(const)k(off_shtl_id_t)e(&sender,)f
(natural_t)g(tmout\))598 1611 y({)676 1702 y(off_Shtl)g
(*self=off_Shtl::self\(\);)676 1793 y(err_t)158 b(err=ENOSYS;)676
1885 y Fk(h)p Fi(off)p 828 1885 V 29 w(Prtl::kpct)30
b Fj(lo)l(c)l(al)d(variables.)h Fk(i)676 2067 y Fi(\(void\)tmout;)709
b(//)40 b(XXX)g(not)g(implemented)676 2159 y(assert\(self)i(&&)e
(self->valid\(\)\);)676 2250 y(w_lock\(\);)676 2341 y
Fk(h)p Fj(Save)28 b(and)g(r)l(eset)i Fi(self)e Fj(pr)l(op)l(erties.)h
Fk(i)676 2433 y Fi(//)40 b(lock)g(will)g(be)g(released)h(right)f
(before)h(the)f(upcall.)676 2524 y Fk(h)p Fj(Up)l(c)l(al)t(l)28
b(fr)l(om)f Fi(self)h Fj(with)g Fi(sender)p Fj(.)g Fk(i)676
2615 y(h)p Fj(R)l(estor)l(e)i Fi(self)e Fj(pr)l(op)l(erties.)h
Fk(i)676 2798 y Fi(return)41 b(err;)598 3072 y(})1885
5255 y Fz(572)p eop
PStoPSsaved restore
%%Page: (574,575) 288
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
573 574 bop 639 523 a Fz(Where)28 b(the)g(only)f(thing)h(di\013eren)n
(t)f(is)515 639 y Fk(h)p Fj(Up)l(c)l(al)t(l)g(fr)l(om)g
Fi(self)i Fj(with)e Fi(sender)p Fj(.)i Fk(i)p Fq(\021)598
731 y Fi({)676 822 y(off_mdepStck)42 b(sp;)676 913 y(off_mdepStck)g
(tramp;)676 1005 y(off_mdepUProcRegs)h(*uregs=self->get_ctx\(\).get_e)q
(leme)q(nt\(\)-)q(>c_r)q(egs-)q(>get_)q(ureg)q(s\(\);)676
1096 y(natural_t)120 b(spid=p_mdep.sp_alloc\(sp\);)676
1187 y(off_mdepStck)42 b(initial=sp;)676 1279 y(while)f(\(!spid\){)755
1370 y(w_unlock\(\);)755 1461 y(p_wait.wait\(\);)755
1553 y(w_lock\(\);)755 1644 y(spid=p_mdep.sp_alloc\(sp\);)755
1735 y(initial=sp;)676 1826 y(})755 1918 y(assert\(spid\);)755
2009 y(tramp=\(register_t\)sp.alloca\(OFF)q(_UCT)q(RAMP)q(_SIZE)q(\);)
755 2100 y(w_unlock\(\);)755 2192 y(\(void\)sender;)755
2283 y(err=off_upcall\(sp,p_mdep.get_en)q(try\()q(\),tr)q(amp,u)q(regs)
q(\);)755 2374 y(p_mdep.sp_free\(spid,initial\);)755
2466 y(p_wait.signal\(\);)598 2648 y(})515 2897 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(implementation)g(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 2989 y Fi(#include)41 b(<prtl/upcall.h>)317
b(//)40 b(for)g(upcall)g(and)g(OFF_UCTRAMP_SIZE)1885
5255 y Fz(573)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
574 575 bop 515 523 a FA(Message)30 b(deliv)m(ering)515
676 y Fz(T)-7 b(o)26 b(deliv)n(er)g(a)g(message)g(w)n(e)g(m)n(ust)h
(temp)r(orarily)e(blo)r(c)n(k)i(the)g(target)f(sh)n(uttle,)h(then)g
(install)515 776 y(a)k(new)g(con)n(text)g(for)f(the)i(up)r(call)f(and)g
(un)n(blo)r(c)n(k)g(it.)48 b(The)31 b(pro)r(cedure)g(is)g(v)n(ery)f
(similar)g(to)515 876 y(the)24 b(creation)g(of)g(a)g(new)g(sh)n(uttle,)
i(but)f(for)e(the)i(cross-domain)d(installation)i(of)g(the)h(up)r(call)
515 975 y(con)n(text.)515 1108 y Fk(h)p Fi(off)p 667
1108 24 4 v 29 w(Prtl::deliver)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 1199 y Fi(//)39 b(Delivers)i(an)f(event)h(to)e(a)h
(portal)g(\(one-way)h(PCT\).)598 1291 y(//)e(\(May)i(reset)f(the)g
(stack\))598 1382 y(err_t)g(off_Prtl::deliver\(const)45
b(off_shtl_id_t)d(&sender,)1539 1473 y(vm_offset_t)g(msz,)e(off_Msg)h
(*msg,)f(natural_t)i(tmout\))598 1565 y({)676 1656 y(off_Msg)80
b(*kmsg;)676 1747 y(if)40 b(\(p_maxmsg<msz\))755 1839
y(return)g(E2BIG;)676 1930 y(kmsg=\(off_Msg*\)__builtin_all)q(oca\(m)q
(sz+1)q(\);)676 2021 y(if)g(\(!kmsg\))755 2113 y(return)g(ENOMEM;)676
2204 y(off_mdepPrtl::copyin\(kmsg,ms)q(g,msz)q(\);)676
2295 y(return)h(kdeliver\(sender,msz,kmsg,tmout)q(\);)598
2478 y(})639 2710 y Fz(The)28 b(in-k)n(ernel)e(v)n(ersion)h(a)n(v)n
(oids)e(the)j(cop)n(y-in)f(for)g(the)h(message.)515 2843
y Fk(h)p Fi(off)p 667 2843 V 29 w(Prtl::kdeliver)i Fj(implementation.)e
Fk(i)o Fq(\021)598 2934 y Fi(//)39 b(Delivers)i(an)f(event)h(to)e(a)h
(portal)g(\(one-way)h(PCT\).)598 3026 y(//)e(in-kernel)j(version)598
3117 y(//)d(When)i(called)f(with)g(sender)h(OFF_SHTL_NULL,)h(the)e
(request)h(originates)h(from)e(the)598 3208 y(//)f(kernel.)598
3300 y(//)g(Msg)h(will)g(be)g(deleted)h(by)f(the)g(receiver)h(kernel)f
(ctx)g(unless)h(originated)g(from)f(the)598 3391 y(//)f(kernel.)598
3482 y(err_t)h(off_Prtl::kdeliver\(const)45 b(off_shtl_id_t)d(&sender,)
1578 3574 y(vm_offset_t)g(msz,)e(off_Msg)h(*msg,)f(natural_t)i(tmout\))
598 3665 y({)676 3756 y(\(void\)tmout;)709 b(//)40 b(XXX)g(not)g
(implemented)676 3848 y(r_lock\(\);)676 3939 y Fk(h)p
Fj(Ensur)l(e)29 b Fi(p)p 1009 3939 V 28 w(sid)g Fj(is)e(c)l(ache)l(d)i
(in)e Fi(p)p 1641 3939 V 28 w(s)p Fj(.)h Fk(i)676 4030
y(h)p Fj(F)-6 b(al)t(l)27 b(b)l(ack)i(to)f(a)f(p)l(ct)i(if)d
(delivering)i(to)g(ourselves.)h Fk(i)676 4122 y Fi(p_s->block\(\);)676
4213 y Fk(h)p Fj(Setup)g(up)l(c)l(al)t(l)e(in)g Fi(p)p
1273 4213 V 29 w(s)h Fj(to)g(the)g(p)l(ortal)h(hand)t(ler)f(with)g
Fi(msg)p Fj(.)f Fk(i)676 4304 y Fi(p_s->unblock\(\);)676
4396 y(r_unlock\(\);)676 4487 y(return)41 b(EOK;)598
4578 y(})1885 5255 y Fz(574)p eop
PStoPSsaved restore
%%Page: (576,577) 289
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
575 576 bop 639 523 a Fz(W)-7 b(e)29 b(ensure)f(that)h
Fx(p)p 1273 523 27 4 v 31 w(sid)e Fz(corresp)r(onds)g(to)i(a)f(lo)r
(cal)g(sh)n(uttle)h(and)f(cac)n(he)g(a)g(p)r(oin)n(ter)g(to)515
623 y(the)35 b(sh)n(uttle)f(in)h Fx(p)p 1099 623 V 31
w(s)p Fz(.)57 b(Otherwise)34 b(a)g(missing)g(exception)g(is)g(raised)g
(so)g(the)g(user)g(could)515 722 y(relo)r(cate)c(the)i(p)r(ortal)f
(close)g(to)g(the)h(sh)n(uttle.)49 b(Other)30 b(strange)h(case)f(is)i
(when)f(deliv)n(ering)515 822 y(to)c(ourselv)n(es,)f(w)n(e)h(fall)h(do)
n(wn)f(in)n(to)g(a)g Fx(kpct)g Fz(in)g(suc)n(h)h(a)f(case.)515
955 y Fk(h)p Fj(Ensur)l(e)h Fi(p)p 847 955 24 4 v 29
w(sid)g Fj(is)f(c)l(ache)l(d)i(in)f Fi(p)p 1480 955 V
28 w(s)p Fj(.)f Fk(i)p Fq(\021)598 1046 y Fi(if)39 b(\(!p_s\){)676
1137 y(if)h(\(p_sid==OFF_ID_NULL\))755 1229 y(return)g(ENOSYS;)676
1320 y(if)g(\(shtl.is_local\(p_sid\)\))755 1411 y(p_s=shtl+p_sid;)676
1503 y(if)g(\(!p_s)g(||)g(!shtl.is_local\(p_sid\)\){)755
1594 y(r_unlock\(\);)755 1685 y(panic\("deliver:)i(should)f(raise)f
(missing,)h(but)f(not)g(yet)g(implemented."\);)676 1777
y(})598 1868 y(})515 2042 y Fk(h)p Fj(F)-6 b(al)t(l)27
b(b)l(ack)h(to)g(a)g(p)l(ct)g(if)f(delivering)h(to)g(ourselves.)h
Fk(i)p Fq(\021)598 2134 y Fi(if)39 b(\(p_s==off_Shtl::self\(\)\){)676
2225 y(vm_size_t)i(rsz=0;)676 2316 y(r_unlock\(\);)676
2408 y(return)g(kpct\(sender,msz,rsz,msg,NULL,t)q(mout)q(\);)598
2499 y(})515 2673 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2673 V 29 w(Prtl)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 2765 y Fi(off_Shtl)41 b(*p_s;)707 b(//)40
b(cached)g(p_sid)515 2939 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)
l(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 2939 V 29 w(Prtl)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 3030 y Fi(p_s\(NULL\))1885
5255 y Fz(575)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
576 577 bop 639 523 a Fz(The)35 b(up)r(call)f(setup)h(is)f(lik)n(e)f
(the)i(one)f(used)g(to)g(create)g(a)g(new)g(sh)n(uttle,)i(but)f(for)f
(the)515 623 y(domain)19 b(crossing.)33 b(W)-7 b(e)20
b(ha)n(v)n(e)f(to)h(store)f(a)h(new)g(con)n(text)g(for)f
Fx(upcall)f Fz(in)i(the)h(target)e(sh)n(uttle)515 722
y(and)29 b(link)g(it)h(with)g(the)f(previous)f(one.)42
b(Besides,)29 b(old)g(prop)r(ert)n(y)f(v)-5 b(alues)29
b(m)n(ust)g(b)r(e)h(stored)515 822 y(on)h(the)i(target)e(sh)n(uttle,)i
(so)f(it)g(could)g(restore)e(them)j(up)r(on)f(handler)f(completion.)50
b(The)515 922 y(message)26 b(is)h(transferred)g(to)r(o.)515
1054 y Fk(h)p Fj(Setup)h(up)l(c)l(al)t(l)g(in)f Fi(p)p
1112 1054 24 4 v 28 w(s)h Fj(to)g(the)h(p)l(ortal)f(hand)t(ler)h(with)e
Fi(msg)p Fj(.)h Fk(i)p Fq(\021)598 1146 y Fi({)676 1237
y(off_prop_t)42 b(np;)676 1328 y(off_mdepProcRegs)h
(*kregs=p_s->get_ctx\(\).get_ele)q(ment)q(\(\)->c)q(_reg)q(s;)676
1420 y(off_mdepProcRegs)g(*uregs=p_s->get_user_ctx\(\).ge)q(t_el)q
(ement)q(\(\)->)q(c_re)q(gs;)676 1511 y(off_dtlb_id_t)f(sdtlb;)676
1602 y(off_mdepStck)199 b(ksp=kregs->get_sp\(\);)676
1694 y(off_ShtlPropAllocator)44 b(*psaved=NULL;)676 1785
y(off_ShtlCtx)238 b(*new_ctx=\(off_ShtlCtx*\)ksp.al)q(loca)q(\(size)q
(of\(o)q(ff_S)q(htlCt)q(x\)\);)676 1876 y(off_mdepProcRegs)43
b(*new_kregs=\(off_mdepProcRegs*)q(\))1814 1968 y
(ksp.alloca\(sizeof\(off_mdepProc)q(Regs)q(\)\);)676
2059 y(off_Msg)394 b(*kmsg=\(off_Msg*\)ksp.alloca\(\(m)q(sz+0)q(x3\)&~)
q(0x3\))q(;)676 2150 y(register_t)42 b(usp=uregs->get_sp\(\);)676
2242 y(memcpy\(kmsg,msg,msz\);)676 2333 y(new_ctx->c_regs=new_kregs;)
676 2424 y(p_s->push_current_ctx\(new_ct)q(x\);)676 2516
y Fk(h)p Fj(Save)28 b(and)g(r)l(eset)i Fi(p)p 1263 2516
V 28 w(s)e Fj(pr)l(op)l(erties)i(in)d Fi(psaved)i Fj(and)f
Fi(sdtlb)p Fj(.)g Fk(i)676 2607 y Fi(p_mdep.setup_kctx\(ksp,kregs,)q
(new_k)q(regs)q(,sen)q(der,p)q(save)q(d,sdt)q(lb,m)q(sz,k)q(msg,u)q
(sp\);)598 2698 y(})515 2873 y Fk(h)p Fj(Save)g(and)g(r)l(eset)h
Fi(p)p 1101 2873 V 29 w(s)e Fj(pr)l(op)l(erties)j(in)d
Fi(psaved)i Fj(and)f Fi(sdtlb)p Fj(.)g Fk(i)p Fq(\021)598
2964 y Fi(np=\(p_props\)?p_props->get_nall)q(oc\(\):)q(0;)598
3055 y(if)39 b(\(np>0)i(||)e(p_dtlb!=OFF_ID_NULL\){)676
3147 y(if)h(\(p_s->get_allocator\(\)\){)755 3238 y(psaved)g(=)g(new)g
(off_ShtlPropAllocator\(\);)755 3329 y
(*psaved=*p_s->get_allocator\(\);)755 3421 y(for)g(\(natural_t)h
(snp=psaved->get_length\(\);)k(snp--)40 b(>0;)g(\))833
3512 y(if)g(\(snp)g(!=)g(OFF_SHTLP_DTLB)i(&&)e
(\(*p_props\)[snp].get_val\(\)!=OFF)q(_PRTL)q(_NUL)q(L\))912
3603 y(p_s->set_prop\(snp,\(*p_props\)[sn)q(p].g)q(et_va)q(l\(\)\))q(;)
676 3694 y(})676 3786 y(if)g(\(p_dtlb!=OFF_ID_NULL\))k({)755
3877 y(sdtlb=p_s->get_dtlb\(\);)755 3968 y(p_s->set_dtlb\(p_dtlb\);)676
4060 y(})676 4151 y(else)755 4242 y(sdtlb=OFF_ID_NULL;)598
4334 y(})1885 5255 y Fz(576)p eop
PStoPSsaved restore
%%Page: (578,579) 290
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
577 578 bop 639 523 a Fz(No)n(w)40 b(the)h(target)e(sh)n(uttle)h(is)g
(ready)g(to)g(b)r(e)g(un)n(blo)r(c)n(k)n(ed)g(again,)i(as)d
Fx(deliver)f Fz(did.)515 623 y(Whenev)n(er)23 b(it)i(runs)e(again,)h
Fx(do)p 1497 623 27 4 v 31 w(deliver)d Fz(will)j(b)r(e)h(in)n(v)n(ok)n
(ed.)34 b(It)24 b(simply)h(issues)e(an)h(up)r(call.)515
722 y(Up)r(on)j(return)g(it)h(reload)d(old)i(prop)r(erties)f(and)h(p)r
(ops)g(its)h(con)n(text)e(\(so)h(that)h(the)f(previous)515
822 y(one)g(is)g(reloaded\).)515 955 y Fk(h)p Fi(off)p
667 955 24 4 v 29 w(prtl)p 852 955 V 29 w(do)p 959 955
V 28 w(deliver)i Fj(implementation.)f Fk(i)p Fq(\021)598
1046 y Fi(extern)40 b(volatile)h(void)g
(off_prtl_do_deliver\(off_ShtlPro)q(pAllo)q(cato)q(r)k(*psaved,)2206
1137 y(off_dtlb_id_t)d(sdtlb,)2206 1229 y(off_shtl_id_t)g(sender,)2206
1320 y(vm_size_t)f(msz,)f(off_Msg)h(*msg,)2206 1411 y(vm_offset_t)h
(sp,vm_offset_t)g(upc\))598 1503 y({)676 1594 y(off_mdepStck)g(usp=sp;)
676 1685 y(off_mdepStck)g(tramp=\(register_t\)usp.alloca)q(\(OFF_)q
(UCTR)q(AMP_S)q(IZE\))q(;)676 1777 y(off_Msg)198 b(*umsg;)676
1868 y(vm_size_t)120 b(rsz=0;)676 1959 y(vm_size_t)g(*ursz=&rsz;)676
2142 y(off_Shtl)41 b(*self=off_Shtl::self\(\);)676 2233
y(umsg=off_mdepPrtl::setup_sta)q(ck\(se)q(nder)q(,msg)q(,msz,)q(ursz)q
(,usp\))q(;)676 2325 y(off_mdepPrtl::copyout\(umsg,m)q(sg,ms)q(z\);)676
2416 y(off_upcall\(usp,upc,tramp\);)676 2507 y Fk(h)p
Fj(R)l(estor)l(e)30 b Fi(self)e Fj(pr)l(op)l(erties)i(with)d
Fi(psaved)i Fj(and)f Fi(sdtlb)p Fj(.)g Fk(i)676 2599
y Fi(off_Processor::clri\(\);)676 2690 y
(off_Shtl::self\(\)->pop_ctx\(\);)676 2781 y
(off_mdep_load_kregs\(off_Shtl)q(::sel)q(f\(\)-)q(>get)q(_ctx\()q
(\).ge)q(t_ele)q(ment)q(\(\)->)q(c_reg)q(s,EU)q(OK\);)676
2873 y(otsan\(\);)598 3055 y(})515 3321 y Fk(h)p Fj(R)l(estor)l(e)h
Fi(self)f Fj(pr)l(op)l(erties)i(with)e Fi(psaved)h Fj(and)f
Fi(sdtlb)p Fj(.)g Fk(i)p Fq(\021)598 3412 y Fi(if)39
b(\(psaved\){)676 3504 y(for\(off_prop_t)k(snp=psaved->get_length\(\);)
i(snp--)40 b(>0)g(;\))755 3595 y(if)f(\(snp)h(!=)g(OFF_SHTLP_DTLB)j(&&)
c(\(*psaved\)[snp].get_val\(\)!=OF)q(F_ID)q(_NULL)q(\))833
3686 y(self->set_prop\(snp,\(*psaved\)[)q(snp])q(.get)q(_val\()q(\)\);)
676 3778 y(delete)i(psaved;)598 3869 y(})598 3960 y(if)e
(\(sdtlb!=OFF_ID_NULL\))676 4051 y(self->set_dtlb\(sdtlb\);)1885
5255 y Fz(577)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
578 579 bop 639 523 a Fz(Finally)-7 b(,)28 b(there)f(is)h(a)f
(message-less)e(register-passing)g(v)n(ersion)h(of)h(deliv)n(er.)515
656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(Prtl::deliver)j
Fj(implementation.)d Fk(i)p Fz(+)p Fq(\021)598 747 y
Fi(//)39 b(A)h(faster)g(version,)i(using)e(only)g(registers.)598
839 y(err_t)g(off_Prtl::deliver\(const)45 b(off_shtl_id_t)d(&sender,)f
(natural_t)g(tmout\))598 930 y({)676 1021 y(off_Msg)g(*msg=NULL;)676
1112 y(vm_size_t)g(msz=0;)676 1204 y(r_lock\(\);)676
1295 y Fk(h)p Fj(Ensur)l(e)29 b Fi(p)p 1009 1295 V 28
w(sid)g Fj(is)e(c)l(ache)l(d)i(in)e Fi(p)p 1641 1295
V 28 w(s)p Fj(.)h Fk(i)676 1386 y(h)p Fj(F)-6 b(al)t(l)27
b(b)l(ack)i(to)f(a)f(p)l(ct)i(if)d(delivering)i(to)g(ourselves.)h
Fk(i)676 1478 y Fi(p_s->block\(\);)676 1569 y Fk(h)p
Fj(Setup)g(up)l(c)l(al)t(l)e(in)g Fi(p)p 1273 1569 V
29 w(s)h Fj(to)g(the)g(p)l(ortal)h(hand)t(ler.)f Fk(i)676
1660 y Fi(p_s->unblock\(\);)676 1752 y(r_unlock\(\);)676
1843 y(return)41 b(EOK;)598 1934 y(})515 2200 y Fk(h)p
Fj(Setup)28 b(up)l(c)l(al)t(l)g(in)f Fi(p)p 1112 2200
V 28 w(s)h Fj(to)g(the)h(p)l(ortal)f(hand)t(ler.)g Fk(i)p
Fq(\021)598 2291 y Fi({)676 2383 y(off_prop_t)42 b(np;)676
2474 y(off_mdepProcRegs)h(*kregs=p_s->get_ctx\(\).get_ele)q(ment)q
(\(\)->c)q(_reg)q(s;)676 2565 y(off_mdepStck)199 b
(ksp=kregs->get_sp\(\);)676 2657 y(off_ShtlPropAllocator)44
b(*psaved=\(off_ShtlPropAllocat)q(or*\))755 2748 y
(ksp.alloca\(sizeof\(off_ShtlPropA)q(lloc)q(ator)q(\)\);)676
2839 y(off_dtlb_id_t)160 b(sdtlb;)676 2931 y(off_ShtlCtx)238
b(*new_ctx=\(off_ShtlCtx*\)ksp.al)q(loca)q(\(size)q(of\(o)q(ff_S)q
(htlCt)q(x\)\);)676 3022 y(off_mdepProcRegs)43 b
(*new_kregs=\(off_mdepProcRegs*)q(\))2049 3113 y
(ksp.alloca\(sizeof\(off_mdepPr)q(ocReg)q(s\)\);)676
3205 y(off_mdepProcRegs)g(*uregs=p_s->get_user_ctx\(\).ge)q(t_el)q
(ement)q(\(\)->)q(c_re)q(gs;)676 3296 y(register_t)f
(usp=uregs->get_sp\(\);)676 3387 y(new_ctx->c_regs=new_kregs;)676
3479 y(p_s->push_current_ctx\(new_ct)q(x\);)676 3570
y Fk(h)p Fj(Save)28 b(and)g(r)l(eset)i Fi(p)p 1263 3570
V 28 w(s)e Fj(pr)l(op)l(erties)i(in)d Fi(psaved)i Fj(and)f
Fi(sdtlb)p Fj(.)g Fk(i)676 3661 y Fi(p_mdep.setup_kctx\(ksp,kregs,)q
(new_k)q(regs)q(,sen)q(der,p)q(save)q(d,sdt)q(lb,u)q(regs)q(,usp\))q(;)
598 3753 y(})1885 5255 y Fz(578)p eop
PStoPSsaved restore
%%Page: (580,581) 291
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
579 580 bop 639 523 a Fz(Where)18 b Fx(setup)p 1120 523
27 4 v 30 w(kctx)f Fz(will)h(arrange)e(for)i(the)h(target)e(k)n(ernel)h
(con)n(text)g(to)g(call)g Fx(do)p 3113 523 V 30 w(rdeliver)p
Fz(.)515 656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(prtl)p
852 656 V 29 w(do)p 959 656 V 28 w(rdeliver)30 b Fj(implementation.)d
Fk(i)p Fq(\021)598 747 y Fi(extern)40 b(volatile)h(void)g
(off_prtl_do_rdeliver\(off_ShtlPr)q(opAll)q(ocat)q(or)k(*psaved,)2245
839 y(off_dtlb_id_t)d(sdtlb,)2245 930 y(off_shtl_id_t)g(sender,)2245
1021 y(off_mdepProcRegs)h(*uregs,)2245 1112 y(vm_offset_t)f
(sp,vm_offset_t)g(upc\))598 1204 y({)676 1295 y(off_mdepStck)g(usp=sp;)
676 1386 y(vm_size_t)f(rsz=0;)676 1478 y(vm_size_t)g(*ursz=&rsz;)676
1569 y(off_mdepStck)h(tramp=\(register_t\)usp.alloca)q(\(OFF_)q(UCTR)q
(AMP_S)q(IZE\))q(;)676 1660 y(off_Shtl)f(*self=off_Shtl::self\(\);)676
1843 y(off_mdepPrtl::setup_stack\(se)q(nder,)q(NULL)q(,0,u)q(rsz,u)q
(sp\);)676 1934 y(off_upcall\(usp,upc,tramp,ure)q(gs->g)q(et_u)q(regs)q
(\(\)\);)676 2026 y Fk(h)p Fj(R)l(estor)l(e)30 b Fi(self)e
Fj(pr)l(op)l(erties)i(with)d Fi(psaved)i Fj(and)f Fi(sdtlb)p
Fj(.)g Fk(i)676 2117 y Fi(off_Shtl::self\(\)->pop_curren)q(t_ctx)q
(\(EUO)q(K\);)598 2208 y(})1885 5255 y Fz(579)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
580 581 bop 515 523 a FA(PCT)32 b(reply)g(delegation)515
676 y Fz(When)c(w)n(e)f(receiv)n(e)f(a)i(request)f(to)g(delegate)g(a)g
(PCT)g(our)g(history)g(is)g(as)g(follo)n(ws:)616 842
y(1.)41 b(A)28 b(sh)n(uttle)g(\014rst)f(issued)h(a)f(PCT)g(system)g
(call:)722 942 y(The)h(user)f(con)n(text)g(w)n(as)g(pushed)g(in)h(the)g
(stac)n(k.)616 1108 y(2.)41 b(Using)28 b(the)g(same)f(k)n(ernel)f(stac)
n(k)h(w)n(e)g(did)h(an)g(up)r(call:)722 1208 y(Be)33
b(it)h(a)f(register)e(passing)h(up)r(call)i(or)e(not,)j(a)d(k)n(ernel)h
(con)n(text)f(for)h(the)g(up)r(call)h(in)722 1307 y(pushed)28
b(in)g(the)g(stac)n(k.)616 1473 y(3.)41 b(The)22 b(up)r(call)f(handler)
g(on)g(the)h(target)e(domain)h(issued)g(a)g(return)g(from)g(PCT)f
(system)722 1573 y(call)33 b(sho)n(wing)f(its)h(in)n(tend)h(to)f(pass)f
(the)i(request:)47 b(The)34 b(\(new\))f(user)g(con)n(text)g(has)722
1673 y(b)r(een)28 b(pushed)g(again)f(in)g(the)h(k)n(ernel)f(k)n(ernel)g
(stac)n(k.)639 1839 y(W)-7 b(e)22 b(can)g(th)n(us)f(p)r(op)h(the)g
(last)g(\(un)n(useful\))g(user)g(con)n(text;)h(then)f(pretend)g(a)f
(return)g(from)515 1938 y(the)j(up)r(call)g(has)f(b)r(een)h(done.)35
b(As)24 b(the)g(return)g(co)r(de)f(for)g(the)i(up)r(call)e(w)n(e)h
(will)g(giv)n(e)f(a)g(magic)515 2038 y(v)-5 b(alue.)36
b(When)26 b(up)r(call)h(returns)e(it)h(to)g(the)g(PCT)g(caller)f
(routine,)h(it)g(will)g(issue)g(the)g(up)r(call)515 2137
y(again,)g(but)i(to)g(a)f(di\013eren)n(t)h(target)e(this)i(time.)722
2320 y FA(NOTE:)34 b Fz(PCT)g(delegation)f(will)i(not)f(b)r(e)h
(implemen)n(ted)g(un)n(til)f(remaining)722 2420 y(p)r(ortal)28
b(services)g(b)r(e)h(op)r(erational,)e(as)h(it)h(is)g(not)f(an)h
(strictly)f(necessary)f(fea-)722 2519 y(ture.)515 2694
y Fk(h)p Fi(off)p 667 2694 24 4 v 29 w(Prtl::pct)p 1047
2694 V 30 w(pass)h Fj(implementation.)g Fk(i)p Fq(\021)598
2785 y Fi(//)39 b(Pass)i(the)e(PCT)h(to)g(a)g(different)h(portal.)598
2876 y(//)e(Reply)i(to)e(the)h(initial)h(PCT)f(will)g(be)g(issued)h
(from)f(there.)g(\(May)g(reset)h(the)f(stack\))598 2968
y(err_t)g(off_Prtl::pct_pass\(vm_size_t)46 b(msz,)40
b(off_Msg)h(*msg\))598 3059 y({)676 3150 y(//)f(XXX)g(not)g(yet)g
(implemented.)676 3242 y(\(void\)msz;)676 3333 y(\(void\)msg;)676
3424 y(panic\("pct_pass:)j(not)d(yet)g(implemented."\);)598
3516 y(})1885 5255 y Fz(580)p eop
PStoPSsaved restore
%%Page: (582,583) 292
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
581 582 bop 515 523 a FA(IPC)32 b(in)m(terface)515 676
y Fz(The)24 b(p)r(ortal)g(serv)n(er)f(pro)n(vides)g(con)n(v)n(enience)g
(metho)r(ds)h(to)h(use)f(a)g(p)r(ortal)g(giv)n(en)f(its)i(iden)n(ti-)
515 776 y(\014er.)35 b(As)26 b(w)n(e)f(said)f(in)i(section)f(5.2.6:)34
b(IPC)25 b(pro)r(ceeds)f(b)n(y)h(lo)r(oking)f(ensuring)h(the)h(p)r
(ortal)e(is)515 876 y(lo)r(cal,)d(and)g(issuing)f(a)h
Fx(MISSING)d Fz(exception)j(to)f(the)i(sender)e(sh)n(uttle)h
(otherwise.)34 b(The)21 b(han-)515 975 y(dler)k(for)h(suc)n(h)g
(exception)f(is)h(exp)r(ected)g(to)g(b)r(eha)n(v)n(e)f(as)h(the)g
(remote)g(handler)f(b)n(y)h(lo)r(cating)515 1075 y(and)h(forw)n(arding)
f(the)i(message)e(as)h(necessary)-7 b(.)36 b(Suc)n(h)28
b(pro)r(cessing)e(is)h(done)h(b)n(y)f(wrapp)r(ers)515
1174 y(found)34 b(in)h(the)f(p)r(ortal)g(serv)n(er,)g(whic)n(h)g(will)h
(b)r(e)f(describ)r(ed)g(later.)57 b(In)34 b(what)g(follo)n(ws)f(w)n(e)
515 1274 y(assume)27 b(the)h(p)r(ortal)f(is)g(lo)r(cal.)515
1407 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1407 24 4 v 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p
Fq(\021)598 1498 y Fi(//)79 b(Delivers)41 b(a)e(message)i(to)f(this)g
(portal)g(using)h(a)e(PCT.)598 1590 y(err_t)h(pct\(const)h
(off_prtl_id_t)i(&p,)c(vm_size_t)j(msz,)e(vm_size_t)h(&rsz,)990
1681 y(off_Msg)g(*msg,)f(off_Msg)h(*reply,)g(natural_t)g(tmout\);)598
1863 y(//)e(\(Locally\))j(delivers)f(a)e(message)i(to)f(this)g(portal)g
(using)h(a)e(PCT.)598 1955 y(//)g(in-kernel)j(version.)598
2046 y(err_t)e(kpct\(const)i(off_prtl_id_t)g(&p,)e(const)g
(off_shtl_id_t)i(&sender,)1029 2137 y(vm_size_t)g(msz,)e(vm_size_t)h
(&rsz,)1029 2229 y(off_Msg)g(*msg,)f(off_Msg)h(*krep,)g(natural_t)g
(tmout\);)598 2503 y(//)e(This)i(version)f(is)g(faster)h(and)f
(transfers)h(only)f(what)g(can)g(be)g(kept)g(in)598 2594
y(//)f(machine)i(registers.)598 2685 y(err_t)f(pct\(const)h
(off_prtl_id_t)i(&p,)c(natural_t)j(tmout\);)598 2868
y(//)d(Pass)i(the)e(PCT)h(to)g(a)g(different)h(portal.)598
2959 y(//)e(Reply)i(to)e(the)h(initial)h(PCT)f(will)g(be)g(issued)h
(from)f(there.)598 3051 y(err_t)g(pct_pass\(const)j(off_prtl_id_t)f
(&p,)e(vm_size_t)h(msz,)f(off_Msg)h(*msg\);)598 3233
y(//)e(Delivers)i(an)f(event)h(to)e(a)h(portal)g(\(one-way)h(PCT\).)598
3325 y(err_t)f(deliver\(const)i(off_prtl_id_t)g(&p,)e(vm_offset_t)i
(msz,)e(off_Msg)h(*msg,)1147 3416 y(natural_t)g(tmout\);)598
3599 y(//)e(Delivers)i(an)f(event)h(to)e(a)h(portal)g(\(one-way)h
(PCT\).)598 3690 y(//)e(in-kernel)j(version)598 3781
y(//)d(When)i(called)f(with)g(sender)h(OFF_SHTL_NULL,)h(the)e(request)h
(originates)h(from)e(the)598 3873 y(//)f(kernel.)598
3964 y(//)g(Msg)h(will)g(be)g(deleted)h(by)f(the)g(receiver)h(kernel)f
(ctx)g(unless)h(originated)g(from)f(the)598 4055 y(//)f(kernel.)598
4147 y(err_t)h(kdeliver\(const)j(off_prtl_id_t)f(&p,)e(const)g
(off_shtl_id_t)i(&sender,)1186 4238 y(vm_offset_t)g(msz,)e(off_Msg)h
(*msg,)f(natural_t)h(tmout\);)598 4421 y(//)e(A)h(faster)g(version,)i
(using)e(only)g(registers.)598 4512 y(err_t)g(deliver\(const)i
(off_prtl_id_t)g(&p,)e(natural_t)i(tmout\);)1885 5255
y Fz(581)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
582 583 bop 639 523 a Fz(Their)31 b(implemen)n(tation)g(simply)h(lo)r
(cates)e(the)h(p)r(ortal)g(\(or)g(raises)e(a)i(missing)g(excep-)515
623 y(tion\))d(and)f(delegates)g(the)h(requested)f(op)r(eration)f(on)i
(it.)515 756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(PrtlSrv::pct)i
Fj(implementation.)d Fk(i)p Fq(\021)598 847 y Fi(//)79
b(Delivers)41 b(a)e(message)i(to)f(this)g(portal)g(using)h(a)e(PCT.)598
938 y(err_t)h(off_PrtlSrv::pct\(const)k(off_prtl_id_t)f(&p,)c
(vm_size_t)j(msz,)e(vm_size_t)h(&rsz,)1500 1029 y(off_Msg)g(*msg,)f
(off_Msg)h(*reply,)g(natural_t)g(tmout\))598 1121 y({)676
1212 y(off_Prtl)g(*pp;)676 1303 y(if)f(\(!is_local\(p\)\){)755
1395 y(panic\("pct:)h(should)g(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)676 1486 y(})676 1577 y(pp=\(*this\)+p;)676
1669 y(assert\(pp)h(&&)f(pp->valid\(\)\);)676 1760 y(return)h
(pp->pct\(off_Shtl::self\(\)->get_)q(id\(\))q(,msz,)q(rsz,)q(msg,r)q
(eply)q(,tmo)q(ut\);)598 1851 y(})515 2117 y Fk(h)p Fi(off)p
667 2117 V 29 w(PrtlSrv::pct)30 b Fj(implementation.)d
Fk(i)p Fz(+)p Fq(\021)598 2208 y Fi(//)39 b(\(Locally\))j(delivers)f(a)
e(message)i(to)f(this)g(portal)g(using)h(a)e(PCT.)598
2300 y(//)g(in-kernel)j(version.)598 2391 y(err_t)e
(off_PrtlSrv::kpct\(const)45 b(off_prtl_id_t)d(&p,)e(const)g
(off_shtl_id_t)i(&sender,)1539 2482 y(vm_size_t)f(msz,)g(vm_size_t)g
(&rsz,)1539 2574 y(off_Msg)g(*msg,)f(off_Msg)h(*krep,)g(natural_t)g
(tmout\))598 2665 y({)676 2756 y(off_Prtl)g(*pp;)676
2848 y(if)f(\(!is_local\(p\)\){)755 2939 y(panic\("kpct:)i(should)e
(raise)h(missing,)g(but)f(not)f(yet)h(implemented."\);)676
3030 y(})676 3122 y(pp=\(*this\)+p;)676 3213 y(assert\(pp)h(&&)f
(pp->valid\(\)\);)676 3304 y(return)h
(pp->kpct\(off_Shtl::self\(\)->get)q(_id\()q(\),msz)q(,rsz)q(,msg,)q
(krep)q(,tmo)q(ut\);)598 3396 y(})515 3661 y Fk(h)p Fi(off)p
667 3661 V 29 w(PrtlSrv::pct)30 b Fj(implementation.)d
Fk(i)p Fz(+)p Fq(\021)598 3844 y Fi(//)39 b(This)i(version)f(is)g
(faster)h(and)f(transfers)h(only)f(what)g(can)g(be)g(kept)g(in)598
3935 y(//)f(machine)i(registers.)598 4027 y(err_t)f
(off_PrtlSrv::pct\(const)k(off_prtl_id_t)f(&p,)c(natural_t)j(tmout\))
598 4118 y({)676 4209 y(off_Prtl)f(*pp;)676 4301 y(if)f
(\(!is_local\(p\)\){)755 4392 y(panic\("pct:)h(should)g(raise)f
(missing,)h(but)f(not)g(yet)g(implemented."\);)676 4483
y(})676 4575 y(pp=\(*this\)+p;)676 4666 y(assert\(pp)h(&&)f
(pp->valid\(\)\);)676 4757 y(return)h
(pp->pct\(off_Shtl::self\(\)->get_)q(id\(\))q(,tmou)q(t\);)598
4848 y(})1885 5255 y Fz(582)p eop
PStoPSsaved restore
%%Page: (584,585) 293
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
583 584 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PrtlSrv::pct)p 1164 523 V 30 w(pass)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Pass)i(the)e(PCT)h(to)g(a)g
(different)h(portal.)598 706 y(//)e(Reply)i(to)e(the)h(initial)h(PCT)f
(will)g(be)g(issued)h(from)f(there.)598 797 y(err_t)g
(off_PrtlSrv::pct_pass\(const)45 b(off_prtl_id_t)e(&p,)d(vm_size_t)h
(msz,)1696 888 y(off_Msg)g(*msg\))598 980 y({)676 1071
y(off_Prtl)g(*pp;)676 1162 y(if)f(\(!is_local\(p\)\){)755
1254 y(panic\("pct_pass:)j(should)d(raise)g(missing,)i(but)d(not)h(yet)
g(implemented."\);)676 1345 y(})676 1436 y(pp=\(*this\)+p;)676
1528 y(assert\(pp)h(&&)f(pp->valid\(\)\);)676 1619 y(return)h
(pp->pct_pass\(msz,msg\);)598 1710 y(})515 1976 y Fk(h)p
Fi(off)p 667 1976 V 29 w(PrtlSrv::deliver)31 b Fj(implementation.)c
Fk(i)p Fq(\021)598 2159 y Fi(//)39 b(Delivers)i(an)f(event)h(to)e(a)h
(portal)g(\(one-way)h(PCT\).)598 2250 y(err_t)f
(off_PrtlSrv::deliver\(const)45 b(off_prtl_id_t)d(&p,)e(vm_offset_t)i
(msz,)1657 2341 y(off_Msg)f(*msg,)f(natural_t)h(tmout\))598
2433 y({)676 2524 y(off_Prtl)g(*pp;)676 2615 y(if)f
(\(!is_local\(p\)\){)755 2707 y(panic\("deliver:)i(should)f(raise)f
(missing,)h(but)f(not)g(yet)g(implemented."\);)676 2798
y(})676 2889 y(pp=\(*this\)+p;)676 2980 y(assert\(pp)h(&&)f
(pp->valid\(\)\);)676 3072 y(return)h
(pp->deliver\(off_Shtl::self\(\)->)q(get_)q(id\(\),)q(msz,)q(msg,t)q
(mout)q(\);)598 3163 y(})515 3520 y Fk(h)p Fi(off)p 667
3520 V 29 w(PrtlSrv::deliver)31 b Fj(implementation.)c
Fk(i)p Fz(+)p Fq(\021)598 3611 y Fi(//)39 b(A)h(faster)g(version,)i
(using)e(only)g(registers.)598 3703 y(err_t)g
(off_PrtlSrv::deliver\(const)45 b(off_prtl_id_t)d(&p,)e(natural_t)i
(tmout\))598 3794 y({)676 3885 y(off_Prtl)f(*pp;)676
3977 y(if)f(\(!is_local\(p\)\){)755 4068 y(panic\("deliver:)i(should)f
(raise)f(missing,)h(but)f(not)g(yet)g(implemented."\);)676
4159 y(})676 4251 y(pp=\(*this\)+p;)676 4342 y(assert\(pp)h(&&)f
(pp->valid\(\)\);)676 4433 y(return)h
(pp->deliver\(off_Shtl::self\(\)->)q(get_)q(id\(\),)q(tmou)q(t\);)598
4525 y(})1885 5255 y Fz(583)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
584 585 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(PrtlSrv::deliver)31 b Fj(implementation.)c Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Delivers)i(an)f(event)h(to)e(a)h
(portal)g(\(one-way)h(PCT\).)598 706 y(//)e(in-kernel)j(version)598
797 y(//)d(When)i(called)f(with)g(sender)h(OFF_SHTL_NULL,)h(the)e
(request)h(originates)h(from)e(the)598 888 y(//)f(kernel.)598
980 y(//)g(Msg)h(will)g(be)g(deleted)h(by)f(the)g(receiver)h(kernel)f
(ctx)g(unless)h(originated)g(from)f(the)598 1071 y(//)f(kernel.)598
1162 y(err_t)h(off_PrtlSrv::kdeliver\(const)45 b(off_prtl_id_t)e(&p,)
1696 1254 y(const)d(off_shtl_id_t)j(&sender,)1696 1345
y(vm_offset_t)f(msz,)e(off_Msg)h(*msg,)f(natural_t)h(tmout\))598
1436 y({)676 1528 y(off_Prtl)g(*pp;)676 1619 y(if)f
(\(!is_local\(p\)\){)755 1710 y(panic\("kdeliver:)j(should)d(raise)g
(missing,)i(but)d(not)h(yet)g(implemented."\);)676 1802
y(})676 1893 y(pp=\(*this\)+p;)676 1984 y(assert\(pp)h(&&)f
(pp->valid\(\)\);)676 2076 y(return)h(pp->kdeliver\(sender,msz,msg,tm)q
(out\))q(;)598 2167 y(})515 2623 y Fn(5.2.7)112 b(Up)s(calls)515
2777 y Fz(There)28 b(is)g(some)h(shared)e(mac)n(hinery)h(to)g(implemen)
n(t)i(ev)n(en)n(t)e(deliv)n(ering.)39 b(First,)29 b(w)n(e)f(need)515
2876 y(an)e Fx(upcall)d Fz(mec)n(hanism)j(to)g(deliv)n(er)f(ev)n(en)n
(ts)h(to)g(user)f(space)g(and)h(also)f(to)h(start)g(sh)n(uttles.)639
2976 y(Up)r(calls)i(are)f(implemen)n(ted)h(b)n(y)f Fx(off)p
1817 2976 27 4 v 30 w(upcall)p Fz(.)515 3109 y Fk(h)p
Fj(O\013)g Fi(upcall)p Fj(.)h Fk(i)p Fq(\021)598 3200
y Fi(//)39 b(Upcalls)i(to)f(pc)g(at)f(usrland)i(\(or)f(kern)g(if)g
(!dtlb\))g(using)h(the)f(given)g(stack.)598 3291 y(//)598
3383 y(extern)g(err_t)h(off_upcall\(off_mdepStck)j(sp,)c(register_t)i
(pc,)d(off_mdepStck)j(tramp,)1539 3474 y(off_mdepUProcRegs)h
(*uregs=NULL\);)515 3648 y Fk(h)p Fj(O\013)27 b(up)l(c)l(al)t(l)g(dep)l
(endencies.)j Fk(i)p Fq(\021)598 3740 y Fi(#include)41
b(<klib/err.h>)434 b(//)40 b(for)g(err_t)598 3831 y(#include)h
(<hw/mdep/mProcessor.h>)j(//)c(for)g(register_t)598 3922
y(#include)h(<klib/mdep/types.h>)598 4014 y(#include)g
(<klib/mdep/mStck.h>)1885 5255 y Fz(584)p eop
PStoPSsaved restore
%%Page: (586,587) 294
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
585 586 bop 639 523 a Fz(The)31 b(implemen)n(tation)g(sa)n(v)n(es)e
(the)i(curren)n(t)f(\(k)n(ernel\))g(con)n(text)h(and)f(then)i(issues)e
(the)515 623 y(up)r(call.)76 b(On)41 b(return,)i(the)e(sa)n(v)n(ed)f
(con)n(text)g(is)g(p)r(opp)r(ed)i(o\013)e(the)i(sh)n(uttle)f(con)n
(text)f(list)515 722 y(and)29 b(the)g(previous)f(one)h(reloaded.)40
b(If)30 b(an)f(additional)f(argumen)n(t)g Fx(uregs)g
Fz(is)h(giv)n(en,)f(suc)n(h)515 822 y(register)e(v)-5
b(alues)27 b(will)h(b)r(e)g(set)f(for)h(the)g(handler)f(and)g(copied)g
(bac)n(k)g(on)g(return.)639 922 y(Note)h(ho)n(w)f(the)i(register)d
(passing)h(v)n(ersion)f(gets)h(a)h(p)r(oin)n(ter)f(to)h(the)g(user)g
(registers)e(as)515 1021 y(the)35 b(return)f(v)-5 b(alue)35
b(of)g(register)e(sa)n(ving.)57 b(Registers)34 b(m)n(ust)h(b)r(e)g
(copied)g(immediately)g(as)515 1121 y(suc)n(h)c(p)r(oin)n(ter)g(surely)
f(p)r(oin)n(ts)i(to)f(an)g(un)n(used)g(p)r(ortion)g(of)h(our)e(o)n(wn)h
(stac)n(k.)47 b(The)32 b(actual)515 1220 y(error)25 b(co)r(de)j(is)f
(in)h(the)g(high)g(part)f(of)g(the)h(\014rst)g(user)f(register.)515
1353 y Fk(h)p Fj(O\013)g Fi(upcall)i Fj(implementation.)e
Fk(i)p Fq(\021)598 1445 y Fi(//)39 b(Upcalls)i(to)f(pc)g(at)f(usrland)i
(\(or)f(kern)g(if)g(!dtlb\))g(using)h(the)f(given)g(stack.)598
1536 y(//)598 1627 y(extern)g(err_t)h(off_upcall\(off_mdepStck)j(sp,)c
(register_t)i(pc,)d(off_mdepStck)j(tramp,)1539 1719 y
(off_mdepUProcRegs)h(*uregs\))598 1810 y({)676 1901 y(err_t)e(err=EOK;)
676 1993 y(off_Shtl)g(*me=off_Shtl::self\(\);)676 2084
y(off_mdepProcRegs)i(regs;)676 2175 y(off_ShtlCtx)81
b(ctx\(&regs\);)676 2358 y(off_Processor::clri\(\);)676
2449 y(register_t)42 b(old_esp0=base_tss.esp0;)i(//)c(XXX)g(this)g
(must)g(be)g(done)g(by)g(a)f(new)676 2540 y(base_tss.esp0=get_esp\(\);)
437 b(//)40 b(\(mdep\))g(Shtl)h(method.)676 2723 y(assert\(me)g(&&)f
(me->valid\(\)\);)676 2814 y(me->push_ctx\(&ctx\);)676
2906 y(if)g(\(uregs\){)755 2997 y(if)f(\(!\(err=off_mdep_save_kregs\(&)
q(regs)q(\)\)\){)46 b(//)39 b(upcalling)833 3088 y Fk(h)p
Fj(Issue)28 b(an)g(up)l(c)l(al)t(l)g(to)g Fi(pc)g Fj(using)f
Fi(sp)p Fj(,)p Fi(uregs)p Fj(,)i(and)f Fi(tramp)p Fj(.)g
Fk(i)755 3180 y Fi(})755 3271 y(else)40 b({)941 b(//)40
b(returning)h(back)833 3362 y(//)f(ret)g(will)g(simply)g(reload)h(last)
f(kctx)g(and)g(leave)h(us)e(here)833 3454 y
(uregs->copy_rX\(\(off_mdepUProc)q(Regs)q(*\)er)q(r\);)833
3545 y(err=uregs->get_r0hi\(\);)833 3636 y(uregs->set_r0hi\(0\);)755
3728 y(})676 3819 y(})676 3910 y(else)h({)755 4002 y(if)f
(\(!\(err=off_mdep_save_kregs\(&)q(regs)q(\)\)\){)46
b(//)39 b(upcalling)833 4093 y Fk(h)p Fj(Issue)28 b(an)g(up)l(c)l(al)t
(l)g(to)g Fi(pc)g Fj(using)f Fi(sp)h Fj(and)g Fi(tramp)p
Fj(.)g Fk(i)755 4184 y Fi(})755 4276 y(else)40 b({)941
b(//)40 b(returning)h(back)833 4367 y(//)f(ret)g(will)g(simply)g
(reload)h(last)f(kctx)g(and)g(leave)h(us)e(here)755 4458
y(})676 4550 y(})676 4641 y(base_tss.esp0=old_esp0;)398
b(//)39 b(XXX)h(this)g(must)h(be)e(done)h(by)g(a)g(new)676
4732 y(me->pop_ctx\(\);)1219 b(//)40 b(\(mdep\))h(Shtl)f(method.)676
4824 y(off_Processor::seti\(\);)676 5006 y(return)h
(\(err==EUOK\)?EOK:err;)1885 5255 y Fz(585)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
586 587 bop 598 523 a Fi(})515 789 y Fk(h)p Fj(O\013)27
b(up)l(c)l(al)t(l)g(implementation)h(dep)l(endencies.)i
Fk(i)p Fq(\021)598 880 y Fi(#include)41 b(<flux/x86/base_trap.h>)j(//)c
(for)g(base_tss)h(XXX)f(base_tss)h(stuff)1853 971 y(//)f(must)g(be)g
(moved)g(to)g(an)f(mdep)h(shtl)h(method)639 1112 y Fz(Note)30
b(ho)n(w)g(the)g(error)e(co)r(de)i(giv)n(en)g(b)n(y)f(the)i(user)e
(will)h(b)r(e)h(returned)f(to)g(the)g(caller)f(of)515
1212 y Fx(upcall)p Fz(.)41 b(T)-7 b(o)29 b(express)g
Fx(EOK)p Fz(,)g(users)g(should)g(return)g Fx(EUOK)g Fz(instead)g
(\(whic)n(h)h(is)g(not)g(zero\).)515 1312 y(That)20 b(is)f(to)h
(distinguish)g(b)r(et)n(w)n(een)g(\\con)n(text)e(sa)n(v)n(ed")g(and)i
(\\con)n(text)f(reloaded")f(on)i(return)515 1411 y(from)27
b Fx(push)p 892 1411 27 4 v 30 w(current)p 1230 1411
V 28 w(ctx)p Fz(.)515 1544 y Fk(h)p Fj(Other)h(O\013)f(err)l(or)j(numb)
l(ers.)e Fk(i)p Fq(\021)598 1636 y Fi(EUOK,)1060 b(//)40
b(EOK)g(for)g(users)g(to)g(give)g(to)f(upcall_ret.)515
1810 y Fk(h)p Fj(O\013)27 b(up)l(c)l(al)t(l)g(implementation)h(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 1901 y Fi(#include)41
b(<shtl/Shtl.h>)515 2076 y Fk(h)p Fj(O\013)27 b(up)l(c)l(al)t(l)g(dep)l
(endencies.)j Fk(i)p Fz(+)o Fq(\021)598 2167 y Fi(#include)41
b(<prtl/mdep/mupcall.h>)639 2308 y Fz(Issuing)20 b(up)r(calls)g(dep)r
(ends)h(on)f(the)g(target)g(domain.)34 b(If)20 b(there)g(is)g(no)g
Ft(dtlb)g Fz(supp)r(ort,)i(or)515 2408 y(the)31 b(target)e(domain)h(is)
g(the)h(curren)n(t)e(\(i.e.)46 b(k)n(ernel\))30 b(one,)h(w)n(e)f(a)n(v)
n(oid)e(domain)i(switc)n(hing.)515 2507 y(In)36 b(an)n(y)e(case)h(w)n
(e)h(m)n(ust)f(setup)h(a)g(tramp)r(oline)f(to)g(return)h(from)f(the)h
(up)r(call)g(when)g(the)515 2607 y(handler)27 b(terminates.)515
2740 y Fk(h)p Fj(Issue)h(an)g(up)l(c)l(al)t(l)f(to)h
Fi(pc)g Fj(using)g Fi(sp)p Fj(,)p Fi(uregs)p Fj(,)g(and)g
Fi(tramp)p Fj(.)g Fk(i)p Fq(\021)598 2831 y Fi(if)39
b(\(off_DMM::is_active\(\))44 b(&&)c
(\(boolean_t\)\(me->get_dtlb\(\)\)\){)676 2922 y
(off_mdep_setup_cross_domain_)q(rret\()q(tram)q(p,sp)q(\);)676
3014 y(off_mdep_cross_domain_rcall\()q(pc,sp)q(,ure)q(gs\);)598
3105 y(})598 3196 y(else)g({)676 3288 y(otsan\(\);)865
b(//)40 b(This)g(variant)h(should)f(not)g(be)g(used.)598
3379 y(})515 3553 y Fk(h)p Fj(Issue)28 b(an)g(up)l(c)l(al)t(l)f(to)h
Fi(pc)g Fj(using)g Fi(sp)g Fj(and)g Fi(tramp)p Fj(.)g
Fk(i)p Fq(\021)598 3645 y Fi(if)39 b(\(off_DMM::is_active\(\))44
b(&&)c(\(boolean_t\)\(me->get_dtlb\(\)\)\){)676 3736
y(off_mdep_setup_cross_domain_)q(ret\(t)q(ramp)q(,sp\))q(;)676
3827 y(off_mdep_cross_domain_call\(p)q(c,sp\))q(;)676
3919 y(})598 4010 y(else)g({)676 4101 y(off_mdep_setup_single_domain)q
(_ret\()q(tram)q(p,sp)q(\);)676 4193 y(off_mdep_single_domain_call\()q
(pc,sp)q(\);)676 4284 y(})515 4458 y Fk(h)p Fj(O\013)27
b(up)l(c)l(al)t(l)g(implementation)h(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 4550 y Fi(#include)41 b(<dmm/DMM.h>)473
b(//)40 b(for)g(off_DMM::is_active)j(et)d(al.)515 4824
y Fn(5.2.8)112 b(P)m(ortal)36 b(na)m(vigation)h(and)h(insp)s(ection)722
4977 y FA(NOTE:)55 b Fz(Not)27 b(y)n(et)h(implemen)n(ted)1885
5255 y(586)p eop
PStoPSsaved restore
%%Page: (588,589) 295
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
587 588 bop 515 523 a FA(P)m(ortal)32 b(serv)m(er)h(na)m(vigation)515
668 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 668 24 4 v 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 759 y Fi(//)39 b(Returns)i(a)f(navigator)h(for)f(PrtlSrvs.)
598 851 y(off_Navigator)i(*get_navigator\(void\))i({)39
b(return)i(NULL;)f(})515 1025 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h
(server)i(dep)l(endencies.)f Fk(i)p Fz(+)o Fq(\021)598
1116 y Fi(#include)41 b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)
i(et)d(al.)515 1374 y FA(P)m(ortal)32 b(serv)m(er)h(insp)s(ection)515
1527 y Fz(W)-7 b(e)28 b(ha)n(v)n(e)e(to)i(implemen)n(t)g(these)f(t)n(w)
n(o)g(metho)r(ds.)515 1643 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 1643 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 1734 y Fi(//)39 b(Get)h(the)g(PrtlSrv)h(URL.)598
1826 y(const)f(char)g(*get_url\(void\);)598 1917 y(//)f(Returns)i(the)f
(PrtlSrv)h(name.)598 2008 y(const)f(char)g(*nameof\(void\);)639
2133 y Fz(The)20 b(URL)g(for)f(a)g(p)r(ortal)g(serv)n(er)f(is)i(that)g
(of)f(its)h(no)r(de)g(with)g Fx(prtlsrv.html)15 b Fz(app)r(ended.)515
2233 y(W)-7 b(e)38 b(use)f(a)g(new)g(mem)n(b)r(er,)j(a)d(c)n(haracter)e
(arra)n(y)h(initialized)h(the)h(v)n(ery)e(\014rst)h(time)h(it)g(is)515
2332 y(needed.)515 2448 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 2448 V 29 w(PrtlSrv)p Fj(.)g Fk(i)p
Fz(+)p Fq(\021)598 2540 y Fi(static)40 b(char)g(*p_url;)512
b(//)40 b(URL)g(for)g(this)g(PrtlSrv.)639 2664 y Fz(Initially)28
b(it)g(is)f(empt)n(y)-7 b(.)515 2780 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(server)i(static)f(memb)l(ers.)f Fk(i)p
Fz(+)o Fq(\021)598 2872 y Fi(char)40 b(*off_PrtlSrv::p_url=NULL;)84
b(//)40 b(URL)g(for)g(this)g(PrtlSrv.)515 3030 y Fk(h)p
Fi(off)p 667 3030 V 29 w(PrtlSrv::get)p 1164 3030 V 30
w(url)29 b Fj(implementation.)e Fk(i)p Fq(\021)598 3121
y Fi(//)39 b(Get)h(the)g(PrtlSrv)h(URL.)598 3212 y(const)f(char)g
(*off_PrtlSrv::get_url\(void\))598 3304 y({)676 3395
y(assert\(valid\(\)\);)676 3486 y(if)g(\(!p_url\){)755
3577 y(p_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q(FF_P)q
(RTLSR)q(V_UR)q(L\)+1)q(];)k(//+1)40 b(for)g(\\0)755
3669 y(if)f(\(p_url\){)833 3760 y(strcpy\(p_url,nd.get_url\(\)\);)833
3851 y(strcat\(p_url,OFF_PRTLSRV_URL\))q(;)755 3943 y(})676
4034 y(})676 4125 y(return)i(p_url;)598 4217 y(})639
4449 y Fz(Where)28 b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n
(e)f(URL)g(for)h(p)r(ortal)f(serv)n(ers.)515 4565 y Fk(h)p
Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e Fk(i)p
Fq(\021)598 4657 y Fi(const)40 b(char)g(OFF_PRTLSRV_URL[]="/prtlsrv.)q
(html)q(";)515 4815 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(dep)l
(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 4906 y Fi(#include)41
b(<klib/url.h>)434 b(//)40 b(for)g(OFF_PRTLSRV_URL)1885
5255 y Fz(587)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
588 589 bop 515 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
614 y Fi(#include)41 b(<string.h>)512 b(//)40 b(for)g(strcat)g(strdup)h
(et)e(al)598 706 y(#include)i(<node/Node.h>)395 b(//)40
b(for)g(nd)639 840 y Fz(The)29 b(name)f(for)g(a)h(p)r(ortal)f(serv)n
(er)e(is)j(that)g(of)f(its)h(no)r(de)g(complemen)n(ted)f(with)h(a)f
(little)515 940 y(su\016x.)37 b(The)27 b(implemen)n(tation)h(is)f
(almost)g(the)h(same)f(of)h Fx(get)p 2464 940 27 4 v
30 w(url)p Fz(.)515 1066 y Fk(h)p Fi(off)p 667 1066 24
4 v 29 w(PrtlSrv::nameof)i Fj(implementation.)e Fk(i)p
Fq(\021)598 1157 y Fi(//)39 b(Returns)i(the)f(portal)h(server)f(name.)
598 1249 y(const)g(char)g(*off_PrtlSrv::nameof\(void\))598
1340 y({)676 1431 y(assert\(valid\(\)\);)676 1522 y(if)g(\(!p_name\){)
755 1614 y(p_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q
(\("/p)q(rtlsr)q(v"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755
1705 y(if)f(\(p_name\){)833 1796 y(char)h(number[9];)833
1888 y(strcpy\(p_name,nd.nameof\(\)\);)833 1979 y
(strcat\(p_name,"/prtlsrv"\);)833 2070 y
(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q(id\(\)\))q(;)833
2162 y(strcat\(p_name,number\);)755 2253 y(})676 2344
y(})676 2436 y(return)h(p_name;)598 2527 y(})515 2779
y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g Fi(off)p
1552 2779 V 29 w(PrtlSrv)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
2871 y Fi(char)40 b(*p_name;)708 b(//)39 b(name)i(for)f(this)g
(PrtlSrv.)515 3032 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)
h(memb)l(ers)f(of)e Fi(off)p 1928 3032 V 29 w(PrtlSrv)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 3123 y Fi(p_name\(NULL\))515
3284 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3284 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
3375 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(PrtlSrv.)598
3466 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})515 3714 y FA(P)m(ortal)32 b(insp)s(ection)515
3859 y Fk(h)p Fj(Other)c(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3859 V 29 w(Prtl)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3950 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(Prtl.)598
4042 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})639 4176 y Fz(W)-7 b(e)19 b(need)g
Fx(get)p 1095 4176 27 4 v 30 w(rurl)d Fz(and)j Fx(get)p
1602 4176 V 30 w(url)p 1764 4176 V 30 w(holder)d Fz(for)i(p)r(ortals)f
(to)i(supp)r(ort)f Fx(ResUnit::get)p 3381 4176 V 26 w(url)p
Fz(.)515 4302 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e
(of)e Fi(off)p 1594 4302 24 4 v 29 w(Prtl)p Fj(.)h Fk(i)o
Fq(\021)598 4394 y Fi(//)39 b(Get)h(the)g(prtl)g(url)598
4485 y(virtual)h(const)f(char)g(*get_rurl\(void\))j(const)d({)g(return)
g(OFF_PRTL_URL;)i(})598 4576 y(//)d(Returns)i(the)f(prtl)g(name.)598
4668 y(virtual)h(char)f(*&get_url_holder\(void\);)639
4802 y Fz(He)28 b(ha)n(v)n(e)f(to)g(de\014ne)h(the)g(relativ)n(e)e(URL)
i(for)f(p)r(ortals)515 4915 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l
(de)g(urls.)e Fk(i)p Fz(+)p Fq(\021)598 5006 y Fi(const)40
b(char)g(OFF_PRTL_URL[]="#Prtl";)1885 5255 y Fz(588)p
eop
PStoPSsaved restore
%%Page: (590,591) 296
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
589 590 bop 515 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)h(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(#include)41
b(<klib/url.h>)434 b(//)40 b(for)g(OFF_PRTL_URL)598 706
y(#include)h(<stdio.h>)551 b(//)40 b(for)g(sprintf)g(et)g(al)639
847 y Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g(p)r(ortals.)515
963 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p
1552 963 24 4 v 29 w(Prtl)p Fj(.)f Fk(i)p Fz(+)p Fq(\021)598
1054 y Fi(static)40 b(char)g(*p_url;)512 b(//)40 b(URL)g(for)g(this)g
(prtl.)515 1212 y Fk(h)p Fi(off)p 667 1212 V 29 w(Prtl::get)p
1047 1212 V 30 w(url)p 1194 1212 V 29 w(holder)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 1303 y Fi(char)40 b
(*&off_Prtl::get_url_holder\(voi)q(d\))45 b({)79 b(return)41
b(p_url;)f(})639 1536 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 1652 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(static)h(memb)l(ers.)f
Fk(i)p Fq(\021)598 1743 y Fi(char)40 b(*off_Prtl::p_url=NULL;)123
b(//)39 b(URL)h(for)g(prtl.)515 2001 y Fn(5.2.9)112 b(F)-9
b(rozen)38 b(p)s(ortals)722 2154 y FA(NOTE:)55 b Fz(Not)27
b(y)n(et)h(implemen)n(ted)515 2370 y FA(F)-8 b(reezing)31
b(p)s(ortal)h(serv)m(ers)515 2515 y Fk(h)p Fj(Other)c(pr)l(ote)l(cte)l
(d)j(metho)l(ds)e(of)e Fi(off)p 1594 2515 V 29 w(PrtlSrv)p
Fj(.)h Fk(i)p Fz(+)p Fq(\021)598 2606 y Fi(//)39 b(These)i(are)f(for)g
(freeze:)598 2697 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g
(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 2789 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2880 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2971
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 3063
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
3154 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
3245 y(return)e(ENOSYS;)598 3337 y(})598 3519 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
3611 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 3702 y(\(void\)curto;)h(\(void\)toavail;)
676 3793 y(return)f(ENOSYS;)598 3885 y(})1885 5255 y
Fz(589)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
590 591 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(PrtlSrv)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(//)39 b(These)i(are)f(for)g(melt:)
598 706 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 797 y(//)f(return.)598
888 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
980 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1071 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 1162 y(\(void\)buf;)h
(\(void\)bsize;)676 1254 y(return)f(ENOSYS;)598 1345
y(})598 1436 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
1528 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 1619 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 1710 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
1802 y(return)f(ENOSYS;)598 1893 y(})515 2242 y FA(F)-8
b(reezing)31 b(p)s(ortals)515 2386 y Fk(h)p Fj(Other)d(pr)l(ote)l(cte)l
(d)j(metho)l(ds)e(of)e Fi(off)p 1594 2386 V 29 w(Prtl)p
Fj(.)h Fk(i)o Fz(+)p Fq(\021)598 2478 y Fi(//)39 b(These)i(are)f(for)g
(freeze:)598 2569 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g
(curbuf)h(in)e(buf)h(with)g(avail)h(bytes.)598 2660 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
2752 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 2843
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 2934
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
3026 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
3117 y(return)e(ENOSYS;)598 3208 y(})598 3391 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
3482 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 3574 y(\(void\)curto;)h(\(void\)toavail;)
676 3665 y(return)f(ENOSYS;)598 3756 y(})1885 5255 y
Fz(590)p eop
PStoPSsaved restore
%%Page: (592,593) 297
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
591 592 bop 515 523 a Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 523 24 4 v 29 w(Prtl)p Fj(.)h
Fk(i)o Fz(+)p Fq(\021)598 614 y Fi(//)39 b(These)i(are)f(for)g(melt:)
598 706 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 797 y(//)f(return.)598
888 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
980 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 1071 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 1162 y(\(void\)buf;)h
(\(void\)bsize;)676 1254 y(return)f(ENOSYS;)598 1345
y(})598 1436 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
1528 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 1619 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)637 1710 y(\(void\)buf;)e(\(void\)bsize;)h
(\(void\)from;)g(\(void\)size;)g(\(void\)melted_domain;)676
1802 y(return)f(ENOSYS;)598 1893 y(})515 2258 y Fn(5.2.10)112
b(Dumping)37 b(P)m(ortals)515 2411 y Fz(T)-7 b(o)27 b(dump)h(a)f(p)r
(ortal)g(serv)n(er)f(w)n(e)h(use)h(this)g(op)r(erator.)515
2528 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2528 V 29 w(PrtlSrv)p Fj(.)h Fk(i)p Fz(+)p Fq(\021)598
2619 y Fi(//)39 b(Dumps)i(prtl)f(state.)598 2710 y(friend)g(OStr)g
(&operator<<\(OStr)j(&s,)79 b(off_PrtlSrv)42 b(&p\);)515
2868 y Fk(h)p Fi(off)p 667 2868 V 29 w(PrtlSrv::operator<<)31
b Fj(implementation.)d Fk(i)p Fq(\021)598 2959 y Fi(//)39
b(Dumps)i(prtl)f(state.)598 3051 y(OStr)g(&operator<<\(OStr)j(&s,)79
b(off_PrtlSrv)42 b(&p\))598 3142 y({)676 3233 y(s)e(<<)f
(*\(off_HWCompResource*\)&p;)676 3325 y(s)h(<<)f("name=")i(<<)f
(p.nameof\(\))h(<<)f(")f(url=")i(<<)f(p.get_url\(\))h(<<)f(nl;)676
3416 y(return)h(s;)598 3507 y(})515 3773 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(server)i(implementation)e(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 3864 y Fi(#include)41 b(<klib/str.h>)434
b(//)40 b(for)g(OStr)g(et)f(al.)1885 5255 y Fz(591)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
592 593 bop 515 523 a Fn(5.2.11)112 b(P)m(ortals)36 b(for)i(plain)e
(users)515 668 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(for)g(users.)g
Fk(i)p Fq(\021)598 759 y Fi(class)40 b(off_uPrtl)h(:)f(public)g
(off_uAbsResUnit)j({)598 851 y(public:)598 942 y(#ifdef)d(__KERNEL__)
676 1033 y(off_uPrtl\(off_Prtl)k(*r\):)c(off_uAbsResUnit\(r\))j({;})676
1125 y(off_uPrtl\(off_Prtl)h(&r\):)c(off_uAbsResUnit\(&r\))j({;})598
1216 y(#endif)676 1307 y(off_uPrtl\(void\))g({;})676
1399 y(off_uPrtl\(const)g(off_id_t)e(&id\):)f(off_uAbsResUnit\(id\))k
({;})598 1581 y(#ifndef)d(__KERNEL__)676 1673 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)i(for)e(users)i(metho)l(ds.)g
Fk(i)598 1947 y Fi(#endif)598 2129 y(};)515 2353 y FA(sethndlr)41
b Fz(Sets)27 b(the)h(handler.)37 b(Receiv)n(es:)822 2519
y Fq(\017)k Fz(The)28 b(en)n(try)f(p)r(oin)n(t)g Fx(entry)p
Fz(.)822 2652 y Fq(\017)41 b Fz(The)28 b(p)r(oin)n(ter)f(to)g(the)h
(stac)n(k-p)r(oin)n(ter)e(p)r(o)r(ol)i Fx(spp)p Fz(.)822
2785 y Fq(\017)41 b Fz(The)28 b(handler)f(sh)n(uttle)h(iden)n(ti\014er)
f(\(ma)n(yb)r(e)g(none\))h Fx(s)p Fz(.)822 2918 y Fq(\017)41
b Fz(The)28 b(access)e(mo)r(de)i Fx(mode)p Fz(.)822 3051
y Fq(\017)41 b Fz(The)28 b(max)f(message)f(size)h Fx(maxmsg)p
Fz(.)822 3184 y Fq(\017)41 b Fz(Execute)27 b(access)f(righ)n(ts)h(for)g
(the)h(sh)n(uttle)g Fx(sr)p Fz(.)822 3316 y Fq(\017)41
b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(p)r(ortal)f
Fx(r)p Fz(.)722 3449 y Fk(h)p Fj(O\013)g(p)l(ortal)i(for)f(users)h
(metho)l(ds.)f Fk(i)p Fq(\021)805 3541 y Fi(void)40 b(set_hndlr\(void)j
(*entry,)1394 3632 y(void)d(*spp,)1394 3723 y(const)g(off_shtl_id_t)i
(&s,)1394 3815 y(off_mode_t)f(mode,)1394 3906 y(vm_size_t)80
b(maxmsg,)1394 3997 y(off_Rights)41 b(sr,)1394 4088 y(off_Rights)g(r)
1394 4180 y(\))e({)884 4271 y(off_prtl_set_handler_req)44
b(req\(w_p,entry,spp,s,mode,ma)q(xmsg)q(,sr,r)q(\);)884
4362 y(off_prtl_set_handler_rep)g(rep;)884 4454 y(err_t)c
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1786
4545 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
4636 y(if)f(\(err)i(||)e(rep.m_err\))962 4728 y
(errno=\(err\)?err:rep.m_err;)805 4819 y(})1885 5255
y Fz(592)p eop
PStoPSsaved restore
%%Page: (594,595) 298
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
593 594 bop 722 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)i(messages.)g
Fk(i)p Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_PRTL_SET_HNDLR)j
(0x011f)884 706 y(struct)c(off_prtl_set_handler_req:)45
b(public)c(off_ObjKernReq)h({)962 797 y(void)80 b(*p_entry;)962
888 y(void)g(*p_spp;)962 980 y(off_shtl_id_t)42 b(p_s;)962
1071 y(off_mode_t)159 b(p_mode;)962 1162 y(natural_t)198
b(p_maxmsg;)962 1254 y(off_Rights)159 b(p_sr;)962 1345
y(off_prtl_set_handler_req\(off)q(_id_)q(t)45 b(me,)1943
1436 y(void)275 b(*entry,)1943 1528 y(void)g(*spp,)1943
1619 y(const)40 b(off_shtl_id_t)i(&s,)1943 1710 y(off_mode_t)81
b(mode,)1943 1802 y(natural_t)120 b(maxmsg=0,)1943 1893
y(off_Rights)81 b(sr,)1943 1984 y(off_Rights)g(r)1943
2076 y(\))39 b(:)1041 2167 y(p_entry\(entry\),p_spp\(spp\),p_s\()q
(s\),p_)q(mode)q(\(mode)q(\),p_)q(maxm)q(sg\(ma)q(xmsg)q(\),)1041
2258 y(p_sr\(sr\),)1041 2350 y(off_ObjKernReq\(me,OFF_MSG_PRTL)q(_SET_)
q(HNDL)q(R,r\){)q(;})884 2441 y(};)884 2532 y(struct)h
(off_prtl_set_handler_rep:)45 b(public)c(off_KernRep)h({)962
2623 y(off_prtl_set_handler_rep\(err)q(_t)j(r=0\))40
b(:)g(off_KernRep\(r\))i({;})884 2715 y(};)515 2956 y
FA(setprop)f Fz(Sets)28 b(a)f(prop)r(ert)n(y)f(for)h(the)h(p)r(ortal)f
(handler.)37 b(Receiv)n(es:)822 3122 y Fq(\017)k Fz(The)28
b(prop)r(ert)n(y)e(id)i Fx(p)p Fz(.)822 3254 y Fq(\017)41
b Fz(The)28 b(v)-5 b(alue)27 b(to)h(b)r(e)g(set)f(on)g(in)n(v)n(o)r
(cation)g Fx(val)p Fz(.)822 3387 y Fq(\017)41 b Fz(Execute)27
b(access)f(righ)n(ts)h(for)g(the)h(prop)r(ert)n(y)f(v)-5
b(alue)27 b Fx(pr)p Fz(.)822 3520 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(p)r(ortal)f
Fx(r)p Fz(.)722 3653 y Fk(h)p Fj(O\013)g(p)l(ortal)i(for)f(users)h
(metho)l(ds.)f Fk(i)p Fz(+)o Fq(\021)805 3744 y Fi(//)40
b(Sets)g(the)g(value)g(for)g(a)g(given)g(property.)805
3836 y(void)g(set_prop\(off_prop_t)k(p,)c(const)g(off_id_t)h(&val,)1354
3927 y(off_Rights)h(pr,)e(off_Rights)h(r\){)884 4018
y(off_prtl_set_prop_req)j(req\(w_p,p,val,pr,r\);)884
4110 y(off_prtl_set_prop_rep)g(rep;)884 4201 y(err_t)c
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1786
4292 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
4384 y(if)f(\(err)i(||)e(rep.m_err\))962 4475 y
(errno=\(err\)?err:rep.m_err;)805 4566 y(})1885 5255
y Fz(593)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
594 595 bop 722 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)i(messages.)g
Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_PRTL_SET_PROP)j
(0x012f)884 706 y(struct)c(off_prtl_set_prop_req:)45
b(public)40 b(off_ObjKernReq)j({)962 797 y(natural_t)81
b(p_nb;)962 888 y(off_id_t)120 b(p_val;)962 980 y(off_Rights)42
b(p_propr;)962 1071 y(off_prtl_set_prop_req\(off_id)q(_t)j(me,)1825
1162 y(natural_t)d(nb,)1825 1254 y(off_id_t)81 b(val,)1825
1345 y(off_Rights)g(pr,)1825 1436 y(off_Rights)42 b(r)1825
1528 y(\))e(:)1041 1619 y(p_nb\(nb\),p_val\(val\),p_propr\(pr)q(\),)
1041 1710 y(off_ObjKernReq\(me,OFF_MSG_PRTL)q(_SET_)q(PROP)q(,r\){;)q
(})884 1802 y(};)884 1893 y(struct)g(off_prtl_set_prop_rep:)45
b(public)40 b(off_KernRep)i({)962 1984 y(off_prtl_set_prop_rep\(err_t)k
(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884 2076 y(};)515
2316 y FA(p)s(ct)f Fz(In)n(v)n(ok)n(es)25 b(the)j(p)r(ortal)f(b)r(orro)
n(wing)f(the)i(caller)e(sh)n(uttle.)37 b(Receiv)n(es:)822
2482 y Fq(\017)k Fz(Message)26 b(size)h Fx(msz)p Fz(.)822
2615 y Fq(\017)41 b Fz(Exp)r(ected)27 b(reply)h(size)f
Fx(rsz)p Fz(.)822 2748 y Fq(\017)41 b Fz(Message)26 b
Fx(msg)p Fz(.)822 2881 y Fq(\017)41 b Fz(Reply)28 b Fx(rep)p
Fz(.)822 3014 y Fq(\017)41 b Fz(Time)28 b(out)f Fx(tmout)p
Fz(.)722 3147 y Fk(h)p Fj(O\013)g(p)l(ortal)i(for)f(users)h(metho)l
(ds.)f Fk(i)p Fz(+)o Fq(\021)805 3238 y Fi(err_t)41 b(pct\(natural_t)h
(msz,)e(natural_t)h(rsz,)1198 3329 y(off_Msg)f(*msg,)h(off_Msg)g
(*rep,natural_t)h(tmout\){)884 3421 y(err_t)e
(err=off_prtl_pct\(get_id\(\),ms)q(z,rsz)q(,msg)q(,rep,)q(tmou)q(t\);)
884 3512 y(return)g(err;)805 3603 y(})805 3694 y(err_t)h(rpct\(long)g
(m1,)f(long)g(m2,)g(long)g(m3\))g({)884 3786 y(return)g
(off_prtl_rpct\(w_p,m1,m2,m3\))q(;)805 3877 y(})1885
5255 y Fz(594)p eop
PStoPSsaved restore
%%Page: (596,597) 299
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
595 596 bop 515 523 a FA(deliv)m(er)41 b Fz(Sends)28
b(an)f(async)n(hronous)e(message)h(to)i(the)g(p)r(ortal.)36
b(Receiv)n(es:)822 689 y Fq(\017)41 b Fz(Message)26 b(size)h
Fx(sz)p Fz(.)822 822 y Fq(\017)41 b Fz(Message)26 b Fx(m)p
Fz(.)822 955 y Fq(\017)41 b Fz(Time)28 b(out)f Fx(t)p
Fz(.)722 1088 y Fk(h)p Fj(O\013)g(p)l(ortal)i(for)f(users)h(metho)l
(ds.)f Fk(i)p Fz(+)o Fq(\021)805 1179 y Fi(err_t)41 b
(deliver\(natural_t)i(sz,)d(off_Msg)h(*m,)e(natural_t)j(t\){)884
1270 y(return)e(off_prtl_deliver\(w_p,sz,m,t)q(\);)805
1362 y(})805 1453 y(err_t)h(rdeliver\(long)h(m1,)e(long)g(m2,)g(long)g
(m3\){)884 1544 y(return)g(off_prtl_rdeliver\(w_p,m1,m2)q(,m3\);)805
1636 y(})515 1876 y FA(pass)h Fz(Delegates)27 b(a)g(PCT)g(reply)-7
b(.)37 b(Receiv)n(es:)822 2042 y Fq(\017)k Fz(Message)26
b(size)h Fx(msz)p Fz(.)822 2175 y Fq(\017)41 b Fz(Message)26
b Fx(m)p Fz(.)722 2308 y Fk(h)p Fj(O\013)h(p)l(ortal)i(for)f(users)h
(metho)l(ds.)f Fk(i)p Fz(+)o Fq(\021)805 2399 y Fi(err_t)41
b(pass\(natural_t)h(msz,)e(off_Msg)h(*m\){)884 2491 y(return)f
(off_prtl_pass\(w_p,)k(msz,m\);)805 2582 y(})515 2922
y Fk(h)p Fj(uPrtl.h*)11 b Fk(i)p Fq(\021)598 3014 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(messages.)h Fk(i)598 3105 y(h)p
Fj(O\013)e(p)l(ortal)h(for)g(users.)g Fk(i)1885 5255
y Fz(595)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
596 597 bop 515 523 a Fk(h)p Fj(kPrtl.h*)11 b Fk(i)p
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<prtl/Prtl.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 1984 y(#ifndef)g(__OFF_KPRTL_H)598
2076 y(#define)g(__OFF_KPRTL_H)h(1)598 2167 y(#ifdef)e(__KERNEL__)598
2350 y(class)g(off_kPrtl)h(:)f(public)g(off_kAbsResUnit)j({)598
2441 y(public:)676 2532 y(off_kPrtl\(off_Prtl)h(*r=NULL\))d(:)e
(off_kAbsResUnit\(r\))k({};)676 2623 y(virtual)e(err_t)f(handle\(const)
i(off_shtl_id_t)h(&sender,)1500 2715 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 2806 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)637
3080 y(void)f(set_handler\(off_prtl_set_hand)q(ler_)q(req)46
b(*m,off_prtl_set_handler_rep)84 b(*r\))676 3171 y({)755
3263 y(r->m_err=\(\(off_Prtl*\)w_r\)->set_)q(hndl)q(r\(\(v)q(m_off)q
(set_)q(t\)m->)q(p_en)q(try,)2206 3354 y(\(vm_offset_t\)m->p_spp,)2206
3445 y(m->p_s,NULL,m->p_mode,m->p_ma)q(xmsg)q(\);)755
3537 y(//)39 b(XXX)h(p_s)g(access)h(rights)f(should)h(be)f(checkd.)755
3628 y(//)f(A)h(prop)g(allocator)h(should)g(be)e(built)i(using)f
(p_pmask)h(and)f(given2)h(set_hndlr)676 3719 y(})637
3811 y(void)f(set_prop\(off_prtl_set_prop_re)q(q)45 b
(*m,off_prtl_set_prop_rep)84 b(*r\))676 3902 y({)755
3993 y(\(void\)r;)755 4085 y(//)39 b(XXX)h(p_propr)h(access)g(rights)f
(should)h(be)f(checked.)755 4176 y
(\(\(off_Prtl*\)w_r\)->set_prop\(m->p)q(_nb,)q(m->p)q(_val\))q(;)676
4267 y(})598 4359 y(};)598 4541 y(#endif)g(//)g(__KERNEL__)598
4633 y(#endif)g(//)g(__OFF_KPRTL_H)1885 5255 y Fz(596)p
eop
PStoPSsaved restore
%%Page: (598,599) 300
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
597 598 bop 515 523 a Fk(h)p Fj(kPrtl.C*)11 b Fk(i)p
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<prtl/Prtl.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1802 y(#include)g(<klib/mdep/debug.h>)598 1984 y(#include)g
(<prtl/kPrtl.h>)598 2167 y(err_t)f(off_kPrtl::handle\(const)45
b(off_shtl_id_t)d(&sender,)1539 2258 y(vm_size_t)f(msz,)g(vm_size_t)g
(rsz,)1539 2350 y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598
2441 y({)676 2532 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f
(sender)i(<<)f(")f(";)676 2623 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 2715 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 2806 y
(do_debug\(printf\("prtl[\045x]",m)q(->m_t)q(ype\))q(\);)676
2897 y(switch\(m->m_type\){)676 2989 y(case)h(OFF_MSG_R_INIT:)755
3080 y(return)g(EOK;)676 3171 y(case)g(OFF_MSG_PRTL_SET_HNDLR:)755
3263 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 3354 y(r->m_err=)i(EPERM;)755 3445 y(else)f(if)f
(\(msz!=sizeof\(off_prtl_set_h)q(andl)q(er_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_prtl_set_hand)q(ler_)q(rep\)\))833
3537 y(r->m_err=)h(EINVAL;)755 3628 y(else)f({)833 3719
y(set_handler\(\(off_prtl_set_han)q(dler)q(_req)q(*\)m,\()q(off_)q
(prtl_)q(set_)q(hand)q(ler_r)q(ep*\))q(r\);)755 3811
y(})755 3902 y(return)g(EOK;)676 3993 y(case)g(OFF_MSG_PRTL_SET_PROP:)
755 4085 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 4176 y(r->m_err=)i(EPERM;)755 4267 y(else)f(if)f
(\(msz!=sizeof\(off_prtl_set_p)q(rop_)q(req\))46 b(||)39
b(rsz!=sizeof\(off_prtl_set_pro)q(p_re)q(p\)\))833 4359
y(r->m_err=)i(EINVAL;)755 4450 y(else)f({)833 4541 y
(set_prop\(\(off_prtl_set_prop_r)q(eq*\))q(m,\(o)q(ff_pr)q(tl_s)q
(et_pr)q(op_r)q(ep*\))q(r\);)755 4633 y(})755 4724 y(return)g(EOK;)676
4815 y(default:)755 4907 y(return)g(off_kAbsResUnit::handle\(send)q
(er,m)q(sz,rs)q(z,m,)q(r\);)676 4998 y(})1885 5255 y
Fz(597)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
598 599 bop 598 523 a Fi(})515 971 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(server)i(for)d(users.)i Fk(i)p Fq(\021)598
1063 y Fi(class)40 b(off_uPrtlSrv)i(:)e(public)g(off_uAbsCompResource)k
({)598 1154 y(public:)598 1245 y(#ifdef)c(__KERNEL__)676
1337 y(off_uPrtlSrv\(off_PrtlSrv)45 b(*r\):)40 b
(off_uAbsCompResource\(r\))k({;})676 1428 y(off_uPrtlSrv\(off_PrtlSrv)h
(&r\):)40 b(off_uAbsCompResource\(&r\))45 b({;})598 1519
y(#endif)676 1611 y(off_uPrtlSrv\(void\))f({;})676 1702
y(off_uPrtlSrv\(const)g(off_id_t)d(&id\):)f(off_uAbsCompResource\(id\))
45 b({;})598 1885 y(#ifndef)c(__KERNEL__)676 1976 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)i(server)g(for)f(users)h(metho)l(ds.)f
Fk(i)598 2159 y Fi(#endif)598 2341 y(};)1885 5255 y Fz(598)p
eop
PStoPSsaved restore
%%Page: (600,601) 301
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
599 600 bop 515 523 a FA(allo)s(c)41 b Fz(Allo)r(cates)27
b(a)g(p)r(ortal)g(at)g(the)h(giv)n(en)f(id.)37 b(Receiv)n(es:)822
689 y Fq(\017)k Fz(Desired)27 b(id)h Fx(at)p Fz(.)822
822 y Fq(\017)41 b Fz(Protection)26 b Fx(p)h Fz(and)h
Fx(domain)d Fz(for)i(the)h(new)g(p)r(ortal.)822 955 y
Fq(\017)41 b Fz(The)28 b(en)n(try)f(p)r(oin)n(t)g Fx(entry)p
Fz(.)822 1088 y Fq(\017)41 b Fz(The)28 b(p)r(oin)n(ter)f(to)g(the)h
(stac)n(k-p)r(oin)n(ter)e(p)r(o)r(ol)i Fx(spp)p Fz(.)822
1220 y Fq(\017)41 b Fz(The)28 b(handler)f(sh)n(uttle)h(iden)n(ti\014er)
f(\(ma)n(yb)r(e)g(none\))h Fx(s)p Fz(.)822 1353 y Fq(\017)41
b Fz(The)28 b(access)e(mo)r(de)i Fx(mode)p Fz(.)822 1486
y Fq(\017)41 b Fz(The)28 b(max)f(message)f(size)h Fx(maxmsg)p
Fz(.)822 1619 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h
(for)g(the)h(serv)n(er)e Fx(r)p Fz(.)822 1752 y Fq(\017)41
b Fz(Execute)27 b(access)f(righ)n(ts)h(for)g(the)h(sh)n(uttle)g
Fx(sr)p Fz(.)822 1885 y Fq(\017)41 b Fz(Access)27 b(righ)n(ts)g(for)g
(the)h(prop)r(erties)e(\(deprecated\).)822 2017 y Fq(\017)41
b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(domain)f
Fx(dr)p Fz(.)722 2150 y Fk(h)p Fj(O\013)g(p)l(ortal)i(server)g(for)f
(users)h(metho)l(ds.)f Fk(i)p Fq(\021)805 2242 y Fi(//)40
b(Allocates)h(a)f(portal.)805 2333 y(off_uPrtl)i(alloc\(const)f
(off_prtl_id_t)i(&at,)1433 2424 y(off_Protection)f(p,)1433
2516 y(off_prtl_id_t)81 b(domain,)1433 2607 y(void)275
b(*entry,)1433 2698 y(void)g(*spp,)1433 2790 y(const)40
b(off_shtl_id_t)j(&s,)1433 2881 y(off_mode_t)81 b(mode,)1433
2972 y(natural_t)120 b(maxmsg=0,)1433 3064 y(off_Rights)81
b(sr,)1433 3155 y(off_Rights)g(dr,)1433 3246 y(off_Rights)g(r\){)884
3337 y(off_prtlsrv_allocat_req)44 b(req\(at,p,domain,entry,spp,s,)q
(mode)q(,maxm)q(sg,)1982 3429 y(sr,dr,r\);)884 3520 y
(off_prtlsrv_allocat_rep)g(rep;)884 3611 y(err_t)c
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 3703 y(if)f(\(err)i(||)e
(rep.m_err\))962 3794 y(errno=\(err\)?err:rep.m_err;)884
3885 y(return)h(rep.res;)805 3977 y(})1885 5255 y Fz(599)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
600 601 bop 722 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)i(server)g
(messages.)g Fk(i)p Fq(\021)805 614 y Fi(#define)41 b
(OFF_MSG_PRTLSRV_ALLOCAT)k(0x01f)884 706 y(struct)40
b(off_prtlsrv_allocat_req:)45 b(public)c(off_KernReq)g({)962
797 y(off_prtl_id_t)82 b(p_id;)962 888 y(off_Protection)43
b(p_prot;)962 980 y(off_prtl_id_t)82 b(p_dom;)962 1071
y(void)e(*)314 b(p_entry;)962 1162 y(void)80 b(*)314
b(p_spp;)962 1254 y(off_shtl_id_t)42 b(p_s;)962 1345
y(off_mode_t)159 b(p_mode;)962 1436 y(natural_t)198 b(p_maxmsg;)962
1528 y(off_Rights)159 b(p_sr;)962 1619 y(off_Rights)g(p_dright;)962
1710 y(off_prtlsrv_allocat_req\(cons)q(t)45 b(off_prtl_id_t)d(&at,)1904
1802 y(off_Protection)g(p,)1904 1893 y(off_prtl_id_t)81
b(domain,)1904 1984 y(void)275 b(*entry,)1904 2076 y(void)g(*spp,)1904
2167 y(const)40 b(off_shtl_id_t)i(&s,)1904 2258 y(off_mode_t)80
b(mode,)1904 2350 y(natural_t)119 b(maxmsg=0,)1433 2441
y(off_Rights)81 b(sr,)1433 2532 y(off_Rights)g(dr,)1433
2623 y(off_Rights)g(r\):)1041 2715 y
(p_id\(at\),p_prot\(p\),p_dom\(domai)q(n\),)1041 2806
y(p_entry\(entry\),p_spp\(spp\),p_s\()q(s\),p_)q(mode)q(\(mode)q(\),p_)
q(maxm)q(sg\(ma)q(xmsg)q(\),)1041 2897 y(p_sr\(sr\),p_dright\(dr\),)
1041 2989 y(off_KernReq\(OFF_MSG_PRTLSRV_AL)q(LOCAT)q(,r\))46
b({;})884 3080 y(};)884 3171 y(struct)40 b(off_prtlsrv_allocat_rep:)45
b(public)c(off_KernRep)g({)962 3263 y(off_prtl_id_t)h(res;)962
3354 y(off_prtlsrv_allocat_rep\(err_)q(t)j(r=0\))40 b(:)g
(off_KernRep\(r\))i({;})884 3445 y(};)1885 5255 y Fz(600)p
eop
PStoPSsaved restore
%%Page: (602,603) 302
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
601 602 bop 515 523 a FA(allo)s(c)41 b Fz(Allo)r(cates)27
b(a)g(p)r(ortal.)36 b(Receiv)n(es:)822 689 y Fq(\017)41
b Fz(Protection)26 b Fx(p)h Fz(and)h Fx(domain)d Fz(for)i(the)h(new)g
(p)r(ortal.)822 822 y Fq(\017)41 b Fz(The)28 b(en)n(try)f(p)r(oin)n(t)g
Fx(entry)p Fz(.)822 955 y Fq(\017)41 b Fz(The)28 b(p)r(oin)n(ter)f(to)g
(the)h(stac)n(k-p)r(oin)n(ter)e(p)r(o)r(ol)i Fx(spp)p
Fz(.)822 1088 y Fq(\017)41 b Fz(The)28 b(handler)f(sh)n(uttle)h(iden)n
(ti\014er)f(\(ma)n(yb)r(e)g(none\))h Fx(s)p Fz(.)822
1220 y Fq(\017)41 b Fz(The)28 b(access)e(mo)r(de)i Fx(mode)p
Fz(.)822 1353 y Fq(\017)41 b Fz(The)28 b(max)f(message)f(size)h
Fx(maxmsg)p Fz(.)822 1486 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(righ)n(ts)h(for)g(the)h(serv)n(er)e Fx(r)p
Fz(.)822 1619 y Fq(\017)41 b Fz(Execute)27 b(access)f(righ)n(ts)h(for)g
(the)h(sh)n(uttle)g Fx(sr)p Fz(.)822 1752 y Fq(\017)41
b Fz(Access)27 b(righ)n(ts)g(for)g(the)h(prop)r(erties)e
(\(deprecated\).)822 1885 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(righ)n(ts)h(for)g(the)h(domain)f Fx(dr)p Fz(.)722
2017 y Fk(h)p Fj(O\013)g(p)l(ortal)i(server)g(for)f(users)h(metho)l
(ds.)f Fk(i)p Fz(+)p Fq(\021)805 2109 y Fi(//)40 b(Allocates)h(any)f
(portal.)805 2200 y(off_uPrtl)i(alloc\(off_Protection)h(p,)1433
2291 y(off_prtl_id_t)81 b(domain,)1433 2383 y(void)275
b(*entry,)1433 2474 y(void)g(*spp,)1433 2565 y(const)40
b(off_shtl_id_t)j(&s,)1433 2657 y(off_mode_t)81 b(mode,)1433
2748 y(natural_t)120 b(maxmsg=0,)1433 2839 y(off_Rights)81
b(sr,)1433 2931 y(off_Rights)g(dr,)1433 3022 y(off_Rights)g(r\){)884
3113 y(off_prtlsrv_alloc_req)44 b(req\(p,domain,entry,spp,s,mode,)q
(maxm)q(sg,sr)q(,dr,)q(r\);)884 3205 y(off_prtlsrv_alloc_rep)g(rep;)884
3296 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
3387 y(if)f(\(err)i(||)e(rep.m_err\))962 3479 y
(errno=\(err\)?err:rep.m_err;)884 3570 y(return)h(rep.res;)805
3661 y(})1885 5255 y Fz(601)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
602 603 bop 722 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)i(server)g
(messages.)g Fk(i)p Fz(+)p Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_PRTLSRV_ALLOC)j(0x02f)884 706 y(struct)c
(off_prtlsrv_alloc_req:)45 b(public)40 b(off_KernReq)i({)962
797 y(off_Protection)h(p_prot;)962 888 y(off_prtl_id_t)82
b(p_dom;)962 980 y(void)e(*p_entry;)962 1071 y(void)g(*p_spp;)962
1162 y(off_shtl_id_t)42 b(p_s;)962 1254 y(off_mode_t)159
b(p_mode;)962 1345 y(natural_t)198 b(p_maxmsg;)962 1436
y(off_Rights)159 b(p_sr;)962 1528 y(off_Rights)g(p_dright;)962
1619 y(off_prtlsrv_alloc_req\(off_Pr)q(otec)q(tion)46
b(p,)1904 1710 y(off_prtl_id_t)81 b(domain,)1904 1802
y(void)275 b(*entry,)1904 1893 y(void)g(*spp,)1904 1984
y(const)40 b(off_shtl_id_t)i(&s,)1904 2076 y(off_mode_t)80
b(mode,)1904 2167 y(natural_t)119 b(maxmsg=0,)1433 2258
y(off_Rights)81 b(sr,)1433 2350 y(off_Rights)g(dr,)1433
2441 y(off_Rights)g(r\):)1041 2532 y(p_prot\(p\),p_dom\(domain\),)1041
2623 y(p_entry\(entry\),p_spp\(spp\),p_s\()q(s\),p_)q(mode)q(\(mode)q
(\),p_)q(maxm)q(sg\(ma)q(xmsg)q(\),)1041 2715 y
(p_sr\(sr\),p_dright\(dr\),)1041 2806 y
(off_KernReq\(OFF_MSG_PRTLSRV_AL)q(LOC,r)q(\))45 b({;})884
2897 y(};)884 2989 y(struct)40 b(off_prtlsrv_alloc_rep:)45
b(public)40 b(off_KernRep)i({)962 3080 y(off_prtl_id_t)g(res;)962
3171 y(off_prtlsrv_alloc_rep\(err_t)k(r=0\))40 b(:)f(off_KernRep\(r\))k
({;})884 3263 y(};)515 3504 y FA(free)e Fz(Deallo)r(cates)27
b(a)g(p)r(ortal.)37 b(Receiv)n(es:)822 3670 y Fq(\017)k
Fz(The)28 b(p)r(ortal)f(id)g Fx(p)p Fz(.)822 3802 y Fq(\017)41
b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h(p)r(ortal)f
Fx(r)p Fz(.)722 3935 y Fk(h)p Fj(O\013)g(p)l(ortal)i(server)g(for)f
(users)h(metho)l(ds.)f Fk(i)p Fz(+)p Fq(\021)805 4027
y Fi(//)40 b(Deallocates)i(a)d(portal)805 4118 y(void)h(free\()h
(off_uPrtl)g(p,)f(off_Rights)h(r\){)884 4209 y(off_prtlsrv_free_req)j
(req\(p.get_id\(\),r\);)884 4301 y(off_prtlsrv_free_rep)g(rep;)884
4392 y(err_t)c(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
4483 y(if)f(\(err)i(||)e(rep.m_err\))962 4575 y
(errno=\(err\)?err:rep.m_err;)805 4666 y(})1885 5255
y Fz(602)p eop
PStoPSsaved restore
%%Page: (604,605) 303
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
603 604 bop 722 523 a Fk(h)p Fj(O\013)27 b(p)l(ortal)i(server)g
(messages.)g Fk(i)p Fz(+)p Fq(\021)805 614 y Fi(#define)41
b(OFF_MSG_PRTLSRV_FREE)j(0x03f)884 706 y(struct)c
(off_prtlsrv_free_req:)k(public)d(off_KernReq)h({)962
797 y(off_prtl_id_t)82 b(id;)962 888 y(off_prtlsrv_free_req\(off_prt)q
(l_id)q(_t)45 b(s,)40 b(off_Rights)h(r\):)f(id\(s\),)1041
980 y(off_KernReq\(OFF_MSG_PRTLSRV_FR)q(EE,r\))46 b({;})884
1071 y(};)884 1162 y(struct)40 b(off_prtlsrv_free_rep:)k(public)d
(off_KernRep)h({)962 1254 y(off_prtlsrv_free_rep\(err_t)j(r=0\))c(:)e
(off_KernRep\(r\))j({;})884 1345 y(};)515 1685 y Fk(h)p
Fj(uPrtlSrv.h*)11 b Fk(i)q Fq(\021)598 1868 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(server)i(messages.)f Fk(i)598
2051 y(h)p Fj(O\013)e(p)l(ortal)h(server)i(for)d(users.)i
Fk(i)1885 5255 y Fz(603)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
604 605 bop 515 523 a Fk(h)p Fj(kPrtlSrv.h*)11 b Fk(i)q
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<prtl/PrtlSrv.h>)
239 b(//)39 b(Exported)j(interface.)598 1528 y(#include)f(<klib/str.h>)
277 b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 1984 y(#ifndef)g(__OFF_KPRTL_SRV_H)598
2076 y(#define)g(__OFF_KPRTL_SRV_H)i(1)598 2167 y(#ifdef)d(__KERNEL__)
598 2350 y(class)g(off_kPrtlSrv)i(:)e(public)g(off_kAbsCompResource)k
({)598 2441 y(public:)676 2532 y(static)d(err_t)f(handler\(const)i
(off_shtl_id_t)h(&sender,)1500 2623 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 2715 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676
2897 y(virtual)g(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
2989 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 3080
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))f({)755 3171
y(return)g(off_kResource::handle\(sender)q(,msz)q(,rsz,)q(m,r\))q(;)676
3263 y(})676 3445 y(void)g(allocat\(off_prtlsrv_allocat_)q(req)46
b(*m,off_prtlsrv_allocat_rep)84 b(*r\))676 3537 y({)755
3628 y(off_Prtl)41 b(*p;)755 3719 y(p=new\(m->p_id\))h
(off_Prtl\(m->p_prot,)1696 3811 y(m->p_dom,)1696 3902
y(\(vm_offset_t\)m->p_entry,)1696 3993 y(\(vm_offset_t\)m->p_spp,)1696
4085 y(m->p_s,)1696 4176 y(\(off_ShtlPropAllocator*\)NULL,)1696
4267 y(m->p_mode,)1696 4359 y(m->p_maxmsg\);)755 4450
y(if)d(\(!p\))833 4541 y(r->m_err=EAGAIN;)755 4633 y
(r->res=\(p\)?p->get_id\(\):OFF_PRTL)q(_NUL)q(L;)676
4724 y(})676 4815 y(void)h(alloc\(off_prtlsrv_alloc_req)46
b(*m,off_prtlsrv_alloc_rep)84 b(*r\))676 4907 y({)755
4998 y(off_Prtl)41 b(*p;)1885 5255 y Fz(604)p eop
PStoPSsaved restore
%%Page: (606,607) 304
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
605 606 bop 755 523 a Fi(p=new)393 b(off_Prtl\(m->p_prot,)1696
614 y(m->p_dom,)1696 706 y(\(vm_offset_t\)m->p_entry,)1696
797 y(\(vm_offset_t\)m->p_spp,)1696 888 y(m->p_s,)1696
980 y(\(off_ShtlPropAllocator*\)NULL,)1696 1071 y(m->p_mode,)1696
1162 y(m->p_maxmsg\);)755 1254 y(if)39 b(\(!p\))833 1345
y(r->m_err=EAGAIN;)755 1436 y(r->res=\(p\)?p->get_id\(\):OFF_PRTL)q
(_NUL)q(L;)676 1528 y(})715 1619 y(void)i(free\(off_prtlsrv_free_req)j
(*m,off_prtlsrv_free_rep)84 b(*r\))676 1710 y({)755 1802
y(\(void\)r;)755 1893 y(if)39 b(\(!prtl.is_local\(m->id\)\))833
1984 y(panic\("prtl:)j(should)f(raise)f(missing,)h(but)f(not)g(yet)g
(implemented."\);)755 2076 y(\(prtl+m->id\)->unreference\(\);)676
2167 y(})598 2350 y(};)598 2623 y(extern)g(off_kPrtlSrv)i(kprtl;)598
2806 y(#endif)e(//)g(__KERNEL__)598 2897 y(#endif)g(//)g
(__OFF_KPRTL_SRV_H)1885 5255 y Fz(605)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
606 607 bop 515 523 a Fk(h)p Fj(kPrtlSrv.C*)11 b Fk(i)q
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<prtl/PrtlSrv.h>)
239 b(//)39 b(Exported)j(interface.)598 1528 y(#include)f(<klib/str.h>)
277 b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1893 y(#include)g(<prtl/kPrtlSrv.h>)598 1984 y(#include)g
(<prtl/kPrtl.h>)598 2258 y(off_kPrtlSrv)h(kprtl;)598
2441 y(err_t)e(off_kPrtlSrv::handler\(const)45 b(off_shtl_id_t)e
(&sender,)1657 2532 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1657
2623 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598 2715
y({)676 2806 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i
(<<)f(")f(";)676 2897 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 2989 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 3080 y(if)h
(\(m->m_type&OFF_MSG_ROBJ_MASK\){)755 3171 y(off_prtl_id_t)i
(s=\(\(off_ObjKernReq*\)m\)->obj;)755 3263 y(if)d
(\(!prtl.is_local\(s\)\))833 3354 y(panic\("prtl:)j(should)f(raise)f
(missing,)h(but)f(not)g(yet)g(implemented."\);)755 3445
y(else)g({)833 3537 y(off_kPrtl)h(kp\(prtl+s\);)833 3628
y(return)g(kp.handle\(sender,msz,rsz,\(off_)q(ObjKe)q(rnRe)q(q*\)m,)q
(r\);)755 3719 y(})676 3811 y(})676 3902 y(switch\(m->m_type\){)676
3993 y(case)f(OFF_MSG_R_INIT:)755 4085 y(return)g(EOK;)676
4176 y(case)g(OFF_MSG_PRTLSRV_ALLOCAT:)755 4267 y(if)f
(\(!prtl.access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q(s\)\))833
4359 y(r->m_err=)i(EPERM;)755 4450 y(else)f(if)f
(\(msz!=sizeof\(off_prtlsrv_al)q(loca)q(t_req)q(\))45
b(||)40 b(rsz!=sizeof\(off_prtlsrv_alloca)q(t_re)q(p\)\))833
4541 y(r->m_err=)h(EINVAL;)755 4633 y(else)f({)833 4724
y(kprtl.allocat\(\(off_prtlsrv_al)q(loca)q(t_re)q(q*\)m,)q(\(off)q
(_prtl)q(srv_)q(allo)q(cat_r)q(ep*\))q(r\);)755 4815
y(})755 4907 y(return)g(EOK;)676 4998 y(case)g(OFF_MSG_PRTLSRV_ALLOC:)
1885 5255 y Fz(606)p eop
PStoPSsaved restore
%%Page: (608,609) 305
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
607 608 bop 755 523 a Fi(if)39 b(\(!prtl.access_granted\(OFF_OP)q(_W,m)
q(->m_)q(right)q(s\)\))833 614 y(r->m_err=)i(EPERM;)755
706 y(else)f(if)f(\(msz!=sizeof\(off_prtlsrv_al)q(loc_)q(req\))46
b(||)39 b(rsz!=sizeof\(off_prtlsrv_allo)q(c_re)q(p\)\))833
797 y(r->m_err=)i(EINVAL;)755 888 y(else)f({)833 980
y(kprtl.alloc\(\(off_prtlsrv_allo)q(c_re)q(q*\)m)q(,\(off)q(_prt)q
(lsrv_)q(allo)q(c_re)q(p*\)r\))q(;)755 1071 y(})755 1162
y(return)g(EOK;)637 1254 y(case)g(OFF_MSG_PRTLSRV_FREE:)755
1345 y(if)f(\(msz!=sizeof\(off_prtlsrv_fre)q(e_re)q(q\))45
b(||)40 b(rsz!=sizeof\(off_prtlsrv_free_)q(rep\)\))833
1436 y(r->m_err=)h(EINVAL;)755 1528 y(else)f({)833 1619
y(kprtl.free\(\(off_prtlsrv_free_)q(req*)q(\)m,\()q(off_p)q(rtls)q
(rv_fr)q(ee_r)q(ep*\))q(r\);)755 1710 y(})755 1802 y(return)g(EOK;)676
1893 y(default:)755 1984 y(return)g(\(\(off_kAbsCompResource*\)&kpr)q
(tl\)-)q(>hand)q(le\(s)q(ender)q(,msz)q(,rsz)q(,m,r\))q(;)676
2076 y(})598 2167 y(})1885 5255 y Fz(607)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
608 609 bop 515 523 a Fn(5.2.12)112 b(P)m(ortals)36 b
Fd(C)8 b FC(++)38 b Fn(source)g(\014les)515 676 y FA(P)m(ortal)32
b(source)g(\014les)515 830 y Fz(P)n(ortal)25 b(serv)n(er)h(is)i(in)g
Fx(PrtlSrv.h)c Fz(and)j Fx(PrtlSrv.C)p Fz(.)515 962 y
Fk(h)p Fj(PrtlSrv.h*)11 b Fk(i)q Fq(\021)598 1054 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 1145 y Fi(#ifndef)41 b(__OFF_PRTL_SRV_H)598
1236 y(#define)g(__OFF_PRTL_SRV_H)h(1)598 1419 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(server)i(dep)l(endencies.)f
Fk(i)598 1602 y Fi(#ifdef)40 b(__KERNEL__)598 1693 y
Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server.)h Fk(i)598 1784
y Fi(#endif)40 b(//)g(__KERNEL__)598 1967 y(#include)h(<prtl/ex.h>)598
2058 y(#include)g(<prtl/uPrtlSrv.h>)598 2332 y(#ifdef)f(__KERNEL__)598
2424 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(exp)l(orte)l(d)g
(variables.)e Fk(i)598 2606 y Fi(//)39 b(Inline)i(methods)g(of)f
(off_PrtlSrv)598 2698 y Fk(h)p Fi(off)p 750 2698 24 4
v 29 w(PrtlSrv::valid)30 b Fj(implementation.)e Fk(i)598
2789 y(h)p Fi(off)p 750 2789 V 29 w(PrtlSrv::is)p 1208
2789 V 30 w(local)h Fj(implementation.)e Fk(i)598 2880
y(h)p Fi(off)p 750 2880 V 29 w(PrtlSrv::make)p 1286 2880
V 31 w(available)i Fj(implementation.)f Fk(i)598 2971
y(h)p Fi(off)p 750 2971 V 29 w(PrtlSrv::operator+)j Fj(implementation.)
d Fk(i)598 3063 y Fi(#endif)40 b(//)g(__KERNEL__)598
3245 y(#endif)g(//)g(!__OFF_PRTL_SRV_H)1885 5255 y Fz(608)p
eop
PStoPSsaved restore
%%Page: (610,611) 306
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
609 610 bop 515 523 a Fk(h)p Fj(PrtlSrv.C*)11 b Fk(i)p
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41
b(<prtl/PrtlSrv.h>)278 b(//)40 b(Exported)h(interface)598
888 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(server)i(implementation)e(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fj(O\013)e(p)l(ortal)h(server)i
(static)f(memb)l(ers.)f Fk(i)598 1254 y(h)p Fj(O\013)f(p)l(ortal)h
(server)i(glob)l(al)e(variables.)g Fk(i)598 1436 y(h)p
Fi(off)p 750 1436 24 4 v 29 w(PrtlSrv::get)p 1247 1436
V 31 w(allocator)h Fj(implementation.)e Fk(i)598 1528
y(h)p Fi(off)p 750 1528 V 29 w(PrtlSrv::off)p 1247 1528
V 31 w(PrtlSrv)i Fj(implementation.)e Fk(i)598 1619 y(h)p
Fi(off)p 750 1619 V 29 w(PrtlSrv::start)j Fj(implementation.)e
Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w(PrtlSrv::alloc)i
Fj(and)e Fi(free)h Fj(implementation.)e Fk(i)598 1802
y(h)p Fi(off)p 750 1802 V 29 w(PrtlSrv::notify)j Fj(implementation.)e
Fk(i)598 1893 y(h)p Fi(off)p 750 1893 V 29 w(PrtlSrv::get)p
1247 1893 V 31 w(url)g Fj(implementation.)f Fk(i)598
1984 y(h)p Fi(off)p 750 1984 V 29 w(PrtlSrv::nameof)j
Fj(implementation.)e Fk(i)598 2076 y(h)p Fi(off)p 750
2076 V 29 w(PrtlSrv::operator<<)j Fj(implementation.)d
Fk(i)598 2167 y(h)p Fi(off)p 750 2167 V 29 w(PrtlSrv::pct)i
Fj(implementation.)d Fk(i)598 2258 y(h)p Fi(off)p 750
2258 V 29 w(PrtlSrv::pct)p 1247 2258 V 31 w(pass)h Fj(implementation.)f
Fk(i)598 2350 y(h)p Fi(off)p 750 2350 V 29 w(PrtlSrv::deliver)k
Fj(implementation.)c Fk(i)639 2491 y Fz(P)n(ortals)f(in)i
Fx(Prtl.h)d Fz(and)i Fx(Prtl.C)p Fz(.)515 2623 y Fk(h)p
Fj(Prtl.h*)11 b Fk(i)p Fq(\021)598 2715 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2806 y Fi(#ifndef)41 b(__OFF_PRTL_H)598 2897
y(#define)g(__OFF_PRTL_H)h(1)598 3080 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(dep)l(endencies.)i Fk(i)598 3445 y Fi(#ifdef)40
b(__KERNEL__)598 3537 y Fk(h)p Fj(O\013)27 b(p)l(ortal.)h
Fk(i)598 3628 y Fi(#endif)40 b(//)g(__KERNEL__)598 3811
y(#ifdef)g(__KERNEL__)598 3902 y(//)f(Inline)i(methods)g(of)f(off_Prtl)
598 3993 y Fk(h)p Fi(off)p 750 3993 V 29 w(Prtl::valid)29
b Fj(implementation.)f Fk(i)598 4085 y Fi(#endif)40 b(//)g(__KERNEL__)
598 4267 y(#include)h(<prtl/ex.h>)598 4359 y(#include)g(<prtl/uPrtl.h>)
598 4633 y(#endif)f(//)g(!__OFF_PRTL_H)1885 5255 y Fz(609)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
610 611 bop 515 523 a Fk(h)p Fj(Prtl.C*)11 b Fk(i)p Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<prtl/Prtl.h>)395
b(//)40 b(Exported)h(interface)598 888 y Fk(h)p Fj(O\013)27
b(p)l(ortal)h(implementation)g(dep)l(endencies.)i Fk(i)598
1071 y(h)p Fj(O\013)d(p)l(ortal)h(static)h(memb)l(ers.)f
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 24 4 v 29 w(Prtl::off)p
1130 1345 V 30 w(Prtl)g Fj(implementation.)g Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(Prtl::set)p 1130
1436 V 30 w(hndlr)g Fj(implementation.)g Fk(i)598 1528
y(h)p Fi(off)p 750 1528 V 29 w(Prtl::set)p 1130 1528
V 30 w(prop)g Fj(implementation.)g Fk(i)598 1619 y(h)p
Fi(off)p 750 1619 V 29 w(Prtl::operator)42 b(new)28 b
Fj(implementation.)g Fk(i)598 1710 y(h)p Fi(off)p 750
1710 V 29 w(Prtl::operator)42 b(delete)29 b Fj(implementation.)e
Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(Prtl::allocate)p
1325 1802 V 31 w(pctblock)i Fj(implementation.)f Fk(i)598
1893 y(h)p Fi(off)p 750 1893 V 29 w(Prtl::deallocate)p
1403 1893 V 31 w(pctblock)i Fj(implementation.)d Fk(i)598
1984 y(h)p Fi(off)p 750 1984 V 29 w(Prtl::pct)i Fj(implementation.)f
Fk(i)598 2076 y(h)p Fi(off)p 750 2076 V 29 w(Prtl::kpct)h
Fj(implementation.)f Fk(i)598 2167 y(h)p Fi(off)p 750
2167 V 29 w(Prtl::deliver)i Fj(implementation.)d Fk(i)598
2258 y(h)p Fi(off)p 750 2258 V 29 w(Prtl::kdeliver)j
Fj(implementation.)e Fk(i)598 2350 y(h)p Fi(off)p 750
2350 V 29 w(Prtl::pct)p 1130 2350 V 30 w(pass)g Fj(implementation.)g
Fk(i)598 2441 y(h)p Fi(off)p 750 2441 V 29 w(Prtl::get)p
1130 2441 V 30 w(url)p 1277 2441 V 29 w(holder)h Fj(implementation.)e
Fk(i)598 2623 y Fi(extern)40 b("C")g({)598 2715 y Fk(h)p
Fi(off)p 750 2715 V 29 w(prtl)p 935 2715 V 29 w(do)p
1042 2715 V 28 w(deliver)29 b Fj(implementation.)f Fk(i)598
2806 y(h)p Fi(off)p 750 2806 V 29 w(prtl)p 935 2806 V
29 w(do)p 1042 2806 V 28 w(rdeliver)i Fj(implementation.)d
Fk(i)598 2989 y Fi(};)639 3221 y Fz(The)h(allo)r(cator)e(in)i(at)f
Fx(PrtlAllocator.h)22 b Fz(and)27 b Fx(PrtlAllocator.C)p
Fz(.)515 3354 y Fk(h)p Fj(PrtlA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 3445 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3537 y Fi(#ifndef)41 b(__OFF_PRTL_ALLOCATOR_H)598 3628
y(#define)g(__OFF_PRTL_ALLOCATOR_H)j(1)598 3811 y Fk(h)p
Fj(O\013)27 b(p)l(ortal)h(al)t(lo)l(c)l(ator)h(dep)l(endencies.)g
Fk(i)598 3993 y Fi(#ifdef)40 b(__KERNEL__)598 4085 y
Fk(h)p Fj(O\013)27 b(linkable)g(p)l(ortal.)h Fk(i)598
4176 y(h)p Fj(O\013)f(p)l(ortal)h(al)t(lo)l(c)l(ator.)h
Fk(i)598 4267 y Fi(#endif)40 b(//)g(__KERNEL__)598 4450
y(#ifdef)g(__KERNEL__)598 4541 y(//)f(Inline)i(methods)g(of)f
(off_PrtlAllocator)598 4633 y Fk(h)p Fi(off)p 750 4633
V 29 w(PrtlAllocator::operator+)32 b Fj(implementation.)c
Fk(i)598 4724 y Fi(#endif)40 b(//)g(__KERNEL__)598 4907
y(#endif)g(//)g(!__OFF_PRTL_ALLOCATOR_H)1885 5255 y Fz(610)p
eop
PStoPSsaved restore
%%Page: (612,613) 307
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
611 612 bop 515 523 a Fk(h)p Fj(PrtlA)n(l)t(lo)l(c)l(ator.C*)11
b Fk(i)q Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<prtl/PrtlAllocator.h>)j(//)c(Exported)h(interface.)
598 980 y Fk(h)p Fj(O\013)27 b(p)l(ortal)h(al)t(lo)l(c)l(ator)h(static)
g(memb)l(ers.)f Fk(i)598 1162 y(h)p Fi(off)p 750 1162
24 4 v 29 w(PrtlAllocator::off)p 1481 1162 V 32 w(PrtlAllocator)i
Fj(implementation.)e Fk(i)515 1420 y FA(Kernel-User)j(in)m(terface)i
Fg(C)7 b Fx(++)30 b FA(source)i(\014les)515 1573 y Fz(All)d(message)e
(de\014nitions)i(are)e(k)n(ept)i(in)f Fx(prtl/ex.h)p
Fz(.)36 b(That)29 b(\014le)g(describ)r(es)e(the)i(p)r(ossible)515
1672 y(in)n(teractions)k(b)r(et)n(w)n(een)i(the)g(k)n(ernel)f(and)h
(the)g(user.)58 b(Concrete)34 b(messages)f(are)h(not)g(de-)515
1772 y(scrib)r(ed)26 b(here;)h(they)f(are)g(describ)r(ed)g(through)g
(this)h(do)r(cumen)n(t)g(in)f(those)h(sections)f(where)515
1872 y(their)h(need)h(b)r(ecomes)f(clear.)722 2054 y
FA(NOTE:)g Fz(XXX)i(add)e(a)g(c)n(h)n(unk)g(for)g Fx(ENTRY)f
Fz(de\014nition.)515 2229 y Fk(h)p Fj(ex.h*)11 b Fk(i)p
Fq(\021)598 2320 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 2411 y Fi(#ifndef)41
b(__OFF_EX_H)598 2503 y(#define)g(__OFF_EX_H)g(1)598
2685 y Fk(h)p Fj(O\013)27 b(user-kernel)j(messages)f(dep)l(endencies.)g
Fk(i)598 2777 y(h)p Fj(O\013)e(Virtual)h(tr)l(aps)h(dep)l(endencies.)g
Fk(i)598 2868 y(h)p Fj(O\013)e(Virtual)h(tr)l(aps.)g
Fk(i)598 3051 y Fi(#define)41 b(ENTRY)598 3142 y Fk(h)p
Fj(O\013)27 b(message.)h Fk(i)598 3233 y(h)p Fj(O\013)f(message)i(r)l
(e)l(quest.)g Fk(i)598 3325 y(h)p Fj(O\013)e(message)i(r)l(eply.)f
Fk(i)598 3416 y(h)p Fj(O\013)f(p)l(ortal)h(hand)t(ler.)g
Fk(i)598 3599 y(h)p Fj(O\013)f(user-kernel)j(messages.)f
Fk(i)598 3690 y(h)p Fj(O\013)e(user)i(to)f(kernel)g(messages.)h
Fk(i)598 3781 y(h)p Fj(O\013)e(kernel)h(p)l(ortal)h(hand)t(ler.)f
Fk(i)598 3873 y Fi(#endif)40 b(//)g(__OFF_EX_H)1885 5255
y Fz(611)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
612 613 bop 515 523 a Fk(h)p Fj(O\013)27 b(user)i(to)f(kernel)g
(messages.)h Fk(i)p Fq(\021)598 706 y Fi(#include)41
b(<prtl/mdep/offstd.h>)598 888 y(struct)f(off_KernReq)i(:)e(public)g
(off_MsgReq)i({)676 980 y(off_Rights)g(m_rights;)676
1071 y(off_KernReq\(natural_t)i(nb,)c(off_Rights)i(&r\):)755
1162 y(off_MsgReq\(nb\),)g(m_rights\(r\))g({;})598 1254
y(};)598 1345 y(#define)f(OFF_MSG_R_MASK)395 b(0x00ff)598
1436 y(#define)41 b(OFF_MSG_ROBJ_MASK)278 b(0xff00)598
1528 y(struct)40 b(off_ObjKernReq)j(:)c(public)i(off_KernReq)h({)676
1619 y(off_id_t)f(obj;)676 1710 y(off_ObjKernReq\(off_id_t)k(o,)39
b(natural_t)j(nb,)e(off_Rights)h(&r\):)755 1802 y
(off_KernReq\(nb,r\),obj\(o\))j({;})598 1893 y(};)598
1984 y(struct)c(off_KernRep)i(:)e(public)g(off_MsgRep)i({)676
2076 y(off_KernRep\(err_t)h(res=0\))e(:)e(off_MsgRep\(res\))k({;})598
2167 y(};)639 2491 y Fz(Some)35 b(messages)f(ma)n(y)g(pro)n(vide)g
(metho)r(ds)h(to)g(\014ll)h(their)f(con)n(ten)n(ts,)h(those)f(routines)
515 2590 y(are)26 b(k)n(ept)i(in)g Fx(prtl/ex.C)p Fz(.)515
2723 y Fk(h)p Fj(ex.C*)11 b Fk(i)p Fq(\021)598 2814 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 2997 y Fi(#include)41 b(<prtl/ex.h>)473
b(//)40 b(Exported)h(interface.)598 3088 y Fk(h)p Fj(O\013)27
b(user-kernel)j(messages)f(implementation)f(dep)l(endencies.)h
Fk(i)598 3271 y(h)p Fj(O\013)e(user-kernel)j(messages)f
(implementation.)f Fk(i)515 3620 y FA(Up)s(call)k Fg(C)7
b Fx(++)30 b FA(source)i(\014les)515 3773 y Fz(Up)r(calling)27
b(co)r(de)h(is)f(k)n(ept)h(at)f Fx(prtl/upcall.h)22 b
Fz(and)28 b Fx(prtl/upcall.C)p Fz(.)515 3906 y Fk(h)p
Fj(up)l(c)l(al)t(l.h*)11 b Fk(i)p Fq(\021)598 3997 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 4088 y Fi(#ifndef)41 b(__OFF_UPCALL_H)598
4180 y(#define)g(__OFF_UPCALL_H)h(1)598 4362 y Fk(h)p
Fj(O\013)27 b(up)l(c)l(al)t(l)h(dep)l(endencies.)h Fk(i)598
4636 y Fi(#ifdef)40 b(__KERNEL__)676 4728 y Fk(h)p Fj(O\013)27
b Fi(upcall)p Fj(.)i Fk(i)598 4819 y Fi(#endif)40 b(//)g(__KERNEL__)598
5002 y(#endif)g(//)g(!__OFF_UPCALL_H)1885 5255 y Fz(612)p
eop
PStoPSsaved restore
%%Page: (614,615) 308
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
613 614 bop 515 523 a Fk(h)p Fj(up)l(c)l(al)t(l.C*)11
b Fk(i)o Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<prtl/upcall.h>)121 b(//)40 b(Exported)h(interface.)
598 888 y Fk(h)p Fj(O\013)27 b(up)l(c)l(al)t(l)h(implementation)f(dep)l
(endencies.)j Fk(i)676 1071 y(h)p Fj(O\013)d Fi(upcall)i
Fj(implementation.)f Fk(i)515 1345 y Fn(5.2.13)112 b(P)m(ortals)36
b(for)i(ix86)e(based)j(arc)m(hitectures)515 1498 y FA(The)32
b(p)s(ortal)f(serv)m(er)i(for)f(ix86)f(based)h(arc)m(hitectures)515
1651 y Fz(There)23 b(is)h(no)g(mac)n(hine)f(dep)r(enden)n(t)i(p)r
(ortal)e(serv)n(er)f(co)r(de.)36 b(Ho)n(w)n(ev)n(er,)23
b(a)g(dumm)n(y)h(mac)n(hine)515 1751 y(dep)r(enden)n(t)37
b(p)r(ortal)e(serv)n(er)f(is)i(pro)n(vided)g(so)f(that)h(the)h(no)r(de)
f(serv)n(er)f(could)g(create)h(the)515 1851 y(p)r(ortal)27
b(serv)n(er)e(as)i(it)h(do)r(es)g(with)g(remaining)e(serv)n(ers.)515
1983 y Fk(h)p Fj(O\013)h(machine)h(dep)l(endent)h(p)l(ortal)g(server.)g
Fk(i)p Fq(\021)598 2075 y Fi(//)39 b(A)h(machine)h(dependent)g(portal)g
(server.)598 2166 y(//)598 2257 y(class)f(off_mdepPrtlSrv)j({)598
2349 y(public:)676 2440 y(static)e(natural_t)g(how_many\(void\))h({)e
(return)h(1;})676 2531 y(off_mdepPrtlSrv\(void\))j({)c(;)f(})598
2623 y(};)515 2888 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l
(ortal)g(server)g(dep)l(endencies.)h Fk(i)o Fq(\021)598
2980 y Fi(#include)41 b(<klib/mdep/types.h>)161 b(//)40
b(for)g(boolean_t)h(natural_t)g(et)f(al.)1885 5255 y
Fz(613)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
614 615 bop 515 523 a FA(P)m(ortals)32 b(for)g(ix86)f(based)h(arc)m
(hitectures)515 676 y Fz(Mac)n(hine)27 b(dep)r(enden)n(t)i(p)r(ortals)e
(pro)n(vide)g(the)i(lo)n(w-lev)n(el)e(glue)g(co)r(de)h(and)g(data)g
(needed)g(to)515 776 y(implemen)n(t)g(p)r(ortals.)36
b(W)-7 b(e)28 b(ha)n(v)n(e)e(seen)i(most)f(of)h(the)g(routines)f(pro)n
(vided)f(b)n(y)h Fx(mdepPrtl)p Fz(s.)515 897 y Fk(h)p
Fj(O\013)g(machine)h(dep)l(endent)h(p)l(ortal.)g Fk(i)o
Fq(\021)598 988 y Fi(//)39 b(A)h(machine)h(dependent)g(portal.)598
1079 y(//)598 1171 y(class)f(off_mdepPrtl)i({)598 1262
y(public:)676 1353 y(//)e(Allows)g(unitialized)i(portals.)676
1445 y(off_mdepPrtl\(void\))i({;})676 1536 y(//)c(Creates)h(a)e
(machine)i(dependent)g(portal)676 1627 y(off_mdepPrtl\(vm_offset_t)k
(entry,)40 b(vm_offset_t)i(spp\);)676 1719 y(//)e(Resets)g(the)g
(portal)h(handler)676 1810 y(err_t)g(set_hndlr\(vm_offset_t)j(entry,)c
(vm_offset_t)i(spp\);)676 1993 y(inline)f(register_t)g
(get_entry\(void\))i(const;)676 2175 y(//)d(Gets)g(a)f(copy)i(of)e(a)h
(sz)f(bytes)i(msg)f(m)f(from)h(the)g(given)h(\(current)g(if)e(NULL\))
676 2267 y(//)h(user)g(domain.)676 2358 y(static)h(void)f
(copyin\(off_Msg)i(*km,)e(off_Msg)h(*m,vm_size_t)h(sz,off_DTLB)g
(*from=NULL\);)676 2540 y(//)e(Puts)g(a)f(copy)i(of)e(a)h(sz)f(bytes)i
(msg)f(m)f(to)h(the)g(given)g(\(current)h(if)f(NULL\))676
2632 y(//)g(user)g(domain.)676 2723 y(static)h(void)f(copyout\(off_Msg)
j(*um,)d(off_Msg)h(*km,)1461 2814 y(vm_size_t)g(sz,)f(off_DTLB)h
(*to=NULL\);)676 2997 y(//)f(Allocates)h(a)f(valid)g(stack)g(for)g
(upcalling)i(a)d(handler)i(at)e(the)h(given)676 3088
y(//)g(domain)g(\(in)g(the)g(current)h(one)f(if)g(NULL\).)676
3180 y(//)g(Returns)h(an)e(id)h(which)g(should)h(be)f(given)g(later)g
(on)g(to)g(sp_free.)676 3271 y(natural_t)h(sp_alloc\(off_mdepStck)j
(&sp,)d(off_DTLB)g(*at=NULL\);)676 3454 y(//)f(Deallocates)i(a)d(valid)
h(stack)h(for)f(upcalling)h(a)e(handler)i(at)f(the)g(given)676
3545 y(//)g(domain)g(\(in)g(the)g(current)h(one)f(if)g(NULL\).)676
3636 y(void)g(sp_free\(natural_t)j(spid,)e(off_mdepStck)h(sp,)e
(off_DTLB)h(*at=NULL\);)676 3819 y(//)f(Setup)g(a)g(valid)g(stack)g
(frame)h(for)f(a)f(portal)i(handler.)676 3910 y(//)f(Returns)h(a)e
(pointer)i(to)f(the)g(place)g(where)g(the)g(message)h(should)g(be)e
(copied)i(out.)676 4002 y(static)g(off_Msg)g(*setup_stack\(const)i
(off_shtl_id_t)f(&sender_id,)1775 4093 y(off_Msg)e(*umsg,)h(vm_size_t)g
(msz,)80 b(vm_size_t)41 b(*&rsz,)1775 4184 y(off_mdepStck)h(&sp\);)676
4367 y(//)e(Setup)g(a)g(kernel)g(stack)h(frame)f(for)g(do_deliver.)81
b(Returns)41 b(a)e(pointer)i(to)f(enough)676 4458 y(//)g(space)g(in)g
(the)g(kernel)g(stack)h(to)e(save)i(a)e(property)i(array.)676
4550 y(//)f(The)g(context)h(corresponds)g(to)f(a)f(call)i(for)676
4641 y(//)f(do_deliver\(saved)j(properties)e(pointer,)g(sender)g(id,)f
(msg)g(sz,)g(msg)g(pointer\))676 4732 y(//)g(Setup)g(a)g(kernel)g
(stack)h(frame)f(for)g(do_deliver.)81 b(Returns)41 b(a)e(pointer)i(to)f
(enough)676 4824 y(//)g(space)g(in)g(the)g(kernel)g(stack)h(to)e(save)i
(a)e(property)i(array.)676 4915 y(//)f(The)g(context)h(corresponds)g
(to)f(a)f(call)i(for)676 5006 y(//)f(do_deliver\(saved)j(properties)e
(pointer,)1885 5255 y Fz(614)p eop
PStoPSsaved restore
%%Page: (616,617) 309
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
615 616 bop 676 523 a Fi(//)471 b(saved)41 b(dtlb)f(id,)g(sender)g(id,)
g(msg)g(sz,)g(msg)g(pointer,usp,upc\))676 614 y(void)g
(setup_kctx\(off_mdepStck)45 b(&ksp,)1304 706 y(off_mdepProcRegs)e
(*old_regs,off_mdepProcRegs)i(*new_regs,)1304 797 y(const)40
b(off_shtl_id_t)i(&sender,)1304 888 y(off_ShtlPropAllocator)i(*psaved,)
1304 980 y(off_dtlb_id_t)e(sdtlb,)1304 1071 y(vm_size_t)f(msz,)f
(off_Msg)h(*msg,)1304 1162 y(vm_offset_t)h(usp\);)676
1254 y(//)e(Setup)g(a)g(kernel)g(stack)h(frame)f(for)g(do_deliver.)81
b(Returns)41 b(a)e(pointer)i(to)f(enough)676 1345 y(//)g(space)g(in)g
(the)g(kernel)g(stack)h(to)e(save)i(a)e(property)i(array.)676
1436 y(//)f(The)g(context)h(corresponds)g(to)f(a)f(call)i(for)676
1528 y(//)f(do_rdeliver\(saved)j(properties)e(pointer,)h(sdtb,)e
(sender)g(id,)g(user)h(regs,)f(usp,upc\))676 1619 y(void)g
(setup_kctx\(off_mdepStck)45 b(&ksp,)1304 1710 y(off_mdepProcRegs)e
(*old_regs,off_mdepProcRegs)i(*new_regs,)1304 1802 y(const)40
b(off_shtl_id_t)i(&sender,)1304 1893 y(off_ShtlPropAllocator)i
(*psaved,)1304 1984 y(off_dtlb_id_t)e(sdtlb,)1304 2076
y(off_mdepProcRegs)h(*uregs,)1304 2167 y(vm_offset_t)f(usp\);)676
2441 y(//)e(Entry)g(point)h(serviced)g(by)e(the)h(kernel?)676
2532 y(inline)h(boolean_t)g(is_kernel\(void\))i(const;)676
2715 y(//)d(Call)g(right)g(to)g(the)g(kernel)h(handler.)676
2806 y(inline)g(err_t)f(hardwired_call\(const)k(off_shtl_id_t)e
(&sender,)1775 2897 y(vm_size_t)f(msz,)f(vm_size_t)h(rsz,)1775
2989 y(off_Msg)f(*m,)g(off_Msg)h(*r\);)598 3171 y(protected:)598
3263 y(private:)676 3354 y(vm_offset_t)81 b(p_entry;)355
b(//)40 b(Entry)g(PC)676 3445 y(off_mdepStck)i(*p_spp;)433
b(//)40 b(Stack)g(pool;)598 3537 y(};)515 3802 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal)g(dep)l(endencies.)g
Fk(i)p Fq(\021)598 3894 y Fi(#include)41 b(<shtl/ShtlPropAllocator.h>)
598 3985 y(#include)g(<klib/mdep/types.h>)598 4076 y(#include)g
(<klib/ids.h>)598 4168 y(#include)g(<klib/mdep/mStck.h>)598
4259 y(#include)g(<klib/err.h>)598 4350 y(#include)g(<dmm/DTLB.h>)1885
5255 y Fz(615)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
616 617 bop 639 523 a Fz(Creating)27 b(the)h(p)r(ortal)f(is)g(only)g(a)
h(matter)f(of)h(storing)e(the)i(supplied)g(information.)515
656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(mdepPrtl::off)p
1203 656 V 31 w(mdepPrtl)h Fj(implementation.)e Fk(i)p
Fq(\021)598 747 y Fi(//)39 b(Creates)i(a)f(machine)h(dependent)g
(portal)598 839 y(off_mdepPrtl::off_mdepPrtl\(vm_)q(offse)q(t_t)46
b(entry,)40 b(vm_offset_t)i(spp\):)676 930 y
(p_entry\(entry\),p_spp\(\(off_md)q(epStc)q(k*\)s)q(pp\))598
1021 y({;})639 1254 y Fz(The)28 b(information)f(ma)n(y)g(b)r(e)h(reset)
f(later)g(on.)515 1370 y Fk(h)p Fi(off)p 667 1370 V 29
w(mdepPrtl::set)p 1203 1370 V 31 w(hndlr)h Fj(implementation.)g
Fk(i)p Fq(\021)598 1461 y Fi(//)39 b(Resets)i(the)f(portal)h(handler)
598 1553 y(err_t)f(off_mdepPrtl::set_hndlr\(vm_of)q(fset)q(_t)45
b(entry,)c(vm_offset_t)h(spp\))598 1644 y({)676 1735
y(p_entry=entry;)676 1826 y(p_spp=\(off_mdepStck*\)spp;)676
1918 y(return)f(EOK;)598 2009 y(})515 2258 y Fk(h)p Fi(off)p
667 2258 V 29 w(mdepPrtl::get)p 1203 2258 V 31 w(entry)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 2350 y Fi(inline)40
b(register_t)i(off_mdepPrtl::get_entry\(void\))k(const)40
b({)676 2441 y(return)h(p_entry;)598 2532 y(})515 2798
y Fk(h)p Fi(off)p 667 2798 V 29 w(mdepPrtl::is)p 1164
2798 V 30 w(kernel)29 b Fj(implementation.)f Fk(i)p Fq(\021)598
2889 y Fi(//)39 b(Entry)i(point)f(serviced)h(by)f(the)g(kernel?)598
2980 y(inline)g(boolean_t)i(off_mdepPrtl::is_kernel\(void\))j(const)c
({)676 3072 y(extern)g(char)f(etext[];)676 3163 y(return)h(p_entry)g(<)
e(\(register_t\)etext;)598 3254 y(})515 3520 y Fk(h)p
Fi(off)p 667 3520 V 29 w(mdepPrtl::hardwired)p 1437 3520
V 32 w(call)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3611 y Fi(typedef)41 b(err_t)f(\(*off_mdep_hwcall_t\)\(const)45
b(off_shtl_id_t)d(&,)1971 3703 y(vm_size_t,)f(vm_size_t,)1971
3794 y(off_Msg*,off_Msg*\);)598 3885 y(//)e(Call)i(right)f(to)g(the)g
(kernel)g(handler.)598 3977 y(inline)g(err_t)h
(off_mdepPrtl::hardwired_call\(c)q(onst)46 b(off_shtl_id_t)c(&sender,)
2245 4068 y(vm_size_t)g(msz,)e(vm_size_t)h(rsz,)2245
4159 y(off_Msg)g(*m,)f(off_Msg)h(*r\))598 4251 y({)676
4342 y(off_mdep_hwcall_t)i(f=\(off_mdep_hwcall_t\)p_entry)q(;)676
4433 y(return)e(\(*f\)\(sender,msz,rsz,m,r\);)598 4525
y(})1885 5255 y Fz(616)p eop
PStoPSsaved restore
%%Page: (618,619) 310
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
617 618 bop 515 523 a FA(Cho)s(osing)30 b(and)i(setting)f(up)h(the)f
(handler)h(stac)m(k)515 676 y Fz(The)23 b(stac)n(k)f(p)r(o)r(ol)i(p)r
(oin)n(ter)e(\()p Fx(p)p 1432 676 27 4 v 32 w(spp)p Fz(\))g(p)r(ortal)h
(mem)n(b)r(er)g(p)r(oin)n(ts)g(to)g(an)g(arra)n(y)e(of)j(initial)f
(stac)n(k)515 776 y(p)r(oin)n(ters)g(pro)n(vided)h(b)n(y)g(the)h
(handler.)35 b(Eac)n(h)23 b(incoming)h(in)n(v)n(o)r(cation)f(will)i
(use,)f(as)g(its)h(o)n(wn)515 876 y(user)36 b(stac)n(k,)i(one)e(of)h
(the)g(stac)n(ks)e(found)i(there.)64 b(The)36 b(p)r(o)r(ol)h(of)g(stac)
n(ks)e(can)h(b)r(e)h(of)g(an)n(y)515 975 y(length,)25
b(but)g(it)g(is)g(assumed)f(that)h(the)g(last)f(stac)n(k)g(p)r(oin)n
(ter)g(will)h(b)r(e)g(in)n(v)-5 b(alid)24 b(and)g(its)h(v)-5
b(alue)515 1075 y(will)26 b(b)r(e)g Fx(OFF)p 918 1075
V 31 w(PRTL)p 1125 1075 V 29 w(SLAST)p Fz(.)e(An)n(y)j(stac)n(k)e(p)r
(oin)n(ter)g(with)i(a)f(n)n(ull)g(v)-5 b(alue)26 b(in)g(the)g(p)r(o)r
(ol)g(will)h(b)r(e)515 1174 y(ignored.)515 1293 y Fk(h)p
Fj(O\013)g(machine)h(dep)l(endent)h(p)l(ortal)g(symb)l(ols.)f
Fk(i)p Fq(\021)598 1385 y Fi(const)40 b(vm_offset_t)i
(OFF_PRTL_SLAST=0x1;)h(//)d(End)g(of)g(stack)g(pointer)h(pool.)598
1476 y(const)f(vm_offset_t)i(OFF_PRTL_SNULL=0x0;)h(//)d(Invalid)h
(entry.)639 1603 y Fz(Up)r(on)23 b(p)r(ortal)f(in)n(v)n(o)r(cation,)g
(the)h(k)n(ernel)f(selects)g(one)g(of)g(the)h(non-zero)e(p)r(oin)n
(ters)h(found)515 1703 y(in)31 b(the)h(p)r(o)r(ol)f(and)g(then)g
(resets)g(it)g(to)g Fx(0)p Fz(.)48 b(Since)31 b(a)g(stac)n(k)f(p)r(oin)
n(ter)h(with)g(v)-5 b(alue)31 b Fx(0)g Fz(will)h(b)r(e)515
1802 y(ignored,)22 b(this)h(is)f(a)g(safe)g(mec)n(hanism)g(to)g(a)n(v)n
(oid)f(race)g(conditions)h(during)g(stac)n(k)f(selection.)515
1902 y(T)-7 b(o)28 b(allo)n(w)f(the)i(stac)n(k)e(to)h(b)r(e)h(reused,)f
(the)g(user-lev)n(el)f(handler)h(m)n(ust)g(\(atomically\))g(write)515
2001 y(the)g(original)e(stac)n(k)g(p)r(oin)n(ter)i(v)-5
b(alue)27 b(bac)n(k)g(to)g(the)h(stac)n(k)f(p)r(o)r(ol.)515
2120 y Fk(h)p Fi(off)p 667 2120 24 4 v 29 w(mdepPrtl::sp)p
1164 2120 V 30 w(alloc)i Fj(implementation.)f Fk(i)o
Fq(\021)598 2212 y Fi(//)39 b(Allocates)j(a)d(valid)i(stack)f(for)g
(upcalling)h(a)f(handler)g(at)g(the)g(given)598 2303
y(//)f(domain)i(\(in)f(the)g(current)h(one)f(if)f(NULL\).)598
2394 y(//)g(Returns)i(an)f(id)g(which)g(should)h(be)e(given)i(later)f
(on)g(to)f(sp_free.)598 2486 y(natural_t)i
(off_mdepPrtl::sp_alloc\(off_md)q(epSt)q(ck)k(&sp,)40
b(off_DTLB)h(*at\))598 2577 y({)676 2668 y(off_mdepStck)h(*pool=p_spp;)
676 2760 y(if)e(\(at\){)755 2851 y(otsan\(\);)676 2942
y(})676 3033 y(do)g({)755 3125 y(if)f(\(\(natural_t\)*pool>OFF_PRTL_S)q
(LAST)q(\){)833 3216 y(sp=*pool;)833 3307 y
(*\(natural_t*\)pool=OFF_PRTL_SN)q(ULL;)833 3399 y(return)i
(pool-p_spp+1;)755 3490 y(})676 3673 y(})f(while)g(\(*pool++)h(!=)f
(OFF_PRTL_SLAST\);)676 3764 y(return)h(\(natural_t\)OFF_PRTL_SNULL;)598
3855 y(})515 4002 y Fk(h)p Fi(off)p 667 4002 V 29 w(mdepPrtl::sp)p
1164 4002 V 30 w(free)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 4093 y Fi(//)39 b(Deallocates)j(a)e(valid)g(stack)g(for)g
(upcalling)i(a)d(handler)i(at)e(the)h(given)598 4184
y(//)f(domain)i(\(in)f(the)g(current)h(one)f(if)f(NULL\).)598
4276 y(void)h(off_mdepPrtl::sp_free\(natural_)q(t)45
b(spid,)c(off_mdepStck)g(sp,)f(off_DTLB)h(*at\))598 4367
y({)676 4458 y(off_mdepStck)h(*pool=p_spp;)676 4550 y(assert\(spid\);)
676 4641 y(if)e(\(at\){)755 4732 y(otsan\(\);)676 4824
y(})676 4915 y(pool[spid-1]=sp;)598 5006 y(})1885 5255
y Fz(617)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
618 619 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepPrtl::setup)p 1281 523 V 31 w(stack)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Setup)i(a)e(valid)i(stack)f(frame)g
(for)g(a)g(portal)g(handler.)598 706 y(//)f(Returns)i(a)f(pointer)h(to)
e(the)h(place)g(where)h(the)f(message)h(should)f(be)g(copied)g(out.)598
797 y(off_Msg)h(*off_mdepPrtl::setup_stack\(cons)q(t)k(off_shtl_id_t)d
(&sender_id,)1971 888 y(off_Msg)f(*msg,)f(vm_size_t)h(msz,)f
(vm_size_t*&rsz,)1971 980 y(off_mdepStck)i(&sp\))598
1071 y({)676 1162 y(off_Msg)f(*umsg=NULL;)676 1254 y(off_Msg)g
(*urep=NULL;)676 1345 y(vm_size_t)g(*ursz=NULL;)676 1436
y(\(void\)msg;)676 1528 y(if)f(\(*rsz\))755 1619 y
(urep=\(off_Msg*\)sp.alloca\(\(\(*rsz)q(\)+0x)q(3\)&~)q(0x3\);)46
b(//)40 b(round)g(to)g(machine)g(words)676 1710 y(if)g(\(msz\))755
1802 y(umsg=\(off_Msg*\)sp.alloca\(\(\(msz\))q(+0x3)q(\)&~0)q(x3\);)46
b(//)39 b(round)i(to)e(machine)i(words)676 1893 y
(ursz=\(vm_size_t*\)sp.alloca\(s)q(izeof)q(\(vm_)q(size)q(_t\)\);)676
1984 y(*ursz=*rsz;)676 2076 y(*\(off_Msg**\)sp.alloca\(sizeof)q(\(off_)
q(Msg*)q(\)\)=u)q(rep;)676 2167 y(//sp.push\(\(vm_offset_t\)urep\))q(;)
676 2258 y(*\(off_Msg**\)sp.alloca\(sizeof)q(\(off_)q(Msg*)q(\)\)=u)q
(msg;)676 2350 y(//sp.push\(\(vm_offset_t\)umsg\))q(;)676
2441 y(*\(vm_offset_t**\)sp.alloca\(si)q(zeof\()q(vm_o)q(ffse)q(t_t*\))
q(\)=ur)q(sz;)676 2532 y(//sp.push\(\(vm_offset_t\)ursz\))q(;)676
2623 y(*\(vm_offset_t*\)sp.alloca\(siz)q(eof\(v)q(m_of)q(fset)q
(_t\)\)=)q(msz;)676 2715 y(//sp.push\(msz\);)676 2806
y(*\(off_id_t*\)sp.alloca\(sizeof)q(\(off_)q(id_t)q(\)\)=s)q(ender)q
(_id;)676 2897 y(//sp.push\(sender_id\);)676 2989 y(rsz=ursz;)983
b(//)40 b(return)g(eip)g(pushed)h(by)e(upcall.)676 3080
y(return)i(umsg;)598 3263 y(})1885 5255 y Fz(618)p eop
PStoPSsaved restore
%%Page: (620,621) 311
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
619 620 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepStck::setup)p 1281 523 V 31 w(kctx)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Setup)i(a)e(kernel)i(stack)f(frame)
h(for)e(do_deliver.)81 b(Returns)41 b(a)f(pointer)h(to)e(enough)598
706 y(//)g(space)i(in)e(the)h(kernel)h(stack)f(to)g(save)g(a)g
(property)h(array.)598 797 y(//)e(The)h(context)h(corresponds)h(to)e(a)
f(call)h(for)598 888 y(//)f(do_deliver\(saved)k(properties)f(pointer,)
598 980 y(//)471 b(saved)40 b(dtlb)g(id,)g(sender)h(id,)f(msg)g(sz,)g
(msg)g(pointer,usp,upc\))676 1071 y(extern)h("C")f({)755
1162 y(extern)g(volatile)h(void)f(off_prtl_do_deliver\(off_Sht)q(lProp)
q(Allo)q(cato)q(r)45 b(*props,)2363 1254 y(off_dtlb_id_t)d(sdtlb,)2363
1345 y(off_shtl_id_t)g(sender,)2363 1436 y(vm_size_t)f(msz,)f(off_Msg)h
(*msg,)2363 1528 y(vm_offset_t)h(sp,)e(vm_offset_t)h(upc\);)676
1710 y(};)598 1893 y(void)598 1984 y(off_mdepPrtl::setup_kctx\(off_m)q
(depSt)q(ck)k(&ksp,)1578 2076 y(off_mdepProcRegs)e
(*old_regs,off_mdepProcRegs)i(*new_regs,)1578 2167 y(const)c
(off_shtl_id_t)h(&sender,)1578 2258 y(off_ShtlPropAllocator)i(*psaved,)
1108 2350 y(off_dtlb_id_t)356 b(sdtlb,)1578 2441 y(vm_size_t)42
b(msz,)e(off_Msg)h(*msg,)1578 2532 y(vm_offset_t)h(usp\))598
2623 y({)676 2806 y(*\(vm_offset_t*\)ksp.alloca\(si)q(zeof\()q(vm_o)q
(ffse)q(t_t\)\))q(=p_e)q(ntry;)676 2897 y(//ksp.push\(p_entry\);)676
2989 y(*\(vm_offset_t*\)ksp.alloca\(si)q(zeof\()q(vm_o)q(ffse)q
(t_t\)\))q(=usp)q(;)676 3080 y(//ksp.push\(usp\);)676
3171 y(*\(off_Msg**\)ksp.alloca\(sizeo)q(f\(off)q(_Msg)q(**\)\))q
(=msg;)676 3263 y(//ksp.push\(\(vm_offset_t\)msg\))q(;)676
3354 y(*\(vm_size_t*\)ksp.alloca\(size)q(of\(vm)q(_siz)q(e_t\))q
(\)=msz)q(;)676 3445 y(//ksp.push\(\(vm_size_t\)msz\);)676
3537 y(*\(off_id_t*\)ksp.alloca\(sizeo)q(f\(off)q(_id_)q(t\)\)=)q
(sende)q(r;)676 3628 y(//ksp.push\(sender\);)676 3719
y(*\(off_id_t*\)ksp.alloca\(sizeo)q(f\(off)q(_id_)q(t\)\)=)q(sdtlb)q(;)
676 3811 y(//ksp.push\(sdtlb\);)676 3902 y
(*\(off_ShtlPropAllocator**\)ks)q(p.all)q(oca\()q(size)q(of\(of)q(f_Sh)
q(tlPro)q(pAll)q(ocat)q(or*\)\))q(=psa)q(ved;)676 3993
y(//ksp.push\(\(vm_offset_t\)psav)q(ed\);)676 4085 y
(*\(vm_offset_t*\)ksp.alloca\(si)q(zeof\()q(vm_o)q(ffse)q(t_t\)\))q
(=0;)676 4176 y(//ksp.push\(0\);)709 b(//)40 b(fake)g(return)h(eip)f
(for)g(do_deliver)676 4267 y(new_regs->set_flags\(0\);)676
4359 y(new_regs->set_pc\(\(register_t)q(\)off_)q(prtl)q(_do_)q(deliv)q
(er\);)676 4450 y(new_regs->set_sp\(ksp\);)598 4633 y(})1885
5255 y Fz(619)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
620 621 bop 639 523 a Fz(This)28 b(is)f(the)h(register-passing)d(v)n
(ersion.)515 656 y Fk(h)p Fi(off)p 667 656 24 4 v 29
w(mdepStck::setup)p 1281 656 V 31 w(kctx)k Fj(implementation.)e
Fk(i)p Fz(+)o Fq(\021)676 747 y Fi(extern)41 b("C")f({)755
839 y(extern)g(volatile)h(void)f(off_prtl_do_rdeliver\(off_Sh)q(tlPro)q
(pAll)q(ocat)q(or)45 b(*props,)2363 930 y(off_dtlb_id_t)d(sdtlb,)2402
1021 y(off_shtl_id_t)g(sender,)2402 1112 y(off_mdepProcRegs)h
(*uregs\);)676 1204 y(};)598 1295 y(//)c(Setup)i(a)e(kernel)i(stack)f
(frame)h(for)e(do_deliver.)81 b(Returns)41 b(a)f(pointer)h(to)e(enough)
598 1386 y(//)g(space)i(in)e(the)h(kernel)h(stack)f(to)g(save)g(a)g
(property)h(array.)598 1478 y(//)e(The)h(context)h(corresponds)h(to)e
(a)f(call)h(for)598 1569 y(//)f(do_rdeliver\(saved)44
b(properties)d(pointer,)g(sdtb,)f(sender)h(id,)f(user)g(regs,)g
(usp,upc\))598 1660 y(void)598 1752 y(off_mdepPrtl::setup_kctx\(off_m)q
(depSt)q(ck)45 b(&ksp,)1578 1843 y(off_mdepProcRegs)e
(*old_regs,off_mdepProcRegs)i(*new_regs,)1578 1934 y(const)c
(off_shtl_id_t)h(&sender,)1578 2026 y(off_ShtlPropAllocator)i(*psaved,)
1578 2117 y(off_dtlb_id_t)f(sdtlb,)1578 2208 y(off_mdepProcRegs)g
(*uregs,)1578 2300 y(vm_offset_t)f(usp\))598 2391 y({)676
2574 y(ksp.push\(p_entry\);)676 2665 y(ksp.push\(usp\);)676
2756 y(ksp.push\(\(vm_offset_t\)uregs\))q(;)676 2848
y(ksp.push\(sender\);)676 2939 y(ksp.push\(sdtlb\);)676
3030 y(ksp.push\(\(vm_offset_t\)psaved)q(\);)676 3122
y(ksp.push\(0\);)709 b(//)40 b(fake)g(return)g(eip)g(for)g(do_deliver)
676 3213 y(new_regs->set_flags\(old_regs)q(->get)q(_fla)q(gs\(\))q
(&~EFL)q(_IF\))q(;)676 3304 y(new_regs->set_pc\(\(register_t)q(\)off_)q
(prtl)q(_do_)q(rdeli)q(ver\))q(;)676 3396 y(new_regs->set_sp\(ksp\);)
598 3487 y(})515 3744 y FA(Message)30 b(transfers)515
3889 y Fk(h)p Fi(off)p 667 3889 V 29 w(mdepPrtl::copyin)h
Fj(implementation.)c Fk(i)p Fq(\021)598 3981 y Fi(//)39
b(Gets)i(a)e(copy)h(of)g(a)f(sz)h(bytes)g(msg)g(m)g(from)g(the)g(given)
g(\(current)h(if)f(NULL\))598 4072 y(//)f(user)i(domain.)598
4163 y(//)e(Delete)i(should)g(be)e(called)i(when)f(the)g(returned)h
(message)g(is)e(not)h(needed)h(anymore.)598 4254 y(void)f
(off_mdepPrtl::copyin\(off_Msg)45 b(*km,off_Msg)d(*m,)e(vm_size_t)h
(sz,)f(off_DTLB)h(*from\))598 4346 y({)676 4437 y(if)f(\(!sz\))755
4528 y(return;)676 4620 y(if)g(\(from\))755 4711 y(otsan\(\);)676
4802 y(memcpy\(\(void*\)km,\(void*\)m,sz)q(\);)598 4894
y(})1885 5255 y Fz(620)p eop
PStoPSsaved restore
%%Page: (622,623) 312
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
621 622 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepPrtl::copyout)31 b Fj(implementation.)c Fk(i)p
Fq(\021)598 614 y Fi(//)39 b(Puts)i(a)e(copy)h(of)g(a)f(sz)h(bytes)g
(msg)g(m)g(to)f(the)h(given)h(\(current)g(if)e(NULL\))598
706 y(//)g(user)i(domain.)598 797 y(void)f
(off_mdepPrtl::copyout\(off_Msg)46 b(*um,)40 b(off_Msg)h(*m,)1657
888 y(vm_size_t)g(sz,)f(off_DTLB)h(*to\))598 980 y({)676
1071 y(if)f(\(!sz\))755 1162 y(return;)676 1254 y(if)g(\(to\))755
1345 y(otsan\(\);)676 1436 y(memcpy\(\(void*\)um,\(void*\)m,sz)q(\);)
598 1528 y(})515 1876 y FA(Up)s(calls)515 2029 y Fz(Mac)n(hine)e(dep)r
(enden)n(t)h(up)r(call)g(co)r(de)f(is)h(the)g(one)f(deliv)n(ering)f(up)
r(call)i(messages.)68 b(Suc)n(h)515 2129 y(en)n(try)36
b(p)r(oin)n(ts)h(are)f(segregated)f(from)h(the)i(mac)n(hine)e(dep)r
(enden)n(t)i(p)r(ortal)e(serv)n(er)f(so)h(w)n(e)515 2229
y(could)27 b(pla)n(y)g(dirt)n(y)g(assem)n(bly)g(tric)n(ks)f(to)i(call)f
(them.)515 2362 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(up)l(c)l
(al)t(l)f(r)l(outines.)h Fk(i)o Fq(\021)598 2453 y Fi(//)39
b(Non-register)j(passing)f(verions.)598 2544 y(extern)f(void)g
(off_mdep_cross_domain_call\()q(regi)q(ster_)q(t)45 b(pc,)40
b(off_mdepStck)i(sp\);)598 2636 y(extern)e(void)g
(off_mdep_setup_cross_domain)q(_ret)q(\(off_)q(mdep)q(Stck)46
b(tramp,off_mdepStck&s\);)598 2727 y(extern)40 b(void)g
(off_mdep_cross_domain_ret\(o)q(ff_m)q(depPr)q(ocRe)q(gs)45
b(*ustate\);)598 2818 y(extern)40 b(void)g(off_mdep_single_domain_call)
q(\(reg)q(ister)q(_t)45 b(pc,)40 b(register_t)i(sp\);)598
2910 y(extern)e(void)g(off_mdep_single_domain_ret\()q(void)q(\);)598
3001 y Fk(h)p Fj(O\013)27 b Fi(mdep)p 922 3001 V 29 w(setup)p
1146 3001 V 29 w(single)p 1409 3001 V 30 w(domain)p 1673
3001 V 30 w(ret)h Fj(implementation.)f Fk(i)598 3183
y Fi(//)39 b(Register)i(passing)g(versions.)598 3275
y(extern)f(void)g(off_mdep_single_domain_rcal)q(l\(re)q(giste)q(r_t)46
b(pc,)39 b(register_t)j(sp,)2206 3366 y(off_mdepProcRegs)h(*regs\);)598
3549 y(extern)d(void)g(off_mdep_cross_domain_rcall)q(\(reg)q(ister)q
(_t)45 b(pc,)40 b(off_mdepStck)i(sp,)2167 3640 y(off_mdepUProcRegs)h
(*regs\);)598 3731 y(extern)d(void)g(off_mdep_setup_cross_domain)q
(_rre)q(t\(off)q(_mde)q(pStck)46 b(tramp,)2363 3823 y(off_mdepStck)c
(&s\);)598 3914 y(extern)e(void)g(off_mdep_cross_domain_rret\()q(off_)q
(mdepP)q(rocR)q(egs)45 b(*ustate\);)515 4271 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l(c)l(al)t(l)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4362 y Fi(#include)41
b(<sys/types.h>)598 4454 y(#include)g(<hw/mdep/mProcessor.h>)1885
5255 y Fz(621)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
622 623 bop 639 523 a Fz(Within)25 b(a)e(single)g(domain,)i(an)e(up)r
(call)h(can)f(b)r(e)h(handled)g(b)n(y)f(resetting)g(the)i(stac)n(k)d
(and)515 623 y(jumping)30 b(to)g(the)g(en)n(try)f(p)r(oin)n(t.)43
b(On)30 b(return,)g(w)n(e)f(jump)i(to)e(a)h(k)n(ernel)e(register)h
(reloading)515 722 y(routine.)515 855 y Fk(h)p Fj(O\013)e
Fi(mdep)p 839 855 24 4 v 29 w(single)p 1102 855 V 30
w(domain)p 1366 855 V 29 w(call)i Fj(implementation.)e
Fk(i)p Fq(\021)598 946 y Fi(extern)40 b(void)g
(off_mdep_single_domain_call)q(\(reg)q(ister)q(_t)45
b(pc,)40 b(register_t)i(sp\))598 1038 y({)676 1129 y(jmp_buf)f(b;)676
1220 y(b[3]=b[4]=sp;)676 1312 y(b[5]=pc;)676 1403 y(longjmp\(b,0\);)598
1494 y(})515 1669 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l
(c)l(al)t(l)f(implementation)g(dep)l(endencies.)h Fk(i)p
Fq(\021)598 1760 y Fi(#include)41 b(<setjmp.h>)639 1901
y Fz(The)28 b(register)e(passing)h(v)n(ersion)f(simply)h(initializes)h
(the)g(jump)g(bu\013er)g(registers.)515 2017 y Fk(h)p
Fj(O\013)f Fi(mdep)p 839 2017 V 29 w(single)p 1102 2017
V 30 w(domain)p 1366 2017 V 29 w(rcall)i Fj(implementation.)e
Fk(i)p Fq(\021)598 2109 y Fi(extern)40 b(void)g
(off_mdep_single_domain_rcal)q(l\(re)q(giste)q(r_t)46
b(pc,)39 b(register_t)j(sp,)1422 2200 y(off_mdepUProcRegs)h(*regs\))598
2291 y({)676 2383 y(jmp_buf)e(b;)676 2474 y(assert\(regs\);)676
2565 y(b[0]=regs->ebx;)676 2657 y(b[1]=regs->esi;)676
2748 y(b[2]=regs->edi;)676 2839 y(b[3]=regs->ebp;)676
2931 y(b[4]=sp;)676 3022 y(b[5]=pc;)676 3113 y(longjmp\(b,0\);)598
3205 y(})639 3329 y Fz(When)23 b(the)f(handler)f(returns,)i(the)f
(return)g Fx(eip)f Fz(jumps)h(to)g(a)f(tramp)r(oline)h(whic)n(h)g(m)n
(ust)515 3429 y(b)r(e)28 b(setup)g(to)f(return)g(from)g(the)h(up)r
(call.)37 b(It)28 b(can)g(consume)f(up)h(to)f Fx(UCTRAMP)p
2937 3429 27 4 v 29 w(SIZE)f Fz(b)n(ytes.)515 3562 y
Fk(h)p Fj(O\013)h(up)l(c)l(al)t(l)g(r)l(eturn)j(tr)l(amp)l(onile)e
(size.)g Fk(i)o Fq(\021)598 3653 y Fi(const)40 b(natural_t)h
(OFF_UCTRAMP_SIZE=2*sizeof\(i)q(nt\);)46 b(//)39 b(in)h(bytes.)h(\(two)
f(words\))639 3794 y Fz(If)32 b(there)f(is)g(no)g(domain)g(crossing,)g
(the)h(return)e(address)h(can)g(b)r(e)g(set)h(to)f(the)h(return)515
3894 y(from)27 b(up)r(call)h(routine)f(directly)-7 b(.)515
4027 y Fk(h)p Fj(O\013)27 b Fi(mdep)p 839 4027 24 4 v
29 w(setup)p 1063 4027 V 29 w(single)p 1326 4027 V 30
w(domain)p 1590 4027 V 30 w(ret)h Fj(implementation.)f
Fk(i)p Fq(\021)598 4118 y Fi(extern)40 b(inline)h(void)f
(off_mdep_setup_single_domain_)q(ret\()q(regis)q(ter_)q(t)45
b(tramp,)2638 4209 y(off_mdepStck)d(&usp\))598 4301 y({)676
4392 y(\(void\)tramp;)676 4483 y(//)e(XXX)g(when)g(push)g(gets)g
(fixed,)h(this)f(may)g(breat)g(->)g(check)g(it)g(againt)676
4575 y(usp.push\(\(register_t\)off_mde)q(p_sin)q(gle_)q(doma)q(in_re)q
(t\);)598 4666 y(})1885 5255 y Fz(622)p eop
PStoPSsaved restore
%%Page: (624,625) 313
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
623 624 bop 515 523 a Fk(h)p Fj(O\013)27 b Fi(mdep)p
839 523 24 4 v 29 w(single)p 1102 523 V 30 w(domain)p
1366 523 V 29 w(ret)h Fj(implementation.)g Fk(i)p Fq(\021)598
614 y Fi(extern)40 b(void)g(off_mdep_single_domain_ret\()q(void)q(\))
598 706 y({)676 797 y(off_Shtl::self\(\)->pop_curren)q(t_ctx)q(\(get)q
(_eax)q(\(\)\);)598 888 y(})515 1046 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(up)l(c)l(al)t(l)f(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 1137 y Fi(#include)41 b(<shtl/Shtl.h>)639
1270 y Fz(When)28 b(crossing)d(a)i(domain,)g(a)g(return)f(from)h(in)n
(terrupt)g(is)g(used)g(to)g(issue)g(a)f(call)h(and)515
1370 y(a)g(system)h(call)g(to)g(issue)f(a)h(return.)37
b(W)-7 b(e)29 b(m)n(ust)f(reset)f(the)i(k)n(ernel)e(stac)n(k)g(p)r(oin)
n(ter)g(for)h(ring)515 1469 y(zero)35 b(to)i(b)r(e)g(the)h(curren)n(t)e
(one.)64 b(That)37 b(w)n(a)n(y)e(in)n(terrupts)i(will)g(not)f(clobb)r
(er)h(the)g(k)n(ernel)515 1569 y(stac)n(k.)515 1694 y
Fk(h)p Fj(O\013)27 b Fi(mdep)p 839 1694 V 29 w(cross)p
1063 1694 V 29 w(domain)p 1326 1694 V 30 w(call)h Fj(implementation.)g
Fk(i)p Fq(\021)598 1785 y Fi(extern)40 b(void)g
(off_mdep_cross_domain_call\()q(regi)q(ster_)q(t)45 b(pc,)40
b(off_mdepStck)i(sp\))598 1876 y({)676 1968 y(register_t)g
(flags=0|EFL_IF|)755 2059 y(\(off_Shtl::self\(\)->is_usrio\(\)?E)q
(FL_I)q(OPL_)q(USER:)q(0\);)676 2150 y(off_mdep_iret_to\(pc,USER_CS,)q
(flags)q(,sp,)q(USER)q(_DS\);)676 2242 y(otsan\(\);)598
2333 y(})515 2491 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l
(c)l(al)t(l)f(implementation)g(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 2582 y Fi(#include)41 b(<flux/machine/base_gdt.h>)
598 2673 y(#include)g(<flux/machine/base_tss.h>)598 2765
y(#include)g(<prtl/mdep/miret.h>)639 2897 y Fz(The)28
b(register)e(passing)h(v)n(ersion)f(will)h(setup)h(user)f(registers)f
(b)r(efore)h(up)r(calling.)515 3010 y Fk(h)p Fj(O\013)g
Fi(mdep)p 839 3010 V 29 w(cross)p 1063 3010 V 29 w(domain)p
1326 3010 V 30 w(rcall)i Fj(implementation.)e Fk(i)p
Fq(\021)598 3101 y Fi(extern)40 b(void)g(off_mdep_cross_domain_rcall)q
(\(reg)q(ister)q(_t)45 b(pc,)40 b(off_mdepStck)i(sp,)2167
3192 y(off_mdepUProcRegs)h(*regs\))598 3284 y({)676 3375
y(register_t)f(flags=get_eflags\(\)|EFL_IF|)755 3466
y(\(off_Shtl::self\(\)->is_usrio\(\)?E)q(FL_I)q(OPL_)q(USER:)q(0\);)676
3557 y(//do_debug\(printf\("upcalling)q(\\n"\)\))q(;)676
3649 y(off_mdep_riret_to\(\(register_)q(t*\)re)q(gs,p)q(c,US)q(ER_CS)q
(,fla)q(gs,sp)q(,USE)q(R_DS)q(\);)676 3740 y(otsan\(\);)598
3831 y(})639 4043 y Fz(T)-7 b(o)26 b(setup)h(a)f(return)f(from)h
(handler,)g(w)n(e)g(set)h(the)f(return)g(program)e(coun)n(ter)i(to)g(p)
r(oin)n(t)515 4143 y(to)g(a)g(stac)n(k)g(tramp)r(oline.)36
b(In)27 b(suc)n(h)f(a)g(place)g(w)n(e)g(simply)h(store)e(an)i
(instruction)f(to)g(issue)g(a)515 4242 y(system)h(call.)515
4367 y Fk(h)p Fj(O\013)g Fi(mdep)p 839 4367 V 29 w(setup)p
1063 4367 V 29 w(cross)p 1287 4367 V 30 w(domain)p 1551
4367 V 29 w(ret)i Fj(implementation.)e Fk(i)p Fq(\021)598
4458 y Fi(extern)40 b(void)g(off_mdep_setup_cross_domain)q(_ret)q
(\(off_)q(mdep)q(Stck)46 b(tramp,)2324 4550 y(off_mdepStck)c(&usp\))598
4641 y({)676 4732 y(\(void\)tramp;)676 4824 y
(*\(register_t*\)usp.alloca\(siz)q(eof\(r)q(egis)q(ter_)q(t\)\)=O)q
(FF_M)q(DEP_U)q(PCAL)q(L_DO)q(WN;)676 4915 y
(//usp.push\(OFF_MDEP_UPCALL_D)q(OWN\);)598 5006 y(})1885
5255 y Fz(623)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
624 625 bop 515 523 a Fk(h)p Fj(O\013)27 b Fi(mdep)p
839 523 24 4 v 29 w(setup)p 1063 523 V 29 w(cross)p 1287
523 V 30 w(domain)p 1551 523 V 29 w(rret)i Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(extern)40 b(void)g
(off_mdep_setup_cross_domain)q(_rre)q(t\(off)q(_mde)q(pStck)46
b(tramp,)2324 706 y(off_mdepStck)c(&usp\))598 797 y({)676
888 y(\(void\)tramp;)676 980 y(*\(register_t*\)usp.alloca\(siz)q
(eof\(r)q(egis)q(ter_)q(t\)\)=O)q(FF_M)q(DEP_U)q(PCAL)q(L_RD)q(OWN;)676
1071 y(//usp.push\(OFF_MDEP_UPCALL_R)q(DOWN\))q(;)598
1162 y(})639 1303 y Fz(Suc)n(h)28 b(system)f(calls)g(are)g(hardwired)f
(to)i(call)f(p)r(ortal)g(serv)n(er)f(routines.)639 1403
y(When)19 b(the)g(return)f(routine)h(is)f(called,)i(the)f(outermost)f
(sh)n(uttle)g(con)n(text)h(holds)f(sh)n(uttle)515 1503
y(state)27 b(righ)n(t)g(b)r(efore)g(the)h(up)r(call.)37
b(Th)n(us)28 b(w)n(e)f(simply)h(ha)n(v)n(e)e(to)h(reload)g(it.)515
1636 y Fk(h)p Fj(O\013)g Fi(mdep)p 839 1636 V 29 w(cross)p
1063 1636 V 29 w(domain)p 1326 1636 V 30 w(ret)h Fj(implementation.)g
Fk(i)p Fq(\021)598 1727 y Fi(void)40 b(off_mdep_cross_domain_ret\(off_)
q(mdep)q(Proc)q(Regs)46 b(*uregs\))598 1818 y({)676 1910
y(err_t)41 b(code=uregs->p_ts.eax;)676 2001 y(off_ShtlCtxItr)i
(i=off_Shtl::self\(\)->get_ctx\(\);)676 2092 y(if)d(\(!code\))755
2183 y(code=EUOK;)676 2275 y(//do_debug\(printf\("return)45
b(from)40 b(upcall)h(with)f(code)g(\045x\\n",code\)\);)676
2366 y(off_mdep_load_kregs\(i.get_el)q(ement)q(\(\)->)q(c_re)q(gs,co)q
(de\);)676 2457 y(otsan\(\);)598 2549 y(})639 2690 y
Fz(This)28 b(is)f(the)h(register)e(passing)h(v)n(ersion.)515
2806 y Fk(h)p Fj(O\013)g Fi(mdep)p 839 2806 V 29 w(cross)p
1063 2806 V 29 w(domain)p 1326 2806 V 30 w(rret)h Fj(implementation.)g
Fk(i)p Fq(\021)598 2897 y Fi(void)40 b(off_mdep_cross_domain_rret\(off)
q(_mde)q(pPro)q(cRegs)46 b(*uregs\))598 2989 y({)676
3080 y(off_ShtlCtxItr)d(i=off_Shtl::self\(\)->get_ctx\(\);)676
3171 y(//do_debug\(printf\("return)i(from)40 b(upcall)h(with)f(code)g
(\045x\\n",uregs->p_ts.eax\)\);)676 3263 y
(off_mdep_load_kregs\(i.get_el)q(ement)q(\(\)->)q(c_re)q(gs,\(r)q(egis)
q(ter_t)q(\)ure)q(gs\);)676 3354 y(otsan\(\);)598 3445
y(})515 3603 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l(c)l
(al)t(l)f(implementation)g(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 3694 y Fi(#include)41 b(<shtl/Shtl.h>)639
3836 y Fz(The)28 b(utilit)n(y)g Fx(off)p 1196 3836 27
4 v 30 w(mdep)p 1402 3836 V 30 w(iret)p 1608 3836 V 30
w(to)p Fz(,)e(used)i(b)r(efore)f(is)h(de\014ned)g(as:)515
3952 y Fk(h)p Fi(off)p 667 3952 24 4 v 29 w(mdep)p 852
3952 V 29 w(iret)p 1037 3952 V 29 w(to)g Fj(he)l(ader.)g
Fk(i)p Fq(\021)598 4043 y Fi(extern)40 b(volatile)h(void)g
(off_mdep_iret_to\(unsigned)j(int)c(eip,)g(unsigned)i(int)d(cs,)2088
4134 y(unsigned)i(int)f(eflags,)2088 4226 y(unsigned)h(int)f(esp,)g
(unsigned)i(int)d(ss\);)1885 5255 y Fz(624)p eop
PStoPSsaved restore
%%Page: (626,627) 314
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
625 626 bop 639 523 a Fz(And)28 b(is)g(implemen)n(ted)g(as)f(follo)n
(ws:)515 656 y Fk(h)p Fi(off)p 667 656 24 4 v 29 w(mdep)p
852 656 V 29 w(iret)p 1037 656 V 29 w(to)h Fj(implementation.)f
Fk(i)p Fq(\021)755 747 y Fi(.globl)40 b(off_mdep_iret_to)598
839 y(off_mdep_iret_to:)755 930 y(addl)79 b($4,\045esp)904
b(#)39 b(pop)h(saved)h(eip)2167 1021 y(#)118 b(stack)40
b(has)g(now:)g(eip,cs,eflags,esp,ds)2167 1112 y(#)118
b(which)40 b(looks)g(like)h(an)e(interrupt)j(frame)755
1204 y(xorl)e(\045eax,\045eax)755 1295 y(cli)755 1386
y(movw)g($0x4b,\045cx)865 b(#)39 b(reset)i(user)f(DS)f(and)h(ES)755
1478 y(movl)g(\045cx,\045ds)755 1569 y(movl)g(\045cx,\045es)755
1660 y(cld)1295 b(#)39 b(clear)i(direction)g(flag)755
1752 y(iret)1256 b(#)39 b(restore)i(such)f(an)g("interrupt")i(frame.)
639 1984 y Fz(Another)28 b(v)-5 b(arian)n(t)26 b(initializes)i(user)f
(registers)f(from)h(a)g(bu\013er.)515 2100 y Fk(h)p Fi(off)p
667 2100 V 29 w(mdep)p 852 2100 V 29 w(riret)p 1076 2100
V 29 w(to)h Fj(he)l(ader.)h Fk(i)o Fq(\021)598 2192 y
Fi(extern)40 b(volatile)h(void)g(off_mdep_riret_to\(unsigned)k(int)40
b(*ureg_ptr,)2128 2283 y(unsigned)h(int)f(eip,)g(unsigned)h(int)f(cs,)
2128 2374 y(unsigned)h(int)f(eflags,)2128 2466 y(unsigned)h(int)f(esp,)
g(unsigned)h(int)f(ss\);)515 2623 y Fk(h)p Fi(off)p 667
2623 V 29 w(mdep)p 852 2623 V 29 w(riret)p 1076 2623
V 29 w(to)28 b Fj(implementation.)f Fk(i)p Fq(\021)755
2715 y Fi(.globl)40 b(off_mdep_riret_to)598 2806 y(off_mdep_riret_to:)
755 2897 y(movl)79 b(8\(\045esp\),\045ebx)591 b(#)40
b(fetch)g(mdepUProcRegs)81 b(buffer)755 2989 y(movl)e
(0\(\045ebx\),\045edi)591 b(#)40 b(setup)g(registers)755
3080 y(movl)79 b(4\(\045ebx\),\045esi)755 3171 y(movl)g
(8\(\045ebx\),\045ebp)755 3263 y(movl)g(20\(\045ebx\),\045edx)755
3354 y(movl)g(24\(\045ebx\),\045ecx)755 3445 y(movl)g
(28\(\045ebx\),\045eax)755 3537 y(movl)g(16\(\045ebx\),\045ebx)755
3628 y(addl)g($4,\045esp)904 b(#)39 b(pop)h(saved)h(eip)2167
3719 y(#)118 b(stack)40 b(has)g(now:)g(eip,cs,eflags,esp,ds)2167
3811 y(#)118 b(which)40 b(looks)g(like)h(an)e(interrupt)j(frame)755
3902 y(cli)755 3993 y(movw)e($0x4b,\045cx)865 b(#)39
b(reset)i(user)f(DS)f(and)h(ES)755 4085 y(movl)g(\045cx,\045ds)755
4176 y(movl)g(\045cx,\045es)755 4267 y(cld)1295 b(#)39
b(clear)i(direction)g(flag)755 4359 y(iret)1256 b(#)39
b(restore)i(such)f(an)g("interrupt")i(frame.)1885 5255
y Fz(625)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
626 627 bop 515 523 a Fn(5.2.14)112 b(System)37 b(calls)515
668 y Fk(h)p Fj(c)l(ase)28 b(for)g(har)l(dwir)l(e)l(d)h(tr)l(ap)g
(delivering)e(in)h(machine)f(dep)l(endent)j(tr)l(ap)f(hand)t(ler.)f
Fk(i)p Fq(\021)598 759 y Fi(case)40 b(OFF_MDEP_TPRTLRCALL:)676
851 y Fk(h)p Fj(Push)28 b Fi(uregs)h Fj(user)f(state)i(for)d(curr)l
(ent)j(shuttle.)e Fk(i)676 942 y Fi(off_Processor::seti\(\);)676
1033 y(state->eax=prtl.pct\(off_prtl)q(_id_t)q(\(sta)q(te->)q(ebx,s)q
(tate)q(->ecx)q(\),0\))q(;)676 1125 y(off_Processor::clri\(\);)676
1216 y Fk(h)p Fj(Pop)g Fi(uregs)h Fj(user)f(state)h(for)f(curr)l(ent)h
(shuttle.)g Fk(i)676 1307 y Fi(return)41 b(0;)598 1399
y(break;)598 1490 y(case)f(OFF_MDEP_TPRTLRRET:)676 1581
y(off_mdep_cross_domain_rret\(\()q(off_m)q(depP)q(rocR)q(egs*\))q(stat)
q(e\);)676 1673 y(return)h(0;)598 1764 y(break;)598 1855
y(case)f(OFF_MDEP_TPRTLRMSG:)676 1947 y Fk(h)p Fj(Push)28
b Fi(uregs)h Fj(user)f(state)i(for)d(curr)l(ent)j(shuttle.)e
Fk(i)676 2038 y Fi(off_Processor::seti\(\);)676 2129
y(state->eax=prtl.deliver\(off_)q(prtl_)q(id_t)q(\(sta)q(te->e)q(bx,s)q
(tate-)q(>ecx)q(\),0\))q(;)676 2220 y(off_Processor::clri\(\);)676
2312 y Fk(h)p Fj(Pop)g Fi(uregs)h Fj(user)f(state)h(for)f(curr)l(ent)h
(shuttle.)g Fk(i)676 2403 y Fi(return)41 b(0;)598 2494
y(break;)598 2586 y(case)f(OFF_MDEP_TPRTLMSG:)676 2677
y Fk(h)p Fj(Push)28 b Fi(uregs)h Fj(user)f(state)i(for)d(curr)l(ent)j
(shuttle.)e Fk(i)676 2768 y Fi(off_Processor::seti\(\);)676
2860 y(state->eax=prtl.deliver\(off_)q(prtl_)q(id_t)q(\(sta)q(te->e)q
(bx,s)q(tate-)q(>ecx)q(\),)1618 2951 y
(state->edx,\(off_Msg*\)state->esi)q(,0\);)676 3042 y
(off_Processor::clri\(\);)676 3134 y Fk(h)p Fj(Pop)g
Fi(uregs)h Fj(user)f(state)h(for)f(curr)l(ent)h(shuttle.)g
Fk(i)676 3225 y Fi(return)41 b(0;)598 3316 y(break;)598
3408 y(case)f(OFF_MDEP_TPRTLCALL:)676 3499 y Fk(h)p Fj(Push)28
b Fi(uregs)h Fj(user)f(state)i(for)d(curr)l(ent)j(shuttle.)e
Fk(i)676 3590 y Fi(off_Processor::seti\(\);)637 3682
y({)676 3773 y(natural_t)41 b(msz=\(\(state->edx\)>>16\);)676
3864 y(state->edx)h(&=0xffff;)676 3956 y(state->eax=prtl.pct\(off_prtl)
q(_id_t)q(\(sta)q(te->)q(ebx,s)q(tate)q(->ecx)q(\),)1461
4047 y(msz,state->edx,)1461 4138 y(\(off_Msg*\)\(state->esi\),\(off_Ms)
q(g*\)st)q(ate-)q(>edi)q(,0\);)637 4230 y(})676 4321
y(off_Processor::clri\(\);)676 4412 y Fk(h)p Fj(Pop)28
b Fi(uregs)h Fj(user)f(state)h(for)f(curr)l(ent)h(shuttle.)g
Fk(i)676 4504 y Fi(return)41 b(0;)598 4595 y(break;)598
4686 y(case)f(OFF_MDEP_TPRTLRET:)676 4778 y
(off_mdep_cross_domain_ret\(\(o)q(ff_md)q(epPr)q(ocRe)q(gs*\)s)q(tate)q
(\);)676 4869 y(otsan\(\);)676 4960 y(return)h(0;)1885
5255 y Fz(626)p eop
PStoPSsaved restore
%%Page: (628,629) 315
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
627 628 bop 598 523 a Fi(break;)598 614 y(case)40 b(OFF_MDEP_TPCTPASS:)
676 706 y(state->eax=prtl.pct_pass\(off)q(_prtl)q(_id_)q(t\(st)q(ate->)
q(ebx,)q(state)q(->ec)q(x\),)1618 797 y
(state->edx,\(off_Msg*\)state->esi)q(\);)676 888 y(return)h(0;)598
980 y(break;)515 1154 y Fk(h)p Fj(Extr)l(a)29 b(dep)l(endencies)g(adde)
l(d)g(by)f(c)l(ase)h(for)e(har)l(dwir)l(e)l(d)i(tr)l(ap)g(delivering.)e
Fk(i)p Fq(\021)598 1245 y Fi(#include)41 b(<prtl/mdep/mupcall.h>)598
1337 y(#include)g(<prtl/PrtlSrv.h>)639 1478 y Fz(Where)515
1594 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(r)l(eturn)h(fr)l
(om)d(up)l(c)l(al)t(l)h(instruction.)g Fk(i)p Fq(\021)598
1685 y Fi(const)40 b(register_t)i(OFF_MDEP_UPCALL_DOWN)h(=)d
(0x80000002;)i(//0x000031cd;)g(int)e($0x31)598 1777 y(const)g
(register_t)i(OFF_MDEP_UPCALL_RDOWN=)i(0x80000004;)e(//0x000032cd;)g
(int)e($0x32)515 1934 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(up)l(c)l(al)t(l)f(tr)l(ap)h(numb)l(ers.)f Fk(i)p Fq(\021)598
2026 y Fi(const)40 b(natural_t)81 b(OFF_MDEP_TPRTLCALL)h(=0x30;)598
2117 y(const)40 b(natural_t)81 b(OFF_MDEP_TPRTLRET)121
b(=0x31;)598 2208 y(const)40 b(natural_t)81 b(OFF_MDEP_TPRTLRCALL)43
b(=0x32;)598 2300 y(const)d(natural_t)81 b(OFF_MDEP_TPRTLRRET)h(=0x33;)
598 2391 y(const)40 b(natural_t)81 b(OFF_MDEP_TPRTLMSG)121
b(=0x34;)598 2482 y(const)40 b(natural_t)81 b(OFF_MDEP_TPRTLRMSG)h
(=0x35;)598 2574 y(const)40 b(natural_t)81 b(OFF_MDEP_TPCTPASS)121
b(=0x36;)515 2848 y Fn(5.2.15)112 b(P)m(ortals)25 b(for)h(ix86)f(based)
i(arc)m(hitectures)e Fd(C)8 b FC(++)26 b Fn(source)g(\014les)515
3001 y FA(P)m(ortal)32 b(for)g(ix86)g(based)f(arc)m(hitectures)i
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 3154 y Fz(The)27
b(mac)n(hine)h(dep)r(enden)n(t)g(p)r(ortal)f(serv)n(er)f(is)h(at)h
Fx(prtl/mdep/mPrtl)o(Srv)o(.h)o Fz(.)515 3287 y Fk(h)p
Fj(mdep)f(mPrtlSrv.h*)11 b Fk(i)q Fq(\021)598 3378 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 3470 y Fi(#ifndef)41 b(__OFF_MDEP_PRTL_SRV_H)598
3561 y(#define)g(__OFF_MDEP_PRTL_SRV_H)j(1)598 3744 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal)g(server)g(dep)
l(endencies.)h Fk(i)598 3926 y Fi(#ifdef)40 b(__KERNEL__)598
4018 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal)g
(server.)g Fk(i)598 4200 y Fi(#endif)40 b(//)g(__KERNEL__)598
4474 y(#endif)g(//)g(!__OFF_MDEP_PRTL_SRV_H)1885 5255
y Fz(627)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
628 629 bop 639 523 a Fz(Mac)n(hine)18 b(dep)r(enden)n(t)h(p)r(ortals)f
(are)f(in)i Fx(prtl/mdep/mPrtl)o(.h)12 b Fz(and)18 b
Fx(prtl/mdep/mPrtl.C)o Fz(.)515 656 y Fk(h)p Fj(mdep)27
b(mPrtl.h*)11 b Fk(i)q Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 839 y Fi(#ifndef)41 b(__OFF_MDEP_PRTL_H)598
930 y(#define)g(__OFF_MDEP_PRTL_H)i(1)598 1112 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal)g(dep)l(endencies.)g
Fk(i)598 1295 y Fi(#ifdef)40 b(__KERNEL__)598 1386 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal.)g
Fk(i)598 1478 y Fi(#endif)40 b(//)g(__KERNEL__)598 1660
y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(p)l(ortal)g(symb)l
(ols.)f Fk(i)598 1843 y Fi(#ifdef)40 b(__KERNEL__)598
1934 y Fk(h)p Fi(off)p 750 1934 24 4 v 29 w(mdepPrtl::get)p
1286 1934 V 31 w(entry)28 b Fj(implementation.)g Fk(i)598
2026 y(h)p Fi(off)p 750 2026 V 29 w(mdepPrtl::is)p 1247
2026 V 31 w(kernel)g Fj(implementation.)g Fk(i)598 2117
y(h)p Fi(off)p 750 2117 V 29 w(mdepPrtl::hardwired)p
1520 2117 V 32 w(call)g Fj(implementation.)g Fk(i)598
2208 y Fi(#endif)40 b(//)g(__KERNEL__)598 2391 y(#endif)g(//)g
(!__OFF_MDEP_PRTL_H)515 2657 y Fk(h)p Fj(mdep)27 b(mPrtl.C*)11
b Fk(i)p Fq(\021)598 2748 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2931 y Fi(#include)41 b(<prtl/mdep/mPrtl.h>)161 b(//)40
b(Exported)h(interface)598 3113 y Fk(h)p Fi(off)p 750
3113 V 29 w(mdepPrtl::off)p 1286 3113 V 31 w(mdepPrtl)29
b Fj(implementation.)e Fk(i)598 3205 y(h)p Fi(off)p 750
3205 V 29 w(mdepPrtl::set)p 1286 3205 V 31 w(hndlr)h
Fj(implementation.)g Fk(i)598 3296 y(h)p Fi(off)p 750
3296 V 29 w(mdepPrtl::sp)p 1247 3296 V 31 w(alloc)g Fj(implementation.)
g Fk(i)598 3387 y(h)p Fi(off)p 750 3387 V 29 w(mdepPrtl::sp)p
1247 3387 V 31 w(free)g Fj(implementation.)f Fk(i)598
3479 y(h)p Fi(off)p 750 3479 V 29 w(mdepPrtl::setup)p
1364 3479 V 31 w(stack)i Fj(implementation.)e Fk(i)598
3570 y(h)p Fi(off)p 750 3570 V 29 w(mdepPrtl::copyout)k
Fj(implementation.)c Fk(i)598 3661 y(h)p Fi(off)p 750
3661 V 29 w(mdepPrtl::copyin)k Fj(implementation.)c Fk(i)598
3753 y(h)p Fi(off)p 750 3753 V 29 w(mdepStck::setup)p
1364 3753 V 31 w(kctx)i Fj(implementation.)e Fk(i)1885
5255 y Fz(628)p eop
PStoPSsaved restore
%%Page: (630,631) 316
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
629 630 bop 515 523 a FA(Up)s(calls)31 b(for)h(ix86)g(based)f(arc)m
(hitectures)i Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
676 y Fz(Mac)n(hine)18 b(dep)r(enden)n(t)h(up)r(calls)f(are)f(k)n(ept)i
(in)f Fx(prtl/mdep/mupcall)o(.h)12 b Fz(and)18 b Fx(prtl/mdep/mupcal)o
(l.C)o Fz(.)515 809 y Fk(h)p Fj(mdep)27 b(mup)l(c)l(al)t(l.h*)11
b Fk(i)p Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y
Fi(#ifndef)41 b(__OFF_MDEP_UPCALL_H)598 1083 y(#define)g
(__OFF_MDEP_UPCALL_H)i(1)598 1357 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(up)l(c)l(al)t(l)f(dep)l(endencies.)h
Fk(i)598 1540 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h(up)l(c)l(al)t
(l)f(tr)l(ap)h(numb)l(ers.)f Fk(i)598 1631 y(h)p Fj(O\013)f(machine)h
(dep)l(endent)h(r)l(eturn)h(fr)l(om)d(up)l(c)l(al)t(l)h(instruction.)g
Fk(i)598 1722 y(h)p Fj(O\013)f(up)l(c)l(al)t(l)h(r)l(eturn)h(tr)l(amp)l
(onile)f(size.)g Fk(i)598 1996 y Fi(#ifdef)40 b(__KERNEL__)598
2179 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l(c)l(al)t(l)f
(r)l(outines.)h Fk(i)598 2362 y Fi(#endif)40 b(//)g(__KERNEL__)598
2544 y(#endif)g(//)g(!__OFF_MDEP_UPCALL_H)515 2719 y
Fk(h)p Fj(mdep)27 b(mup)l(c)l(al)t(l.C*)11 b Fk(i)p Fq(\021)598
2810 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2993 y Fi(#include)41
b(<prtl/mdep/mupcall.h>)122 b(//)40 b(Exported)h(interface.)598
3084 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(up)l(c)l(al)t(l)f
(implementation)g(dep)l(endencies.)h Fk(i)598 3358 y(h)p
Fj(O\013)e Fi(mdep)p 922 3358 24 4 v 29 w(single)p 1185
3358 V 30 w(domain)p 1449 3358 V 29 w(call)i Fj(implementation.)e
Fk(i)598 3449 y(h)p Fj(O\013)g Fi(mdep)p 922 3449 V 29
w(single)p 1185 3449 V 30 w(domain)p 1449 3449 V 29 w(rcall)i
Fj(implementation.)e Fk(i)598 3541 y(h)p Fj(O\013)g Fi(mdep)p
922 3541 V 29 w(single)p 1185 3541 V 30 w(domain)p 1449
3541 V 29 w(ret)h Fj(implementation.)g Fk(i)598 3632
y(h)p Fj(O\013)f Fi(mdep)p 922 3632 V 29 w(cross)p 1146
3632 V 29 w(domain)p 1409 3632 V 30 w(call)h Fj(implementation.)g
Fk(i)598 3723 y(h)p Fj(O\013)f Fi(mdep)p 922 3723 V 29
w(setup)p 1146 3723 V 29 w(cross)p 1370 3723 V 30 w(domain)p
1634 3723 V 29 w(ret)i Fj(implementation.)e Fk(i)598
3815 y(h)p Fj(O\013)g Fi(mdep)p 922 3815 V 29 w(setup)p
1146 3815 V 29 w(cross)p 1370 3815 V 30 w(domain)p 1634
3815 V 29 w(rret)i Fj(implementation.)e Fk(i)598 3906
y(h)p Fj(O\013)g Fi(mdep)p 922 3906 V 29 w(cross)p 1146
3906 V 29 w(domain)p 1409 3906 V 30 w(ret)h Fj(implementation.)g
Fk(i)598 3997 y(h)p Fj(O\013)f Fi(mdep)p 922 3997 V 29
w(cross)p 1146 3997 V 29 w(domain)p 1409 3997 V 30 w(rcall)i
Fj(implementation.)e Fk(i)598 4088 y(h)p Fj(O\013)g Fi(mdep)p
922 4088 V 29 w(cross)p 1146 4088 V 29 w(domain)p 1409
4088 V 30 w(rret)h Fj(implementation.)g Fk(i)1885 5255
y Fz(629)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
630 631 bop 639 523 a Fz(Auxiliary)27 b(assem)n(bler)f(needed)i(for)f
(up)r(calls)h(is)f(in)h Fx(miret.h)d Fz(and)i Fx(miret.S)p
Fz(.)515 656 y Fk(h)p Fj(mdep)g(mir)l(et.h*)11 b Fk(i)q
Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y Fi(#ifndef)41
b(__OFF_MDEP_IRET_H)598 930 y(#define)g(__OFF_MDEP_IRET_H)i(1)598
1112 y(#ifndef)e(ASSEMBLER)598 1295 y(#ifdef)f(__KERNEL__)598
1386 y(extern)g("C")g({)715 1478 y Fk(h)p Fi(off)p 867
1478 24 4 v 29 w(mdep)p 1052 1478 V 29 w(iret)p 1237
1478 V 30 w(to)27 b Fj(he)l(ader.)i Fk(i)715 1569 y(h)p
Fi(off)p 867 1569 V 29 w(mdep)p 1052 1569 V 29 w(riret)p
1276 1569 V 30 w(to)f Fj(he)l(ader.)g Fk(i)598 1660 y
Fi(};)598 1752 y(#endif)40 b(//)g(__KERNEL__)598 1934
y(#endif)598 2117 y(#endif)g(//)g(!__OFF_MDEP_IRET_H)515
2383 y Fk(h)p Fj(mdep)27 b(mir)l(et.S*)11 b Fk(i)q Fq(\021)598
2474 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2657 y Fi(#include)41
b(<prtl/mdep/miret.h>)161 b(//)40 b(Exported)h(interface.)598
2748 y(#include)g(<flux/machine/asm.h>)122 b(//)40 b(for)g(ENTRY)g(et)g
(al.)912 2839 y(.text)912 2931 y(P2ALIGN\(TEXT_ALIGN\))598
3022 y Fk(h)p Fi(off)p 750 3022 V 29 w(mdep)p 935 3022
V 29 w(iret)p 1120 3022 V 29 w(to)28 b Fj(implementation.)f
Fk(i)598 3113 y(h)p Fi(off)p 750 3113 V 29 w(mdep)p 935
3113 V 29 w(riret)p 1159 3113 V 29 w(to)h Fj(implementation.)f
Fk(i)912 3205 y Fi(P2ALIGN\(TEXT_ALIGN\))1885 5255 y
Fz(630)p eop
PStoPSsaved restore
%%Page: (632,633) 317
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
631 632 bop 515 523 a Fk(h)p Fj(mdep)27 b(o\013std.h*)11
b Fk(i)r Fq(\021)598 706 y Fi(#ifndef)41 b(__OFF_STD_H)598
797 y(#define)g(__OFF_STD_H)g(1)598 980 y(#include)g
(<klib/mdep/types.h>)598 1071 y(#include)g(<klib/prot.h>)598
1162 y(#include)g(<klib/err.h>)598 1254 y(#include)g(<prtl/ex.h>)598
1528 y(#ifndef)g(__KERNEL__)598 1710 y(//)e(Issues)i(a)e(message-based)
k(pct)d(system)g(call.)598 1802 y(//)f(parameters)j(are)e(passed)g(in)g
(registers)h(to)f(the)g(kernel:)598 1893 y(//)f(eax->return)j(code)598
1984 y(//)d(ebx:ecx)i(portal)g(id)598 2076 y(//)e(edh)197
b(msz)598 2167 y(//)39 b(edl)197 b(rsz)598 2258 y(//)39
b(esi)197 b(msg)598 2350 y(//)39 b(edi)197 b(rep)598
2441 y(static)40 b(inline)598 2532 y(err_t)g
(off_prtl_pct\(off_prtl_id_t)45 b(p,natural_t)d(msz,)e(natural_t)h
(rsz,)1029 2623 y(off_Msg)g(*msg,)f(off_Msg)h(*rep,natural_t)i(tmout\))
598 2715 y({)676 2806 y(err_t)e(res;)676 2897 y(natural_t)g
(sizes=\(\(\(msz&0xffff\)<<16\)|\()q(rsz&)q(0xfff)q(f\)\);)676
2989 y(\(void\)tmout;)676 3080 y(__asm__)g(volatile)g(\("int)f($0x30")h
(\\)1068 3171 y(:)f("=a")g(\(res\))g(\\)1068 3263 y(:)g("b")g
(\(\(long\)\(p.i_node\)\),"c")k(\(\(long\)\(p.i_offset\)\),)g(\\)1068
3354 y("d")c(\(\(long\)\(sizes\)\),\\)1068 3445 y("S")g
(\(\(long\)\(msg\)\),"D")j(\(\(long\)\(rep\)\)\);)676
3537 y(return)e(res;)598 3719 y(})598 4085 y(//)e(Issues)i(a)e
(register-based)k(pct)d(system)g(call.)598 4176 y(//)f(parameters)j
(are)e(passed)g(in)g(registers)h(to)f(the)g(kernel:)598
4267 y(//)f(eax->return)j(code)598 4359 y(//)d(ebx:ecx)i(portal)g(id)
598 4450 y(//)e(edx)197 b(1st)40 b(msg)g(word)598 4541
y(//)f(esi)197 b(2rd)40 b(msg)g(word)598 4633 y(//)f(edi)197
b(3th)40 b(msg)g(word)598 4724 y(//)f(NB:)h(more)g(registers)i(can)e
(be)f(used,)i(but)f(this)g(is)f(not)h(yet)g(tested.)598
4815 y(static)g(inline)598 4907 y(err_t)g(off_prtl_rpct\(off_prtl_id_t)
45 b(p,long)c(m1,)f(long)g(m2,)g(long)g(m3\))598 4998
y({)1885 5255 y Fz(631)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
632 633 bop 676 523 a Fi(err_t)41 b(res;)676 614 y(__asm__)g(volatile)g
(\("int)f($0x32")h(\\)1068 706 y(:)f("=a")g(\(res\))g(\\)1068
797 y(:)g("b")g(\(\(long\)\(p.i_node\)\),"c")k
(\(\(long\)\(p.i_offset\)\),)g(\\)1068 888 y("d")c
(\(\(long\)\(m1\)\),\\)1068 980 y("S")g(\(\(long\)\(m2\)\),"D")j
(\(\(long\)\(m3\)\)\);)676 1071 y(return)e(res;)598 1254
y(})598 1436 y(//)e(Issues)i(a)e(message-based)k(deliver)d(system)h
(call.)598 1528 y(//)e(parameters)j(are)e(passed)g(in)g(registers)h(to)
f(the)g(kernel:)598 1619 y(//)f(eax->return)j(code)598
1710 y(//)d(ebx:ecx)i(portal)g(id)598 1802 y(//)e(edx)197
b(msz)598 1893 y(//)39 b(esi)197 b(msg)598 1984 y(static)40
b(inline)598 2076 y(err_t)g(off_prtl_deliver\(off_prtl_id_)q(t)45
b(p,)40 b(natural_t)h(sz,)f(off_Msg)h(*m,)f(natural_t)h(t\))598
2167 y({)676 2258 y(err_t)g(res;)676 2350 y(\(void\)t;)676
2441 y(__asm__)g(volatile)g(\("int)f($0x34")h(\\)1068
2532 y(:)f("=a")g(\(res\))g(\\)1068 2623 y(:)g("b")g
(\(\(long\)\(p.i_node\)\),"c")k(\(\(long\)\(p.i_offset\)\),)g(\\)1068
2715 y("d")c(\(\(long\)\(sz\)\),\\)1068 2806 y("S")g
(\(\(long\)\(m\)\)\);)676 2897 y(return)h(res;)598 3080
y(})598 3263 y(//)e(Issues)i(a)e(register-based)k(deliver)e(system)f
(call.)598 3354 y(//)f(parameters)j(are)e(passed)g(in)g(registers)h(to)
f(the)g(kernel:)598 3445 y(//)f(eax->return)j(code)598
3537 y(//)d(ebx:ecx)i(portal)g(id)598 3628 y(//)e(edx)197
b(1st)40 b(msg)g(word)598 3719 y(//)f(esi)197 b(2rd)40
b(msg)g(word)598 3811 y(//)f(edi)197 b(3th)40 b(msg)g(word)598
3902 y(//)f(NB:)h(more)g(registers)i(can)e(be)f(used,)i(but)f(this)g
(is)f(not)h(yet)g(tested.)598 3993 y(static)g(inline)598
4085 y(err_t)g(off_prtl_rdeliver\(off_prtl_id)q(_t)45
b(p,long)c(m1,)f(long)g(m2,)g(long)g(m3\))598 4176 y({)676
4267 y(err_t)h(res;)676 4359 y(__asm__)g(volatile)g(\("int)f($0x35")h
(\\)1068 4450 y(:)f("=a")g(\(res\))g(\\)1068 4541 y(:)g("b")g
(\(\(long\)\(p.i_node\)\),"c")k(\(\(long\)\(p.i_offset\)\),)g(\\)1068
4633 y("d")c(\(\(long\)\(m1\)\),\\)1068 4724 y("S")g
(\(\(long\)\(m2\)\),"D")j(\(\(long\)\(m3\)\)\);)676 4815
y(return)e(res;)598 4998 y(})1885 5255 y Fz(632)p eop
PStoPSsaved restore
%%Page: (634,635) 318
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
633 634 bop 598 614 a Fi(//)39 b(Issues)i(a)e(pct)h(pass)h(system)f
(call)598 706 y(//)f(parameters)j(are)e(passed)g(in)g(registers)h(to)f
(the)g(kernel:)598 797 y(//)f(eax->return)j(code)598
888 y(//)d(ebx:ecx)i(portal)g(id)598 980 y(//)e(edx)197
b(msz)598 1071 y(//)39 b(esi)197 b(msg)598 1162 y(//)39
b(NB:)h(more)g(registers)i(can)e(be)f(used,)i(but)f(this)g(is)f(not)h
(yet)g(tested.)598 1254 y(static)g(inline)598 1345 y(err_t)g
(off_prtl_pass\(off_prtl_id_t)45 b(p,natural_t)d(msz,)e(off_Msg)h(*m\))
598 1436 y({)676 1528 y(err_t)g(res;)676 1619 y(__asm__)g(volatile)g
(\("int)f($0x36")h(\\)1068 1710 y(:)f("=a")g(\(res\))g(\\)1068
1802 y(:)g("b")g(\(\(long\)\(p.i_node\)\),"c")k
(\(\(long\)\(p.i_offset\)\),)g(\\)1068 1893 y("d")c
(\(\(long\)\(msz\)\),\\)1068 1984 y("S")g(\(\(long\)\(m\)\)\);)676
2076 y(return)h(res;)598 2258 y(})598 2441 y(#endif)598
2623 y(#endif)1885 5255 y Fz(633)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
634 635 bop 515 523 a Fr(5.3)135 b(Distributed)46 b(Memory)f(Managers)
722 705 y FA(NOTE:)27 b Fz(Must)h(pro)n(vide)e(a)i Fx(dmm)e
Fz(instance.)722 870 y FA(NOTE:)h Fz(wrap)g(and)g(reexp)r(ort)g(kv2ph)n
(ys)f(and)i(ph)n(ys2kvm)e(from)h Fx(mdepDMM)p Fz(.)722
1036 y FA(NOTE:)36 b Fz(Must)g(handle)g(m)n(ultiple)h(size)f(page)f
(frames.)62 b(W)-7 b(e)37 b(should)f(used)722 1136 y(secondary)27
b(banks)h(again)g(to)g(handle)h(a)f(bunc)n(h)h(of)f(individual)h
(translations)722 1235 y(at)i(once.)46 b(As)32 b(suc)n(h)e
(translations)g(can)g(b)r(e)h(handled)g(in)h(a)e(single)h(op)r(eration)
722 1335 y(b)n(y)d(the)g(hardw)n(are,)d(w)n(e)i(should)h(rely)f(on)g
Fx(PTAddrTr)p Fz(s)d(to)k(do)f(so.)639 1500 y Fy(O\013)17
b Fx(++)34 b Fz(memory)g(managemen)n(t)f(is)i(based)f(on)g
Fy(Distribute)l(d)i(TLBs)42 b Fz(\()p Ft(dtlb)p Fz(s\))35
b(where)515 1600 y(TLB)k(stands)g(for)g Fy(T)-6 b(r)l(anslation)41
b(L)l(o)l(okaside)i(Bu\013er)p Fz(,)f(a)d(cac)n(he)g(of)g(virtual)g(to)
g(ph)n(ysical)515 1700 y(memory)27 b(address)f(translations)g([12)o(].)
515 1929 y Fn(5.3.1)112 b(dmm)515 2082 y Fz(Eac)n(h)19
b(Distributed)h(Memory)g(Manager)e(\()p Ft(dmm)p Fz(,)k(for)d(short\))h
(is)g(actually)f(a)h(p)r(o)r(ol)g(of)26 b Ft(dtlb)p Fz(s.)515
2182 y(Ho)n(w)n(ev)n(er,)21 b Ft(dtlb)p Fz(s)g(are)g(an)g(optional)g
(feature.)34 b(Mac)n(hines)21 b(dedicated)h(to)g(a)f(single)g(applica-)
515 2282 y(tion)27 b(\(lik)n(e)h(a)f(dedicated)h(\014le)f(serv)n(er,)f
(an)i(em)n(b)r(edded)g(con)n(troller,)d(etc.\))38 b(can)27
b(use)g(a)h(single)515 2381 y(protection)f(domain)g(for)g(e\016ciency)g
(purp)r(oses.)639 2481 y(A)39 b Ft(dmm)f Fz(m)n(ultiplexes)g(the)h
(address)e(translation)g(hardw)n(are)f(among)h(the)h(existing)515
2581 y Ft(dtlb)p Fz(s)28 b(in)h(co)r(op)r(eration)e(with)i(the)g(sh)n
(uttle)g(serv)n(er)e(\(as)i(there)f(is)h(usually)f(one)g(pro)r(cessor)
515 2680 y(register)33 b(used)i(to)g(iden)n(tify)h(the)f(protection)g
(domain\).)59 b(Hence,)37 b(the)e Ft(dmm)g Fz(includes)g(a)515
2780 y Ft(dtlb)27 b Fz(allo)r(cator)f(to)h(pro)n(vide)g
Ft(dtlb)p Fz(s.)515 2906 y Fk(h)p Fj(O\013)g(DMM.)f Fk(i)p
Fq(\021)598 2997 y Fi(//)39 b(An)h(dtlb)g(server)h(\(distributed)h
(memory)e(manager\).)598 3088 y(//)598 3180 y(class)g(off_DMM)h(:)e
(public)i(off_AbsCompResource)j({)598 3271 y(public:)676
3454 y(//)c(Returns)h(a)e(pointer)i(to)f(the)g(shuttle)g(allocator.)676
3545 y(virtual)h(off_DTLBAllocator)i(*get_allocator\(void\);)676
3728 y(//)d(Returns)h(a)e(reference)i(to)f(a)g(dtlb)g(from)g(its)g
(distributed)h(or)f(physical)676 3819 y(//)g(address.)676
3910 y(inline)h(off_DTLB)g(*operator)g(+\(vm_offset_t)h(d\);)676
4093 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4093 24 4 v 29 w(DMM)p Fj(.)h Fk(i)676
4276 y(h)p Fi(off)p 828 4276 V 29 w(DMM)g Fj(shuttle)h(pr)l(op)l(erty)h
(metho)l(ds.)f Fk(i)598 4367 y Fi(protected:)676 4458
y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 4458 V 29 w(DMM)p Fj(.)h Fk(i)676 4550
y(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 4550 V 29 w(DMM)p Fj(.)g Fk(i)598 4641
y Fi(private:)676 4732 y(static)41 b(off_DTLBAllocator)i(d_alloc;)e(//)
f(dtlb)g(allocator)676 4824 y Fk(h)p Fj(Other)29 b(private)f(memb)l
(ers)h(of)e Fi(off)p 1713 4824 V 29 w(DMM)p Fj(.)h Fk(i)598
5006 y Fi(};)1885 5255 y Fz(634)p eop
PStoPSsaved restore
%%Page: (636,637) 319
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
635 636 bop 515 523 a Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i
Fk(i)p Fq(\021)598 614 y Fi(#include)41 b(<klib/AbsCompResource.h>)j
(//)c(for)g(off_AbsCompResource)598 706 y(#include)h
(<dmm/DTLBAllocator.h>)598 797 y(#include)g(<dmm/DTLB.h>)316
b(//)40 b(for)g(off_DTLB)515 1047 y Fk(h)p Fj(O\013)27
b(DMM)g(static)i(memb)l(ers.)f Fk(i)p Fq(\021)598 1139
y Fi(off_DTLBAllocator)43 b(off_DMM::d_alloc;)g(//)d(dtlb)g(allocator)
515 1298 y Fk(h)p Fi(off)p 667 1298 24 4 v 29 w(DMM::get)p
1008 1298 V 30 w(allocator)29 b Fj(implementation.)f
Fk(i)o Fq(\021)598 1389 y Fi(inline)40 b(off_DTLBAllocator)j
(*off_DMM::get_allocator\(voi)q(d\))i({)676 1480 y
(assert\(valid\(\)\);)e(return)e(&d_alloc;)598 1572 y(})639
1796 y Fz(Being)24 b(a)h(sub)r(class)f(of)g Fx(CompResource)c
Fz(w)n(e)k(m)n(ust)h(implemen)n(t)g Fx(make)p 2803 1796
27 4 v 30 w(available)c Fz(and)515 1896 y Fx(is)p 608
1896 V 30 w(local)p Fz(.)515 2008 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2008 24 4
v 29 w(DMM)p Fj(.)g Fk(i)p Fq(\021)598 2100 y Fi(//)39
b(We)h(may)g(wish)g(to)g(cache)g(a)g(resource)h(unit.)598
2191 y(//)e(Returns)i(error)g(code)f(if)f(the)h(resource)h(is)f(not)g
(available.)h(Zero)g(otherwise.)598 2282 y(inline)f(err_t)h
(make_available\(off_id_t)j(&u\);)515 2429 y Fk(h)p Fi(off)p
667 2429 V 29 w(DMM::make)p 1047 2429 V 30 w(available)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 2520 y Fi(//)39
b(We)h(may)g(wish)g(to)g(cache)g(a)g(resource)h(unit.)598
2611 y(//)e(Returns)i(error)g(code)f(if)f(the)h(resource)h(is)f(not)g
(available.)h(Zero)g(otherwise.)598 2703 y(inline)f(err_t)h
(off_DMM::make_available\(off_id)q(_t)k(&u\))598 2794
y({)676 2885 y Fk(h)p Fj(Bo)l(dy)28 b(of)f Fi(off)p 1111
2885 V 29 w(CompResource::make)p 1842 2885 V 33 w(available)p
Fj(.)i Fk(i)598 2977 y Fi(})515 3227 y Fk(h)p Fj(Other)f(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 3227 V 29 w(DMM)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 3318 y Fi(//)39 b(Is)h(this)g(identifier)i(a)
d(local)i(one?)598 3410 y(inline)f(boolean_t)i(is_local\(const)g
(off_dtlb_id_t)g(&d\);)515 3569 y Fk(h)p Fi(off)p 667
3569 V 29 w(DMM::is)p 969 3569 V 29 w(local)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 3660 y Fi(//)39 b(Is)h(this)g(identifier)i(a)d
(local)i(one?)598 3751 y(inline)f(boolean_t)i(off_DMM::is_local\(const)
i(off_dtlb_id_t)e(&d\))598 3843 y({)676 3934 y(assert\(valid\(\)\);)676
4025 y(return)f(\()e(d)h(<=)f(d_alloc.get_length\(\))44
b(&&)872 4117 y(\(d_alloc+d\)->l_dtlb.get_id\(\))i(==)40
b(d)f(\);)598 4299 y(})515 4550 y Fk(h)p Fj(O\013)27
b(DMM)g(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
4641 y Fi(#include)41 b(<klib/ids.h>)434 b(//)40 b(for)g(OFF_PRTL_NULL)
i(et)d(al.)598 4732 y(#include)i(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
4824 y(#include)h(<klib/err.h>)473 b(//)40 b(for)g(err_t)598
4915 y(#include)h(<klib/prot.h>)395 b(//)40 b(for)g(off_Protection)598
5006 y(#include)h(<klib/Magic.h>)395 b(//)40 b(for)g(magic)g(numbers)
1885 5255 y Fz(635)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
636 637 bop 639 523 a Fz(The)24 b Ft(dmm)g Fz(is)g(created)f(with)h
(default)h(v)-5 b(alues)23 b(for)h(its)g(mem)n(b)r(ers)f(and)h(will)g
(remain)f(in)h(a)515 623 y(dorman)n(t)h(state)h(un)n(til)g
Ft(dtlb)g Fz(supp)r(ort)g(is)f(started)h(\(if)h(ev)n(er\))e(b)n(y)h
(calling)f(the)h Ft(dmm)g Fx(start)515 722 y Fz(metho)r(d.)515
855 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 855 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
946 y Fi(//)39 b(Creates)i(a)f(DMM.)598 1038 y(off_DMM\(void\);)515
1212 y Fk(h)p Fi(off)p 667 1212 V 29 w(DMM::off)p 1008
1212 V 30 w(DMM)28 b Fj(implementation.)f Fk(i)p Fq(\021)598
1303 y Fi(//)39 b(Creates)i(a)f(DMM.)598 1395 y
(off_DMM::off_DMM\(void\))k(:)676 1486 y(off_AbsCompResource\(off_Prot)
q(ectio)q(n\(\),)q(OFF_)q(PRTL_)q(NULL)q(,)h(OFF_ID_NULL,)1422
1577 y(OFF_MAGIC_DMM\),)676 1669 y Fk(h)p Fj(Initialize)27
b(other)i(aggr)l(e)l(gate)h(memb)l(ers)e(of)g Fi(off)p
2090 1669 V 29 w(DMM)p Fj(.)f Fk(i)598 1760 y Fi({)598
1851 y(})515 2026 y Fk(h)p Fj(O\013)g(DMM)g(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 2117 y Fi(#include)41 b(<klib/prot.h>)395
b(//)40 b(for)g(off_Protection)598 2208 y(#include)h(<klib/err.h>)434
b(//)40 b(for)g(err_t)g(and)g(error)g(numbers.)598 2300
y(#include)h(<klib/Magic.h>)356 b(//)40 b(for)g(magic)g(numbers)598
2391 y(#include)h(<klib/HWCompResource.h>)j(//)c(for)g
(off_HWCompResource)598 2482 y(#include)h(<dmm/DTLBAllocator.h>)201
b(//)39 b(for)h(off_IOAllocator)j(et)d(al.)598 2574 y(#include)h
(<dmm/DTLB.h>)395 b(//)39 b(for)h(off_IOPort)i(et)e(al.)639
2715 y Fz(There)27 b(is)h(a)f(single)g Ft(dmm)h Fz(instance)f(p)r(er)g
(system.)515 2831 y Fk(h)p Fj(O\013)g(DMM)g(exp)l(orte)l(d)j
(variables.)e Fk(i)p Fq(\021)598 2922 y Fi(extern)40
b(off_DMM)h(dmm;)315 b(//)40 b(DMM)f(instance)j(for)d(this)i(node.)515
3080 y Fk(h)p Fj(O\013)27 b(DMM)g(glob)l(al)h(variables.)g
Fk(i)o Fq(\021)598 3171 y Fi(off_DMM)41 b(dmm;)589 b(//)40
b(DMM)f(instance)j(for)d(this)i(node.)639 3313 y Fz(W)-7
b(e)28 b(m)n(ust)g(de\014ne)g(the)g(new)f(magic)g(n)n(um)n(b)r(er)h
(used)f(b)r(efore.)515 3429 y Fk(h)p Fj(O\013)g(magic)g(numb)l(ers.)i
Fk(i)p Fq(\021)598 3520 y Fi(OFF_MAGIC_DMM,)42 b(//)e(DMM)g(magic)g
(nb.)639 3645 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h
(to)h(the)g(implemen)n(tation)f(of)h Fx(Magic::nameof)p
Fz(.)515 3761 y Fk(h)p Fi(off)p 667 3761 V 29 w(Magic::nameof)i
Fj(c)l(ase)f(for)e Fi(m)p 1559 3761 V 29 w(number)p Fj(s.)h
Fk(i)p Fq(\021)598 3852 y Fi(case)40 b(OFF_MAGIC_DMM:)676
3944 y(return)h("off_DMM";)639 4068 y Ft(dmm)28 b Fz(users)e(can)i(c)n
(hec)n(k)e(their)i(references)e(to)i Ft(dtlb)f Fz(banks)g(using)g(this)
h(metho)r(d.)515 4184 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4184 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 4276 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(DMM?)598
4367 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_DMM;)i(})639 4491 y Fz(The)28 b(new)g(con)n(tainer)e
(can)h(also)g(implemen)n(t)h(its)g Fx(get)p 2323 4491
27 4 v 30 w(umagic)d Fz(metho)r(d.)515 4624 y Fk(h)p
Fj(Other)j(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 4624 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fq(\021)598
4716 y Fi(virtual)41 b(off_magic_t)g(get_umagic\(void\))i({)d(return)g
(OFF_MAGIC_DTLB;)j(})1885 5255 y Fz(636)p eop
PStoPSsaved restore
%%Page: (638,639) 320
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
637 638 bop 639 523 a Fz(After)28 b(instan)n(tiation,)f
Fx(start)f Fz(should)h(b)r(e)h(used)g(to)f(start)g Ft(dmm)h
Fz(op)r(eration.)515 639 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 639 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 731 y Fi(//)39 b(Starts)i(normal)g(operation)g(for)f(this)g
(DMM.)598 822 y(err_t)g(start\(const)i(off_mdepDMM)g(&mdep,)e(const)h
(off_id_t)g(&id)e(\);)515 980 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 1071 y Fi(#include)41
b(<dmm/mdep/mDMM.h>)239 b(//)40 b(for)g(off_mdepDMM)515
1245 y Fk(h)p Fi(off)p 667 1245 V 29 w(DMM::start)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 1337 y Fi(//)39
b(Starts)i(normal)g(operation)g(for)f(this)g(DMM)598
1428 y(err_t)g(off_DMM::start\()j(const)d(off_mdepDMM)i(&mdep,)e(const)
h(off_id_t)g(&id)f(\))598 1519 y({)676 1611 y(assert\(valid\(\)\);)676
1702 y(set_id\(id\);)676 1885 y Fk(h)p Fj(Start)29 b(other)g(memb)l
(ers)g(of)e Fi(off)p 1629 1885 V 29 w(DMM)h Fj(ac)l(c)l(or)l(ding)h(to)
f Fi(mdep)p Fj(.)g Fk(i)676 1976 y(h)p Fj(Initialize)f
Fi(DMM::d)p 1267 1976 V 29 w(alloc)p Fj(.)h Fk(i)676
2250 y Fi(kcout<<)41 b("DMM)f(#")g(<<)g(id)f(<<)h(")f(started.")j(<<)d
(nl;)676 2341 y(return)i(EOK;)598 2433 y(})515 2698 y
Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i Fk(i)p
Fz(+)o Fq(\021)598 2790 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)598 2881 y(#include)h(<klib/str.h>)434
b(//)40 b(for)g(kcout.)639 3022 y Fz(A)22 b(new)f(mem)n(b)r(er,)h
Fx(d)p 1272 3022 27 4 v 31 w(mdep)e Fz(stores)f(an)n(y)i(b)r(o)r(ot)g
(time)g(mac)n(hine)g(dep)r(enden)n(t)h(information)515
3122 y(whic)n(h)27 b(migh)n(t)h(b)r(e)g(needed)g(b)n(y)f(the)h(dmm.)515
3238 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 3238 24 4 v 29 w(DMM)p Fj(.)h Fk(i)p Fq(\021)598
3329 y Fi(off_mdepDMM)41 b(d_mdep;)355 b(//)40 b(Machine)h(dependent)g
(info.)515 3487 y Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)f(of)f
Fi(off)p 1467 3487 V 29 w(DMM)h Fj(ac)l(c)l(or)l(ding)i(to)e
Fi(mdep)p Fj(.)g Fk(i)o Fq(\021)598 3578 y Fi(d_mdep=mdep;)598
3670 y(d_mdep.start\(\);)639 3811 y Fz(Initially)-7 b(,)28
b(b)r(efore)f(it)h(is)g(started,)f(it)h(is)f(initialized)h(with)g
(default)g(v)-5 b(alues.)515 3927 y Fk(h)p Fj(Initialize)26
b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e Fi(off)p
1928 3927 V 29 w(DMM)p Fj(.)h Fk(i)p Fq(\021)598 4018
y Fi(d_mdep\(\),)639 4143 y Fz(Secondary)18 b(pro)r(cessor)g(ma)n(y)g
(need)i(to)f(self-initialize)h(MMU)g(hardw)n(are.)32
b(They)19 b(should)515 4242 y(call)27 b Fx(self)p 848
4242 27 4 v 30 w(start)e Fz(to)j(do)f(so.)515 4359 y
Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4359 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
4450 y Fi(//)39 b(Completes)j(\(self\))e(initialization.)598
4541 y(void)g(self_start\(void\);)1885 5255 y Fz(637)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
638 639 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(DMM::self)p 1047 523 V 30 w(start)28 b Fj(implementation.)g
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Completes)j(\(self\))e
(initialization.)598 706 y(void)g(off_DMM::self_start\(void\))598
797 y({)676 888 y(off_Trap)h(*t;)676 980 y(off_TrapTbl)h(*traps;)676
1071 y(d_mdep.self_start\(\);)676 1162 y
(traps=off_Processor::self\(\)-)q(>get_)q(trap)q(s\(\);)676
1254 y(t=new\(traps,traps->get_pgflt)q(\(\)\))755 1345
y(off_Trap\(get_protection\(\),get_d)q(omai)q(n\(\),)q(&d_pf)q(_han)q
(dler\))q(;)676 1436 y(if)e(\(!t\))755 1528 y(panic\("dmm:)h(could)g
(not)f(allocate)h(page)f(fault)g(trap."\);)598 1619 y(})515
1885 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1885 V 29 w(DMM)p Fj(.)f Fk(i)p Fq(\021)598
1976 y Fi(static)40 b(off_KrnEventHandler)k(d_pf_handler;)515
2150 y Fk(h)p Fj(O\013)27 b(DMM)g(static)i(memb)l(ers.)f
Fk(i)p Fz(+)o Fq(\021)598 2242 y Fi(off_KrnEventHandler)43
b(off_DMM::d_pf_handler\(off_DM)q(M::p)q(g_fau)q(lt\);)515
2416 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 2507 y Fi(#include)41 b(<hw/Event.h>)434
b(//)40 b(for)g(off_KrnEventHandler)639 2648 y Fz(Not)27
b(ev)n(ery)d(no)r(de)j(has)e(to)h(activ)-5 b(ate)26 b(its)g
Ft(dmm)p Fz(.)37 b(Only)25 b(m)n(ultiuser)h(time-sharing)f(no)r(des)515
2748 y(should.)36 b(Before)27 b Fx(start)f Fz(is)h(called,)g(the)h
Ft(dmm)g Fz(is)f(not)h(activ)n(e.)515 2881 y Fk(h)p Fj(Other)g(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2881 V 29 w(DMM)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 2972 y Fi(//)39 b(Is)h(the)g(DMM)g(active?)
598 3064 y(static)g(inline)h(boolean_t)g(is_active\(void\);)515
3238 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3238 V 29 w(DMM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 3329 y Fi(static)40 b(boolean_t)i(activated;)515
3504 y Fk(h)p Fj(O\013)27 b(DMM)g(static)i(memb)l(ers.)f
Fk(i)p Fz(+)o Fq(\021)598 3595 y Fi(boolean_t)41 b(off_DMM::activated)i
(=)d(FALSE;)515 3769 y Fk(h)p Fj(Mark)28 b(DMM)f(as)h(active.)g
Fk(i)o Fq(\021)598 3861 y Fi(off_DMM::activated=TRUE;)515
4035 y Fk(h)p Fi(off)p 667 4035 V 29 w(DMM::is)p 969
4035 V 29 w(active)h Fj(implementation.)f Fk(i)p Fq(\021)598
4126 y Fi(//)39 b(Is)h(the)g(DMM)g(active?)598 4218 y(extern)g(inline)h
(boolean_t)g(off_DMM::is_active\(void\))84 b({)40 b(return)g
(off_DMM::activated;})1885 5255 y Fz(638)p eop
PStoPSsaved restore
%%Page: (640,641) 321
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
639 640 bop 515 523 a Fn(5.3.2)112 b(Distributed)36 b(TLBs)515
676 y Fz(A)28 b Ft(dtlb)f Fz(is)h(a)f(set)h(of)g(translations.)36
b(Not)27 b(ev)n(ery)g(existing)g(translation)g(m)n(ust)h(b)r(e)g
(presen)n(t)515 776 y(on)j(it.)50 b(The)32 b Ft(dtlb)f
Fz(should)h(b)r(e)g(considered)f(to)g(b)r(e)i(a)e(cac)n(he)g(of)h(the)g
(translations)e(b)r(eing)515 876 y(used.)39 b(Ho)n(w)n(ev)n(er,)27
b(on)h(arc)n(hitectures)f(with)i(page)f(tables,)g(the)h(cac)n(he)f(ma)n
(y)f(actually)h(hold)515 975 y(a)f(cop)n(y)g(of)g(ev)n(ery)g(existing)g
(translation)f(to)i(lo)r(cal)f(memory)-7 b(.)639 1075
y(P)n(age)23 b(faults)j(and)e(remaining)h(ev)n(en)n(ts)f(for)g(the)i
Ft(dtlb)e Fz(will)i(b)r(e)f(deliv)n(ered)f(to)h(its)g(o)n(wner)515
1174 y(\(see)i Fx(off)p 818 1174 27 4 v 30 w(Resource)p
Fz(,)e(for)i(details\).)639 1274 y Ft(dtlb)p Fz(s)34
b(are)g(at)g(the)h(same)f(time)h(abstract)e(resource)g(units)i(and)f
(ph)n(ysical)g(resource)515 1374 y(con)n(tainers.)e(Ho)n(w)n(ev)n(er,)
19 b(they)g(are)f(primarily)f(considered)h(to)h(b)r(e)g(abstract)f
(resource)f(units;)515 1473 y Fx(make)p 696 1473 V 29
w(available)25 b Fz(is)j(not)h(implemen)n(ted)g(for)f(address)f
(translations)g(\(A)-7 b(T\),)29 b(and)f(the)h(re-)515
1573 y(lo)r(cation)d(table)i(is)f(nev)n(er)f(used)h(for)g(individual)h
(translations)d(\(the)j(p)r(er-no)r(de)f(relo)r(cation)515
1673 y(table)35 b(is)h(used)f(only)g(for)g(remote)g(page)g(frames)g
(whic)n(h)g(happ)r(en)h(to)f(b)r(e)h(cac)n(hed)f(in)h(the)515
1772 y(lo)r(cal)27 b(no)r(de\).)639 1872 y(Eac)n(h)39
b Ft(dtlb)g Fz(con)n(tains)g(a)g(set)h(of)g(remote)f(translations,)i
(some)e(of)h(whic)n(h)g(happ)r(en)515 1971 y(to)30 b(b)r(e)h(lo)r(cal)f
(ones)g(\(see)h(\014gure)f(5.3\).)46 b(Ev)n(ery)29 b(translation)g(is)i
(tak)n(en)f(from)g(a)g(translation)515 2071 y(allo)r(cator,)21
b Fx(AddrTrAllocator)p Fz(,)d(whic)n(h)k(pro)n(vides)f(metho)r(ds)i(to)
f(allo)r(cate)g(and)g(deallo)r(cate)515 2171 y Fx(AddrTr)p
Fz(s.)50 b(The)33 b(allo)r(cator)f(will)h(k)n(eep)f(lo)r(cal)h
(translations)e(just)j(in)f(the)h(lo)r(cal)e(\(mac)n(hine)515
2270 y(dep)r(enden)n(t\))c(address)f(translation)f(\(A)-7
b(T\))29 b(table)e(to)h(sa)n(v)n(e)e(some)h(memory)-7
b(.)530 3684 y @beginspecial 0 @llx 0 @lly 539 @urx 246
@ury 3401 @rwi @setspecial
%%BeginDocument: fig/dtlb.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-35.0 271.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 3600 1500 m 4800 1500 l 4800 1800 l 3600 1800 l cp gs col-1 s gr 
% Polyline
n 5100 1500 m 6300 1500 l 6300 1800 l 5100 1800 l cp gs col-1 s gr 
% Polyline
n 6525 1500 m 7725 1500 l 7725 1800 l 6525 1800 l cp gs col-1 s gr 
% Polyline
n 4125 600 m 7125 600 l 7125 900 l 4125 900 l cp gs col-1 s gr 
% Polyline
n 4125 600 m 4425 600 l 4425 900 l 4125 900 l cp gs col-1 s gr 
% Polyline
n 4725 600 m 5025 600 l 5025 900 l 4725 900 l cp gs col-1 s gr 
% Polyline
n 5025 600 m 5325 600 l 5325 900 l 5025 900 l cp gs col-1 s gr 
% Polyline
n 5325 600 m 5625 600 l 5625 900 l 5325 900 l cp gs col-1 s gr 
% Polyline
n 5625 600 m 5925 600 l 5925 900 l 5625 900 l cp gs col-1 s gr 
% Polyline
n 5925 600 m 6225 600 l 6225 900 l 5925 900 l cp gs col-1 s gr 
% Polyline
n 6225 600 m 6525 600 l 6525 900 l 6225 900 l cp gs col-1 s gr 
% Polyline
n 6525 600 m 6825 600 l 6825 900 l 6525 900 l cp gs col-1 s gr 
% Polyline
n 3600 1500 m 3900 1500 l 3900 1800 l 3600 1800 l cp gs col-1 s gr 
% Polyline
n 3900 1500 m 4200 1500 l 4200 1800 l 3900 1800 l cp gs col-1 s gr 
% Polyline
n 4200 1500 m 4500 1500 l 4500 1800 l 4200 1800 l cp gs col-1 s gr 
% Polyline
n 5400 1500 m 5700 1500 l 5700 1800 l 5400 1800 l cp gs col-1 s gr 
% Polyline
n 6000 1500 m 6300 1500 l 6300 1800 l 6000 1800 l cp gs col-1 s gr 
% Polyline
n 6525 1500 m 6825 1500 l 6825 1800 l 6525 1800 l cp gs col-1 s gr 
% Polyline
n 6825 1500 m 7125 1500 l 7125 1800 l 6825 1800 l cp gs col-1 s gr 
% Polyline
n 7125 1500 m 7425 1500 l 7425 1800 l 7125 1800 l cp gs col-1 s gr 
% Polyline
gs  clippath
3859 1397 m 3765 1477 l 3810 1362 l 3717 1495 l 3766 1529 l  cp clip
n 4275 750 m 3750 1500 l gs col-1 s gr gr

% arrowhead
n 3859 1397 m 3765 1477 l 3810 1362 l  col-1 s
% Polyline
gs  clippath
4159 1397 m 4065 1477 l 4110 1362 l 4017 1495 l 4066 1529 l  cp clip
n 4575 750 m 4050 1500 l gs col-1 s gr gr

% arrowhead
n 4159 1397 m 4065 1477 l 4110 1362 l  col-1 s
% Polyline
gs  clippath
5865 1351 m 5847 1473 l 5806 1357 l 5822 1518 l 5881 1512 l  cp clip
n 5775 750 m 5850 1500 l gs col-1 s gr gr

% arrowhead
n 5865 1351 m 5847 1473 l 5806 1357 l  col-1 s
% Polyline
gs  clippath
4797 1469 m 4674 1489 l 4773 1414 l 4624 1478 l 4648 1533 l  cp clip
n 6375 750 m 4650 1500 l gs col-1 s gr gr

% arrowhead
n 4797 1469 m 4674 1489 l 4773 1414 l  col-1 s
% Polyline
n 1500 3000 m 1500 4500 l gs col-1 s gr 
% Polyline
n 600 3300 m 3000 3300 l gs col-1 s gr 
% Polyline
n 600 3300 m 1500 3300 l 1500 3600 l 600 3600 l cp gs col-1 s gr 
% Polyline
n 600 3600 m 1500 3600 l 1500 3900 l 600 3900 l cp gs col-1 s gr 
% Polyline
n 600 3900 m 1500 3900 l 1500 4200 l 600 4200 l cp gs col-1 s gr 
% Polyline
n 600 4200 m 1500 4200 l 1500 4500 l 600 4500 l cp gs col-1 s gr 
% Polyline
n 1500 3300 m 3000 3300 l 3000 3600 l 1500 3600 l cp gs col-1 s gr 
% Polyline
n 1500 3600 m 3000 3600 l 3000 3900 l 1500 3900 l cp gs col-1 s gr 
% Polyline
n 1500 3900 m 3000 3900 l 3000 4200 l 1500 4200 l cp gs col-1 s gr 
% Polyline
n 1500 4200 m 3000 4200 l 3000 4500 l 1500 4500 l cp gs col-1 s gr 
% Polyline
n 600 3000 m 3000 3000 l 3000 4500 l 600 4500 l cp gs col-1 s gr 
% Polyline
gs  clippath
3222 4080 m 3102 4050 l 3222 4020 l 3060 4020 l 3060 4080 l  cp clip
n 3375 4050 m 3075 4050 l gs col-1 s gr gr

% arrowhead
n 3222 4080 m 3102 4050 l 3222 4020 l  col-1 s
% Polyline
n 1500 600 m 1500 2100 l gs col-1 s gr 
% Polyline
n 600 900 m 3000 900 l gs col-1 s gr 
% Polyline
n 600 900 m 1500 900 l 1500 1200 l 600 1200 l cp gs col-1 s gr 
% Polyline
n 600 1200 m 1500 1200 l 1500 1500 l 600 1500 l cp gs col-1 s gr 
% Polyline
n 600 1500 m 1500 1500 l 1500 1800 l 600 1800 l cp gs col-1 s gr 
% Polyline
n 600 1800 m 1500 1800 l 1500 2100 l 600 2100 l cp gs col-1 s gr 
% Polyline
n 1500 900 m 3000 900 l 3000 1200 l 1500 1200 l cp gs col-1 s gr 
% Polyline
n 1500 1200 m 3000 1200 l 3000 1500 l 1500 1500 l cp gs col-1 s gr 
% Polyline
n 1500 1500 m 3000 1500 l 3000 1800 l 1500 1800 l cp gs col-1 s gr 
% Polyline
n 1500 1800 m 3000 1800 l 3000 2100 l 1500 2100 l cp gs col-1 s gr 
% Polyline
n 600 600 m 3000 600 l 3000 2100 l 600 2100 l cp gs col-1 s gr 
/Courier ff 180.00 scf sf
4200 525 m
gs 1 -1 sc (v1) col-1 sh gr
/Courier ff 180.00 scf sf
4500 525 m
gs 1 -1 sc (v2) col-1 sh gr
/Courier ff 180.00 scf sf
5700 525 m
gs 1 -1 sc (v3) col-1 sh gr
/Courier ff 180.00 scf sf
6300 525 m
gs 1 -1 sc (v4) col-1 sh gr
/Courier ff 180.00 scf sf
3450 1350 m
gs 1 -1 sc (p:o1) col-1 sh gr
/Courier ff 180.00 scf sf
5925 1425 m
gs 1 -1 sc (q:o3) col-1 sh gr
/Courier ff 180.00 scf sf
4500 1350 m
gs 1 -1 sc (p:o4) col-1 sh gr
/Times-Italic ff 180.00 scf sf
675 525 m
gs 1 -1 sc (DTLB) col-1 sh gr
/Times-Italic ff 180.00 scf sf
675 2850 m
gs 1 -1 sc (TLB/MMU) col-1 sh gr
/Courier ff 180.00 scf sf
750 3525 m
gs 1 -1 sc (v1) col-1 sh gr
/Courier ff 180.00 scf sf
750 3825 m
gs 1 -1 sc (v2) col-1 sh gr
/Courier ff 180.00 scf sf
750 4125 m
gs 1 -1 sc (v3) col-1 sh gr
/Courier ff 180.00 scf sf
750 4425 m
gs 1 -1 sc (v4) col-1 sh gr
/Courier ff 180.00 scf sf
1800 3525 m
gs 1 -1 sc (m1) col-1 sh gr
/Courier ff 180.00 scf sf
1800 3825 m
gs 1 -1 sc (m2) col-1 sh gr
/Courier ff 180.00 scf sf
1800 4125 m
gs 1 -1 sc (m3) col-1 sh gr
/Courier ff 180.00 scf sf
1800 4425 m
gs 1 -1 sc (m4) col-1 sh gr
/Courier ff 180.00 scf sf
3975 1350 m
gs 1 -1 sc (p:o2) col-1 sh gr
/Courier ff 180.00 scf sf
3675 2025 m
gs 1 -1 sc (m1) col-1 sh gr
/Courier ff 180.00 scf sf
3975 2025 m
gs 1 -1 sc (m2) col-1 sh gr
/Courier ff 180.00 scf sf
4275 2025 m
gs 1 -1 sc (m3) col-1 sh gr
/Courier ff 180.00 scf sf
4575 2025 m
gs 1 -1 sc (m4) col-1 sh gr
/Times-Italic ff 180.00 scf sf
7275 825 m
gs 1 -1 sc (Virtual address space \(DTLB\)) col-1 sh gr
/Times-Italic ff 180.00 scf sf
3675 2325 m
gs 1 -1 sc (Node "p") col-1 sh gr
/Times-Italic ff 180.00 scf sf
5100 2325 m
gs 1 -1 sc (Node "q") col-1 sh gr
/Times-Italic ff 180.00 scf sf
6525 2325 m
gs 1 -1 sc (Node "r") col-1 sh gr
/Times-Italic ff 180.00 scf sf
3450 4125 m
gs 1 -1 sc (Referenced remote translation   \(m3 is caching q:o3\)) col-1 sh gr
/Times-Roman ff 180.00 scf sf
600 825 m
gs 1 -1 sc (virt.addr.) col-1 sh gr
/Times-Roman ff 180.00 scf sf
1725 825 m
gs 1 -1 sc (distr. phys. addr.) col-1 sh gr
/Courier ff 180.00 scf sf
750 1125 m
gs 1 -1 sc (v1) col-1 sh gr
/Courier ff 180.00 scf sf
750 1425 m
gs 1 -1 sc (v2) col-1 sh gr
/Courier ff 180.00 scf sf
750 1725 m
gs 1 -1 sc (v3) col-1 sh gr
/Courier ff 180.00 scf sf
750 2025 m
gs 1 -1 sc (v4) col-1 sh gr
/Courier ff 180.00 scf sf
1800 1125 m
gs 1 -1 sc (p:o1) col-1 sh gr
/Courier ff 180.00 scf sf
1800 1425 m
gs 1 -1 sc (p:o2) col-1 sh gr
/Courier ff 180.00 scf sf
1800 1725 m
gs 1 -1 sc (q:o3) col-1 sh gr
/Courier ff 180.00 scf sf
1800 2025 m
gs 1 -1 sc (p:o4) col-1 sh gr
/Times-Roman ff 180.00 scf sf
675 3225 m
gs 1 -1 sc (virt.addr.) col-1 sh gr
/Times-Roman ff 180.00 scf sf
1650 3225 m
gs 1 -1 sc (distr. phys. addr.) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 636 3867 a(Figure)27 b(5.3:)36 b(A)28 b(distributed)g(TLB)
f(with)i(some)e(lo)r(cal)g(and)g(remote)g(translations.)515
4178 y Fk(h)p Fj(O\013)g(DTLB.)g Fk(i)p Fq(\021)598 4269
y Fi(class)40 b(off_DTLB)h(:)f(public)g(off_AbsResUnit)j({)598
4361 y(public:)676 4543 y(//)d(Returns)h(a)e(pointer)i(to)f(the)g
(address)g(translation)i(allocator.)676 4635 y(virtual)f
(off_AddrTrValAllocator)j(*get_allocator\(void\);)676
4817 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4817 24 4 v 29 w(DTLB)p Fj(.)h Fk(i)598
5000 y Fi(protected:)1885 5255 y Fz(639)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
640 641 bop 676 523 a Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l
(ds)f(of)e Fi(off)p 1755 523 24 4 v 29 w(DTLB)p Fj(.)h
Fk(i)676 614 y Fi(off_mdepDTLB)434 b(d_mdep;)80 b(//)40
b(machine)h(dependent)g(addr)f(translation)i(table.)598
706 y(private:)676 797 y(off_AddrTrValAllocator)i(d_alloc;)d(//)f
(\(remote\))h(AT)f(allocator.)676 888 y Fk(h)p Fj(Other)29
b(private)f(memb)l(ers)h(of)e Fi(off)p 1713 888 V 29
w(DTLB)p Fj(.)h Fk(i)598 1162 y Fi(};)515 1337 y Fk(h)p
Fj(O\013)f(DTLB)g(dep)l(endencies.)i Fk(i)p Fq(\021)598
1428 y Fi(#include)41 b(<klib/AbsResUnit.h>)598 1519
y(#include)g(<dmm/AddrTrAllocator.h>)515 1694 y Fk(h)p
Fi(off)p 667 1694 V 29 w(DTLB::get)p 1047 1694 V 30 w(allocator)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 1785 y Fi(//)39
b(Returns)i(a)f(pointer)h(to)e(the)h(address)h(translation)h
(allocator.)598 1876 y(off_AddrTrValAllocator)i
(*off_DTLB::get_allocator\(void)q(\))598 1968 y({)676
2059 y(return)d(&d_alloc;)598 2150 y(})639 2383 y Fz(A)28
b Ft(dtlb)g Fz(is)f(created)g(b)n(y)g(supplying)h(a)f(protection)g(and)
g(a)g(domain.)515 2499 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2499 V 29 w(DTLB)p Fj(.)h Fk(i)p Fq(\021)598
2590 y Fi(//)39 b(Creates)i(a)f(DTLB)598 2682 y(off_DTLB\(const)i
(off_Protection)h(&p,)c(const)i(off_prtl_id_t)h(&domain\);)515
2839 y Fk(h)p Fi(off)p 667 2839 V 29 w(DTLB::off)p 1047
2839 V 30 w(DTLB)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
2931 y Fi(//)39 b(Creates)i(a)f(DTLB)598 3022 y
(off_DTLB::off_DTLB\(const)k(off_Protection)f(&p,)d(const)g
(off_prtl_id_t)i(&domain\))f(:)676 3113 y(off_AbsResUnit\(p,domain\),)
676 3205 y(d_mdep\(\(void*\)this\),)676 3296 y Fk(h)p
Fj(Initialize)27 b Fi(DTLB::d)p 1306 3296 V 30 w(alloc)p
Fj(.)h Fk(i)598 3387 y Fi({;})639 3620 y Fz(Remaining)j
Ft(dtlb)e Fz(data)g(is)g(pre-initialized.)42 b(First,)30
b(a)f(zero-argumen)n(t)e(constructor)515 3719 y(p)r(ermits)h
(declaration)e(of)h(uninitialized)h Ft(dtlb)p Fz(s.)515
3852 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3852 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3944 y Fi(//)79 b(Allows)40 b(uninitialized)i(DTLBS)598
4035 y(off_DTLB\(void\);)515 4209 y Fk(h)p Fi(off)p 667
4209 V 29 w(DTLB::off)p 1047 4209 V 30 w(DTLB)28 b Fj(implementation.)g
Fk(i)p Fz(+)o Fq(\021)598 4301 y Fi(//)79 b(Allows)40
b(uninitialized)i(DTLBs.)598 4392 y(off_DTLB::off_DTLB\(void\))i(:)676
4483 y(off_AbsResUnit\(off_Protectio)q(n\(\),)i(OFF_PRTL_NULL,)1265
4575 y(OFF_DTLB_NULL,)c(OFF_MAGIC_DTLB,)h(NULL\),)676
4666 y(d_alloc\(d_mdep\))598 4757 y({;})1885 5255 y Fz(640)p
eop
PStoPSsaved restore
%%Page: (642,643) 322
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
641 642 bop 639 523 a Fz(Later,)32 b(another)e(constructor)f(is)j(used)
f(to)g(pre-initialize)f(those)h Ft(dtlb)g Fz(\014elds)g(whic)n(h)515
623 y(are)26 b(unlik)n(ely)i(to)f(c)n(hange.)515 739
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 739 24 4 v 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
830 y Fi(//)39 b(Pre-initializes)k(a)d(DTLB)598 922 y(off_DTLB\(const)i
(off_dtlb_id_t)g(&id,)e(const)h(off_magic_t)h(&m,)d(off_DMM)i(*c\);)515
1079 y Fk(h)p Fi(off)p 667 1079 V 29 w(DTLB::off)p 1047
1079 V 30 w(DTLB)28 b Fj(implementation.)g Fk(i)p Fz(+)o
Fq(\021)598 1171 y Fi(//)39 b(Pre-initializes)k(a)d(DTLB.)598
1262 y(off_DTLB::off_DTLB\(const)k(off_dtlb_id_t)f(&id,)d(const)g
(off_magic_t)i(&m,)e(off_DMM)h(*c\):)676 1353 y
(off_AbsResUnit\(id,m,\(off_Abs)q(CompR)q(esou)q(rce*)q(\)c\),)676
1445 y Fk(h)p Fj(Initialize)27 b Fi(DTLB::d)p 1306 1445
V 30 w(alloc)p Fj(.)h Fk(i)598 1536 y Fi({;})515 1802
y Fk(h)p Fj(O\013)f(DTLB)g(dep)l(endencies.)i Fk(i)p
Fz(+)p Fq(\021)598 1893 y Fi(class)40 b(off_DMM;)639
2034 y Fz(Where)28 b(the)g(magic)f(n)n(um)n(b)r(er)g(has)g(to)g(b)r(e)h
(de\014ned.)515 2150 y Fk(h)p Fj(O\013)f(magic)g(numb)l(ers.)i
Fk(i)p Fz(+)o Fq(\021)598 2242 y Fi(OFF_MAGIC_DTLB,)42
b(//)e(DTLB)g(magic)h(nb.)639 2366 y Fz(W)-7 b(e)28 b(can)f(no)n(w)g
(add)h(another)e(case)h(to)h(the)g(implemen)n(tation)f(of)h
Fx(Magic::nameof)p Fz(.)515 2482 y Fk(h)p Fi(off)p 667
2482 V 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e Fi(m)p
1559 2482 V 29 w(number)p Fj(s.)h Fk(i)p Fz(+)p Fq(\021)598
2574 y Fi(case)40 b(OFF_MAGIC_DTLB:)676 2665 y(return)h("off_DTLB";)639
2790 y Ft(dtlb)28 b Fz(users)e(can)i(c)n(hec)n(k)e(their)i(references)e
(to)i(pro)r(cessors)d(using)i(this)h(metho)r(d.)515 2906
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2906 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2997 y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(DTLB?)598
3088 y(inline)h(boolean_t)i(valid\(void\))f(const;)515
3246 y Fk(h)p Fi(off)p 667 3246 V 29 w(DTLB::valid)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 3337 y Fi(//)39
b(Does)i(this)f(look)g(like)g(a)f(DTLB?)598 3429 y(inline)h(boolean_t)i
(off_DTLB::valid\(void\))i(const)598 3520 y({)39 b(return)i
(get_magic\(\))h(==)d(OFF_MAGIC_DTLB;)k(})1885 5255 y
Fz(641)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
642 643 bop 515 523 a Fn(5.3.3)112 b(Address)38 b(translations)515
676 y Fz(An)24 b(address)f(translation)f(\(A)-7 b(T\))25
b(is)f(a)f(map)h(from)f(a)h(virtual)f(page)g(to)g(an)h(address)f
(transla-)515 776 y(tion)28 b(v)-5 b(alue)28 b(\()p Fx(AddrTrVal)p
Fz(\).)35 b(Suc)n(h)28 b(translation)f(v)-5 b(alue)28
b(includes)g(information)g(ab)r(out)g(the)515 876 y(target)34
b(page)h(frame)h(as)f(w)n(ell)g(as)g(the)h(translation)e(protection.)61
b(Remote)36 b(translations)515 975 y(will)27 b(lead)g(to)g(in)n(tensiv)
n(e)g(use)g(of)g(the)h(k)n(ernel)e(relo)r(cation)g(table)h(to)h(use)f
(lo)r(cal)f(page)h(frames)515 1075 y(as)g(cac)n(he)f(for)h(remote)g
(ones.)515 1208 y Fk(h)p Fj(O\013)g(addr)l(ess)i(tr)l(anslation.)g
Fk(i)p Fq(\021)598 1299 y Fi(class)40 b(off_AddrTr)81
b({)598 1390 y(public:)676 1482 y(inline)41 b(vm_offset_t)h
(get_va\(void\))f(;)676 1573 y(inline)g(const)f(off_pg_id_t)i
(&get_pa\(void\))g(;)676 1664 y(inline)f(vm_offset_t)h(get_ma\(void\))f
(;)676 1756 y(inline)g(off_mod_t)120 b(get_mod\(void\);)676
1847 y(inline)41 b(off_AddrTrVal)h(get_val\(void\);)676
2030 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2030 24 4 v 29 w(AddrTr)p Fj(.)i Fk(i)598
2212 y Fi(private:)676 2304 y(vm_offset_t)120 b(a_va;)433
b(//)40 b(Virtual)h(address)676 2395 y(off_AddrTrVal)h(a_dst;)394
b(//)40 b(Translation)h(target.)598 2486 y(};)515 2752
y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h(dep)l(endencies.)f
Fk(i)p Fq(\021)598 2843 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(vm_offset_t)h(et)f(al.)515 3018 y Fk(h)p
Fi(off)p 667 3018 V 29 w(AddrTr::get)p 1125 3018 V 30
w(va)28 b Fj(implementation.)g Fk(i)p Fq(\021)598 3109
y Fi(inline)40 b(vm_offset_t)i(off_AddrTr::get_va\(void\))84
b({)39 b(return)i(a_va;)f(})515 3283 y Fk(h)p Fi(off)p
667 3283 V 29 w(AddrTr::get)p 1125 3283 V 30 w(pa)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 3374 y Fi(inline)40
b(const)h(off_pg_id_t)g(&off_AddrTr::get_pa\(void\))85
b({)39 b(return)i(a_dst.get_pa\(\);)h(})598 3466 y(inline)e
(vm_offset_t)i(off_AddrTr::get_ma\(void\))84 b({)39 b(return)i
(a_dst.get_ma\(\);)i(})515 3640 y Fk(h)p Fi(off)p 667
3640 V 29 w(AddrTr::get)p 1125 3640 V 30 w(mod)28 b Fj(implementation.)
g Fk(i)p Fq(\021)598 3731 y Fi(inline)40 b(off_mod_t)120
b(off_AddrTr::get_mod\(void\))45 b({)39 b(return)i(a_dst.get_mod\(\);)i
(})515 3906 y Fk(h)p Fi(off)p 667 3906 V 29 w(AddrTr::get)p
1125 3906 V 30 w(val)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 3997 y Fi(inline)40 b(off_AddrTrVal)j
(off_AddrTr::get_val\(void\))h({)676 4088 y(return)d
(off_AddrTrVal\(get_pa\(\),get_mod)q(\(\)\);)598 4180
y(})639 4321 y Fz(An)28 b(A)-7 b(T)28 b(can)g(b)r(e)g(also)e(used)i(to)
f(mean)g(the)h(virtual)f(address)g(it)h(is)f(translating.)515
4437 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4437 V 29 w(AddrTr)p Fj(.)h Fk(i)p Fq(\021)598 4529
y Fi(inline)40 b(operator)h(vm_offset_t\(void\))i(const;)515
4686 y Fk(h)p Fi(off)p 667 4686 V 29 w(AddrTr::operator)f(vm)p
1440 4686 V 29 w(offset)p 1703 4686 V 30 w(t)27 b Fj(implementation.)h
Fk(i)p Fq(\021)598 4778 y Fi(inline)40 b(off_AddrTr::operator)k
(vm_offset_t\(void\))f(const)e({)e(return)i(a_va;)f(})1885
5255 y Fz(642)p eop
PStoPSsaved restore
%%Page: (644,645) 323
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
643 644 bop 639 523 a Fz(Usually)-7 b(,)28 b(translations)e(are)g
(built)j(b)n(y)e(supplying)g(the)h(source)f(and)g(target)g(addresses)
515 623 y(with)h(an)f(optional)g(mo)r(de)g(parameter)g(gran)n(ting)f
(read)g(and)i(write)f(access)f(for)h(the)h(trans-)515
722 y(lation.)515 837 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 837 24 4 v 29 w(AddrTr)p Fj(.)h Fk(i)p
Fz(+)p Fq(\021)598 928 y Fi(//)39 b(Creates)i(an)f(address)h
(translation.)598 1020 y(off_AddrTr\(vm_offset_t)j(va,)c(const)g
(off_pg_id_t)i(&pa,)1029 1111 y(off_mod_t)g
(mod=OFF_MOD_RW|OFF_MOD_V\);)515 1264 y Fk(h)p Fi(off)p
667 1264 V 29 w(AddrTr::off)p 1125 1264 V 30 w(AddrTr)29
b Fj(implementation.)f Fk(i)o Fq(\021)598 1356 y Fi(//)39
b(Creates)i(an)f(address)h(translation.)598 1447 y
(off_AddrTr::off_AddrTr\(vm_offs)q(et_t)46 b(va,)40 b(const)g
(off_pg_id_t)i(&pa,)e(off_mod_t)h(mod\))f(:)676 1538
y(a_va\(va\),)h(a_dst\(pa,mod\))598 1629 y({;})639 1859
y Fz(A)29 b(\(ma)n(yb)r(e)g(remote\))f(translation)f(target)h
(includes,)h(as)e(said,)i(the)g(ph)n(ysical)e(address)515
1959 y(and)f(the)h(protection)f(\(mo)r(de\))h(bits)g(\(whic)n(h)g(are)f
(t)n(ypically)g(co)r(di\014ed)g(inside)h(the)g(ph)n(ysical)515
2058 y(address\).)515 2188 y Fk(h)p Fj(O\013)g(addr)l(ess)i(tr)l
(anslation)h(value.)d Fk(i)p Fq(\021)598 2279 y Fi(class)40
b(off_AddrTrVal)i({)598 2371 y(private:)676 2462 y(off_pg_id_t)g(a_pa;)
511 b(//)40 b(Physical)h(address)676 2553 y(off_mod_t)120
b(a_mod;)472 b(//)40 b(mode)g(bits.)598 2736 y(public:)676
2827 y(//)g(Creates)h(an)e(uninitialized)k(translation)e(value.)676
2919 y(off_AddrTrVal\(void\))j({;})676 3010 y(//)c(Creates)h(a)e
(translation)j(target.)676 3101 y(off_AddrTrVal\(const)i(off_pg_id_t)d
(&pa,)g(off_mod_t)g(mod\))f(:)755 3193 y(a_pa\(pa\),)h(a_mod\(mod\))676
3284 y({;})676 3558 y(//)f(Returns)h(the)f(page)g(identifier,)h
(address)g(and)f(mode.)676 3649 y(inline)h(const)f(off_pg_id_t)i
(&get_pa\(void\))g(const)e({)g(return)g(a_pa;)h(})676
3741 y(inline)g(vm_offset_t)h(get_ma\(void\))f(const)g({)e(return)i
(a_pa.i_offset;)h(})676 3832 y(inline)f(off_mod_t)120
b(get_mod\(void\))42 b(const)e({return)h(a_mod;)80 b(})676
4014 y(//)40 b(Set)g(the)g(page)g(identifier)h(and)f(mode.)676
4106 y(inline)h(void)f(set_pa\(const)i(off_pg_id_t)g(&pa\))e({)f
(a_pa=pa;)i(})676 4197 y(inline)g(void)f(set_ma\(vm_offset_t)j(ma\))d
({)g(a_pa.i_offset=ma;)j(})676 4288 y(inline)e(void)f
(set_mod\(off_mod_t)j(mod\))79 b({a_mod=mod;)i(})598
4471 y(};)639 4701 y Fz(Mo)r(de)30 b(bits)g(are)e(de\014ned)j(in)e(a)h
(mac)n(hine)f(dep)r(enden)n(t)h(w)n(a)n(y)f(so)g(that)g(they)h(matc)n
(h)g(the)515 4800 y(enco)r(ding)d(used)h(b)n(y)f(the)h(hardw)n(are.)515
4915 y Fk(h)p Fj(O\013)f(addr)l(ess)i(tr)l(anslation)h(mo)l(de)e(bits.)
f Fk(i)p Fq(\021)598 5006 y Fi(typedef)41 b(off_mdep_mod_t)h
(off_mod_t;)1885 5255 y Fz(643)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
644 645 bop 515 523 a Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)
h(dep)l(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 614 y
Fi(#include)41 b(<dmm/mdep/mAddrTr.h>)122 b(//)40 b(for)g
(off_mdep_mod_t)598 706 y(#include)h(<klib/ids.h>)434
b(//)40 b(for)g(off_pg_id_t)h(et)f(al.)515 980 y Fn(5.3.4)112
b(dtlb)37 b(allo)s(cation)515 1133 y Fz(Ph)n(ysical)i(names)h(for)g
Ft(dtlb)p Fz(s)g(ma)n(y)g(b)r(e)h(either)f(a)g(page)g(table)g(address)g
(or)f(a)h(con)n(text)515 1232 y(iden)n(ti\014er)23 b(dep)r(ending)h(on)
f(the)h(arc)n(hitecture)e(used.)36 b(Storage)22 b(for)h
Ft(dtlb)p Fz(s)g(page)f(tables)i(\(or)515 1332 y(TLB)g(en)n(tries)949
1302 y Fp(8)985 1332 y Fz(\))h(is)f(supplied)g(b)n(y)g(the)h
(application)e(itself)i(\(whic)n(h)f(retains)f(read)h(access)f(for)515
1432 y(those)k(pages\).)639 1531 y(A)h Ft(dtlb)g Fz(allo)r(cator)d(is)j
(a)f(blo)r(c)n(k)g(allo)r(cator)f(instan)n(tiated)h(to)h(main)n(tain)f
Ft(dtlb)p Fz(s.)515 1648 y Fk(h)p Fj(O\013)g(DTLB)g(al)t(lo)l(c)l
(ator.)h Fk(i)p Fq(\021)598 1739 y Fi(//)39 b(A)h(DTLB)g(allocator.)598
1830 y(//)598 1922 y(class)g(off_DTLBAllocator)j(:)d(public)g
(off_TBlockAllocator<off_LDTL)q(B>)45 b({)598 2013 y(public:)676
2104 y(//)40 b(Allows)g(declarations)i(of)e(uninitialized)i(DTLB)e
(allocators)676 2196 y(off_DTLBAllocator\(void\){;})676
2378 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2378 24 4 v 29 w(DTLBAllocator)p Fj(.)j
Fk(i)598 2470 y Fi(private:)676 2561 y Fk(h)p Fj(Other)f(private)f
(memb)l(ers)h(of)e Fi(off)p 1713 2561 V 29 w(DTLBAllocator)p
Fj(.)j Fk(i)598 2652 y Fi(};)639 2868 y Fz(As)i(the)h(blo)r(c)n(k)e
(allo)r(cator)f(uses)i(a)f(lik)n(ed)h(free-list,)g(the)h(arra)n(y)c(no)
r(des)j(m)n(ust)g(sub)r(class)515 2968 y Fx(DLinkedNode)p
Fz(.)515 3100 y Fk(h)p Fj(O\013)27 b(linkable)g(DTLB.)g
Fk(i)p Fq(\021)598 3192 y Fi(//)39 b(A)h(linkable)h(off_DTLB.)598
3283 y(//)598 3374 y(class)f(off_LDTLB)h(:)f(public)g(DLinkedNode)i({)
598 3466 y(public:)676 3557 y(off_DTLB)f(l_dtlb;)551
b(//)40 b(The)g(DTLB)676 3740 y(//)g(To)g(allow)g(uninitilized)i
(LDTLBs.)676 3831 y(off_LDTLB\(void\))h({;})676 4014
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 4014 V 29 w(LDTLB)p Fj(.)h Fk(i)598 4105 y Fi(};)515
4371 y Fk(h)p Fj(O\013)f(DTLB)g(al)t(lo)l(c)l(ator)i(dep)l(endencies.)g
Fk(i)p Fq(\021)598 4462 y Fi(#include)41 b(<klib/BlockAllocator.h>)j
(//)c(for)g(off_TBlockAllocator)598 4553 y(#include)h(<dmm/DTLB.h>)395
b(//)39 b(for)h(off_DTLB)p 515 4929 1146 4 v 607 4983
a Fm(8)642 5006 y Fl(Suc)n(h)24 b(as)g(in)f(the)i(MIPS,)e(whic)n(h)h
(only)g(pro)n(vides)g(a)g(tagged)h(TLB.)1885 5255 y Fz(644)p
eop
PStoPSsaved restore
%%Page: (646,647) 324
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
645 646 bop 639 523 a Fz(An)25 b(indexer)f(is)g(main)n(tained)g(b)n(y)g
(the)h(allo)r(cator.)34 b(Besides,)24 b(a)g(k)n(ernel)f(virtual)h
(memory)515 623 y(region)i(is)i(pro)n(vided)e(b)n(y)h(the)h(creator.)
515 751 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 751 24 4 v 29 w(DTLBAllocator)p Fj(.)i
Fk(i)o Fq(\021)598 842 y Fi(static)40 b(off_Indexer<off_LDTLB>)45
b(d_idx;)515 1007 y Fk(h)p Fj(O\013)27 b(DTLB)g(al)t(lo)l(c)l(ator)i
(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 1098 y Fi
(off_Indexer<off_LDTLB>)44 b(off_DTLBAllocator::d_idx;)639
1235 y Fz(The)28 b(allo)r(cator)e(is)h(initialized)h(as)f(follo)n(ws.)
515 1349 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1349 V 29 w(DTLBAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 1440 y Fi(//)39 b(Creates)i(a)f(DTLB)g(allocator.)598
1531 y(off_DTLBAllocator\(off_Exhauste)q(d)45 b(*r,)40
b(off_KVMRegion)i(*reg\);)639 1653 y Fz(The)29 b(region)f(is)g(used)h
(to)g(pro)n(vide)e(memory)h(for)h(the)g(\(gro)n(wing\))e(arra)n(y)g(of)
35 b Ft(dtlb)p Fz(s.)40 b(A)515 1753 y(p)r(oin)n(ter)27
b(to)h(the)h(start)e(of)i(suc)n(h)e(arra)n(y)f(is)i(k)n(ept)g(inside)g
(the)h Ft(dtlb)f Fz(allo)r(cator)e(so)i(w)n(e)f(could)515
1853 y(rede\014ne)g(the)h Fx(operator)40 b(+)p Fz(.)515
1981 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 1981 V 29 w(DTLBAllocator)p Fj(.)i Fk(i)o
Fz(+)p Fq(\021)598 2072 y Fi(off_LDTLB)41 b(*d_dtlbs;)515
2237 y Fk(h)p Fi(off)p 667 2237 V 29 w(DTLBAllocator::off)p
1398 2237 V 32 w(DTLBAllocator)30 b Fj(implementation.)e
Fk(i)p Fq(\021)598 2328 y Fi(//)39 b(Creates)i(a)f(DTLB)g(allocator.)
598 2419 y(off_DTLBAllocator::off_DTLBAll)q(ocato)q(r\(of)q(f_Ex)q
(haust)q(ed)45 b(*r,)40 b(off_KVMRegion)i(*reg\))f(:)676
2511 y(off_TBlockAllocator<off_LDTL)q(B>\(r,)q(\(con)q(st)k
(off_Indexable*\)&d_idx,reg\),)676 2602 y
(d_dtlbs\(\(off_LDTLB*\)reg->get)q(_star)q(t\(\)\))598
2693 y({;})515 2858 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2858 V 29 w(DTLBAllocator)p Fj(.)j Fk(i)p
Fz(+)o Fq(\021)598 2950 y Fi(inline)40 b(off_LDTLB)i(*operator)f
(+\(vm_offset_t)h(at\);)515 3115 y Fk(h)p Fi(off)p 667
3115 V 29 w(DTLBAllocator::operator+)32 b Fj(implementation.)c
Fk(i)p Fq(\021)598 3206 y Fi(inline)40 b(off_LDTLB)i
(*off_DTLBAllocator::operator)j(+\(vm_offset_t)d(at\))598
3297 y({)676 3388 y(return)f(d_dtlbs+at;)598 3480 y(})639
3708 y Fz(The)33 b(allo)r(cator)e(m)n(ust)i(b)r(e)g(initialized)g(when)
g(the)g Ft(dmm)g Fz(is)g(started,)g(not)g(when)g(it)g(is)515
3807 y(instan)n(tiated)22 b(as)h(there)f(migh)n(t)h(b)r(e)h(no)e(KVM)h
(b)n(y)g(that)g(time.)36 b(The)23 b(rev)n(o)r(cator)d(is)j(the)g
Ft(dmm)515 3907 y Fz(itself,)g(as)e(set)g(at)h(construction)f(time;)j
(the)e(region)e(is)h(also)g(created)f(at)i(construction)f(time.)515
4006 y(The)27 b(\014rst)h Ft(dtlb)f Fz(is)h(not)f(used.)515
4134 y Fk(h)p Fj(Initialize)f Fi(DMM::d)p 1105 4134 V
30 w(alloc)p Fj(.)i Fk(i)p Fq(\021)598 4226 y Fi(new\(&d_alloc\))81
b(off_DTLBAllocator\(\(off_Exhau)q(sted*)q(\)thi)q(s,)1892
4317 y(kvm.create_region\("dtlb"\)\);)598 4408 y(\(void\)new)41
b(off_DTLB\(nd.get_protection\(\),)q(nd.g)q(et_do)q(main)q(\(\)\);)515
4573 y Fk(h)p Fj(O\013)27 b(DMM)g(implementation)h(dep)l(endencies.)h
Fk(i)p Fq(\021)598 4665 y Fi(#include)41 b(<dmm/KVM.h>)473
b(//)40 b(for)g(kvm)639 4801 y Fz(Where)28 b(w)n(e)f(used)h(the)f
Fx(new)g Fz(op)r(erator)f(tric)n(k.)515 4915 y Fk(h)p
Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p 1493 4915
V 29 w(DTLBAllocator)p Fj(.)j Fk(i)p Fz(+)o Fq(\021)598
5006 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_DTLBAllocator)k
(*a\))d({)g(\(void\)s;)h(return)f(a;)g(})1885 5255 y
Fz(645)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
646 647 bop 639 523 a Fz(The)31 b Fx(notify)d Fz(metho)r(d)i(m)n(ust)h
(th)n(us)f(b)r(e)h(pro)n(vided)e(b)n(y)i Ft(dmm)p Fz(s)f(to)g(implemen)
n(t)h(the)g(re-)515 623 y(source)d(rev)n(o)r(cator)g(signature.)42
b(Ho)n(w)n(ev)n(er,)29 b(suc)n(h)g(ev)n(en)n(ts)g(are)g(silen)n(tly)h
(discarded)f(in)h(this)515 722 y(implemen)n(tation.)515
839 y Fk(h)p Fj(Other)e(public)g(metho)l(ds)h(of)e Fi(off)p
1493 839 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
930 y Fi(//)39 b(Notifies)i(that)g(DTLBs)f(are)g(exhausted.)598
1021 y(void)g(notify\(void\);)639 1146 y Fz(Once)27 b(the)h(allo)r
(cator)e(has)h(b)r(een)i(initialized,)e(the)h(DMM)h(can)e(b)r(e)h
(indexed)g(to)f(obtain)515 1245 y(references)f(to)i Ft(dtlb)p
Fz(s;)f(they)h(can)f(b)r(e)h(allo)r(cated)f(and)g(deallo)r(cated.)515
1378 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1378 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
1469 y Fi(//)39 b(Allocates)j(a)d(DTLB.)598 1561 y(off_DTLB)i
(*alloc\(const)h(off_dtlb_id_t)g(&at,)e(boolean_t)h
(use_revocation=FALSE\);)598 1652 y(//)e(Allocates)j(any)e(DTLB.)598
1743 y(off_DTLB)h(*alloc\(boolean_t)i(use_revocation=FALSE\);)598
1835 y(//)c(Deallocates)j(a)e(DTLB)598 1926 y(void)g(free\()g(const)h
(off_DTLB)g(*s)e(\);)639 2159 y Fz(An)n(y)29 b Ft(dtlb)e
Fz(with)h(o\013set)g Fx(0)f Fz(is)h(considered)e(to)i(b)r(e)g(the)g(k)n
(ernel)e Ft(dtlb)p Fz(.)515 2291 y Fk(h)p Fi(off)p 667
2291 V 29 w(DMM::operator+)k Fj(implementation.)e Fk(i)o
Fq(\021)598 2383 y Fi(//Gets)40 b(a)g(DTLB)g(from)g(its)g(distributed)i
(or)d(physical)i(address)598 2474 y(inline)f(off_DTLB)h
(*off_DMM::operator+\(vm_offs)q(et_t)46 b(d\))598 2565
y({)676 2657 y(assert\(valid\(\)\);)676 2748 y(if)40
b(\(!d\))755 2839 y(return)g(&d_kdtlb;)676 2931 y(else)755
3022 y(return)g(&\(d_alloc+d\)->l_dtlb;)598 3113 y(})1885
5255 y Fz(646)p eop
PStoPSsaved restore
%%Page: (648,649) 325
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
647 648 bop 639 523 a Ft(dtlb)p Fz(s)27 b(are)g(preinitialized)g(when)h
(they)g(are)f(allo)r(cated.)515 656 y Fk(h)p Fi(off)p
667 656 24 4 v 29 w(DMM::alloc)i Fj(and)f Fi(free)h Fj(implementation.)
e Fk(i)p Fq(\021)598 747 y Fi(//)39 b(Allocates)j(a)d(DTLB.)598
839 y(off_DTLB)i(*off_DMM::alloc\(const)j(off_dtlb_id_t)e(&at,)e
(boolean_t)h(use_revocation\))598 930 y({)676 1021 y(off_LDTLB)g(*ld;)
676 1112 y(assert\(valid\(\)\);)676 1204 y(w_lock\(\);)676
1295 y(ld=d_alloc.allocate\(at,use_r)q(evoca)q(tion)q(\);)676
1386 y(w_unlock\(\);)676 1478 y(if)f(\(ld\))g({)755 1569
y(\(void\))g(new\(ld\))h(off_LDTLB\(at,this\);)676 1660
y(})676 1752 y(return)g(\(ld\)?\(&ld->l_dtlb\):\(off_DTLB*\))q(NULL)q
(;)598 1843 y(})598 2026 y(//)e(Allocates)j(a)d(DTLB.)598
2117 y(off_DTLB)i(*off_DMM::alloc\(boolean_t)k(use_revocation\))598
2208 y({)676 2300 y(off_LDTLB)c(*ld;)676 2391 y(assert\(valid\(\)\);)
676 2482 y(w_lock\(\);)676 2574 y(ld=d_alloc.allocate\(use_revo)q
(catio)q(n\);)676 2665 y(w_unlock\(\);)676 2756 y(if)f(\(ld\))g({)755
2848 y(off_dtlb_id_t)i(did\(get_id\(\),d_alloc.pos\(ld\)\);)755
2939 y(\(void\))e(new\(ld\))h(off_LDTLB\(did,this\);)676
3030 y(})676 3122 y(return)g(\(ld\)?\(&ld->l_dtlb\):\(off_DTLB*\))q
(NULL)q(;)598 3213 y(})598 3396 y(//)e(Deallocates)j(an)e(DTLB)598
3487 y(void)g(off_DMM::free\()i(const)f(off_DTLB)g(*d)e(\))598
3578 y({)676 3670 y(off_LDTLB)i(*ld=\(off_LDTLB*\)\(\(\(char*\)d\))q
(-\(in)q(t\)&of)q(f_LD)q(TLB::)q(l_dt)q(lb\);)676 3761
y(assert\(valid\(\)\);)676 3852 y(w_lock\(\);)676 3944
y(d_alloc.deallocate\(ld\);)676 4035 y(w_unlock\(\);)598
4126 y(})515 4392 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 4483 y Fi(#include)41 b(<assert.h>)512
b(//)40 b(for)g(assert)639 4624 y Ft(dtlb)g Fz(preinitialization)g
(uses)f(a)h Fx(new)f Fz(op)r(erator)f(for)i Fx(LDTLB)e
Fz(returning)h(its)i(single)515 4724 y(argumen)n(t.)515
4840 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4840 V 29 w(LDTLB)p Fj(.)h Fk(i)p Fq(\021)598
4932 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(off_LDTLB)j(*p\))e
({)f(\(void\)s;)i(return)g(\(void*\))f(p;)g(})1885 5255
y Fz(647)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
648 649 bop 639 523 a Fz(A)28 b(preinitialization)f(constructor)f(for)h
Fx(LDTLB)p Fz(s)f(is)h(also)g(used.)515 639 y Fk(h)p
Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p 1493 639
24 4 v 29 w(LDTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
731 y Fi(off_LDTLB\(const)42 b(off_dtlb_id_t)h(&id,)d(off_DMM)h(*dmm\))
f(:)676 822 y(l_dtlb\(id,OFF_MAGIC_DTLB,dmm)q(\))598
913 y({;})639 1038 y Ft(dtlb)p Fz(s)32 b(are)g(allo)r(cated)f(and)i
(deallo)r(cated)e(with)i Fx(new)e Fz(and)i Fx(delete)d
Fz(op)r(erators.)49 b(The)515 1137 y(op)r(erator)26 b
Fx(new)g Fz(uses)h(the)h Ft(dmm)g Fx(alloc)d Fz(metho)r(d.)515
1270 y Fk(h)p Fj(Other)j(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1270 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1362 y Fi(void)40 b(*operator)h(new\(size_t)h(s,)d(const)i
(off_dtlb_id_t)h(&at,)1343 1453 y(boolean_t)f(use_revocation=FALSE\);)
598 1544 y(void)f(*operator)h(new\(size_t)h(s,)d(boolean_t)j
(use_revocation=FALSE\);)598 1636 y(void)e(operator)h(delete\(void)h
(*p\);)515 1810 y Fk(h)p Fi(off)p 667 1810 V 29 w(DTLB::operator)g(new)
28 b Fj(implementation.)g Fk(i)o Fq(\021)598 1901 y Fi(void)40
b(*off_DTLB::operator)j(new\(size_t)f(s,)e(boolean_t)h
(use_revocation=FALSE\))598 1993 y({)676 2084 y(off_DTLB)g
(*dtlb=nd.get_dmm\(\).alloc\(use)q(_rev)q(ocati)q(on\);)676
2175 y(\(void\)s;)676 2267 y(assert\(s)g(&&)f
(nd.get_dmm\(\).valid\(\)\);)676 2358 y(assert\(!dtlb)i(||)e
(dtlb->valid\(\)\);)676 2449 y(return)h(\(void*\)dtlb;)598
2540 y(})598 2632 y(void)f(*off_DTLB::operator)j(new\(size_t)f(s,)e
(const)g(off_dtlb_id_t)i(&at,)1735 2723 y(boolean_t)g
(use_revocation=FALSE\))598 2814 y({)676 2906 y(off_DTLB)f
(*dtlb=nd.get_dmm\(\).alloc\(at,)q(use_)q(revoc)q(atio)q(n\);)676
2997 y(\(void\)s;)676 3088 y(assert\(s)g(&&)f
(nd.get_dmm\(\).valid\(\)\);)676 3180 y(assert\(!dtlb)i(||)e
(dtlb->valid\(\)\);)676 3271 y(return)h(\(void*\)dtlb;)598
3362 y(})515 3628 y Fk(h)p Fi(off)p 667 3628 V 29 w(DTLB::operator)h
(delete)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
3719 y Fi(//)39 b(Deallocates)j(this)e(DTLB)598 3811
y(void)g(off_DTLB::operator)j(delete\(void)f(*p\))598
3902 y({)676 3993 y(off_DTLB)f(*dtlb=\(off_DTLB*\)p;)676
4085 y(assert\(dtlb)h(&&)e(dtlb->valid\(\)\);)676 4176
y(nd.get_dmm\(\).free\(dtlb\);)598 4267 y(})515 4533
y Fk(h)p Fj(O\013)27 b(DTLB)g(implementation)h(dep)l(endencies.)h
Fk(i)p Fq(\021)598 4624 y Fi(#include)41 b(<node/Node.h>)395
b(//)40 b(for)g(nd)1885 5255 y Fz(648)p eop
PStoPSsaved restore
%%Page: (650,651) 326
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
649 650 bop 515 523 a Fn(5.3.5)112 b(dtlb)37 b(rev)m(o)s(cation)515
676 y Fz(Eac)n(h)e(dmm)h(deliv)n(ers)f(rev)n(o)r(cation)g(ev)n(en)n(ts)
g(to)h(its)g(exception)g(p)r(ortal)g(or)f Fx(r)p 2961
676 27 4 v 31 w(domain)p Fz(,)h(in)515 776 y(case)27
b(that)i(p)r(ortal)e(has)h(b)r(een)g(set.)39 b(The)28
b(o)n(wner)f(of)i(that)f(p)r(ortal)g(is)g(the)g(referee)g(for)f
Ft(dtlb)515 876 y Fz(rev)n(o)r(cation)f(inside)h(the)h
Ft(dmm)p Fz(.)515 998 y Fk(h)p Fi(off)p 667 998 24 4
v 29 w(DMM::notify)h Fj(implementation.)f Fk(i)p Fq(\021)598
1089 y Fi(//)39 b(Notifies)i(that)g(DTLBs)f(are)g(exhausted.)598
1180 y(void)g(off_DMM::notify\(void\))598 1272 y({)676
1363 y(assert\(valid\(\)\);)676 1454 y(if)g
(\(get_domain\(\)==OFF_PRTL_NULL\))755 1546 y(return;)676
1637 y(else)g({)755 1728 y(;)598 1820 y(#if)g(0)1059
b(//)40 b(XXX)g(fix)g(this)755 1911 y(off_ExhaustReq)i
(m\(OFF_MAGIC_DMM,get_id\(\)\);)755 2002 y
(prtl.kpct\(get_domain\(\),off_Shtl)q(::se)q(lf\(\))q(,size)q(of\(m)q
(\),0,&)q(m,NU)q(LL,0)q(\);)598 2094 y(#endif)676 2185
y(})598 2276 y(})515 2521 y Fk(h)p Fj(O\013)27 b(DMM)g(implementation)h
(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2612 y
Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_ExhaustReq)598
2704 y(#include)h(<prtl/PrtlSrv.h>)278 b(//)40 b(for)g(prtl.)598
2795 y(#include)h(<hw/Processor.h>)278 b(//)40 b(for)g(Processor)h(and)
f(self.)515 3054 y Fn(5.3.6)112 b(Address)38 b(translation)e(allo)s
(cation)515 3207 y Fz(Allo)r(cation)23 b(for)g(A)-7 b(Ts)23
b(is)g(a)g(little)i(bit)f(sp)r(ecial.)35 b(On)23 b(arc)n(hitectures)f
(with)i(page)e(tables)h(most)515 3307 y(of)k(the)i(translations)d(can)h
(b)r(e)h(k)n(ept)g(in)g(the)g(mac)n(hine)f(dep)r(enden)n(t)i(data)e
(structures;)g(th)n(us)515 3406 y(w)n(e)h(do)h(not)g(store)f(them)i(t)n
(wice.)41 b(Therefore,)28 b(only)g(remote)h(translations)e(need)j
(space)e(in)515 3506 y(the)35 b(address)f(translation)f(allo)r(cator.)
57 b(When)35 b(no)g(hardw)n(are)e(page)h(table)g(is)h(used,)i(the)515
3605 y(mac)n(hine)27 b(dep)r(enden)n(t)h Ft(dtlb)g Fz(should)f(still)h
(handle)f(ev)n(ery)g(lo)r(cal)g(translation.)515 3728
y Fk(h)p Fj(O\013)g(addr)l(ess)i(tr)l(anslation)h(al)t(lo)l(c)l(ator.)e
Fk(i)p Fq(\021)598 3819 y Fi(//)39 b(An)h(address)h(translation)h
(value)e(allocator.)598 3910 y(//)f(\(Relies)i(heavily)g(on)f(the)g
(mdep)g(translation)i(allocator\).)598 4002 y(//)598
4093 y(class)e(off_AddrTrValAllocator)k(:)c(public)g(off_BKAllocator)j
({)598 4184 y(public:)676 4367 y Fk(h)p Fj(Other)29 b(public)e(metho)l
(ds)i(of)e Fi(off)p 1654 4367 V 29 w(AddrTrValAllocator)p
Fj(.)k Fk(i)598 4458 y Fi(protected:)598 4641 y(private:)676
4732 y(off_mdepDTLB)827 b(&a_lalloc;)41 b(//)f(Local)g(address)h
(translations.)676 4824 y(static)g(off_RemAddrTrValAllocator)84
b(a_ralloc;)41 b(//)f(Remote)g(address)h(translations.)598
4915 y(};)1885 5255 y Fz(649)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
650 651 bop 515 523 a Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)
h(al)t(lo)l(c)l(ator)e(dep)l(endencies.)h Fk(i)p Fq(\021)598
614 y Fi(#include)41 b(<dmm/mdep/mDTLB.h>)200 b(//)40
b(for)g(off_mdepDTLB)515 789 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l
(anslation)h(al)t(lo)l(c)l(ator)e(static)h(memb)l(ers.)f
Fk(i)p Fq(\021)598 880 y Fi(off_RemAddrTrValAllocator)84
b(off_AddrTrValAllocator::a_rall)q(oc;)46 b(//)39 b(Remote)i(ATs.)639
1021 y Fz(Hence,)23 b(mac)n(hine)d(indep)r(enden)n(t)i(translation)e
(allo)r(cation)g(is)h(an)f(issue)h(just)g(for)g(remote)515
1121 y(A)-7 b(Ts.)61 b(These)35 b(ones)g(are)g(k)n(ept)g(in)h(a)f
Fx(RemAddrTrAllocat)o(or)p Fz(.)55 b(The)35 b(remote)g(A)-7
b(T)36 b(v)-5 b(alue)515 1220 y(allo)r(cator)26 b(is)h(shared)g(among)f
(existing)j Ft(dtlb)p Fz(s.)639 1320 y(The)f(A)-7 b(T)28
b(allo)r(cator)e(is)h(\014rst)h(initialized)f(when)h
Ft(dtlb)g Fz(are)e(b)r(eing)i(created.)515 1436 y Fk(h)p
Fj(Initialize)e Fi(DTLB::d)p 1144 1436 24 4 v 30 w(alloc)p
Fj(.)i Fk(i)p Fq(\021)598 1528 y Fi(d_alloc\(d_mdep\))515
1685 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1685 V 29 w(AddrTrValAllocator)p Fj(.)k Fk(i)p Fq(\021)598
1777 y Fi(off_AddrTrValAllocator\(off_mde)q(pDTLB)46
b(&mdep\);)515 1951 y Fk(h)p Fi(off)p 667 1951 V 29 w
(AddrTrValAllocator::off)p 1593 1951 V 33 w(AddrTrValAllocator)32
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 2042 y Fi
(off_AddrTrValAllocator::off_Ad)q(drTrV)q(alAl)q(loca)q(tor\(o)q(ff_m)q
(depDT)q(LB)45 b(&mdep\))c(:)676 2134 y(a_lalloc\(mdep\))598
2225 y({)598 2316 y(})639 2549 y Fz(But)28 b(its)g(most)f(imp)r(ortan)n
(t)h(part,)f Fx(ralloc)e Fz(is)i(explicitly)h(started)f(b)n(y)h(the)g
Ft(dmm)p Fz(.)515 2682 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2682 V 29 w(AddrTrValAllocator)p Fj(.)k
Fk(i)p Fz(+)o Fq(\021)598 2773 y Fi(//)39 b(Starts)i(a)e(new)h
(AddrTrValAllocator)598 2864 y(static)g(err_t)h(start\(off_Exhausted)i
(*r,)d(off_KVMRegion)i(*reg\);)515 3039 y Fk(h)p Fi(off)p
667 3039 V 29 w(AddrTrValAllocator::start)33 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 3130 y Fi(//)39 b(Starts)i(a)e(new)h
(AddrTrValAllocator)598 3221 y(err_t)g(off_AddrTrValAllocator::start)q
(\(off)q(_Exh)q(auste)q(d)45 b(*r,)40 b(off_KVMRegion)i(*reg\))598
3313 y({)676 3404 y(new\(&a_ralloc\))h
(off_RemAddrTrValAllocator\(r,reg)q(\);)598 3495 y(})639
3728 y Fz(As)19 b(the)g(allo)r(cator)f(uses)g(virtual)g(memory)-7
b(,)20 b(the)g Ft(dtlb)e Fz(for)g(the)i(k)n(ernel)e(m)n(ust)h(b)r(e)g
(created)515 3827 y(b)r(efore)33 b(the)g(allo)r(cator)f(is)h(started.)
54 b(Once)32 b(it)i(has)f(b)r(een)h(created,)g(w)n(e)f(start)f(the)i
(KVM.)515 3927 y(Thereafter,)24 b(KVM)g(regions)e(created,)i(including)
g(one)g(for)f(remaining)h Ft(dtlb)p Fz(s,)g(could)g(use)515
4027 y(k)n(ernel)i(virtual)h(memory)-7 b(.)515 4159 y
Fk(h)p Fj(Start)29 b(other)g(memb)l(ers)f(of)f Fi(off)p
1467 4159 V 29 w(DMM)h Fj(ac)l(c)l(or)l(ding)i(to)e Fi(mdep)p
Fj(.)g Fk(i)o Fz(+)p Fq(\021)598 4251 y Fk(h)p Fj(Cr)l(e)l(ate)h(the)f
(r)l(o)l(ot)h(dtlb.)f Fk(i)598 4342 y(h)p Fj(Mark)g(DMM)f(as)h(active.)
g Fk(i)598 4433 y Fi(kvm.start\(nd.get_mbank\(nd.get_)q(num_m)q(bank)q
(s\(\)-)q(1\).ge)q(t_ke)q(nd\(\),)q(TRUE)q(\);)598 4525
y(off_AddrTrValAllocator::start\()q(\(off_)q(Exha)q(uste)q(d*\)th)q
(is,k)q(vm.cr)q(eate)q(_reg)q(ion\(")q(rat")q(\)\);)1885
5255 y Fz(650)p eop
PStoPSsaved restore
%%Page: (652,653) 327
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
651 652 bop 639 523 a Fz(The)28 b(address)e(allo)r(cator)g(m)n(ust)i
(rede\014ne)f(t)n(ypical)g(k)n(ernel)g(allo)r(cator)f(metho)r(ds.)515
656 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 656 24 4 v 29 w(AddrTrValAllocator)p Fj(.)k Fk(i)p
Fz(+)o Fq(\021)598 747 y Fi(//)39 b(Allocates)j(an)d(address)i
(translation)h(value.)598 839 y(off_AddrTrValRef)h
(allocate\(vm_offset_t)g(at\);)598 930 y(//)c(Returns)i(a)f(reference)h
(to)f(an)f(address)i(translation)h(value.)598 1021 y(inline)e
(off_AddrTrValRef)j(operator+\(vm_offset_t)h(at\);)598
1112 y(//)39 b(Returns)i(the)f(position)h(of)f(an)g(address)g
(translation)i(value.)598 1204 y(//)d(\(might)i(be)f(expensive!\))598
1295 y(vm_offset_t)238 b(pos\(off_AddrTrValRef)43 b(at\);)598
1386 y(//)c(Deallocates)j(an)e(address)h(translation)g(value.)598
1478 y(void)f(deallocate\(off_AddrTrValRef)45 b(at\);)598
1569 y(void)40 b(deallocate\(vm_offset_t)k(at\);)598
1660 y(//)39 b(Returns)i(non-zero)g(if)f(the)g(address)h(translation)g
(value)g(is)e(not)h(in)g(use.)598 1752 y(boolean_t)80
b(is_free\(vm_offset_t)44 b(at\);)639 1893 y Fz(Note)30
b(ho)n(w)f(its)h(in)n(terface)f(uses)h(references)e(to)i(A)-7
b(T)30 b(v)-5 b(alues.)44 b(That)29 b(is)h(to)g(a)n(v)n(oid)e(extra)515
1993 y(copies)f(of)g(translation)g(con)n(ten)n(ts.)639
2092 y(T)-7 b(o)27 b(allo)r(cate)g(an)h(A)-7 b(T)28 b(v)-5
b(alue)27 b(w)n(e)g(allo)r(cate)g(its)h(corresp)r(onding)d(ph)n(ysical)
i(en)n(try)-7 b(.)515 2225 y Fk(h)p Fi(off)p 667 2225
V 29 w(AddrTrValAllocator::allocate)33 b Fj(implementation.)28
b Fk(i)p Fq(\021)598 2316 y Fi(//)39 b(Allocates)j(an)d(address)i
(translation)h(value.)598 2408 y(off_AddrTrValRef)h
(off_AddrTrValAllocator::allocat)q(e\(vm)q(_offs)q(et_t)j(at\))598
2499 y({)676 2590 y(off_mdepAddrTrVal)d(*mval=a_lalloc+at;)676
2682 y(off_AddrTrValRef)g(res\(mval\);)676 2773 y(assert\(mval\);)676
2864 y(off_BKAllocator::allocate\(\);)676 2956 y(return)e(res;)598
3047 y(})639 3279 y Fz(Remaining)28 b(op)r(erations)e(follo)n(w)h(the)h
(same)f(mo)r(del.)515 3396 y Fk(h)p Fi(off)p 667 3396
V 29 w(AddrTrValAllocator::operator+)34 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 3487 y Fi(//)39 b(Returns)i(a)f(reference)h(to)f
(an)f(address)i(translation)h(value.)598 3578 y(inline)e
(off_AddrTrValRef)j(off_AddrTrValAllocator::oper)q(ator+)q(\(vm_)q
(offs)q(et_t)j(at\))598 3670 y({)676 3761 y(return)41
b(a_lalloc+at;)598 3852 y(})515 4101 y Fk(h)p Fi(off)p
667 4101 V 29 w(AddrTrValAllocator::pos)32 b Fj(implementation.)c
Fk(i)p Fq(\021)598 4193 y Fi(//)39 b(Returns)i(the)f(position)h(of)f
(an)g(address)g(translation)i(value.)598 4284 y(//)d(\(might)i(be)f
(expensive!\))598 4375 y(vm_offset_t)238 b
(off_AddrTrValAllocator::pos\(off)q(_Add)q(rTrVa)q(lRef)46
b(at\))598 4467 y({)676 4558 y(return)41 b(a_lalloc.pos\(at\);)598
4649 y(})1885 5255 y Fz(651)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
652 653 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(AddrTrValAllocator::deallocate)34 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Deallocates)j(an)e(address)h
(translation)g(value.)598 706 y(void)f(off_AddrTrValAllocator::deallo)q
(cate)q(\(off)q(_Addr)q(TrVa)q(lRef)46 b(at\))598 797
y({)676 888 y(off_BKAllocator::deallocate\()q(\);)676
980 y(a_lalloc.unmap\(at\);)436 b(//)40 b(Check)g(this)598
1071 y(})598 1254 y(void)g(off_AddrTrValAllocator::deallo)q(cate)q
(\(vm_)q(offse)q(t_t)46 b(at\))598 1345 y({)676 1436
y(off_BKAllocator::deallocate\()q(\);)676 1528 y(a_lalloc.unmap\(at\);)
436 b(//)40 b(Check)g(this)598 1619 y(})515 1953 y FA(Address)31
b(translation)h(references)515 2107 y Fz(As)22 b(could)g(b)r(e)g(seen)g
(ab)r(o)n(v)n(e,)f(references)g(to)h(A)-7 b(T)22 b(v)-5
b(alues)22 b(are)f(alw)n(a)n(ys)f(obtained)i(b)n(y)f(indexing)515
2206 y(the)28 b(mac)n(hine)f(dep)r(enden)n(t)h Ft(dtlb)g
Fz(data)f(structure)g(with)h(a)f(virtual)g(address.)639
2306 y(F)-7 b(or)21 b(lo)r(cal)f(translations)g(all)h(information)f
(needed)h(is)g(found)h(there;)h(for)e(remote)f(trans-)515
2406 y(lations,)g(the)f(page)f(frame)g(n)n(um)n(b)r(er)g(\()p
Fx(PFN)p Fz(\))h(\014eld)g(of)f(the)h(mac)n(hine)g(dep)r(enden)n(t)g
(en)n(try)f(p)r(oin)n(ts)515 2505 y(to)k(an)g(en)n(try)f(in)i(the)g
(remote)e(translation)g(allo)r(cator,)h(whic)n(h)g(m)n(ust)g(b)r(e)h
(indexed)f(to)g(obtain)515 2605 y(the)28 b(translation)e(information.)
36 b(Suc)n(h)28 b(lo)r(okup)f(logic)g(is)g(em)n(b)r(edded)h(in)g
Fx(AddrTrValRef)p Fz(s.)515 2728 y Fk(h)p Fj(Other)g(public)g(metho)l
(ds)h(of)e Fi(off)p 1493 2728 V 29 w(AddrTrValRef)p Fj(.)i
Fk(i)p Fq(\021)598 2819 y Fi(//)39 b(Get)h(the)g(remote)h(AT)f(value)
598 2910 y(off_AddrTrVal)i(*get_rat\(void\);)515 3065
y Fk(h)p Fi(off)p 667 3065 V 29 w(AddrTrValRef::get)p
1359 3065 V 32 w(rat)28 b Fj(implementation.)f Fk(i)p
Fq(\021)598 3156 y Fi(//)39 b(Get)h(the)g(remote)h(AT)f(value)598
3248 y(off_AddrTrVal)i(*off_AddrTrValRef::get_rat\(vo)q(id\))598
3339 y({)676 3430 y(return)f(&)e(\(\(off_AddrTrValAllocator::ge)q(t_ra)
q(lloc\()q(\)+)1068 3521 y(off_MBank::a2p\(mdep->get_ma)q(\(\)\))359
b(\)->a_at\);)598 3613 y(})515 3859 y Fk(h)p Fj(O\013)27
b(addr)l(ess)i(tr)l(anslation)h(implementation)e(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3950 y Fi(#include)41 b(<dmm/AddrTrAllocator.h>)639
4081 y Fz(Where)20 b Fx(get)p 1034 4081 27 4 v 30 w(ralloc)d
Fz(exp)r(orts)i(the)h(remote)g(A)-7 b(T)20 b(allo)r(cator)e(for)h
Fx(AddrTrValRef)p Fz(s.)29 b(The)515 4181 y(lo)r(cal)e(allo)r(cator)f
(is)h(exp)r(orted)g(to)r(o.)515 4304 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 4304 24 4 v 29 w(AddrTrValAllocator)p
Fj(.)k Fk(i)p Fz(+)o Fq(\021)598 4395 y Fi(static)40
b(inline)h(off_RemAddrTrValAllocator)k(&get_ralloc\(void\);)598
4486 y(inline)40 b(off_mdepDTLB)i(*get_lalloc\(void\);)515
4641 y Fk(h)p Fi(off)p 667 4641 V 29 w(AddrTrValAllocator::get)p
1593 4641 V 33 w(ralloc)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 4732 y Fi(extern)40 b(inline)h(off_RemAddrTrValAllocator)k
(&)676 4824 y(off_AddrTrValAllocator::get_)q(rallo)q(c\(vo)q(id\))h({)
755 4915 y(return)40 b(a_ralloc;)598 5006 y(})1885 5255
y Fz(652)p eop
PStoPSsaved restore
%%Page: (654,655) 328
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
653 654 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(AddrTrValAllocator::get)p 1593 523 V 33 w(lalloc)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 614 y Fi(inline)40
b(off_mdepDTLB)i(*off_AddrTrValAllocator::get)q(_lal)q(loc\(v)q(oid\))
598 706 y({)676 797 y(return)f(&a_lalloc;)598 888 y(})515
1154 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h(r)l(efer)l
(enc)l(e.)f Fk(i)o Fq(\021)598 1245 y Fi(//)39 b(A)h(reference)h(to)f
(an)g(AT)f(value)598 1337 y(//)598 1428 y(class)h(off_AddrTrValRef)j({)
598 1519 y(private:)676 1611 y(off_mdepAddrTrVal)g(*mdep;)355
b(//)39 b(Reference)j(to)d(the)h(mdep.)h(translation)g(entry.)598
1702 y(public:)676 1793 y(//)f(Is)g(it)f(a)h(local)g(translation?)676
1885 y(inline)h(boolean_t)g(is_remote\(void\))i(const)d({)755
1976 y(return)g(mdep->is_remote\(\);)676 2067 y(})676
2159 y(//)g(Creates)h(an)e(AddrTrValRef)676 2250 y
(off_AddrTrValRef\(off_mdepAdd)q(rTrVa)q(l)45 b(*m=NULL\))c(:)f
(mdep\(m\))g({;})676 2341 y(//)g(To)g(test)g(wrt)g(NULL)676
2433 y(operator)h(bool\(void\))h(const)e({)g(return)g(mdep!=NULL;)i(})
676 2524 y(//)e(To)g(extract)g(machine)h(dependent)g(information.)676
2615 y(operator)g(off_mdepAddrTrVal*\(void\))k(const)40
b({)g(return)g(mdep;)h(})676 2798 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2798 V 29
w(AddrTrValRef)p Fj(.)j Fk(i)598 2889 y Fi(};)639 3122
y Fz(A)-7 b(T)29 b(v)-5 b(alue)29 b(\014elds)g(are)f(either)g(built)i
(from)e(mac)n(hine)h(dep)r(enden)n(t)g(info)g(or)f(tak)n(en)g(from)515
3221 y(remote)40 b(A)-7 b(T)42 b(en)n(tries)f(p)r(oin)n(ted)g(b)n(y)g
(the)h(mac)n(hine)e(dep)r(enden)n(t)i(en)n(try)-7 b(.)78
b(Delegation)40 b(to)515 3321 y(remote)27 b(A)-7 b(T)28
b(giv)n(en)e(b)n(y)i Fx(get)p 1404 3321 27 4 v 30 w(rat)e
Fz(is)i(b)r(een)g(used)f(in)n(tensiv)n(ely)-7 b(.)515
3454 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3454 24 4 v 29 w(AddrTrValRef)p Fj(.)i
Fk(i)p Fz(+)p Fq(\021)598 3545 y Fi(const)40 b(off_pg_id_t)i
(get_pa\(void\);)598 3636 y(inline)e(vm_offset_t)i(get_ma\(void\))81
b({)676 3728 y(if)40 b(\(!mdep->is_remote\(\)\))755 3819
y(return)g(mdep->get_ma\(\);)676 3910 y(else)755 4002
y(return)g(get_rat\(\)->get_ma\(\);)598 4093 y(})598
4184 y(inline)g(off_mod_t)120 b(get_mod\(void\))81 b({)676
4276 y(if)40 b(\(!mdep->is_remote\(\)\))755 4367 y(return)g
(mdep->get_mod\(\);)676 4458 y(else)755 4550 y(return)g
(get_rat\(\)->get_mod\(\);)598 4641 y(})1885 5255 y Fz(653)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
654 655 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(AddrTrValRef::get)p 1359 523 V 32 w(pa)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 614 y Fi(const)40 b(off_pg_id_t)i
(off_AddrTrValRef::get_pa\(void\))598 706 y({)676 797
y(if)e(\(!mdep->is_remote\(\)\))755 888 y(return)g
(off_id_t\(nd.get_mbank\(\).get_)q(id\(\))q(,mdep)q(->ge)q(t_ma\()q
(\)\);)676 980 y(else)755 1071 y(return)g(get_rat\(\)->get_pa\(\);)598
1162 y(})515 1428 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h
(implementation)e(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
1519 y Fi(#include)41 b(<node/Node.h>)515 1694 y Fk(h)p
Fj(Other)28 b(public)g(metho)l(ds)h(of)e Fi(off)p 1493
1694 V 29 w(AddrTrValRef)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598
1785 y Fi(void)40 b(set_pa\(const)i(off_pg_id_t)g(&pg\);)598
1968 y(inline)e(void)g(set_ma\(vm_offset_t)k(ma\))c({)676
2059 y(if)g(\(!mdep->is_remote\(\)\))755 2150 y(mdep->set_ma\(ma\);)676
2242 y(else)755 2333 y(get_rat\(\)->set_ma\(ma\);)598
2424 y(})598 2516 y(inline)g(void)g(set_mod\(off_mod_t)k(mod\))c({)676
2607 y(if)g(\(!mdep->is_remote\(\)\))755 2698 y(mdep->set_mod\(mod\);)
676 2790 y(else)755 2881 y(get_rat\(\)->set_mod\(mod\);)598
2972 y(})515 3238 y Fk(h)p Fi(off)p 667 3238 V 29 w(AddrTrValRef::set)p
1359 3238 V 32 w(pa)28 b Fj(implementation.)f Fk(i)p
Fq(\021)598 3329 y Fi(void)40 b(off_AddrTrValRef::set_pa\(const)46
b(off_pg_id_t)c(&pg\))598 3421 y({)598 3512 y(#if)e(0)1059
b(//)40 b(XXX)676 3603 y(cleanup)80 b(current)41 b(entry;)676
3694 y(if)f(\(!mdep->is_remote\(\))j(&&)d(is_remote\(pg\)\))755
3786 y(allocate)h(new)f(entry;)676 3877 y(if)g
(\(!mdep->is_remote\(\)\))755 3968 y(mdep->set_ma\(pg\);)676
4060 y(else)755 4151 y(get_rat\(\)->set_pa\(pg\);)598
4242 y(#else)676 4334 y(\(void\)pg;)598 4425 y(#endif)598
4516 y(})1885 5255 y Fz(654)p eop
PStoPSsaved restore
%%Page: (656,657) 329
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
655 656 bop 515 523 a FA(Remote)29 b(address)j(translation)g(allo)s
(cation)515 668 y Fk(h)p Fj(O\013)27 b(r)l(emote)i(addr)l(ess)g(tr)l
(anslation)g(al)t(lo)l(c)l(ator.)g Fk(i)o Fq(\021)598
759 y Fi(//)39 b(A)h(remote)g(address)h(translation)h(allocator.)598
851 y(//)598 942 y(class)e(off_RemAddrTrValAllocator)45
b(:)39 b(public)i(off_TBlockAllocator<off_LAddr)q(TrVa)q(l>)k({)598
1033 y(public:)676 1125 y(//)40 b(Allows)g(declarations)i(of)e
(uninitialized)i(address)f(translation)h(allocators.)676
1216 y(off_RemAddrTrValAllocator\(vo)q(id\){;)q(})676
1399 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 1399 24 4 v 29 w(RemAddrTrValAllocator)p
Fj(.)32 b Fk(i)598 1490 y Fi(private:)676 1581 y Fk(h)p
Fj(Other)d(private)f(memb)l(ers)h(of)e Fi(off)p 1713
1581 V 29 w(RemAddrTrValAllocator)p Fj(.)32 b Fk(i)598
1673 y Fi(};)515 1938 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l
(anslation)h(al)t(lo)l(c)l(ator)e(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 2030 y Fi(#include)41 b
(<klib/BlockAllocator.h>)j(//)c(for)g(off_BlockAllocator)598
2121 y(#include)h(<dmm/AddrTr.h>)356 b(//)40 b(for)g(off_AddrTrVal)639
2262 y Fz(As)28 b(the)h(blo)r(c)n(k)f(allo)r(cator)e(uses)i(a)f(link)n
(ed)h(free-list,)g(the)h(arra)n(y)d(no)r(des)h(m)n(ust)i(sub)r(class)
515 2362 y Fx(DLinkedNode)p Fz(.)515 2494 y Fk(h)p Fj(O\013)e(linkable)
g(addr)l(ess)j(tr)l(anslation.)e Fk(i)p Fq(\021)598 2586
y Fi(class)40 b(off_LAddrTrVal)j(:)c(public)i(DLinkedNode)g({)598
2677 y(public:)676 2768 y(off_AddrTrVal)h(a_at;)315 b(//)40
b(The)79 b(translation)42 b(target.)676 2951 y(//)e(To)g(allow)g
(uninitialized)i(LAddrTrs)676 3042 y(off_LAddrTrVal\(void\))i({;})598
3134 y(};)639 3275 y Fz(An)28 b(indexer)f(is)h(main)n(tained)f(b)n(y)g
(the)h(allo)r(cator.)515 3408 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)
f(of)g Fi(off)p 1552 3408 V 29 w(RemAddrTrValAllocator)p
Fj(.)j Fk(i)p Fq(\021)598 3499 y Fi(static)40 b
(off_Indexer<off_LAddrTrVal>)46 b(r_idx;)515 3673 y Fk(h)p
Fj(O\013)27 b(r)l(emote)i(addr)l(ess)g(tr)l(anslation)g(al)t(lo)l(c)l
(ator)g(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 3765
y Fi(off_Indexer<off_LAddrTrVal>)45 b(off_RemAddrTrValAllocator::r_)q
(idx;)639 3906 y Fz(The)c(allo)r(cator)d(is)i(initially)h(created)e
(uninitialized.)76 b(When)41 b(the)g Ft(dtlb)f Fz(is)g(b)r(eing)515
4005 y(created,)27 b(it)h(is)f(initialized.)515 4122
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4122 V 29 w(RemAddrTrValAllocator)p Fj(.)32 b Fk(i)o
Fq(\021)598 4213 y Fi(//)39 b(Creates)i(and)f(remote)h(address)g
(translation)g(allocator.)598 4304 y(off_RemAddrTrValAllocator\(off_)q
(Exhau)q(sted)46 b(*r,)40 b(off_KVMRegion)i(*reg\);)1885
5255 y Fz(655)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
656 657 bop 639 523 a Fz(The)38 b(region)e(used)h(b)n(y)h(the)f(blo)r
(c)n(k)g(allo)r(cator)f(is)h(stored)g(in)h(the)g(\014rst)f(part)g(of)g
Fy(user)515 623 y Fz(virtual)27 b(memory)-7 b(,)27 b(past)g(the)h(k)n
(ernel)f(space.)36 b(It)28 b(can)f(gro)n(w)f(and)h(migh)n(t)h(b)r(e)g
(paged.)515 756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w
(RemAddrTrAllocator::off)p 1593 756 V 33 w(RemAddrTrAllocator)k
Fj(implementation.)27 b Fk(i)p Fq(\021)598 847 y Fi(//)39
b(Creates)i(an)f(remote)h(address)f(translation)i(allocator.)598
938 y(off_RemAddrTrValAllocator::off)q(_RemA)q(ddrT)q(rVal)q(Alloc)q
(ator)q(\(off_)q(Exha)q(uste)q(d)j(*r,)2677 1029 y(off_KVMRegion)d
(*reg\):)755 1121 y(off_TBlockAllocator<off_LAddrTr)q(Val>)q(\(r,\()q
(const)k(off_Indexable*\)&r_idx,reg\),)755 1212 y Fk(h)p
Fj(Initialize)26 b(other)j(aggr)l(e)l(gate)h(memb)l(ers)f(of)e
Fi(off)p 2168 1212 V 29 w(RemAddrTrValAllocator)p Fj(.)32
b Fk(i)598 1303 y Fi({)676 1395 y(assert\(reg\);)598
1486 y(})515 1752 y Fk(h)p Fj(Other)c(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1752 V 29 w(RemAddrTrValAllocator)p Fj(.)32
b Fk(i)o Fz(+)p Fq(\021)598 1843 y Fi(off_LAddrTrVal)42
b(*operator+\(natural_t)i(a\);)515 2017 y Fk(h)p Fi(off)p
667 2017 V 29 w(RemAddrTrValAllocator::operator)i(+)27
b Fj(implementation.)h Fk(i)p Fq(\021)598 2109 y Fi(off_LAddrTrVal)42
b(*off_RemAddrTrValAllocator::)q(opera)q(tor+)q(\(natu)q(ral_)q(t)j
(a\))40 b({)676 2200 y(return)h(r_addrs+a;)598 2291 y(})515
2466 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2466 V 29 w(RemAddrTrValAllocator)p Fj(.)j
Fk(i)p Fz(+)p Fq(\021)598 2557 y Fi(off_LAddrTrVal)42
b(*r_addrs;)515 2731 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l
(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 2731 V 29 w
(RemAddrTrValAllocator)p Fj(.)32 b Fk(i)p Fq(\021)598
2823 y Fi(r_addrs\(\(off_LAddrTrVal*\)reg->)q(get_s)q(tart)q(\(\)\))515
3080 y FA(dtlb)f(A)-8 b(T)33 b(in)m(terface)515 3233
y Fz(Using)28 b(the)h(classes)e(seen)h(ab)r(o)n(v)n(e,)g(the)h
Ft(dtlb)f Fz(supp)r(orts)g(allo)r(cation)f(and)i(deallo)r(cation)e(of)
515 3333 y(A)-7 b(Ts.)37 b(The)27 b(in)n(terface)g(pro)n(vides)g(just)h
(sev)n(eral)e Fx(map)g Fz(and)h Fx(unmap)f Fz(op)r(erations.)515
3466 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3466 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
3557 y Fi(//)39 b(Access)i(to)f(a)f(given)i(AT.)598 3648
y(inline)f(off_AddrTrValRef)j(operator)e(+\(vm_offset_t)h(la\);)598
3831 y(//)d(Map)h(or)g(unmap)g(a)g(range)g(of)g(pages)g(into)g(a)g
(range)g(of)g(page)g(frames.)598 3922 y(//)f(using)i(just)f(real)g
(physical)h(names)598 4014 y(err_t)f(map\(vm_offset_t)j(la,)d
(vm_offset_t)h(pa,)f(vm_size_t)i(size,)e(off_mdep_mod_t)i(mod\);)598
4105 y(err_t)e(unmap\(vm_offset_t)j(va,)d(vm_size_t)h(sz=PAGE_SIZE\);)
598 4196 y(//)e(Synchronize)j(mappings)f(\(flush)g(tlb\))598
4288 y(inline)f(void)80 b(sync\(void\);)598 4470 y(//)39
b(using)i(distributed)h(physical)f(names)598 4562 y(err_t)f
(map\(vm_offset_t)j(la,)d(off_pg_id_t)h(pa,)f(vm_size_t)i(size,)e
(off_mdep_mod_t)i(mod\);)598 4744 y(//)d(using)i(address)g
(translations)598 4836 y(err_t)f(map\(vm_offset_t)j(la,)d
(off_AddrTrVal)i(&to\);)598 4927 y(err_t)e(map\(vm_offset_t)j(la,)d
(off_AddrTrValRef)j(&to\);)1885 5255 y Fz(656)p eop
PStoPSsaved restore
%%Page: (658,659) 330
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
657 658 bop 639 523 a Fz(The)28 b(access)e(op)r(erator)g(delegates)h
(to)g(the)h Ft(dtlb)g Fz(allo)r(cator.)515 631 y Fk(h)p
Fi(off)p 667 631 24 4 v 29 w(DTLB::operator+)i Fj(implementation.)e
Fk(i)p Fq(\021)598 722 y Fi(//)39 b(Access)i(to)f(a)f(given)i(AT.)598
814 y(inline)f(off_AddrTrValRef)j(off_DTLB::operator)h(+\(vm_offset_t)e
(la\))598 905 y({)676 996 y(return)f(d_alloc+la;)598
1088 y(})639 1295 y Fz(A)c(con)n(v)n(enience)e(metho)r(d)i(is)f(pro)n
(vided)g(to)g(get)g(the)h(k)n(ernel)f(virtual)f(address)h(for)f(a)515
1395 y(non-installed)27 b(lo)r(cal)g Ft(dtlb)p Fz(.)515
1511 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1511 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1602 y Fi(//)39 b(Get)h(the)g(kernel)h(virtual)g(address)f
(corresponding)j(to)c(the)h(user)g(virtual)598 1694 y(//)f(address)i
(uv)f(in)g(this)g(dltb.)598 1785 y(vm_offset_t)h(uv2kv\(vm_offset_t)j
(uv\);)515 1926 y Fk(h)p Fi(off)p 667 1926 V 29 w(DTLB::uv2kv)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 2017 y Fi(//)39
b(Get)h(the)g(kernel)h(virtual)g(address)f(corresponding)j(to)c(the)h
(user)g(virtual)598 2109 y(//)f(address)i(uv)f(in)g(this)g(dltb.)598
2200 y(vm_offset_t)h(off_DTLB::uv2kv\(vm_offset_t)46
b(uv\))598 2291 y({)676 2383 y(off_AddrTrValRef)d(tr=d_alloc+uv;)676
2474 y(return)e(tr.get_ma\(\))h(+)d(\(uv)h(&)f(off_MBank::pmask\(\)\);)
598 2565 y(})639 2781 y Fz(T)-7 b(o)26 b(map)g(and)f(unmap)i(ranges,)d
(w)n(e)i(allo)r(cate)f(\(or)g(deallo)r(cate\))h(the)g(in)n(v)n(olv)n
(ed)f(transla-)515 2881 y(tions)i(and)h(forw)n(ard)d(the)j(op)r
(eration)f(to)g(the)h(mac)n(hine)g(dep)r(enden)n(t)g
Ft(dtlb)p Fz(.)515 2997 y Fk(h)p Fi(off)p 667 2997 V
29 w(DTLB::map)h Fj(implementation.)e Fk(i)p Fq(\021)598
3088 y Fi(//)39 b(Map)h(or)g(unmap)g(a)g(range)g(of)g(pages)g(into)g(a)
g(range)g(of)g(page)g(frames.)598 3180 y(//)f(using)i(just)f(real)g
(physical)h(names)598 3271 y(err_t)f(off_DTLB::map\(vm_offset_t)45
b(la,)40 b(vm_offset_t)i(pa,)1382 3362 y(vm_size_t)g(size,)e
(off_mdep_mod_t)i(mod\))598 3454 y({)676 3545 y(for\(vm_size_t)g
(remaining=size,at=la;)833 3636 y(remaining>0;)833 3728
y(remaining-=off_MBank::get_pgs)q(ize\()q(\),)755 3819
y(pa+=off_MBank::get_pgsize\(\),)755 3910 y
(at+=off_MBank::get_pgsize\(\)\){)755 4002 y(off_AddrTrValRef)h
(val=d_alloc.allocate\(at\);)755 4093 y(if)c(\(!val\){)833
4184 y(do_debug\(kcout)k(<<)c("map:)i(AT)e(allocation)j(failed")f(<<)e
(nl\);)833 4276 y(return)i(EAGAIN;)755 4367 y(})755 4458
y(val.set_ma\(pa\);)755 4550 y(val.set_mod\(mod\);)755
4641 y(//do_debug\(printf\("map:)j(from)c(\04508x)g(to)g(\04508x)g
(\(\04503x\)\\n",at,pa,mod\)\);)637 4732 y(})676 4824
y(return)h(EOK;)598 4915 y(})1885 5255 y Fz(657)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
658 659 bop 515 523 a Fk(h)p Fj(O\013)27 b(DTLB)g(implementation)h(dep)
l(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(#include)41
b(<hw/MBank.h>)434 b(//)40 b(for)g(get_pgsize)515 789
y Fk(h)p Fi(off)p 667 789 24 4 v 29 w(DTLB::map)29 b
Fj(implementation.)e Fk(i)p Fz(+)p Fq(\021)598 880 y
Fi(//)39 b(using)i(distributed)h(physical)f(names)598
971 y(err_t)f(off_DTLB::map\(vm_offset_t)45 b(la,)40
b(off_pg_id_t)i(pa,)1382 1063 y(vm_size_t)g(size,)e(off_mdep_mod_t)i
(mod\))598 1154 y({)676 1245 y(for\(vm_size_t)g(remaining=size,at=la;)
833 1337 y(remaining>0;)833 1428 y(remaining-=off_MBank::get_pgs)q
(ize\()q(\),)755 1519 y(pa+=off_MBank::get_pgsize\(\),)755
1611 y(at+=off_MBank::get_pgsize\(\)\){)755 1702 y(off_AddrTrValRef)h
(val=d_alloc.allocate\(at\);)755 1793 y(if)c(\(!val\){)833
1885 y(do_debug\(kcout)k(<<)c("map:)i(AT)e(allocation)j(failed")f(<<)e
(nl\);)833 1976 y(return)i(EAGAIN;)755 2067 y(})755 2159
y(val.set_pa\(pa\);)755 2250 y(val.set_mod\(mod\);)676
2341 y(})676 2433 y(return)g(EOK;)598 2524 y(})598 2707
y(//)e(using)i(address)g(translations)598 2798 y(err_t)f
(off_DTLB::map\(vm_offset_t)45 b(la,)40 b(off_AddrTrVal)i(&to\))598
2889 y({)676 2980 y(return)f(map\(la,to.get_pa\(\),off_MBank::)q(get_)q
(pgsiz)q(e\(\),)q(to.ge)q(t_mo)q(d\(\)\))q(;)598 3072
y(})598 3163 y(err_t)f(off_DTLB::map\(vm_offset_t)45
b(la,)40 b(off_AddrTrValRef)j(&to\))598 3254 y({)676
3346 y(return)e(map\(la,to.get_pa\(\),off_MBank::)q(get_)q(pgsiz)q
(e\(\),)q(to.ge)q(t_mo)q(d\(\)\))q(;)598 3528 y(})515
3794 y Fk(h)p Fi(off)p 667 3794 V 29 w(DTLB::unmap)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 3885 y Fi(err_t)40
b(off_DTLB::unmap\(vm_offset_t)45 b(va,)40 b(vm_size_t)i(sz\))598
3977 y({)676 4068 y(for\(;)f(sz>0;)f(sz-=off_MBank::get_pgsize\(\),)46
b(va+=off_MBank::get_pgsize\(\)\))f({)755 4159 y
(d_alloc.deallocate\(va\);)676 4251 y(})676 4342 y(return)c(EOK;)598
4433 y(})639 4666 y Fz(Sync)n(hronizing)27 b(is)g(done)g(b)n(y)h(the)g
(mac)n(hine)f(dep)r(enden)n(t)h(implemen)n(tation.)515
4782 y Fk(h)p Fi(off)p 667 4782 V 29 w(DTLB::sync)h Fj(implementation.)
f Fk(i)p Fq(\021)598 4873 y Fi(//)39 b(Synchronize)j(mappings)f
(\(flush)g(tlb\))598 4965 y(extern)f(inline)h(void)79
b(off_DTLB::sync\(void\))44 b({)c(d_mdep.sync\(\);)i(})1885
5255 y Fz(658)p eop
PStoPSsaved restore
%%Page: (660,661) 331
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
659 660 bop 515 523 a Fn(5.3.7)112 b(P)m(age)38 b(fault)f(handling)515
676 y Fz(Initially)-7 b(,)21 b(page)e(faults)h(are)e(handled)i(b)n(y)f
(the)h Ft(dmm)p Fz(,)h(whic)n(h)f(delegates)e(either)i(to)f(the)h(KVM)
515 776 y(to)27 b(handle)h(k)n(ernel)e(page)h(faults)h(or)f(to)g(the)h
Ft(dtlb)f Fz(b)r(eing)h(used)g(for)f(user)g(page)f(faults.)515
909 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e Fi(off)p
1493 909 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
1000 y Fi(//)39 b(Handles)i(a)f(page)g(fault.)598 1091
y(static)g(int)g(pg_fault\(const)j(off_shtl_id_t)f(&sender,)1422
1183 y(vm_size_t)f(msz,)f(vm_size_t)h(rsz,)1422 1274
y(off_MsgReq)g(*m,)f(off_MsgRep)h(*r\);)515 1448 y Fk(h)p
Fi(off)p 667 1448 V 29 w(DMM::pg)p 969 1448 V 29 w(fault)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 1540 y Fi(//)39
b(Handles)i(a)f(page)g(fault.)598 1631 y(int)79 b
(off_DMM::pg_fault\(const)44 b(off_shtl_id_t)f(&sender,)1539
1722 y(vm_size_t)e(msz,)g(vm_size_t)g(rsz,)1539 1814
y(off_MsgReq)h(*m,)e(off_MsgRep)h(*r\))598 1905 y({)676
1996 y(off_PgFltReq)h(*pf=\(off_PgFltReq*\)m;)676 2088
y(assert\(msz==sizeof\(off_PgFlt)q(Req\)\))q(;)676 2179
y(\(void\)sender;\(void\)rsz;)676 2270 y
(assert\(off_DMM::is_active\(\)\))q(;)676 2362 y(if)e
(\(pf->is_from_kernel\(\))k(&&)c(pf->get_vaddr\(\))i(<)e
(off_DMM::get_ustart\(\)\))755 2453 y(r->m_err=kvm.pg_fault\(pf\);)676
2544 y(else)755 2636 y(r->m_err=dmm.get_current\(\)->pg_)q(faul)q
(t\(pf)q(\))45 b(;)676 2727 y(return)c(r->m_err;)598
2910 y(})639 3142 y Fz(Where)33 b Fx(get)p 1047 3142
27 4 v 30 w(current)d Fz(returns)j(a)f(reference)g(to)h(the)h
Ft(dtlb)f Fz(in)g(use)g(at)g(the)g(curren)n(t)515 3242
y(pro)r(cessor.)639 3341 y(The)20 b(information)e(carried)g(b)n(y)h(a)g
(page)g(fault)h(is)f(represen)n(ted)f(b)n(y)h(an)g Fx(PgFltReq)p
Fz(,)f(whic)n(h)515 3441 y(is)29 b(a)g(simple)h(trap)f(message.)41
b(The)29 b(message)f(t)n(yp)r(e)i(used)f(to)h(rep)r(ort)e(page)h
(faults)g(to)h(user)515 3541 y(is)d(named)h Fx(DTLBMISS)p
Fz(.)515 3657 y Fk(h)p Fj(Other)g(virtual)g(tr)l(aps.)h
Fk(i)p Fq(\021)598 3748 y Fi(OFF_EX_DTLBMISS,)631 b(//)40
b(Page)g(fault)g(on)g(DTLB)g(entry.)639 3873 y Fz(Once)25
b(a)g(page)f(fault)i(reac)n(hes)d(the)j Ft(dtlb)p Fz(.)35
b(It)26 b(can)f(b)r(e)g(serviced)f(b)n(y)h(either)g(translating)515
3972 y(a)31 b(remote)f(translation)g(to)h(a)g(lo)r(cal)f(one)h(or)g(b)n
(y)f(deliv)n(ering)g(the)i(page)e(fault)i(trap)f(to)g(the)515
4072 y(user.)515 4205 y Fk(h)p Fj(Other)d(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4205 24 4 v 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 4296 y Fi(//)39 b(Handles)i(a)f(page)g(fault)g(on)g(this)g
(dtlb.)598 4387 y(err_t)g(pg_fault\(off_PgFltReq)k(*pgf\);)1885
5255 y Fz(659)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
660 661 bop 639 523 a Fz(The)20 b(\014rst)g(thing)g(done)f(b)n(y)g
Fx(pg)p 1565 523 27 4 v 31 w(fault)f Fz(is)h(to)h(c)n(hec)n(k)f
(whether)h(a)f(translation)f(is)i(installed)515 623 y(for)j(the)h
(faulting)f(address)g(or)f(not.)36 b(In)23 b(case)g(there)g(is)h(one,)g
(the)g(page)e(fault)i(is)g(serviced)e(b)n(y)515 722 y(the)29
b(address)e(translation.)39 b(In)29 b(case)f(there)g(is)h(no)f
(translation)g(installed)g(or)g(the)h(address)515 822
y(can)e(not)h(resolv)n(e)d(the)j(translation,)f(the)h(page)f(fault)h
(is)f(delegated)g(to)g(the)h(user.)515 955 y Fk(h)p Fi(off)p
667 955 24 4 v 29 w(DTLB::pg)p 1008 955 V 30 w(fault)g
Fj(implementation.)g Fk(i)p Fq(\021)598 1046 y Fi(//)39
b(Handles)i(a)f(page)g(fault)g(on)g(this)g(dtlb.)598
1137 y(err_t)g(off_DTLB::pg_fault\(off_PgFltR)q(eq)45
b(*pgf\))598 1229 y({)676 1320 y(off_AddrTrValRef)e(tr;)676
1411 y(assert\(pgf\);)676 1503 y(tr=\(*this\)+pgf->get_vaddr\(\);)676
1594 y(if)d(\(!tr)g(||)g(!tr.is_remote\(\))i(||)e
(!pgf->is_absent\(\)\))755 1685 y(return)g(usr_fault\(pgf\);)676
1777 y(else)g({)755 1868 y(panic\("remote)i(entry)e(fault)h(in)e
(unknown)i(state."\);)755 1959 y Fk(h)p Fj(T)-6 b(ry)28
b(to)g(r)l(esolve)h Fi(pgf)f Fj(in)f(an)h(absent)h(r)l(emote)g(tr)l
(anslation)g Fi(tr)p Fj(.)e Fk(i)676 2051 y Fi(})598
2142 y(})515 2408 y Fk(h)p Fj(T)-6 b(ry)28 b(to)g(r)l(esolve)h
Fi(pgf)f Fj(in)f(an)h(absent)h(r)l(emote)g(tr)l(anslation)g
Fi(tr)p Fj(.)e Fk(i)p Fq(\021)598 2499 y Fi(#if)40 b(0)588
b(//)40 b(XXX)598 2590 y(off_LAddrTrVal)i(*rent=a_alloc+pgf->get_vaddr)
q(\(\);)598 2682 y(make_available\(rent->a_at.a_pa)q(\);)598
2773 y(tr->set_pa\(rent->a_at.a_pa\);)598 2864 y(#else)598
2956 y(return)e(ENOSYS;)598 3047 y(#endif)639 3188 y
Fz(Here,)31 b(w)n(e)g(used)f(a)g(new)h Fx(AddrTrVal)c
Fz(metho)r(d)k(to)f(handle)h(page)f(faults)g(and)h(also)e(an)515
3288 y(in)n(ternal)e(metho)r(d)h(of)f(the)h Ft(dtlb)g
Fz(to)f(raise)g(page)f(faults)i(to)g(the)g(user.)515
3404 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3404 V 29 w(AddrTrValRef)p Fj(.)i Fk(i)p Fz(+)p
Fq(\021)598 3495 y Fi(//)39 b(Handles)i(a)f(page)g(fault)g(on)g(this)g
(address)h(translation.)598 3587 y(err_t)f(pg_fault\(off_PgFltReq)k
(*pgf\);)515 3744 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 3744 V 29 w(DTLB)p Fj(.)h Fk(i)o
Fq(\021)598 3836 y Fi(//)39 b(Raises)i(a)e(page)i(fault)f(to)g(the)g
(user.)598 3927 y(//)f(An)h(error)g(code)h(would)f(lead)g(to)g(a)f
(double)i(page)f(fault.)598 4018 y(err_t)g(usr_fault\(off_PgFltReq)k
(*pgf\);)515 4193 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h
(dep)l(endencies.)f Fk(i)p Fz(+)o Fq(\021)598 4284 y
Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_PgFltReq)1885
5255 y Fz(660)p eop
PStoPSsaved restore
%%Page: (662,663) 332
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
661 662 bop 639 523 a Fz(In)33 b(case)e(there)h(is)g(no)g(translation,)
h(the)f(page)g(fault)g(is)g(deliv)n(ered)g(to)g(the)h
Ft(dtlb)f Fz(ex-)515 623 y(ception)27 b(p)r(ortal.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(DTLB::usr)p
1047 756 V 30 w(fault)h Fj(implementation.)g Fk(i)p Fq(\021)598
847 y Fi(//)39 b(Raises)i(a)e(page)i(fault)f(to)g(the)g(user.)598
938 y(//)f(An)h(error)g(code)h(would)f(lead)g(to)g(a)f(double)i(page)f
(fault.)598 1029 y(err_t)g(off_DTLB::usr_fault\(off_PgFlt)q(Req)46
b(*pgf\))598 1121 y({)676 1212 y(off_MsgRep)c(rep;)676
1303 y(vm_size_t)f(rsz=sizeof\(rep\);)676 1395 y(err_t)g(err;)676
1486 y(//)f(XXX)g(beware)g(with)h(double)f(faults.)676
1577 y(//)g(include)h(a)e(counter)i(and)f(deliver)h(a)e(double)i(fault)
f(to)g(our)g(domain)g(instead.)598 1669 y(#if)g(0)676
1760 y(if)g(\(!is_faulting\){)676 1851 y(faulting\(\);)598
1943 y(#endif)676 2034 y(if)g(\(get_domain\(\))i(==)e(OFF_PRTL_NULL\))
755 2125 y(return)g(ENOPRTL;)676 2217 y
(err=prtl.kpct\(get_domain\(\),o)q(ff_Sh)q(tl::)q(self)q(\(\)->g)q
(et_i)q(d\(\),)1225 2308 y(sizeof\(off_PgFltReq\),rsz,pg)q(f,&re)q
(p,0\))q(;)598 2399 y(#if)g(0)676 2491 y(not_faulting\(\);)676
2582 y(})676 2673 y(else)g({)755 2765 y(pgf->m_type=OFF_EX_DBLMISS;)755
2856 y(err=prtl.kpct\(dmm.get_domain\(\),)q(off_)q(Shtl)q(::sel)q
(f\(\)-)q(>get_)q(id\(\))q(,)1304 2947 y
(sizeof\(off_PgFltReq\),sizeof\(re)q(p\),p)q(gf,&r)q(ep\);)676
3039 y(})598 3130 y(#endif)676 3221 y(return)h
(\(\(err\)?err:rep.m_err\);)598 3313 y(})639 3545 y Fz(The)21
b(k)n(ernel)f(do)r(es)h(not)g(supp)r(ort)g(guaran)n(teed)e
(translations.)33 b(Therefore,)21 b(a)g(page)f(fault)515
3645 y(on)29 b(the)h(curren)n(t)e(sh)n(uttle)i(while)g(servicing)e(a)h
(p)r(ending)h(page)f(fault)h(\(i.e.)42 b(a)30 b(double)f(page)515
3744 y(fault\))35 b(w)n(ould)g(mean)f(that)i(the)f(user)f(virtual)h
(memory)f(co)r(de)g(is)h(page)f(faulting.)59 b(Suc)n(h)515
3844 y(double)27 b(fault)h(is)f(considered)f(sp)r(ecial)h(and)g(is)h
(serviced)e(b)n(y)h(raising)f(a)h(double)g(page)g(fault)515
3944 y(virtual)k(trap)h(to)g(the)g Ft(dmm)g Fz(exception)g(p)r(ortal)f
(\(whic)n(h)i(should)e(b)r(e)i(handled)f(b)n(y)g(a)f(p)r(er-)515
4043 y(no)r(de)g(pager\).)45 b(Suc)n(h)31 b(trap)g(is)f(supp)r(osed)h
(to)g(b)r(e)g(a)f(last)h(resort)e(to)i(page)f(in)h(an)n(y)f(co)r(de)h
(or)515 4143 y(data)c(for)g(the)h(application)f(pager.)515
4276 y Fk(h)p Fj(Other)h(virtual)g(tr)l(aps.)h Fk(i)p
Fz(+)o Fq(\021)598 4367 y Fi(OFF_EX_DBLMISS)709 b(//)40
b(Double)g(DTLB)g(miss.)515 4541 y Fk(h)p Fj(O\013)27
b(DTLB)g(implementation)h(dep)l(endencies.)h Fk(i)p Fz(+)p
Fq(\021)598 4633 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40
b(for)g(off_Frozen{Req|Rep})j(XXX)d(include)h(it)598
4724 y(#include)g(<prtl/PrtlSrv.h>)278 b(//)40 b(for)g(prtl.)598
4815 y(#include)h(<shtl/Shtl.h>)395 b(//)40 b(for)g(Shtl)g(and)g(self.)
1885 5255 y Fz(661)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
662 663 bop 639 523 a Fz(Address)22 b(translations)f(resolv)n(e)f(page)
i(faults)g(automatically)f(only)h(for)g(remote)f(trans-)515
623 y(lations)38 b(whic)n(h)g(ha)n(v)n(e)g(lo)r(cal)g(\(cac)n(hing\))g
(page)g(frames.)69 b(Ev)n(ery)37 b(other)h(fault)h(is)g(simply)515
722 y(deliv)n(ered)27 b(to)g(the)h(user.)515 855 y Fk(h)p
Fi(off)p 667 855 24 4 v 29 w(AddrTrValRef::pg)p 1320
855 V 31 w(fault)h Fj(implementation.)e Fk(i)p Fq(\021)598
946 y Fi(//)39 b(Handles)i(a)f(page)g(fault)g(on)g(this)g(address)h
(translation.)598 1038 y(err_t)f(off_AddrTrValRef::pg_fault\(of)q(f_Pg)
q(FltR)q(eq)45 b(*pgf\))598 1129 y({)598 1220 y(#if)40
b(0)588 b(//)40 b(XXX)676 1312 y(fix)g(page)g(table)h(if)e(cached)i
(remote)f(page;)676 1403 y(else)g(raise)h(pgfault)g(to)e(the)h(user;)
598 1494 y(#else)676 1586 y(\(void\)pgf;)598 1677 y(#endif)676
1768 y(return)h(ENOSYS;)598 1860 y(})515 2225 y Fn(5.3.8)112
b(dtlb)37 b(switc)m(hing)515 2378 y Fz(As)31 b Ft(dtlb)p
Fz(s)g(are)f(v)-5 b(alid)31 b(sh)n(uttle)g(prop)r(ert)n(y)g(v)-5
b(alues,)31 b(the)h Ft(dmm)f Fz(also)f(implemen)n(ts)h(the)h(sig-)515
2478 y(nature)27 b(of)g(a)h(prop)r(ert)n(y)e(serv)n(er.)639
2577 y(implemen)n(ts)i(the)g Fx(SthlPropSrv)23 b Fz(in)n(terface.)515
2694 y Fk(h)p Fi(off)p 667 2694 V 29 w(DMM)28 b Fj(shuttle)h(pr)l(op)l
(erty)h(metho)l(ds.)e Fk(i)p Fq(\021)598 2785 y Fi(//)39
b(Property)i(interface)h(routines)f(\(off_ShtlPropSrv)i(signature\).)
598 2968 y(//)c(Switches)i(property)h(values.)598 3059
y(//)d(Returns)i(either)g(0)e(or)h(an)g(error)g(code.)598
3150 y(err_t)g(pswitch\(const)i(off_dtlb_id_t)g(&to,)f(const)f
(off_shtl_id_t)i(&s\);)598 3333 y(//)d(Set)h(or)g(clear)g(the)g
(property)h(at)f(a)f(given)i(shuttle.)598 3424 y(err_t)f
(pset\(off_dtlb_id_t)j(&pval,const)f(off_shtl_id_t)g(&s\);)598
3516 y(void)79 b(pclr\(const)42 b(off_dtlb_id_t)g(&pval,)e(const)h
(off_shtl_id_t)h(&s\);)598 3698 y(//)d(Is)h(pswitch)h(used?)598
3790 y(boolean_t)g(needs_switch\(void\);)1885 5255 y
Fz(662)p eop
PStoPSsaved restore
%%Page: (664,665) 333
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
663 664 bop 639 523 a Fz(W)-7 b(e)26 b(only)f Fx(pset)e
Fz(and)i Fx(pclr)f Fz(to)h(do)g(the)g(job.)36 b(They)25
b(will)h(call)f(the)g Fx(set)p 2836 523 27 4 v 30 w(mdtlb)f
Fz(metho)r(d)515 623 y(of)j(the)h(mac)n(hine)f(dep)r(enden)n(t)i(sh)n
(uttle.)37 b(There)27 b(is)g(no)h(need)f(to)h(call)f(pswitc)n(h.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(DMM::pswitch)j
Fj(and)e Fi(off)p 1460 756 V 29 w(DMM::needs)p 1879 756
V 30 w(switch])h Fj(implementation.)f Fk(i)p Fq(\021)598
847 y Fi(//)39 b(Switches)i(property)h(values.)598 938
y(//)d(Returns)i(either)g(0)e(or)h(an)g(error)g(code.)598
1029 y(err_t)g(off_DMM::pswitch\(const)k(off_dtlb_id_t)f(&to,)d(const)g
(off_shtl_id_t)i(&s\))598 1121 y({)676 1212 y(\(void\)to;\(void\)s;)676
1303 y(return)f(EOK;)598 1395 y(})598 1486 y(//)e(Is)h(pswitch)h(used?)
598 1577 y(boolean_t)g(off_DMM::needs_switch\(void\))598
1669 y({)676 1760 y(return)g(FALSE;)598 1851 y(})515
2117 y Fk(h)p Fi(off)p 667 2117 V 29 w(DMM::pset)29 b
Fj(implementation.)e Fk(i)p Fq(\021)598 2208 y Fi(//)39
b(Set)h(or)g(clear)g(the)g(property)h(at)f(a)f(given)i(shuttle.)598
2300 y(err_t)f(off_DMM::pset\(off_dtlb_id_t)45 b(&pval,const)d
(off_shtl_id_t)g(&s\))598 2391 y({)676 2482 y(off_DTLB)f(*dp;)676
2574 y(off_Shtl)g(*sp;)676 2665 y(make_available\(pval\);)676
2756 y(shtl.make_available\(s\);)676 2848 y
(dp=\(*this\)+\(natural_t\)pval;)676 2939 y(sp=shtl+\(natural_t\)s;)676
3030 y(assert\(dp)g(&&)f(dp->valid\(\)\);)676 3122 y(assert\(sp)h(&&)f
(sp->valid\(\)\);)676 3213 y(return)h
(dp->pset\(sp->get_ctx\(\).get_ele)q(ment)q(\(\)->c)q(_reg)q(s,s\);)598
3304 y(})515 3479 y Fk(h)p Fi(off)p 667 3479 V 29 w(DMM::pclr)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 3570 y Fi(void)79
b(off_DMM::pclr\(const)44 b(off_dtlb_id_t)e(&pval,)e(const)h
(off_shtl_id_t)h(&s\))598 3661 y({)676 3753 y(off_DTLB)f(*dp;)676
3844 y(\(void\)s;)676 3935 y(dp=\(*this\)+\(natural_t\)pval;)676
4027 y(dp->pclr\(\);)598 4118 y(})639 4259 y Fz(The)28
b Ft(dtlb)f Fz(implemen)n(ts)h Fx(pset)e Fz(and)i Fx(pclr)p
Fz(.)515 4375 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4375 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 4467 y Fi(//)39 b(Set)h(or)g(clear)g(this)h(dtlb)f(at)f(a)h
(given)g(context.)598 4558 y(inline)g(err_t)h(pset\(off_mdepProcRegs)j
(*ctx,)c(const)g(off_shtl_id_t)j(&s\);)598 4649 y(inline)d(void)80
b(pclr\(void\);)1885 5255 y Fz(663)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
664 665 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(DTLB::pset)29 b Fj(implementation.)f Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Sets)i(this)f(dtlb)g(at)g(a)f(given)h(context.)598
706 y(inline)g(err_t)h(off_DTLB::pset\(off_mdepProcReg)q(s)k(*ctx,)40
b(const)h(off_shtl_id_t)h(&s\))598 797 y({)676 888 y(reference\(\);)676
980 y(d_mdep.pset\(ctx,s\);)676 1071 y(return)f(EOK;)598
1162 y(})515 1337 y Fk(h)p Fi(off)p 667 1337 V 29 w(DTLB::pclr)29
b Fj(implementation.)f Fk(i)p Fq(\021)598 1428 y Fi(//)39
b(Clears)i(this)f(dtlb)g(at)g(a)f(given)i(context.)598
1519 y(inline)f(void)80 b(off_DTLB::pclr\(void\))598
1611 y({)676 1702 y(unreference\(\);)598 1793 y(})639
1934 y Fz(No)n(w,)29 b(to)g(kno)n(w)g(whic)n(h)g(one)g(is)g(the)g
(curren)n(t)g Ft(dtlb)g Fz(w)n(e)f(should)h(ask)g(for)f(the)i(curren)n
(t)515 2034 y(sh)n(uttle)e(and)f(then)h(ask)f(for)g(its)h
Fx(STHLP)p 1754 2034 27 4 v 29 w(DTLB)e Fz(prop)r(ert)n(y)h(v)-5
b(alue.)515 2150 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l
(ds)e(of)e Fi(off)p 1594 2150 24 4 v 29 w(DMM)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 2242 y Fi(//)39 b(Returns)i(a)f(reference)h
(to)f(the)g(dtlb)g(for)g(the)g(current)g(processor.)598
2333 y(inline)g(off_DTLB)h(*get_current\(void\);)515
2491 y Fk(h)p Fi(off)p 667 2491 V 29 w(DMM::get)p 1008
2491 V 30 w(current)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2582 y Fi(//)39 b(Returns)i(a)f(reference)h(to)f(the)g
(dtlb)g(for)g(the)g(current)g(processor.)598 2673 y(extern)g(inline)h
(off_DTLB)g(*off_DMM::get_current\(void\))k({)676 2765
y(return)c(\(*this\)+off_Shtl::self\(\)->get_)q(dtlb)q(\(\);)598
2856 y(})515 3122 y Fk(h)p Fj(O\013)27 b(DMM)g(late)h(dep)l(endencies.)
h Fk(i)p Fq(\021)598 3213 y Fi(#include)41 b(<shtl/Shtl.h>)515
3487 y Fn(5.3.9)112 b(The)38 b(dtlb)f(for)g(the)g(ro)s(ot)g(sh)m(uttle)
515 3640 y Fz(It)28 b(is)f(created)g(b)n(y)g(the)h(mac)n(hine)f(dep)r
(enden)n(t)i Ft(dtlb)p Fz(.)36 b(See)28 b(section)f(5.4.1)f(for)i
(details.)639 3740 y(Once)g(created,)f(a)h(reference)f(to)g(it)i(is)e
(k)n(ept)h(in)g(a)g(priv)-5 b(ate)27 b(mem)n(b)r(er)h(of)g(the)g
Ft(dmm)g Fz(and)515 3839 y(exp)r(orted)f(b)n(y)g Fx(get)p
1113 3839 27 4 v 30 w(kdtlb)p Fz(.)515 3972 y Fk(h)p
Fj(O\013)g(DMM)g(exp)l(orte)l(d)j(variables.)e Fk(i)p
Fz(+)o Fq(\021)598 4064 y Fi(extern)40 b(off_mdepRootDTLB)j(d_kdtlb;)
515 4238 y Fk(h)p Fj(O\013)27 b(DMM)g(static)i(memb)l(ers.)f
Fk(i)p Fz(+)o Fq(\021)598 4329 y Fi(off_mdepRootDTLB)43
b(d_kdtlb;)515 4504 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i
Fk(i)p Fz(+)o Fq(\021)598 4595 y Fi(#include)41 b
(<dmm/mdep/mRootDTLB.h>)j(//)c(for)g(off_mdepRootDTLB)515
4769 y Fk(h)p Fj(O\013)27 b(DMM)g(implementation)h(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 4861 y Fi(#include)41 b(<klib/ids.h>)598
4952 y(#include)g(<klib/Magic.h>)1885 5255 y Fz(664)p
eop
PStoPSsaved restore
%%Page: (666,667) 334
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
665 666 bop 639 523 a Fz(W)-7 b(e)25 b(m)n(ust)f(pre-initialize)f
(ourselv)n(es)f(the)i(ro)r(ot)f Ft(dtlb)p Fz(,)i(as)e(it)h(do)r(es)g
(not)g(come)f(from)h(the)515 623 y(preinitializing)32
b Ft(dtlb)f Fz(allo)r(cator)f(\(whic)n(h)i(uses)f(the)h(k)n(ernel)e
Ft(dtlb)p Fz(\).)49 b(Note)32 b(ho)n(w)f(it)g(uses)515
722 y(the)d Ft(dmm)f Fz(id.)515 839 y Fk(h)p Fj(Cr)l(e)l(ate)i(the)f(r)
l(o)l(ot)h(dtlb.)e Fk(i)p Fq(\021)598 930 y Fi(\(void\)new\(&d_kdtlb\))
83 b(off_mdepRootDTLB\(get_id\(\),this\))q(;)598 1021
y(\(void\)new\(&d_kdtlb\))g(off_mdepRootDTLB\(get_protection)q(\(\),ge)
q(t_do)q(main)q(\(\)\);)515 1179 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 1179 24 4
v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 1270 y
Fi(static)40 b(inline)h(off_DTLB)g(*get_kdtlb\(void\);)515
1445 y Fk(h)p Fi(off)p 667 1445 V 29 w(DMM::get)p 1008
1445 V 30 w(kdtlb)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
1536 y Fi(extern)40 b(inline)h(off_DTLB)g(*off_DMM::get_kdtlb\(void\))k
({)39 b(return)i(&d_kdtlb;)g(})515 1810 y Fn(5.3.10)112
b(dmm)37 b(miscellaneous)e(utilities)515 1963 y Fz(The)24
b Ft(dmm)g Fz(pro)n(vides)f(metho)r(ds)h(to)h(con)n(v)n(ert)d(from)i(k)
n(ernel)g(virtual)f(to)h(ph)n(ysical)g(addresses)515
2063 y(and)g(vice-v)n(ersa.)34 b(Besides,)24 b(some)g(metho)r(ds)h(to)g
(lo)r(cate)f(user)g(and)g(k)n(ernel)g(p)r(ortions)g(of)h(the)515
2162 y(address)f(space)h(are)f(pro)n(vided)h(to)r(o.)36
b(All)26 b(of)f(them)h(are)f(serviced)f(b)n(y)h(mac)n(hine)g(dep)r
(enden)n(t)515 2262 y(routines.)515 2395 y Fk(h)p Fj(Other)j(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2395 V 29 w(DMM)p Fj(.)g
Fk(i)p Fz(+)p Fq(\021)598 2486 y Fi(//)39 b(get)h(Kernel/User)i(VM)e
(space)g(size)g(and)g(starting)h(vaddress)598 2577 y(static)f(inline)h
(vm_size_t)80 b(get_ksize\(void\);)598 2669 y(static)40
b(inline)h(vm_size_t)80 b(get_usize\(void\);)598 2760
y(static)40 b(inline)h(vm_offset_t)h(get_kstart\(void\);)598
2851 y(static)e(inline)h(vm_offset_t)h(get_ustart\(void\);)598
3034 y(//)d(Convert)i(from)f(kernel)h(virtual)g(to)e(physical)j(and)d
(vice-versa.)598 3125 y(static)h(inline)h(vm_offset_t)h
(kv2phys\(vm_offset_t)h(kv\);)598 3217 y(static)d(inline)h(vm_offset_t)
h(phys2kv\(vm_offset_t)h(p\);)1885 5255 y Fz(665)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
666 667 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(DMM)28 b Fj(c)l(onversion)h(utilities)e(implementation.)h
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(get)h(Kernel/User)i(VM)e(space)g
(size)g(and)g(starting)h(vaddress)598 706 y(extern)f(inline)h
(vm_size_t)80 b(off_DMM::get_ksize\(void\))45 b({)676
797 y(return)c(off_mdepDMM::get_ksize\(\);)598 888 y(})598
980 y(extern)f(inline)h(vm_size_t)80 b(off_DMM::get_usize\(void\))45
b({)676 1071 y(return)c(off_mdepDMM::get_usize\(\);)598
1162 y(})598 1254 y(extern)f(inline)h(vm_offset_t)h
(off_DMM::get_kstart\(void\))j({)676 1345 y(return)c
(off_mdepDMM::get_kstart\(\);)598 1436 y(})598 1528 y(extern)f(inline)h
(vm_offset_t)h(off_DMM::get_ustart\(void\))j({)676 1619
y(return)c(off_mdepDMM::get_ustart\(\);)598 1710 y(})598
1893 y(//)e(Convert)i(from)f(kernel)h(virtual)g(to)e(physical)j(and)d
(vice-versa.)598 1984 y(extern)h(inline)h(vm_offset_t)h
(off_DMM::kv2phys\(vm_offset_t)j(kv\))40 b({)676 2076
y(return)h(off_mdepDMM::kv2phys\(kv\);)598 2167 y(})598
2258 y(extern)f(inline)h(vm_offset_t)h(off_DMM::phys2kv\(vm_offset_t)j
(p\))40 b({)676 2350 y(return)h(off_mdepDMM::phys2kv\(p\);)598
2441 y(})515 2788 y Fn(5.3.11)112 b(dmm)37 b(na)m(vigation)f(and)j
(insp)s(ection)722 2941 y FA(NOTE:)55 b Fz(Not)27 b(y)n(et)h(implemen)n
(ted)515 3152 y FA(dmm)h(na)m(vigation)515 3297 y Fk(h)p
Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p 1493 3297
V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 3388 y
Fi(//)39 b(Returns)i(a)f(navigator)h(for)f(DMMs.)598
3479 y(off_Navigator)i(*get_navigator\(void\))i({)39
b(return)i(NULL;)f(})515 3628 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l
(endencies.)i Fk(i)p Fz(+)o Fq(\021)598 3720 y Fi(#include)41
b(<klib/nav.h>)434 b(//)40 b(for)g(off_Navigator)i(et)d(al.)515
3959 y FA(dmm)29 b(insp)s(ection)515 4112 y Fz(W)-7 b(e)28
b(ha)n(v)n(e)e(to)i(implemen)n(t)g(these)f(t)n(w)n(o)g(metho)r(ds.)515
4222 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4222 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
4313 y Fi(//)39 b(Get)h(the)g(DMM)g(URL.)598 4405 y(const)g(char)g
(*get_url\(void\);)598 4496 y(//)f(Returns)i(the)f(DMM)g(name.)598
4587 y(const)g(char)g(*nameof\(void\);)639 4705 y Fz(The)27
b(URL)h(for)e(a)g Ft(dmm)h Fz(is)g(that)g(of)g(its)g(no)r(de)g(with)h
Fx(DMM.html)23 b Fz(app)r(ended.)37 b(W)-7 b(e)28 b(use)e(a)515
4805 y(new)h(mem)n(b)r(er,)h(a)f(c)n(haracter)f(arra)n(y)f(initialized)
j(the)g(v)n(ery)e(\014rst)h(time)i(it)f(is)f(needed.)515
4915 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4915 V 29 w(DMM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 5006 y Fi(static)40 b(char)g(*d_url;)512
b(//)40 b(URL)g(for)g(this)g(DMM.)1885 5255 y Fz(666)p
eop
PStoPSsaved restore
%%Page: (668,669) 335
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
667 668 bop 639 523 a Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 637 y Fk(h)p Fj(O\013)27 b(DMM)g(static)i(memb)l(ers.)f
Fk(i)p Fz(+)o Fq(\021)598 728 y Fi(char)40 b(*off_DMM::d_url=NULL;)83
b(//)40 b(URL)g(for)g(this)g(DMM.)515 879 y Fk(h)p Fi(off)p
667 879 24 4 v 29 w(DMM::get)p 1008 879 V 30 w(url)28
b Fj(implementation.)f Fk(i)p Fq(\021)598 970 y Fi(//)39
b(Get)h(the)g(DMM)g(URL.)598 1062 y(const)g(char)g
(*off_DMM::get_url\(void\))598 1153 y({)676 1244 y
(assert\(valid\(\)\);)676 1336 y(if)g(\(!d_url\){)755
1427 y(d_url=new)h(char[strlen\(nd.get_url\(\)\)+str)q(len\(O)q(FF_D)q
(MM_UR)q(L\)+1)q(];)k(//+1)40 b(for)g(\\0)755 1518 y(if)f(\(d_url\){)
833 1610 y(strcpy\(d_url,nd.get_url\(\)\);)833 1701 y
(strcat\(d_url,OFF_DMM_URL\);)755 1792 y(})676 1884 y(})676
1975 y(return)i(d_url;)598 2066 y(})639 2294 y Fz(Where)28
b(he)f(ha)n(v)n(e)g(to)g(de\014ne)h(the)g(relativ)n(e)f(URL)g(for)h
Ft(dmm)p Fz(s.)515 2408 y Fk(h)p Fj(O\013)f(sour)l(c)l(e)i(c)l(o)l(de)g
(urls.)e Fk(i)p Fq(\021)598 2499 y Fi(const)40 b(char)g
(OFF_DMM_URL[]="/DMM.html";)515 2650 y Fk(h)p Fj(O\013)27
b(DMM)g(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
2742 y Fi(#include)41 b(<klib/url.h>)434 b(//)40 b(for)g(OFF_DMM_URL)
515 2907 y Fk(h)p Fj(O\013)27 b(DMM)g(implementation)h(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2998 y Fi(#include)41
b(<string.h>)512 b(//)40 b(for)g(strcat)g(strdup)h(et)e(al)598
3089 y(#include)i(<node/Node.h>)395 b(//)40 b(for)g(nd)639
3226 y Fz(The)32 b(name)f(for)g(a)g Ft(dmm)h Fz(is)f(that)h(of)g(its)f
(no)r(de)h(complemen)n(ted)g(with)g(a)f(little)h(su\016x.)515
3325 y(The)27 b(implemen)n(tation)h(is)g(almost)f(the)h(same)f(of)g
Fx(get)p 2212 3325 27 4 v 30 w(url)p Fz(.)515 3454 y
Fk(h)p Fi(off)p 667 3454 24 4 v 29 w(DMM::nameof)i Fj(implementation.)f
Fk(i)p Fq(\021)598 3545 y Fi(//)39 b(Returns)i(the)f(DMM)g(name.)598
3636 y(const)g(char)g(*off_DMM::nameof\(void\))598 3728
y({)676 3819 y(assert\(valid\(\)\);)676 3910 y(if)g(\(!d_name\){)755
4002 y(d_name)g(=)g(new)g(char[strlen\(nd.nameof\(\)\)+strlen)q(\("/D)q
(MM"\)+)q(9];)46 b(//)39 b(for)h(N...N\\0)755 4093 y(if)f(\(d_name\){)
833 4184 y(char)h(number[9];)833 4276 y
(strcpy\(d_name,nd.nameof\(\)\);)833 4367 y(strcat\(d_name,"/DMM"\);)
833 4458 y(sprintf\(number,"\04508x",\(natura)q(l_t\))q(get_)q
(id\(\)\))q(;)833 4550 y(strcat\(d_name,number\);)755
4641 y(})676 4732 y(})676 4824 y(return)h(d_name;)598
4915 y(})1885 5255 y Fz(667)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
668 669 bop 515 523 a Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 523 24 4 v 29 w(DMM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 614 y Fi(char)40 b(*d_name;)708 b(//)39 b(name)i(for)f
(this)g(DMM.)515 789 y Fk(h)p Fj(Initialize)26 b(other)j(aggr)l(e)l
(gate)h(memb)l(ers)f(of)e Fi(off)p 1928 789 V 29 w(DMM)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 880 y Fi(d_name\(NULL\))515
1054 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1054 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
1146 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(DMM.)598
1237 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})515 1494 y FA(dtlb)31 b(insp)s(ection)515
1639 y Fk(h)p Fj(Other)d(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1639 V 29 w(DTLB)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
1731 y Fi(//)39 b(Returns)i(an)f(inspector)h(for)f(DTLB.)598
1822 y(off_Inspector)i(*get_inspector\(void\))i({)39
b(return)i(NULL;)f(})639 1963 y Fz(W)-7 b(e)19 b(need)g
Fx(get)p 1095 1963 27 4 v 30 w(rurl)d Fz(and)j Fx(get)p
1602 1963 V 30 w(url)p 1764 1963 V 30 w(holder)d Fz(for)i
Ft(dtlb)p Fz(s)g(to)g(supp)r(ort)g Fx(ResUnit::get)p
3353 1963 V 26 w(url)p Fz(.)515 2096 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
2096 24 4 v 29 w(DTLB)p Fj(.)h Fk(i)o Fz(+)p Fq(\021)598
2187 y Fi(//)39 b(Get)h(the)g(DTLB)g(url)598 2279 y(virtual)h(const)f
(char)g(*get_rurl\(void\))j(const)d({)g(return)g(OFF_DTLB_URL;)i(})598
2370 y(//)d(Returns)i(the)f(DTLB)g(name.)598 2461 y(virtual)h(char)f
(*&get_url_holder\(void\);)639 2602 y Fz(He)28 b(ha)n(v)n(e)f(to)g
(de\014ne)h(the)g(relativ)n(e)e(URL)i(for)f Ft(dtlb)p
Fz(s)515 2719 y Fk(h)p Fj(O\013)g(sour)l(c)l(e)i(c)l(o)l(de)g(urls.)e
Fk(i)p Fz(+)p Fq(\021)598 2810 y Fi(const)40 b(char)g
(OFF_DTLB_URL[]="#DTLB";)515 2968 y Fk(h)p Fj(O\013)27
b(DTLB)g(dep)l(endencies.)i Fk(i)p Fz(+)p Fq(\021)598
3059 y Fi(#include)41 b(<klib/url.h>)434 b(//)40 b(for)g(OFF_DTLB_URL)
598 3150 y(#include)h(<stdio.h>)551 b(//)40 b(for)g(sprintf)g(et)g(al)
639 3291 y Fz(URLs)28 b(are)f(the)h(same)f(for)g(all)g
Ft(dtlb)p Fz(s.)515 3408 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)
g Fi(off)p 1552 3408 V 29 w(DTLB)p Fj(.)f Fk(i)p Fq(\021)598
3499 y Fi(static)40 b(char)g(*d_url;)512 b(//)40 b(URL)g(for)g(this)g
(DTLB.)515 3657 y Fk(h)p Fi(off)p 667 3657 V 29 w(DTLB::get)p
1047 3657 V 30 w(url)p 1194 3657 V 29 w(holder)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 3748 y Fi(char)40 b
(*&off_DTLB::get_url_holder\(voi)q(d\))45 b({)79 b(return)41
b(d_url;)f(})639 3981 y Fz(Initially)28 b(it)g(is)f(empt)n(y)-7
b(.)515 4097 y Fk(h)p Fj(O\013)27 b(DTLB)g(static)i(memb)l(ers.)f
Fk(i)p Fq(\021)598 4188 y Fi(char)40 b(*off_DTLB::d_url=NULL;)123
b(//)39 b(URL)h(for)g(DTLBs.)515 4445 y Fn(5.3.12)112
b(F)-9 b(rozen)38 b(dmms)722 4599 y FA(NOTE:)55 b Fz(Not)27
b(y)n(et)h(implemen)n(ted)1885 5255 y(668)p eop
PStoPSsaved restore
%%Page: (670,671) 336
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
669 670 bop 515 523 a FA(F)-8 b(reezing)33 b(dmms)515
668 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 668 24 4 v 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 759 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
851 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 942 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
1033 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 1125
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 1216
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
1307 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
1399 y(return)e(ENOSYS;)598 1490 y(})598 1673 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
1764 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 1855 y(\(void\)curto;)h(\(void\)toavail;)
676 1947 y(return)f(ENOSYS;)598 2038 y(})515 2212 y Fk(h)p
Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2212 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2304 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
2395 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 2486 y(//)f(return.)598
2577 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
2669 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 2760 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 2851 y(\(void\)buf;)h
(\(void\)bsize;)676 2943 y(return)f(ENOSYS;)598 3034
y(})598 3125 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
3217 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 3308 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 3399 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
3491 y(return)f(ENOSYS;)598 3582 y(})1885 5255 y Fz(669)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
670 671 bop 515 523 a FA(F)-8 b(reezing)33 b(dtlbs)515
668 y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 668 24 4 v 29 w(DTLB)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 759 y Fi(//)39 b(These)i(are)f(for)g(freeze:)598
851 y(//)f(Freeze)i(dynamic)g(resource)g(state)f(at)g(curbuf)h(in)e
(buf)h(with)g(avail)h(bytes.)598 942 y(virtual)g(err_t)f
(freeze_state\(char)j(*buf,)d(char)h(*&curbuf,)g(size_t)f(&avail,)1657
1033 y(char)g(*&curto,)h(size_t)g(&toavail,)1657 1125
y(const)f(off_prtl_id_t)i(&frozen_domain\))h({)676 1307
y(\(void\)buf;)f(\(void\)curbuf;)g(\(void\)avail;)g(\(void\)curto;)676
1399 y(\(void\)toavail;)h(\(void\)frozen_domain;)676
1490 y(return)e(ENOSYS;)598 1581 y(})598 1764 y(//)e(Copy)i(static)f
(resource)h(state)g(in)e(curbuf)i(with)f(toavail)h(bytes.)598
1855 y(virtual)g(err_t)f(copy_state\(char)j(*&curto,)e(size_t)f
(&toavail\))h(const)g({)676 1947 y(\(void\)curto;)h(\(void\)toavail;)
676 2038 y(return)f(ENOSYS;)598 2129 y(})515 2304 y Fk(h)p
Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2304 V 29 w(DTLB)p Fj(.)h Fk(i)o Fz(+)p
Fq(\021)598 2395 y Fi(//)39 b(These)i(are)f(for)g(melt:)598
2486 y(//)f(Does)i(resource)g(cleanup.)g(No)e(external)i(resource)g
(should)g(be)f(used)g(after)598 2577 y(//)f(return.)598
2669 y(virtual)i(err_t)f(cleanup\(void\))i({)e(return)g(ENOSYS;)h(})598
2760 y(//)e(Restores)i(the)f(static)h(state)f(from)g(a)g(user)g
(supplied)h(buffer.)598 2851 y(virtual)g(err_t)f(restore_state\(char)j
(*&buf,)e(size_t)f(&bsize\))h({)676 2943 y(\(void\)buf;)h
(\(void\)bsize;)676 3034 y(return)f(ENOSYS;)598 3217
y(})598 3308 y(//)e(Restores)i(dynamic)g(resource)g(state.)598
3399 y(virtual)g(err_t)f(melt_state\(char)j(*&buf,)d(size_t)h(&bsize,)g
(char)f(*&from,)h(size_t)f(&size,)1578 3491 y(const)h(off_prtl_id_t)h
(&melted_domain\))h({)676 3582 y(\(void\)buf;)f(\(void\)bsize;)g
(\(void\)from;)f(\(void\)size;)h(\(void\)melted_domain;)676
3673 y(return)f(ENOSYS;)598 3765 y(})515 4130 y Fn(5.3.13)112
b(Dumping)38 b(dmms)515 4283 y Fz(T)-7 b(o)27 b(dump)h(a)f
Ft(dmm)h Fz(w)n(e)f(use)h(this)f(op)r(erator.)515 4399
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4399 V 29 w(DMM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
4491 y Fi(//)39 b(Dumps)i(dtlb)f(state.)598 4582 y(friend)g(OStr)g
(&operator<<\(OStr)j(&s,)79 b(off_DMM)41 b(&d\);)1885
5255 y Fz(670)p eop
PStoPSsaved restore
%%Page: (672,673) 337
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
671 672 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(DMM::operator<<)30 b Fj(implementation.)e Fk(i)p
Fq(\021)598 614 y Fi(//)39 b(Dumps)i(DMM)f(state.)598
706 y(OStr)g(&operator<<\(OStr)j(&s,)79 b(off_DMM)41
b(&d\))598 797 y({)676 888 y(s)f(<<)f(*\(off_HWCompResource*\)&d;)676
980 y(s)h(<<)f("name=")i(<<)f(d.nameof\(\))h(<<)f(")f(url=")i(<<)f
(d.get_url\(\))h(<<)f(nl;)676 1071 y(return)h(s;)598
1162 y(})515 1428 y Fk(h)p Fj(O\013)27 b(DMM)g(implementation)h(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 1519 y Fi(#include)41
b(<klib/str.h>)434 b(//)40 b(for)g(OStr)g(et)f(al.)515
1793 y Fn(5.3.14)112 b(dtlbs)37 b(for)g(plain)g(users)515
1946 y Fz(Users)27 b(can)g(handle)g(their)h Ft(dtlb)p
Fz(s)f(through)g(the)h Ft(dtlb)f Fz(and)h Ft(dmm)f Fz(wrapp)r(ers)515
2079 y Fk(h)p Fj(O\013)g(DMM)g(for)g(users.)i Fk(i)p
Fq(\021)598 2171 y Fi(class)40 b(off_uDMM)h(:)f(public)g
(off_uAbsCompResource)k({)598 2262 y(public:)598 2353
y(#ifdef)c(__KERNEL__)676 2445 y(off_uDMM\(off_DMM)j(*r\):)d
(off_uAbsCompResource\(r\))45 b({;})676 2536 y(off_uDMM\(off_DMM)e
(&r\):)d(off_uAbsCompResource\(&r\))45 b({;})598 2627
y(#endif)676 2719 y(off_uDMM\(void\))e({;})676 2810 y(off_uDMM\(const)g
(off_id_t)e(&id\):)f(off_uAbsCompResource\(id\))45 b({;})598
2993 y(#ifndef)c(__KERNEL__)676 3084 y Fk(h)p Fj(O\013)27
b(DMM)g(for)h(users)h(metho)l(ds.)f Fk(i)598 3267 y Fi(#endif)598
3449 y(};)1885 5255 y Fz(671)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
672 673 bop 515 523 a FA(allo)s(c)41 b Fz(Allo)r(cates)27
b(a)g Ft(dtlb)g Fz(at)h(the)g(giv)n(en)f(id.)37 b(Receiv)n(es:)822
689 y Fq(\017)k Fz(Desired)27 b(id)h Fx(at)p Fz(.)822
822 y Fq(\017)41 b Fz(Protection)26 b Fx(p)h Fz(and)h
Fx(domain)d Fz(for)i(the)h(new)h Ft(dtlb)p Fz(.)822 955
y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h
(domain)f Fx(dr)p Fz(.)822 1088 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(serv)n(er)e
Fx(r)p Fz(.)722 1220 y Fk(h)p Fj(O\013)h(DMM)g(for)h(users)h(metho)l
(ds.)f Fk(i)p Fq(\021)805 1312 y Fi(//)40 b(Allocates)h(a)f(DTLB.)805
1403 y(off_uDTLB)i(alloc\(const)f(off_dtlb_id_t)i(&at,)1433
1494 y(off_Protection)f(p,)1433 1586 y(off_prtl_id_t)81
b(domain,)1433 1677 y(off_Rights)41 b(dr,)1433 1768 y(off_Rights)g
(r\){)884 1860 y(off_dmm_allocat_req)i(req\(at,p,domain,dr,r\);)884
1951 y(off_dmm_allocat_rep)g(rep;)884 2042 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 2134 y(if)f(\(err)i(||)e
(rep.m_err\))962 2225 y(errno=\(err\)?err:rep.m_err;)884
2316 y(return)h(rep.res;)805 2408 y(})722 2615 y Fk(h)p
Fj(O\013)27 b(DMM)g(messages.)i Fk(i)p Fq(\021)805 2707
y Fi(#define)41 b(OFF_MSG_DMM_ALLOCAT)j(0x01f)884 2798
y(struct)c(off_dmm_allocat_req:)k(public)d(off_KernReq)g({)962
2889 y(off_dtlb_id_t)82 b(id;)962 2980 y(off_Protection)43
b(prot;)962 3072 y(off_prtl_id_t)82 b(dom;)962 3163 y(off_Rights)199
b(drights;)962 3254 y(off_dmm_allocat_req\(const)45 b(off_dtlb_id_t)d
(&at,)1276 3346 y(off_Protection)g(p,)1276 3437 y(off_prtl_id_t)81
b(domain,)1276 3528 y(off_Rights)42 b(dr,)1276 3620 y(off_Rights)g
(r\):)1041 3711 y(id\(at\),prot\(p\),dom\(domain\),dri)q(ghts\()q
(dr\),)1041 3802 y(off_KernReq\(OFF_MSG_DMM_ALLOCA)q(T,r\))k({;})884
3894 y(};)884 3985 y(struct)40 b(off_dmm_allocat_rep:)k(public)d
(off_KernRep)g({)962 4076 y(off_dtlb_id_t)h(res;)962
4168 y(off_dmm_allocat_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i
({;})884 4259 y(};)1885 5255 y Fz(672)p eop
PStoPSsaved restore
%%Page: (674,675) 338
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
673 674 bop 515 523 a FA(allo)s(c)41 b Fz(Allo)r(cates)27
b(a)g Ft(dtlb)p Fz(.)37 b(Receiv)n(es:)822 689 y Fq(\017)k
Fz(Protection)26 b Fx(p)h Fz(and)h Fx(domain)d Fz(for)i(the)h(new)h
Ft(dtlb)822 822 y Fq(\017)41 b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h
(for)g(the)h(domain)f Fx(dr)p Fz(.)822 955 y Fq(\017)41
b Fz(W)-7 b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h(serv)n(er)e
Fx(r)p Fz(.)722 1088 y Fk(h)p Fj(O\013)h(DMM)g(for)h(users)h(metho)l
(ds.)f Fk(i)p Fz(+)p Fq(\021)805 1179 y Fi(//)40 b(Allocates)h(any)f
(DTLB.)805 1270 y(off_uDTLB)i(alloc\(off_Protection)h(p,)1433
1362 y(off_prtl_id_t)81 b(domain,)1433 1453 y(off_Rights)41
b(dr,)1433 1544 y(off_Rights)g(r\){)884 1636 y(off_dmm_alloc_req)i
(req\(p,domain,dr,r\);)884 1727 y(off_dmm_alloc_rep)g(rep;)884
1818 y(err_t)d(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q
(q\),si)q(zeof)q(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884
1910 y(if)f(\(err)i(||)e(rep.m_err\))962 2001 y
(errno=\(err\)?err:rep.m_err;)884 2092 y(return)h(rep.res;)805
2183 y(})722 2482 y Fk(h)p Fj(O\013)27 b(DMM)g(messages.)i
Fk(i)p Fz(+)p Fq(\021)805 2574 y Fi(#define)41 b(OFF_MSG_DMM_ALLOC)i
(0x02f)884 2665 y(struct)d(off_dmm_alloc_req:)k(public)c(off_KernReq)i
({)962 2756 y(off_Protection)h(prot;)962 2848 y(off_prtl_id_t)82
b(dom;)962 2939 y(off_Rights)199 b(drights;)962 3030
y(off_dmm_alloc_req\(off_Protec)q(tion)46 b(p,)1668 3122
y(off_prtl_id_t)82 b(domain,)1354 3213 y(off_Rights)42
b(dr,)1668 3304 y(off_Rights)g(r\):)1041 3396 y
(prot\(p\),dom\(domain\),drights\(dr)q(\),)1041 3487
y(off_KernReq\(OFF_MSG_DMM_ALLOC,)q(r\))j({;})884 3578
y(};)884 3670 y(struct)40 b(off_dmm_alloc_rep:)k(public)c(off_KernRep)i
({)962 3761 y(off_dtlb_id_t)g(res;)962 3852 y(off_dmm_alloc_rep\(err_t)
j(r=0\))40 b(:)f(off_KernRep\(r\))k({;})884 3944 y(};)1885
5255 y Fz(673)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
674 675 bop 515 523 a FA(free)41 b Fz(Deallo)r(cates)27
b(a)g Ft(dtlb)p Fz(.)37 b(Receiv)n(es:)822 689 y Fq(\017)k
Fz(The)28 b Ft(dtlb)f Fz(id)h Fx(s)822 822 y Fq(\017)41
b Fz(Delete)28 b(access)e(righ)n(ts)h(for)g(the)h Ft(dtlb)f
Fx(r)p Fz(.)722 955 y Fk(h)p Fj(O\013)g(DMM)g(for)h(users)h(metho)l
(ds.)f Fk(i)p Fz(+)p Fq(\021)805 1046 y Fi(//)40 b(Deallocates)i(a)d
(DTLB)805 1137 y(void)h(free\()h(off_uDTLB)g(s,)f(off_Rights)h(r\){)884
1229 y(off_dmm_free_req)i(req\(s.get_id\(\),r\);)884
1320 y(off_dmm_free_rep)g(rep;)884 1411 y(err_t)d
(err=off_prtl_pct\(get_prtl\(\),)q(sizeo)q(f\(re)q(q\),si)q(zeof)q
(\(rep)q(\),&re)q(q,&r)q(ep,0\))q(;)884 1503 y(if)f(\(err)i(||)e
(rep.m_err\))962 1594 y(errno=\(err\)?err:rep.m_err;)805
1685 y(})722 1893 y Fk(h)p Fj(O\013)27 b(DMM)g(messages.)i
Fk(i)p Fz(+)p Fq(\021)805 1984 y Fi(#define)41 b(OFF_MSG_DMM_FREE)i
(0x03f)884 2076 y(struct)d(off_dmm_free_req:)j(public)e(off_KernReq)h
({)962 2167 y(off_dtlb_id_t)82 b(id;)962 2258 y
(off_dmm_free_req\(off_dtlb_id)q(_t)45 b(s,)40 b(off_Rights)h(r\):)f
(id\(s\),)1041 2350 y(off_KernReq\(OFF_MSG_DMM_FREE,r)q(\))45
b({;})884 2441 y(};)884 2532 y(struct)40 b(off_dmm_free_rep:)j(public)e
(off_KernRep)h({)962 2623 y(off_dmm_free_rep\(err_t)i(r=0\))d(:)e
(off_KernRep\(r\))j({;})884 2715 y(};)515 3055 y Fk(h)p
Fj(uDMM.h*)11 b Fk(i)o Fq(\021)598 3238 y Fk(h)p Fj(O\013)27
b(DMM)g(messages.)i Fk(i)598 3603 y(h)p Fj(O\013)e(DMM)g(for)g(users.)i
Fk(i)1885 5255 y Fz(674)p eop
PStoPSsaved restore
%%Page: (676,677) 339
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
675 676 bop 515 523 a Fk(h)p Fj(kDMM.h*)11 b Fk(i)o Fq(\021)598
614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g(MODIFY)g
(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h(source)g
(file)g(generated)i(by)d(the)h(noweb)h(literate)598 980
y(//)e(programming)j(tool.)598 1071 y(//)598 1162 y(//)d(If)h(you)g
(have)g(the)g(chance)h(read)f(the)g(literate)h(source)f(code)g
(instead.)598 1254 y(//)598 1436 y(#include)h(<dmm/DMM.h>)238
b(//)39 b(Exported)i(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 2076 y(#ifndef)g(__OFF_KDMM_H)598
2167 y(#define)g(__OFF_KDMM_H)h(1)598 2258 y(#ifdef)e(__KERNEL__)598
2441 y(class)g(off_kDMM)h(:)f(public)g(off_kAbsCompResource)k({)598
2532 y(public:)676 2623 y(static)d(err_t)f(handler\(const)i
(off_shtl_id_t)h(&sender,)1500 2715 y(vm_size_t)e(msz,)f(vm_size_t)i
(rsz,)1500 2806 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)676
2989 y(virtual)g(err_t)f(handle\(const)i(off_shtl_id_t)h(&sender,)1500
3080 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500 3171
y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))f({)755 3263
y(return)g(off_kResource::handle\(sender)q(,msz)q(,rsz,)q(m,r\))q(;)676
3354 y(})676 3537 y(void)g(allocat\(off_dmm_allocat_req)46
b(*m,off_dmm_allocat_rep)83 b(*r\))676 3628 y({)755 3719
y(off_DTLB)41 b(*d;)755 3811 y(d)196 b(=new\(m->id\))42
b(off_DTLB\(m->prot,m->dom\);)755 3902 y(if)d(\(!d\))833
3993 y(r->m_err=EAGAIN;)755 4085 y(r->res=\(d\)?d->get_id\(\):OFF_DTLB)
q(_NUL)q(L;)676 4176 y(})676 4267 y(void)h(alloc\(off_dmm_alloc_req)45
b(*m,off_dmm_alloc_rep)83 b(*r\))676 4359 y({)755 4450
y(off_DTLB)41 b(*d;)755 4541 y(d)196 b(=new)315 b
(off_DTLB\(m->prot,m->dom\);)755 4633 y(if)39 b(\(!d\))833
4724 y(r->m_err=EAGAIN;)755 4815 y(r->res=\(d\)?d->get_id\(\):OFF_DTLB)
q(_NUL)q(L;)676 4907 y(})676 4998 y(void)h(free\(off_dmm_free_req)k
(*m,off_dmm_free_rep)83 b(*r\))1885 5255 y Fz(675)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
676 677 bop 676 523 a Fi({)755 614 y(\(void\)r;)755 706
y(if)39 b(\(!dmm.is_local\(m->id\)\))833 797 y(panic\("dmm:)j(should)e
(raise)h(missing,)g(but)f(not)g(yet)g(implemented."\);)755
888 y(\(dmm+m->id\)->unreference\(\);)676 980 y(})598
1162 y(};)598 1436 y(extern)g(off_kDMM)h(kdmm;)598 1619
y(#endif)f(//)g(__KERNEL__)598 1710 y(#endif)g(//)g(__OFF_KDMM_H)1885
5255 y Fz(676)p eop
PStoPSsaved restore
%%Page: (678,679) 340
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
677 678 bop 515 523 a Fk(h)p Fj(kDMM.C*)11 b Fk(i)o Fq(\021)598
614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g(MODIFY)g
(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h(source)g
(file)g(generated)i(by)d(the)h(noweb)h(literate)598 980
y(//)e(programming)j(tool.)598 1071 y(//)598 1162 y(//)d(If)h(you)g
(have)g(the)g(chance)h(read)f(the)g(literate)h(source)f(code)g
(instead.)598 1254 y(//)598 1436 y(#include)h(<dmm/DMM.h>)238
b(//)39 b(Exported)i(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1893 y(#include)g(<dmm/kDMM.h>)598 1984 y(#include)g(<dmm/kDTLB.h>)598
2258 y(off_kDMM)g(kdmm;)598 2441 y(err_t)f(off_kDMM::handler\(const)45
b(off_shtl_id_t)d(&sender,)1657 2532 y(vm_size_t)f(msz,)f(vm_size_t)i
(rsz,)1657 2623 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\))598
2715 y({)676 2806 y(//kcout)g(<<)f("nd:)g(call)g(from)g(")g(<<)f
(sender)i(<<)f(")f(";)676 2897 y(//kcout)i(<<fmt\("msg@\04508x)i
(",\(vm_offset_t\)m\))g(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)
676 2989 y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 3080 y
(do_debug\(printf\("dmm[\045x]",m-)q(>m_ty)q(pe\)\))q(;)676
3171 y(r->m_err=EOK;)676 3263 y(if)h(\(m->m_type&OFF_MSG_ROBJ_MASK\){)
755 3354 y(off_dtlb_id_t)i(d=\(\(off_ObjKernReq*\)m\)->obj;)755
3445 y(if)d(\(!dmm.is_local\(d\)\))833 3537 y(panic\("dmm:)j(should)e
(raise)h(missing,)g(but)f(not)g(yet)g(implemented."\);)755
3628 y(else)g({)833 3719 y(off_kDTLB)h(kd\(dmm+d\);)833
3811 y(return)g(kd.handle\(sender,msz,rsz,\(off_)q(ObjKe)q(rnRe)q
(q*\)m,)q(r\);)755 3902 y(})676 3993 y(})676 4085 y
(switch\(m->m_type\){)676 4176 y(case)f(OFF_MSG_R_INIT:)755
4267 y(return)g(EOK;)676 4359 y(case)g(OFF_MSG_DMM_ALLOCAT:)755
4450 y(if)f(\(!dmm.access_granted\(OFF_OP_)q(W,m-)q(>m_r)q(ights)q
(\)\))833 4541 y(r->m_err=)i(EPERM;)755 4633 y(else)f(if)f
(\(msz!=sizeof\(off_dmm_alloca)q(t_re)q(q\))45 b(||)40
b(rsz!=sizeof\(off_dmm_allocat_re)q(p\)\))833 4724 y(r->m_err=)h
(EINVAL;)755 4815 y(else)f({)833 4907 y
(kdmm.allocat\(\(off_dmm_allocat)q(_req)q(*\)m,)q(\(off_)q(dmm_)q
(alloc)q(at_r)q(ep*\))q(r\);)755 4998 y(})1885 5255 y
Fz(677)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
678 679 bop 755 523 a Fi(return)40 b(EOK;)676 614 y(case)g
(OFF_MSG_DMM_ALLOC:)755 706 y(if)f(\(!dmm.access_granted\(OFF_OP_)q
(W,m-)q(>m_r)q(ights)q(\)\))833 797 y(r->m_err=)i(EPERM;)755
888 y(else)f(if)f(\(msz!=sizeof\(off_dmm_alloc_)q(req\))46
b(||)39 b(rsz!=sizeof\(off_dmm_alloc_r)q(ep\)\))833 980
y(r->m_err=)i(EINVAL;)755 1071 y(else)f({)833 1162 y
(kdmm.alloc\(\(off_dmm_alloc_req)q(*\)m,)q(\(off)q(_dmm_)q(allo)q
(c_rep)q(*\)r\))q(;)755 1254 y(})755 1345 y(return)g(EOK;)637
1436 y(case)g(OFF_MSG_DMM_FREE:)755 1528 y(if)f
(\(msz!=sizeof\(off_dmm_free_re)q(q\))45 b(||)40 b
(rsz!=sizeof\(off_dmm_free_rep\))q(\))833 1619 y(r->m_err=)h(EINVAL;)
755 1710 y(else)f({)833 1802 y(kdmm.free\(\(off_dmm_free_req*\))q
(m,\(o)q(ff_d)q(mm_fr)q(ee_r)q(ep*\)r)q(\);)755 1893
y(})755 1984 y(return)g(EOK;)676 2076 y(default:)755
2167 y(return)g(\(\(off_kAbsCompResource*\)&kdm)q(m\)->)q(handl)q
(e\(se)q(nder,)q(msz,)q(rsz,)q(m,r\);)676 2258 y(})598
2350 y(})515 2889 y Fk(h)p Fj(O\013)27 b(DTLB)g(for)h(users.)g
Fk(i)p Fq(\021)598 2980 y Fi(class)40 b(off_uDTLB)h(:)f(public)g
(off_uAbsResUnit)j({)598 3072 y(public:)598 3163 y(#ifdef)d(__KERNEL__)
676 3254 y(off_uDTLB\(off_DTLB)k(*r\):)c(off_uAbsResUnit\(r\))j({;})676
3346 y(off_uDTLB\(off_DTLB)h(&r\):)c(off_uAbsResUnit\(&r\))j({;})598
3437 y(#endif)676 3528 y(off_uDTLB\(void\))g({;})676
3620 y(off_uDTLB\(const)g(off_id_t)e(&id\):)f(off_uAbsResUnit\(id\))k
({;})598 3802 y(#ifndef)d(__KERNEL__)676 3894 y Fk(h)p
Fj(O\013)27 b(DTLB)h(for)f(users)i(metho)l(ds.)g Fk(i)598
4076 y Fi(#endif)598 4259 y(};)1885 5255 y Fz(678)p eop
PStoPSsaved restore
%%Page: (680,681) 341
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
679 680 bop 515 523 a FA(map)40 b Fz(Installs)27 b(an)h(address)e
(translation.)36 b(Receiv)n(es:)822 689 y Fq(\017)41
b Fz(The)28 b(address)e(translation)g Fx(tr)p Fz(.)822
822 y Fq(\017)41 b Fz(Access)27 b(righ)n(ts)g(for)g(the)h(page)e(frame)
i Fx(pr)p Fz(.)822 955 y Fq(\017)41 b Fz(W)-7 b(rite)28
b(access)e(righ)n(ts)h(for)g(the)h Ft(dtlb)f Fx(r)p Fz(.)722
1088 y Fk(h)p Fj(O\013)g(DTLB)h(for)f(users)i(metho)l(ds.)g
Fk(i)p Fq(\021)805 1179 y Fi(err_t)41 b(map\(off_AddrTr)h(tr,)e
(off_Rights)i(pr,)d(off_Rights)j(r\){)884 1270 y(off_dtlb_map_req)h
(req\(w_p,tr,pr,r\);)884 1362 y(off_dtlb_map_rep)g(rep;)884
1453 y(err_t)d(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()
q(\),)1786 1544 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
1636 y(if)f(\(err)i(||)e(rep.m_err\))962 1727 y(return)i
(errno=\(err\)?err:rep.m_err;)884 1818 y(return)f(EOK;)805
1910 y(})722 2208 y Fk(h)p Fj(O\013)27 b(DTLB)h(messages.)h
Fk(i)p Fq(\021)805 2300 y Fi(#define)41 b(OFF_MSG_DTLB_MAP)i(0x011f)884
2391 y(struct)d(off_dtlb_map_req:)j(public)e(off_ObjKernReq)h({)962
2482 y(off_AddrTr)g(attr;)962 2574 y(off_Rights)g(pright;)962
2665 y(off_dtlb_map_req\(off_id_t)j(me,)40 b(off_AddrTr)i(tr,)d
(off_Rights)j(pr,)1315 2756 y(off_Rights)g(r\))d(:)h
(attr\(tr\),pright\(pr\),)1041 2848 y(off_ObjKernReq\(me,OFF_MSG_DTLB)q
(_MAP,)q(r\){;)q(})884 2939 y(};)884 3030 y(struct)g(off_dtlb_map_rep:)
j(public)e(off_KernRep)h({)962 3122 y(off_dtlb_map_rep\(err_t)i(r=0\))d
(:)e(off_KernRep\(r\))j({;})884 3213 y(};)515 3454 y
FA(unmap)e Fz(Deinstalls)28 b(a)f(translation.)36 b(Receiv)n(es:)822
3620 y Fq(\017)41 b Fz(The)28 b(virtual)f(address)f Fx(at)p
Fz(.)822 3753 y Fq(\017)41 b Fz(The)28 b(size)f(in)h(b)n(ytes)f(to)g(b)
r(e)h(deinstalled)g Fx(sz)822 3885 y Fq(\017)41 b Fz(W)-7
b(rite)28 b(access)e(righ)n(ts)h(for)g(the)h Ft(dtlb)f
Fx(r)p Fz(.)722 4018 y Fk(h)p Fj(O\013)g(DTLB)h(for)f(users)i(metho)l
(ds.)g Fk(i)p Fz(+)o Fq(\021)805 4110 y Fi(err_t)41 b
(unmap\(vm_offset_t)i(at,)d(vm_size_t)h(sz,)f(off_Rights)h(r\){)884
4201 y(off_dtlb_unmap_req)i(req\(w_p,at,sz,r\);)884 4292
y(off_dtlb_unmap_rep)g(rep;)884 4384 y(err_t)d
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1786
4475 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
4566 y(if)f(\(err)i(||)e(rep.m_err\))962 4658 y(return)i
(errno=\(err\)?err:rep.m_err;)884 4749 y(return)f(EOK;)805
4840 y(})1885 5255 y Fz(679)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
680 681 bop 722 523 a Fk(h)p Fj(O\013)27 b(DTLB)h(messages.)h
Fk(i)p Fz(+)o Fq(\021)805 614 y Fi(#define)41 b(OFF_MSG_DTLB_UNMAP)i
(0x012f)884 706 y(struct)d(off_dtlb_unmap_req:)k(public)d
(off_ObjKernReq)h({)962 797 y(vm_offset_t)g(at;)962 888
y(vm_size_t)120 b(sz;)962 980 y(off_dtlb_unmap_req\(off_id_t)46
b(me,)40 b(vm_offset_t)h(a,)f(vm_size_t)h(s,)1394 1071
y(off_Rights)g(r\))f(:)f(at\(a\),sz\(s\),)1041 1162 y
(off_ObjKernReq\(me,OFF_MSG_DTLB)q(_UNMA)q(P,r\))q({;})884
1254 y(};)884 1345 y(struct)h(off_dtlb_unmap_rep:)k(public)d
(off_KernRep)g({)962 1436 y(off_dtlb_unmap_rep\(err_t)k(r=0\))40
b(:)g(off_KernRep\(r\))i({;})884 1528 y(};)515 1768 y
FA(getmap)e Fz(Returns)27 b(an)h(address)e(translation.)36
b(Receiv)n(es:)822 1934 y Fq(\017)41 b Fz(The)28 b(virtual)f(address)f
Fx(at)p Fz(.)822 2067 y Fq(\017)41 b Fz(A)28 b(reference)f(to)g(the)h
(translation)e(v)-5 b(alue)28 b Fx(res)p Fz(.)822 2200
y Fq(\017)41 b Fz(Read)27 b(access)g(righ)n(ts)f(for)h(the)h
Ft(dtlb)g Fx(r)p Fz(.)722 2333 y Fk(h)p Fj(O\013)f(DTLB)h(for)f(users)i
(metho)l(ds.)g Fk(i)p Fz(+)o Fq(\021)805 2424 y Fi(err_t)41
b(getmap\(vm_offset_t)i(at,)d(off_AddrTrVal)i(&res,)e(off_Rights)i
(r\){)884 2516 y(off_dtlb_getmap_req)h(req\(w_p,at,r\);)884
2607 y(off_dtlb_getmap_rep)g(rep;)884 2698 y(err_t)d
(err=off_prtl_pct\(get_contain)q(er\(\).)q(get_)q(prtl\()q(\),)1786
2790 y(sizeof\(req\),sizeof\(rep\),&req,)q(&rep)q(,0\);)884
2881 y(if)f(\(err)i(||)e(rep.m_err\))962 2972 y(return)i
(errno=\(err\)?err:rep.m_err;)884 3064 y(else)962 3155
y(res=rep.res;)884 3246 y(return)f(EOK;)805 3337 y(})722
3545 y Fk(h)p Fj(O\013)27 b(DTLB)h(messages.)h Fk(i)p
Fz(+)o Fq(\021)805 3636 y Fi(#define)41 b(OFF_MSG_DTLB_GETMAP)j(0x13f)
884 3728 y(struct)c(off_dtlb_getmap_req:)k(public)d(off_ObjKernReq)h({)
962 3819 y(vm_offset_t)g(at;)962 3910 y(off_dtlb_getmap_req\(off_id_t)k
(me,)40 b(vm_offset_t)h(a,)f(off_Rights)i(r\))d(:)79
b(at\(a\),)1041 4002 y(off_ObjKernReq\(me,OFF_MSG_DTLB)q(_GETM)q(AP,r)q
(\){;})884 4093 y(};)884 4184 y(struct)40 b(off_dtlb_getmap_rep:)k
(public)d(off_KernRep)g({)962 4276 y(off_AddrTrVal)h(res;)962
4367 y(off_dtlb_getmap_rep\(err_t)j(r=0\))40 b(:)g(off_KernRep\(r\))i
({;})884 4458 y(};)515 4707 y Fk(h)p Fj(uDTLB.h*)11 b
Fk(i)p Fq(\021)598 4799 y Fk(h)p Fj(O\013)27 b(DTLB)g(messages.)i
Fk(i)598 4890 y(h)p Fj(O\013)e(DTLB)g(for)h(users.)g
Fk(i)1885 5255 y Fz(680)p eop
PStoPSsaved restore
%%Page: (682,683) 342
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
681 682 bop 515 523 a Fk(h)p Fj(kDTLB.h*)11 b Fk(i)p
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<dmm/DTLB.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<klib/kResource.h>)598
1710 y(#include)g(<prtl/ex.h>)473 b(//)40 b(for)g(XDT{Req|Rep})598
1802 y(#include)h(<string.h>)598 1893 y(#include)g(<node/Node.h>)598
2076 y(#ifndef)g(__OFF_KDTLB_H)598 2167 y(#define)g(__OFF_KDTLB_H)h(1)
598 2258 y(#ifdef)e(__KERNEL__)598 2441 y(class)g(off_kDTLB)h(:)f
(public)g(off_kAbsResUnit)j({)598 2532 y(public:)676
2623 y(off_kDTLB\(off_DTLB)h(*r=NULL\))d(:)e(off_kAbsResUnit\(r\))k
({;})676 2715 y(virtual)e(err_t)f(handle\(const)i(off_shtl_id_t)h
(&sender,)1500 2806 y(vm_size_t)e(msz,)f(vm_size_t)i(rsz,)1500
2897 y(off_KernReq)g(*m,)e(off_KernRep)h(*r\);)637 3171
y(void)f(map\(off_dtlb_map_req)k(*m,off_dtlb_map_rep)83
b(*r\))676 3263 y({)755 3354 y(if)39 b
(\(!nd.get_mbank\(0\).is_local\(m)q(->at)q(tr.g)q(et_pa)q(\(\)\)\))q({)
833 3445 y(panic\("should)j(setup)f(remote)f(address)h(translation.)h
(Not)e(yet)g(wrapped."\);)833 3537 y(//)g(For)g(remote)g(page)g
(frames,)h(access)g(rights)f(should)h(be)f(hooked)g(right)833
3628 y(//)g(into)g(the)g(hw)g(TLB.)833 3719 y(//)g(When)g(a)f(remote)i
(page)f(frame)g(is)g(got,)g(access)h(rights)f(should)h(be)f(checked)833
3811 y(//)g(for)g(pending)h(translations)g(solved)g(on)f(the)g(fly.)755
3902 y(})755 3993 y(else)g({)833 4085 y(off_PFrame)i
(*pf=nd.get_mbank\(0\)+m->attr.get)q(_pa\()q(\);)833
4176 y(//)e(XXX)g(Should)g(change)h(mach.)f(indep)h(mode)f(bits)g(to)g
(look)g(like)g(an)g(off_op_t.)833 4267 y(//)g(that)g(way)g(we)g(can)f
(pass)i(here)f(just)g(an)g(op.)833 4359 y(//)g(Besides,)h(beware)f(of)g
(users)g(trying)h(to)f(set)g(USER)g(protections.)833
4450 y(if)g(\(!pf->access_granted\(OFF_OP_W,)q(m->p)q(right)q(\)\){)755
4541 y(r->m_err=EPERM;)755 4633 y(return;)833 4724 y(})833
4815 y(r->m_err=\(\(off_DTLB*\)w_r\)->ma)q(p\(m-)q(>att)q(r.get)q
(_va\()q(\),m->)q(attr)q(.get)q(_pa\(\))q(,)1422 4907
y(PAGE_SIZE,m->attr.get_mod\(\)\);)755 4998 y(})1885
5255 y Fz(681)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
682 683 bop 676 523 a Fi(})637 614 y(void)40 b
(unmap\(off_dtlb_unmap_req)45 b(*m,off_dtlb_unmap_rep)83
b(*r\))676 706 y({)755 797 y(\(void\)m;)755 888 y
(r->m_err=\(\(off_DTLB*\)w_r\)->unma)q(p\(m-)q(>at,)q(m->sz)q(\);)676
980 y(})637 1071 y(void)40 b(getmap\(off_dtlb_getmap_req)45
b(*m,off_dtlb_getmap_rep)84 b(*r\))676 1162 y({)755 1254
y(//)39 b(XXX)h(note)g(that)h(this)f(might)g(allocate)h(secondary)g
(page)f(tables.)755 1345 y(//)f(A)h(check-only)h(access)g(operator)g
(must)f(be)g(given.)755 1436 y(off_AddrTrValRef)j(val=)d
(\(*\(\(off_DTLB*\)w_r\)\)+m->at;)755 1528 y(if\(!val\))833
1619 y(r->m_err=EINVAL;)755 1710 y(else{)833 1802 y
(r->res.set_pa\(val.get_pa\(\)\);)833 1893 y
(r->res.set_mod\(val.get_mod\(\)\))q(;)755 1984 y(})676
2076 y(})598 2167 y(};)598 2350 y(#endif)g(//)g(__KERNEL__)598
2441 y(#endif)g(//)g(__OFF_KDTLB_H)1885 5255 y Fz(682)p
eop
PStoPSsaved restore
%%Page: (684,685) 343
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
683 684 bop 515 523 a Fk(h)p Fj(kDTLB.C*)11 b Fk(i)o
Fq(\021)598 614 y Fi(//)598 706 y(//)39 b(===)h(DO)g(NOT)g(READ)g(OR)g
(MODIFY)g(THIS)g(FILE)h(===)598 797 y(//)598 888 y(//)e(This)i(is)e(a)h
(source)g(file)g(generated)i(by)d(the)h(noweb)h(literate)598
980 y(//)e(programming)j(tool.)598 1071 y(//)598 1162
y(//)d(If)h(you)g(have)g(the)g(chance)h(read)f(the)g(literate)h(source)
f(code)g(instead.)598 1254 y(//)598 1436 y(#include)h(<dmm/DTLB.h>)238
b(//)40 b(Exported)h(interface.)598 1528 y(#include)g(<klib/str.h>)277
b(//)40 b(for)g(kcout)598 1619 y(#include)h(<prtl/ex.h>)473
b(//)40 b(for)g(XDT{Req|Rep})598 1710 y(#include)h(<string.h>)598
1893 y(#include)g(<dmm/kDTLB.h>)598 2076 y(err_t)f
(off_kDTLB::handle\(const)45 b(off_shtl_id_t)d(&sender,)1539
2167 y(vm_size_t)f(msz,)g(vm_size_t)g(rsz,)1539 2258
y(off_KernReq)h(*m,)e(off_KernRep)i(*r\))598 2350 y({)676
2441 y(//kcout)f(<<)f("nd:)g(call)g(from)g(")g(<<)f(sender)i(<<)f(")f
(";)676 2532 y(//kcout)i(<<fmt\("msg@\04508x)i(",\(vm_offset_t\)m\))g
(<<)c(fmt\("rep@\04508x)k(",\(vm_offset_t\)r\);)676 2623
y(//kcout)e(<<)f(fmt\("sz=\045d)h(",msz\))g(<<)e
(fmt\("rsz=\045d",rsz\))44 b(<<)39 b(nl;)676 2715 y
(switch\(m->m_type\){)676 2806 y(case)h(OFF_MSG_R_INIT:)755
2897 y(return)g(EOK;)676 2989 y(case)g(OFF_MSG_DTLB_MAP:)755
3080 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 3171 y(r->m_err=)i(EPERM;)755 3263 y(else)f(if)f
(\(msz!=sizeof\(off_dtlb_map_r)q(eq\))46 b(||)39 b
(rsz!=sizeof\(off_dtlb_map_rep)q(\)\))833 3354 y(r->m_err=)i(EINVAL;)
755 3445 y(else)f({)833 3537 y(map\(\(off_dtlb_map_req*\)m,\(off)q
(_dtl)q(b_ma)q(p_rep)q(*\)r\))q(;)755 3628 y(})755 3719
y(return)g(EOK;)676 3811 y(case)g(OFF_MSG_DTLB_UNMAP:)755
3902 y(if)f(\(!w_r->access_granted\(OFF_OP)q(_W,m)q(->m_)q(right)q
(s\)\))833 3993 y(r->m_err=)i(EPERM;)755 4085 y(else)f(if)f
(\(msz!=sizeof\(off_dtlb_unmap)q(_req)q(\))45 b(||)40
b(rsz!=sizeof\(off_dtlb_unmap_rep\))q(\))833 4176 y(r->m_err=)h
(EINVAL;)755 4267 y(else)f({)833 4359 y
(unmap\(\(off_dtlb_unmap_req*\)m,)q(\(off)q(_dtl)q(b_unm)q(ap_r)q
(ep*\)r)q(\);)755 4450 y(})755 4541 y(return)g(EOK;)676
4633 y(case)g(OFF_MSG_DTLB_GETMAP:)755 4724 y(if)f
(\(!w_r->access_granted\(OFF_OP)q(_R,m)q(->m_)q(right)q(s\)\))833
4815 y(r->m_err=)i(EPERM;)755 4907 y(else)f(if)f
(\(msz!=sizeof\(off_dtlb_getma)q(p_re)q(q\))45 b(||)40
b(rsz!=sizeof\(off_dtlb_getmap_re)q(p\)\))833 4998 y(r->m_err=)h
(EINVAL;)1885 5255 y Fz(683)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
684 685 bop 755 523 a Fi(else)40 b({)833 614 y
(getmap\(\(off_dtlb_getmap_req*\))q(m,\(o)q(ff_d)q(tlb_g)q(etma)q
(p_rep)q(*\)r\))q(;)755 706 y(})755 797 y(return)g(EOK;)676
888 y(default:)755 980 y(return)g(off_kAbsResUnit::handle\(send)q(er,m)
q(sz,rs)q(z,m,)q(r\);)676 1071 y(})598 1162 y(})515 1752
y Fr(5.4)135 b(Distributed)55 b(Memory)f(Managers)g Fc(C)10
b Fb(++)53 b Fr(source)821 1902 y(\014les)515 2084 y
Ft(dmm)27 b Fz(can)g(b)r(e)h(found)g(at)g Fx(DMM.h)d
Fz(and)j Fx(DMM.C)p Fz(.)515 2216 y Fk(h)p Fj(DMM.h*)11
b Fk(i)o Fq(\021)598 2308 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2399 y Fi(#ifndef)41 b(__OFF_DMM_H)598 2490 y(#define)g(__OFF_DMM_H)g
(1)598 2673 y Fk(h)p Fj(O\013)27 b(DMM)g(dep)l(endencies.)i
Fk(i)598 2856 y Fi(#ifdef)40 b(__KERNEL__)598 2947 y
Fk(h)p Fj(O\013)27 b(DMM.)f Fk(i)598 3038 y Fi(#endif)40
b(//)g(__KERNEL__)598 3221 y(#include)h(<prtl/ex.h>)598
3312 y(#include)g(<dmm/uDMM.h>)598 3404 y Fk(h)p Fj(O\013)27
b(DMM)g(late)h(dep)l(endencies.)h Fk(i)598 3586 y Fi(#ifdef)40
b(__KERNEL__)598 3678 y Fk(h)p Fj(O\013)27 b(DMM)g(exp)l(orte)l(d)j
(variables.)e Fk(i)598 3860 y Fi(//)39 b(Inline)i(methods)g(of)f(DMM)
598 3952 y Fk(h)p Fi(off)p 750 3952 24 4 v 29 w(DMM::is)p
1052 3952 V 29 w(local)29 b Fj(implementation.)e Fk(i)598
4043 y(h)p Fi(off)p 750 4043 V 29 w(DMM::make)p 1130
4043 V 30 w(available)i Fj(implementation.)f Fk(i)598
4134 y(h)p Fi(off)p 750 4134 V 29 w(DMM::is)p 1052 4134
V 29 w(active)h Fj(implementation.)f Fk(i)598 4226 y(h)p
Fi(off)p 750 4226 V 29 w(DMM::operator+)i Fj(implementation.)e
Fk(i)598 4317 y(h)p Fi(off)p 750 4317 V 29 w(DMM::get)p
1091 4317 V 30 w(current)h Fj(implementation.)e Fk(i)598
4408 y(h)p Fi(off)p 750 4408 V 29 w(DMM::get)p 1091 4408
V 30 w(allocator)i Fj(implementation.)f Fk(i)598 4500
y(h)p Fi(off)p 750 4500 V 29 w(DMM::get)p 1091 4500 V
30 w(kdtlb)g Fj(implementation.)g Fk(i)598 4591 y(h)p
Fi(off)p 750 4591 V 29 w(DMM)g Fj(c)l(onversion)h(utilities)e
(implementation.)h Fk(i)598 4682 y Fi(#endif)40 b(//)g(__KERNEL__)598
4865 y(#endif)g(//)g(!__OFF_DMM_H)1885 5255 y Fz(684)p
eop
PStoPSsaved restore
%%Page: (686,687) 344
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
685 686 bop 515 523 a Fk(h)p Fj(DMM.C*)11 b Fk(i)o Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<dmm/DMM.h>)473
b(//)40 b(exported)h(interface)598 888 y Fk(h)p Fj(O\013)27
b(DMM)g(implementation)h(dep)l(endencies.)h Fk(i)598
1071 y(h)p Fj(O\013)e(DMM)g(static)i(memb)l(ers.)f Fk(i)598
1162 y(h)p Fj(O\013)f(DMM)g(glob)l(al)h(variables.)g
Fk(i)598 1345 y(h)p Fi(off)p 750 1345 24 4 v 29 w(DMM::off)p
1091 1345 V 30 w(DMM)g Fj(implementation.)f Fk(i)598
1436 y(h)p Fi(off)p 750 1436 V 29 w(DMM::start)i Fj(implementation.)f
Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(DMM::self)p
1130 1528 V 30 w(start)g Fj(implementation.)g Fk(i)598
1619 y(h)p Fi(off)p 750 1619 V 29 w(DMM::alloc)h Fj(and)f
Fi(free)h Fj(implementation.)e Fk(i)598 1710 y(h)p Fi(off)p
750 1710 V 29 w(DMM::notify)i Fj(implementation.)f Fk(i)598
1802 y(h)p Fi(off)p 750 1802 V 29 w(DMM::pg)p 1052 1802
V 29 w(fault)h Fj(implementation.)e Fk(i)598 1893 y(h)p
Fi(off)p 750 1893 V 29 w(DMM::pswitch)j Fj(and)e Fi(off)p
1543 1893 V 29 w(DMM::needs)p 1962 1893 V 30 w(switch])h
Fj(implementation.)f Fk(i)598 1984 y(h)p Fi(off)p 750
1984 V 29 w(DMM::pset)h Fj(implementation.)f Fk(i)598
2076 y(h)p Fi(off)p 750 2076 V 29 w(DMM::pclr)h Fj(implementation.)f
Fk(i)598 2167 y(h)p Fi(off)p 750 2167 V 29 w(DMM::get)p
1091 2167 V 30 w(url)g Fj(implementation.)f Fk(i)598
2258 y(h)p Fi(off)p 750 2258 V 29 w(DMM::nameof)i Fj(implementation.)f
Fk(i)598 2350 y(h)p Fi(off)p 750 2350 V 29 w(DMM::operator<<)i
Fj(implementation.)e Fk(i)639 2582 y Ft(dtlb)g Fz(co)r(de)f(is)h(at)f
Fx(DTLB.h)e Fz(and)j Fx(DTLB.C)p Fz(.)515 2715 y Fk(h)p
Fj(DTLB.h*)11 b Fk(i)o Fq(\021)598 2806 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2897 y Fi(#ifndef)41 b(__OFF_DTLB_H)598 2989
y(#define)g(__OFF_DTLB_H)h(1)598 3171 y Fk(h)p Fj(O\013)27
b(DTLB)g(dep)l(endencies.)i Fk(i)598 3354 y Fi(#ifdef)40
b(__KERNEL__)598 3445 y Fk(h)p Fj(O\013)27 b(DTLB.)g
Fk(i)598 3537 y Fi(#endif)40 b(//)g(__KERNEL__)598 3719
y(#include)h(<prtl/ex.h>)598 3811 y(#include)g(<dmm/uDTLB.h>)598
4085 y(#ifdef)f(__KERNEL__)598 4176 y(//)f(Inline)i(methods)g(of)f
(DTLB)598 4267 y Fk(h)p Fi(off)p 750 4267 V 29 w(DTLB::valid)29
b Fj(implementation.)f Fk(i)598 4359 y(h)p Fi(off)p 750
4359 V 29 w(DTLB::operator+)i Fj(implementation.)e Fk(i)598
4450 y(h)p Fi(off)p 750 4450 V 29 w(DTLB::sync)h Fj(implementation.)f
Fk(i)598 4541 y(h)p Fi(off)p 750 4541 V 29 w(DTLB::pset)h
Fj(implementation.)f Fk(i)598 4633 y(h)p Fi(off)p 750
4633 V 29 w(DTLB::pclr)h Fj(implementation.)f Fk(i)598
4724 y Fi(#endif)40 b(//)g(__KERNEL__)598 4907 y(#endif)g(//)g
(!__OFF_DTLB_H)1885 5255 y Fz(685)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
686 687 bop 515 523 a Fk(h)p Fj(DTLB.C*)11 b Fk(i)o Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<dmm/DTLB.h>)434
b(//)40 b(Exported)h(interface.)598 888 y Fk(h)p Fj(O\013)27
b(DTLB)g(implementation)h(dep)l(endencies.)h Fk(i)598
1071 y(h)p Fj(O\013)e(DTLB)g(static)i(memb)l(ers.)f Fk(i)598
1254 y(h)p Fi(off)p 750 1254 24 4 v 29 w(DTLB::get)p
1130 1254 V 30 w(allocator)h Fj(implementation.)f Fk(i)598
1345 y(h)p Fi(off)p 750 1345 V 29 w(DTLB::off)p 1130
1345 V 30 w(DTLB)g Fj(implementation.)g Fk(i)598 1436
y(h)p Fi(off)p 750 1436 V 29 w(DTLB::operator)42 b(new)28
b Fj(implementation.)g Fk(i)598 1528 y(h)p Fi(off)p 750
1528 V 29 w(DTLB::operator)42 b(delete)29 b Fj(implementation.)e
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(DTLB::map)i
Fj(implementation.)f Fk(i)598 1710 y(h)p Fi(off)p 750
1710 V 29 w(DTLB::unmap)h Fj(implementation.)f Fk(i)598
1802 y(h)p Fi(off)p 750 1802 V 29 w(DTLB::usr)p 1130
1802 V 30 w(fault)g Fj(implementation.)g Fk(i)598 1893
y(h)p Fi(off)p 750 1893 V 29 w(DTLB::pg)p 1091 1893 V
30 w(fault)g Fj(implementation.)g Fk(i)598 1984 y(h)p
Fi(off)p 750 1984 V 29 w(DTLB::get)p 1130 1984 V 30 w(url)p
1277 1984 V 29 w(holder)h Fj(implementation.)e Fk(i)598
2076 y(h)p Fi(off)p 750 2076 V 29 w(DTLB::uv2kv)i Fj(implementation.)f
Fk(i)639 2217 y Fz(Address)18 b(translation)f(\(all)i(their)f(v)-5
b(arian)n(ts\))17 b(are)h(de\014ned)h(in)f Fx(AddrTr.h)d
Fz(and)k Fx(AddrTr.C)p Fz(.)515 2350 y Fk(h)p Fj(A)l(ddrT)-6
b(r.h*)11 b Fk(i)q Fq(\021)598 2441 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2532 y Fi(#ifndef)41 b(__OFF_ADDR_TR_H)598 2623
y(#define)g(__OFF_ADDR_TR_H)h(1)598 2806 y Fk(h)p Fj(O\013)27
b(addr)l(ess)i(tr)l(anslation)h(dep)l(endencies.)f Fk(i)598
3080 y(h)p Fj(O\013)e(addr)l(ess)i(tr)l(anslation)h(mo)l(de)e(bits.)f
Fk(i)598 3171 y(h)p Fj(O\013)g(addr)l(ess)i(tr)l(anslation)h(value.)d
Fk(i)598 3263 y(h)p Fj(O\013)g(addr)l(ess)i(tr)l(anslation.)g
Fk(i)598 3354 y Fi(#ifdef)40 b(__KERNEL__)598 3445 y
Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h(r)l(efer)l(enc)l(e.)
f Fk(i)598 3537 y Fi(#endif)40 b(//)g(__KERNEL__)598
3811 y Fk(h)p Fi(off)p 750 3811 V 29 w(AddrTr::get)p
1208 3811 V 30 w(va)28 b Fj(implementation.)g Fk(i)598
3902 y(h)p Fi(off)p 750 3902 V 29 w(AddrTr::get)p 1208
3902 V 30 w(pa)g Fj(implementation.)g Fk(i)598 3993 y(h)p
Fi(off)p 750 3993 V 29 w(AddrTr::get)p 1208 3993 V 30
w(mod)g Fj(implementation.)g Fk(i)598 4085 y(h)p Fi(off)p
750 4085 V 29 w(AddrTr::operator)42 b(vm)p 1523 4085
V 29 w(offset)p 1786 4085 V 30 w(t)27 b Fj(implementation.)h
Fk(i)598 4176 y(h)p Fi(off)p 750 4176 V 29 w(AddrTr::get)p
1208 4176 V 30 w(val)g Fj(implementation.)g Fk(i)598
4450 y Fi(#endif)40 b(//)g(!__OFF_ADDR_TR_H)1885 5255
y Fz(686)p eop
PStoPSsaved restore
%%Page: (688,689) 345
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
687 688 bop 515 523 a Fk(h)p Fj(A)l(ddrT)-6 b(r.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<dmm/AddrTr.h>)356 b(//)40 b(Exported)h(interface.)598
888 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h
(implementation)e(dep)l(endencies.)h Fk(i)598 1071 y(h)p
Fi(off)p 750 1071 24 4 v 29 w(AddrTr::off)p 1208 1071
V 30 w(AddrTr)g Fj(implementation.)f Fk(i)598 1162 y(h)p
Fi(off)p 750 1162 V 29 w(AddrTrValRef::get)p 1442 1162
V 32 w(rat)g Fj(implementation.)f Fk(i)598 1254 y(h)p
Fi(off)p 750 1254 V 29 w(AddrTrValRef::get)p 1442 1254
V 32 w(pa)h Fj(implementation.)f Fk(i)598 1345 y(h)p
Fi(off)p 750 1345 V 29 w(AddrTrValRef::set)p 1442 1345
V 32 w(pa)h Fj(implementation.)f Fk(i)598 1436 y(h)p
Fi(off)p 750 1436 V 29 w(AddrTrValRef::pg)p 1403 1436
V 31 w(fault)i Fj(implementation.)e Fk(i)515 1793 y(h)p
Fj(uA)l(ddrT)-6 b(r.C*)11 b Fk(i)q Fq(\021)598 1885 y
Fi(#undef)40 b(__KERNEL__)598 1976 y(#include)h(<dmm/AddrTr.h>)356
b(//)40 b(Exported)h(interface.)598 2159 y Fk(h)p Fi(off)p
750 2159 V 29 w(AddrTr::off)p 1208 2159 V 30 w(AddrTr)29
b Fj(implementation.)f Fk(i)639 2391 y Ft(dtlb)18 b Fz(allo)r(cator)f
(co)r(de)h(can)g(b)r(e)h(found)g(at)f Fx(DTLBAllocator.h)12
b Fz(and)18 b Fx(DTLBAllocator.C)p Fz(.)515 2524 y Fk(h)p
Fj(DTLBA)n(l)t(lo)l(c)l(ator.h*)11 b Fk(i)p Fq(\021)598
2615 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2707 y Fi(#ifndef)41
b(__OFF_DTLB_ALLOCATOR_H)598 2798 y(#define)g(__OFF_DTLB_ALLOCATOR_H)j
(1)598 2980 y Fk(h)p Fj(O\013)27 b(DTLB)g(al)t(lo)l(c)l(ator)i(dep)l
(endencies.)g Fk(i)598 3163 y Fi(#ifdef)40 b(__KERNEL__)598
3254 y Fk(h)p Fj(O\013)27 b(linkable)g(DTLB.)g Fk(i)598
3346 y(h)p Fj(O\013)g(DTLB)g(al)t(lo)l(c)l(ator.)h Fk(i)598
3437 y Fi(#endif)40 b(//)g(__KERNEL__)598 3620 y(#ifdef)g(__KERNEL__)
598 3711 y(//)f(Inline)i(methods)g(of)f(DTLBAllocator)598
3802 y Fk(h)p Fi(off)p 750 3802 V 29 w(DTLBAllocator::operator+)32
b Fj(implementation.)c Fk(i)598 3894 y Fi(#endif)40 b(//)g(__KERNEL__)
598 4076 y(#endif)g(//)g(!__OFF_DTLB_ALLOCATOR_H)1885
5255 y Fz(687)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
688 689 bop 515 523 a Fk(h)p Fj(DTLBA)n(l)t(lo)l(c)l(ator.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<dmm/DTLBAllocator.h>)83 b(//)40 b(Exported)h
(interface)598 980 y Fk(h)p Fj(O\013)27 b(DTLB)g(al)t(lo)l(c)l(ator)i
(static)g(memb)l(ers.)f Fk(i)598 1162 y(h)p Fi(off)p
750 1162 24 4 v 29 w(DTLBAllocator::off)p 1481 1162 V
32 w(DTLBAllocator)i Fj(implementation.)e Fk(i)639 1486
y Fz(Address)18 b(translation)f(allo)r(cator)g(is)h(k)n(ept)g(at)h
Fx(AddrTrAllocator.)o(h)12 b Fz(and)18 b Fx(AddrTrAllocator.C)o
Fz(.)515 1619 y Fk(h)p Fj(A)l(ddrT)-6 b(rA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)r Fq(\021)598 1710 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1802 y Fi(#ifndef)41 b(__OFF_ADDR_TR_ALLOCATOR_H)598
1893 y(#define)g(__OFF_ADDR_TR_ALLOCATOR_H)j(1)598 2076
y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l(anslation)h(al)t(lo)l(c)l
(ator)e(dep)l(endencies.)h Fk(i)598 2350 y Fi(#ifdef)40
b(__KERNEL__)598 2441 y Fk(h)p Fj(O\013)27 b(linkable)g(addr)l(ess)j
(tr)l(anslation.)e Fk(i)598 2532 y(h)p Fj(O\013)f(r)l(emote)i(addr)l
(ess)g(tr)l(anslation)g(al)t(lo)l(c)l(ator.)g Fk(i)598
2623 y(h)p Fj(O\013)e(addr)l(ess)i(tr)l(anslation)h(al)t(lo)l(c)l
(ator.)e Fk(i)598 2715 y Fi(#endif)40 b(//)g(__KERNEL__)598
2897 y(#ifdef)g(__KERNEL__)598 2989 y(//)f(Inline)i(methods)g(of)f
(AddrTrValAllocator)598 3080 y Fk(h)p Fi(off)p 750 3080
V 29 w(AddrTrValAllocator::get)p 1676 3080 V 33 w(ralloc)29
b Fj(implementation.)e Fk(i)598 3171 y(h)p Fi(off)p 750
3171 V 29 w(AddrTrValAllocator::operator+)34 b Fj(implementation.)27
b Fk(i)598 3263 y(h)p Fi(off)p 750 3263 V 29 w(AddrTrValAllocator::get)
p 1676 3263 V 33 w(lalloc)i Fj(implementation.)e Fk(i)598
3354 y Fi(#endif)40 b(//)g(__KERNEL__)598 3537 y(#endif)g(//)g
(!__OFF_ADDR_TR_ALLOCATOR_H)1885 5255 y Fz(688)p eop
PStoPSsaved restore
%%Page: (690,691) 346
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
689 690 bop 515 523 a Fk(h)p Fj(A)l(ddrT)-6 b(rA)n(l)t(lo)l(c)l
(ator.C*)11 b Fk(i)q Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 888 y Fi(#include)41 b(<dmm/AddrTrAllocator.h>)j(//)c
(Exported)h(interface)598 1071 y Fk(h)p Fj(O\013)27 b(addr)l(ess)i(tr)l
(anslation)h(al)t(lo)l(c)l(ator)e(static)h(memb)l(ers.)f
Fk(i)598 1162 y(h)p Fj(O\013)f(r)l(emote)i(addr)l(ess)g(tr)l(anslation)
g(al)t(lo)l(c)l(ator)g(static)g(memb)l(ers.)f Fk(i)598
1345 y(h)p Fi(off)p 750 1345 24 4 v 29 w(AddrTrValAllocator::off)p
1676 1345 V 33 w(AddrTrValAllocator)k Fj(implementation.)27
b Fk(i)598 1436 y(h)p Fi(off)p 750 1436 V 29 w
(AddrTrValAllocator::start)33 b Fj(implementation.)27
b Fk(i)598 1528 y(h)p Fi(off)p 750 1528 V 29 w(AddrTrValAllocator::pos)
32 b Fj(implementation.)c Fk(i)598 1619 y(h)p Fi(off)p
750 1619 V 29 w(AddrTrValAllocator::allocate)33 b Fj(implementation.)28
b Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w
(AddrTrValAllocator::deallocate)34 b Fj(implementation.)27
b Fk(i)598 1802 y(h)p Fi(off)p 750 1802 V 29 w(RemAddrTrAllocator::off)
p 1676 1802 V 33 w(RemAddrTrAllocator)32 b Fj(implementation.)27
b Fk(i)598 1893 y(h)p Fi(off)p 750 1893 V 29 w
(RemAddrTrValAllocator::operator)46 b(+)27 b Fj(implementation.)h
Fk(i)1885 5255 y Fz(689)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
690 691 bop 515 523 a Fn(5.4.1)112 b(Distributed)26 b(Memory)h
(Managemen)m(t)h(for)g(ix86)f(based)h(ar-)857 639 y(c)m(hitectures)515
793 y FA(Distributed)j(Memory)f(Managers)i(for)g(ix86)f(based)h(arc)m
(hitectures)515 946 y Fz(On)23 b(In)n(tels,)i(a)f Ft(dmm)f
Fz(main)n(tains)h(the)g(k)n(ernel)f(page)g(table)h(and)g(other)f(mac)n
(hine)g(dep)r(enden)n(t)515 1045 y(address)j(translation)g(mac)n
(hinery)-7 b(.)36 b(It)28 b(is)g(also)e(resp)r(onsible)h(of)h(enabling)
f(paging.)515 1178 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(DMM.)e
Fk(i)p Fq(\021)598 1270 y Fi(//)39 b(A)h(DMM)g(for)g(ix86s.)598
1361 y(//)598 1452 y(class)g(off_mdepDMM)i({)598 1544
y(private:)676 1635 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 1635 24 4 v 29 w(mdepDMM)p Fj(.)i Fk(i)598
1726 y Fi(public:)676 1817 y(//)40 b(Return)g(the)g(number)h(of)f(DMMs)
676 1909 y(static)h(natural_t)g(how_many\(void\))h({)e(return)h(1;})676
2091 y(//)f(Initializes)i(DMM)e(data.)676 2183 y(off_mdepDMM\(void\);)
676 2274 y(//)g(Starts)g(DMM)g(hardware)676 2365 y(void)g
(start\(void\);)676 2548 y(//)g(get)g(Kernel/User)i(VM)d(space)i(size)f
(and)g(starting)h(vaddress)676 2639 y(static)g(inline)f(vm_size_t)81
b(get_ksize\(void\))43 b({)c(return)i(OFF_MDEP_USROFF;)h(})676
2731 y(static)f(inline)f(vm_size_t)81 b(get_usize\(void\))43
b({)755 2822 y(return)d(\(\(vm_size_t\)-1\))j(-OFF_MDEP_USROFF;})676
2913 y(static)e(inline)f(vm_offset_t)i(get_kstart\(void\))h({)c(return)
i(0;)f(})676 3005 y(static)h(inline)f(vm_offset_t)i(get_ustart\(void\))
h({)c(return)i(OFF_MDEP_USROFF;)i(})676 3187 y(//)d(Convert)h(from)f
(kernel)g(virtual)h(to)f(physical)h(and)f(vice-versa.)676
3279 y(static)h(inline)f(vm_offset_t)i(kv2phys\(vm_offset_t)i(kv\))c
({return)g(kvtophys\(kv\);})676 3370 y(static)h(inline)f(vm_offset_t)i
(phys2kv\(vm_offset_t)i(p\))39 b({return)i(phystokv\(p\);})676
3553 y(//)f(Convert)h(from)f(kernel)g(virtual)h(to)f(\(current!\))h
(user-virtual)h(and)e(vice-versa.)676 3644 y(static)h(inline)f
(vm_offset_t)i(kv2uv\(vm_offset_t)h(kv\))d({return)h(kv;)79
b(})676 3735 y(static)41 b(inline)f(vm_offset_t)i(uv2kv\(vm_offset_t)h
(uv\))d({return)h(uv;)79 b(})676 4009 y(//)40 b(Starts)g(paging)h(in)f
(the)g(current)g(processor.)676 4101 y(inline)h(void)f
(self_start\(void\);)676 4283 y(static)h(inline)f(vm_offset_t)i
(faulting_vaddr\(off_ShtlCtx)j(*c\))40 b({)755 4375 y(return)g
(c->c_regs->p_ts.cr2;)676 4466 y(})676 4649 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p 1654
4649 V 29 w(mdepDMM)p Fj(.)i Fk(i)598 4831 y Fi(};)1885
5255 y Fz(690)p eop
PStoPSsaved restore
%%Page: (692,693) 347
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
691 692 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(limits.)e Fk(i)o Fq(\021)598 614 y Fi(const)40 b(unsigned)h(int)f
(OFF_MDEP_USROFF=0x80000000;)45 b(//)40 b(Start)g(of)g(user)g(vaddrs)
598 706 y(const)g(unsigned)h(int)f(OFF_MDEP_USRSTK=0xffffffff;)45
b(//)40 b(Start)g(of)g(user)g(stack)2441 797 y(//)119
b(\(used)40 b(by)g(the)g(mod)f(loader\))515 971 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(DMM)e(dep)l(endencies.)j
Fk(i)o Fq(\021)598 1063 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(vm_size_t)h(et)f(al.)598 1154 y(#include)h
(<klib/mdep/limits.h>)122 b(//)40 b(for)g(OFF_MDEP_USROFF)598
1245 y(#include)h(<hw/mdep/mProcessor.h>)598 1337 y(#include)g
(<flux/machine/base_vm.h>)j(//)c(for)g(kvtophys)h(et)f(al.)598
1428 y(#include)h(<shtl/ShtlCtx.h>)278 b(//)40 b(for)g(off_ShtlCtx)639
1569 y Fz(T)-7 b(o)28 b(start)f(paging,)g(w)n(e)g(rely)h(on)f(the)h
(OSKit)g(to)g(create)f(an)g(initial)h(iden)n(tit)n(y)g(mapping)515
1669 y(for)f(the)h(k)n(ernel)e(and)i(setting)f(it)i(up.)515
1802 y Fk(h)p Fi(off)p 667 1802 24 4 v 29 w(mdepDMM::off)p
1164 1802 V 30 w(mdepDMM)h Fj(implementation.)d Fk(i)p
Fq(\021)598 1893 y Fi(off_mdepDMM::off_mdepDMM\(void\))598
1984 y({)598 2076 y(})639 2308 y Fz(It)h(is)g(done)f(at)g(startup)h
(time,)g(not)g(at)f(instan)n(tiation)g(time.)515 2424
y Fk(h)p Fi(off)p 667 2424 V 29 w(mdepDMM::start)j Fj(implementation.)e
Fk(i)o Fq(\021)598 2516 y Fi(void)40 b(off_mdepDMM::start\(void\))598
2607 y({)676 2698 y(static)h(boolean_t)g(initialized=FALSE;)676
2790 y(if)f(\(!initialized\){)755 2881 y Fk(h)p Fj(Base)28
b(p)l(aging)g(init.)f Fk(i)676 2972 y Fi(})598 3064 y(})639
3279 y Fz(T)-7 b(o)32 b(startup)f(paging,)g(w)n(e)h(m)n(ust)f(allo)r
(cate)g(a)g(page)g(directory)-7 b(,)32 b(arrange)d(the)j(iden)n(tit)n
(y)515 3379 y(mapping)37 b(part)f(of)h(the)h(KVM)f(\(see)g(\014gure)g
(5.4)f(on)h(page)f(706\))g(and)h(install)h(it)f(in)h(the)515
3479 y(pro)r(cessor.)c(On)27 b(In)n(tels,)f(the)i(t)n(w)n(o)d(Gb)n
(ytes)i(are)f(used)g(b)n(y)h(the)g(k)n(ernel)f(and)g(remaining)g(t)n(w)
n(o)515 3578 y(ones)h(are)f(a)n(v)-5 b(ailable)27 b(for)g(the)h(user)
1599 3548 y Fp(9)1635 3578 y Fz(.)515 3711 y Fk(h)p Fj(Base)g(p)l
(aging)g(init.)f Fk(i)p Fq(\021)598 3802 y Fi(vm_offset_t)41
b(pg;)598 3985 y(if)e(\(!\(pg=off_KVM::raw_pg_alloc)q(\(\)\)\))676
4076 y(nd.halt\("Can't)k(allocate)e(kernel)f(page)g(directory"\);)598
4259 y(new\(&d_kdtlb\))i(off_mdepDTLB\(pg\);)598 4350
y(//Enable)f(superpage)g(support)g(if)f(we)f(have)h(it.)598
4442 y(if)f(\(base_cpuid.feature_flags)45 b(&)40 b(CPUF_4MB_PAGES\){)
676 4533 y(set_cr4\(get_cr4\(\))j(|)d(CR4_PSE\);)598
4624 y(})598 4807 y(self_start\(\);)p 515 4870 1146 4
v 607 4924 a Fm(9)642 4948 y Fl(This)23 b(will)f(c)n(hange)j(in)f(the)g
(future)g(to)g(b)r(e)g(1)g(Gb)n(yte)h(for)e(the)i(k)n(ernel)f(and)g(3)g
(Gb)n(ytes)h(for)e(the)h(user.)1885 5255 y Fz(691)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
692 693 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(DMM)e(implementation)h(dep)l(endencies.)i Fk(i)o Fq(\021)598
614 y Fi(#include)41 b(<string.h>)512 b(//)40 b(for)g(memset)g(et)g
(al.)598 706 y(#include)h(<node/Node.h>)395 b(//)40 b(for)g(nd)f(and)h
(halt)598 797 y(#include)h(<flux/machine/proc_reg.h>)k(//)39
b(for)h(set_cr4)h(and)f(CR4_PSE)598 888 y(#include)h
(<flux/machine/base_cpu.h>)k(//)39 b(for)h(base_cpuid)i(and)e
(CPUF_4MB_PAGES)598 980 y(#include)h(<dmm/KVM.h>)473
b(//)40 b(for)g(raw_pg_alloc)639 1121 y Fz(Note)28 b(ho)n(w)f(w)n(e)g
(k)n(ept)h(the)g(k)n(ernel)e Ft(dtlb)i Fz(in)f Fx(d)p
2072 1121 27 4 v 31 w(kdtlb)p Fz(.)515 1254 y Fk(h)p
Fj(Other)h(private)h(memb)l(ers)f(of)g Fi(off)p 1552
1254 24 4 v 29 w(mdepDMM)p Fj(.)g Fk(i)p Fq(\021)598
1345 y Fi(static)40 b(off_mdepDTLB)i(d_kdtlb;)434 b(//)39
b(kernel)i(dtlb)515 1519 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)
h(DMM)e(static)i(memb)l(ers.)f Fk(i)p Fq(\021)598 1611
y Fi(off_mdepDTLB)42 b(off_mdepDMM::d_kdtlb;)i(//)39
b(kernel)i(dtlb)515 1876 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 1876 V 29 w(mdepDMM)p Fj(.)h Fk(i)p
Fq(\021)598 1968 y Fi(static)40 b(inline)h(off_mdepDTLB)h
(&get_kdtlb\(void\))h({)c(return)i(d_kdtlb;)g(})515 2142
y Fk(h)p Fi(off)p 667 2142 V 29 w(mdepDMM::self)p 1203
2142 V 31 w(start)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
2233 y Fi(//)39 b(Starts)i(paging)g(in)e(the)h(current)h(processor.)598
2325 y(inline)f(void)g(off_mdepDMM::self_start\(voi)q(d\))598
2416 y({)676 2507 y(paging_enable\(\(vm_offset_t\)g)q(et_kd)q(tlb\()q
(\)\);)676 2599 y(inval_tlb\(\);)598 2690 y(})515 2864
y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DMM)e(dep)l(endencies.)
j Fk(i)o Fz(+)p Fq(\021)598 2956 y Fi(#include)41 b(<dmm/mdep/mDTLB.h>)
200 b(//)40 b(for)g(off_mdepDTLB)515 3130 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(DMM)e(implementation)h(dep)l(endencies.)i
Fk(i)o Fz(+)p Fq(\021)598 3221 y Fi(#include)41 b
(<flux/machine/base_paging.h>)k(//)40 b(for)g(base_paging_init)598
3313 y(#include)h(<flux/machine/paging.h>)240 b(//)40
b(for)g(paging_enable)1885 5255 y Fz(692)p eop
PStoPSsaved restore
%%Page: (694,695) 348
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
693 694 bop 515 523 a FA(Distributed)31 b(TLBs)h(for)g(ix86)f(based)h
(arc)m(hitectures)515 676 y Fz(On)k(In)n(tel)g(based)f(arc)n
(hitectures)g(a)g Ft(dtlb)h Fz(main)n(tains)f(a)h(page)f(table)h(using)
g(the)g(corre-)515 776 y(sp)r(onding)30 b Fx(cr3)g Fz(\(page)h(table)g
(p)r(oin)n(ter)f(register\))g(as)g(the)i(ph)n(ysical)e(name.)47
b(A)31 b(protot)n(yp)r(e)515 876 y(page)26 b(table)i(\(used)g(b)n(y)f
(the)h(k)n(ernel\))f(is)h(used)f(to)h(initialize)f(others.)515
1008 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(DTLB.)e
Fk(i)p Fq(\021)598 1100 y Fi(//)39 b(A)h(DTLB)g(for)g(ix86s.)598
1191 y(//)598 1282 y(class)g(off_mdepDTLB)i({)598 1374
y(protected:)676 1465 y(vm_offset_t)g(d_pdir;)158 b(//)40
b(page)g(directory.)i(\(phys)e(addr\).)676 1556 y Fk(h)p
Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 1556 24 4 v 29 w(mdepDTLB)p Fj(.)i Fk(i)598
1648 y Fi(public:)676 1739 y(//)40 b(To)g(allow)g(uninitialized)i
(dtlbs.)676 1830 y(off_mdepDTLB\(void\):d_pdir\(0\))q({;})676
2013 y(//)e(Creates)h(a)e(machine)i(dependent)g(DTLB)f(given)h(an)e
(already)i(allocated)h(pframe.)676 2104 y(//)e(\(should)h(be)e(used)i
(only)f(for)g(the)f(root)i(one\).)676 2196 y(off_mdepDTLB\(vm_offset_t)
k(pframe\);)676 2378 y(//)40 b(Creates)h(a)e(m.dep.)i(DTLB.)676
2470 y(off_mdepDTLB\(void)i(*dtlb\);)676 2652 y(//)d(Destroyes)h(a)f
(dtlb.)676 2744 y(~off_mdepDTLB\(void\);)676 2926 y(//)g(It)g(can)f(be)
h(used)g(as)g(a)f(CR3)h(value)676 3018 y(operator)h
(vm_offset_t\(void\))i(const)e({)e(return)i(d_pdir;)g(})676
3109 y(operator)g(void*\(void\))81 b({)40 b(return)g(\(void*\)d_pdir;)j
(})676 3200 y(void)d(*operator)i(new\(size_t)f(s,)f(off_mdepDTLB)i
(*d\){)e(\(void\)s;)h(return)g(\(void*\)d;})676 3383
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(off)p
1654 3383 V 29 w(mdepDTLB)p Fj(.)i Fk(i)598 3565 y Fi(};)515
3740 y Fk(h)p Fj(O\013)e(machine)h(dep)l(endent)h(DTLB)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 3831 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(et)f(al.)1885
5255 y Fz(693)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
694 695 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepDTLB::off)p 1203 523 V 31 w(mdepDTLB)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Creates)i(a)f(machine)h(dependent)g
(root)f(DTLB)598 706 y(off_mdepDTLB::off_mdepDTLB\(vm_)q(offse)q(t_t)46
b(pframe\))40 b(:)676 797 y(d_pdir\(off_mdepDMM::kv2phys\()q(pfram)q
(e\)\))598 888 y({)676 980 y(assert\(pframe\);)676 1071
y(memset\(\(void*\)pframe,0,PAGE_)q(SIZE\))q(;)676 1162
y(base_pdir_pa=off_mdepDMM::kv)q(2phys)q(\(pfr)q(ame\))q(;)676
1254 y(if)g(\(map\(0,)h(0,)e(off_MBank::get_coresize\(\),)833
1345 y(OFF_MOD_R|OFF_MOD_W\)\){)755 1436 y(panic\("Can't)j(direct-map)f
(physical)g(memory"\);)676 1528 y(})676 1619 y(unmap\(0,PAGE_SIZE\);)
598 1710 y(})598 1984 y(//)e(Creates)i(a)f(machine)h(dependent)g(DTLB)
598 2076 y(off_mdepDTLB::off_mdepDTLB\(voi)q(d)k(*dtlb\))598
2167 y({)676 2258 y(void)40 b(*pframe=\(void*\)off_KVM::raw_)q(pg_a)q
(lloc)q(\(\);)676 2441 y(\(void\)dtlb;)676 2532 y
(d_pdir=off_mdepDMM::kv2phys\()q(\(vm_o)q(ffse)q(t_t\))q(pfram)q(e\);)
676 2715 y(assert\(pframe\);)676 2806 y
(memcpy\(\(void*\)pframe,\(void*\))q(off_m)q(depD)q(MM::)q(get_k)q
(dtlb)q(\(\),PA)q(GE_S)q(IZE\))q(;)598 2897 y(})515 3163
y Fk(h)p Fi(off)p 667 3163 V 29 w(mdepDTLB::~off)p 1242
3163 V 31 w(mdepDTLB)29 b Fj(implementation.)f Fk(i)p
Fq(\021)598 3254 y Fi(//)39 b(Destroyes)j(a)d(dtlb.)598
3346 y(off_mdepDTLB::~off_mdepDTLB\(vo)q(id\))45 b({)676
3528 y(//Should)c(simply)g(deallocate)g(those)g(frames)f(being)h(used)f
(for)g(page)g(tables.)676 3620 y(//frame)h(RCs)f(should)h(be)e(used)h
(and)g(let)g(them)g(choose)h(if)f(they)g(are)g(still)g(useful)676
3711 y(//or)g(not.)598 3894 y(})515 4159 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(DTLB)f(implementation)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 4251 y Fi(#include)41 b(<flux/page.h>)395
b(//)40 b(for)g(PAGE_SIZE)598 4342 y(#include)h
(<flux/machine/base_paging.h>)k(//)40 b(for)g(base_pdir_pa)598
4433 y(#include)h(<flux/x86/pc/phys_lmm.h>)j(//)c(for)g(phys_mem_max)
598 4525 y(#include)h(<node/Node.h>)395 b(//)40 b(for)g(nd)f(and)h
(nd.halt)598 4616 y(#include)h(<dmm/mdep/mDMM.h>)239
b(//)40 b(for)g(get_ustart,)h(get_usize)h(and)e(kv2phys)1885
5255 y Fz(694)p eop
PStoPSsaved restore
%%Page: (696,697) 349
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
695 696 bop 515 523 a FA(T)-8 b(ranslation)32 b(handling)515
676 y Fz(The)27 b(main)h(metho)r(ds)g(of)f Fx(mdepDTLB)e
Fz(are)h(those)i(installing)f(translations.)515 809 y
Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 809 24 4 v 29 w(mdepDTLB)p Fj(.)i Fk(i)o Fq(\021)598
900 y Fi(err_t)40 b(map\(vm_offset_t)j(la,)d(vm_offset_t)h(pa,)f
(vm_size_t)i(size,)e(off_mdep_mod_t)i(mod\);)598 992
y(err_t)e(unmap\(vm_offset_t)j(va,)d(vm_size_t)h(sz=PAGE_SIZE\);)598
1083 y(void)79 b(sync\(void\))42 b({)d(inval_tlb\(\);)j(})598
1174 y(void)79 b(pset\(off_mdepProcRegs)44 b(*ctx,)c(const)h
(off_shtl_id_t)h(&s\);)515 1349 y Fk(h)p Fi(off)p 667
1349 V 29 w(mdepDTLB::pset)30 b Fj(implementation.)e
Fk(i)o Fq(\021)598 1440 y Fi(void)79 b(off_mdepDTLB::pset\(off_mdepPr)q
(ocRe)q(gs)45 b(*ctx,)c(const)f(off_shtl_id_t)i(&s\))598
1531 y({)715 1623 y(off_Shtl)f(*self=off_Shtl::self\(\);)715
1714 y(ctx->set_ctx\(d_pdir\);)715 1805 y(if)f(\(self)g(&&)g(s)g(==)f
(self->get_id\(\)\))794 1897 y(set_pdbr\(d_pdir\);)598
1988 y(})515 2162 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB)
f(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2254 y
Fi(#include)41 b(<klib/err.h>)434 b(//)40 b(for)g(err_t)598
2345 y(#include)h(<klib/ids.h>)598 2436 y(#include)g
(<klib/mdep/types.h>)161 b(//)40 b(for)g(vm_offset_t)598
2528 y(#include)h(<dmm/mdep/mAddrTr.h>)122 b(//)40 b(for)g
(off_mdep_mod_t)598 2619 y(#include)h(<hw/mdep/mProcessor.h>)j(//)c
(for)g(off_mdepProcRegs)515 2793 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(DTLB)f(implementation)g(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 2885 y Fi(#include)41 b(<shtl/Shtl.h>)395
b(//)40 b(for)g(self\(\))598 2976 y(#include)h(<flux/machine/paging.h>)
j(//)c(for)g(set_pdbr)639 3117 y Fz(There)27 b(are)g(also)f(accessors)g
(whic)n(h)h(allo)n(w)g(us)g(to)h(get)f(individual)h(translations.)515
3233 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p
1493 3233 V 29 w(mdepDTLB)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598
3325 y Fi(//)39 b(Returns)i(a)f(reference)h(to)f(an)f(mdep)h
(translation.)598 3416 y(inline)g(off_mdepAddrTrVal)j(*operator)f
(+\(natural_t)f(i\);)598 3507 y(//)e(Gives)i(the)f(index)g(given)g(a)g
(pointer.)598 3599 y(natural_t)h(pos\(off_mdepAddrTrVal)j(*at\);)1885
5255 y Fz(695)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
696 697 bop 639 523 a Fz(T)-7 b(o)22 b(install)g(a)f(set)h(of)g
(translations)f(w)n(e)h(\014ll)g(page)f(table)h(en)n(tries)f(\(and)i(p)
r(erhaps)e(allo)r(cate)515 623 y(new)34 b(second-lev)n(el)f(page)h
(tables\).)57 b(W)-7 b(e)35 b(ha)n(v)n(e)e(b)r(orro)n(w)n(ed)f(the)j
(OSKit)f(implemen)n(tation)515 722 y(\(whic)n(h)e(as)f(y)n(ou)g(migh)n
(t)h(see,)g(needs)g(some)f(\014xes\).)49 b(W)-7 b(e)33
b(do)e(not)h(simply)g(call)f(it)h(b)r(ecause)515 822
y Fx(map)26 b Fz(is)i(also)e(used)i(to)f(c)n(hange)g(protections.)515
951 y Fk(h)p Fi(off)p 667 951 24 4 v 29 w(mdepDTLB::map)j
Fj(implementation.)d Fk(i)p Fq(\021)598 1042 y Fi(err_t)40
b(off_mdepDTLB::map\(vm_offset_t)46 b(la,)40 b(vm_offset_t)i(pa,)1539
1133 y(vm_size_t)f(size,)g(off_mdep_mod_t)h(mod\))598
1225 y({)676 1316 y(//)e(NB:)g(This)g(code)g(taken)g(from)h
(oskit:pdir_map_range)676 1499 y(assert\(mod)h(&)d(INTEL_PTE_VALID\);)
676 1590 y(assert\(!\(mod)j(&)e(INTEL_PTE_PFN\)\);)676
1773 y(while)h(\(size)f(>)f(0\))755 1864 y({)833 1955
y(pd_entry_t)j(*pde)e(=)f(pdir_find_pde\(d_pdir,)44 b(la\);)990
2138 y(pt_entry_t)e(*pte;)990 2320 y(/*)e(Find)g(the)g(page)g(table,)g
(creating)i(one)d(if)h(necessary.)81 b(*/)990 2412 y(if)40
b(\(!\(*pde)h(&)e(INTEL_PDE_VALID\)\){)1068 2503 y(int)h
(err=map_pde\(pde\);)1068 2594 y(if)g(\(err\))1147 2686
y(return)h(err;)990 2777 y(})990 2868 y(assert\(!\(*pde)h(&)e
(INTEL_PDE_SUPERPAGE\)\);)990 2960 y(pte)g(=)f
(ptab_find_pte\(pde_to_pa\(*pd)q(e\),)45 b(la\);)990
3142 y(/*)40 b(Use)g(normal)g(4KB)g(page)g(mappings.)81
b(*/)990 3234 y(do)1068 3325 y({)1147 3508 y(/*)40 b(Insert)g(the)g
(mapping.)80 b(*/)1147 3599 y(*pte)40 b(=)g(pa)f(|)h(mod;)1147
3782 y(/*)g(Advance)g(to)g(the)g(next)g(page.)80 b(*/)1147
3873 y(pte++;)1147 3964 y(la)40 b(+=)f(PAGE_SIZE;)1147
4056 y(pa)h(+=)f(PAGE_SIZE;)1147 4147 y(size)h(-=)g(PAGE_SIZE;)1068
4238 y(})990 4330 y(while)g(\(size)h(>)e(0)h(&&)f
(!superpage_aligned\(la\)\);)755 4421 y(})676 4604 y(return)i(0;)598
4878 y(})1885 5255 y Fz(696)p eop
PStoPSsaved restore
%%Page: (698,699) 350
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
697 698 bop 515 523 a Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(DTLB)f(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)o
Fq(\021)598 614 y Fi(#include)41 b(<flux/machine/base_cpu.h>)k(//)39
b(for)h(base_cpuid)639 756 y Fz(When)28 b(there)g(is)f(no)h(secondary)d
(page)i(table,)h Fx(map)p 2240 756 27 4 v 30 w(pde)e
Fz(creates)h(one.)515 872 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j
(metho)l(ds)e(of)e Fi(off)p 1594 872 24 4 v 29 w(mdepDTLB)p
Fj(.)i Fk(i)o Fq(\021)598 963 y Fi(//)39 b(Installs)i(a)f(secondary)h
(page)f(table.)598 1054 y(err_t)g(map_pde\(pd_entry_t)j(*pde\);)515
1212 y Fk(h)p Fi(off)p 667 1212 V 29 w(mdepDTLB::map)p
1203 1212 V 31 w(pde)28 b Fj(implementation.)f Fk(i)p
Fq(\021)598 1303 y Fi(//)39 b(Installs)i(a)f(secondary)h(page)f(table.)
598 1395 y(err_t)g(off_mdepDTLB::map_pde\(pd_entr)q(y_t)46
b(*pde\))598 1486 y({)676 1577 y(vm_offset_t)c(ptab_pa;)676
1669 y(int)e(err=)g(ptab_alloc\(ptab_pa\);)676 1760 y(if)g(\(err\))755
1851 y(return)g(err;)676 1943 y(assert\(pde)i(&&)d(!\(*pde)i(&)e
(INTEL_PTE_VALID\)\);)676 2034 y(*pde)h(=)g
(pa_to_pte\(ptab_pa\)|INTEL_PTE_V)q(ALID)q(|INTE)q(L_PT)q(E_USE)q(R|IN)
q(TEL_)q(PTE_W)q(RITE)q(;)676 2125 y(update_kpdirs\(pde\);)676
2217 y(return)h(EOK;)598 2308 y(})639 2540 y Fz(The)g(call)g(to)f
Fx(update)p 1372 2540 27 4 v 29 w(kpdirs)e Fz(tak)n(es)i(care)g(of)h
(sync)n(hronizing)e(the)i(part)f(of)h(page)515 2640 y(directories)26
b(dev)n(oted)h(to)g(the)h(k)n(ernel.)515 2773 y Fk(h)p
Fj(Other)g(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p
1594 2773 24 4 v 29 w(mdepDTLB)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 2864 y Fi(//)39 b(Updates)i(the)f(kernel)h(portion)g(of)e
(every)i(existing)g(page)f(directory.)598 2956 y(//)f(Need)i(to)e(be)h
(called)h(everytime)g(a)e(second-level)j(page)e(table)h(is)e(added)i
(to)e(the)598 3047 y(//)g(kernel)i(space..)598 3138 y(//)e(move)i(this)
f(to)f(a)h(private)h(method)f(of)g(off_mdepDTLB.)598
3230 y(static)g(void)g(update_kpdirs\(pd_entry_t)45 b(*pde\);)1885
5255 y Fz(697)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
698 699 bop 639 523 a Fz(Its)23 b(implemen)n(tation)g(iterates)f(o)n(v)
n(er)f(existing)j Ft(dtlb)p Fz(s)e(up)r(dating)h(the)g(mapping)g(b)r
(eing)515 623 y(added.)36 b(New)29 b Ft(dtlb)p Fz(s)f(created)e(from)i
(no)n(w)f(will)g(get)h(a)f(fresh)g(cop)n(y)g(from)g(the)h(\014rst)g
(one.)515 756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(mdepDTLB::update)p
1320 756 V 31 w(kpdirs)h Fj(implementation.)f Fk(i)p
Fq(\021)598 847 y Fi(//)39 b(Updates)i(the)f(kernel)h(portion)g(of)e
(every)i(existing)g(page)f(directory.)598 938 y(//)f(Need)i(to)e(be)h
(called)h(everytime)g(a)e(second-level)j(page)e(table)h(is)e(added)i
(to)e(the)598 1029 y(//)g(kernel)i(space..)598 1121 y(//)e(move)i(this)
f(to)f(a)h(private)h(method)f(of)g(off_mdepDTLB.)598
1212 y(void)g(off_mdepDTLB::update_kpdirs\(pd)q(_ent)q(ry_t)46
b(*pde\))598 1303 y({)676 1395 y(pd_entry_t)c
(*pde_pdir=\(pd_entry_t*\)\(\(\(natu)q(ral_t)q(\)pde)q(\)&INT)q(EL_O)q
(FFMA)q(SK\);)676 1486 y(if)e(\()f(off_DMM::is_active\(\))44
b(&&)872 1577 y(\(pde-pde_pdir\))f(<)c(\(int\)lin2pdenum\(OFF_MDEP_USR)
q(OFF\)\))q({)755 1669 y(vm_offset_t)i(va=pdenum2lin\(pde-pde_pdir\))q
(;)755 1760 y(natural_t)g(num_dtlbs=dmm.get_allocator\(\))q(->get)q
(_nal)q(loc\(\))q(;)755 1851 y(do_debug\(printf\("updating)k(kpdir)40
b(pde)g(\045x)g(\(entry)g(#\045x\):\\n",pde,\(pde-pde_pdir\)\)\))q(;)
755 1943 y(if)f(\(num_dtlbs>0\))k({)833 2034 y(for)d(\(natural_t)i
(i=0;)e(i<num_dtlbs;)i(i++\){)755 2125 y(off_mdepDTLB)g
(*mdtlb=\(dmm+i\)->get_allocator\(\))q(->ge)q(t_lal)q(loc\()q(\);)755
2217 y(*pdir_find_pde\(mdtlb->d_pdir,va)q(\)=*p)q(de;)833
2308 y(})755 2399 y(})676 2491 y(})598 2582 y(})515 2848
y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB)f(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2939 y Fi(#include)41
b(<flux/machine/base_paging.h>)k(//)40 b(for)g(pdir_find_pte)i(et)e
(al.)598 3030 y(#include)h(<flux/machine/paging.h>)639
3171 y Fz(T)-7 b(o)27 b(unmap)h(a)f(memory)g(range)f(w)n(e)i(b)r(orro)n
(w)d(more)i(co)r(de)h(from)f(the)h(OSKit.)515 3304 y
Fk(h)p Fi(off)p 667 3304 V 29 w(mdepDTLB::unmap)i Fj(implementation.)e
Fk(i)p Fq(\021)598 3396 y Fi(err_t)40 b(off_mdepDTLB::unmap\(vm_offset)
q(_t)45 b(va,)40 b(vm_size_t)i(sz\))598 3487 y({)676
3578 y(pdir_unmap_range\(d_pdir,va,s)q(z\);)676 3670
y(return)f(EOK;)598 3761 y(})639 3993 y Fz(Here)26 b(w)n(e)f(used)g
Fx(ptab)p 1322 3993 27 4 v 30 w(alloc)f Fz(whic)n(h)h(is)h(no)n(w)e(a)i
(protected)f(metho)r(d)h(used)f(to)h(allo)r(cate)515
4093 y(a)h(new)h(page)e(table.)515 4226 y Fk(h)p Fj(Other)i(pr)l(ote)l
(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 4226 24 4
v 29 w(mdepDTLB)p Fj(.)i Fk(i)o Fz(+)p Fq(\021)598 4317
y Fi(//)39 b(Allocates)j(a)d(new)h(page)g(table.)598
4408 y(int)g(ptab_alloc\(vm_offset_t)k(&pa\);)1885 5255
y Fz(698)p eop
PStoPSsaved restore
%%Page: (700,701) 351
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
699 700 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(mdepDTLB::ptab)p 1242 523 V 31 w(alloc)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Allocates)j(a)d(new)h(page)g
(table.)598 706 y(int)g(off_mdepDTLB::ptab_alloc\(vm_off)q(set_)q(t)45
b(&pa\))598 797 y({)676 888 y(void)40 b(*ptab_va)h(=)f
(\(void*\)off_KVM::raw_pg_alloc\(\))q(;)676 980 y
(do_debug\(assert\(ptab_va\)\);)676 1071 y(if)g(\(ptab_va)h(==)f(0\))
755 1162 y(return)g(ENOMEM;)912 1345 y(/*)f(Clear)i(it)e(out)h(to)g
(make)g(sure)g(all)g(entries)h(are)f(invalid.)80 b(*/)676
1436 y(memset\(ptab_va,)43 b(0,)d(PAGE_SIZE\);)676 1619
y(pa)g(=)f(off_mdepDMM::kv2phys\(\(vm_off)q(set_)q(t\)pt)q(ab_va)q(\);)
676 1710 y(return)i(0;)598 1802 y(})515 2067 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB)f(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)o Fq(\021)598 2159 y Fi(#include)41
b(<dmm/KVM.h>)473 b(//)40 b(for)g(raw_pg_alloc)639 2300
y Fz(Access)29 b(op)r(erators)e(are)h(straigh)n(tforw)n(ard.)38
b(They)29 b(m)n(ust)g(tak)n(e)f(care)g(of)h(giving)f(k)n(ernel)515
2399 y(virtual)f(addresses)f(to)h(their)h(callers.)515
2532 y Fk(h)p Fi(off)p 667 2532 V 29 w(mdepDTLB::operator)43
b(+)28 b Fj(implementation.)f Fk(i)p Fq(\021)598 2623
y Fi(//)39 b(Returns)i(a)f(reference)h(to)f(an)f(mdep)h(translation.)
598 2715 y(inline)g(off_mdepAddrTrVal)j(*off_mdepDTLB::operator)i
(+\(natural_t)d(i\))598 2806 y({)676 2897 y(pt_entry_t)g
(*pte=pdir_find_pte\(d_pdir,i\);)676 2989 y(if)e(\(!pte\){)755
3080 y(map_pde\(pdir_find_pde\(d_pdir,i\))q(\);)755 3171
y(pte=pdir_find_pte\(d_pdir,i\);)676 3263 y(})676 3354
y(return)h(\(off_mdepAddrTrVal*\)\(pte\);)598 3445 y(})515
3620 y Fk(h)p Fi(off)p 667 3620 V 29 w(mdepDTLB::pos)30
b Fj(implementation.)d Fk(i)p Fq(\021)598 3711 y Fi(//)39
b(Gives)i(the)f(index)g(given)g(a)g(pointer.)598 3802
y(natural_t)h(off_mdepDTLB::pos\(off_mdepAdd)q(rTrV)q(al)k(*at\))598
3894 y({)676 3985 y(\(void\)at;)676 4076 y(otsan\(\);)865
b(//)40 b(Is)f(this)i(needed)f(at)g(all?)598 4168 y(})515
4525 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
4616 y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40
b(for)g(otsan)1885 5255 y Fz(699)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
700 701 bop 639 523 a Fz(W)-7 b(e)39 b(are)f(only)g(concerned)g(ab)r
(out)h(lo)r(cal)f(address)f(translations.)69 b(They)38
b(m)n(ust)h(im-)515 623 y(plemen)n(t)25 b Fx(is)p 921
623 27 4 v 30 w(remote)d Fz(as)i(a)g(service)g(to)g(the)h(mac)n(hine)f
(indep)r(enden)n(t)i(address)d(translation)515 722 y(mac)n(hinery)-7
b(.)34 b(Suc)n(h)21 b(metho)r(d)h(m)n(ust)g(return)f(non-zero)f(when)i
(the)g(translation)e(is)h(supp)r(osed)515 822 y(to)29
b(b)r(e)h(a)f(remote)g(one)g(\(in)h(whic)n(h)g(case)e(the)i(page)f
(frame)g(n)n(um)n(b)r(er)g(is)h(an)f(index)g(in)n(to)h(the)515
922 y Ft(dtlb)d Fz(remote)g(address)f(translation)h(allo)r(cator\).)515
1054 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(addr)l(ess)h(tr)l
(anslation.)f Fk(i)p Fq(\021)598 1146 y Fi(//)39 b(An)h(address)h
(translation)h(value)e(for)g(ix86s)598 1237 y(//)598
1328 y(class)g(off_mdepAddrTrVal)j({)598 1420 y(private:)676
1511 y(volatile)e(pt_entry_t)h(a_pte;)119 b(//)39 b(ix86)i(Page)f
(table)g(entry.)598 1602 y(public:)676 1694 y(inline)h(boolean_t)g
(is_remote\(void\))i(const;)676 1876 y(//)d(To)g(test)g(wrt)g(NULL)676
1968 y(operator)h(boolean_t\(void\))i(const)d({return)h
(pte_to_pa\(a_pte\);})676 2059 y(inline)g(const)f(vm_offset_t)i
(get_ma\(void\))g(const)e({return)h(pte_to_pa\(a_pte\);})676
2150 y(inline)g(const)f(vm_offset_t)i(get_pfn\(void\))g(const{return)g
(atop\(pte_to_pa\(a_pte\)\);})676 2242 y(inline)f(off_mdep_mod_t)121
b(get_mod\(void\))42 b(const)e({)g(return)g(a_pte&INTEL_OFFMASK;)k(})
676 2424 y(inline)d(void)f(set_pfn\(vm_offset_t)j(pfn\))e({)755
2516 y(a_pte)f(=)f(ptoa\(pfn\)|\(a_pte)k(&)d(INTEL_OFFMASK\);)676
2607 y(};)676 2698 y(inline)h(void)f(set_ma\(vm_offset_t)j(ma\))d({)755
2790 y(a_pte)g(=)f(\(ma&INTEL_PTE_PFN\)|\(a_pte&I)q(NTEL)q(_OFFM)q
(ASK\))q(;)676 2881 y(})676 2972 y(inline)i(void)f
(set_mod\(off_mdep_mod_t)k(mod\))c({)755 3064 y(a_pte)g(=)f
(\(a_pte&INTEL_PTE_PFN\)|\(mod&)q(INTE)q(L_OFF)q(MASK)q(\);)676
3155 y(})598 3246 y(};)515 3512 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(addr)l(ess)h(tr)l(anslation)f(dep)l
(endencies.)g Fk(i)p Fq(\021)598 3603 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(et)f(al.)598
3694 y(#include)h(<flux/machine/paging.h>)j(//)c(for)g(pt_entry_t)1885
5255 y Fz(700)p eop
PStoPSsaved restore
%%Page: (702,703) 352
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
701 702 bop 639 523 a Fz(Mo)r(de)28 b(bits)g(are)e(enco)r(ded)i(as)f
(an)g Fx(mdep)p 1889 523 27 4 v 30 w(mdep)p 2095 523
V 30 w(mod)p 2257 523 V 30 w(t)p Fz(.)515 656 y Fk(h)p
Fj(O\013)g(machine)h(dep)l(endent)h(mo)l(de)f(bits.)g
Fk(i)p Fq(\021)598 747 y Fi(//)39 b(Translation)j(mode)e(bits)g(for)g
(ix86)g(machines.)598 839 y(//)598 930 y(struct)g(off_mdep_mod_t)j({)
598 1021 y(natural_t)e(m_bits;)676 1112 y(off_mdep_mod_t\(natural_t)k
(bits=0\):)c(m_bits\(bits\))h({;})676 1204 y(operator)f
(natural_t\(void\))i(const)d({)g(return)g(m_bits;)h(})676
1386 y(//)f(Check)g(bits)676 1478 y(boolean_t)h(has_rd\(void\))h(const)
f({)e(return)i(\(m_bits&INTEL_PTE_VALID\);)k(})676 1569
y(boolean_t)c(has_wr\(void\))h(const)f({)e(return)i
(\(m_bits&INTEL_PTE_WRITE\);)k(})676 1660 y(boolean_t)c(has_ex\(void\))
h(const)f({)e(return)i(has_rd\(\);)g(})676 1752 y(boolean_t)g
(has_ref\(void\)const)j({)39 b(return)i(m_bits&INTEL_PTE_REF;)j(})676
1843 y(boolean_t)d(has_mod\(void\)const)j({)39 b(return)i
(m_bits&INTEL_PTE_MOD;)j(})676 1934 y(boolean_t)d
(has_ncache\(void\)const{retur)q(n)k(\(m_bits&INTEL_PTE_NCACHE\);)g(})
676 2026 y(boolean_t)c(has_valid\(void\)const{return)46
b(\(m_bits&INTEL_PTE_AVAIL\);)f(})676 2117 y(boolean_t)c
(has_usr\(void\)const{return)k(\(m_bits&INTEL_PTE_USER\);)g(})676
2208 y(boolean_t)c(has_rem\(void\)const{return)k
(\(m_bits&INTEL_PTE_USR1\);)g(})676 2300 y(//)40 b(Set)g(bits)676
2391 y(void)g(set_rd\(void\))i({m_bits|=INTEL_PTE_VALID;)j(})676
2482 y(void)40 b(set_wr\(void\))i({m_bits|=INTEL_PTE_WRITE;)j(})676
2574 y(void)40 b(set_ex\(void\))i({m_bits|=INTEL_PTE_REF;)j(})676
2665 y(void)40 b(set_mod\(void\))j({m_bits|=INTEL_PTE_MOD;)h(})676
2756 y(void)c(set_ncache\(void\))j({m_bits|=INTEL_PTE_NCACHE;)i(})676
2848 y(void)40 b(set_valid\(void\))j({m_bits|=INTEL_PTE_AVAIL;)i(})676
2939 y(void)40 b(set_usr\(void\))j({m_bits|=INTEL_PTE_USER;)h(})676
3030 y(void)c(set_rem\(void\))j({m_bits|=INTEL_PTE_USR1;)h(})676
3213 y(//)c(Clear)g(bits)676 3304 y(void)g(clr_rd\(void\))i
({m_bits&=~INTEL_PTE_VALID;)j(})676 3396 y(void)40 b(clr_wr\(void\))i
({m_bits&=~INTEL_PTE_WRITE;)j(})676 3487 y(void)40 b(clr_ex\(void\))i
({m_bits&=~INTEL_PTE_REF;)j(})676 3578 y(void)40 b(clr_mod\(void\))j
({m_bits&=~INTEL_PTE_MOD;)h(})676 3670 y(void)c(clr_ncache\(void\))j
({m_bits&=~INTEL_PTE_NCACHE;)j(})676 3761 y(void)40 b
(clr_valid\(void\))j({m_bits&=~INTEL_PTE_AVAIL;)i(})676
3852 y(void)40 b(clr_usr\(void\))j({m_bits&=~INTEL_PTE_USER;)h(})676
3944 y(void)c(clr_rem\(void\))j({m_bits&=~INTEL_PTE_USR1;)h(})598
4126 y(};)598 4309 y(const)c(natural_t)h(OFF_MOD_R=INTEL_PTE_VALID;)598
4400 y(const)f(natural_t)h(OFF_MOD_W=INTEL_PTE_WRITE;)598
4491 y(const)f(natural_t)h(OFF_MOD_X=INTEL_PTE_VALID;)598
4583 y(const)f(natural_t)h(OFF_MOD_V=\(INTEL_PTE_VALID|)q(INTEL)q(_PTE)
q(_AVAI)q(L\);)598 4674 y(const)f(natural_t)h
(OFF_MOD_U=INTEL_PTE_USER;)598 4765 y(const)f(natural_t)h
(OFF_MOD_RW=INTEL_PTE_VALID|)q(INTEL)q(_PTE)q(_WRIT)q(E;)598
4857 y(const)f(natural_t)h(OFF_MOD_RX=INTEL_PTE_VALID;)598
4948 y(const)f(natural_t)h(OFF_MOD_RWX=INTEL_PTE_VALID)q(|INTE)q(L_PT)q
(E_WRI)q(TE;)1885 5255 y Fz(701)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
702 703 bop 598 523 a Fi(const)40 b(natural_t)h
(OFF_MOD_REM=INTEL_PTE_USR1;)515 697 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(addr)l(ess)h(tr)l(anslation)f(dep)l
(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 789 y Fi(#include)41
b(<flux/machine/paging.h>)639 930 y Fz(A)25 b(mac)n(hine)f(dep)r(enden)
n(t)h(translation)e(is)h(guaran)n(teed)f(to)h(ha)n(v)n(e)f(a)h(lo)r
(cal)g(\(v)-5 b(alid\))25 b(frame)515 1029 y(when)j(its)f(mo)r(de)h
(bits)g(di\013er)g(from)f Fx(MOD)p 1781 1029 27 4 v 30
w(REM)p Fz(.)515 1162 y Fk(h)p Fi(off)p 667 1162 24 4
v 29 w(mdepAddrTrVal::is)p 1359 1162 V 32 w(remote)h
Fj(implementation.)g Fk(i)p Fq(\021)598 1254 y Fi(extern)40
b(inline)h(boolean_t)g(off_mdepAddrTrVal::is_remote)q(\(void)q(\))k
(const)c({)676 1345 y(return)g(\(a_pte&OFF_MOD_REM\);)598
1436 y(})1885 5255 y Fz(702)p eop
PStoPSsaved restore
%%Page: (704,705) 353
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
703 704 bop 515 523 a FA(Ro)s(ot)30 b(dtlbs)515 676 y
Fz(The)g(creation)f(of)h(the)g(initial)g Ft(dtlb)g Fz(is)g(a)g(little)h
(bit)f(singular.)43 b(It)30 b(is)g(the)h(one)e(pro)n(viding)515
776 y(k)n(ernel)23 b(virtual)h(memory)-7 b(,)24 b(whic)n(h)g(is)h(used)
f(to)g(service)f Fx(malloc)f Fz(within)j(the)g(k)n(ernel,)f(whic)n(h)
515 876 y(should)751 845 y Fp(10)848 876 y Fz(b)r(e)k(used)g(in)g(turn)
g(to)f(allo)r(cate)g(mac)n(hine)g(dep)r(enden)n(t)h Ft(dtlb)g
Fz(data.)639 975 y(W)-7 b(e)28 b(pro)n(vide)e(a)h Ft(dtlb)g
Fz(sub)r(class)g(named)g Fx(RootDTLB)e Fz(whic)n(h)i(can)g(b)r(e)h
(called)f(after)g(the)515 1075 y(mac)n(hine)h(dep)r(enden)n(t)g
Ft(dmm)h Fz(has)e(b)r(een)i(started.)38 b(Its)28 b(constructor)f(will)h
(setup)h(an)f(initial)515 1174 y Ft(dtlb)f Fz(for)g(op)r(eration.)515
1307 y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(r)l(o)l(ot)g(DTLB.)e
Fk(i)p Fq(\021)598 1399 y Fi(//)39 b(An)h(initial)h(DTLB)f(intended)h
(for)f(kernel)h(use.)598 1490 y(//)598 1581 y(class)f(off_mdepRootDTLB)
j(:)c(public)i(off_DTLB)g({)598 1673 y(public:)676 1764
y(//)f(Allows)g(unitialized)i(dtlbs)676 1855 y
(off_mdepRootDTLB\(void\))i(:)755 1947 y(off_DTLB\(\))d({;})676
2129 y(//)f(To)g(preinitialize)i(the)e(root)g(DTLB.)676
2220 y(off_mdepRootDTLB\(const)k(off_dtlb_id_t)f(&id,)d(off_DMM)h(*c\))
e(:)755 2312 y(off_DTLB\(id,OFF_MAGIC_DTLB,c\))676 2403
y({;})676 2586 y(//)h(Creates)h(a)e(root)h(DTLB.)676
2677 y(off_mdepRootDTLB\(const)k(off_Protection)f(&p,)d(const)g
(off_prtl_id_t)i(&domain\))f(:)755 2768 y(off_DTLB\(\))676
2860 y({)755 2951 y(protect\(p\);)755 3042 y(set_domain\(domain\);)755
3134 y(r_flags=0;)755 3225 y(d_mdep=off_mdepDMM::get_kdtlb\(\))q(;)676
3316 y(})676 3499 y(void)f(*operator)i(new\(size_t)f(s,)f
(off_mdepRootDTLB)j(*p\))d({)755 3590 y(\(void\)s;)755
3682 y(return)g(\(void*\)p;)676 3773 y(})598 3864 y(};)639
4097 y Fz(When)35 b(its)f(constructor)f(is)h(called,)h(the)g(mac)n
(hine)e(dep)r(enden)n(t)i(part)f(has)f(b)r(een)i(cre-)515
4196 y(ated)c(with)i(an)e(iden)n(tit)n(y)h(map)f(for)h(installed)f
(memory)-7 b(.)49 b(It)32 b(m)n(ust)g(th)n(us)f(skip)h(its)g
Fx(d)p 3179 4196 27 4 v 31 w(mdep)515 4296 y Fz(initialization.)k(W)-7
b(e)28 b(simply)g(ha)n(v)n(e)e(to)h(unmap)h(the)g(\014rst)f(page)f
(\(to)i(catc)n(h)f(n)n(ull)g(p)r(oin)n(ters\).)515 4429
y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(r)l(o)l(ot)g(DTLB)f(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4520 y Fi(#include)41
b(<dmm/DTLB.h>)p 515 4929 1146 4 v 577 4983 a Fm(10)642
5006 y Fl(The)24 b(curren)n(t)g(implemen)n(tation)f(migh)n(t)g(not)1885
5255 y Fz(703)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
704 705 bop 515 523 a Fn(5.4.2)112 b(DMM)38 b(for)g(ix86)e
Fd(C)8 b FC(++)38 b Fn(source)g(\014les)515 676 y Fz(Mac)n(hine)27
b(dep)r(enden)n(t)h Ft(dmm)g Fz(is)f(in)h Fx(dmm/mdep/mDMM.h)21
b Fz(and)28 b Fx(dmm/mdep/mDMM.C)p Fz(.)515 809 y Fk(h)p
Fj(mdep)f(mDMM.h*)11 b Fk(i)p Fq(\021)598 900 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 992 y Fi(#ifndef)41 b(__OFF_MDEP_DMM_H)598
1083 y(#define)g(__OFF_MDEP_DMM_H)h(1)598 1266 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(DMM)e(dep)l(endencies.)j
Fk(i)598 1448 y Fi(#ifdef)40 b(__KERNEL__)598 1540 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DMM.)e
Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598 1814
y(#endif)g(//)g(__OFF_MDEP_DMM_H)515 1988 y Fk(h)p Fj(mdep)27
b(mDMM.C*)11 b Fk(i)o Fq(\021)598 2079 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 2262 y Fi(#include)41 b(<dmm/mdep/mDMM.h>)239
b(//)40 b(Exported)h(interface)598 2353 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(DMM)e(implementation)h(dep)l(endencies.)i
Fk(i)598 2536 y(h)p Fj(O\013)d(machine)h(dep)l(endent)h(DMM)e(static)i
(memb)l(ers.)f Fk(i)598 2719 y(h)p Fi(off)p 750 2719
24 4 v 29 w(mdepDMM::off)p 1247 2719 V 31 w(mdepDMM)h
Fj(implementation.)e Fk(i)598 2810 y(h)p Fi(off)p 750
2810 V 29 w(mdepDMM::start)j Fj(implementation.)e Fk(i)598
2901 y(h)p Fi(off)p 750 2901 V 29 w(mdepDMM::self)p 1286
2901 V 31 w(start)g Fj(implementation.)g Fk(i)639 3134
y Ft(dtlb)g Fz(co)r(de)f(is)h(at)f Fx(dmm/mdep/mDTLB.h)21
b Fz(and)27 b Fx(dmm/mdep/mDTLB.C)p Fz(.)515 3267 y Fk(h)p
Fj(mdep)g(mDTLB.h*)11 b Fk(i)p Fq(\021)598 3358 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 3449 y Fi(#ifndef)41 b(__OFF_MDEP_DTLB_H)598
3541 y(#define)g(__OFF_MDEP_DTLB_H)i(1)598 3723 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB)f(dep)l(endencies.)h
Fk(i)598 3906 y Fi(#ifdef)40 b(__KERNEL__)598 3997 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(DTLB.)e
Fk(i)598 4180 y(h)p Fi(off)p 750 4180 V 29 w(mdepDTLB::operator)43
b(+)28 b Fj(implementation.)f Fk(i)598 4271 y Fi(#endif)40
b(//)g(__KERNEL__)598 4545 y(#endif)g(//)g(!__OFF_MDEP_DTLB_H)1885
5255 y Fz(704)p eop
PStoPSsaved restore
%%Page: (706,707) 354
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
705 706 bop 515 523 a Fk(h)p Fj(mdep)27 b(mDTLB.C*)11
b Fk(i)p Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 797 y
Fi(#include)41 b(<dmm/mdep/mDTLB.h>)200 b(//)40 b(Exported)h
(interface.)598 888 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h
(DTLB)f(implementation)g(dep)l(endencies.)h Fk(i)598
1071 y(h)p Fi(off)p 750 1071 24 4 v 29 w(mdepDTLB::off)p
1286 1071 V 31 w(mdepDTLB)g Fj(implementation.)e Fk(i)598
1162 y(h)p Fi(off)p 750 1162 V 29 w(mdepDTLB::~off)p
1325 1162 V 31 w(mdepDTLB)i Fj(implementation.)f Fk(i)598
1254 y(h)p Fi(off)p 750 1254 V 29 w(mdepDTLB::map)i Fj(implementation.)
d Fk(i)598 1345 y(h)p Fi(off)p 750 1345 V 29 w(mdepDTLB::unmap)j
Fj(implementation.)e Fk(i)598 1436 y(h)p Fi(off)p 750
1436 V 29 w(mdepDTLB::ptab)p 1325 1436 V 31 w(alloc)h
Fj(implementation.)e Fk(i)598 1528 y(h)p Fi(off)p 750
1528 V 29 w(mdepDTLB::update)p 1403 1528 V 31 w(kpdirs)i
Fj(implementation.)f Fk(i)598 1619 y(h)p Fi(off)p 750
1619 V 29 w(mdepDTLB::map)p 1286 1619 V 31 w(pde)g Fj(implementation.)f
Fk(i)598 1710 y(h)p Fi(off)p 750 1710 V 29 w(mdepDTLB::pos)j
Fj(implementation.)d Fk(i)598 1802 y(h)p Fi(off)p 750
1802 V 29 w(mdepDTLB::pset)j Fj(implementation.)e Fk(i)639
1943 y Fz(Mac)n(hine)f(dep)r(enden)n(t)i(address)d(translation)g(liv)n
(es)h(in)h Fx(mdep/mAddrTr.h)p Fz(.)515 2076 y Fk(h)p
Fj(mdep)f(mA)l(ddrT)-6 b(r.h*)11 b Fk(i)q Fq(\021)598
2167 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2258 y Fi(#ifndef)41
b(__OFF_MDEP_ADDR_TR_H)598 2350 y(#define)g(__OFF_MDEP_ADDR_TR_H)i(1)
598 2532 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(addr)l(ess)h
(tr)l(anslation)f(dep)l(endencies.)g Fk(i)598 2715 y(h)p
Fj(O\013)e(machine)h(dep)l(endent)h(mo)l(de)f(bits.)g
Fk(i)598 2806 y Fi(#ifdef)40 b(__KERNEL__)598 2897 y
Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(addr)l(ess)h(tr)l
(anslation.)f Fk(i)598 3080 y(h)p Fi(off)p 750 3080 V
29 w(mdepAddrTrVal::is)p 1442 3080 V 32 w(remote)f Fj(implementation.)g
Fk(i)598 3171 y Fi(#endif)40 b(//)g(__KERNEL__)598 3354
y(#endif)g(//)g(!__OFF_MDEP_ADDR_TR_H)639 3495 y Fz(Mac)n(hine)18
b(dep)r(enden)n(t)h(ro)r(ot)f Ft(dtlb)p Fz(s)g(are)f(in)i
Fx(mdep/mRootDTLB.)o(h)12 b Fz(and)19 b Fx(mdep/mRootDTLB.)o(C)p
Fz(.)515 3628 y Fk(h)p Fj(mdep)27 b(mR)l(o)l(otDTLB.h*)11
b Fk(i)q Fq(\021)598 3719 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3811 y Fi(#ifndef)41 b(__OFF_MDEP_ROOT_DTLB_H)598 3902
y(#define)g(__OFF_MDEP_ROOT_DTLB_H)j(1)598 4085 y Fk(h)p
Fj(O\013)27 b(machine)h(dep)l(endent)h(r)l(o)l(ot)g(DTLB)f(dep)l
(endencies.)h Fk(i)598 4267 y Fi(#ifdef)40 b(__KERNEL__)598
4359 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(r)l(o)l(ot)g
(DTLB.)e Fk(i)598 4450 y Fi(#endif)40 b(//)g(__KERNEL__)598
4724 y(#endif)g(//)g(!__OFF_MDEP_ROOT_DTLB_H)1885 5255
y Fz(705)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
706 707 bop 515 523 a Fr(5.5)135 b(Kernel)46 b(address)f(space)g
(manager)515 705 y Fz(The)28 b(k)n(ernel)g(uses)f(a)h(simple)h(virtual)
f(memory)f(manager)g(with)i(an)f(arc)n(hitecture)f(similar)515
805 y(to)39 b(those)g(used)g(b)n(y)g(user)g(pro)r(cesses.)70
b(There)39 b(is)g(a)g(cen)n(tral)f(ob)5 b(ject)39 b(whic)n(h)g(in)n
(tercepts)515 904 y(virtual)28 b(memory)g(requests)g(and)h(delegates)f
(them)i(among)d(a)i(set)g(of)g(memory)f(segmen)n(ts)515
1004 y(or)e(regions.)639 1103 y(The)c(k)n(ernel)f(virtual)h(memory)f
(manger)f(\(KVM\))j(is)f(used)f(mostly)h(for)f(blo)r(c)n(k)h(allo)r
(cator)515 1203 y(paging,)h(k)n(ernel)f(stac)n(ks)g(for)h(sh)n(uttles,)
h(and)f(dynamic)g(memory)g(allo)r(cation.)34 b(It)24
b(is)f(resp)r(on-)515 1303 y(sible)30 b(of)h(administering)f(the)h(k)n
(ernel)f(address)f(space.)46 b(The)31 b(la)n(y)n(out)e(of)i(virtual)f
(memory)515 1402 y(can)d(b)r(e)h(found)g(in)g(\014gure)f(5.4.)515
3108 y @beginspecial 0 @llx 0 @lly 526 @urx 292 @ury
3437 @rwi @setspecial
%%BeginDocument: fig/kvm.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-34.0 318.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 792 m 0 0 l 612 0 l 612 792 l cp clip
 0.06000 0.06000 sc
/Times-Roman ff 180.00 scf sf
6300 4350 m
gs 1 -1 sc  90.0 rot (or TLB entries) col-1 sh gr
/Times-Roman ff 180.00 scf sf
6075 4350 m
gs 1 -1 sc  90.0 rot (Page tables) col-1 sh gr
15.000 slw
% Polyline
n 600 600 m 9300 600 l 9300 2100 l 600 2100 l cp gs col-1 s gr 
% Polyline
n 3000 600 m 3000 2100 l gs col-1 s gr 
7.500 slw
% Polyline
n 600 3000 m 6600 3000 l 6600 4500 l 600 4500 l cp gs col-1 s gr 
% Polyline
 [15 50.0] 50.0 sd
gs  clippath
630 2877 m 600 2973 l 570 2877 l 570 3015 l 630 3015 l  cp clip
570 2223 m 600 2127 l 630 2223 l 630 2085 l 570 2085 l  cp clip
n 600 2100 m 600 3000 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 570 2223 m 600 2127 l 630 2223 l 600 2247 l 570 2223 l  cp gs 0.00 setgray ef gr  col-1 s
% arrowhead
n 630 2877 m 600 2973 l 570 2877 l 600 2853 l 630 2877 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
 [15 50.0] 50.0 sd
gs  clippath
6488 2941 m 6573 2993 l 6473 2999 l 6607 3033 l 6622 2975 l  cp clip
3112 2159 m 3026 2106 l 3127 2101 l 2993 2067 l 2978 2125 l  cp clip
n 3000 2100 m 6600 3000 l gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 3112 2159 m 3026 2106 l 3127 2101 l 3143 2136 l 3112 2159 l  cp gs 0.00 setgray ef gr  col-1 s
% arrowhead
n 6488 2941 m 6573 2993 l 6473 2999 l 6457 2964 l 6488 2941 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
n 5700 3000 m 5700 4500 l gs col-1 s gr 
% Polyline
n 2700 3000 m 2700 4500 l gs col-1 s gr 
% Polyline
 [66.7] 0 sd
n 3300 3000 m 3300 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 3000 3000 m 3000 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 3600 3000 m 3600 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 3900 3000 m 3900 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 4500 3000 m 4500 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 4800 3000 m 4800 4500 l gs col-1 s gr  [] 0 sd
% Polyline
 [66.7] 0 sd
n 5100 3000 m 5100 4500 l gs col-1 s gr  [] 0 sd
/Courier ff 180.00 scf sf
600 525 m
gs 1 -1 sc (0x0...0) col-1 sh gr
/Courier ff 180.00 scf sf
8400 525 m
gs 1 -1 sc (0xf...f) col-1 sh gr
/Times-Italic ff 180.00 scf sf
4050 3825 m
gs 1 -1 sc (......) col-1 sh gr
/Times-Italic ff 180.00 scf sf
5325 3825 m
gs 1 -1 sc (......) col-1 sh gr
/Times-Bold ff 180.00 scf sf
900 1425 m
gs 1 -1 sc (Kernel Virtual) col-1 sh gr
/Times-Bold ff 180.00 scf sf
3300 1425 m
gs 1 -1 sc (User Virtual) col-1 sh gr
/Times-Bold ff 180.00 scf sf
900 3525 m
gs 1 -1 sc (Identity) col-1 sh gr
/Times-Bold ff 180.00 scf sf
900 3750 m
gs 1 -1 sc (mapping) col-1 sh gr
/Times-Roman ff 180.00 scf sf
2925 4350 m
gs 1 -1 sc  90.0 rot (KVM region #0) col-1 sh gr
/Times-Roman ff 180.00 scf sf
3225 4350 m
gs 1 -1 sc  90.0 rot (KVM region #1) col-1 sh gr
/Times-Roman ff 180.00 scf sf
4725 4275 m
gs 1 -1 sc  90.0 rot (kern stack #0) col-1 sh gr
/Times-Roman ff 180.00 scf sf
5025 4275 m
gs 1 -1 sc  90.0 rot (kern stack #1) col-1 sh gr
/Times-Roman ff 180.00 scf sf
1800 3525 m
gs 1 -1 sc (kern text) col-1 sh gr
/Times-Roman ff 180.00 scf sf
1800 3750 m
gs 1 -1 sc (and data) col-1 sh gr
/Times-Italic ff 180.00 scf sf
750 4800 m
gs 1 -1 sc (physical memory) col-1 sh gr
/Times-Italic ff 180.00 scf sf
2700 4800 m
gs 1 -1 sc (Block allocators) col-1 sh gr
/Times-Italic ff 180.00 scf sf
2700 5025 m
gs 1 -1 sc (\(relocation table entries,) col-1 sh gr
/Times-Italic ff 180.00 scf sf
2700 5250 m
gs 1 -1 sc (shuttles, portals, dtlbs,....\)) col-1 sh gr
/Times-Italic ff 180.00 scf sf
4575 4800 m
gs 1 -1 sc (Kernel stacks) col-1 sh gr
/Times-Italic ff 180.00 scf sf
5775 4800 m
gs 1 -1 sc (Secondary page) col-1 sh gr
/Times-Italic ff 180.00 scf sf
5775 5025 m
gs 1 -1 sc (tables for the current process) col-1 sh gr
/Times-Italic ff 180.00 scf sf
5775 5250 m
gs 1 -1 sc (or software TLB entries.) col-1 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 1192 3291 a(Figure)g(5.4:)36 b(Kernel)26
b(virtual)i(memory)e(la)n(y)n(out)639 3573 y(Besides,)h(it)g(main)n
(tains)f(a)g Ft(dtlb)h Fz(for)f(k)n(ernel)g(virtual)g(memory)g(when)h
Ft(dtlb)f Fz(supp)r(ort)515 3673 y(is)h(enabled)h(and)g(uses)f(ph)n
(ysical)g(memory)g(otherwise.)37 b(It)28 b(is)f(the)i(en)n(try)e(p)r
(oin)n(t)h(for)f(k)n(ernel)515 3772 y(page)f(faults)i(and)g(ev)n(ery)e
(other)h(k)n(ernel)g(\(virtual\))g(memory)g(managemen)n(t)g(issue.)515
3905 y Fk(h)p Fj(O\013)g(kernel)h(virtual)g(memory)g(manager.)g
Fk(i)p Fq(\021)598 3996 y Fi(class)40 b(off_KVM)h({)598
4088 y(public:)676 4179 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 4179 24 4 v 29 w(KVM)p Fj(.)h Fk(i)598
4270 y Fi(protected:)676 4362 y Fk(h)p Fj(O\013)f(pr)l(ote)l(cte)l(d)k
(metho)l(ds)e(for)e(inte)l(grity)i(che)l(cke)l(d)h(r)l(esour)l(c)l(es.)
f Fk(i)676 4453 y(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 4453 V 29 w(KVM)p Fj(.)h Fk(i)598 4544
y Fi(private:)676 4636 y Fk(h)p Fj(O\013)f(private)i(memb)l(ers)g(for)e
(inte)l(grity)i(che)l(cke)l(d)g(r)l(esour)l(c)l(es.)h
Fk(i)676 4727 y(h)p Fj(Other)f(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4727 V 29 w(KVM)p Fj(.)h Fk(i)676 4818
y(h)p Fj(Other)h(private)f(metho)l(ds)h(of)f Fi(off)p
1691 4818 V 29 w(KVM)p Fj(.)f Fk(i)598 4910 y Fi(};)1885
5255 y Fz(706)p eop
PStoPSsaved restore
%%Page: (708,709) 355
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
707 708 bop 639 523 a Fz(There)27 b(is)h(a)f(single)g
Fx(kvm)g Fz(ob)5 b(ject)27 b(instan)n(tiated)g(on)h(its)f(o)n(wn)g
(\(all)h(its)g(state)f(is)h(static\).)515 639 y Fk(h)p
Fj(O\013)f(KVM)g(instanc)l(e.)i Fk(i)o Fq(\021)598 731
y Fi(off_KVM)41 b(kvm;)515 888 y Fk(h)p Fj(O\013)27 b(KVM)g(exp)l(orte)
l(d)j(variables.)e Fk(i)p Fq(\021)598 980 y Fi(extern)40
b(off_KVM)h(kvm;)515 1154 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h
(of)e Fi(off)p 1493 1154 24 4 v 29 w(KVM)p Fj(.)g Fk(i)p
Fq(\021)598 1245 y Fi(//)39 b(Creates)i(the)f(KVM)g(instance.)598
1337 y(off_KVM\(void\);)515 1511 y Fk(h)p Fi(off)p 667
1511 V 29 w(KVM::off)p 1008 1511 V 30 w(KVM)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1602 y Fi(//)39 b(Creates)i(the)f(KVM)g(instance.)
598 1694 y(off_KVM::off_KVM\(void\))598 1785 y({)676
1876 y(off_Magic)h(magic\(OFF_MAGIC_KVM\);)676 1968 y
Fk(h)p Fj(Initialize)27 b(inte)l(grity)i(che)l(cke)l(d)g(obje)l(ct)g
(with)e Fi(magic)p Fj(.)h Fk(i)676 2059 y(h)p Fj(Initialize)f(other)i
(private)f(memb)l(ers)h(of)e Fi(off)p 2015 2059 V 29
w(KVM)p Fj(.)h Fk(i)598 2150 y Fi(})639 2383 y Fz(After)e(ph)n(ysical)e
(memory)g(banks)g(ha)n(v)n(e)g(b)r(een)i(started,)f(the)g(KVM)g(ob)5
b(ject)25 b(is)g(noti\014ed)515 2482 y(of)33 b(b)r(oth)g(the)g(supp)r
(ort)g(for)g Ft(dtlb)p Fz(s)f(in)h(the)h(k)n(ernel)e(and)h(the)g
(\014rst)g(unallo)r(cated)f(address)515 2582 y(\(and)24
b(page\))g(after)g(the)h(k)n(ernel)e(image.)35 b(Suc)n(h)25
b(information)e(is)h(used)h(to)f(arrange)e(di\013eren)n(t)515
2682 y(KVM)27 b(regions)f(in)n(to)i(existing)f(space.)515
2814 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 2814 V 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598
2906 y Fi(//)39 b(Start)i(the)f(KVM.)598 2997 y(void)g
(start\(vm_offset_t)j(end,)d(boolean_t)h(dtlb_support\);)515
3171 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3171 V 29 w(KVM)p Fj(.)f Fk(i)p Fq(\021)598
3263 y Fi(static)40 b(boolean_t)120 b(k_hasdtlb;)395
b(//)39 b(Do)h(we)g(have)g(dtlb)g(support?)598 3354 y(static)g
(vm_offset_t)i(k_end;)551 b(//)39 b(End)h(of)g(kernel)g(memory.)515
3528 y Fk(h)p Fi(off)p 667 3528 V 29 w(KVM)28 b Fj(static)g(memb)l
(ers.)h Fk(i)o Fq(\021)598 3620 y Fi(boolean_t)119 b
(off_KVM::k_hasdtlb=FALSE;)45 b(//)40 b(Do)g(we)f(have)i(dtlb)f
(support?)598 3711 y(vm_offset_t)h(off_KVM::k_end=0;)122
b(//)40 b(End)g(of)f(kernel)i(memory.)1885 5255 y Fz(707)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
708 709 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(KVM::start)29 b Fj(implementation.)f Fk(i)p Fq(\021)598
614 y Fi(//)39 b(Start)i(the)f(KVM.)598 706 y(void)g
(off_KVM::start\(vm_offset_t)45 b(e,)40 b(boolean_t)h(dtlb_support\))
598 797 y({)676 888 y(extern)g(char)f(end[];)676 980
y(static)h(boolean_t)g(started=FALSE;)676 1071 y(\(void\)e;)676
1162 y(if)f(\(started\))755 1254 y(return;)676 1345 y(started=TRUE;)676
1436 y(k_end=\(vm_offset_t\)end;)676 1528 y(k_hasdtlb=dtlb_support;)676
1619 y Fk(h)p Fj(Initialize)27 b(KVM)g(r)l(e)l(gions)i(starting)g(at)f
Fi(end)g Fj(with)g Fi(dtlb)p 2348 1619 V 29 w(support)p
Fj(.)h Fk(i)598 1710 y Fi(})639 1941 y Fz(There)e(are)g(sev)n(eral)f
(kinds)h(of)h(KVM)f(regions)g(to)g(consider:)515 2103
y FA(Unmapp)s(ed)k(regions)40 b Fz(Lik)n(e)29 b(the)i(\014rst)f
(virtual)g(page.)43 b(P)n(age)29 b(faults)h(in)n(to)g(this)h(kind)f(of)
722 2202 y(region)d(are)f(due)i(to)f(programming)f(errors.)515
2366 y FA(Fixed)31 b(size)h(read-write)f(regions)41 b
Fz(Lik)n(e)j(the)g(k)n(ernel)g(text)h(or)e(static)i(data.)87
b(P)n(age)722 2466 y(faults)28 b(in)n(to)f(this)h(kind)g(of)g(region)e
(are)h(due)g(to)h(programming)d(errors.)515 2630 y FA(Gro)m(wing)31
b(read-write)h(regions)40 b Fz(Lik)n(e)20 b(regions)e(used)i(in)h(gro)n
(wing)c(blo)r(c)n(k)j(allo)r(cators)e(or)722 2729 y(those)26
b(for)g(sh)n(uttle)h(k)n(ernel)f(stac)n(ks.)35 b(P)n(age)25
b(faults)i(in)n(to)f(this)h(kind)g(of)f(region)f(should)722
2829 y(extend)i(it)g(automatically)e(and)i(resume)f(k)n(ernel)f(op)r
(eration)h(\(or)g(fault)h(when)f(there)722 2929 y(is)i(no)f(more)g
(space)g(for)g(gro)n(wing\).)639 3090 y(The)k(k)n(ernel)f(virtual)h
(memory)f(has)h(initially)g(an)g(iden)n(tit)n(y)g(mapping)g(for)f(the)h
(whole)515 3190 y(ph)n(ysical)36 b(memory)-7 b(.)64 b(Ho)n(w)n(ev)n
(er,)38 b(for)e(gro)n(wing)f(regions)h(w)n(e)g(tak)n(e)h(adv)-5
b(an)n(tage)35 b(of)i(k)n(ernel)515 3290 y(virtual)g(memory)h(and)g
(map)g(non-con)n(tiguous)e(page)h(frames)g(in)n(to)h(con)n(tiguous)f(k)
n(ernel)515 3389 y(virtual)27 b(addresses.)639 3489 y(In)37
b(few)g(w)n(ords,)h(memory)e(allo)r(cation)g(and)g(\(k)n(ernel\))h
(virtual)f(to)g(ph)n(ysical)g(address)515 3589 y(translation)28
b(dep)r(end)h(on)g(the)g(address)f(b)r(eing)h(considered:)39
b(di\013eren)n(t)29 b(regions)e(ha)n(v)n(e)h(dif-)515
3688 y(feren)n(t)f(seman)n(tics.)639 3788 y(The)e Fx(KVM)e
Fz(main)n(tains)h(an)h(arra)n(y)d(of)i(k)n(ernel)g(regions,)g(for)g
(eac)n(h)g(region)f(an)h(ob)5 b(ject)25 b(with)515 3888
y(its)e(starting)f(address,)h(its)h(size)f(and)g(some)f(metho)r(ds)i
(de\014ning)f(the)h(region)e(seman)n(tics)g(are)515 3987
y(k)n(ept.)515 4118 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4118 V 29 w(KVM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 4209 y Fi(static)40 b(off_KVMRegion)j
(*k_regions[OFF_NREGS_MAX];)i(//)39 b(Kernel)i(regions.)598
4301 y(static)f(natural_t)238 b(k_nregions;)41 b(//)f(Number)h(of)e
(existing)i(kernel)g(regions.)515 4471 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(dep)l(endencies.)g
Fk(i)p Fq(\021)598 4562 y Fi(#include)41 b(<dmm/KVMRegion.h>)239
b(//)40 b(for)g(off_KVMRegion)515 4732 y Fk(h)p Fi(off)p
667 4732 V 29 w(KVM)28 b Fj(static)g(memb)l(ers.)h Fk(i)o
Fz(+)p Fq(\021)598 4824 y Fi(off_KVMRegion)42 b
(*off_KVM::k_regions[OFF_NREGS)q(_MAX])q(;)j(//)40 b(Kernel)g(regions.)
598 4915 y(natural_t)237 b(off_KVM::k_nregions=0;)44
b(//)c(Number)h(of)e(existing)i(kernel)g(regions.)1885
5255 y Fz(708)p eop
PStoPSsaved restore
%%Page: (710,711) 356
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
709 710 bop 515 523 a Fk(h)p Fj(Initialize)26 b(other)j(private)g(memb)
l(ers)g(of)e Fi(off)p 1854 523 24 4 v 29 w(KVM)p Fj(.)g
Fk(i)p Fq(\021)598 614 y Fi(for\(natural_t)42 b(r=0;)e
(r<OFF_NREGS_MAX;)j(r++\))833 706 y(k_regions[r]=NULL;)639
847 y Fz(where)29 b(the)g(maxim)n(um)g(n)n(um)n(b)r(er)g(of)g(regions)f
(is)h(a)f(system)h(limit)h(whic)n(h)f(dep)r(ends)g(on)515
946 y(the)d(maxim)n(um)f(n)n(um)n(b)r(er)g(of)h(k)n(ernel)e(stac)n(ks)g
(\(i.e.)37 b(sh)n(uttles\))26 b(supp)r(orted.)36 b(There)25
b(is)g(also)f(a)515 1046 y(limit)k(on)f(k)n(ernel)g(stac)n(k)g(size.)
515 1162 y Fk(h)p Fj(O\013)g(limits.)f Fk(i)p Fq(\021)598
1254 y Fi(const)40 b(int)g(OFF_MDEP_KSTK_MAX)j(=)d(0x4000;)g(//)g(16)g
(kbytes.)h(--)e(must)h(be)g(power)g(of)g(2.)598 1345
y(const)g(int)g(OFF_MDEP_KSTK_MSK)j(=)d(0x3fff;)g(//)g(16*KBYTE-1)598
1436 y(const)g(int)g(OFF_NKSTKS_MAX)160 b(=)40 b(512;)g(//)f(Max)h(#)g
(of)f(kernel)i(stacks.)598 1528 y(const)f(int)g(OFF_NKBLKS_MAX)160
b(=)40 b(9;)f(//)h(Max)g(#)f(of)h(regions)h(not)f(counting)h(kern.)f
(stacks.)598 1619 y(const)g(int)g(OFF_NREGS_MAX)i(=)e
(OFF_NKSTKS_MAX+OFF_NKBLKS_MAX;)46 b(//)39 b(Max.)i(#)e(of)h(regions)
515 1777 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(manager)h
(dep)l(endencies.)g Fk(i)p Fz(+)p Fq(\021)598 1868 y
Fi(#include)41 b(<klib/limits.h>)317 b(//)40 b(for)g(KVM)g(related)g
(system)h(limits.)639 2009 y Fz(Here)18 b(w)n(e)g(coun)n(ted)g(one)g(n)
n(ull)h(region,)g(one)f(region)f(p)r(er)h(existing)g(k)n(ernel)g(stac)n
(k)f(\()p Fx(OFF)p 3229 2009 27 4 v 30 w(NKSTKS)p 3523
2009 V 29 w(MAX)515 2109 y Fz(at)25 b(w)n(orst)f(case\))h(and)g(sev)n
(en)f(extra)h(regions:)34 b(one)25 b(for)f(k)n(ernel)h(dynamic)g
(memory)-7 b(,)25 b(one)g(for)515 2208 y(the)g(n)n(ull)g(region,)f(one)
g(for)g(the)h(user)f(region,)h(and)f(\014v)n(e)g(for)h(the)g(blo)r(c)n
(k)f(allo)r(cators)f(used)h(b)n(y)515 2308 y(sh)n(uttles,)j(p)r
(ortals,)g Ft(dtlb)p Fz(s,)g(prop)r(ert)n(y)g(arra)n(ys)e(and)i(relo)r
(cation)g(table)g(en)n(tries.)639 2408 y(There)g(are)g(names)g(for)g
(some)g(of)h(them.)515 2524 y Fk(h)p Fj(O\013)f(KVM)g(r)l(e)l(gion)h
(numb)l(ers.)h Fk(i)p Fq(\021)598 2615 y Fi(const)40
b(natural_t)h(OFF_KVM_RNULL)i(=0;)c(//)h(Null)g(catch)h(all)f(region.)
598 2707 y(const)g(natural_t)h(OFF_KVM_RALLOC=1;)i(//)d(dynamic)h
(memory)g(region.)598 2798 y(const)f(natural_t)h(OFF_KVM_RUSR)82
b(=2;)39 b(//)h(User)g(memory)h(region.)598 2889 y(const)f(natural_t)h
(OFF_KVM_RNONE)i(=\(natural_t\)-1;)f(//)e(null)g(value)639
3014 y Fz(Only)35 b(en)n(tries)g(in)g(range)f Fx(0)p
Fz(.)14 b(.)g(.)f Fx(k)p 1667 3014 V 31 w(nregions-1)32
b Fz(are)i(considered.)59 b(They)35 b(are)f(alw)n(a)n(ys)515
3113 y(sorted)23 b(b)n(y)g(starting)g(address)g(so)g(that)i(a)e(binary)
g(searc)n(h)g(could)g(\014nd)i(the)f(region)e(in)n(v)n(olv)n(ed)515
3213 y(with)28 b(a)f(particular)f(k)n(ernel)h(virtual)g(address.)639
3313 y(This)h(metho)r(d)g(can)f(b)r(e)h(used)g(to)f(\014nd)h(the)g
(region)f(in)n(v)n(olv)n(ed)f(giv)n(en)g(a)i(KVM)f(address.)515
3445 y Fk(h)p Fj(Other)h(private)h(metho)l(ds)g(of)e
Fi(off)p 1529 3445 24 4 v 29 w(KVM)p Fj(.)h Fk(i)p Fq(\021)598
3537 y Fi(//)39 b(Finds)i(the)f(region)g(handling)h(kva)598
3628 y(//)e(or)h(returns)h(a)e(pointer)i(to)f(the)g(given)g(default)h
(one.)598 3719 y(off_KVMRegion)h(*find_region\(vm_offset_t)j(kva,)40
b(natural_t)h(dflt\);)1885 5255 y Fz(709)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
710 711 bop 639 523 a Fz(The)21 b(KVM)g(ob)5 b(ject)20
b(simply)h(accepts)f(an)n(y)g(of)h(the)g(follo)n(wing)e(calls)h(and)h
(forw)n(ards)e(them)515 623 y(to)27 b(the)h(region)e(in)n(v)n(olv)n
(ed.)515 756 y Fk(h)p Fj(Other)i(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 756 24 4 v 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 847 y Fi(//)39 b(Allocates)j(a)d(kernel)i(page.)598
938 y(//)e(Chooses)i(the)f(location)h(in)f(the)g(kern.)g(dynamic)h
(memory)g(region)f(if)g(at)g(is)f(0.)598 1029 y(vm_offset_t)i
(pg_alloc\(vm_offset_t)j(at\);)598 1121 y(//)39 b(Deallocates)j(a)e
(kernel)g(page.)598 1212 y(void)g(pg_free\(vm_offset_t)j(p\);)598
1303 y(//)c(Allocates)j(n)d(kernel)i(pages.)598 1395
y(//)e(Chooses)i(the)f(location)h(in)f(the)g(kern.)g(dynamic)h(memory)g
(region)f(if)g(at)g(is)f(0.)598 1486 y(vm_offset_t)i
(pg_alloc\(vm_offset_t)j(at,)c(natural_t)h(n\);)598 1577
y(//)e(Deallocates)j(n)e(kernel)g(pages.)598 1669 y(void)g
(pg_free\(vm_offset_t)j(p,)d(natural_t)h(n\);)598 1851
y(//)e(Handles)i(page)f(faults)598 1943 y(err_t)g
(pg_fault\(off_PgFltReq)k(*pgf\);)515 2208 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 2300 y Fi(#include)41 b(<prtl/ex.h>)473
b(//)40 b(for)g(off_PgFltReq)639 2441 y Fz(Of)33 b(course,)g(no)g(page)
f(fault)h(should)g(o)r(ccur)f(when)i(no)e Ft(dtlb)h Fz(supp)r(ort)g(is)
g(built)g(in)n(to)515 2540 y(the)28 b(k)n(ernel.)639
2640 y(Their)g(implemen)n(tations)f(use)g Fx(find)p 1815
2640 27 4 v 30 w(region)e Fz(and)j(forw)n(ard)e(the)i(call.)515
2773 y Fk(h)p Fi(off)p 667 2773 24 4 v 29 w(KVM::pg)p
969 2773 V 29 w(alloc)h Fj(implementation.)e Fk(i)p Fq(\021)598
2864 y Fi(//)39 b(Allocates)j(a)d(kernel)i(page.)598
2956 y(//)e(Chooses)i(the)f(location)h(in)f(the)g(kern.)g(dynamic)h
(memory)g(region)f(if)g(at)g(is)f(0.)598 3047 y(vm_offset_t)i
(off_KVM::pg_alloc\(vm_offset)q(_t)k(at\))598 3138 y({)755
3230 y(return)40 b(find_region\(at,OFF_KVM_RALLO)q(C\)->)q(pg_al)q
(loc\()q(at\);)598 3321 y(})515 3587 y Fk(h)p Fi(off)p
667 3587 V 29 w(KVM::pg)p 969 3587 V 29 w(free)29 b Fj(implementation.)
e Fk(i)p Fq(\021)598 3678 y Fi(//)39 b(Deallocates)j(a)e(kernel)g
(page.)598 3769 y(void)g(off_KVM::pg_free\(vm_offset_t)45
b(p\))598 3861 y({)676 3952 y(find_region\(p,OFF_KVM_RNULL\))q(->pg_)q
(free)q(\(p\);)598 4043 y(})515 4309 y Fk(h)p Fi(off)p
667 4309 V 29 w(KVM::pg)p 969 4309 V 29 w(alloc)29 b
Fj(implementation.)e Fk(i)p Fz(+)p Fq(\021)598 4400 y
Fi(//)39 b(Allocates)j(n)d(kernel)i(pages.)598 4491 y(//)e(Chooses)i
(the)f(location)h(in)f(the)g(kern.)g(dynamic)h(memory)g(region)f(if)g
(at)g(is)f(0.)598 4583 y(vm_offset_t)i(off_KVM::pg_alloc\(vm_offset)q
(_t)k(at,)40 b(natural_t)h(n\))598 4674 y({)676 4765
y(return)g(find_region\(at,OFF_KVM_RALLOC\))q(->pg)q(_allo)q(c\(at)q
(,n\);)598 4857 y(})1885 5255 y Fz(710)p eop
PStoPSsaved restore
%%Page: (712,713) 357
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
711 712 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(KVM::pg)p 969 523 V 29 w(free)29 b Fj(implementation.)e
Fk(i)p Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Deallocates)j(n)e(kernel)g
(pages.)598 706 y(void)g(off_KVM::pg_free\(vm_offset_t)45
b(p,)40 b(natural_t)h(n\))598 797 y({)676 888 y
(find_region\(p,OFF_KVM_RNULL\))q(->pg_)q(free)q(\(p,n)q(\);)598
980 y(})515 1222 y Fk(h)p Fi(off)p 667 1222 V 29 w(KVM::pg)p
969 1222 V 29 w(fault)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 1313 y Fi(//)39 b(Handles)i(page)f(faults)598
1405 y(err_t)g(off_KVM::pg_fault\(off_PgFltRe)q(q)45
b(*pgf\))598 1496 y({)676 1587 y(assert\(pgf\);)676 1679
y(return)c(find_region\(pgf->get_vaddr\(\),O)q(FF_K)q(VM_RN)q(ULL\))q
(->pg_)q(faul)q(t\(pg)q(f\);)598 1770 y(})515 1921 y
Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(manager)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fq(\021)598
2012 y Fi(#include)41 b(<dmm/KVMRegion.h>)239 b(//)40
b(for)g(pg_fault)639 2142 y Fz(Y)-7 b(ou)20 b(can)g(see)f(ho)n(w)g(b)n
(y)h(default)g(the)g(dynamic)g(memory)f(region)f(is)i(c)n(hosen)f(for)g
(memory)515 2241 y(allo)r(cation)26 b(and)i(the)g(n)n(ull)f(region)g
(for)g(deallo)r(cation)f(and)i(page)e(faulting.)639 2341
y(The)31 b(creation)e(of)h(KVM)h(regions)d(and)j(the)f(implemen)n
(tation)h(of)f Fx(find)p 2933 2341 27 4 v 30 w(region)e
Fz(will)515 2441 y(b)r(e)c(seen)g(later.)35 b(Before)24
b(that,)h(w)n(e)f(will)g(sho)n(w)g(ho)n(w)f(are)h(ph)n(ysical)f(page)g
(frames)h(allo)r(cated.)639 2540 y(There)35 b(is)h(also)e(a)h(small)g
(dump)h(utilit)n(y)g(for)f(debug.)61 b(It)35 b(formats)g(the)h(state)f
(of)h(the)515 2640 y(k)n(ernel)26 b(KVM)i(to)g(a)f(k)n(ernel)f(output)j
(stream.)515 2761 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2761 24 4 v 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 2852 y Fi(friend)40 b(OStr)g(&operator<<\(OStr)j(&s,)d
(const)h(off_KVM)f(&kvm\);)515 3003 y Fk(h)p Fi(off)p
667 3003 V 29 w(KVM::operator<<)30 b Fj(implementation.)e
Fk(i)p Fq(\021)598 3095 y Fi(OStr)40 b(&operator<<\(OStr)j(&s,)d(const)
g(off_KVM)h(&kvm\))598 3186 y({)676 3277 y(s)f(<<)f
(\(\(kvm.k_hasdtlb\)?"vm)44 b(":"pm)c("\))g(<<)g(fmt\("kend=\045x,)i
(",kvm.k_end\);)676 3369 y(s)e(<<)f(fmt\("\045d",kvm.k_nregions\))45
b(<<)40 b(")f(regions)i(")e(;)676 3460 y(s)h(<<)f("\(up)h(to)g(")g(<<)f
(fmt\("\045d",OFF_NKBLKS_MAX\))45 b(<<)40 b("+")g(<<)f
(fmt\("\045d",kvm.k_nstacks\);)676 3551 y(s)h(<<)f(",)h(of)g(")f(<<)h
(fmt\("\045d",off_MBank::ptrunc\(kvm)q(.k_r)q(size\))q(\))45
b(<<)79 b(")40 b(pgs\)")g(<<)g(nl;)676 3643 y(for)g(\(natural_t)i(i=0;)
e(i<)f(kvm.k_nregions;)k(i++\))755 3734 y(s)c(<<)h(fmt\("[\04502d])i
(",i\))e(<<)f(*kvm.k_regions[i])k(<<)d(nl;)676 3825 y(return)h(s;)598
3916 y(})515 4159 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g
(manager)h(implementation)f(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 4250 y Fi(#include)41 b(<klib/str.h>)598
4341 y(#include)g(<klib/Magic.h>)515 4492 y Fk(h)p Fj(O\013)27
b(magic)g(numb)l(ers.)i Fk(i)p Fq(\021)598 4584 y Fi(OFF_MAGIC_KVM,)278
b(//)39 b(Off)h(KVM)g(magic)g(number)639 4713 y Fz(W)-7
b(e)28 b(can)f(no)n(w)g(add)h(another)e(case)h(to)h(the)g(implemen)n
(tation)f(of)h Fx(Magic::nameof)p Fz(.)515 4824 y Fk(h)p
Fi(off)p 667 4824 V 29 w(Magic::nameof)i Fj(c)l(ase)f(for)e
Fi(m)p 1559 4824 V 29 w(number)p Fj(s.)h Fk(i)p Fq(\021)598
4915 y Fi(case)40 b(OFF_MAGIC_KVM:)676 5006 y(return)h("off_KVM";)1885
5255 y Fz(711)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
712 713 bop 639 523 a Fz(KVM)28 b(users)f(can)g(c)n(hec)n(k)g(their)g
(references)g(using)g(this)h(metho)r(d.)515 639 y Fk(h)p
Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(off)p 1493 639
24 4 v 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 731
y Fi(//)39 b(Does)i(this)f(look)g(like)g(a)f(KVM?)598
822 y(boolean_t)i(valid\(void\))h(const)e({)g(return)g(get_magic\(\))i
(==)e(OFF_MAGIC_KVM;)i(})515 1079 y Fn(5.5.1)112 b(Allo)s(cating)35
b(k)m(ernel)i(pages)515 1232 y Fz(The)29 b(k)n(ernel)g(virtual)g
(memory)f(manager)g(includes)i(a)f(generic)f(page)h(allo)r(cator)f
(whic)n(h)h(is)515 1332 y(used)g(to)g(c)n(ho)r(ose)f(the)h(appropriate)
f(memory)g(bank)h(to)g(allo)r(cate)f(and)h(deallo)r(cate)f(k)n(ernel)
515 1432 y(pages.)515 1565 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f
(of)g Fi(off)p 1552 1565 V 29 w(KVM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 1656 y Fi(static)40 b(off_KPgAllocator)j(k_palloc;)e(//)f
(Kernel)h(page)f(allocator.)515 1830 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(static)g(memb)l(ers.)f
Fk(i)p Fq(\021)598 1922 y Fi(off_KPgAllocator)43 b(off_KVM::k_palloc;)g
(//)d(Kernel)g(page)g(allocator.)515 2096 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 2187 y Fi(#include)41 b(<klib/mdep/types.h>)
161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)598
2279 y(#include)h(<dmm/KPgAllocator.h>)122 b(//)40 b(for)g
(off_KPgAllocator)i(et)e(al)639 2420 y Fz(The)28 b(page)f(allo)r(cator)
e(pro)n(vides)i(simple)g(page)g(allo)r(cation)g(metho)r(ds.)515
2536 y Fk(h)p Fj(O\013)g(kernel)h(p)l(age)h(al)t(lo)l(c)l(ator.)f
Fk(i)p Fq(\021)598 2627 y Fi(class)40 b(off_KPgAllocator)j({)598
2719 y(public:)676 2810 y(//)d(Creates)h(a)e(kernel)i(page)f
(allocator.)676 2901 y(off_KPgAllocator\(void\);)676
3084 y(//)g(Allocates)h(a)f(kernel)g(page.)676 3175 y(//)g(Chooses)h
(the)f(location)h(if)e(at)h(is)g(0.)676 3267 y(vm_offset_t)i
(alloc\(vm_offset_t)h(at\);)676 3358 y(//)d(Deallocates)i(a)d(kernel)i
(page.)676 3449 y(void)f(free\(vm_offset_t)j(p\);)676
3632 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3632 V 29 w(KPgAllocator)p Fj(.)j Fk(i)598
3723 y Fi(private:)676 3814 y Fk(h)p Fj(Other)f(private)f(memb)l(ers)h
(of)e Fi(off)p 1713 3814 V 29 w(KPgAllocator)p Fj(.)j
Fk(i)676 3906 y(h)p Fj(Other)f(private)f(metho)l(ds)h(of)f
Fi(off)p 1691 3906 V 29 w(KPgAllocator)p Fj(.)h Fk(i)598
3997 y Fi(};)515 4246 y Fk(h)p Fj(O\013)e(kernel)h(p)l(age)h(al)t(lo)l
(c)l(ator)f(dep)l(endencies.)i Fk(i)p Fq(\021)598 4337
y Fi(#include)41 b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)639 4479 y Fz(These)21 b(metho)r(ds)g(try)g(to)g
(use)g(dum)n(b)h(memory)e(to)h(sa)n(v)n(e)f(precious)g(\(i.e.)35
b(DMA)22 b(capable,)515 4578 y(etc.\))34 b(memory)-7
b(.)34 b(T)-7 b(o)19 b(do)h(so,)h(the)f Fx(KPgAllocator)15
b Fz(main)n(tains)k(the)h(notion)f(of)h(the)g(preferred)515
4678 y(\(lo)r(cal\))27 b(memory)g(bank)g(to)h(allo)r(cate)f(memory)-7
b(.)515 4811 y Fk(h)p Fj(Other)28 b(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 4811 V 29 w(KPgAllocator)p Fj(.)h Fk(i)p
Fq(\021)598 4902 y Fi(off_MBank)41 b(*k_current;)434
b(//)40 b(Current)h(preferred)g(bank.)1885 5255 y Fz(712)p
eop
PStoPSsaved restore
%%Page: (714,715) 358
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
713 714 bop 515 523 a Fk(h)p Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l
(c)l(ator)f(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
614 y Fi(#include)41 b(<hw/MBank.h>)434 b(//)40 b(for)g(off_MBank)598
706 y(#include)h(<hw/PFrame.h>)395 b(//)40 b(for)g(off_PFrame)639
847 y Fz(It)28 b(is)g(initially)f(set)h(to)f(n)n(ull)h(b)n(y)g(the)g
(constructor.)515 980 y Fk(h)p Fi(off)p 667 980 24 4
v 29 w(KPgAllocator::off)p 1359 980 V 32 w(KPgAllocator)i
Fj(implementation.)d Fk(i)p Fq(\021)598 1071 y Fi
(off_KPgAllocator::off_KPgAlloc)q(ator\()q(void)q(\))45
b(:)676 1162 y(k_current\(NULL\))598 1254 y({;})639 1486
y Fz(When)f(the)g(preferred)f(bank)g(is)g(unkno)n(wn,)48
b(or)42 b(the)i(curren)n(t)f(one)g(is)g(exhausted,)515
1586 y Fx(reconsider)23 b Fz(c)n(ho)r(oses)j(a)i(new)f(preferred)g
(bank.)515 1719 y Fk(h)p Fj(Other)h(private)h(metho)l(ds)g(of)e
Fi(off)p 1529 1719 V 29 w(KPgAllocator)p Fj(.)j Fk(i)p
Fq(\021)598 1810 y Fi(//)39 b(Reconsiders)j(the)e(memory)h(bank)f
(preferences.)598 1901 y(err_t)g(reconsider\(void\);)639
2042 y Fz(Its)31 b(implemen)n(tation)g(scans)f(existing)h(memory)f
(banks)g(searc)n(hing)f(for)i(a)f(v)-5 b(alid)31 b(one.)515
2142 y(It)d(assumes)e(that)i(the)g(no)r(de)g(instance)f(will)h(o\013er)
f(\014rst)g(the)h(b)r(est)g(banks.)515 2258 y Fk(h)p
Fi(off)p 667 2258 V 29 w(KPgAllocator::reconsider)k Fj(implementation.)
c Fk(i)p Fq(\021)598 2350 y Fi(//)39 b(Reconsiders)j(the)e(memory)h
(bank)f(preferences.)598 2441 y(err_t)g(off_KPgAllocator::reconsider\()
q(void)q(\))598 2532 y({)676 2623 y(if)g(\(k_current==NULL\))j({)755
2715 y(k_current=&nd.get_mbank\(nd.get_)q(num_)q(mban)q(ks\(\)-)q(1\);)
755 2806 y(assert\(k_current->valid\(\)\);)755 2897 y(do_debug\(kcout)f
(<<)e("kernel)h(using)f(")f(<<)h(fmt\("\045d",nd.get_num_mbanks\(\)-)q
(1\)\);)755 2989 y(do_debug\(kcout)i(<<)e(")f(mbank")i(<<)e(nl\);)755
3080 y(return)h(EOK;)676 3171 y(})676 3263 y(else)g({)755
3354 y(natural_t)h(mbank)f(=)g(k_current)h(-)e(&nd.get_mbank\(0\);)755
3445 y(if)g(\(mbank)i(>)e(0\){)833 3537 y(mbank--;)833
3628 y(k_current=&nd.get_mbank\(mbank)q(\);)833 3719
y(assert\(k_current->valid\(\)\);)833 3811 y(do_debug\(kcout)k(<<)c
("kernel)i(using)f(")g(<<)g(fmt\("\045d",mbank\))i(<<)e(")f(mbank")i
(<<)f(nl\);)833 3902 y(return)h(EOK;)755 3993 y(})676
4085 y(})676 4176 y(k_current=NULL;)676 4267 y(return)g(ENOMEM;)598
4450 y(})515 4699 y Fk(h)p Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l
(c)l(ator)f(implementation)g(dep)l(endencies.)i Fk(i)o
Fq(\021)598 4790 y Fi(#include)41 b(<klib/str.h>)598
4882 y(#include)g(<klib/mdep/debug.h>)161 b(//)40 b(for)g(do_debug)h
(et)e(al.)1885 5255 y Fz(713)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
714 715 bop 515 523 a Fk(h)p Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l
(c)l(ator)f(dep)l(endencies.)i Fk(i)p Fz(+)o Fq(\021)598
614 y Fi(#include)41 b(<node/Node.h>)395 b(//)40 b(for)g(nd)598
706 y(#include)h(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g(error)g
(numbers.)639 847 y Fz(P)n(age)26 b(allo)r(cation)h(is)g(simply)h(forw)
n(arded)e(to)h(the)h(curren)n(t)f(preferred)f(memory)h(bank.)515
963 y Fk(h)p Fi(off)p 667 963 24 4 v 29 w(KPgAllocator::alloc)k
Fj(implementation.)d Fk(i)p Fq(\021)598 1054 y Fi(//)39
b(Allocates)j(a)d(page)h(frame)h(for)f(kernel)g(usage.)598
1146 y(vm_offset_t)h(off_KPgAllocator::alloc\(vm_)q(offs)q(et_t)46
b(at\))598 1237 y({)676 1328 y(off_PFrame)c(*p;)676 1420
y(if)e(\(!k_current)i(&&)d(reconsider\(\)\))755 1511
y(return)h(0;)676 1694 y(do)g({)755 1785 y(assert\(k_current)j(&&)c
(k_current->valid\(\)\);)755 1876 y(if)g(\(at\))h({)833
1968 y(off_MBank)h(*bank=\(off_MBank*\)\(\(*k_curr)q(ent\)+)q(at\)-)q
(>get_)q(cont)q(aine)q(r\(\);)833 2059 y(p)f(=)f
(new\(bank,off_id_t\(bank->get_i)q(d\(\),)q(at\)\))990
2150 y(off_PFrame\(nd.get_protection\()q(\),)45 b(nd.get_domain\(\)\);)
755 2242 y(})755 2333 y(else)833 2424 y(p)40 b(=)f(new\(k_current\))j
(off_PFrame\(nd.get_protectio)q(n\(\),)2010 2516 y(nd.get_domain\(\))
199 b(\);)676 2607 y(})40 b(while)g(\(!at)g(&&)g(!p)g(&&)f
(!reconsider\(\)\);)676 2698 y(//do_debug\(printf\("\045x)44
b(kallocated\\n",\(\(p\)?\(\(natural)q(_t\)*p)q(\):-1)q(\)\)\);)676
2790 y(return)d(\(p\)?*p:0;)598 2972 y(})515 3221 y Fk(h)p
Fi(off)p 667 3221 V 29 w(KPgAllocator::free)31 b Fj(implementation.)d
Fk(i)o Fq(\021)598 3313 y Fi(//)39 b(Deallocates)j(a)e(page)g(frame)g
(used)g(by)g(the)g(kernel.)598 3404 y(void)g
(off_KPgAllocator::free\(vm_offs)q(et_t)46 b(p\))598
3495 y({)676 3587 y(delete)41 b(\(\(*k_current\)+p\);)598
3678 y(})639 3910 y Fz(In)26 b(those)g(cases)f(where)g(man)n(y)g(con)n
(tiguous)g(ph)n(ysical)g(pages)g(are)f(desired)i(\(e.g.)36
b(when)515 4010 y(initializing)20 b Fy(big)29 b Fz(allo)r(cator)18
b(at)i(system)h(b)r(o)r(ot)f(time\))h(these)f(routines)g(can)g(b)r(e)h
(used)f(instead.)515 4110 y(Its)26 b(use)g(is)h(strongly)e(discouraged)
f(b)r(ecause)i(it)h(can)f(lead)g(to)g(service)f(failures)h(ev)n(en)g
(when)515 4209 y(there)36 b(is)g(enough)g(free)g(memory)-7
b(.)62 b(Ho)n(w)n(ev)n(er)35 b(it)h(is)h(a)e(reasonable)g(thing)h(to)g
(do)h(during)515 4309 y(system)27 b(b)r(o)r(ot.)515 4442
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 4442 V 29 w(KPgAllocator)p Fj(.)i Fk(i)p Fq(\021)598
4533 y Fi(//)39 b(Allocates)j(n)d(kernel)i(page)f(frames.)598
4624 y(vm_offset_t)h(alloc\(vm_offset_t)j(at,)39 b(natural_t)j(n\);)598
4716 y(//)d(Deallocates)j(n)e(kernel)g(page)g(frames.)598
4807 y(void)g(free\(vm_offset_t)j(p,)c(natural_t)j(n\);)1885
5255 y Fz(714)p eop
PStoPSsaved restore
%%Page: (716,717) 359
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
715 716 bop 639 523 a Fz(Their)22 b(implemen)n(tation)g(is)f(similar)h
(to)f(that)h(of)g(the)g(previous)f(routines.)35 b(Only)21
b Fx(alloc)515 623 y Fz(gets)28 b(more)f(complicated)h(as)g(it)h(m)n
(ust)g(scan)e(for)h(a)g(range)f(of)i(con)n(tiguous)e(a)n(v)-5
b(ailable)27 b(page)515 722 y(frames.)515 855 y Fk(h)p
Fi(off)p 667 855 24 4 v 29 w(KPgAllocator::alloc)k Fj(implementation.)d
Fk(i)p Fz(+)o Fq(\021)598 946 y Fi(//)39 b(Allocates)j(n)d(kernel)i
(page)f(frames.)598 1038 y(vm_offset_t)h(off_KPgAllocator::alloc\(vm_)q
(offs)q(et_t)46 b(at,)40 b(natural_t)h(n\))598 1129 y({)676
1220 y(if)f(\(!k_current)i(&&)d(reconsider\(\)\))755
1312 y(return)h(0;)715 1494 y(do)g({)794 1586 y(off_PFrame)h
(*p=\(!at\))g(?)f(find_range\(n\))i(:)e(\(*k_current\)+at;)794
1677 y(off_pg_id_t)i(pg;)794 1768 y(natural_t)f(count;)794
1860 y(if)f(\(p\){)872 1951 y(if)g(\(at)g(&&)g(k_current)h(!=)f
(p->get_container\(\)\))951 2042 y(k_current=\(off_MBank*\)p->get_c)q
(onta)q(iner\()q(\);)872 2134 y(for\(pg=p->get_id\(\),count=0;)1029
2225 y(count<n)h(&&)f(new\(k_current,pg\))j
(off_PFrame\(nd.get_protection\(\))q(,)2598 2316 y(nd.get_domain\(\))g
(\))c(;)1029 2408 y(++count,pg+=off_MBank::get_p)q(gsiz)q(e\(\)\){)951
2499 y(//do_debug\(kcout)k(<<)c("kern)i(allocating)g(")f(<<)f
(fmt\("\045x",\(natural_t\)pg\))45 b(<<nl\);)872 2590
y(})872 2682 y(if)40 b(\(count)h(==)e(n\))951 2773 y(return)h(*p;)872
2864 y(else)g({)951 2956 y(for\()g(--pg)g(;)g(count)g(;)f
(count--,pg-=off_MBank::get_p)q(gsiz)q(e\(\)\))1029 3047
y(delete)i(\(\(*k_current\)+pg\);)872 3138 y(})794 3230
y(})715 3321 y(})f(while)g(\(!at)g(&&)g(!reconsider\(\)\);)715
3412 y(return)h(0;)598 3504 y(})639 3736 y Fz(Note)23
b(ho)n(w)e(w)n(e)h(used)g Fx(find)p 1484 3736 27 4 v
30 w(range)e Fz(to)i(\014nd)h(a)f(con)n(tiguous)f(range)g(of)h(memory)
-7 b(.)34 b(In)23 b(case)515 3836 y(a)i(page)g(w)n(as)g(allo)r(cated)h
(b)n(y)f(another)g(pro)r(cess)g(while)h(allo)r(cating)f(the)i(range,)e
(w)n(e)g(released)515 3935 y(already)h(allo)r(cated)h(memory)f(and)i
(tried)f(again.)515 4068 y Fk(h)p Fj(Other)h(private)h(memb)l(ers)f(of)
g Fi(off)p 1552 4068 24 4 v 29 w(KPgAllocator)p Fj(.)h
Fk(i)p Fz(+)p Fq(\021)598 4159 y Fi(//)39 b(Fins)i(a)e(range)h(of)g
(contiguous)i(n)d(free)h(page)g(frames.)598 4251 y(//)f(Returns)i
(their)g(physical)g(address.)598 4342 y(off_PFrame)g
(*find_range\(natural_t)j(n\);)1885 5255 y Fz(715)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
716 717 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(KPgAllocator::free)31 b Fj(implementation.)d Fk(i)o
Fz(+)p Fq(\021)598 614 y Fi(//)39 b(Deallocates)j(n)e(kernel)g(page)g
(frames.)598 706 y(void)g(off_KPgAllocator::free\(vm_offs)q(et_t)46
b(p,)40 b(natural_t)h(n\))598 797 y({)676 888 y(for\(vm_offset_t)i
(pg=p;)d(n)g(;n--)g(,pg+=off_MBank::get_pgsize\(\)\))755
980 y(delete)g(\(\(*k_current\)+pg\);)598 1162 y(})639
1395 y Fz(T)-7 b(o)27 b(\014nd)i(a)e(free)g(range)f(of)i(memory)f(w)n
(e)g(use)g(a)h(brute)f(force)g(approac)n(h.)515 1511
y Fk(h)p Fi(off)p 667 1511 V 29 w(KPgAllocator::find)p
1398 1511 V 32 w(range)h Fj(implementation.)g Fk(i)p
Fq(\021)598 1602 y Fi(//)39 b(Fins)i(a)e(range)h(of)g(contiguous)i(n)d
(free)h(page)g(frames.)598 1694 y(//)f(Returns)i(their)g(physical)g
(address.)598 1785 y(off_PFrame)g(*off_KPgAllocator::find_rang)q(e\(na)
q(tural)q(_t)k(n\))598 1876 y({)676 1968 y(vm_offset_t)d
(attempt,current,last;)676 2150 y(assert\(k_current->valid\(\)\);)676
2333 y(for)e(\(attempt=k_current->get_first)q(\(\),)951
2424 y(last=k_current->get_last\(\)-k_c)q(urre)q(nt->p)q(2a\(n)q(\);)
872 2516 y(attempt)h(<)f(last;)872 2607 y(attempt=current+k_current->g)
q(et_p)q(gsiz)q(e\(\)\){)755 2698 y(natural_t)h(count;)755
2790 y(for\(count=0,current=attempt;)912 2881 y(count<n)f(&&)g
(\(*k_current+current\)->is_free)q(\(\);)912 2972 y
(count++,current+=k_current->get)q(_pgs)q(ize\(\))q(\))833
3064 y(;)755 3155 y(if)f(\(count==n\){)833 3246 y
(assert\(\(\(*k_current\)+attempt\))q(->ge)q(t_co)q(ntain)q(er\(\))46
b(==)39 b(k_current\);)833 3337 y(return)i(\(*k_current\)+attempt;)755
3429 y(})676 3520 y(})676 3611 y(do_debug\(kcout)i(<<)c("no)h(range)h
(for)e(")h(<<)g(fmt\("\045d",n\))h(<<)f(")f(pages")i(<<)f(nl\);)676
3703 y(return)h(NULL;)598 3794 y(})639 4010 y Fz(The)31
b Fx(KVM)e Fz(exp)r(orts)g(the)i(ra)n(w)e Fx(KPgAllocator)c
Fz(allo)r(cation)k(in)n(terface.)44 b(That)30 b(is)h(to)f(b)r(e)515
4110 y(used)d(b)n(y)h(k)n(ernel)e(mo)r(dules)i(whic)n(h)f(w)n(an)n(t)g
(to)h(use)f(ra)n(w)g(ph)n(ysical)f(memory)-7 b(.)515
4242 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4242 V 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 4334 y Fi(static)40 b(vm_offset_t)i(raw_pg_alloc\(void\);)
598 4425 y(static)e(void)g(raw_pg_free\(vm_offset_t)45
b(p\);)1885 5255 y Fz(716)p eop
PStoPSsaved restore
%%Page: (718,719) 360
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
717 718 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(KVM::raw)p 1008 523 V 30 w(pg)p 1116 523 V 28 w(alloc)29
b Fj(and)f Fi(free)g Fj(implementation.)g Fk(i)p Fq(\021)598
614 y Fi(vm_offset_t)41 b(off_KVM::raw_pg_alloc\(void\))598
706 y({)676 797 y(return)g(k_palloc.alloc\(0\);)598 888
y(})598 980 y(void)f(off_KVM::raw_pg_free\(vm_offset)q(_t)45
b(p\))598 1071 y({)676 1162 y(k_palloc.free\(p\);)598
1254 y(})1885 5255 y Fz(717)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
718 719 bop 515 523 a Fn(5.5.2)112 b(Kernel)37 b(virtual)f(memory)g
(regions)515 676 y Fz(Ev)n(ery)24 b(region)g(m)n(ust)i(implemen)n(t)h
(those)e(metho)r(ds)h(whic)n(h)g(can)g(b)r(e)g(called)f(from)h(the)g
Fx(KVM)p Fz(.)515 776 y(It)f(also)f(has)h(a)g(starting)f(address)g(and)
h(a)g(length.)36 b(Besides,)25 b(regions)f(share)g(the)i(same)e
Fx(KVM)515 876 y Fz(page)i(allo)r(cator.)515 1008 y Fk(h)p
Fj(O\013)h(kernel)h(virtual)g(memory)g(r)l(e)l(gion.)g
Fk(i)p Fq(\021)598 1100 y Fi(//)39 b(A)h(kernel)g(virtual)h(memory)g
(region.)598 1191 y(//)598 1282 y(class)f(off_KVMRegion)i({)598
1374 y(public:)676 1465 y(//)e(Get)g(the)g(starting)h(address.)676
1556 y(inline)g(vm_offset_t)h(get_start\(void\))g(const;)676
1648 y(//)e(Get)g(the)g(region)g(end.)g(first)h(invalid)g(address.)676
1739 y(inline)g(vm_offset_t)h(get_end\(void\))g(const;)676
1922 y(//)e(Allocates)h(a)f(kernel)g(page.)676 2013 y(//)g(Chooses)h
(the)f(location)h(if)e(at)h(is)g(0.)676 2104 y(virtual)h(vm_offset_t)h
(pg_alloc\(vm_offset_t)i(at\)=0;)676 2196 y(//)c(Deallocates)i(a)d
(kernel)i(page.)676 2287 y(virtual)g(void)f(pg_free\(vm_offset_t)k
(p\)=0;)676 2378 y(//)c(Allocates)h(n)f(kernel)g(pages.)676
2470 y(//)g(Chooses)h(the)f(location)h(if)e(at)h(is)g(0.)676
2561 y(virtual)h(vm_offset_t)h(pg_alloc\(vm_offset_t)i(at,)39
b(natural_t)j(n\)=0;)676 2652 y(//)e(Deallocates)i(n)d(kernel)i(pages.)
676 2744 y(virtual)g(void)f(pg_free\(vm_offset_t)k(p,)39
b(natural_t)j(n\)=0;)676 2926 y(//)e(Handles)h(page)f(faults)676
3018 y(virtual)h(err_t)f(pg_fault\(off_PgFltReq)k(*pgf\)=0;)676
3200 y(//)c(Returns)h(the)f(page)g(size.)676 3291 y(virtual)h
(vm_size_t)g(get_pgsz\(void\);)676 3474 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 3474 24 4
v 29 w(KVMRegion)p Fj(.)i Fk(i)598 3657 y Fi(protected:)676
3748 y(vm_offset_t)42 b(r_start;)394 b(//)40 b(Starting)h(address.)676
3839 y(vm_size_t)120 b(r_end;)472 b(//)40 b(first)g(invalid)h(address.)
1853 3931 y(//)f(length)g(==)g(r_end)g(-)g(r_start)676
4022 y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 4022 V 29 w(KVMRegion)p Fj(.)i Fk(i)676
4113 y Fi(friend)41 b(class)f(off_KVM;)676 4205 y(static)h
(off_KPgAllocator)i(*r_palloc;)598 4296 y(private:)676
4387 y Fk(h)p Fj(Other)29 b(private)f(memb)l(ers)h(of)e
Fi(off)p 1713 4387 V 29 w(KVMRegion)p Fj(.)i Fk(i)598
4479 y Fi(};)515 4744 y Fk(h)p Fj(O\013)e(kernel)h(virtual)g(memory)g
(r)l(e)l(gion)h(dep)l(endencies.)g Fk(i)p Fq(\021)598
4836 y Fi(#include)41 b(<prtl/ex.h>)473 b(//)40 b(for)g(off_PgFltReq)
1885 5255 y Fz(718)p eop
PStoPSsaved restore
%%Page: (720,721) 361
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
719 720 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(KVMRegion::get)p 1242 523 V 31 w(pgsize)29 b Fj(implementation.)e
Fk(i)p Fq(\021)598 614 y Fi(//)39 b(Returns)i(the)f(page)g(size.)598
706 y(vm_size_t)h(off_KVMRegion::get_pgsz\(void\))598
797 y({)637 888 y(return)g(off_MBank::get_pgsize\(\);)598
980 y(})515 1245 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l
(e)l(gion)h(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
1337 y Fi(#include)41 b(<klib/err.h>)434 b(//)40 b(for)g(err_t)g(and)g
(error)g(numbers.)598 1428 y(#include)h(<klib/limits.h>)317
b(//)40 b(for)g(KVM)g(related)g(system)h(limits.)598
1519 y(#include)g(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h
(natural_t)g(et)f(al.)598 1611 y(class)g(off_KPgAllocator;)515
1785 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fq(\021)598
1876 y Fi(#include)41 b(<dmm/KPgAllocator.h>)122 b(//)40
b(for)g(off_KPgAllocator)i(et)e(al)598 1968 y(#include)h(<hw/MBank.h>)
515 2142 y Fk(h)p Fi(off)p 667 2142 V 29 w(KVMRegion)29
b Fj(static)g(memb)l(ers.)f Fk(i)p Fq(\021)598 2233 y
Fi(off_KPgAllocator)43 b(*off_KVMRegion::r_palloc=NULL;)639
2374 y Fz(The)28 b(allo)r(cator)e(is)h(setup)h(b)n(y)f
Fx(KVM)g Fz(at)g(start)g(time.)515 2507 y Fk(h)p Fj(Initialize)f(other)
j(private)g(memb)l(ers)g(of)e Fi(off)p 1854 2507 V 29
w(KVM)p Fj(.)g Fk(i)p Fz(+)p Fq(\021)598 2599 y Fi
(off_KVMRegion::r_palloc=&k_pal)q(loc;)639 2740 y Fz(Note)36
b(ho)n(w)f(for)h(eac)n(h)f(concrete)g(region)f(allo)r(cation,)j(deallo)
r(cation)e(and)h(page)f(fault)515 2839 y(handling)27
b(ma)n(y)g(b)r(e)h(handled)g(di\013eren)n(tly)-7 b(.)639
2939 y(The)28 b(easy)f(ones)g(are)f Fx(get)p 1453 2939
27 4 v 30 w(start)g Fz(and)h Fx(get)p 2022 2939 V 30
w(end)p Fz(.)515 3072 y Fk(h)p Fi(off)p 667 3072 24 4
v 29 w(KVMRegion::get)p 1242 3072 V 31 w(start)i Fj(and)f
Fi(get)p 1763 3072 V 28 w(end)h Fj(implementation.)e
Fk(i)p Fq(\021)598 3163 y Fi(//)39 b(Get)h(the)g(starting)h(address.)
598 3254 y(inline)f(vm_offset_t)i(off_KVMRegion::get_start\(void)q(\))j
(const)40 b({)g(return)h(r_start;)g(})598 3346 y(//)e(Get)h(the)g
(region)h(end.)f(first)g(invalid)h(address.)598 3437
y(inline)f(vm_offset_t)i(off_KVMRegion::get_end\(void\))k(const)40
b({)f(return)i(r_end;)g(})1885 5255 y Fz(719)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
720 721 bop 639 523 a Fz(W)-7 b(e)27 b(no)n(w)f(can)g(implemen)n(t)h
Fx(KVM::find)p 1912 523 27 4 v 27 w(region)d Fz(using)i(them.)38
b(T)-7 b(o)26 b(\014nd)g(a)g(region)f(w)n(e)515 623 y(ignore)h(the)j
(catc)n(h-all)e(region)f Fx(KVM)p 1629 623 V 31 w(RNULL)g
Fz(and)h(use)h(a)g(linear)f(searc)n(h)g(\(whic)n(h)h(should)g(b)r(e)515
722 y(replaced)e(b)n(y)i(a)f(binary)g(searc)n(h)f(in)i(the)g(future,)g
(as)f(regions)f(are)g(sorted\).)515 845 y Fk(h)p Fi(off)p
667 845 24 4 v 29 w(KVM::find)p 1047 845 V 30 w(region)j
Fj(implementation.)e Fk(i)p Fq(\021)598 937 y Fi(//)39
b(Finds)i(the)f(region)g(handling)h(kva)598 1028 y(//)e(or)h(returns)h
(a)e(pointer)i(to)f(the)g(given)g(default)h(one.)598
1119 y(off_KVMRegion)h(*off_KVM::find_region\(vm_offs)q(et_t)k(kva,)40
b(natural_t)h(dflt\))598 1211 y({)676 1302 y(natural_t)g(reg;)676
1393 y(extern)g(int)f(morecore_debug;)676 1485 y(if)g(\(!kva\))g({)755
1576 y(return)g(k_regions[dflt];)676 1667 y(})676 1759
y(for\(reg=1;)i(reg)e(<)f(k_nregions;)j(reg++\){)755
1850 y(assert\(k_regions[reg]\);)755 1941 y
(assert\(k_regions[reg]->get_star)q(t\(\))k(<=)39 b
(k_regions[reg]->get_end\(\)\);)755 2033 y(if)g
(\(k_regions[reg]->get_start\(\))46 b(<=)40 b(kva)g(&&)f(kva)h(<)g
(k_regions[reg]->get_end\(\)\){)833 2124 y(return)h(k_regions[reg];)755
2215 y(})676 2307 y(})676 2398 y(return)g(k_regions[dflt];)598
2580 y(})639 2803 y Fz(F)-7 b(or)27 b(debug)h(purp)r(oses,)f(regions)f
(ha)n(v)n(e)g(names)h(and)h(can)f(b)r(e)h(dump)r(ed.)515
2926 y Fk(h)p Fj(Other)g(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 2926 V 29 w(KVMRegion)p Fj(.)h Fk(i)o Fq(\021)598
3017 y Fi(const)40 b(char)g(*r_name;)747 b(//)40 b(Region)h(name.)515
3172 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3172 V 29 w(KVMRegion)p Fj(.)i Fk(i)p Fq(\021)598
3264 y Fi(const)40 b(char)g(*nameof\(void\))i(const;)598
3355 y(friend)e(OStr)g(&operator<<\(OStr)j(&s,)d(const)h(off_KVMRegion)
h(&r\);)515 3510 y Fk(h)p Fi(off)p 667 3510 V 29 w(KVMRegion::nameof)31
b Fj(implementation.)c Fk(i)p Fq(\021)598 3601 y Fi(const)40
b(char)g(*off_KVMRegion::nameof\(void\))46 b(const)598
3692 y({)676 3784 y(return)41 b(r_name;)598 3875 y(})515
4121 y Fk(h)p Fi(off)p 667 4121 V 29 w(KVMRegion::operator<<)32
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 4212 y Fi(OStr)40
b(&operator<<\(OStr)j(&s,)d(const)g(off_KVMRegion)i(&r\))598
4304 y({)676 4395 y(const)f(char)f(*name=)g
(\(\(r.nameof\(\)!=NULL\)?r.nameof)q(\(\):")q(reg"\))q(;)676
4486 y(s)g(<<)f(name)h(<<)g(":")g(<<)g(fmt\("\045x",r.r_start\))j(<<)d
(")f(to)h(")g(<<)f(fmt\("\045x",r.r_end\);)676 4578 y(return)i(s;)598
4669 y(})515 4915 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)
l(e)l(gion)h(implementation)f(dep)l(endencies.)h Fk(i)p
Fz(+)o Fq(\021)598 5006 y Fi(#include)41 b(<klib/str.h>)1885
5255 y Fz(720)p eop
PStoPSsaved restore
%%Page: (722,723) 362
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
721 722 bop 639 523 a Fz(Finally)-7 b(,)28 b(no)f Fx(KVMRegion)d
Fz(can)j(b)r(e)h(instan)n(tiated.)37 b(Only)27 b(concrete)g(sub)r
(classes)g(can.)515 639 y Fk(h)p Fj(Other)h(pr)l(ote)l(cte)l(d)j(metho)
l(ds)e(of)e Fi(off)p 1594 639 24 4 v 29 w(KVMRegion)p
Fj(.)i Fk(i)p Fq(\021)598 731 y Fi(//)39 b(Creates)i(a)f(KVM)g(region.)
598 822 y(//)f(\(the)i(name)f(is)f(not)h(copied.\))598
913 y(off_KVMRegion\(vm_offset_t)45 b(start,)40 b(vm_offset_t)i(end,)e
(const)g(char)h(*name=NULL\);)639 1038 y Fz(They)19 b(m)n(ust)h(sp)r
(ecify)g(initial)f(v)-5 b(alues)19 b(for)g Fx(r)p 1948
1038 27 4 v 31 w(start)e Fz(and)i Fx(r)p 2413 1038 V
31 w(end)f Fz(and)i(the)f(page)g(allo)r(cator)515 1137
y(to)27 b(b)r(e)h(used.)515 1270 y Fk(h)p Fi(off)p 667
1270 24 4 v 29 w(KVMRegion::off)p 1242 1270 V 31 w(KVMRegion)h
Fj(implementation.)f Fk(i)p Fq(\021)598 1362 y Fi(//)39
b(Creates)i(a)f(KVM)g(region.)598 1453 y(//)f(\(the)i(name)f(is)f(not)h
(copied.\))598 1544 y(off_KVMRegion::off_KVMRegion\(v)q(m_off)q(set_)q
(t)45 b(start,)c(vm_offset_t)g(end,)1735 1636 y(const)g(char)f(*name\))
g(:)676 1727 y(r_start\(start\),)j(r_end\(end\),)f(r_name\(name\))598
1818 y({;})515 2075 y FA(Null)30 b(faulting)i(regions)515
2229 y Fz(An)i(unmapp)r(ed)g(alw)n(a)n(ys-faulting)e(catc)n(h-all)g
(region)g(is)i(an)f(easy)g(thing)h(to)f(implemen)n(t.)515
2328 y(It)38 b(do)r(es)g(not)g(allo)r(cate)g(memory)-7
b(,)40 b(it)e(do)r(es)g(not)g(free)g(memory)-7 b(,)40
b(it)f(only)f(ab)r(orts)f(k)n(ernel)515 2428 y(execution)27
b(on)g(page)g(faults.)515 2561 y Fk(h)p Fj(O\013)g(\014xe)l(d)h(and)g
(faulting)g(kernel)g(virtual)g(memory)g(r)l(e)l(gion.)g
Fk(i)p Fq(\021)598 2652 y Fi(//)39 b(An)h(unmapped)h(kernel)g(virtual)g
(memory)f(region.)598 2743 y(//)598 2835 y(class)g
(off_NullFaultingRegion)k(:)c(public)g(off_KVMRegion)j({)598
2926 y(public:)676 3017 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 3017 V 29 w(NullFaultingRegion)p
Fj(.)k Fk(i)676 3200 y Fi(//)40 b(Allocates)h(a)f(kernel)g(page.)676
3291 y(//)g(Chooses)h(the)f(location)h(if)e(at)h(is)g(0.)676
3383 y(virtual)h(vm_offset_t)h(pg_alloc\(vm_offset_t)i(at\))39
b({)755 3474 y(\(void\)at;)i(return)g(0;)676 3565 y(})676
3657 y(//)f(Deallocates)i(a)d(kernel)i(page.)676 3748
y(virtual)g(void)f(pg_free\(vm_offset_t)k(p\))39 b({)h(\(void\)p;)h(})
676 3839 y(//)f(Allocates)h(n)f(kernel)g(pages.)676 3931
y(//)g(Chooses)h(the)f(location)h(if)e(at)h(is)g(0.)676
4022 y(virtual)h(vm_offset_t)h(pg_alloc\(vm_offset_t)i(at,)39
b(natural_t)j(n\))d({)755 4113 y(\(void\))h(at;)g(\(void\))h(n;)e
(return)i(0;)676 4205 y(})676 4296 y(//)f(Deallocates)i(n)d(kernel)i
(pages.)676 4387 y(virtual)g(void)f(pg_free\(vm_offset_t)k(p,)39
b(natural_t)j(n\))d({)h(\(void\)p;)h(\(void\)n;)g(})676
4570 y(//)f(Handles)h(page)f(faults)676 4661 y(virtual)h(err_t)f
(pg_fault\(off_PgFltReq)k(*pgf\);)598 4844 y(};)1885
5255 y Fz(721)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
722 723 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(NullFaultingRegion::pg)p 1554 523 V 33 w(fault)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Handles)i(page)f(faults)598 706 y(err_t)g
(off_NullFaultingRegion::pg_fa)q(ult\()q(off_)q(PgFlt)q(Req)46
b(*pgf\))598 797 y({)676 888 y(assert\(pgf\);)676 980
y(kcout)41 b(<<)e("kernel)i(page)f(fault)h(on)e(unmapped)i(region)g(at)
f(";)676 1071 y(kcout)h(<<)e(fmt\("\04508x",pgf->get_vaddr\(\)\))q(;)
676 1162 y(kcout)i(<<)e(")h(reason)g(")g(<<)f
(fmt\("\04508x",pgf->t_error\))45 b(<<)40 b(nl;)676 1254
y(return)h(EINVAL;)598 1345 y(})515 1611 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h(dep)l(endencies.)g
Fk(i)p Fz(+)o Fq(\021)598 1702 y Fi(#include)41 b(<klib/str.h>)434
b(//)40 b(for)g(kcout.)639 1843 y Fz(The)c(address)e(and)i(length)f(of)
h(a)f Fx(NullFaultingRegi)o(on)29 b Fz(m)n(ust)36 b(b)r(e)g(kno)n(wn)f
(in)h(ad-)515 1943 y(v)-5 b(ance.)515 2059 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2059 V 29
w(NullFaultingRegion)p Fj(.)k Fk(i)p Fq(\021)598 2150
y Fi(//)39 b(Creates)i(a)f(null)g(faulting)h(region.)598
2242 y(off_NullFaultingRegion\(vm_offs)q(et_t)46 b(start,vm_offset_t)d
(end,)1500 2333 y(const)d(char)g(*name="Null"\);)515
2491 y Fk(h)p Fi(off)p 667 2491 V 29 w(NullFaultingRegion::off)p
1593 2491 V 33 w(NullFaultingRegion)32 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 2582 y Fi(//)39 b(Creates)i(a)f(null)g(faulting)h
(region.)598 2673 y(off_NullFaultingRegion::off_Nu)q(llFau)q(ltin)q
(gReg)q(ion\(v)q(m_of)q(fset_)q(t)k(start,)2441 2765
y(vm_offset_t)d(end,)2441 2856 y(const)f(char)f(*name\))h(:)676
2947 y(off_KVMRegion\(start,end,name)q(\))598 3039 y({;})639
3271 y Fz(The)30 b Fx(KVM)f Fz(itself)i(instan)n(tiates)e(a)h(n)n(ull)g
(faulting)g(region)f(at)h(system)g(b)r(o)r(ot)g(time.)45
b(It)30 b(is)515 3371 y(used)d(as)g(a)g(catc)n(h-all)g(when)h(no)f
(other)g(region)f(is)i(in)g(c)n(harge)d(of)j(the)g(address)e(in)n(v)n
(olv)n(ed.)515 3504 y Fk(h)p Fj(Other)i(private)h(memb)l(ers)f(of)g
Fi(off)p 1552 3504 V 29 w(KVM)p Fj(.)f Fk(i)p Fz(+)p
Fq(\021)598 3595 y Fi(static)40 b(off_NullFaultingRegion)45
b(k_null;)40 b(//)g(A)g(null)g(catch)g(all)g(region.)515
3769 y Fk(h)p Fi(off)p 667 3769 V 29 w(KVM)28 b Fj(static)g(memb)l
(ers.)h Fk(i)o Fz(+)p Fq(\021)598 3861 y Fi(off_NullFaultingRegion)44
b(off_KVM::k_null\(0,\(vm_offset_)q(t\)-1\))q(;)h(//)40
b(A)f(null)h(region.)639 4002 y Fz(It)28 b(is)g(setup)g(in)f(its)h
(slot)f(at)h Fx(KVM)e Fz(instan)n(tiation)h(time.)515
4134 y Fk(h)p Fj(Initialize)f(other)j(private)g(memb)l(ers)g(of)e
Fi(off)p 1854 4134 V 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 4226 y Fi(k_regions[OFF_KVM_RNULL]=)45 b(&k_null;)598
4317 y(k_nregions++;)1885 5255 y Fz(722)p eop
PStoPSsaved restore
%%Page: (724,725) 363
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
723 724 bop 515 523 a FA(Gro)m(wing)31 b(memory)e(region)515
676 y Fz(It)f(a)f(region)f(whic)n(h)i(should)f(not)h(fault)g(and)f(gro)
n(ws)f(b)n(y)639 842 y Fq(\017)41 b Fz(allo)r(cating)23
b(new)i(page)e(frames)h(and)g(mapping)f(them)i(on)f(the)h(righ)n(t)e
(address,)h(when)722 942 y Ft(dtlb)p Fz(s)j(are)g(a)n(v)-5
b(ailable.)639 1108 y Fq(\017)41 b Fz(allo)r(cating)31
b(an)n(y)g(a)n(v)-5 b(ailable)31 b(ph)n(ysical)g(page)g(frame)h(no)f
(matter)h(its)g(address)f(when)722 1208 y Ft(dtlb)p Fz(s)c(are)g(una)n
(v)-5 b(ailable.)639 1374 y(Th)n(us,)39 b(w)n(e)d(use)h(one)f(of)h(t)n
(w)n(o)f(kinds)g(of)h Fx(GrowingRegion)p Fz(s)31 b(dep)r(ending)37
b(on)f(existing)515 1473 y Ft(dtlb)27 b Fz(supp)r(ort.)515
1606 y Fk(h)p Fj(O\013)g(r)l(esize)l(able)i(kernel)f(virtual)g(memory)g
(r)l(e)l(gion.)g Fk(i)p Fq(\021)598 1697 y Fi(//)39 b(A)h(kernel)g
(growing)h(region.)598 1789 y(//)598 1880 y(class)f(off_GrowingRegion)j
(:)d(public)g(off_NullFaultingRegion)k({)598 1971 y(protected:)676
2063 y Fk(h)p Fj(Other)29 b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e
Fi(off)p 1755 2063 24 4 v 29 w(GrowingRegion)p Fj(.)j
Fk(i)676 2154 y(h)p Fj(Other)f(pr)l(ote)l(cte)l(d)h(memb)l(ers)f(of)e
Fi(off)p 1778 2154 V 29 w(GrowingRegion)p Fj(.)j Fk(i)598
2245 y Fi(public:)676 2337 y Fk(h)p Fj(Other)f(public)e(metho)l(ds)i
(of)e Fi(off)p 1654 2337 V 29 w(GrowingRegion)p Fj(.)j
Fk(i)598 2428 y Fi(};)598 2611 y(//)39 b(A)h(kernel)g(growing)h(region)
g(without)g(dtlb)f(support.)598 2702 y(class)g(off_GrowingPRegion)j(:)d
(public)g(off_GrowingRegion)k({)598 2793 y(public:)676
2885 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 2885 V 29 w(GrowingPRegion)p Fj(.)j Fk(i)598
2976 y Fi(};)598 3159 y(//)39 b(A)h(kernel)g(growing)h(memory)g(region)
f(with)h(dtlb)f(support.)598 3250 y(class)g(off_GrowingVRegion)j(:)d
(public)g(off_GrowingRegion)k({)598 3341 y(public:)676
3433 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 3433 V 29 w(GrowingVRegion)p Fj(.)j Fk(i)598
3524 y Fi(};)639 3756 y Fz(When)d(a)e(gro)n(wing)f(region)h(is)h
(created)f(it)h(is)g(giv)n(en)f(a)h(v)-5 b(alid)26 b(starting)f(\(k)n
(ernel)g(virtual\))515 3856 y(address)f(and)i(a)g(size)f(limit.)37
b(It)27 b(then)f(gro)n(ws)e(as)h(memory)h(is)f(allo)r(cated)h(b)n(y)f
(mapping)h(new)515 3956 y(k)n(ernel)g(pages)h(righ)n(t)g(after)g(the)h
(last)f(mapp)r(ed)h(one.)639 4055 y(Besides,)35 b(regions)d(ma)n(y)h
(gro)n(w)e(to)j(higher)f(addresses)f(or)g(to)i(lo)n(w)n(er)e
(addresses,)h(suc)n(h)515 4155 y(parameter)26 b(m)n(ust)i(b)r(e)g(sp)r
(eci\014ed)f(in)h(adv)-5 b(ance.)515 4288 y Fk(h)p Fj(Other)28
b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594
4288 V 29 w(GrowingRegion)p Fj(.)j Fk(i)p Fq(\021)598
4379 y Fi(//)39 b(Creates)i(a)f(growing)h(memory)f(region.)598
4470 y(//)f(By)h(default)h(it)f(grows)g(left)g(\(low)g(addresses\))i
(to)d(right)i(\(high)f(addresses\))598 4562 y
(off_GrowingRegion\(vm_offset_t)46 b(start,)40 b(vm_offset_t)i(limit,)
1304 4653 y(const)e(char)g(*name="Block",)1304 4744 y(boolean_t)h
(left2right)h(=TRUE\);)1885 5255 y Fz(723)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
724 725 bop 639 523 a Fz(Note)19 b(ho)n(w)e Fx(GrowingRegion)p
Fz(s)c(can)18 b(not)h(b)r(e)f(instan)n(tiated.)34 b(Constructors)17
b(for)g Fx(GrowingPRegion)p Fz(s)515 623 y(and)27 b Fx(GrowingVRegion)p
Fz(s)22 b(are)k(a)n(v)-5 b(ailable)27 b(and)g(receiv)n(e)g(the)g(same)h
(argumen)n(ts.)515 739 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 739 24 4 v 29 w(GrowingPRegion)p Fj(.)j
Fk(i)p Fq(\021)598 830 y Fi(//)39 b(Creates)i(a)f(growing)h(memory)f
(region.)598 922 y(//)f(By)h(default)h(it)f(grows)g(left)g(\(low)g
(addresses\))i(to)d(right)i(\(high)f(addresses\))598
1013 y(off_GrowingPRegion\(vm_offset_t)46 b(start,)40
b(vm_size_t)i(limit,)1343 1104 y(const)e(char)h(*name="PBlock",)1343
1196 y(boolean_t)g(left2right)h(=TRUE\):)676 1287 y
(off_GrowingRegion\(start,limi)q(t,nam)q(e,le)q(ft2r)q(ight\))598
1378 y({;})515 1536 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 1536 V 29 w(GrowingVRegion)p Fj(.)j Fk(i)p
Fq(\021)598 1627 y Fi(//)39 b(Creates)i(a)f(growing)h(memory)f(region.)
598 1719 y(//)f(By)h(default)h(it)f(grows)g(left)g(\(low)g(addresses\))
i(to)d(right)i(\(high)f(addresses\))598 1810 y
(off_GrowingVRegion\(vm_offset_t)46 b(start,)40 b(vm_size_t)i(limit,)
1343 1901 y(const)e(char)h(*name="VBlock",)1343 1993
y(boolean_t)g(left2right)h(=TRUE\);)515 2167 y Fk(h)p
Fi(off)p 667 2167 V 29 w(GrowingVRegion::off)p 1437 2167
V 32 w(GrowingVRegion)31 b Fj(implementation.)c Fk(i)p
Fq(\021)598 2258 y Fi(//)39 b(Creates)i(a)f(growing)h(memory)f(region.)
598 2350 y(//)f(By)h(default)h(it)f(grows)g(left)g(\(low)g(addresses\))
i(to)d(right)i(\(high)f(addresses\))598 2441 y
(off_GrowingVRegion::off_Growin)q(gVReg)q(ion\()q(vm_o)q(ffset)q(_t)45
b(start,)c(vm_size_t)g(limit,)1343 2532 y(const)f(char)h(*name,)79
b(boolean_t)42 b(left2right\):)676 2623 y
(off_GrowingRegion\(start,limi)q(t,nam)q(e,le)q(ft2r)q(ight\))598
2715 y({)676 2806 y(if)e(\(off_DMM::is_active\(\)\))k({)755
2897 y(vm_offset_t)d(pg;)755 2989 y(pg=off_KVM::raw_pg_alloc\(\);)755
3080 y(assert\(pg\);)755 3171 y(d_kdtlb.map\()h
(\(\(left2right\)?start:\(start+limi)q(t\)-o)q(ff_MB)q(ank:)q(:get)q
(_pgsi)q(ze\(\))q(\),)951 3263 y(pg,off_MBank::get_pgsize\(\),)1265
3354 y(OFF_MOD_R|OFF_MOD_W)h(\);)755 3445 y(d_kdtlb.sync\(\);)676
3537 y(})598 3719 y(})639 3861 y Fz(What)28 b(w)n(e)e(do)h(to)g(handle)
g(a)f(gro)n(wing)f(region)h(is)h(to)g(k)n(eep)f(the)i(\(signed\))f
(size)f(for)h(eac)n(h)515 3960 y(mapp)r(ed)h(page)e(and)i(the)g
(address)e(where)h(the)h(next)g(page)f(should)g(b)r(e)h(mapp)r(ed.)515
4076 y Fk(h)p Fj(Other)g(pr)l(ote)l(cte)l(d)j(memb)l(ers)d(of)f
Fi(off)p 1616 4076 V 29 w(GrowingRegion)p Fj(.)j Fk(i)p
Fq(\021)598 4168 y Fi(vm_offset_t)41 b(g_end;)551 b(//)40
b(End)g(of)f(mapped)i(memory.)598 4259 y(int)353 b(g_sz;)590
b(//)40 b(Mapped)g(page)g(size.)1885 5255 y Fz(724)p
eop
PStoPSsaved restore
%%Page: (726,727) 364
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
725 726 bop 639 523 a Fz(W)-7 b(e)28 b(initialize)g Fx(g)p
1168 523 27 4 v 31 w(sz)e Fz(so)h(that)h(b)n(y)f(adding)g(it)h(to)f
Fx(g)p 2210 523 V 31 w(end)f Fz(w)n(e)h(mak)n(e)g Fx(g)p
2782 523 V 31 w(end)f Fz(gro)n(w)g(in)i(the)515 623 y(appropriate)e
(direction.)515 756 y Fk(h)p Fi(off)p 667 756 24 4 v
29 w(GrowingRegion::off)p 1398 756 V 32 w(GrowingRegion)k
Fj(implementation.)e Fk(i)p Fq(\021)598 847 y Fi(//)39
b(Creates)i(a)f(growing)h(memory)f(region.)598 938 y
(off_GrowingRegion::off_Growing)q(Regio)q(n\(vm)q(_off)q(set_t)46
b(start,)40 b(vm_offset_t)i(limit,)2049 1029 y(const)f(char)f(*name,)
2049 1121 y(boolean_t)h(left2right\):)637 1212 y
(off_NullFaultingRegion\(start,)q(start)q(+lim)q(it,n)q(ame\),)637
1303 y(g_end\(\(left2right\)?start:\(sta)q(rt+li)q(mit\))q(\),)637
1395 y(g_sz\(\(left2right\)?off_MBank::)q(get_p)q(gsiz)q(e\(\):)q
(\(0-\(i)q(nt\)o)q(ff_MB)q(ank:)q(:get)q(_pgsi)q(ze\(\))q(\)\))598
1486 y({;})639 1627 y Fz(After)c(that,)h(allo)r(cation)d(pro)r(ceeds)f
(di\013eren)n(tly)i(dep)r(ending)h(on)e Ft(dtlb)h Fz(supp)r(ort)f(b)n
(y)515 1727 y(mapping)22 b(pages)g(at)h Fx(g)p 1219 1727
27 4 v 31 w(end)e Fz(and)i(adjusting)g Fx(g)p 1962 1727
V 31 w(end)f Fz(to)g(the)i(next)f(unmapp)r(ed)g(page.)34
b(Deal-)515 1826 y(lo)r(cation)27 b(requests)f(are)h(silen)n(tly)g
(discarded.)639 1926 y(T)-7 b(o)35 b(implemen)n(t)g(them)h(it)f(is)g
(handy)f(to)h(kno)n(w)f(if)h(a)g(resize)f(w)n(ould)g(pass)g(the)h
(region)515 2026 y(limit)28 b(and)f(the)h(starting)f(address)g(to)g(b)r
(e)h(mapp)r(ed)g(to)f(mak)n(e)g(the)h(region)e(gro)n(w.)515
2159 y Fk(h)p Fj(Other)i(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 2159 24 4 v 29 w(GrowingRegion)p Fj(.)j
Fk(i)p Fz(+)o Fq(\021)598 2250 y Fi(//)39 b(Does)i(this)f(grow)g
(operation)h(\(n)f(pages\))g(fit)g(in)g(region)h(limits?)598
2341 y(inline)f(boolean_t)i(grow_fits\(natural_t)h(n\))d(const;)598
2433 y(//)f(What)i(is)e(the)h(map)g(start)g(address)h(for)f(the)g(new)g
(memory?)598 2524 y(inline)g(vm_offset_t)i(grow_start\(natural_t)i
(n=0\))c(const;)639 2665 y Fz(W)-7 b(e)21 b(can)e(kno)n(w)g(b)r(oth)h
(things)g(b)n(y)g(pa)n(ying)f(atten)n(tion)g(to)h(the)g(gro)n(w)f
(direction,)i(as)e(sho)n(wn)515 2765 y(b)n(y)27 b Fx(g)p
679 2765 27 4 v 31 w(sz)p Fz(.)515 2897 y Fk(h)p Fi(off)p
667 2897 24 4 v 29 w(GrowingRegion::grow)p 1437 2897
V 32 w(fits)h Fj(implementation.)g Fk(i)p Fq(\021)598
2989 y Fi(//)39 b(Does)i(this)f(grow)g(operation)h(\(n)f(pages\))g(fit)
g(in)g(region)h(limits?)598 3080 y(inline)f(boolean_t)i
(off_GrowingRegion::grow_fits\(na)q(tura)q(l_t)j(n\))40
b(const)598 3171 y({)676 3263 y(vm_offset_t)i(new_end=n*g_sz)g(+)e
(g_end;)676 3354 y(return)h(r_start)g(<=)e(new_end)i(&&)f(new_end)h(<=)
e(r_end;)598 3445 y(})515 3711 y Fk(h)p Fi(off)p 667
3711 V 29 w(GrowingRegion::grow)p 1437 3711 V 32 w(start)29
b Fj(implementation.)e Fk(i)p Fq(\021)598 3802 y Fi(//)39
b(What)i(is)e(the)h(map)g(start)g(address)h(for)f(the)g(new)g(memory?)
598 3894 y(inline)g(vm_offset_t)i(off_GrowingRegion::grow_start)q
(\(nat)q(ural_)q(t)j(n\))40 b(const)598 3985 y({)676
4076 y(return)h(\(g_sz)f(>)g(0\))f(?)h(g_end)g(:)g(\(g_end)g(+)g
(g_sz*n\);)598 4168 y(})1885 5255 y Fz(725)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
726 727 bop 639 523 a Fz(F)-7 b(or)27 b(gro)n(wing)f(regions,)g
Fx(get)p 1542 523 27 4 v 30 w(start)g Fz(and)h Fx(get)p
2111 523 V 30 w(end)g Fz(are)f(rede\014ned)h(according)f(to)i(the)515
623 y(gro)n(w)g(direction.)43 b(Note)30 b(ho)n(w)f(dep)r(ending)h(on)g
(the)g(kno)n(wn)f(region)f(t)n(yp)r(e)j(\()p Fx(KVMRegion)26
b Fz(or)515 722 y Fx(GrowingRegion)p Fz(\))32 b(the)37
b(starting)g(address)e(c)n(hanges.)64 b(F)-7 b(or)37
b(those)g(kno)n(wing)f(that)h(their)515 822 y(region)28
b(gro)n(ws)g(righ)n(t)h(to)h(left,)h(the)f(starting)f(address)g(is)h
(considered)f(to)g(b)r(e)i(the)f(last)f(one)515 922 y(instead.)515
1054 y Fk(h)p Fj(Other)f(public)g(metho)l(ds)h(of)e Fi(off)p
1493 1054 24 4 v 29 w(GrowingRegion)p Fj(.)j Fk(i)p Fq(\021)598
1146 y Fi(//)39 b(Get)h(the)g(starting)h(address.)598
1237 y(inline)f(vm_offset_t)i(get_start\(void\))h(const;)598
1328 y(//)c(Get)h(the)g(region)h(end.)f(first)g(invalid)h(address.)598
1420 y(inline)f(vm_offset_t)i(get_end\(void\))g(const;)515
1685 y Fk(h)p Fi(off)p 667 1685 V 29 w(GrowingRegion::get)p
1398 1685 V 32 w(start)28 b Fj(and)g Fi(get)p 1919 1685
V 29 w(end)g Fj(implementation.)g Fk(i)p Fq(\021)598
1777 y Fi(//)39 b(Get)h(the)g(starting)h(address.)598
1868 y(inline)f(vm_offset_t)i(off_GrowingRegion::get_start\()q(void)q
(\))j(const)40 b({)676 1959 y(return)h(\(\(g_sz<0\))g(?)f
(off_KVMRegion::get_end\(\))k(:)c(off_KVMRegion::get_start\(\)\);)598
2051 y(})598 2142 y(//)f(Get)h(the)g(region)h(end.)f(first)g(invalid)h
(address.)598 2233 y(inline)f(vm_offset_t)i
(off_GrowingRegion::get_end\(vo)q(id\))k(const)40 b({)676
2325 y(return)h(\(\(g_sz<0\))g(?)f(off_KVMRegion::get_start\(\))45
b(:)39 b(off_KVMRegion::get_end\(\)\);)598 2416 y(})639
2648 y Fz(Metho)r(ds)31 b Fx(pg)p 1077 2648 27 4 v 30
w(alloc)d Fz(and)i Fx(pg)p 1607 2648 V 31 w(free)f Fz(are)g(implemen)n
(ted)i(in)f Fx(GrowingPRegion)p Fz(s)24 b(and)515 2748
y Fx(GrowingVRegion)p Fz(s.)515 2864 y Fk(h)p Fj(Other)k(public)g
(metho)l(ds)h(of)e Fi(off)p 1493 2864 24 4 v 29 w(GrowingPRegion)p
Fj(.)j Fk(i)p Fz(+)o Fq(\021)598 2956 y Fi(//)39 b(Allocates)j(a)d
(kernel)i(page.)598 3047 y(//)e(Chooses)i(the)f(location)h(if)f(at)g
(is)f(0.)598 3138 y(virtual)i(vm_offset_t)g(pg_alloc\(vm_offset_t)j
(at\);)598 3230 y(//)39 b(Allocates)j(n)d(kernel)i(pages.)598
3321 y(//)e(Chooses)i(the)f(location)h(if)f(at)g(is)f(0.)598
3412 y(virtual)i(vm_offset_t)g(pg_alloc\(vm_offset_t)j(at,)c(natural_t)
h(n\);)515 3570 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3570 V 29 w(GrowingVRegion)p Fj(.)j Fk(i)p
Fz(+)o Fq(\021)598 3661 y Fi(//)39 b(Allocates)j(a)d(kernel)i(page.)598
3753 y(//)e(Chooses)i(the)f(location)h(if)f(at)g(is)f(0.)598
3844 y(virtual)i(vm_offset_t)g(pg_alloc\(vm_offset_t)j(at\);)598
4027 y(//)39 b(Allocates)j(n)d(kernel)i(pages.)598 4118
y(//)e(Chooses)i(the)f(location)h(if)f(at)g(is)f(0.)598
4209 y(virtual)i(vm_offset_t)g(pg_alloc\(vm_offset_t)j(at,)c(natural_t)
h(n\);)1885 5255 y Fz(726)p eop
PStoPSsaved restore
%%Page: (728,729) 365
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
727 728 bop 639 523 a Fz(When)28 b(no)f Ft(dtlb)g Fz(is)f(a)n(v)-5
b(ailable)26 b(w)n(e)h(m)n(ust)g(restrict)g(ourselv)n(es)e(to)i(the)g
(range)f(sp)r(eci\014ed)515 623 y(at)h(creation)g(time)h(as)f(there)g
(is)h(no)f(address)g(translation.)35 b(Th)n(us)28 b(w)n(e)f(try)g(to)h
(allo)r(cate)f(the)515 722 y(\014rst)g(a)n(v)-5 b(ailable)26
b(page)h(in)h(the)g(allo)r(cation)e(region.)639 822 y(Th)n(us,)i(w)n(e)
f(simply)h(use)f(the)h(page)f(allo)r(cator)f(to)h(request)g(pages)f(at)
i(the)g Fx(break)p Fz(.)515 938 y Fk(h)p Fi(off)p 667
938 24 4 v 29 w(GrowingPRegion::pg)p 1398 938 V 32 w(alloc)g
Fj(implementation.)g Fk(i)p Fq(\021)598 1029 y Fi(//)39
b(Allocates)j(a)d(kernel)i(page.)598 1121 y(//)e(Chooses)i(the)f
(location)h(if)f(at)g(is)f(0.)598 1212 y(vm_offset_t)i
(off_GrowingPRegion::pg_allo)q(c\(vm)q(_offs)q(et_t)46
b(at\))598 1303 y({)676 1395 y(if)40 b(\(!grow_fits\(1\)\))755
1486 y(return)g(0;)676 1577 y(at=r_palloc->alloc\(grow_star)q(t\(1\)\))
q(;)676 1669 y(g_end+=g_sz;)676 1760 y(return)h(at;)598
1851 y(})598 2034 y(//)e(Allocates)j(n)d(kernel)i(pages.)598
2125 y(//)e(Chooses)i(the)f(location)h(if)f(at)g(is)f(0.)598
2217 y(vm_offset_t)i(off_GrowingPRegion::pg_allo)q(c\(vm)q(_offs)q
(et_t)46 b(at,)40 b(natural_t)h(n\))598 2308 y({)676
2399 y(if)f(\(!grow_fits\(n\)\))755 2491 y(return)g(0;)676
2582 y(at=r_palloc->alloc\(grow_star)q(t\(n\),)q(n\);)676
2673 y(g_end)h(+=g_sz*n;)676 2765 y(return)g(at;)598
2856 y(})639 3072 y Fz(When)28 b Ft(dtlb)f Fz(supp)r(ort)h(is)f(a)n(v)
-5 b(ailable)26 b(w)n(e)h(can)g(request)g(an)n(y)g(page)f(frame)h(and)g
(map)h(it)515 3171 y(at)f(the)h(break.)515 3304 y Fk(h)p
Fi(off)p 667 3304 V 29 w(GrowingVRegion::pg)p 1398 3304
V 32 w(alloc)g Fj(implementation.)g Fk(i)p Fq(\021)598
3396 y Fi(//)39 b(Allocates)j(a)d(kernel)i(page.)598
3487 y(//)e(Chooses)i(the)f(location)h(if)f(at)g(is)f(0.)598
3578 y(vm_offset_t)i(off_GrowingVRegion::pg_allo)q(c\(vm)q(_offs)q
(et_t)46 b(at\))598 3670 y({)676 3761 y(if)40 b(\(!grow_fits\(1\)\))755
3852 y(return)g(0;)676 3944 y(else)g({)755 4035 y(vm_offset_t)h
(pg=off_KVM::raw_pg_alloc\(\);)755 4126 y
(off_DMM::get_kdtlb\(\)->map\(grow_)q(star)q(t\(1\))q(,pg,g)q(et_p)q
(gsz\(\))q(,OFF)q(_MOD)q(_RW\);)755 4218 y(g_end+=g_sz;)755
4309 y(return)f(at;)676 4400 y(})598 4491 y(})515 4757
y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h
(implementation)f(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
4848 y Fi(#include)41 b(<dmm/KVM.h>)473 b(//)40 b(for)g(raw_pg_alloc)
1885 5255 y Fz(727)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
728 729 bop 515 523 a Fk(h)p Fi(off)p 667 523 24 4 v
29 w(GrowingVRegion::pg)p 1398 523 V 32 w(alloc)28 b
Fj(implementation.)g Fk(i)p Fz(+)o Fq(\021)598 614 y
Fi(//)39 b(Allocates)j(n)d(kernel)i(pages.)598 706 y(//)e(Chooses)i
(the)f(location)h(if)f(at)g(is)f(0.)598 797 y(vm_offset_t)i
(off_GrowingVRegion::pg_allo)q(c\(vm)q(_offs)q(et_t)46
b(at,)40 b(natural_t)h(n\))598 888 y({)676 980 y(if)f
(\(!grow_fits\(n\)\))755 1071 y(return)g(0;)676 1162
y(else)g({)755 1254 y(vm_offset_t)h(vpg=grow_start\(n\);)755
1345 y(do)e({)833 1436 y(vm_offset_t)j(pg=off_KVM::raw_pg_alloc\(\);)
833 1528 y(vpg=grow_start\(1\);)833 1619 y(if)e(\(!pg\))707
b(//)40 b(Memory)g(leak.)h(should)f(release)h(allocated)g(pgs.)912
1710 y(return)f(0;)833 1802 y(off_DMM::get_kdtlb\(\)->map\(at,)q(vpg,)q
(get_)q(pgsz\()q(\),OF)q(F_MOD)q(_RW\))q(;)833 1893 y(g_end+=)h(g_sz;)
755 1984 y(})e(while\(--n\);)755 2076 y(return)h(at;)676
2167 y(})598 2258 y(})515 2401 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)
g(memory)g(r)l(e)l(gion)h(implementation)f(dep)l(endencies.)h
Fk(i)p Fz(+)o Fq(\021)598 2492 y Fi(#include)41 b(<dmm/DMM.h>)473
b(//)40 b(for)g(get_kdtlb)h(et)f(al.)598 2584 y(#include)h
(<dmm/DTLB.h>)434 b(//)40 b(for)g(map)g(et)f(al)515 2818
y FA(Blo)s(c)m(k)32 b(allo)s(cator)f(and)i(k)m(ernel)f(stac)m(k)h
(regions)515 2971 y Fz(W)-7 b(e)28 b(need)f(a)h(new)f(couple)h(of)f
(region)f(t)n(yp)r(es.)515 3088 y Fk(h)p Fj(O\013)h(self)g(r)l(esize)l
(able)i(kernel)g(virtual)f(memory)g(r)l(e)l(gion.)g Fk(i)o
Fq(\021)598 3180 y Fi(//)39 b(A)h(self)g(resizeable)i(kernel)e(virtual)
h(memory)g(region.)598 3271 y(//)598 3362 y(class)f
(off_SelfGrowingPRegion)k(:)c(public)g(off_GrowingPRegion)k({)598
3454 y(public:)676 3545 y(off_SelfGrowingPRegion\(vm_of)q(fset_)q(t)h
(start,)c(vm_offset_t)g(limit,)1578 3636 y(const)g(char)f
(*name="SPBlock",)1578 3728 y(boolean_t)i(left2right)f(=)f(TRUE\);)598
3819 y(};)598 4002 y(class)g(off_SelfGrowingVRegion)k(:)c(public)g
(off_GrowingVRegion)k({)598 4093 y(public:)676 4184 y
(off_SelfGrowingVRegion\(vm_of)q(fset_)q(t)h(start,)c(vm_offset_t)g
(limit,)1578 4276 y(const)g(char)f(*name="SVBlock",)1578
4367 y(boolean_t)i(left2right)f(=)f(TRUE\):)755 4458
y(off_GrowingVRegion\(start,limit,)q(name)q(,lef)q(t2rig)q(ht\))676
4550 y({;})676 4732 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(off)p 1654 4732 V 29 w(SelfGrowingVRegion)p Fj(.)k
Fk(i)598 4824 y Fi(};)1885 5255 y Fz(728)p eop
PStoPSsaved restore
%%Page: (730,731) 366
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
729 730 bop 639 523 a Fz(The)37 b(one)g(without)g Ft(dtlb)f
Fz(supp)r(ort)h(simply)g(allo)r(cates)f(ev)n(ery)f(page)h(in)h(the)g
(region)515 623 y(righ)n(t)27 b(from)g(the)h(start.)515
756 y Fk(h)p Fi(off)p 667 756 24 4 v 29 w(SelfGrowingPRegion::off)p
1593 756 V 33 w(SelfGrowingPRegion)k Fj(implementation.)27
b Fk(i)p Fq(\021)598 847 y Fi(off_SelfGrowingPRegion::off_Se)q(lfGro)q
(wing)q(PReg)q(ion\(v)q(m_of)q(fset_)q(t)45 b(start,)2441
938 y(vm_offset_t)d(limit,)2441 1029 y(const)f(char)f(*name,)2441
1121 y(boolean_t)i(left2right\):)676 1212 y
(off_GrowingPRegion\(start,lim)q(it,na)q(me,l)q(eft2)q(right)q(\))598
1303 y({)676 1395 y(vm_offset_t)g(v=r_palloc->alloc\(start,off_M)q
(Bank:)q(:a2p)q(\(limi)q(t\)\);)676 1486 y(assert\(v\);)598
1577 y(})639 1810 y Fz(The)34 b(one)g(with)g Ft(dtlb)g
Fz(supp)r(ort)f(handles)h(page)f(faults)h(and)g(allo)r(cates)e(memory)h
(on)515 1910 y(demand.)k(It)28 b(is)f(not)h(y)n(et)f(implemen)n(ted.)
515 2042 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 2042 V 29 w(SelfGrowingVRegion)p Fj(.)k
Fk(i)p Fq(\021)598 2134 y Fi(//)39 b(Handles)i(page)f(faults)598
2225 y(err_t)g(pg_fault\(off_PgFltReq)k(*pgf\))c({)676
2316 y(assert\(pgf\);)676 2408 y(\(void\)pgf;)676 2499
y(do_debug\(kcout)j(<<)c("page)i(fault)f(on)g(kernel)g(stack)h(not)f
(supported.")h(<<)f(nl\);)676 2590 y(panic\("no)h(growing)g(kernel)g
(stacks)f(yet."\);)676 2682 y(return)h(ENOSYS;)598 2773
y(})515 2947 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l
(gion)h(dep)l(endencies.)g Fk(i)p Fz(+)o Fq(\021)598
3039 y Fi(#include)41 b(<klib/mdep/debug.h>)161 b(//)40
b(for)g(do_debug)515 3296 y FA(Splitting)30 b(memory)f(in)m(to)j
(regions)515 3449 y Fz(After)e(the)h(k)n(ernel)e(is)h(loaded,)g(the)h
(remaining)e(virtual)g(address)g(space)g(of)i(the)f(k)n(ernel)f(is)515
3549 y(assigned)i(to)h(a)f(p)r(oten)n(tial)h(set)h(of)f
Fx(NREGS)p 1841 3549 27 4 v 29 w(MAX)f Fz(\(gro)n(wing\))g(regions.)49
b(These)31 b(regions)g(are)515 3648 y(created)c(b)n(y)g(requesting)g(a)
g(new)g(region)g(of)g(a)g(certain)g(kind)h(to)g(the)g
Fx(KVM)p Fz(.)515 3781 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3781 24 4 v 29 w(KVM)p Fj(.)g Fk(i)p Fz(+)p
Fq(\021)598 3873 y Fi(//)39 b(Creates)i(a)f(region)g(of)g(the)g
(specified)h(kind)f(and)g(returns)h(its)598 3964 y(//)e(starting)i
(\(kernel)g(virtual\))g(address.)598 4055 y(//)e(The)h(region)h(is)f
(for)g(a)f(kernel)i(stack)f(unless)h(otherwise)g(specified.)598
4147 y(//)e(\(Name)i(is)e(not)h(copied!\))598 4238 y(off_KVMRegion)i
(*create_region\(const)i(char)c(*name="reg"\);)598 4329
y(off_GrowingRegion)j(*create_kstack\(const)h(char)c(*name="stk"\);)
1885 5255 y Fz(729)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
730 731 bop 639 523 a Fz(When)31 b(ev)n(ery)e(k)n(ernel)g(allo)r(cator)
f(has)i(b)r(een)g(started)g(new)g(regions)e(are)h(created)g(only)515
623 y(for)e(up)i(to)f Fx(NKSTKS)p 1134 623 27 4 v 29
w(MAX)f Fz(k)n(ernel)g(stac)n(ks.)38 b(Besides,)28 b(SMP)g(supp)r(ort)g
(migh)n(t)g(require)f(these)515 722 y(stac)n(ks)e(to)g(b)r(e)i(aligned)
e(to)h(a)g(b)r(oundary)f(of)h Fx(MDEP)p 2068 722 V 30
w(KSTK)p 2274 722 V 29 w(MAX)f Fz(b)n(ytes)h(\(see)g(section)f
(5.1.16\).)639 822 y(In)38 b(an)n(y)f(case,)j(T)-7 b(o)37
b(determine)h(the)g(region)f(la)n(y)n(outs,)i(the)f Fx(KVM)f
Fz(calls)g Fx(fix)p 3049 822 V 30 w(regions)515 922 y
Fz(when)28 b(it)g(is)f(started.)515 1040 y Fk(h)p Fj(Other)h(private)h
(metho)l(ds)g(of)e Fi(off)p 1529 1040 24 4 v 29 w(KVM)p
Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1132 y Fi(//)39 b(Fix)h(starting)h
(addresses)h(and)e(length)g(for)g(kernel)h(regions.)598
1223 y(void)79 b(fix_regions\(void\);)515 1369 y Fk(h)p
Fj(Initialize)26 b(KVM)h(r)l(e)l(gions)i(starting)g(at)g
Fi(end)f Fj(with)f Fi(dtlb)p 2186 1369 V 29 w(support)p
Fj(.)i Fk(i)p Fq(\021)598 1460 y Fi(fix_regions\(\);)639
1587 y Fz(T)-7 b(o)25 b(implemen)n(t)g(it)g(w)n(e)g(need)g(to)g(no)n(w)
f(ho)n(w)g(m)n(uc)n(h)h(\(k)n(ernel)f(virtual\))h(memory)f(is)g(a)n(v)
-5 b(ail-)515 1687 y(able.)36 b(The)28 b Fx(kvm)e Fz(uses)i(these)f
(metho)r(ds)h(to)g(calculate)e(that.)515 1806 y Fk(h)p
Fj(Other)i(private)h(metho)l(ds)g(of)e Fi(off)p 1529
1806 V 29 w(KVM)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598 1897
y Fi(//)39 b(How)h(much)g(memory)h(available)g(for)f(kernel)h(usage?)
598 1988 y(vm_size_t)g(get_kavail\(void\);)639 2115 y
Fz(In)28 b(turn,)g(it)g(uses)f(this)h(other.)515 2225
y Fk(h)p Fj(Other)g(private)h(metho)l(ds)g(of)e Fi(off)p
1529 2225 V 29 w(KVM)p Fj(.)h Fk(i)p Fz(+)o Fq(\021)598
2316 y Fi(//)39 b(Where)i(does)f(our)g(KVM)g(ends?)598
2407 y(vm_offset_t)h(get_kmax\(void\);)639 2525 y Fz(When)36
b(using)f(virtual)g(memory)g(w)n(e)g(ha)n(v)n(e)g(from)g
Fx(k)p 2304 2525 27 4 v 31 w(end)f Fz(up)i(to)f(the)h(k)n(ernel)f
(virtual)515 2624 y(address)29 b(space)h(end,)h(otherwise)f(w)n(e)g
(are)g(limited)h(b)n(y)f(the)h(ph)n(ysical)f(core)f(size.)45
b(If)31 b(there)515 2724 y(is)25 b(no)h Ft(dtlb)f Fz(supp)r(ort,)h(w)n
(e)g(stic)n(k)f(to)h(a)f(p)r(ercen)n(tage)f(of)i(the)g(remaining)f(ph)n
(ysical)g(memory)515 2824 y(whic)n(h)i(is)h(assigned)e(to)i(the)g(k)n
(ernel.)515 2942 y Fk(h)p Fi(off)p 667 2942 24 4 v 29
w(KVM::get)p 1008 2942 V 30 w(kavail)g Fj(implementation.)g
Fk(i)p Fq(\021)598 3034 y Fi(//)39 b(How)h(much)g(memory)h(available)g
(for)f(kernel)h(usage?)598 3125 y(vm_size_t)g
(off_KVM::get_kavail\(void\))598 3216 y({)676 3308 y(return)g
(get_kmax\(\))g(-)f(k_end;)598 3399 y(})515 3636 y Fk(h)p
Fi(off)p 667 3636 V 29 w(KVM::get)p 1008 3636 V 30 w(kmax)28
b Fj(implementation.)f Fk(i)p Fq(\021)598 3728 y Fi(//)39
b(Where)i(does)f(our)g(KVM)g(ends?)598 3819 y(vm_offset_t)h
(off_KVM::get_kmax\(void\))598 3910 y({)676 4002 y(static)g
(vm_offset_t)h(at=0;)676 4093 y(if)e(\(at\))755 4184
y(return)g(at;)676 4276 y(if)g(\(k_hasdtlb\))715 4367
y(at=)g(OFF_USER_VM_START;)676 4458 y(else)715 4550 y
(at=k_end+off_MBank::get_cor)q(esize)q(\(\)/O)q(FF_K)q(ERN_M)q(EM_F)q
(RAC;)676 4641 y(at)g(=)79 b(off_MBank::ptrunc\(at\)+off_MBank)q(::pm)q
(ask\(\))q(;)676 4824 y(return)41 b(at;)598 4915 y(})1885
5255 y Fz(730)p eop
PStoPSsaved restore
%%Page: (732,733) 367
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
731 732 bop 515 523 a Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g
(manager)h(implementation)f(dep)l(endencies.)h Fk(i)p
Fz(+)p Fq(\021)598 614 y Fi(#include)41 b(<hw/MBank.h>)434
b(//)40 b(for)g(off_MBank)598 706 y(#include)h(<dmm/mdep/mKVM.h>)239
b(//)40 b(for)g(OFF_USER_VM_START)j(et)c(al.)639 847
y Fz(Where)21 b Fx(OFF)p 1035 847 27 4 v 30 w(USER)p
1241 847 V 30 w(VM)p 1359 847 V 30 w(START)e Fz(is)i(the)g(\014rst)g
(user)f(virtual)h(address)e(\(whic)n(h)i(determines)515
946 y(the)26 b(end)g(of)g(the)g(k)n(ernel)f(virtual)g(address)f
(space\))i(and)f Fx(OFF)p 2399 946 V 30 w(KERN)p 2605
946 V 30 w(MEM)p 2767 946 V 30 w(FRAC)f Fz(is)i(the)g(frac-)515
1046 y(tion)h(of)h(memory)f(to)g(b)r(e)h(consumed)f(b)n(y)h(the)g(k)n
(ernel.)36 b(Both)27 b(things)h(are)e(system)i(limits.)515
1179 y Fk(h)p Fj(O\013)f(limits.)f Fk(i)p Fz(+)p Fq(\021)598
1270 y Fi(const)40 b(int)354 b(OFF_KERN_MEM_FRAC=8;)318
b(//)40 b(1/8)g(memory)g(for)g(the)g(kernel.)639 1411
y Fz(W)-7 b(e)28 b(\014rst)g(divide)f(the)h(a)n(v)-5
b(ailable)27 b(memory)g(in)n(to)g(the)h(total)f(n)n(um)n(b)r(er)h(of)f
(regions,)g(then)515 1511 y(w)n(e)e(reserv)n(e)g(the)h(last)g
Fx(NKSTKS)p 1478 1511 V 29 w(MAX)e Fz(blo)r(c)n(ks)i(\()p
Fx(MDEP)p 2122 1511 V 30 w(KSTK)p 2328 1511 V 29 w(MAX)p
Fz(-aligned;)f(ma)n(yb)r(e\))h(for)f(k)n(er-)515 1611
y(nel)f(stac)n(ks)g(and)g(store)f(in)i(three)f(new)h(mem)n(b)r(ers)f
(the)g(address)g(for)g(the)g(\014rst)g(k)n(ernel)g(stac)n(k,)515
1710 y(the)36 b(maxim)n(um)f(n)n(um)n(b)r(er)h(of)g(k)n(ernel)e(stac)n
(ks,)j(and)f(the)g(starting)f(address)f(for)h(the)h(\014rst)515
1810 y(k)n(ernel)26 b(stac)n(k.)515 1943 y Fk(h)p Fj(Other)i(private)h
(memb)l(ers)f(of)g Fi(off)p 1552 1943 24 4 v 29 w(KVM)p
Fj(.)f Fk(i)p Fz(+)p Fq(\021)598 2034 y Fi(vm_offset_t)41
b(k_stack0;)434 b(//)40 b(low)g(address)g(for)g(the)g(first)h(kernel)f
(stack.)598 2125 y(natural_t)119 b(k_nstacks;)395 b(//)40
b(Max)g(#)f(of)h(OFF_MDEP_KSTK_MAX-sized)k(kern.)d(stcks)598
2217 y(vm_size_t)119 b(k_rsize;)473 b(//)40 b(Size)g(of)g(non)f(stack)i
(regions.)515 2391 y Fk(h)p Fi(off)p 667 2391 V 29 w(KVM::fix)p
1008 2391 V 30 w(regions)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 2482 y Fi(//)39 b(Determines)j(the)e(starting)h(address)g
(for)f(a)f(new)h(region.)598 2574 y(void)g
(off_KVM::fix_regions\(void\))598 2665 y({)676 2756 y(vm_size_t)120
b(avail;)676 3030 y(if)40 b(\(k_hasdtlb\))755 3122 y
(k_end=off_MBank::get_coresize\(\))q(;)676 3213 y(else)755
3304 y(k_end=off_MBank::pround\(k_end\);)676 3487 y(avail=)h
(get_kavail\(\);)676 3578 y(k_rsize=off_MBank::ptrunc\(av)q(ail/O)q
(FF_N)q(REGS)q(_MAX\))q(;)676 3761 y Fk(h)p Fj(Determine)28
b Fi(k)p 1128 3761 V 29 w(nstacks)h Fj(and)f Fi(k)p 1647
3761 V 28 w(rsize)p Fj(.)h Fk(i)676 3852 y Fi(if)40 b(\(!k_nstacks\))
755 3944 y(panic\("No)h(memory)g(for)e(kernel)i(stacks"\);)676
4035 y(assert\(k_nstacks\);)676 4126 y Fk(h)p Fj(Determine)28
b Fi(k)p 1128 4126 V 29 w(stack0)p Fj(.)g Fk(i)676 4218
y Fi(if)40 b(\(k_stack0+OFF_MDEP_KSTK_MAX)45 b(>)40 b(get_kmax\(\)\))
755 4309 y(panic\("No)h(memory)g(for)e(even)i(a)e(single)i(kernel)f
(stack."\);)676 4400 y(assert\(k_nstacks>=1\);)598 4583
y(})1885 5255 y Fz(731)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
732 733 bop 639 523 a Fz(The)24 b(n)n(um)n(b)r(er)g(of)f(k)n(ernel)g
(stac)n(ks)g(is)h(set)f(initially)h(to)g Fx(NKSTKS)p
2553 523 27 4 v 29 w(MAX)p Fz(,)e(and)i(then)g(reduced)515
623 y(un)n(til)k(w)n(e)f(are)g(sure)g(that)g(eac)n(h)g(region)g(can)g
(b)r(e)h(at)f(least)g Fx(MDEP)p 2505 623 V 30 w(KSTK)p
2711 623 V 30 w(MSK)p Fz(.)515 756 y Fk(h)p Fj(Determine)h
Fi(k)p 967 756 24 4 v 28 w(nstacks)i Fj(and)e Fi(k)p
1486 756 V 28 w(rsize)p Fj(.)g Fk(i)p Fq(\021)598 847
y Fi(for\(k_nstacks=OFF_NKSTKS_MAX;)46 b(k_nstacks)41
b(&&)f(k_rsize)g(<)g(OFF_MDEP_KSTK_MAX;)755 938 y(k_nstacks--\){)676
1029 y(k_rsize=off_MBank::ptrunc\(av)q(ail/\()q(OFF_)q(NKBL)q(KS_MA)q
(X+k_)q(nstac)q(ks\)\))q(;)598 1121 y(})639 1262 y Fz(The)e(\014rst)g
(stac)n(k)f(\(lo)n(w)g(address\))g(will)h(start)f(after)h(reserving)e
(\(virtual\))i(space)f(for)515 1362 y(non-stac)n(k)30
b(regions)h(\(whic)n(h)h(can)f(b)r(e)i(up)f(to)g Fx(NKBLKS)p
2227 1362 27 4 v 29 w(MAX)p Fz(\).)f(F)-7 b(or)31 b(aligned)g(k)n
(ernel)g(stac)n(ks)515 1461 y(w)n(e)c(m)n(ust)h(also)e(align)h(it.)515
1577 y Fk(h)p Fj(Determine)h Fi(k)p 967 1577 24 4 v 28
w(stack0)h Fj(for)f(aligne)l(d)g(stacks.)h Fk(i)o Fq(\021)598
1669 y Fi(k_stack0=)41 b(\(\(k_end+OFF_NKBLKS_MAX*k_rsiz)q(e\))k(+)40
b(OFF_MDEP_KSTK_MSK\))676 1760 y(&)g(~OFF_MDEP_KSTK_MSK;)639
1885 y Fz(F)-7 b(or)27 b(non-aligned)g(stac)n(ks)f(it)i(is)g(simpler.)
515 2001 y Fk(h)p Fj(Determine)g Fi(k)p 967 2001 V 28
w(stack0)p Fj(.)h Fk(i)p Fq(\021)598 2092 y Fi({)676
2183 y(k_stack0=\(register_t\)\(k_end+)q(OFF_N)q(KBLK)q(S_MA)q(X*k_r)q
(size)q(\);)598 2275 y(})639 2399 y Fz(Finally)-7 b(,)28
b(if)g(stac)n(ks)e(w)n(ere)g(aligned)h(w)n(e)g(should)g(adjust)h
Fx(k)p 2422 2399 27 4 v 31 w(nstacks)c Fz(and)j Fx(k)p
2990 2399 V 31 w(stack0)e Fz(to)515 2499 y(b)r(e)j(user)f(w)n(e)g(ha)n
(v)n(e)f(enough)h(aligned)g(space.)515 2615 y Fk(h)p
Fj(A)l(djust)h Fi(k)p 830 2615 24 4 v 28 w(nstacks)h
Fj(and)f Fi(k)p 1348 2615 V 29 w(stack0)h Fj(due)f(to)g(alignment)g(c)l
(onstr)l(aints.)h Fk(i)p Fq(\021)598 2707 y Fi
(avail=get_kmax\(\)-\(k_stack0+OFF)q(_MDEP)q(_KST)q(K_MA)q(X\);)598
2798 y(kstack_end=get_kmax\(\))44 b(&)39 b(~OFF_MDEP_KSTK_MSK;)598
2889 y(k_nstacks)i(=)e(\(kstack_end)j(-)e(k_stack0\))h(/)e
(OFF_MDEP_KSTK_MAX;)639 3014 y Fz(Once)33 b(limits)g(are)f(\014xed)g
(the)i Fx(KVM)d Fz(can)i(instan)n(tiate)f(new)h(regions.)51
b(First)32 b(it)i(will)f(b)r(e)515 3113 y(ask)n(ed)26
b(for)h(up)h(to)g Fx(OFF)p 1227 3113 27 4 v 30 w(NKBLKS)p
1521 3113 V 29 w(MAX)e Fz(generic)h(regions,)f(then)i(up)g(to)f
Fx(k)p 2749 3113 V 31 w(nstacks)p Fz(.)639 3213 y(These)35
b(metho)r(ds)f(are)g(handy)g(to)h(determine)g(the)g(starting)e(address)
h(and)g(limit)i(for)515 3313 y(regions)26 b(b)r(eing)h(created.)515
3429 y Fk(h)p Fj(Other)h(private)h(metho)l(ds)g(of)e
Fi(off)p 1529 3429 24 4 v 29 w(KVM)p Fj(.)h Fk(i)p Fz(+)o
Fq(\021)598 3520 y Fi(//)39 b(Determines)j(the)e(starting)h(address)g
(for)f(a)f(new)h(region.)598 3611 y(vm_offset_t)h
(fix_region_start\(void\);)598 3703 y(//)e(Determines)j(the)e(limit)g
(\(size\))h(for)f(a)f(new)h(region.)598 3794 y(vm_size_t)h
(fix_region_limit\(void\))j(const;)598 3885 y(//)39 b(Determines)j(the)
e(starting)h(address)g(for)f(a)f(new)h(kernel)h(stack.)598
3977 y(vm_offset_t)g(fix_stack_start\(void\);)598 4068
y(//)e(Determines)j(the)e(limit)g(\(size\))h(for)f(a)f(new)h(kernel)h
(stack.)598 4159 y(vm_size_t)g(fix_stack_limit\(void\))j(const;)1885
5255 y Fz(732)p eop
PStoPSsaved restore
%%Page: (734,735) 368
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
733 734 bop 639 523 a Fz(Eac)n(h)26 b(new)i(region)e(will)h(start)g
(either)g(at)g Fx(k)p 2005 523 27 4 v 31 w(end)f Fz(or)h
Fx(k)p 2340 523 V 31 w(stack0)p Fz(;)e(and)i Fx(k)p 2888
523 V 31 w(end)f Fz(adjusted)515 623 y(past)h(the)h(limit)g(of)g(that)g
(region.)515 756 y Fk(h)p Fi(off)p 667 756 24 4 v 29
w(KVM::fix)p 1008 756 V 30 w(region)p 1272 756 V 29 w(start)h
Fj(implementation.)e Fk(i)p Fq(\021)598 847 y Fi(//)39
b(Determines)j(the)e(starting)h(address)g(for)f(a)f(new)h(region.)598
938 y(vm_offset_t)h(off_KVM::fix_region_start\(v)q(oid\))598
1029 y({)676 1121 y(vm_offset_t)h(start=k_end;)676 1212
y(k_end)f(+=)e(k_rsize;)676 1303 y(return)i(start;)598
1395 y(})515 1660 y Fk(h)p Fi(off)p 667 1660 V 29 w(KVM::fix)p
1008 1660 V 30 w(stack)p 1233 1660 V 29 w(start)29 b
Fj(implementation.)e Fk(i)p Fq(\021)598 1752 y Fi(//)39
b(Determines)j(the)e(starting)h(address)g(for)f(a)f(new)h(kernel)h
(stack.)598 1843 y(vm_offset_t)g(off_KVM::fix_stack_start\(vo)q(id\))
598 1934 y({)676 2026 y(vm_offset_t)h(start=k_stack0;)676
2117 y(k_stack0)f(+=)f(OFF_MDEP_KSTK_MAX;)676 2208 y(return)h(start;)
598 2300 y(})515 2565 y Fk(h)p Fi(off)p 667 2565 V 29
w(KVM::fix)p 1008 2565 V 30 w(region)p 1272 2565 V 29
w(limit)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
2657 y Fi(//)39 b(Determines)j(the)e(limit)g(\(size\))h(for)f(a)f(new)h
(region.)598 2748 y(vm_size_t)h(off_KVM::fix_region_limit\(voi)q(d\))k
(const)598 2839 y({)676 2931 y(return)c(k_rsize;)598
3022 y(})515 3288 y Fk(h)p Fi(off)p 667 3288 V 29 w(KVM::fix)p
1008 3288 V 30 w(stack)p 1233 3288 V 29 w(limit)29 b
Fj(implementation.)e Fk(i)p Fq(\021)598 3379 y Fi(//)39
b(Determines)j(the)e(limit)g(\(size\))h(for)f(a)f(new)h(stack.)598
3470 y(vm_size_t)h(off_KVM::fix_stack_limit\(void)q(\))k(const)598
3562 y({)676 3653 y(return)c(OFF_MDEP_KSTK_MAX;)598 3744
y(})1885 5255 y Fz(733)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
734 735 bop 639 523 a Fz(No)n(w)27 b(w)n(e)h(can)f(implemen)n(t)h
Fx(create)p 1780 523 27 4 v 29 w(region)d Fz(and)j Fx(create)p
2524 523 V 28 w(kstack)p Fz(.)515 656 y Fk(h)p Fi(off)p
667 656 24 4 v 29 w(KVM::create)p 1125 656 V 30 w(region)h
Fj(implementation.)f Fk(i)o Fq(\021)598 747 y Fi(//)39
b(Creates)i(a)f(region)g(of)g(the)g(specified)h(kind)f(and)g(returns)h
(its)598 839 y(//)e(starting)i(\(kernel)g(virtual\))g(address.)598
930 y(//)e(\(Name)i(is)e(not)h(copied!\))598 1021 y(off_KVMRegion)i
(*off_KVM::create_region\(const)k(char)40 b(*name\))598
1112 y({)676 1204 y(vm_offset_t)i(start;)676 1295 y(vm_size_t)120
b(sz;)676 1478 y(start)41 b(=)e(fix_region_start\(\);)676
1569 y(sz)158 b(=)39 b(fix_region_limit\(\);)676 1660
y(if)h(\(k_hasdtlb\))755 1752 y(k_regions[k_nregions]=)k(new)c
(off_GrowingVRegion\(start,sz,na)q(me\);)676 1843 y(else)755
1934 y(k_regions[k_nregions]=)k(new)c(off_GrowingPRegion\(start,sz,na)q
(me\);)676 2026 y(assert)h(\(k_regions[k_nregions]!=NULL\);)676
2117 y(return)g(k_regions[k_nregions++];)598 2208 y(})515
2474 y Fk(h)p Fi(off)p 667 2474 V 29 w(KVM::create)p
1125 2474 V 30 w(kstack)29 b Fj(implementation.)f Fk(i)o
Fq(\021)598 2565 y Fi(//)39 b(Creates)i(a)f(region)g(of)g(the)g
(specified)h(kind)f(and)g(returns)h(its)598 2657 y(//)e(starting)i
(\(kernel)g(virtual\))g(address.)598 2748 y(off_GrowingRegion)i
(*off_KVM::create_kstack\(const)j(char)40 b(*name\))598
2839 y({)676 2931 y(off_GrowingRegion)j(*g;)676 3022
y(vm_offset_t)f(start=fix_stack_start\(\);)676 3113 y(vm_size_t)120
b(sz=fix_stack_limit\(\);)676 3205 y(if)40 b(\(k_hasdtlb\))755
3296 y(g=new)g(off_SelfGrowingVRegion\(start,)q(sz,n)q(ame,o)q(ff_m)q
(depSt)q(ck::)q(grow)q(s_to_)q(righ)q(t\(\)\);)676 3387
y(else)755 3479 y(g=new)g(off_SelfGrowingPRegion\(start,)q(sz,n)q
(ame,o)q(ff_m)q(depSt)q(ck::)q(grow)q(s_to_)q(righ)q(t\(\)\);)676
3570 y(assert)h(\(g!=NULL\);)676 3661 y(k_regions[k_nregions++]=g;)676
3753 y(return)g(g;)598 3844 y(})515 4018 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 4110 y Fi(#include)41 b(<klib/mdep/mStck.h>)
639 4251 y Fz(The)28 b Fx(KVM)e Fz(itself)i(instan)n(tiates)f(an)h
(initial)g(region)e(for)h(dynamic)g(memory)-7 b(.)515
4367 y Fk(h)p Fj(Initialize)26 b(KVM)h(r)l(e)l(gions)i(starting)g(at)g
Fi(end)f Fj(with)f Fi(dtlb)p 2186 4367 V 29 w(support)p
Fj(.)i Fk(i)p Fz(+)o Fq(\021)598 4458 y Fi(create_region\("kalloc"\);)
1885 5255 y Fz(734)p eop
PStoPSsaved restore
%%Page: (736,737) 369
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
735 736 bop 515 523 a FA(User)32 b(memory)515 676 y Fz(When)c(no)g
(virtual)f(memory)g(is)h(a)n(v)-5 b(ailable,)27 b(user)g(memory)h
(should)f(b)r(e)i(allo)r(cated)e(from)g(a)515 776 y(sp)r(eci\014c)k
(memory)f(region.)45 b(Suc)n(h)31 b(region)f(is)h(created)f(to)h(co)n
(v)n(er)e(the)i(preferred)f(memory)515 876 y(ranges)c(for)h(user)g
(data.)515 1008 y Fk(h)p Fj(Initialize)f(KVM)h(r)l(e)l(gions)i
(starting)g(at)g Fi(end)f Fj(with)f Fi(dtlb)p 2186 1008
24 4 v 29 w(support)p Fj(.)i Fk(i)p Fz(+)o Fq(\021)598
1100 y Fi(assert\(k_nregions==OFF_KVM_RUS)q(R\);)598
1191 y(k_regions[k_nregions++]=)44 b(new)c
(off_NullFaultingRegion\(get_k)q(max\()q(\),)1696 1282
y(\(vm_offset_t\)-1,"usr"\);)515 1540 y FA(Kernel)31
b(page)h(allo)s(cator)f Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515
1693 y Fz(The)18 b(k)n(ernel)g(page)f(allo)r(cator)g(is)h(k)n(ept)g(in)
h Fx(dmm/KPgAllocator)o(.h)12 b Fz(and)18 b Fx(dmm/KPgAllocator)o(.C)p
Fz(.)515 1826 y Fk(h)p Fj(KPgA)n(l)t(lo)l(c)l(ator.h*)11
b Fk(i)q Fq(\021)598 1917 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2008 y Fi(#ifndef)41 b(__OFF_K_PG_ALLOCATOR_H)598 2100
y(#define)g(__OFF_K_PG_ALLOCATOR_H)j(1)598 2282 y Fk(h)p
Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l(c)l(ator)f(dep)l(endencies.)
i Fk(i)598 2465 y Fi(#ifdef)40 b(__KERNEL__)598 2556
y Fk(h)p Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l(c)l(ator.)f
Fk(i)598 2648 y Fi(#endif)40 b(//)g(__KERNEL__)598 2922
y(#endif)g(//)g(__OFF_K_PG_ALLOCATOR_H)515 3096 y Fk(h)p
Fj(KPgA)n(l)t(lo)l(c)l(ator.C*)11 b Fk(i)p Fq(\021)598
3187 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3370 y Fi(#include)41
b(<dmm/KPgAllocator.h>)122 b(//)40 b(exported)h(interface.)598
3461 y Fk(h)p Fj(O\013)27 b(kernel)h(p)l(age)h(al)t(lo)l(c)l(ator)f
(implementation)g(dep)l(endencies.)i Fk(i)598 3644 y(h)p
Fi(off)p 750 3644 V 29 w(KPgAllocator::off)p 1442 3644
V 32 w(KPgAllocator)g Fj(implementation.)d Fk(i)598 3735
y(h)p Fi(off)p 750 3735 V 29 w(KPgAllocator::reconsider)32
b Fj(implementation.)c Fk(i)598 3827 y(h)p Fi(off)p 750
3827 V 29 w(KPgAllocator::find)p 1481 3827 V 32 w(range)g
Fj(implementation.)g Fk(i)598 3918 y(h)p Fi(off)p 750
3918 V 29 w(KPgAllocator::alloc)j Fj(implementation.)d
Fk(i)598 4009 y(h)p Fi(off)p 750 4009 V 29 w(KPgAllocator::free)j
Fj(implementation.)d Fk(i)1885 5255 y Fz(735)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
736 737 bop 515 523 a Fn(5.5.3)112 b(Region)37 b(iteration)515
676 y Fz(KVM)26 b(users)e(can)i(iterate)f(through)g(KVM)h(regions)e
(using)i(a)f Fx(KVMItr)p Fz(.)34 b(The)26 b(iterator)e(can)515
776 y(b)r(e)k(initially)f(placed)h(at)f(the)h(v)n(ery)f(\014rst)g
(region)f(or)h(at)g(a)h(named)f(region.)515 897 y Fk(h)p
Fj(O\013)g(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h(iter)l(ator.)g
Fk(i)o Fq(\021)598 988 y Fi(//)39 b(A)h(KVM)g(region)g(interator.)598
1079 y(//)598 1171 y(class)g(off_KVMItr)i({)598 1262
y(private:)676 1353 y(natural_t)f(i_reg;)598 1445 y(public:)676
1536 y(//)f(Creates)h(a)e(KVMItr)676 1627 y(off_KVMItr\(natural_t)44
b(at=OFF_KVM_RNULL\))f(:)d(i_reg\(at\))h({;})676 1810
y(//)f(Compare)h(iterator)g(positions.)676 1901 y(int)f
(operator==\(const)j(off_KVMItr)e(nd\))f(const)h({return)g(i_reg)f(==)g
(nd.i_reg;)h(})676 1993 y(int)f(operator!=\(const)j(off_KVMItr)e(nd\))f
(const)h({return)g(i_reg)f(!=)g(nd.i_reg;)h(})676 2084
y(int)f(is_null\(void\))i(const)f({)e(return)i(i_reg)f(==)g
(OFF_KVM_RNONE;)i(})676 2267 y(//)e(get)g(a)f(reference)j(to)d(the)h
(element)h(pointed)g(by)e(the)h(iterator.)676 2358 y(off_KVMRegion)i
(*get_element\(void\){)i(return)d(kvm.get_reg\(i_reg\);)i(})676
2540 y(//)d(Advance)h(iterator.)676 2632 y(off_KVMItr)h
(operator++\(\){)755 2723 y(if)d(\(++i_reg)i(>)f(kvm.get_nregs\(\)\))
833 2814 y(i_reg=OFF_KVM_RNONE;)755 2906 y(return)g(*this;)676
2997 y(})676 3088 y(off_KVMItr)i(operator--\(\){)755
3180 y(if)d(\(!i_reg--\))833 3271 y(i_reg=OFF_KVM_RNONE;)755
3362 y(return)h(*this;)676 3454 y(})676 3636 y(//)g(Advance)h
(iterator.)676 3728 y(off_KVMItr)h(operator++\(int)g(i\){)755
3819 y(off_KVMItr)f(r=*this;)755 3910 y(assert\(!i\);)755
4002 y(if)e(\(++i_reg)i(>)f(kvm.get_nregs\(\)\))833 4093
y(i_reg=OFF_KVM_RNONE;)755 4184 y(return)g(r;)676 4276
y(})676 4367 y(off_KVMItr)i(operator--\(int)g(i\){)755
4458 y(off_KVMItr)f(r=*this;)755 4550 y(if)e(\(!i_reg--\))833
4641 y(i_reg=OFF_KVM_RNONE;)755 4732 y(return)h(r;)676
4824 y(})598 5006 y(};)1885 5255 y Fz(736)p eop
PStoPSsaved restore
%%Page: (738,739) 370
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
737 738 bop 639 664 a Fz(A)28 b(couple)g(of)f(supp)r(ort)g(metho)r(ds)h
(in)g(KVM)g(are)e(needed)i(no)n(w.)515 780 y Fk(h)p Fj(Other)g(pr)l
(ote)l(cte)l(d)j(metho)l(ds)e(of)e Fi(off)p 1594 780
24 4 v 29 w(KVM)p Fj(.)g Fk(i)p Fq(\021)598 872 y Fi(friend)40
b(class)h(off_KVMIter;)598 963 y(inline)f(off_KVMRegion)j
(*get_reg\(natural_t)g(id\);)598 1054 y(inline)d(natural_t)238
b(get_nregs\(void\);)515 1212 y Fk(h)p Fi(off)p 667 1212
V 29 w(KVM::get)p 1008 1212 V 30 w(reg)28 b Fj(implementation.)f
Fk(i)p Fq(\021)598 1303 y Fi(inline)40 b(off_KVMRegion)j
(*off_KVM::get_reg\(natural_t)i(id\))40 b({)676 1395
y(assert\(id)h(<)f(k_nregions\);)676 1486 y(return)h(k_regions[id];)598
1577 y(})515 1843 y Fk(h)p Fi(off)p 667 1843 V 29 w(KVM::get)p
1008 1843 V 30 w(nregs)28 b Fj(implementation.)g Fk(i)p
Fq(\021)598 1934 y Fi(inline)40 b(natural_t)238 b
(off_KVM::get_nregs\(void\))598 2026 y({)676 2117 y(return)41
b(k_nregions;)598 2208 y(})515 2474 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h(iter)l(ator)g(dep)l
(endencies.)g Fk(i)p Fq(\021)598 2565 y Fi(#include)41
b(<dmm/KVM.h>)515 2839 y Fn(5.5.4)112 b(Kernel)37 b(address)h(space)h
(manager)f Fd(C)8 b FC(++)38 b Fn(source)f(\014les)515
2993 y Fz(The)27 b Fx(KVM)g Fz(is)g(k)n(ept)h(in)g Fx(dmm/KVM.h)c
Fz(and)j Fx(dmm/KVM.C)p Fz(.)515 3125 y Fk(h)p Fj(KVM.h*)11
b Fk(i)o Fq(\021)598 3217 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
3308 y Fi(#ifndef)41 b(__OFF_KVM_H)598 3399 y(#define)g(__OFF_KVM_H)598
3582 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(manager)h(dep)l
(endencies.)g Fk(i)598 3765 y(h)p Fj(O\013)e(KVM)g(r)l(e)l(gion)h(numb)
l(ers.)h Fk(i)598 3947 y Fi(#ifdef)40 b(__KERNEL__)598
4039 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(manager.)g
Fk(i)598 4130 y(h)p Fj(O\013)f(KVM)g(exp)l(orte)l(d)j(variables.)e
Fk(i)598 4221 y Fi(#endif)40 b(//)g(__KERNEL__)598 4404
y(#ifdef)g(__KERNEL__)598 4495 y(//)f(KVM)h(inline)h(methods)598
4587 y Fk(h)p Fi(off)p 750 4587 V 29 w(KVM::get)p 1091
4587 V 30 w(nregs)28 b Fj(implementation.)g Fk(i)598
4678 y(h)p Fi(off)p 750 4678 V 29 w(KVM::get)p 1091 4678
V 30 w(reg)g Fj(implementation.)f Fk(i)598 4769 y Fi(#endif)40
b(//)g(__KERNEL__)598 4952 y(#endif)g(//)g(__OFF_KVM_H)1885
5255 y Fz(737)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
738 739 bop 515 523 a Fk(h)p Fj(KVM.C*)11 b Fk(i)o Fq(\021)598
614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 797 y Fi(#include)41 b(<dmm/KVM.h>)473
b(//)40 b(Exported)h(interface.)598 888 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(manager)h(implementation)f(dep)l
(endencies.)h Fk(i)598 1071 y(h)p Fi(off)p 750 1071 24
4 v 29 w(KVM)f Fj(static)g(memb)l(ers.)h Fk(i)598 1162
y(h)p Fj(O\013)e(KVM)g(instanc)l(e.)i Fk(i)598 1345 y(h)p
Fj(O\013)e(kernel)h(virtual)g(memory)g(manager)h(static)g(memb)l(ers.)f
Fk(i)598 1436 y(h)p Fi(off)p 750 1436 V 29 w(KVM::off)p
1091 1436 V 30 w(KVM)g Fj(implementation.)f Fk(i)598
1528 y(h)p Fi(off)p 750 1528 V 29 w(KVM::start)i Fj(implementation.)f
Fk(i)598 1619 y(h)p Fi(off)p 750 1619 V 29 w(KVM::get)p
1091 1619 V 30 w(kavail)g Fj(implementation.)g Fk(i)598
1710 y(h)p Fi(off)p 750 1710 V 29 w(KVM::find)p 1130
1710 V 30 w(region)h Fj(implementation.)e Fk(i)598 1802
y(h)p Fi(off)p 750 1802 V 29 w(KVM::fix)p 1091 1802 V
30 w(regions)i Fj(implementation.)e Fk(i)598 1893 y(h)p
Fi(off)p 750 1893 V 29 w(KVM::fix)p 1091 1893 V 30 w(region)p
1355 1893 V 29 w(start)i Fj(implementation.)e Fk(i)598
1984 y(h)p Fi(off)p 750 1984 V 29 w(KVM::fix)p 1091 1984
V 30 w(stack)p 1316 1984 V 29 w(start)i Fj(implementation.)e
Fk(i)598 2076 y(h)p Fi(off)p 750 2076 V 29 w(KVM::fix)p
1091 2076 V 30 w(region)p 1355 2076 V 29 w(limit)i Fj(implementation.)e
Fk(i)598 2167 y(h)p Fi(off)p 750 2167 V 29 w(KVM::fix)p
1091 2167 V 30 w(stack)p 1316 2167 V 29 w(limit)i Fj(implementation.)e
Fk(i)598 2258 y(h)p Fi(off)p 750 2258 V 29 w(KVM::create)p
1208 2258 V 30 w(region)i Fj(implementation.)f Fk(i)598
2350 y(h)p Fi(off)p 750 2350 V 29 w(KVM::create)p 1208
2350 V 30 w(kstack)h Fj(implementation.)f Fk(i)598 2441
y(h)p Fi(off)p 750 2441 V 29 w(KVM::get)p 1091 2441 V
30 w(kmax)g Fj(implementation.)f Fk(i)598 2623 y(h)p
Fi(off)p 750 2623 V 29 w(KVM::raw)p 1091 2623 V 30 w(pg)p
1199 2623 V 28 w(alloc)i Fj(and)f Fi(free)g Fj(implementation.)g
Fk(i)598 2715 y(h)p Fi(off)p 750 2715 V 29 w(KVM::pg)p
1052 2715 V 29 w(alloc)h Fj(implementation.)e Fk(i)598
2806 y(h)p Fi(off)p 750 2806 V 29 w(KVM::pg)p 1052 2806
V 29 w(free)i Fj(implementation.)e Fk(i)598 2897 y(h)p
Fi(off)p 750 2897 V 29 w(KVM::pg)p 1052 2897 V 29 w(fault)i
Fj(implementation.)e Fk(i)598 3080 y(h)p Fi(off)p 750
3080 V 29 w(KVM::operator<<)j Fj(implementation.)e Fk(i)1885
5255 y Fz(738)p eop
PStoPSsaved restore
%%Page: (740,741) 371
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
739 740 bop 639 523 a Fz(Kernel)27 b(region)f(co)r(de)i(is)f(in)h
Fx(dmm/KVMRegion.h)22 b Fz(and)27 b Fx(dmm/KVMRegion.C)p
Fz(.)515 656 y Fk(h)p Fj(KVMR)l(e)l(gion.h*)11 b Fk(i)p
Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y Fi(#ifndef)41
b(__OFF_KVM_REGION_H)598 930 y(#define)g(__OFF_KVM_REGION_H)i(1)598
1112 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h
(dep)l(endencies.)g Fk(i)598 1295 y Fi(#ifdef)40 b(__KERNEL__)598
1386 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l(gion.)g
Fk(i)598 1478 y(h)p Fj(O\013)f(\014xe)l(d)h(and)g(faulting)g(kernel)g
(virtual)g(memory)g(r)l(e)l(gion.)g Fk(i)598 1569 y(h)p
Fj(O\013)f(r)l(esize)l(able)i(kernel)f(virtual)g(memory)g(r)l(e)l
(gion.)g Fk(i)598 1660 y(h)p Fj(O\013)f(self)g(r)l(esize)l(able)i
(kernel)g(virtual)f(memory)g(r)l(e)l(gion.)g Fk(i)598
1752 y Fi(#endif)40 b(//)g(__KERNEL__)598 1934 y(#ifdef)g(__KERNEL__)
598 2026 y Fk(h)p Fi(off)p 750 2026 24 4 v 29 w(KVMRegion::get)p
1325 2026 V 31 w(start)29 b Fj(and)f Fi(get)p 1846 2026
V 28 w(end)h Fj(implementation.)e Fk(i)598 2117 y(h)p
Fi(off)p 750 2117 V 29 w(GrowingRegion::grow)p 1520 2117
V 32 w(fits)h Fj(implementation.)g Fk(i)598 2208 y(h)p
Fi(off)p 750 2208 V 29 w(GrowingRegion::grow)p 1520 2208
V 32 w(start)h Fj(implementation.)e Fk(i)598 2300 y(h)p
Fi(off)p 750 2300 V 29 w(GrowingRegion::get)p 1481 2300
V 32 w(start)h Fj(and)g Fi(get)p 2002 2300 V 29 w(end)g
Fj(implementation.)g Fk(i)598 2391 y Fi(#endif)40 b(//)g(__KERNEL__)598
2665 y(#endif)g(//)g(__OFF_KVM_REGION_H)515 2839 y Fk(h)p
Fj(KVMR)l(e)l(gion.C*)11 b Fk(i)o Fq(\021)598 2931 y
Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 3113 y Fi(#include)41 b(<dmm/KVMRegion.h>)239
b(//)40 b(Exported)h(interface.)598 3205 y Fk(h)p Fj(O\013)27
b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h(implementation)f(dep)l
(endencies.)h Fk(i)598 3387 y(h)p Fi(off)p 750 3387 V
29 w(KVMRegion)g Fj(static)g(memb)l(ers.)f Fk(i)598 3570
y(h)p Fi(off)p 750 3570 V 29 w(KVMRegion::off)p 1325
3570 V 31 w(KVMRegion)h Fj(implementation.)f Fk(i)598
3661 y(h)p Fi(off)p 750 3661 V 29 w(NullFaultingRegion::off)p
1676 3661 V 33 w(NullFaultingRegion)k Fj(implementation.)27
b Fk(i)598 3753 y(h)p Fi(off)p 750 3753 V 29 w(GrowingRegion::off)p
1481 3753 V 32 w(GrowingRegion)j Fj(implementation.)e
Fk(i)598 3844 y(h)p Fi(off)p 750 3844 V 29 w(GrowingVRegion::off)p
1520 3844 V 32 w(GrowingVRegion)j Fj(implementation.)c
Fk(i)598 3935 y(h)p Fi(off)p 750 3935 V 29 w(SelfGrowingPRegion::off)p
1676 3935 V 33 w(SelfGrowingPRegion)32 b Fj(implementation.)27
b Fk(i)598 4027 y(h)p Fi(off)p 750 4027 V 29 w(NullFaultingRegion::pg)p
1637 4027 V 33 w(fault)h Fj(implementation.)g Fk(i)598
4118 y(h)p Fi(off)p 750 4118 V 29 w(GrowingPRegion::pg)p
1481 4118 V 32 w(alloc)g Fj(implementation.)g Fk(i)598
4209 y(h)p Fi(off)p 750 4209 V 29 w(GrowingVRegion::pg)p
1481 4209 V 32 w(alloc)g Fj(implementation.)g Fk(i)598
4301 y(h)p Fi(off)p 750 4301 V 29 w(KVMRegion::get)p
1325 4301 V 31 w(pgsize)h Fj(implementation.)e Fk(i)598
4392 y(h)p Fi(off)p 750 4392 V 29 w(KVMRegion::nameof)k
Fj(implementation.)c Fk(i)598 4483 y(h)p Fi(off)p 750
4483 V 29 w(KVMRegion::operator<<)32 b Fj(implementation.)27
b Fk(i)1885 5255 y Fz(739)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
740 741 bop 639 523 a Fz(The)28 b(iterator)e(is)i(k)n(ept)f(at)h
Fx(dmm/KVMItr.h)p Fz(.)515 656 y Fk(h)p Fj(KVMItr.h*)11
b Fk(i)p Fq(\021)598 747 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)
h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598 839 y
Fi(#ifndef)41 b(__OFF_KVM_ITR_H)598 930 y(#define)g(__OFF_KVM_ITR_H)598
1112 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)g(r)l(e)l(gion)h
(iter)l(ator)g(dep)l(endencies.)g Fk(i)598 1295 y Fi(#ifdef)40
b(__KERNEL__)598 1386 y Fk(h)p Fj(O\013)27 b(kernel)h(virtual)g(memory)
g(r)l(e)l(gion)h(iter)l(ator.)g Fk(i)598 1478 y Fi(#endif)40
b(//)g(__KERNEL__)598 1660 y(#endif)g(//)g(!__OFF_KVM_ITR_H)515
1976 y Fr(5.6)135 b(Kernel)31 b(address)f(space)g(manager)h(for)f(ix86)
h(based)821 2126 y(arc)l(hitectures)515 2308 y Fz(It)d(de\014nes)f(the)
h(\014rst)g(v)-5 b(alid)27 b(user)g(virtual)g(address.)515
2441 y Fk(h)p Fj(mdep)g(mKVM.h*)11 b Fk(i)p Fq(\021)598
2532 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2623 y Fi(#ifndef)41
b(__OFF_MDEP_KVM_H)598 2715 y(#define)g(__OFF_MDEP_KVM_H)h(1)598
2897 y(#include)f(<flux/machine/base_gdt.h>)k(//)39 b(for)h(USER_OFF)
598 3080 y(const)g(vm_offset_t)i(OFF_USER_VM_START=USER_OFF;)598
3263 y(#endif)e(//)g(__OFF_MDEP_KVM_H)515 3536 y Fn(5.6.1)112
b(Supp)s(orting)38 b(k)m(ernel)e(dynamic)h(memory)515
3690 y Fz(Dynamic)21 b(memory)g(is)g(allo)r(cated)g(with)h(the)f
Fx(new)f Fz(op)r(erator.)34 b(This)21 b(op)r(erator)f(uses)g
Fx(malloc)515 3789 y Fz(in)28 b(turn.)515 3922 y Fk(h)p
Fj(O\013)f(kernel)h(dynamic)g(memory)g(implementation)g(dep)l
(endencies.)h Fk(i)p Fq(\021)598 4013 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 4105 y(#include)h
(<malloc.h>)512 b(//)40 b(for)g(malloc)1885 5255 y Fz(740)p
eop
PStoPSsaved restore
%%Page: (742,743) 372
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
741 742 bop 639 523 a Fz(A)n(t)28 b(b)r(o)r(ot)g(time)h(ev)n(ery)d
(free)i(page)e(is)i(remo)n(v)n(ed)e(from)i(the)g(\\free)f(memory)g(p)r
(o)r(ol")g(used)515 623 y(b)n(y)21 b Fx(malloc)p Fz(.)32
b(Suc)n(h)21 b(p)r(o)r(ol)g(is)g(the)g(OSKit)g Fx(malloc)p
2049 623 27 4 v 29 w(lmm)p Fz(.)34 b(Th)n(us,)22 b(w)n(e)f(implemen)n
(t)g Fx(morecore)p Fz(.)515 722 y(It)k(is)f(called)g(b)n(y)h
Fx(malloc)d Fz(when)i(more)g(free)g(memory)g(is)h(needed)f(to)h
(satisfy)f(an)g(allo)r(cation)515 822 y(request.)36 b(The)28
b(con)n(v)n(en)n(tion)e(is)h(that)h(k)n(ernel)f(pages)f(are)h(assigned)
f(to)i(the)g Fx(node)e Fz(domain.)639 922 y(W)-7 b(e)28
b(simply)g(ask)e(for)h(an)n(y)g(a)n(v)-5 b(ailable)26
b(page,)g(whic)n(h)i(will)f(b)r(e)h(allo)r(cated)f(b)n(y)g(the)h
Fx(KVM)e Fz(in)515 1021 y(the)i(k)n(ernel)e(allo)r(cation)h(region.)515
1137 y Fk(h)p Fi(off)p 667 1137 24 4 v 29 w(morecore)i
Fj(implementation.)e Fk(i)p Fq(\021)598 1229 y Fi(//)39
b(Makes)i(more)f(memory)h(available)g(for)f(malloc.)598
1320 y(int)g(morecore\(size_t)i(size\))598 1411 y({)676
1503 y(vm_offset_t)g(va=0;)676 1594 y(assert\(size\);)676
1685 y(if)e(\(morecore_debug\))j(kcout)d(<<)g
(fmt\("mc\(\045d\)",size\);)676 1777 y(if)g(\(size)g(&)g
(off_MBank::pmask\(\)\))671 b(/*)40 b(round)g(to)g(K*pgsz)g(*/)755
1868 y(size)79 b(=)39 b(\(size)i(&)e(~off_MBank::pmask\(\)\))44
b(+1;)676 2051 y(if)c(\(size)g(<=)g(off_MBank::get_pgsize\(\)\){)755
2142 y(va=kvm.pg_alloc\(0\);)676 2233 y(})676 2325 y(else{)755
2416 y(va=kvm.pg_alloc\(0,off_MBank::a2)q(p\(of)q(f_MB)q(ank::)q(prou)q
(nd\(si)q(ze\)\))q(\);)676 2507 y(})676 2599 y(if)g(\(va\){)755
2690 y(lmm_add_free\(&malloc_lmm,\(void*)q(\)va,)q(size)q(\);)676
2781 y(})676 2873 y(return)h(va;)598 2964 y(})639 3180
y Fz(Note)27 b(ho)n(w)f(a)h Fx(PFrame*)c Fz(is)k(con)n(v)n(erted)e(to)i
(an)f Fx(vm)p 2177 3180 27 4 v 31 w(offset)p 2472 3180
V 29 w(t)g Fz(using)h(an)f(op)r(erator)f(pro-)515 3279
y(vided)i(b)n(y)h Fx(PFrame)p Fz(s.)515 3396 y Fk(h)p
Fj(O\013)f(kernel)h(dynamic)g(memory)g(implementation)g(dep)l
(endencies.)h Fk(i)p Fz(+)p Fq(\021)598 3487 y Fi(#include)41
b(<flux/lmm.h>)434 b(//)40 b(for)g(lmm_add_free)i(et)d(al.)598
3578 y(#include)i(<dmm/KVM.h>)473 b(//)40 b(for)g(pg_alloc)h(et)e(al.)
598 3670 y(#include)i(<hw/MBank.h>)434 b(//)40 b(for)g(off_MBank)598
3761 y(#include)h(<hw/PFrame.h>)395 b(//)40 b(for)g(off_PFrame)1885
5255 y Fz(741)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
742 743 bop 515 523 a FA(Kernel)31 b(dynamic)g(memory)e
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 676 y Fz(These)27
b(routines)g(are)g(k)n(ept)g(in)h Fx(new.C)p Fz(.)515
809 y Fk(h)p Fj(mdep)f(new.C*)11 b Fk(i)p Fq(\021)598
900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 1083 y(h)p Fj(O\013)f(kernel)h(dynamic)g
(memory)g(implementation)g(dep)l(endencies.)h Fk(i)598
1266 y Fi(extern)40 b(int)g(morecore_debug;)598 1357
y(int)g(morecore_debug=0;)598 1722 y(extern)g("C")g({)676
1814 y Fk(h)p Fi(off)p 828 1814 24 4 v 29 w(morecore)29
b Fj(implementation.)f Fk(i)598 1905 y Fi(};)1177 b(//)40
b(C)f(linkage)1885 5255 y Fz(742)p eop
PStoPSsaved restore
%%Page: (744,745) 373
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
743 744 bop 515 1146 a Fs(Chapter)64 b(6)515 1561 y Fv(Miscellaneous)76
b(data)515 1810 y(structures)515 2242 y Fz(There)33 b(are)g(some)g
Fy(generic)39 b Fz(data)33 b(structures)g(whic)n(h)h(w)n(e)f(ha)n(v)n
(e)g(b)r(een)h(using.)55 b(It)34 b(is)g(no)n(w)515 2341
y(time)28 b(to)f(describ)r(e)h(their)f(implemen)n(tation.)515
2616 y Fr(6.1)135 b(Double)45 b(link)l(ed)h(lists)515
2798 y Fz(This)21 b(is)h(a)f(generic)g(double)h(link)n(ed)f(list)h
(whic)n(h)g(do)r(es)g(not)f(allo)r(cate)g(memory)g(for)g(its)h(no)r
(des.)515 2897 y(It)28 b(is)f(supp)r(osed)h(that)f(no)r(des)h(ha)n(v)n
(e)e(b)r(een)i(allo)r(cated)f(previously)-7 b(.)639 2997
y(A)25 b(list)g(no)r(de)f(k)n(eeps)g(p)r(oin)n(ters)f(to)h(previous)g
(and)g(next)g(list)h(elemen)n(ts.)36 b(The)24 b(data)g(t)n(yp)r(e)515
3096 y(for)j(the)h(elemen)n(t)g(con)n(tained)e(in)i(the)g(list)g(m)n
(ust)g(deriv)n(e)e(from)i(it.)515 3229 y Fk(h)p Fj(Double)f(linke)l(d)h
(no)l(de.)g Fk(i)p Fq(\021)598 3321 y Fi(//)39 b(A)h(double)g(linked)h
(node.)598 3412 y(//)598 3503 y(class)f(DLinkedNode)i({)598
3595 y(public:)676 3686 y(DLinkedNode)g(*l_next;)676
3777 y(DLinkedNode)g(*l_prev;)676 3869 y(DLinkedNode\(void\))h(:)d
(l_next\(NULL\),l_prev\(NULL\))45 b({;})598 3960 y(};)639
4192 y Fz(The)30 b Fx(l)p 861 4192 27 4 v 31 w(next)f
Fz(link)h(is)g(used)g(to)g(guess)f(if)i(a)e(no)r(de)h(is)g(link)n(ed)g
(in)g(a)g Fx(DLinkedList)p Fz(.)40 b(W)-7 b(e)515 4292
y(assume)27 b(that)h(the)f(no)r(de)h(is)g(link)n(ed)f(when)h(suc)n(h)f
(\014eld)h(is)f(non-n)n(ull.)515 4408 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(DLinkedList)p Fj(.)i Fk(i)p Fz(+)p
Fq(\021)676 4500 y Fi(//)40 b(Return)g(non-zero)i(if)d(the)h(nd)g
(seems)g(to)g(be)g(linked.)676 4591 y(//)g(Depend)g(on)g(nd->l_next)i
(be)d(UNUSED)i(when)f(the)g(node)g(is)g(not)g(linked.)676
4682 y(//)676 4774 y(int)g(is_linked\(const)j(DLinkedNode)e(*nd\))g
(const)f({)755 4865 y(assert\(nd\);return)j(nd->l_next!=NULL;)676
4956 y(})1885 5255 y Fz(743)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
744 745 bop 515 523 a Fk(h)p Fj(Double)27 b(linke)l(d)h(list)f(dep)l
(endencies.)j Fk(i)p Fq(\021)598 614 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(NULL)g(et)f(al.)598
706 y(#include)i(<assert.h>)512 b(//)40 b(for)g(assert)639
847 y Fz(The)32 b(double)g(link)n(ed)f(list)h(con)n(tains)f(a)g(p)r
(oin)n(ter)h(to)f(the)h(head)g(elemen)n(t)f(and)h(another)515
946 y(one)h(to)h(the)g(tail)f(of)h(the)g(list.)55 b(Except)34
b(for)f(no)r(de)g(insertion)g(or)g(remo)n(v)-5 b(al)33
b(\(where)g(users)515 1046 y(are)27 b(resp)r(onsible)g(of)h(no)r(de)g
(allo)r(cation)e(and)i(deallo)r(cation\),)f(users)g(should)h(emplo)n(y)
f(a)h(list)515 1146 y(iterator)e(to)h(refer)g(to)h(list)g(no)r(des.)515
1279 y Fk(h)p Fj(Double)f(linke)l(d)h(list.)f Fk(i)p
Fq(\021)598 1370 y Fi(//)39 b(A)h(double)g(linked)h(list)f(which)h
(does)f(not)g(allocate)h(nodes.)598 1461 y(//)598 1553
y(class)f(DLinkedList)i({)598 1644 y(protected:)676 1735
y(friend)f(class)f(DLinkedListItr;)676 1826 y(DLinkedNode)i(*l_head;)
276 b(//)40 b(First)g(element.)676 1918 y(DLinkedNode)i(*l_tail;)276
b(//)40 b(Last)g(element.)598 2009 y(public:)676 2100
y(//)g(Creates)h(an)e(empty)i(DLinkedList.)676 2192 y
(DLinkedList\(void\){)j(l_head)c(=)g(l_tail=)g(NULL;)h(})676
2374 y(//)f(Returns)h(non-zero)g(if)e(the)h(list)g(is)g(empty.)676
2466 y(int)g(is_empty\(void\))j({)c(return)i(l_head==NULL;)h(})676
2648 y(//)e(Does)g(it)g(look)g(fine?)676 2740 y(int)g(valid\(void\);)
676 2922 y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e
Fi(DLinkedList)p Fj(.)j Fk(i)598 3105 y Fi(};)639 3246
y Fz(A)e Fx(valid)e Fz(link)n(ed)h(list)h(m)n(ust)g(satisfy)f(this)h
(in)n(tegrit)n(y)f(c)n(hec)n(k.)515 3362 y Fk(h)p Fi
(DLinkedList::valid)k Fj(implementation.)d Fk(i)o Fq(\021)598
3454 y Fi(//)39 b(Is)h(this)g(list)g(valid?)598 3545
y(//)f(Do)h(its)g(pointers)h(look)f(fine?)598 3636 y(int)g
(DLinkedList::valid\(void\){)676 3728 y(int)g(is_valid=\(\(l_head)j(&&)
d(l_tail\))h(||)e(\(!l_tail)i(&&)f(!l_tail\)\);)676 3819
y(if)g(\(!is_empty\(\)\){)755 3910 y(DLinkedNode)h(*n=l_head;)755
4002 y(do)e({)833 4093 y(is_valid)i(|=)f(\(n->l_next->l_prev)j(==)d
(n\);)833 4184 y(is_valid)h(|=)f(\(n->l_prev->l_next)j(==)d(n\);)833
4276 y(n=n->l_next;)755 4367 y(})f(while\(is_valid)k(&&)c(n)h(!=)f
(l_head\);)676 4458 y(})676 4550 y(return)i(is_valid;)598
4641 y(})1885 5255 y Fz(744)p eop
PStoPSsaved restore
%%Page: (746,747) 374
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
745 746 bop 639 523 a Fz(No)r(de)28 b(insertion)g(at)g(the)g(head)g(of)
g(the)g(list)g(is)g(easy)-7 b(.)37 b(The)28 b(list)h(will)f(b)r(e)g
(double)g(link)n(ed)515 623 y(and)f(the)h(tail)g(no)r(de)f(will)h(b)r
(e)g(considered)f(to)g(b)r(e)h(the)g(predecessor)e(of)h(the)h(head)g
(no)r(de.)515 739 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(DLinkedList)p Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 830
y Fi(//)39 b(Links)i(nd)e(at)h(the)g(head)g(of)g(the)g(list.)598
922 y(void)g(link_first\(DLinkedNode)k(*nd\);)515 1079
y Fk(h)p Fi(DLinkedList::link)p 1213 1079 24 4 v 32 w(first)28
b Fj(implementation.)g Fk(i)p Fq(\021)598 1171 y Fi(//)39
b(Links)i(nd)e(at)h(the)g(head)g(of)g(the)g(list.)598
1262 y(void)g(DLinkedList::link_first\(DLinke)q(dNod)q(e)45
b(*nd\))598 1353 y({)676 1445 y(assert\(valid\(\)\);)676
1536 y(if)40 b(\(is_empty\(\)\){)755 1627 y
(l_head=l_tail=nd->l_prev=nd->l_)q(next)q(=nd;)676 1719
y(})676 1810 y(else)g({)755 1901 y(nd->l_next=l_head;)755
1993 y(nd->l_prev=l_tail;)755 2084 y(l_tail->l_next=nd;)755
2175 y(l_head->l_prev=nd;)755 2267 y(l_head=nd;)676 2358
y(})676 2449 y(assert\(valid\(\)\);)598 2540 y(})639
2773 y Fz(A)35 b(more)e(generic)g(insertion)g(metho)r(d)i(pro)n(vides)d
(insertion)h(at)h(an)g(arbitrary)e(p)r(oin)n(t.)515 2873
y(The)27 b(\\arbitrary)e(p)r(oin)n(t")j(will)g(b)r(e)g(indeed)f(a)h
(list)f(iterator)g(\(to)g(b)r(e)h(discussed)g(b)r(elo)n(w\).)515
2989 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(DLinkedList)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 3080 y Fi(//)39 b(Link)i(node)f
(before/after)i(the)e(given)g(one.)598 3171 y(void)g
(link_before\(DLinkedNode)k(*nd,)c(const)h(DLinkedListItr)h(&at\);)598
3263 y(void)e(link_after\(DLinkedNode)k(*nd,)c(const)h(DLinkedListItr)h
(&at\);)515 3421 y Fk(h)p Fi(DLinkedList::link)p 1213
3421 V 32 w(after)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
3512 y Fi(//)39 b(Links)i(node)f(after)g(the)g(given)h(one.)598
3603 y(void)f(DLinkedList::link_after\(DLinke)q(dNod)q(e)45
b(*nd,)1735 3694 y(const)c(DLinkedListItr)h(&at\))598
3786 y({)676 3877 y(assert\(valid\(\)\);)676 4060 y
(nd->l_prev=at.i_now;)676 4151 y(nd->l_next=at.i_now->l_next;)676
4242 y(at.i_now->l_next=nd;)676 4334 y(nd->l_next->l_prev=nd;)676
4516 y(l_tail=l_head->l_prev;)676 4699 y(assert\(valid\(\)\);)598
4790 y(})1885 5255 y Fz(745)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
746 747 bop 515 523 a Fk(h)p Fi(DLinkedList::link)p 1213
523 24 4 v 32 w(before)29 b Fj(implementation.)e Fk(i)p
Fq(\021)598 614 y Fi(//)39 b(Links)i(node)f(before)h(the)e(given)i
(one.)598 706 y(void)f(DLinkedList::link_before\(DLink)q(edNo)q(de)45
b(*nd,)1735 797 y(const)c(DLinkedListItr)h(&at\))598
888 y({)676 980 y(assert\(valid\(\)\);)676 1162 y(nd->l_next=at.i_now;)
676 1254 y(nd->l_prev=at.i_now->l_prev;)676 1345 y
(at.i_now->l_prev=nd;)676 1436 y(nd->l_prev->l_next=nd;)676
1619 y(l_head=l_tail->l_next;)676 1802 y(assert\(valid\(\)\);)598
1893 y(})639 2125 y Fz(These)28 b(metho)r(ds)f(remo)n(v)n(e)f
(arbitrary)g(no)r(des)h(from)g(the)h(list.)515 2242 y
Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(DLinkedList)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 2333 y Fi(//)39 b(Unlinks)i(nd.)598
2424 y(void)f(unlink\(DLinkedNode)j(*at\);)598 2607 y(//)c(Unlinks)i
(pointed)g(node.)598 2698 y(void)f(unlink\(DLinkedListItr)k(&it\);)1885
5255 y Fz(746)p eop
PStoPSsaved restore
%%Page: (748,749) 375
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
747 748 bop 515 523 a Fk(h)p Fi(DLinkedList::unlink)31
b Fj(implementation.)d Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Unlinks)i(pointed)g(node.)598 706 y(void)f
(DLinkedList::unlink\(DLinkedLis)q(tItr)46 b(&it\))598
797 y({)715 888 y(unlink\(it.i_now\);)598 980 y(})598
1162 y(//)39 b(Unlinks)i(nd.)598 1254 y(void)f
(DLinkedList::unlink\(DLinkedNod)q(e)45 b(*at\))598 1345
y({)676 1436 y(assert\(at)c(&&)f(valid\(\)\);)676 1619
y(at->l_prev->l_next=at->l_nex)q(t;)676 1710 y
(at->l_next->l_prev=at->l_pre)q(v;)676 1893 y(if)g(\(at==l_tail)i(&&)d
(at==l_head\))755 1984 y(l_head=l_tail=NULL;)676 2076
y(else)h(if)g(\(at==l_tail\))755 2167 y(l_tail=at->l_prev;)676
2258 y(else)g(if)g(\(at==l_head\))755 2350 y(l_head=at->l_next;)676
2532 y(at->l_next=NULL;)676 2623 y(assert\(valid\(\)\);)598
2715 y(})639 2947 y Fz(A)28 b(more)f(sp)r(eci\014c)h(one)f(remo)n(v)n
(es)f(\(and)h(returns\))g(the)h(head)g(no)r(de.)515 3064
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(DLinkedList)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 3155 y Fi(//)39 b(Unlinks)i(head)f
(nd.)598 3246 y(DLinkedNode)h(*unlink_head\(void\);)515
3404 y Fk(h)p Fi(DLinkedList::unlink)p 1291 3404 24 4
v 32 w(head)29 b Fj(implementation.)e Fk(i)p Fq(\021)598
3495 y Fi(//)39 b(Unlinks)i(head)f(nd.)598 3587 y(DLinkedNode)h
(*DLinkedList::unlink_head\(v)q(oid\))598 3678 y({)676
3769 y(DLinkedNode)h(*n=l_head;)676 3861 y(assert\(valid\(\)\);)676
3952 y(n->l_prev->l_next=n->l_next;)676 4043 y
(n->l_next->l_prev=n->l_prev;)676 4226 y(if)e(\(n==l_tail\))755
4317 y(l_head=l_tail=NULL;)676 4408 y(else)755 4500 y
(l_head=n->l_next;)676 4591 y(n->l_next=NULL;)676 4682
y(assert\(valid\(\)\);)676 4774 y(return)h(n;)598 4865
y(})1885 5255 y Fz(747)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
748 749 bop 639 523 a Fz(And)28 b(y)n(et)g(another)e(sp)r(eci\014c)i
(one)f(remo)n(v)n(es)f(the)i(tail)g(no)r(de.)515 639
y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e Fi(DLinkedList)p
Fj(.)i Fk(i)p Fz(+)p Fq(\021)598 731 y Fi(//)39 b(Unlinks)i(tail)f(nd.)
598 822 y(DLinkedNode)h(*unlink_tail\(void\);)515 980
y Fk(h)p Fi(DLinkedList::unlink)p 1291 980 24 4 v 32
w(tail)29 b Fj(implementation.)e Fk(i)p Fq(\021)598 1071
y Fi(//)39 b(Unlinks)i(tail)f(nd.)598 1162 y(DLinkedNode)h
(*DLinkedList::unlink_tail\(v)q(oid\))598 1254 y({)676
1345 y(DLinkedNode)h(*n=l_tail;)676 1436 y(assert\(valid\(\)\);)676
1528 y(n->l_prev->l_next=n->l_next;)676 1619 y
(n->l_next->l_prev=n->l_prev;)676 1802 y(if)e(\(n==l_head\))755
1893 y(l_head=l_tail=NULL;)676 1984 y(else)755 2076 y
(l_tail=n->l_prev;)676 2167 y(n->l_next=NULL;)676 2258
y(assert\(valid\(\)\);)676 2350 y(return)h(n;)598 2441
y(})639 2582 y Fz(Discussing)36 b(no)n(w)f(iterators)f(o)n(v)n(er)g
(the)i(list,)j(they)d(can)f(b)r(e)h(obtained)g(from)g(the)g(list)515
2682 y(head)27 b(and)g(tail.)515 2798 y Fk(h)p Fj(Other)h(public)g
(metho)l(ds)h(of)e Fi(DLinkedList)p Fj(.)i Fk(i)p Fz(+)p
Fq(\021)598 2889 y Fi(//)39 b(Return)i(first)f(and)g(last)g(elements.)
598 2980 y(DLinkedListItr)i(get_head\(void\);)598 3072
y(DLinkedListItr)g(get_tail\(void\);)598 3163 y(//)d(Return)i(first)f
(and)g(last)g(elements.)515 3504 y Fk(h)p Fi(DLinkedList::get)p
1174 3504 V 31 w(head)29 b Fj(and)f Fi(get)p 1656 3504
V 29 w(tail)g Fj(implementation.)g Fk(i)o Fq(\021)598
3595 y Fi(DLinkedListItr)42 b(DLinkedList::get_head\(void\))598
3686 y({)676 3778 y(DLinkedListItr)h(itr;)676 3869 y
(assert\(valid\(\)\);)g(itr.i_now=l_head;)g(return)e(itr;)598
3960 y(})598 4051 y(DLinkedListItr)h(DLinkedList::get_tail\(void\))598
4143 y({)676 4234 y(DLinkedListItr)h(itr;)676 4325 y
(assert\(valid\(\)\);)g(itr.i_now=l_tail;)g(return)e(itr;)598
4417 y(})1885 5255 y Fz(748)p eop
PStoPSsaved restore
%%Page: (750,751) 376
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
749 750 bop 639 523 a Fz(The)38 b(iterator)f(class)g(is)h(a)f(simple)i
(one.)67 b(W)-7 b(e)39 b(pro)n(vide)d(common)i(comparison)e(and)515
623 y(mo)n(v)n(emen)n(t)29 b(op)r(erators.)43 b(W)-7
b(e)30 b(do)g(not)h(try)e(to)i(hide)f(completely)g(the)h(list)f(in)n
(ternals)f(from)515 722 y(its)c(users;)h(indeed,)g(users)f(will)g
(usually)g(kno)n(w)g(ho)n(w)g(is)g(the)h(list)g(stored)e(b)r(ecause)h
(they)h(are)515 822 y(resp)r(onsible)f(for)h(list)g(no)r(de)h(allo)r
(cation.)35 b(Remem)n(b)r(er)26 b(that)g(w)n(e)g(are)g(inside)g(a)g
(tin)n(y)g(k)n(ernel.)515 938 y Fk(h)p Fj(Double)h(linke)l(d)h(list)f
(iter)l(ator.)i Fk(i)p Fq(\021)598 1029 y Fi(//)39 b(An)h(iterator)h
(for)f(DLinkedLists.)598 1121 y(//)598 1212 y(class)g(DLinkedListItr)j
({)598 1303 y(protected:)676 1395 y(friend)e(class)f(DLinkedList;)676
1486 y(DLinkedNode)i(*i_now;)433 b(//)40 b(Current)h(postition.)598
1577 y(public:)676 1669 y(//)f(Creates)h(a)e(DLinkedListItr)676
1760 y(DLinkedListItr\(void\))44 b(:)39 b(i_now\(NULL\))j({;)e(})676
1851 y(DLinkedListItr\(const)k(DLinkedList)e(&list\))e(:)g
(i_now\(list.l_head\))j({;})676 2034 y(//)d(Compare)h(iterator)g
(positions.)676 2125 y(int)f(operator==\(const)j(DLinkedListItr)f(nd\))
e(const)h({return)f(i_now)h(==)f(nd.i_now;)h(})676 2217
y(int)f(operator!=\(const)j(DLinkedListItr)f(nd\))e(const)h({return)f
(i_now)h(!=)f(nd.i_now;)h(})676 2308 y(int)f(is_null\(void\))i(const)f
({)e(return)i(i_now)f(==)g(NULL;)g(})676 2491 y(//)g(get)g(a)f
(reference)j(to)d(the)h(element)h(pointed)g(by)e(the)h(iterator.)676
2582 y(DLinkedNode)i(*get_element\(void\){)h(return)e(i_now;)g(})676
2765 y(//)f(Advance)h(iterator.)676 2856 y(DLinkedListItr)i
(operator++\(\){)755 2947 y(assert\(i_now\);)f(i_now=i_now->l_next;)i
(return)c(*this;)676 3039 y(})676 3130 y(DLinkedListItr)j
(operator--\(\){)755 3221 y(assert\(i_now\);)f(i_now=i_now->l_prev;)i
(return)c(*this;)676 3313 y(})676 3495 y(//)g(Advance)h(iterator.)676
3587 y(DLinkedListItr)i(operator++\(int)f(i\){)755 3678
y(DLinkedListItr)g(r=*this;)755 3769 y(assert\(!i\);)755
3861 y(assert\(i_now\);)g(i_now=i_now->l_next;)i(return)c(r;)676
3952 y(})676 4043 y(DLinkedListItr)j(operator--\(int)f(i\){)755
4134 y(DLinkedListItr)g(r=*this;)755 4226 y(assert\(!i\);)755
4317 y(assert\(i_now\);)g(i_now=i_now->l_prev;)i(return)c(r;)676
4408 y(})598 4591 y(};)1885 5255 y Fz(749)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
750 751 bop 639 523 a Fz(As)26 b(the)g(list)f(used)h(iterators,)e(and)h
(iterators)f(use)h(the)h(list)g(w)n(e)f(m)n(ust)g(break)g(the)g(cyclic)
515 623 y(dep)r(endency)-7 b(.)515 739 y Fk(h)p Fj(Double)27
b(linke)l(d)h(list)f(dep)l(endencies.)j Fk(i)p Fz(+)o
Fq(\021)598 830 y Fi(class)40 b(DLinkedListItr;)515 1088
y Fn(6.1.1)112 b(Double)37 b(link)m(ed)g(lists)e Fd(C)8
b FC(++)38 b Fn(source)g(\014les)515 1241 y Fz(All)28
b(the)g(co)r(de)f(w)n(e)g(ha)n(v)n(e)g(seen)g(is)h(k)n(ept)f(in)h
Fx(klib/dlist.h)23 b Fz(and)k Fx(klib/dlist.C)p Fz(.)515
1374 y Fk(h)p Fj(d)t(list.h*)11 b Fk(i)p Fq(\021)598
1465 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 1556 y Fi(#ifndef)41
b(__D_LINKED_LIST_H)598 1648 y(#define)g(__D_LINKED_LIST_H)598
1830 y Fk(h)p Fj(Double)28 b(linke)l(d)f(list)g(dep)l(endencies.)j
Fk(i)598 2013 y(h)p Fj(Double)e(linke)l(d)f(no)l(de.)h
Fk(i)598 2104 y(h)p Fj(Double)g(linke)l(d)f(list.)g Fk(i)598
2196 y(h)p Fj(Double)h(linke)l(d)f(list)g(iter)l(ator.)i
Fk(i)598 2287 y Fi(#endif)40 b(//)g(__D_LINKED_LIST_H)515
2553 y Fk(h)p Fj(d)t(list.C*)11 b Fk(i)o Fq(\021)598
2644 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 2826 y Fi(#include)41
b(<klib/dlist.h>)356 b(//)40 b(Exported)h(interface)598
3009 y Fk(h)p Fj(Double)28 b(linke)l(d)f(list)g(implementation)h(dep)l
(endencies.)i Fk(i)598 3192 y(h)p Fi(DLinkedList::get)p
1257 3192 24 4 v 32 w(head)e Fj(and)g Fi(get)p 1739 3192
V 29 w(tail)g Fj(implementation.)g Fk(i)598 3283 y(h)p
Fi(DLinkedList::valid)j Fj(implementation.)d Fk(i)598
3374 y(h)p Fi(DLinkedList::link)p 1296 3374 V 32 w(first)g
Fj(implementation.)g Fk(i)598 3466 y(h)p Fi(DLinkedList::link)p
1296 3466 V 32 w(after)g Fj(implementation.)g Fk(i)598
3557 y(h)p Fi(DLinkedList::link)p 1296 3557 V 32 w(before)h
Fj(implementation.)e Fk(i)598 3648 y(h)p Fi(DLinkedList::unlink)k
Fj(implementation.)d Fk(i)598 3740 y(h)p Fi(DLinkedList::unlink)p
1374 3740 V 32 w(head)h Fj(implementation.)e Fk(i)598
3831 y(h)p Fi(DLinkedList::unlink)p 1374 3831 V 32 w(tail)i
Fj(implementation.)e Fk(i)598 3922 y(h)p Fj(Implementation)h(of)f
(other)i(public)e(metho)l(ds)i(of)e Fi(DLinkedList)p
Fj(.)j Fk(i)1885 5255 y Fz(750)p eop
PStoPSsaved restore
%%Page: (752,753) 377
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
751 752 bop 515 523 a Fk(h)p Fj(ud)t(list.C*)11 b Fk(i)o
Fq(\021)598 614 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 706 y Fi(#undef)40
b(__KERNEL__)598 797 y(#include)h(<klib/dlist.h>)356
b(//)40 b(Exported)h(interface)598 980 y Fk(h)p Fj(Double)28
b(linke)l(d)f(list)g(implementation)h(dep)l(endencies.)i
Fk(i)598 1162 y(h)p Fi(DLinkedList::get)p 1257 1162 24
4 v 32 w(head)e Fj(and)g Fi(get)p 1739 1162 V 29 w(tail)g
Fj(implementation.)g Fk(i)598 1254 y(h)p Fi(DLinkedList::valid)j
Fj(implementation.)d Fk(i)598 1345 y(h)p Fi(DLinkedList::link)p
1296 1345 V 32 w(first)g Fj(implementation.)g Fk(i)598
1436 y(h)p Fi(DLinkedList::link)p 1296 1436 V 32 w(after)g
Fj(implementation.)g Fk(i)598 1528 y(h)p Fi(DLinkedList::link)p
1296 1528 V 32 w(before)h Fj(implementation.)e Fk(i)598
1619 y(h)p Fi(DLinkedList::unlink)k Fj(implementation.)d
Fk(i)598 1710 y(h)p Fi(DLinkedList::unlink)p 1374 1710
V 32 w(head)h Fj(implementation.)e Fk(i)598 1802 y(h)p
Fi(DLinkedList::unlink)p 1374 1802 V 32 w(tail)i Fj(implementation.)e
Fk(i)1885 5255 y Fz(751)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
752 753 bop 515 523 a Fr(6.2)135 b(Queues)515 705 y Fz(W)-7
b(e)40 b(usually)f(build)h(queues)f(with)h(elemen)n(ts)f(allo)r(cated)g
(b)n(y)g(the)h(queue)f(user)g(using)g(a)515 805 y(blo)r(c)n(k)22
b(allo)r(cator.)34 b(This)23 b(is)g(a)g(simple)h(queue)f(mo)r(dule)g
(whic)n(h)g(assumes)g(that)g(elemen)n(ts)g(are)515 904
y(allo)r(cated)k(b)n(y)g(the)h(user)f(and)h(uses)f(the)h(couple)g(of)f
(p)r(oin)n(ters)g(used)h(b)n(y)f(the)h(allo)r(cator)e(free)515
1004 y(list)i(to)f(build)h(the)g(queue)g(list.)639 1103
y(Queue)18 b(no)r(des)h(are)e(th)n(us)i(those)f(used)h(in)f(a)h(blo)r
(c)n(k)f(allo)r(cator)e(to)j(main)n(tain)f(the)h(allo)r(cator)515
1203 y(free)27 b(list.)37 b(W)-7 b(e)28 b(rely)f(on)g
Fx(DLinkedList)d Fz(to)j(implemen)n(t)h(the)g(queue.)639
1303 y(The)40 b(queue)f(in)n(terface)g(is)g(just)h(what)f(w)n(e)g
(could)g(exp)r(ect)h(from)f(a)f(queue,)43 b(but)d(for)515
1402 y(\(p)r(erhaps\))31 b Fx(dequeue\(el\))26 b Fz(whic)n(h)31
b(p)r(ermits)g(to)g(remo)n(v)n(e)e(a)h(sp)r(eci\014ed)h(elemen)n(t)g
(from)g(the)515 1502 y(queue.)36 b(T)-7 b(o)25 b(enqueue)g(an)g(elemen)
n(t)h(w)n(e)e(allo)r(cate)h(a)g(no)r(de)g(and)g(link)h(it)g(to)f(the)h
(fron)n(t)e(of)i(the)515 1602 y(list.)37 b(T)-7 b(o)27
b(dequeue)h(an)f(elemen)n(t)h(w)n(e)f(extract)g(the)h(tail)f(of)h(the)g
(list.)515 1719 y Fk(h)p Fj(Double)f(linke)l(d)h(queue.)g
Fk(i)p Fq(\021)598 1810 y Fi(class)40 b(DLinkedQueue)i({)598
1901 y(protected:)676 1993 y(DLinkedList)473 b(q_list;)120
b(//)39 b(List)i(of)e(enqueued)i(nodes.)598 2084 y(public:)676
2267 y(//)f(Destroys)h(the)f(queue.)676 2358 y(~DLinkedQueue\(void\);)
676 2632 y(//)g(Returns)h(non-zero)g(if)e(the)h(queue)h(is)e(emply.)676
2723 y(boolean_t)i(is_empty\(void\))i({)c(return)i
(q_list.is_empty\(\);)i(})676 2906 y(//)d(Enqueues)h(an)f(element)g(in)
g(the)g(the)g(list.)676 2997 y(void)g(enqueue\(DLinkedNode)k(*el\))c({)
f(q_list.link_first\(el\);)45 b(})676 3180 y(//)40 b(Dequeues)h(an)f
(element)g(from)h(the)e(list.)676 3271 y(DLinkedNode)j
(*dequeue\(void\))g({)e(return)g(q_list.unlink_tail\(\);)k(})676
3454 y(//)c(Returns)h(the)f(first)g(in)g(the)g(queue.)676
3545 y(DLinkedNode)i(*get_first\(void\))h({)c(return)i
(q_list.get_tail\(\).get_element\()q(\);)k(})676 3728
y(//)40 b(Dequeues)h(the)f(given)g(element)h(from)f(the)g(list.)676
3819 y(DLinkedNode)i(*dequeue\(DLinkedNode)i(*e\))c({)f
(q_list.unlink\(e\);)k(return)e(e;)e(})676 4002 y(//)h(Violate)h(the)f
(queue)g(assumption)h(by)f(linking)h(before)g(or)e(after)i(the)f(given)
676 4093 y(//)g(element.)676 4184 y(void)g(link_after\(DLinkedNode)45
b(*n,)39 b(DLinkedQueueItr)k(&at\))d({)755 4276 y
(q_list.link_after\(n,at\);)676 4367 y(})676 4458 y(void)g
(link_before\(DLinkedNode)45 b(*n,)40 b(DLinkedQueueItr)i(&at\))e({)755
4550 y(q_list.link_before\(n,at\);)676 4641 y(})676 4824
y Fk(h)p Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(DLinkedQueue)p
Fj(.)j Fk(i)598 5006 y Fi(};)1885 5255 y Fz(752)p eop
PStoPSsaved restore
%%Page: (754,755) 378
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
753 754 bop 515 697 a Fk(h)p Fj(Double)27 b(linke)l(d)h(queue)h(dep)l
(endencies.)g Fk(i)p Fq(\021)598 789 y Fi(#include)41
b(<assert.h>)512 b(//)40 b(for)g(assert)598 880 y(#include)h
(<klib/dlist.h>)356 b(//)40 b(for)g(DLinkedList)h(et)f(al.)598
971 y(#include)h(<klib/BlockAllocator.h>)j(//)c(for)g(BlockAllocator)i
(et)e(al.)639 1112 y Fz(If)27 b(the)g(elemen)n(t)g(to)g(b)r(e)g
(dequeued)g(is)f(sp)r(eci\014ed)h(w)n(e)f(remo)n(v)n(e)f(an)n(y)h
(instance)g(of)h(it)g(\(e.g.)515 1212 y(the)h(last)f(one)g(in)h(the)g
(queue:)37 b(the)28 b(\014rst)f(one)g(in)h(the)g(list\).)639
1312 y(Finally)-7 b(,)28 b(to)f(destruct)h(the)g(queue)f(w)n(e)h(just)g
Fx(dequeue)d Fz(ev)n(ery)h(con)n(tained)h(elemen)n(t.)515
1428 y Fk(h)p Fi(DLinkedQueue::~DLinkedQueue)33 b Fj(implementation.)28
b Fk(i)p Fq(\021)598 1519 y Fi(DLinkedQueue::~DLinkedQueue\(vo)q(id\))
598 1611 y({)676 1702 y(while\(!q_list.is_empty\(\)\))755
1793 y(delete)40 b(dequeue\(\);)598 1885 y(})639 2100
y Fz(The)34 b(queue)f(also)f(pro)n(vides)g(an)h(iterator.)53
b(It)34 b(is)f(built)h(from)f(the)h(list)f(iterator)f(seen)515
2200 y(b)r(efore.)515 2333 y Fk(h)p Fj(Double)27 b(linke)l(d)h(queue)h
(iter)l(ator.)g Fk(i)o Fq(\021)598 2424 y Fi(class)40
b(DLinkedQueueItr)j(:)c(public)i(DLinkedListItr)h({)598
2516 y(public:)676 2607 y(DLinkedQueueItr\(void\))i(:)c
(DLinkedListItr\(\))j({;})676 2698 y(DLinkedQueueItr\(const)h
(DLinkedQueueItr)f(&itr\))d(:)755 2790 y
(DLinkedListItr\(\(DLinkedListItr\))q(itr\))46 b({;})598
2881 y(};)515 3147 y Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(DLinkedQueue)p Fj(.)j Fk(i)o Fq(\021)598 3238 y Fi(//)39
b(Return)i(first)f(and)g(last)g(elements.)598 3329 y(DLinkedQueueItr)i
(get_head\(void\))h({)676 3421 y(DLinkedQueueItr)g(itr;)676
3512 y(DLinkedListItr)g(*i=&itr;)676 3603 y
(\(*i\)=q_list.get_head\(\);)676 3694 y(return)e(itr;)598
3786 y(})598 3968 y(DLinkedQueueItr)h(get_tail\(void\))h({)676
4060 y(DLinkedQueueItr)g(itr;)676 4151 y(DLinkedListItr)g(*i=&itr;)676
4242 y(\(*i\)=q_list.get_tail\(\);)676 4334 y(return)e(itr;)598
4516 y(})1885 5255 y Fz(753)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
754 755 bop 515 523 a Fn(6.2.1)112 b(Queues)39 b Fd(C)8
b FC(++)38 b Fn(source)f(\014les)515 676 y Fz(The)27
b(queue)h(declaration)e(is)i(k)n(ept)f(in)h Fx(klib/dqueue.h)22
b Fz(and)28 b Fx(klib/dqueue.C)p Fz(.)515 809 y Fk(h)p
Fj(dqueue.h*)11 b Fk(i)q Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28
b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g
Fk(i)598 992 y Fi(#ifndef)41 b(__D_LINKED_QUEUE_H)598
1083 y(#define)g(__D_LINKED_QUEUE_H)i(1)598 1266 y Fk(h)p
Fj(Double)28 b(linke)l(d)f(queue)i(dep)l(endencies.)g
Fk(i)598 1540 y(h)p Fj(Double)f(linke)l(d)f(queue)i(iter)l(ator.)g
Fk(i)598 1631 y(h)p Fj(Double)f(linke)l(d)f(queue.)h
Fk(i)598 1905 y Fi(#endif)40 b(//)g(__D_LINKED_QUEUE_H)515
2171 y Fk(h)p Fj(dqueue.C*)11 b Fk(i)q Fq(\021)598 2262
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 2445 y Fi(#include)41 b(<klib/dqueue.h>)317
b(//)40 b(Exported)h(interface.)598 2627 y Fk(h)p Fi
(DLinkedQueue::~DLinkedQueue)33 b Fj(implementation.)28
b Fk(i)515 3076 y(h)p Fj(udqueue.C*)11 b Fk(i)q Fq(\021)598
3167 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3258 y Fi(#undef)40
b(__KERNEL__)598 3350 y(#include)h(<klib/dqueue.h>)317
b(//)40 b(Exported)h(interface.)598 3532 y Fk(h)p Fi
(DLinkedQueue::~DLinkedQueue)33 b Fj(implementation.)28
b Fk(i)1885 5255 y Fz(754)p eop
PStoPSsaved restore
%%Page: (756,757) 379
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
755 756 bop 515 523 a Fr(6.3)135 b(Hash)45 b(tables)515
705 y Fz(W)-7 b(e)34 b(use)g(dynamic)h(hash)e(tables)h(in)h(the)f(relo)
r(cation)f(tables)h(to)h(\014nd)f(a)g(lo)r(cal)g Fx(off)p
3192 705 27 4 v 30 w(id)p 3310 705 V 30 w(t)515 805 y
Fz(giv)n(en)27 b(a)g(remote)g Fx(off)p 1215 805 V 30
w(id)p 1333 805 V 30 w(t)p Fz(.)639 904 y(The)35 b(hash)g(table)g(uses)
g(a)f(blo)r(c)n(k)h(allo)r(cator)e(to)i(k)n(eep)g(the)g(elemen)n(ts)g
(b)r(eing)g(hashed.)515 1004 y(Ev)n(ery)24 b(en)n(try)h(in)i(the)f
(table)g(is)g(actually)f(a)h(list)g(of)g(elemen)n(ts)f(with)i(the)f
(same)g(hash)f(v)-5 b(alue.)515 1103 y(It)29 b(is)f(a)g(somewhat)g
(generic)f(hash)i(table)f(for)g(in-k)n(ernel)f(use:)39
b(The)29 b(hashed)f(elemen)n(t,)h(the)515 1203 y(hash)e(function,)h
(the)g(elemen)n(t)g(k)n(ey)-7 b(,)27 b(and)g(the)h(n)n(um)n(b)r(er)g
(of)f(en)n(tries)g(can)g(b)r(e)h(sp)r(eci\014ed.)515
1336 y Fk(h)p Fj(Hash)g(table.)g Fk(i)p Fq(\021)598 1427
y Fi(//)39 b(A)h(dynamic)h(hash)f(table)g(for)g(El)g(elements,)h(using)
f(hash)h(function)g(Hasher,)598 1518 y(//)e(and)h(Key)g(as)g(the)g
(element)h(Key.)f(It)f(contains)j(Nents)e(entries.)598
1610 y(//)598 1701 y(template<class)i(T,)e(class)g(Hasher,)h(class)f
(Key,)h(int)e(nents>)598 1792 y(class)h(DHashTbl)h({)598
1884 y(private:)676 1975 y(DLinkedList)473 b(h_entries[nents];)44
b(//)39 b(Hash)h(table)h(entries)g(\(w/)e(ovf)h(lists\))676
2066 y(Hasher)668 b(h_hash;)434 b(//)39 b(Hash)h(function)h
(implementor)598 2158 y(public:)676 2249 y(//)f(Returns)h(the)f(number)
g(of)g(entries.)676 2340 y(int)g(get_nents\(void\))j(const)d({)g
(return)g(nents;)h(})676 2614 y Fk(h)p Fj(Other)29 b(public)e(metho)l
(ds)i(of)e Fi(DHashTbl)p Fj(.)i Fk(i)598 2797 y Fi(};)515
3063 y Fk(h)p Fj(Hash)f(table)g(dep)l(endencies.)h Fk(i)p
Fq(\021)598 3154 y Fi(#include)41 b(<assert.h>)551 b(//)40
b(for)g(assert.)598 3245 y(#include)h(<klib/dlist.h>)395
b(//)40 b(for)g(DLinkedList.)639 3386 y Fz(The)28 b(imp)r(ortan)n(t)f
(metho)r(ds)h(are)f Fx(lookup)p Fz(,)e Fx(insert)g Fz(and)j
Fx(delete)p Fz(.)515 3503 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)
e Fi(DHashTbl)p Fj(.)i Fk(i)p Fq(\021)598 3594 y Fi(//)39
b(Looks)i(up)e(an)h(element)h(with)f(the)g(given)g(key.)598
3685 y(T)f(*lookup\(const)j(Key)e(&akey\);)598 3868 y(//)f(Inserts)i
(the)f(given)h(element)f(in)g(the)g(table.)598 3959 y(void)g(insert\(T)
h(*el\);)598 4142 y(//)e(Deletes)i(the)f(element)h(with)f(the)g(given)g
(key.)598 4233 y(void)g(remove\(const)i(Key)e(&el\);)515
4391 y Fk(h)p Fj(Hash)28 b(table)g(dep)l(endencies.)h
Fk(i)p Fz(+)p Fq(\021)598 4482 y Fi(#include)41 b(<klib/mdep/types.h>)
161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f(al.)1885
5255 y Fz(755)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
756 757 bop 515 523 a Fk(h)p Fi(DHashTbl<T,H,K,N>::lookup)33
b Fj(implementation.)27 b Fk(i)p Fq(\021)598 614 y Fi(//)39
b(Looks)i(up)e(an)h(entry)h(and)e(returns)i(a)f(pointer)h(to)e(it)h(or)
g(NULL)g(when)g(not)g(found.)598 706 y(template<class)i(T,)e(class)g
(Hasher,)h(class)f(Key,)h(int)e(nents>)598 797 y(T)g
(*DHashTbl<T,Hasher,Key,nents)q(>::lo)q(okup)q(\(con)q(st)45
b(Key)40 b(&akey\))598 888 y({)676 980 y(DLinkedListItr)j
(itr\(h_entries[h_hash.hash\(akey\))q(]\);)676 1071 y(DLinkedListItr)g
(hd)79 b(=)39 b(itr;)676 1254 y(if)h(\(itr.is_null\(\)\))755
1345 y(return)g(FALSE;)676 1436 y(else)g({)755 1528 y(do)f({)833
1619 y(if)h(\(h_hash.match\(\(T*\)itr.get_elem)q(ent\()q(\),ake)q
(y\)\))912 1710 y(return)g(\(T*\)itr.get_element\(\);)833
1802 y(++itr;)755 1893 y(})f(while\()i(itr)f(!=)f(hd)h(\);)755
1984 y(return)g(NULL;)676 2076 y(})598 2167 y(})515 2399
y Fk(h)p Fi(DHashTbl<T,H,K,N>::insert)33 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 2491 y Fi(//)39 b(Inserts)i(a)f(new)g(entry)g(in)g
(the)g(table.)g(Returns)h(zero)f(if)g(error.)598 2582
y(template<class)i(T,)e(class)g(Hasher,)h(class)f(Key,)h(int)e(nents>)
598 2673 y(void)h(DHashTbl<T,Hasher,Key,nents>::)q(inse)q(rt\()46
b(T)39 b(*el\))598 2765 y({)676 2856 y(assert\(el\);)676
2947 y(h_entries[h_hash.hash\(el->ge)q(t_key)q(\(\)\)])q(.lin)q(k_fir)q
(st\(e)q(l\);)598 3039 y(})515 3271 y Fk(h)p Fi
(DHashTbl<T,H,K,N>::remove)33 b Fj(implementation.)27
b Fk(i)p Fq(\021)598 3362 y Fi(//)39 b(Removes)i(an)f(entry)g(from)g
(the)g(table.)598 3454 y(template<class)i(T,)e(class)g(Hasher,)h(class)
f(Key,)h(int)e(nents>)598 3545 y(void)h(DHashTbl<T,Hasher,Key,nents>::)
q(remo)q(ve\(c)q(onst)46 b(Key)40 b(&el\))598 3636 y({)676
3728 y(DLinkedList)i(*l=h_entries+h_hash.hash\(el\);)676
3819 y(DLinkedListItr)h(itr\(l\);)676 3910 y(DLinkedListItr)g(hd)79
b(=)39 b(itr;)676 4002 y(assert\(l\);)676 4093 y(if)h
(\(!itr.is_null\(\)\))j({)755 4184 y(do)c({)833 4276
y(if)h(\(el)g(==)f(itr.get_element\(\)->get_key\()q(\)\){)912
4367 y(unlink\(itr\);)912 4458 y(return;)833 4550 y(})833
4641 y(++itr;)755 4732 y(})g(while\()i(itr)f(!=)f(hd)h(\);)676
4824 y(})598 4915 y(})1885 5255 y Fz(756)p eop
PStoPSsaved restore
%%Page: (758,759) 380
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
757 758 bop 515 523 a Fn(6.3.1)112 b(Hash)38 b(tables)f
Fd(C)8 b FC(++)38 b Fn(source)g(\014les)515 676 y Fz(The)27
b(hash)h(table)f(declaration)f(is)i(k)n(ept)f(in)h Fx(klib/dhash.h)p
Fz(.)515 809 y Fk(h)p Fj(dhash.h*)11 b Fk(i)q Fq(\021)598
900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 992 y Fi(#ifndef)41 b(__D_HASH_H)598
1083 y(#define)g(__D_HASH_H)g(1)598 1266 y Fk(h)p Fj(Hash)28
b(table)g(dep)l(endencies.)h Fk(i)598 1448 y Fi(#ifdef)40
b(__KERNEL__)598 1540 y Fk(h)p Fj(Hash)28 b(table.)g
Fk(i)598 1631 y Fi(#endif)40 b(//)g(__KERNEL__)598 1814
y(#endif)g(//)g(__D_HASH_H)598 1996 y(#ifndef)h(__D_HASH_C)598
2088 y(#define)g(__D_HASH_C)g(1)598 2270 y(#ifdef)f(__KERNEL__)598
2362 y Fk(h)p Fi(DHashTbl<T,H,K,N>::lookup)33 b Fj(implementation.)27
b Fk(i)598 2453 y(h)p Fi(DHashTbl<T,H,K,N>::insert)33
b Fj(implementation.)27 b Fk(i)598 2544 y(h)p Fi
(DHashTbl<T,H,K,N>::remove)33 b Fj(implementation.)27
b Fk(i)598 2636 y Fi(#endif)40 b(//)g(__KERNEL__)598
2818 y(#endif)g(//)g(__D_HASH_C)1885 5255 y Fz(757)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
758 759 bop 515 523 a Fr(6.4)135 b(Bitmaps)515 705 y
Fz(This)27 b(is)h(a)f(simple)h(bitmap)g(whic)n(h)f(can)g(b)r(e)h(used)g
(for)f(resource)f(allo)r(cation.)515 821 y Fk(h)p Fj(Bitmap.)h
Fk(i)p Fq(\021)598 912 y Fi(//)39 b(A)h(bitmap.)598 1004
y(class)g(Bitmap)h({)598 1095 y(private:)676 1186 y(unsigned32_t)h
(*b_bits;)598 1278 y(public:)676 1369 y(//)e(Creates)h(a)e(bitmap.)676
1460 y(Bitmap\(natural_t)k(len\);)676 1734 y(boolean_t)e
(get_bit\(natural_t)j(at\))39 b(const)i({)755 1826 y(return)f
(::test_bit\(at,)j(b_bits\);)676 1917 y(};)676 2008 y(//)d(Sets)g(the)g
(bit)g(and)g(return)g(its)g(old)g(value)h(atomically.)676
2100 y(boolean_t)g(set_bit\(natural_t)j(at\))39 b({)755
2191 y(return)h(::set_bit\(at,b_bits\);)676 2282 y(})676
2374 y(//)g(Clears)g(the)g(bit)g(and)g(returns)h(its)f(old)g(value)g
(atomically.)676 2465 y(boolean_t)h(clr_bit\(natural_t)j(at\))39
b({)755 2556 y(return)h(::clear_bit\(at,b_bits\);)676
2648 y(})598 2739 y(};)639 2955 y Fz(This)28 b(bitmap)g(uses)f(the)h
(OSKit)f(bit)h(op)r(erations.)515 3071 y Fk(h)p Fj(Bitmap)f(dep)l
(endencies.)i Fk(i)p Fq(\021)598 3162 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t)h(natural_t)g(et)f
(al.)598 3254 y(#include)h(<klib/mdep/bitops.h>)122 b(//)40
b(for)g(set_,clear_)h(and)f(test_bit)515 3411 y Fk(h)p
Fi(Bitmap::Bitmap)30 b Fj(implementation.)e Fk(i)p Fq(\021)598
3503 y Fi(//)39 b(Creates)i(a)f(bitmap.)598 3594 y
(Bitmap::Bitmap\(natural_t)k(len\))598 3685 y({)755 3777
y(natural_t)d(nwords=len>>5;)755 3868 y(b_bits=)f(new)g
(unsigned32_t[nwords];)755 3959 y(assert\(b_bits\);)755
4051 y(for)g(\(natural_t)h(i=0;)f(i<nwords;)h(i++\))833
4142 y(b_bits[i]=0;)598 4233 y(})515 4499 y Fk(h)p Fj(Bitmap)27
b(implementation)h(dep)l(endencies.)h Fk(i)p Fq(\021)598
4590 y Fi(#include)41 b(<assert.h>)1885 5255 y Fz(758)p
eop
PStoPSsaved restore
%%Page: (760,761) 381
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
759 760 bop 515 523 a Fn(6.4.1)112 b(Bitmaps)36 b Fd(C)8
b FC(++)38 b Fn(source)g(\014les)515 676 y Fz(It)28 b(is)f(all)g(k)n
(ept)h(in)g Fx(klib/bmap.h)23 b Fz(and)k Fx(klib/bmap.C)p
Fz(.)515 793 y Fk(h)p Fj(bmap.h*)11 b Fk(i)p Fq(\021)598
884 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)
l(ad)f(warning.)g Fk(i)598 975 y Fi(#ifndef)41 b(__BITMAP_H)598
1066 y(#define)g(__BITMAP_H)g(1)598 1249 y Fk(h)p Fj(Bitmap)27
b(dep)l(endencies.)i Fk(i)598 1432 y(h)p Fj(Bitmap.)e
Fk(i)598 1614 y Fi(#endif)40 b(//)g(__BITMAP_H)515 1772
y Fk(h)p Fj(bmap.C*)11 b Fk(i)p Fq(\021)598 1863 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 2046 y Fi(#include)41 b(<klib/bmap.h>)395
b(//)40 b(Exported)h(interface.)598 2137 y Fk(h)p Fj(Bitmap)27
b(implementation)h(dep)l(endencies.)h Fk(i)598 2320 y(h)p
Fi(Bitmap::Bitmap)h Fj(implementation.)e Fk(i)1885 5255
y Fz(759)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
760 761 bop 515 523 a Fr(6.5)135 b(Simple)46 b(output)e(streams)515
705 y Fz(A)28 b(simple)f(stream)g(class)g(is)g(pro)n(vided)g(for)g
(in-k)n(ernel)g(use.)515 838 y Fk(h)p Fj(Output)h(str)l(e)l(am.)h
Fk(i)p Fq(\021)598 929 y Fi(//)39 b(A)h(very)g(simple)h(output)f
(stream.)598 1020 y(//)598 1112 y(class)g(OStr)g({)676
1203 y(int)g(using_hex;)676 1294 y(int)g(raw_chars;)598
1386 y(public:)676 1477 y(//)g(Creates)h(a)e(simple)i(output)f(stream.)
676 1568 y(OStr\(void\):)i(using_hex\(0\),)g(raw_chars\(0\))g({})676
1751 y(//)e(Switch)g(numeric)h(output)g(format)676 1842
y(void)f(hex\(void\){using_hex=1;})676 1934 y(void)g
(dec\(void\){using_hex=0;})676 2116 y(//)g(Prints)g(the)g(given)h
(string.)676 2208 y(virtual)g(void)f(print\(const)i(char)e(*s\)=0;)676
2299 y(//)g(Prints)g(the)g(given)h(number)f(in)g(hexa)676
2390 y(virtual)h(void)f(printh\(const)i(unsigned)f(int)79
b(i\)=0;)676 2482 y(//)40 b(Prints)g(the)g(given)h(number)f(in)g(dec)
676 2573 y(virtual)h(void)f(printd\(const)i(unsigned)f(int)79
b(i\)=0;)676 2756 y(//)40 b(Starts)g(a)g(new)g(line.)676
2847 y(virtual)h(void)f(newline\(void\)=0;)676 2938 y(virtual)h(OStr)f
(&operator<<\(const)j(char)d(*s\))g({)g(print\(s\);)h(return)g(*this;)f
(})676 3029 y(virtual)h(OStr)f(&operator<<\(const)j(unsigned)e(int)f
(i\))g({)755 3121 y(if)f(\(!raw_chars)j(&&)e(i)f(==)h('\\n'\){)912
3212 y(newline\(\);)912 3303 y(return)g(*this;)755 3395
y(})755 3486 y(if)f(\(using_hex\))j(printh\(i\);)g(else)e(printd\(i\);)
755 3577 y(return)g(*this;)676 3669 y(})676 3851 y Fk(h)p
Fj(Other)29 b(public)e(metho)l(ds)i(of)e Fi(OStr)p Fj(.)h
Fk(i)598 3943 y Fi(};)639 4175 y Fz(A)40 b(few)f(related)f(utilities)i
(are)e(pro)n(vided.)70 b(First,)41 b(to)e(prin)n(t)g(new-lines,)i(a)e
(dumm)n(y)515 4275 y(ob)5 b(ject)27 b(is)h(pro)n(vided.)35
b Fx(OStr)26 b Fz(will)i(recognize)e(it)i(and)g(dump)g(a)f(newline.)515
4391 y Fk(h)p Fj(Output)h(str)l(e)l(am)h(new)f(line.)f
Fk(i)p Fq(\021)598 4482 y Fi(class)40 b(OStrCtrl)h({)f(public:)g(char)h
(o_c;)f(};)598 4574 y(extern)g(const)h(OStrCtrl)g(nl;)f(//)f(A)h(new)g
(line.)515 4731 y Fk(h)p Fj(Output)28 b(str)l(e)l(am)h(new)f(line)f
(initializer.)g Fk(i)p Fq(\021)598 4823 y Fi(const)40
b(OStrCtrl)h(nl=)f({)g('\\n')g(};)157 b(//)40 b(A)f(new)h(line.)1885
5255 y Fz(760)p eop
PStoPSsaved restore
%%Page: (762,763) 382
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
761 762 bop 515 523 a Fk(h)p Fj(Other)28 b(public)g(metho)l(ds)h(of)e
Fi(OStr)p Fj(.)h Fk(i)p Fq(\021)676 614 y Fi(virtual)41
b(OStr)f(&operator<<\(const)j(OStrCtrl)e(c\))f({)755
706 y(\(void\)c;)755 797 y(newline\(\);)755 888 y(return)g(*this;)676
980 y(})639 1108 y Fz(Second,)23 b(utilit)n(y)g(routines)f(to)g(sp)r
(ecify)g(the)h(w)n(a)n(y)e(n)n(um)n(b)r(ers)h(are)f(prin)n(ted)h(are)f
(pro)n(vided.)515 1208 y(They)27 b(return)g(a)h(formatted)f(string)g
(whic)n(h)g(can)h(b)r(e)g(prin)n(ted)f(on)g(an)h(output)g(stream.)515
1328 y Fk(h)p Fj(Output)g(str)l(e)l(am)h(utilities.)e
Fk(i)p Fq(\021)598 1511 y Fi(//)39 b(Returns)i(a)f(printable)h
(representation)h(of)e(the)g(given)g(number.)598 1602
y(extern)g(inline)h(char)f(*fmt\(const)i(char)e(*fs,)g(const)g
(unsigned)h(int)f(n\){)676 1694 y(static)h(char)f
(buf[OFF_FMT_NSTR_MAX];)676 1785 y(sprintf\(buf,fs,n\);)676
1876 y(return)h(buf;)598 1968 y(})639 2279 y Fz(W)-7
b(e)28 b(no)n(w)f(ha)n(v)n(e)g Fx(OFF)p 1284 2279 27
4 v 30 w(FMT)p 1446 2279 V 30 w(NSTR)p 1652 2279 V 30
w(MAX)f Fz(as)h(a)g(new)h(system)f(limit.)515 2389 y
Fk(h)p Fj(O\013)g(limits.)f Fk(i)p Fz(+)p Fq(\021)598
2480 y Fi(const)40 b(int)g(OFF_FMT_NSTR_MAX=)j(32;)79
b(//)40 b(max)g(length)g(for)g(a)g(formatted)h(number)g(string.)515
2619 y Fk(h)p Fj(Console)28 b(output)h(str)l(e)l(am)g(dep)l(endencies.)
g Fk(i)p Fq(\021)598 2711 y Fi(#include)41 b(<klib/limits.h>)317
b(//)40 b(for)g(OFF_FMT_NSTR_MAX)639 2839 y Fz(This)28
b(concrete)f(sub)r(class)f(uses)i(the)g(in-k)n(ernel)e
Fx(printf)f Fz(routine)j(to)f(do)g(its)h(job.)515 2949
y Fk(h)p Fj(Console)g(output)h(str)l(e)l(am.)f Fk(i)p
Fq(\021)598 3041 y Fi(//)39 b(A)h(very)g(simple)h(console)f(output)h
(stream.)598 3132 y(//)598 3223 y(class)f(ConsOStr)h(:)f(public)g(OStr)
g({)598 3315 y(private:)676 3406 y(off_Lockable)i(lock;)598
3497 y(protected:)676 3589 y(//)e(Prints)g(the)g(given)h(string.)676
3680 y(void)f(print\(const)i(char)e(*s\))g({)g(lock.w_lock\(\);)i
(printf\("\045s",s\);)h(lock.w_unlock\(\);})676 3771
y(//)d(Starts)g(a)g(new)g(line.)676 3863 y(virtual)h(void)f
(newline\(void\))i({)e(printf\("\\n"\);)i(})676 3954
y(//)e(Prints)g(the)g(given)h(number)f(in)g(hexa)676
4045 y(virtual)h(void)f(printh\(const)i(unsigned)f(int)79
b(i\))40 b({)755 4137 y(lock.w_lock\(\);)i(printf\("\04508x",i\);)h
(lock.w_unlock\(\);)g(})676 4228 y(//)d(Prints)g(the)g(given)h(number)f
(in)g(dec)676 4319 y(virtual)h(void)f(printd\(const)i(unsigned)f(int)79
b(i\))40 b({)755 4411 y(lock.w_lock\(\);)i(printf\("\045d",i\);)h
(lock.w_unlock\(\);})598 4593 y(};)515 4824 y Fk(h)p
Fj(Console)28 b(output)h(str)l(e)l(am)g(dep)l(endencies.)g
Fk(i)p Fz(+)p Fq(\021)598 4915 y Fi(#include)41 b(<stdio.h>)551
b(//)40 b(for)g(printf)g(et)g(al)598 5006 y(#include)h
(<klib/Lockable.h>)239 b(//)40 b(for)g(off_Lockable)1885
5255 y Fz(761)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
762 763 bop 639 523 a Fz(There)27 b(is)h(a)f Fx(ConsOStr)d
Fz(de\014ned)k(staticly)-7 b(.)37 b(It)28 b(is)f(named)h
Fx(kcout)p Fz(.)515 755 y Fn(6.5.1)112 b(Simple)36 b(output)h(streams)g
(for)h(users)515 900 y Fk(h)p Fj(Console)28 b(output)h(str)l(e)l(am)g
(for)e(users.)i Fk(i)p Fq(\021)598 992 y Fi(//)39 b(A)h(very)g(simple)h
(console)f(output)h(stream)g(for)f(users.)598 1083 y(//)598
1174 y(class)g(ConsOStr)h(:)f(public)g(OStr)g({)598 1266
y(protected:)676 1357 y(//)g(Prints)g(the)g(given)h(string.)676
1448 y(void)f(print\(const)i(char)e(*s\))g({)g(\(void\)s;)h(})676
1540 y(//)f(Starts)g(a)g(new)g(line.)676 1631 y(virtual)h(void)f
(newline\(void\))i({)e(;)f(})676 1722 y(//)h(Prints)g(the)g(given)h
(number)f(in)g(hexa)676 1814 y(virtual)h(void)f(printh\(const)i
(unsigned)f(int)79 b(i\))40 b({)715 1905 y(\(void\)i;)81
b(})676 1996 y(//)40 b(Prints)g(the)g(given)h(number)f(in)g(dec)676
2088 y(virtual)h(void)f(printd\(const)i(unsigned)f(int)79
b(i\))40 b({)f(\(void\)i;)i(})598 2179 y(};)515 2445
y Fk(h)p Fj(Output)28 b(str)l(e)l(am)h(utilities)f(for)f(users.)i
Fk(i)p Fq(\021)598 2536 y Fi(//)39 b(Returns)i(a)f(printable)h
(representation)h(of)e(the)g(given)g(number.)598 2627
y(extern)g(inline)h(char)f(*fmt\(const)i(char)e(*fs,)g(const)g
(unsigned)h(int)f(n\){)676 2719 y(\(void\)fs;)h(\(void\)n;)676
2810 y(return)g("foo";)598 2901 y(})1885 5255 y Fz(762)p
eop
PStoPSsaved restore
%%Page: (764,765) 383
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
763 764 bop 515 523 a Fn(6.5.2)112 b(Simple)36 b(output)h(streams)g
Fd(C)8 b FC(++)38 b Fn(source)g(\014les)515 676 y Fz(These)33
b(simple)h(streams)e(are)g(k)n(ept)i(in)g Fx(klib/str.h)29
b Fz(and)k Fx(klib/str.C)p Fz(.)d(The)j(only)g(de-)515
776 y(p)r(endency)28 b(is)f Fx(stdio.h)e Fz(for)i(the)h
Fx(ConOStr)p Fz(.)515 909 y Fk(h)p Fj(str.h*)11 b Fk(i)q
Fq(\021)598 1000 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)
l(de)g(inste)l(ad)f(warning.)g Fk(i)598 1091 y Fi(#ifndef)41
b(__S_STR_H)598 1183 y(#define)g(__S_STR_H)g(1)598 1457
y Fk(h)p Fj(Console)28 b(output)h(str)l(e)l(am)g(dep)l(endencies.)g
Fk(i)598 1548 y(h)p Fj(Output)f(str)l(e)l(am)h(new)f(line.)f
Fk(i)598 1639 y(h)p Fj(Output)h(str)l(e)l(am.)h Fk(i)598
1731 y Fi(#ifdef)40 b(__KERNEL__)598 1822 y Fk(h)p Fj(Console)28
b(output)h(str)l(e)l(am.)f Fk(i)598 1913 y(h)p Fj(Output)g(str)l(e)l
(am)h(utilities.)e Fk(i)598 2005 y Fi(#else)598 2096
y Fk(h)p Fj(Console)h(output)h(str)l(e)l(am)g(for)e(users.)i
Fk(i)598 2187 y(h)p Fj(Output)f(str)l(e)l(am)h(utilities)f(for)f
(users.)i Fk(i)598 2279 y Fi(#endif)40 b(//)g(__KERNEL__)598
2461 y(extern)g(ConsOStr)h(kcout;)237 b(//)40 b(Simple)g(kernel)h
(console)g(ouput)f(stream.)598 2827 y(#endif)g(//)g(__S_STR_H)515
3001 y Fk(h)p Fj(str.C*)11 b Fk(i)p Fq(\021)598 3092
y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l
(ad)f(warning.)g Fk(i)598 3275 y Fi(#include)41 b(<klib/str.h>)277
b(//)40 b(Exported)h(interface.)598 3458 y Fk(h)p Fj(Output)28
b(str)l(e)l(am)h(new)f(line)f(initializer.)g Fk(i)598
3549 y Fi(ConsOStr)41 b(kcout;)1885 5255 y Fz(763)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
764 765 bop 515 523 a Fr(6.6)135 b(Small)46 b(utilit)l(y)g(functions)
515 705 y Fz(W)-7 b(e)24 b(main)n(tain)g(in)g(the)g(k)n(ernel)f
(library)g(small)h(utilities)g(whic)n(h)g(are)f(used)h(elsewhere)f(in)i
(the)515 805 y(system.)515 1033 y Fn(6.6.1)112 b(F)-9
b(reezing)37 b(strings)g(in)m(to)f(user)i(bu\013ers)515
1186 y Fz(When)30 b(a)e(system)h(resource)f(m)n(ust)h(freeze)g(a)g(\\)p
Fx(char*)p Fz(",)e(it)i(uses)g(one)g(of)g(these)h(functions.)515
1286 y(Both)25 b(of)h(them)h(cop)n(y)e(the)h(string)f(v)-5
b(alue)26 b(in)n(to)g(the)g(giv)n(en)f(bu\013er.)37 b(The)26
b(\014rst)f(one)h(will)g(also)515 1385 y(\014x)g(the)h
Fx(char*)e Fz(passed)h(to)g(b)r(e)h(the)g(relativ)n(e)f(p)r(osition)g
(in)h(bu\013er)g(where)f(the)h(cop)n(y)f(starts.)515
1509 y Fk(h)p Fj(O\013)h(string)h(fr)l(e)l(eze)h(utility.)e
Fk(i)p Fq(\021)598 1600 y Fi(//)39 b(Freezes)i(str)f(into)g(buf)g(at)g
(curbuf.)598 1691 y(//)f(Adjusts)i(curbuf)g(and)f(avail.)598
1783 y(//)f(Returns)i(FALSE)g(when)f(not)g(enough)g(space)h(is)e
(available.)598 1874 y(boolean_t)i(freeze\(const)h(char)e(*&str,)h
(char)f(*buf,)g(char)g(*&curbuf,)i(size_t)e(&avail\);)598
1965 y(//)f(Freezes)i(str)f(into)g(buf)g(at)g(curbuf.)598
2057 y(//)f(Returns)i(FALSE)g(when)f(not)g(enough)g(space)h(is)e
(available.)598 2148 y(boolean_t)i(freeze\(const)h(char)e(*str,)g(char)
h(*&curbuf,)g(size_t)f(&avail\);)515 2395 y Fk(h)p Fj(O\013)27
b(string)h(fr)l(e)l(eze)h(utility)f(dep)l(endencies.)h
Fk(i)p Fq(\021)598 2486 y Fi(#include)41 b(<klib/mdep/types.h>)161
b(//)40 b(for)g(boolean_t,)h(size_t)g(et)e(al.)639 2618
y Fz(It)20 b(is)f(a)g(generic)f(utilit)n(y)i(function)g(whic)n(h)f
(stores)f(the)i(giv)n(en)e(argumen)n(t)g(in)n(to)h(the)h(bu\013er,)515
2717 y(adv)-5 b(ancing)33 b(the)i(bu\013er)g(p)r(oin)n(ter,)h
(subtracting)e(the)h(newly)f(stored)g(size)g(and)g(\(the)h(\014rst)515
2817 y(one\))c(adjusting)h(the)g(p)r(oin)n(ter)f(to)g(the)h(argumen)n
(t)f(giv)n(en)f(so)h(that)h(it)g(is)g(a)f(relativ)n(e)f(v)-5
b(alue)515 2916 y(in)n(to)27 b(buf.)639 3016 y(W)-7 b(e)28
b(implemen)n(t)g(\014rst)g(the)g(last)f(one.)515 3128
y Fk(h)p Fj(O\013)g(string)h(fr)l(e)l(eze)h(utility)f(implementation.)f
Fk(i)p Fq(\021)598 3219 y Fi(//)39 b(Freezes)i(str)f(into)g(buf)g(at)g
(curbuf.)598 3310 y(//)f(Adjusts)i(curbuf)g(and)f(avail.)598
3402 y(//)f(Returns)i(FALSE)g(when)f(not)g(enough)g(space)h(is)e
(available.)598 3493 y(boolean_t)i(freeze\(const)h(char)e(*str,)80
b(char)40 b(*&curbuf,)h(size_t)g(&avail\))598 3584 y({)676
3676 y(size_t)g(len;)676 3767 y(assert\(str)h(&&)d(curbuf\);)676
3858 y(if)h(\(\(len=strlen\(str\)\)>=avail\))755 3949
y(return)g(FALSE;)676 4041 y(else)g({)755 4132 y(len++;)864
b(//)40 b(for)g(the)g(trailing)h(zero.)755 4223 y
(strncpy\(curbuf,str,len\);)755 4315 y(avail)f(-=)g(len;)755
4406 y(curbuf)g(+=)g(len;)755 4497 y(return)g(TRUE;)676
4589 y(})598 4680 y(})515 4915 y Fk(h)p Fj(O\013)27 b(string)h(fr)l(e)l
(eze)h(utility)f(dep)l(endencies.)h Fk(i)p Fz(+)o Fq(\021)598
5006 y Fi(#include)41 b(<assert.h>)512 b(//)40 b(for)g(assert)1885
5255 y Fz(764)p eop
PStoPSsaved restore
%%Page: (766,767) 384
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
765 766 bop 515 523 a Fk(h)p Fj(O\013)27 b(string)h(fr)l(e)l(eze)h
(utility)f(implementation.)f Fk(i)p Fz(+)p Fq(\021)598
614 y Fi(//)39 b(Freezes)i(str)f(into)g(buf)g(at)g(curbuf.)598
706 y(//)f(Adjusts)i(curbuf)g(and)f(avail.)g(Makes)h(str)f(a)f
(relative)i(ptr)f(into)g(buf.)598 797 y(//)f(Returns)i(FALSE)g(when)f
(not)g(enough)g(space)h(is)e(available.)598 888 y(boolean_t)i
(freeze\(const)h(char)e(*&str,)h(char)f(*buf,)g(char)g(*&curbuf,)i
(size_t)e(&avail\))598 980 y({)676 1071 y(assert\(str)i(&&)d(buf)h(&&)g
(curbuf\);)676 1162 y(if)g(\(freeze\(str,curbuf,avail\)\){)755
1254 y(str=\(char*\)\(curbuf-buf\);)755 1345 y(return)g(TRUE;)676
1436 y(})676 1528 y(else)755 1619 y(return)g(FALSE;)598
1710 y(})639 1943 y Fz(These)28 b(routines)f(ha)n(v)n(e)f(coun)n
(terpart)g Fx(melt)p Fz(s)g(to)h(reco)n(v)n(er)e(frozen)i(strings.)515
2076 y Fk(h)p Fj(O\013)g(string)h(melt)g(utility.)f Fk(i)p
Fq(\021)598 2167 y Fi(//)39 b(Melts)i(\(and)f(allocates)h(memory)g(for)
f(it\))g(str)g(from)g(buf.)598 2258 y(//)f(Str)h(must)g(be)g(a)g
(relative)h(prt)f(into)g(buf.)598 2350 y(char)g(*melt\(char)h(*str,)g
(char)f(*buf,)g(size_t)h(size\);)598 2532 y(//)e(Returns)i(a)f(melted)g
(str)g(from)g(curbuf)h(of)f(length)g(size.)598 2623 y(//)f(Adjusts)i
(curbuf)g(and)f(size.)598 2715 y(char)g(*melt\(char)h(*&curbuf,)h
(size_t)e(&size\);)639 2947 y Fz(Again,)27 b(w)n(e)h(implemen)n(t)g
(\014rst)f(the)h(last)g(one.)515 3064 y Fk(h)p Fj(O\013)f(string)h
(melt)g(utility)f(implementation.)h Fk(i)p Fq(\021)598
3155 y Fi(//)39 b(Returns)i(a)f(melted)g(str)g(from)g(curbuf)h(of)f
(length)g(size.)598 3246 y(//)f(Adjusts)i(curbuf)g(and)f(size.)598
3337 y(char)g(*melt\(char)h(*&curbuf,)h(size_t)e(&size\))598
3429 y({)676 3520 y(char)g(*s=curbuf;)676 3611 y(if\(s\){)755
3703 y(int)g(len=strlen\(s\)+1;)755 3794 y(size)g(-=)f(len;)755
3885 y(curbuf)h(+=)g(len;)676 3977 y(})676 4068 y(return)h(s;)598
4159 y(})1885 5255 y Fz(765)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
766 767 bop 515 523 a Fk(h)p Fj(O\013)27 b(string)h(melt)g(utility)f
(implementation.)h Fk(i)p Fz(+)o Fq(\021)598 614 y Fi(//)39
b(Melts)i(\(and)f(allocates)h(memory)g(for)f(it\))g(str)g(from)g(buf.)
598 706 y(//)f(Str)h(must)g(be)g(a)g(relative)h(prt)f(into)g(buf.)598
797 y(char)g(*melt\(char)h(*str,)g(char)f(*buf,)g(size_t)h(size\))598
888 y({)676 980 y(if)f(\(size<=\(natural_t\)str\))755
1071 y(return)g(NULL;)676 1162 y(return)h
(strdup\(buf+\(\(natural_t\)str\)\);)598 1254 y(})515
1519 y Fk(h)p Fj(O\013)27 b(string)h(fr)l(e)l(eze)h(utility)f
(implementation)g(dep)l(endencies.)h Fk(i)p Fq(\021)598
1611 y Fi(#include)41 b(<string.h>)512 b(//)40 b(for)g(strncpy,)h
(strlen)f(et)g(al.)515 1868 y FA(freezing)31 b(utilities)f
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 2021 y Fz(The)k(co)r(de)g
(sho)n(wn)f(ab)r(o)n(v)n(e)f(is)i(k)n(ept)g(in)g Fx(klib/freeze.h)31
b Fz(and)36 b Fx(klib/freeze.C)p Fz(,)30 b(along)515
2121 y(with)e Fx(request)p 1017 2121 27 4 v 28 w(melt)e
Fz(utilities.)515 2254 y Fk(h)p Fj(fr)l(e)l(eze.h*)11
b Fk(i)q Fq(\021)598 2345 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2436 y Fi(#ifndef)41 b(__FREEZE_H)598 2528 y(#define)g(__FREEZE_H)g(1)
598 2710 y Fk(h)p Fj(O\013)27 b(string)h(fr)l(e)l(eze)h(utility)f(dep)l
(endencies.)h Fk(i)598 2802 y(h)p Fi(request)p 906 2802
24 4 v 29 w(melt)g Fj(utilities)e(dep)l(endencies.)i
Fk(i)598 3076 y(h)p Fj(O\013)e(string)h(fr)l(e)l(eze)h(utility.)e
Fk(i)598 3167 y(h)p Fj(O\013)g(string)h(melt)g(utility.)f
Fk(i)598 3258 y(h)p Fi(request)p 906 3258 V 29 w(melt)i
Fj(utilities.)e Fk(i)598 3350 y(h)p Fj(Other)h(utilities)g(for)f
Fi(freeze)p Fj(.)h Fk(i)598 3532 y Fi(#endif)40 b(//)g(__FREEZE_H)515
3707 y Fk(h)p Fj(fr)l(e)l(eze.C*)11 b Fk(i)p Fq(\021)598
3798 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3981 y Fi(#include)41
b(<klib/freeze.h>)317 b(//)40 b(Exported)h(interface.)598
4072 y Fk(h)p Fj(O\013)27 b(string)h(fr)l(e)l(eze)h(utility)f
(implementation)g(dep)l(endencies.)h Fk(i)598 4163 y(h)p
Fi(request)p 906 4163 V 29 w(melt)g Fj(utility)e(implementation)h(dep)l
(endencies.)h Fk(i)598 4346 y(h)p Fj(O\013)e(string)h(fr)l(e)l(eze)h
(utility)f(implementation.)f Fk(i)598 4437 y(h)p Fj(O\013)g(string)h
(melt)g(utility)g(implementation.)f Fk(i)598 4528 y(h)p
Fi(request)p 906 4528 V 29 w(melt)i Fj(utility)e(implementation.)h
Fk(i)1885 5255 y Fz(766)p eop
PStoPSsaved restore
%%Page: (768,769) 385
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
767 768 bop 515 523 a Fn(6.6.2)112 b(Signing)37 b(frozen)g(resources)
515 676 y Fz(T)-7 b(o)32 b(sing)g(frozen)g(resources)f(these)i
(functions)g(are)e(pro)n(vided.)52 b(The)32 b(\014rst)h(t)n(w)n(o)f
(ones)g(will)515 776 y(sign)g(the)g(bu\013er\(s\))h(giv)n(en)e(b)n(y)h
(the)h(user.)50 b(The)33 b(last)f(ones)f(c)n(hec)n(ks)g(the)i(in)n
(tegrit)n(y)e(of)i(the)515 876 y(signed)27 b(bu\013er.)639
975 y(As)32 b(of)g(to)r(da)n(y)f(they)g(do)h(nothing.)49
b(They)31 b(should)h(b)r(e)g(c)n(hanged)e(to)i(emplo)n(y)f(a)g(secure)
515 1075 y(signing)c(algorithm.)515 1191 y Fk(h)p Fj(O\013)g(sign)h
(utilities.)f Fk(i)o Fq(\021)598 1282 y Fi(//)39 b(Signs)i(a)e(single)i
(user)f(bufer)g(in)g(a)f(sign-buffer.)598 1374 y(//)g(Returns)i(FALSE)g
(when)f(failed)g(due)g(to)g(insufficient)i(space)e(in)g(the)g
(sign-buffer.)598 1465 y(inline)g(boolean_t)i(sign\(char)f(*&signbuf,)g
(size_t)g(&sblen,)g(char)f(*buf,)g(size_t)h(len\))f({)637
1556 y(\(void\)signbuf;)i(\(void\)sblen;)g(\(void\)buf;)g(\(void\)len;)
676 1648 y(return)f(TRUE;)f(})598 1739 y(//)f(The)h(same)g(but)g(for)g
(a)g(couple)g(of)g(buffers.)598 1830 y(inline)g(boolean_t)i(sign\(char)
f(*&signbuf,)g(size_t)g(&sblen,)1186 1922 y(char)f(*b1,)g(size_t)h(l1,)
f(char)g(*b2,)g(size_t)h(l2\))f({)676 2013 y(\(void\)signbuf;)j
(\(void\)sblen;)f(\(void\)b1;)f(\(void\)l1;)g(\(void\)b2;)g
(\(void\)l2;)676 2104 y(return)g(TRUE;)598 2196 y(})598
2378 y(//)e(Was)h(this)g(the)g(signed)h(buffer?)598 2470
y(inline)f(boolean_t)i(sign_ok\(char)g(*signbuf,)f(size_t)f(sblen,)h
(char)f(*buf,)h(size_t)f(len\))g({)676 2561 y(\(void\)signbuf;)j
(\(void\)sblen;)f(\(void\)buf;)f(\(void\)len;)676 2652
y(return)g(TRUE;)598 2744 y(})598 2835 y(inline)f(boolean_t)i
(sign_ok\(char)g(*signbuf,)f(size_t)f(sblen,)1304 2926
y(char)g(*b1,)g(size_t)h(l1,)f(char)g(*b2,)g(size_t)g(l2\))g({)676
3018 y(\(void\)signbuf;)j(\(void\)sblen;)f(\(void\)b1;)f(\(void\)l1;)g
(\(void\)b2;)g(\(void\)l2;)676 3109 y(return)g(TRUE;)598
3200 y(})515 3449 y Fk(h)p Fj(O\013)27 b(sign)h(utilities)f(dep)l
(endencies.)i Fk(i)p Fq(\021)598 3541 y Fi(#include)41
b(<klib/mdep/types.h>)161 b(//)40 b(for)g(boolean_t,)h(size_t)g(et)e
(al.)515 3798 y FA(Signature)32 b Fg(C)7 b Fx(++)30 b
FA(source)i(\014les)515 3951 y Fz(These)27 b(utilities)h(are)f(k)n(ept)
g(in)h Fx(klib/sign.h)515 4084 y Fk(h)p Fj(sign.h*)11
b Fk(i)p Fq(\021)598 4175 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4267 y Fi(#ifndef)41 b(__SIGN_H)598 4358 y(#define)g(__SIGN_H)598
4541 y Fk(h)p Fj(O\013)27 b(sign)h(utilities)f(dep)l(endencies.)i
Fk(i)598 4723 y(h)p Fj(O\013)e(sign)h(utilities.)f Fk(i)598
4906 y Fi(#endif)40 b(//)g(__SIGN_H)1885 5255 y Fz(767)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
768 769 bop 515 523 a Fr(6.7)135 b(Miscellaneous)46 b(x86)g(dep)t
(enden)l(t)e(utilities)515 721 y Fn(6.7.1)112 b(Common)37
b(data)h(t)m(yp)s(es)515 875 y Fz(They)27 b(are)g(pro)n(vided)f(b)n(y)i
(the)g(OSKit)o(.)515 1008 y Fk(h)p Fj(mdep)f(typ)l(es.h*)11
b Fk(i)r Fq(\021)598 1099 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
1190 y Fi(#include)41 b(<flux/types.h>)356 b(//)40 b(Mach)g(dep)g
(types)515 1464 y Fn(6.7.2)112 b(Mac)m(hine)38 b(dep)s(enden)m(t)h
(iden)m(ti\014ers)515 1617 y Fz(W)-7 b(e)20 b(m)n(ust)g(de\014ne)f
Fx(off)p 1216 1617 27 4 v 31 w(mdep)p 1423 1617 V 29
w(offset)p 1716 1617 V 29 w(t)g Fz(to)h(matc)n(h)f(the)h(largest)f(ph)n
(ysical)f(resource)g(name.)515 1717 y(This)27 b(de\014nition)h(is)g(k)n
(ept)f(in)h Fx(klib/mdep/ids.h)p Fz(.)515 1850 y Fk(h)p
Fj(mdep)f(ids.h*)11 b Fk(i)p Fq(\021)598 1941 y Fi(#ifndef)41
b(__OFF_MDEP_IDS_H)598 2032 y(#define)g(__OFF_MDEP_IDS_H)h(1)598
2215 y(#include)f(<klib/mdep/types.h>)161 b(//)40 b(for)g(unsigned32_t)
598 2398 y(typedef)h(unsigned32_t)h(off_mdep_offset_t;)598
2580 y(#endif)e(//)g(__OFF_MDEP_IDS_H)515 2854 y Fn(6.7.3)112
b(Spin)37 b(lo)s(c)m(ks)515 2999 y Fk(h)p Fj(mdep)27
b Fi(rw)p 831 2999 24 4 v 29 w(spin)p 1016 2999 V 29
w(lock.h)p Fj(*)11 b Fk(i)r Fq(\021)598 3091 y Fk(h)p
Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g(inste)l(ad)f
(warning.)g Fk(i)598 3182 y Fi(#include)41 b
(<flux/machine/rw_spin_lock.h>)46 b(//)39 b(spin)h(locks.)515
3456 y Fn(6.7.4)112 b(Debug)38 b(utilities)515 3601 y
Fk(h)p Fj(mdep)27 b(debug.h*)11 b Fk(i)r Fq(\021)598
3692 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l(de)g
(inste)l(ad)f(warning.)g Fk(i)598 3783 y Fi(#include)41
b(<flux/debug.h>)598 3875 y(#include)g(<flux/gdb_serial.h>)161
b(//)40 b(for)g(gdb_serial_exit)598 3966 y(#include)h
(<flux/machine/direct_cons.h>)k(//)40 b(for)g(direct_cons_putchar)515
4331 y Fn(6.7.5)112 b(Bit)36 b(op)s(erations)h(and)i(atomic)d(coun)m
(ter)h(op)s(erations)515 4476 y Fk(h)p Fj(mdep)27 b(bitops.h*)11
b Fk(i)q Fq(\021)598 4568 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
4659 y Fi(#include)41 b(<flux/machine/bitops.h>)j(//)c(for)g
(set_,clear_)i(and)d(test_bit)598 4750 y(#include)i
(<flux/machine/atomic.h>)j(//)c(for)g(atomic_inc)h(et)f(al.)1885
5255 y Fz(768)p eop
PStoPSsaved restore
%%Page: (770,771) 386
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
769 770 bop 515 523 a Fn(6.7.6)112 b(Mac)m(hine)38 b(dep)s(enden)m(t)h
(stac)m(ks)515 676 y Fz(T)-7 b(o)20 b(isolate)f(the)i(system)f(from)g
(stac)n(k)f(details)h(\(gro)n(wing)e(direction,)k(etc.\))35
b(w)n(e)19 b(use)h(mac)n(hine)515 776 y(dep)r(enden)n(t)25
b(stac)n(k)f(ob)5 b(jects.)35 b(No)25 b(matter)f(the)h(mac)n(hine)f
(con)n(v)n(en)n(tion,)g(it)h(can)g(b)r(e)g(assumed)515
876 y(that)j(a)f(stac)n(k)f(gro)n(ws)g(from)h(high)h(to)f(lo)n(w)g
(addresses)f(if)i(this)g(class)f(is)g(used.)515 1008
y Fk(h)p Fj(O\013)g(machine)h(dep)l(endent)h(stack.)g
Fk(i)p Fq(\021)598 1100 y Fi(//)39 b(A)h(machine)h(dependent)g(stack.)
598 1191 y(//)598 1282 y(class)f(off_mdepStck)i({)598
1374 y(protected:)676 1465 y(vm_offset_t)g(s_sp;)589
b(//)40 b(stack)h(pointer.)676 1556 y Fk(h)p Fj(Other)29
b(pr)l(ote)l(cte)l(d)h(metho)l(ds)f(of)e Fi(off)p 1755
1556 24 4 v 29 w(mdepStck)p Fj(.)i Fk(i)598 1648 y Fi(public:)676
1739 y(//)40 b(Creates)h(an)e(mdep)80 b(stack)40 b(which)g(pretends)i
(to)d(grow)h(downwards.)676 1830 y(off_mdepStck\(const)k(vm_offset_t)d
(sp=0\))g(:)e(s_sp\(sp\))i({})676 2013 y Fk(h)p Fj(Other)29
b(public)e(metho)l(ds)i(of)e Fi(off)p 1654 2013 V 29
w(mdepStck)p Fj(.)i Fk(i)598 2104 y Fi(};)639 2337 y
Fz(A)24 b(stac)n(k)e(\(whic)n(h)i(is)f(an)g(stac)n(k)f(p)r(oin)n(ter\))
i(can)f(b)r(e)g(con)n(v)n(erted)f(to)h(a)g(p)r(oin)n(ter)g(to)g(mac)n
(hine)515 2436 y(w)n(ords.)515 2553 y Fk(h)p Fj(Other)28
b(public)g(metho)l(ds)h(of)e Fi(off)p 1493 2553 V 29
w(mdepStck)p Fj(.)i Fk(i)o Fq(\021)598 2644 y Fi(operator)41
b(vm_offset_t*\(void\){)676 2735 y(assert\(sizeof\(vm_offset_t\)==)q
(sizeo)q(f\(vm)q(_off)q(set_t)q(*\)\);)676 2827 y(return)g
(\(vm_offset_t*\)s_sp;)598 2918 y(})598 3009 y(operator)g
(natural_t\(void\){)676 3101 y(assert\(sizeof\(natural_t\)==si)q
(zeof\()q(vm_o)q(ffse)q(t_t\)\))q(;)676 3192 y(return)g
(\(natural_t\)s_sp;)598 3283 y(})515 3532 y Fk(h)p Fj(O\013)27
b(machine)h(dep)l(endent)h(stack)g(dep)l(endencies.)h
Fk(i)p Fq(\021)598 3624 y Fi(#include)41 b(<flux/types.h>)356
b(//)40 b(for)g(vm_offset_t)h(et)f(al.)598 3715 y(#include)h
(<assert.h>)512 b(//)40 b(for)g(assert)639 3856 y Fz(On)30
b(In)n(tels,)h(the)g(stac)n(k)f(gro)n(ws)e(to)i(the)h(left)g(\(to)g(lo)
n(w)e(addresses\).)44 b(This)31 b(metho)r(d)f(can)515
3956 y(b)r(e)e(used)f(to)h(c)n(hec)n(k)e(the)i(stac)n(k)f(direction.)
515 4072 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 4072 V 29 w(mdepStck)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 4163 y Fi(inline)40 b(static)h(boolean_t)g
(grows_to_right\(void\);)515 4321 y Fk(h)p Fi(off)p 667
4321 V 29 w(mdepStck::grows)p 1281 4321 V 31 w(to)p 1390
4321 V 29 w(right)28 b Fj(implementation.)g Fk(i)p Fq(\021)598
4412 y Fi(//)39 b(On)h(intels)h(stack)f(grow)g(right)h(to)e(left)h
(\(hi)g(to)g(lo\).)598 4504 y(inline)g(boolean_t)i
(off_mdepStck::grows_to_right\(vo)q(id\))k({)39 b(return)i(FALSE;)f(})
1885 5255 y Fz(769)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
770 771 bop 639 523 a Fz(The)28 b(common)f(op)r(erators)f(are)g(pro)n
(vided)h(to)g(do)h(p)r(oin)n(ter)f(arithmetic.)515 639
y Fk(h)p Fj(Other)h(public)g(metho)l(ds)h(of)e Fi(off)p
1493 639 24 4 v 29 w(mdepStck)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 731 y Fi(//)39 b(Common)i(stack)f(operators.)598
822 y(off_mdepStck)i(operator+\(vm_size_t)h(s\))d(const)637
913 y({)f(return)i(off_mdepStck\(s_sp+s\);)j(})598 1005
y(off_mdepStck)e(operator-\(vm_size_t)h(s\))d(const)637
1096 y({)f(return)i(off_mdepStck\(s_sp-s\);)j(})598 1187
y(off_mdepStck)e(&operator++\(void\))637 1279 y({)d(s_sp++;)i(return)g
(*this;)f(})598 1370 y(off_mdepStck)i(&operator--\(void\))637
1461 y({)d(s_sp--;)i(return)g(*this;)f(})598 1553 y(off_mdepStck)i
(&operator+=\(const)h(vm_size_t)e(s\))637 1644 y({)e(s_sp+=s;)i(return)
g(*this;)g(})598 1735 y(off_mdepStck)h(&operator-=\(const)h(vm_size_t)e
(s\))637 1826 y({)e(s_sp-=s;)i(return)g(*this;)g(})598
1918 y(boolean_t)g(operator<\(const)i(off_mdepStck)f(a_stck\))e(const)
637 2009 y({)79 b(return)40 b(s_sp)g(<)g(a_stck.s_sp;)i(})598
2100 y(boolean_t)f(operator>\(const)i(off_mdepStck)f(a_stck\))e(const)
637 2192 y({)79 b(return)40 b(s_sp)g(>)g(a_stck.s_sp;)i(})598
2283 y(boolean_t)f(operator<=\(const)i(off_mdepStck)f(a_stck\))f(const)
637 2374 y({)79 b(return)40 b(s_sp)g(<=)g(a_stck.s_sp;)i(})598
2466 y(boolean_t)f(operator>=\(const)i(off_mdepStck)f(a_stck\))f(const)
637 2557 y({)79 b(return)40 b(s_sp)g(>=)g(a_stck.s_sp;)i(})1885
5255 y Fz(770)p eop
PStoPSsaved restore
%%Page: (772,773) 387
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
771 772 bop 639 523 a Fz(Usual)28 b(stac)n(k)e(op)r(erations)h(are)f
(pro)n(vided)h(to)r(o.)515 639 y Fk(h)p Fj(Other)h(public)g(metho)l(ds)
h(of)e Fi(off)p 1493 639 24 4 v 29 w(mdepStck)p Fj(.)i
Fk(i)o Fz(+)p Fq(\021)598 731 y Fi(off_mdepStck)42 b(&pushb\(const)g
(unsigned8_t)f(i\))598 822 y({s_sp-=sizeof\(unsigned8_t\);)k
(*\(unsigned8_t*\)s_sp=\(vm_offse)q(t_t\))q(i;)598 913
y(return)40 b(*this;})598 1005 y(off_mdepStck)i(&pushs\(const)g
(unsigned16_t)g(i\))598 1096 y({s_sp-=sizeof\(unsigned16_t\);)j
(*\(unsigned16_t*\)s_sp=\(vm_off)q(set_)q(t\)i;)598 1187
y(return)40 b(*this;})598 1279 y(off_mdepStck)i(&push\(const)f
(unsigned32_t)h(i\))598 1370 y({s_sp-=sizeof\(unsigned32_t\);)j
(*\(unsigned32_t*\)s_sp=\(vm_off)q(set_)q(t\)i;)598 1461
y(return)40 b(*this;})598 1553 y(off_mdepStck)i(&pushd\(const)g
(unsigned64_t)g(i\))598 1644 y({s_sp-=sizeof\(unsigned64_t\);)j
(*\(unsigned64_t*\)s_sp=\(vm_off)q(set_)q(t\)i;)598 1735
y(return)40 b(*this;})598 1918 y(off_mdepStck)i(&popb\(unsigned8_t)h
(&i\))598 2009 y({i=\(unsigned8_t\)*\(vm_offset_t*)q(\)s_sp)q(;)i
(s_sp+=sizeof\(unsigned8_t\);)598 2100 y(return)40 b(*this;})598
2192 y(off_mdepStck)i(&pops\(unsigned16_t)h(&i\))598
2283 y({i=\(unsigned16_t\)*\(vm_offset_t)q(*\)s_s)q(p;)i
(s_sp+=sizeof\(unsigned16_t\);)598 2374 y(return)40 b(*this;})598
2466 y(off_mdepStck)i(&pop\(unsigned32_t)h(&i\))598 2557
y({i=\(unsigned32_t\)*\(vm_offset_t)q(*\)s_s)q(p;)i
(s_sp+=sizeof\(unsigned32_t\);)598 2648 y(return)40 b(*this;})598
2740 y(off_mdepStck)i(&popd\(unsigned64_t)h(&i\))598
2831 y({i=*\(unsigned64_t)g(*\)s_sp;)e(s_sp+=sizeof\(unsigned64_t\);)
598 2922 y(return)f(*this;})639 3138 y Fz(Where)515 3254
y Fk(h)p Fj(Other)28 b(pr)l(ote)l(cte)l(d)j(metho)l(ds)e(of)e
Fi(off)p 1594 3254 V 29 w(mdepStck)p Fj(.)i Fk(i)o Fq(\021)598
3346 y Fi(unsigned32_t)42 b(hi\(unsigned64_t)g(i\){)e(return)h
(\(\(unsigned32_t\)\(i>>32\)\);)k(})598 3437 y(unsigned32_t)d
(lo\(unsigned64_t)g(i\){)e(return)h
(\(\(unsigned32_t\)\(i&0xffffffff\)\))q(;)k(})639 3562
y Fz(This)35 b(other)f(metho)r(d)h(allo)r(cates)f(a)g(region)f(to)i
(push)g(m)n(ultiple)g(w)n(ords)e(in)i(the)g(stac)n(k)515
3661 y(and)27 b(return)g(the)h(starting)f(address)f(of)i(the)g(pushed)g
(w)n(ords.)515 3778 y Fk(h)p Fj(Other)g(public)g(metho)l(ds)h(of)e
Fi(off)p 1493 3778 V 29 w(mdepStck)p Fj(.)i Fk(i)o Fz(+)p
Fq(\021)598 3869 y Fi(void)40 b(*alloca\(vm_size_t)j(nbytes\))e({)676
3960 y(s_sp)f(-=)g(nbytes;)676 4051 y(return)h(\(void*\)s_sp;)598
4143 y(})1885 5255 y Fz(771)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
772 773 bop 515 523 a FA(Mac)m(hine)32 b(dep)s(enden)m(t)f(stac)m(ks)i
Fg(C)7 b Fx(++)31 b FA(source)h(\014les)515 676 y Fz(Stac)n(k)27
b(co)r(de)g(is)h(k)n(ept)f(in)h Fx(klib/mdep/mStck.)o(h)p
Fz(.)515 809 y Fk(h)p Fj(mdep)f(mStck.h*)11 b Fk(i)q
Fq(\021)598 900 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l(ate)h(c)l(o)l
(de)g(inste)l(ad)f(warning.)g Fk(i)598 992 y Fi(#ifndef)41
b(__OFF_MDEP_STCK_H)598 1083 y(#define)g(__OFF_MDEP_STCK_H)i(1)598
1266 y Fk(h)p Fj(O\013)27 b(machine)h(dep)l(endent)h(stack)h(dep)l
(endencies.)f Fk(i)598 1448 y(h)p Fj(O\013)e(machine)h(dep)l(endent)h
(stack.)g Fk(i)598 1631 y(h)p Fi(off)p 750 1631 24 4
v 29 w(mdepStck::grows)p 1364 1631 V 31 w(to)p 1473 1631
V 29 w(right)f Fj(implementation.)g Fk(i)598 1814 y Fi(#endif)40
b(//)g(__OFF_MDEP_STCK_H)1885 5255 y Fz(772)p eop
PStoPSsaved restore
%%Page: (774,775) 388
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
773 774 bop 515 1146 a Fs(App)5 b(endix)65 b(A)515 1561
y Fv(System)77 b(limits)515 1993 y Fz(W)-7 b(e)19 b(ha)n(v)n(e)f
(de\014ned)i(explicitly)f(certain)f(limits)i(for)f(system)f(op)r
(eration.)33 b(They)19 b(are)g(included)515 2092 y(in)28
b(the)g(\014le)f Fx(klib/limits.h)515 2225 y Fk(h)p Fj(limits.h*)11
b Fk(i)o Fq(\021)598 2316 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2408 y Fi(#ifndef)41 b(__OFF_LIMITS_H)598 2499 y(#define)g
(__OFF_LIMITS_H)h(1)598 2682 y(#include)f(<klib/mdep/limits.h>)598
2864 y(//)e(Constants)j(for)e(static)g(system)h(limits.)598
2956 y Fk(h)p Fj(O\013)27 b(limits.)f Fk(i)598 3138 y
Fi(#endif)40 b(//)g(__OFF_LIMITS_H)515 3454 y Fr(A.1)134
b(No)t(de)45 b(limits)515 3628 y Fk(h)p Fj(O\013)27 b(limits)6
b Fk(i)o Fq(\021)598 3719 y Fi(const)40 b(int)g(OFF_MBANKS_PER_ND=1;)83
b(//)40 b(Max)g(#)f(of)h(memory)g(banks)h(in)e(a)h(single)g(node)515
3894 y Fk(h)p Fj(O\013)27 b(limits)6 b Fk(i)o Fz(+)p
Fq(\021)598 3985 y Fi(const)40 b(int)g(OFF_NMODS_MAX=16;)200
b(//)40 b(Max)g(#)f(of)h(boot)g(modules.)1885 5255 y
Fz(773)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
774 775 bop 515 1146 a Fs(App)5 b(endix)65 b(B)515 1561
y Fv(System)77 b(errors)515 1993 y Fz(W)-7 b(e)31 b(ha)n(v)n(e)f
(de\014ned)i(explicitly)g(certain)e(error)f(co)r(des)i(for)g(system)g
(op)r(eration.)47 b(They)31 b(are)515 2092 y(included)d(in)g(the)g
(\014le)f Fx(klib/err.h)515 2225 y Fk(h)p Fj(err.h*)11
b Fk(i)p Fq(\021)598 2316 y Fk(h)p Fj(R)l(e)l(ad)28 b(the)g(liter)l
(ate)h(c)l(o)l(de)g(inste)l(ad)f(warning.)g Fk(i)598
2408 y Fi(#ifndef)41 b(__OFF_ERR_H)598 2499 y(#define)g(__OFF_ERR_H)g
(1)598 2682 y(#include)g(<errno.h>)551 b(//)40 b(for)g(std)g(error)g
(numbers.)598 2864 y(//)f(Constants)j(for)e(system)g(errors.)598
2956 y(enum)g({)676 3047 y(E2SHORT=0x0666,)592 b(//)40
b(Argument)h(list)f(too)g(short.)676 3138 y(ENOPRTL,)865
b(//)40 b(Null)g(portal)g(or)g(Not)g(a)f(valid)i(portal.)676
3230 y Fk(h)p Fj(Other)29 b(O\013)e(err)l(or)i(numb)l(ers.)f
Fk(i)598 3321 y Fi(};)598 3412 y(typedef)41 b(int)e(err_t;)598
3504 y(const)h(err_t)g(EOK)g(=)g(0x0000;)276 b(//)40
b(No)f(error)i(at)e(all.)598 3686 y(#endif)h(//)g(__OFF_ERR_H)1885
5255 y Fz(774)p eop
PStoPSsaved restore
%%Page: (776,777) 389
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
775 776 bop 515 1146 a Fs(App)5 b(endix)65 b(C)515 1561
y Fv(Index)77 b(of)g(Ch)-6 b(unks)1885 5255 y Fz(775)p
eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
776 777 bop 515 1146 a Fs(App)5 b(endix)65 b(D)515 1561
y Fv(Index)77 b(of)g(Iden)-6 b(ti\014ers)1885 5255 y
Fz(776)p eop
PStoPSsaved restore
%%Page: (778,779) 390
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 0.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
/showpage{}def/copypage{}def/erasepage{}def
PStoPSxform concat
777 778 bop 515 1187 a Fv(Bibliograph)-6 b(y)556 1630
y Fz([1])41 b(F)-7 b(rancisco)35 b(J.)i(Ballesteros.)61
b(O\013)36 b(w)n(eb)h(site.)63 b(h)n(ttp://www.gsyc.inf.uc3m.es/o\013,)
685 1730 y(1996.)556 1896 y([2])41 b(F)-7 b(rancisco)34
b(J.)h(Ballesteros.)57 b Fy(O\013|Un)35 b(Nuevo)i(Enfo)l(que)g(en)f(la)
i(Construc)l(cion)e(de)685 1995 y(Sistemas)k(Op)l(er)l(ativos)g
(Distribuidos)p Fz(.)70 b(PhD)38 b(thesis,)j(F)-7 b(acultad)38
b(de)g(Informatica.)685 2095 y(Univ)n(ersidad)27 b(P)n(olitecnica)f(de)
i(Madrid,)f(1998.)556 2261 y([3])41 b(F)-7 b(rancisco)27
b(J.)g(Ballesteros)f(and)i(Luis)f(L.)h(F)-7 b(ern\023)-42
b(andez.)36 b(The)28 b(Net)n(w)n(ork)e(Hardw)n(are)g(is)685
2361 y(the)j(Op)r(erating)f(System.)40 b(In)29 b Fy(Pr)l(o)l(c)l(e)l(e)
l(dings)j(of)f(the)g(6th)g(Hot)g(T)-6 b(opics)32 b(on)f(Op)l(er)l
(ating)685 2460 y(Systems)f(\(HotOS-VI\).)p Fz(,)c(Cap)r(e)i(Co)r(d,)f
(MA)h(\(USA\),)h(Ma)n(y)e(1997.)556 2626 y([4])41 b(B.N.)23
b(Bershad,)g(S.)f(Sa)n(v)-5 b(age,)22 b(P)-7 b(.)23 b(P)n(ardy)n(ak,)d
(E.G.)j(Sirer,)g(M.)f(Fiuczynski,)i(D.)f(Bec)n(k)n(er,)685
2726 y(S.)30 b(Eggers,)d(and)h(C.)h(Cham)n(b)r(ers.)40
b(Extensibilit)n(y)-7 b(,)29 b(safet)n(y)f(and)h(p)r(erformance)f(in)h
(the)685 2826 y(SPIN)i(op)r(erating)e(system.)44 b(In)30
b Fy(Pr)l(o)l(c)l(e)l(e)l(dings)j(of)g(the)f(Fifte)l(enth)h(A)n(CM)g
(Symp)l(osium)685 2925 y(on)d(Op)l(er)l(ating)g(Systems)f(Principles)p
Fz(.)h(A)n(CM,)e(Decem)n(b)r(er)f(1995.)556 3091 y([5])41
b(Ro)n(y)19 b(H.)i(Campb)r(ell,)g(F)-7 b(rancisco)19
b(J.)g(Ballesteros,)h(F)-7 b(abio)19 b(Kon,)i(Ashish)f(Singhai,)h(Dul-)
685 3191 y(cineia)i(Carv)-5 b(alho,)23 b(and)h(Rob)r(ert)f(Mo)r(ore.)29
b(2k:)34 b(A)24 b(distributed)f(adaptable)g(op)r(erating)685
3290 y(system.)37 b(h)n(ttp://c)n(hoices.cs.uiuc.edu/2k,)25
b(August)j(1997.)556 3457 y([6])41 b(John)36 b(B.)g(Carter,)h(Dilip)g
(Khandek)-5 b(ar,)37 b(and)f(Lin)n(us)g(Kam)n(b.)61 b(Distributed)37
b(shared)685 3556 y(memory:)f(Where)26 b(w)n(e)h(are)e(and)i(where)f(w)
n(e)g(should)h(b)r(e)g(headed.)35 b(In)27 b Fy(In)h(pr)l(o)l(c)l(e)l(e)
l(dings)685 3656 y(of)j(the)f(5th)g(Workshop)i(on)d(Hot)h(T)-6
b(opics)31 b(in)f(Op)l(er)l(ating)g(Systems)p Fz(,)d(1995.)556
3822 y([7])41 b(D.)c(Cheriton)e(and)h(K.)f(Duda.)62 b(A)36
b(cac)n(hing)f(mo)r(del)h(of)g(op)r(erating)e(system)i(k)n(ernel)685
3921 y(functionalit)n(y)-7 b(.)31 b(In)25 b Fy(Pr)l(o)l(c)l(e)l(e)l
(dings)i(of)g(the)g(First)g(Symp)l(osium)f(on)h(Op)l(er)l(ating)f
(Systems)685 4021 y(Design)k(and)g(Implementation)p Fz(,)f(pages)d
(179{193,)f(No)n(v)n(em)n(b)r(er)h(1994.)556 4187 y([8])41
b(D.)25 b(Engler,)f(M.)h(F.)f(Kaasho)r(ek,)g(and)g(J.)g(O'T)-7
b(o)r(ole.)31 b(The)24 b(Op)r(erating)f(System)i(Kernel)685
4287 y(as)f(a)g(Secure)f(Programmable)e(Mac)n(hine.)31
b(In)24 b Fy(Pr)l(o)l(c.)k(of)f(the)g(6th)g(SIGOPS)f(Eur)l(op)l(e)l(an)
685 4386 y(Workshop)p Fz(,)k(pages)c(62{67,)g(W)-7 b(adern,)27
b(German)n(y)-7 b(,)27 b(Sept)h(1994.)e(A)n(CM)h(SIGOPS.)556
4552 y([9])41 b(Bry)n(an)35 b(F)-7 b(ord,)37 b(Go)r(dmar)e(Bac)n(k,)h
(Greg)f(Benson,)i(Ja)n(y)d(Lepreau,)j(Alb)r(ert)f(Lin,)i(and)685
4652 y(Olin)h(Shiv)n(ers.)68 b(The)38 b(\015ux)h(os)f(to)r(olkit:)58
b(A)39 b(substrate)f(for)g(k)n(ernel)f(and)i(language)685
4752 y(researc)n(h.)55 b(In)35 b Fy(Pr)l(o)l(c)l(e)l(e)l(dings)i(of)g
(the)f(16th)h(SOSP)p Fz(,)c(Sain)n(t-Malo,)i(F)-7 b(rance,)36
b(Octob)r(er)685 4851 y(1997.)26 b(A)n(CM.)1885 5255
y(777)p eop
PStoPSsaved restore
userdict/PStoPSsaved save put
PStoPSmatrix setmatrix
595.000000 421.271378 translate
90 rotate
0.706651 dup scale
userdict/PStoPSmatrix matrix currentmatrix put
userdict/PStoPSclip{0 0 moveto
 595.000000 0 rlineto 0 842.000000 rlineto -595.000000 0 rlineto
 closepath}put initclip
PStoPSxform concat
778 779 bop 515 523 a Fz([10])40 b(Bry)n(an)30 b(F)-7
b(ord,)32 b(Mik)n(e)e(Hibler,)i(Ja)n(y)e(Lepreau,)h(P)n(atric)n(k)e(T)
-7 b(ullmann,)33 b(Go)r(dmar)d(Bac)n(k,)685 623 y(and)f(Stephen)h(Cla)n
(wson.)40 b(Microk)n(ernels)27 b(Meet)i(Recursiv)n(e)f(Virtual)h(Mac)n
(hines.)40 b(In)685 722 y Fy(Pr)l(o)l(c.)31 b(OSDI)p
Fz(,)c(Octob)r(er)g(1996.)515 888 y([11])40 b(Eric)n(h)27
b(Gamma,)h(Ric)n(hard)f(Helm,)i(Ralph)f(Johnson,)f(and)h(John)f
(Vlissides.)38 b Fy(Design)685 988 y(Patters.)31 b(Elements)e(of)i
(Obje)l(ct-Oriente)l(d)e(Softwar)l(e)p Fz(.)38 b(Addison-W)-7
b(esley)g(,)27 b(1995.)515 1154 y([12])40 b(John)g(L.)g(Hennessy)f(and)
h(Da)n(vid)g(A.)g(P)n(atterson.)71 b Fy(Computer)42 b(A)n(r)l(chite)l
(ctur)l(e:)60 b(A)685 1254 y(Quantitative)26 b(Appr)l(o)l(ach)p
Fz(.)32 b(Morgan)22 b(Kaufmann)h(Publishers,)g(San)h(F)-7
b(rancisco,)23 b(Cal-)685 1353 y(ifornia,)k(second)g(edition)h
(edition,)g(1996.)515 1519 y([13])40 b(T)-7 b(akuro)31
b(Kita)n(y)n(ama,)g(T.Nak)-5 b(a)5 b(jima,)33 b(and)f(Hideyuki)g(T)-7
b(okuda.)50 b(RT-IPC:)31 b(An)i(IPC)685 1619 y(Extension)25
b(for)g(Real-Time)h(Mac)n(h.)33 b(In)25 b Fy(Pr)l(o)l(c)l(e)l(e)l
(dings)k(of)g(the)f(2nd)h(Micr)l(okernel)g(and)685 1719
y(Other)h(Kernel)g(A)n(r)l(chite)l(ctur)l(es)p Fz(.)d(USENIX,)h(1993.)
515 1885 y([14])40 b(Donald)21 b(E.)g(Kn)n(uth.)26 b
Fy(Liter)l(ate)e(Pr)l(o)l(gr)l(amming)p Fz(.)i(Cen)n(ter)21
b(for)f(the)i(Study)f(of)g(Language)685 1984 y(and)28
b(Information,)f(Stanford)g(Univ)n(ersit)n(y)-7 b(,)27
b(1992.)515 2150 y([15])40 b(Leslie)23 b(Lamp)r(ort.)28
b Fy(A)d(Do)l(cument)g(Pr)l(ep)l(ar)l(ation)h(System:)36
b(L)2542 2133 y Fa(A)2580 2150 y Fy(T)2625 2168 y(E)2672
2150 y(X)p Fz(.)28 b(Addison-W)-7 b(esley)g(,)685 2250
y(ISBN)28 b(0-201-15790-X.)515 2416 y([16])40 b(R.)f(Pik)n(e,)h(D.)f
(Presotto,)g(K.)f(Thompson,)j(and)d(H.)g(T)-7 b(ric)n(k)n(ey)g(.)68
b(Plan)37 b(9)h(from)g(Bell)685 2516 y(Labs.)59 b(In)36
b Fy(NKUUG)g(Pr)l(o)l(c)l(e)l(e)l(dings)h(of)h(the)f(Summer)f(1990)i
(Confer)l(enc)l(e)p Fz(,)h(London)685 2615 y(\(England\),)28
b(July)f(1990.)515 2781 y([17])40 b(Norman)51 b(Ramsey)-7
b(.)108 b(Literate)52 b(programming)d(simpli\014ed.)109
b Fy(IEEE)53 b(Softwar)l(e)p Fz(,)685 2881 y(11\(5\):97{105,)24
b(Septem)n(b)r(er)k(1994.)515 3047 y([18])40 b(Bjarne)35
b(Stroustrup.)59 b Fy(The)38 b(C++)e(Pr)l(o)l(gr)l(amming)h(Language)p
Fz(.)61 b(Addison)35 b(W)-7 b(esley)g(,)685 3147 y(1986.)515
3313 y([19])40 b(Andrew)32 b(S.)h(T)-7 b(anen)n(baum.)49
b Fy(Op)l(er)l(ating)34 b(Systems:)46 b(Design)34 b(and)g
(Implementation)p Fz(.)685 3412 y(Pren)n(tice-Hall,)27
b(1987.)515 3578 y([20])40 b(H.)35 b(T)-7 b(okuda,)36
b(T.Nak)-5 b(a)5 b(jima,)35 b(and)f(P)-7 b(.)34 b(Rao.)57
b(Real-Time)33 b(Mac)n(h:)50 b(T)-7 b(o)n(w)n(ards)32
b(a)i(Pre-)685 3678 y(dictable)21 b(Real-Time)f(System.)26
b(In)21 b Fy(Pr)l(o)l(c)l(e)l(e)l(dings)j(of)g(the)g(1st)f(USENIX)g
(Mach)i(Work-)685 3778 y(shop)p Fz(.)k(USENIX,)g(Oct)e(1990.)1885
5255 y(778)p eop
PStoPSsaved restore
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
